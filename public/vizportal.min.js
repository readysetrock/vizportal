var Helpers;!function(e){function t(e,t){return _.object(_.pluck(e,t),e)}function r(e){return"true"===e}function n(e){return _.object(_.values(e),_.keys(e))}e.BooleanQueryParamRegex=/^[yt1]/i,e.BooleanQueryParamRegexFalse=/^[nf0]/i,e.dictFromArray=t,e.toBoolean=r,e.swapDict=n}(Helpers||(Helpers={}));var FeatureFlagsHelper;!function(e){function t(e){var t=e.slice(1).split("&"),i=[];return t.forEach(function(e){var t=n(e);r(t)&&i.push(t)}),i}function r(e){return e&&e.flagName&&(e.value===!0||e.value===!1)}function n(e){var t=e.split("="),r=decodeURIComponent(t[0]),n=decodeURIComponent(t[1]),i=null;return Helpers.BooleanQueryParamRegex.test(n)?i=!0:Helpers.BooleanQueryParamRegexFalse.test(n)&&(i=!1),{flagName:r,value:i}}function i(e,r){var n=t(e);n.forEach(function(e){s(e.flagName,r)&&(r[e.flagName]=e.value,a[e.flagName]=e.flagName)})}function o(e,t){_.each(e,function(e,r){s(r,t)&&!a[r]&&(t[r]=e)})}function s(e,t){return void 0!==t[e]}e.getOverridesFromQueryString=t;var a={};e.overwriteFeatureFlagsFromQueryString=i,e.overwriteFeatureFlagsFromServerFeatureFlags=o}(FeatureFlagsHelper||(FeatureFlagsHelper={}));var VizPortal;!function(e){var t;!function(e){e.contentAnalyticsEnabled=!1,e.dataSyncEnabled=!1,e.homePlaceEnabled=!1,e.oAuthWDCServerRefresh=!1,e.projectControlledPermissionsEnabled=!1,e.projectPermissionsTemplatesEnabled=!1,e.toggleSelectableRow=!1,e.reactDataGridInGroupsPlace=!0,e.reactDatasourceGrid=!0,e.reactExtractTasksGrid=!1,e.reactGroupUsersGrid=!1,e.reactProjectGrid=!0,e.reactRemoteSchedulesGrid=!1,e.reactSchedulesGrid=!1,e.reactServerUsersGrid=!1,e.reactSitesGrid=!1,e.reactSubscriptionsGrid=!1,e.reactViewGrid=!0,e.reactWorkbookGrid=!0,e.reactDataGridInSiteUsersPlace=!1,e.reactDataGridLoadingIndicator=!1,e.reactFavoritesMenu=!1,e.reactThumbnailsInWorkbooksAndViews=!1,e.reactTypeaheadFilter=!1,e.reactToasts=!0,e.reactTopBar=!1,e.reactTopBarDark=!1,e.connectedClientsTableEnabled=!0,e.useTallerRowHeight=!1,e.useUpdatedFontStyles=!1,e.webDataConnectorsEnabled=!1,e.workbookVersionHistoryEnabled=!1}(t=e.FeatureFlags||(e.FeatureFlags={}))}(VizPortal||(VizPortal={})),window.location.search&&FeatureFlagsHelper.overwriteFeatureFlagsFromQueryString(window.location.search,VizPortal.FeatureFlags);var VizPortal;!function(e){e.ContentFiltersKeys={connectionType:"connectionType",createdBefore:"createdBefore",createdAfter:"createdAfter",databaseUsername:"databaseUsername",domain:"domain",forWorkbook:"forWorkbook",hasDatasource:"hasDatasource",hasAlert:"hasAlert",hasExtracts:"hasExtracts",hasPassword:"hasPassword",inGroup:"inGroup",lastRefreshedBefore:"lastRefreshedBefore",lastRefreshedAfter:"lastRefreshedAfter",maxSiteRole:"maxSiteRole",groupsMinimumSiteRole:"groupsMinimumSiteRole",modifiedBefore:"modifiedBefore",modifiedAfter:"modifiedAfter",owner:"owner",project:"project",schedule:"schedule",search:"search",serverName:"serverName",serverPort:"serverPort",showEmbedded:"showEmbedded",siteId:"siteId",siteRole:"siteRole",tag:"tag",workbook:"workbook",datasource:"datasource",favorite:"favorite",recent:"recent",group:"group"}}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.BuildId;var t;!function(e){function t(){return i||(i=angular.module("VizPortal",["ngCookies","ngSanitize","ui.router","pascalprecht.translate","placeholderShim"])),i}function r(e){o.push(e)}function n(e){angular.forEach(o,function(t){e.get(t)})}var i,o=[];e.instance=t,e.registerEagerService=r,e.initializeEagerServices=n}(t=e.Module||(e.Module={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(){function e(e,t){this.method=e,this.params=t}return e.prototype.send=function(e){return e.sendRequest(this)},e}();e.Request=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"updateDisplayMode",t)}return __extends(t,e),t}(e.Request);e.UpdateDisplayModeRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){e.UserKeys={id:"id",authId:"authId",displayName:"displayName"}}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){e.AuthenticationType={AD:"AD",ClientCertificate:"CLIENT_CERTIFICATE",ClientCertificateWithFallback:"CLIENT_CERTIFICATE_WITH_FALLBACK",Kerberos:"KERBEROS",Local:"LOCAL",OpenId:"OPENID",Saml:"SAML",Sspi:"SSPI"},e.DomainFamily={ActiveDirectory:"activedirectory",Local:"local",External:"external"}}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){e.NamedItemKeys={id:"id",name:"name"}}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){e.DisplayModes={list:"list",thumbnail:"thumbnail"}}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.ViewportContent={deviceWidth:"width=device-width, maximum-scale=1.3",fixedWidth:"width=1024, maximum-scale=1.3"};var t=function(){function e(t){this.msieMatch=e.MSIE_REGEX.exec(t.navigator.userAgent),this.touchTest=e.TOUCH_REGEX.test(t.navigator.userAgent),this.chromeIOSTest=e.CHROME_IOS_REGEX.test(t.navigator.userAgent),this.chromeAndroidTest=e.CHROME_REGEX.test(t.navigator.userAgent)&&e.ANDROID_REGEX.test(t.navigator.userAgent)}return e.prototype.isIE7orLess=function(){return!!this.msieMatch&&this.msieMatch[1]<"8"},e.prototype.isIE8orLess=function(){return!!this.msieMatch&&this.msieMatch[1]<"9"},e.prototype.isIE9orLess=function(){return!!this.msieMatch&&parseInt(this.msieMatch[1],10)<10},e.prototype.isTouch=function(){return this.touchTest},e.prototype.isAndroidChrome=function(){return!!this.chromeAndroidTest},e.prototype.supportsFormData=function(){return void 0!==window.FormData},e.prototype.supportsFileReader=function(){return void 0!==window.FileReader},e.prototype.supportsDragAndDropEvents=function(){var e=document.createElement("div");return"ondragstart"in e&&"ondrop"in e},e.prototype.setViewport=function(e){var t=$('meta[name="viewport"]'),r=$("<meta>").attr("name","viewport").attr("content",e);t.length?t.replaceWith(r):$(document.head).prepend(r)},e.MSIE_REGEX=/msie ([\w.]+)/i,e.TOUCH_REGEX=/iphone|ipad|ipod|android|blackberry|webos|iemobile|palm/i,e.CHROME_IOS_REGEX=/CriOS\//,e.ANDROID_REGEX=/android/i,e.CHROME_REGEX=/Chrome\/[.0-9]*/,e.$inject=["$window"],e}();e.BrowserSupportService=t,e.Module.instance().service("BrowserSupportService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){t.MissingTranslationHandlerName="missingTranslation",e.Module.instance().factory(t.MissingTranslationHandlerName,["BrowserSupportService",function(e){return e.isIE9orLess()?function(e){}:function(e){console&&console.error&&console.error("missing '"+t.language+"' translation for key: "+e)}}])}(t=e.L10n||(e.L10n={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){function r(e){Globalize.load(e)}function n(e){var t=new Cldr(e);switch(t.locale){case"zh-HK":return"zh-Hans-HK";case"zh-SG":return"zh-Hans-SG";case"zh-TW":return"zh-Hant-TW";case"no":return"nb";case"sr-BA":return"sr-Cyrl-BA";case"sr-ME":return"sr-Cyrl-ME";case"sr-CS":return"sr-Cyrl";default:return t.locale}}function i(e){var t=e.main(["dates/calendars/gregorian/dateTimeFormats","medium"]);return x(t,[e.main(["dates/calendars/gregorian/timeFormats","short"]),e.main(["dates/calendars/gregorian/dateFormats","medium"])])}function o(e){b=Globalize.locale(n(e)),R=Globalize.numberFormatter({maximumFractionDigits:0}),w=Globalize.numberFormatter({minimumFractionDigits:1,maximumFractionDigits:1}),T=Globalize.numberFormatter({style:"percent"}),k=Globalize.dateFormatter({date:"medium"}),E=Globalize.dateFormatter({pattern:i(b)}),z=Globalize.dateFormatter({time:"short"}),U=Globalize.dateFormatter("yMMM"),D=Globalize.dateFormatter({time:"short"}),F=Globalize.dateParser({pattern:"H"}),V="mon"===b.supplemental.weekData.firstDay()?1:0,$=_.values(b.main("dates/calendars/gregorian/days/format/narrow")),I=_.values(b.main("dates/calendars/gregorian/days/format/wide")),1===V&&($.push($.shift()),I.push(I.shift())),M=b.supplemental.timeData.preferred()}function s(e){return R&&e===+e&&e===(0|e)?R(e):e}function a(e){return w&&e===+e?w(e):e}function c(e){return T&&e===+e?T(e/100):e}function l(e,t){return t?_.isDate(e)?t(e):_.isString(e)?t(new Date(e)):"":""}function u(e){return F(e)}function d(e){return l(e,k)}function p(e){return l(e,E)}function h(e){return l(e,D)}function f(e){return l(e,z)}function m(){return V||0}function v(){return 1===m()}function S(){return"H"===M}function g(){return $||[]}function y(){return I||[]}function A(e){return U?U(e):""}function P(e){return e&&e.length>100?e.substr(0,100)+"â€¦":e}var C;!function(e){e.allOwners="allOwners",e.allProjects="allProjects",e.allTags="allTags",e.connector="connector",e.custom="custom",e.datasourceConnector="datasourceConnector",e.datasourceEditor="datasourceEditor",e.delete_="delete",e.denied="denied",e.edit="edit",e.editor="editor",e.interactor="interactor",e.projectLeader="project_leader",e.none="none",e.permissions="permissions",e.publisher="publisher",e.save="save",e.sizeInBytes="sizeInBytes",e.sizeInGB="sizeInGB",e.sizeInKB="sizeInKB",e.sizeInMB="sizeInMB",e.title="title",e.viewer="viewer"}(C=t.Keys||(t.Keys={})),t.language,t.locale,t.loadLocaleJson=r;var b,R,w,T,k,E,z,D,F,V,$,I,U,M,x=Globalize._formatMessage;t.useLocale=o,t.localizedCount=s,t.localizedFloat=a,t.localizedPercent=c,t.parse24Hour=u,t.localizedDate=d,t.localizedDateTime=p,t.localizedShortTime=h,t.localizedTime=f,t.firstDayOfWeek=m,t.firstDayOfWeekIsMonday=v,t.is24HourTimeCycle=S,t.narrowDayNames=g,t.wideDayNames=y,t.yearAndMonth=A,t.elideIfLong=P;var N=function(){function e(e,t,r){void 0===t&&(t=""),void 0===r&&(r="escaped"),this.wrappedInterpolation=e,this.id=t,this.sanitizeStrategy=r}return e.prototype.setLocale=function(e){this.wrappedInterpolation.setLocale(e)},e.prototype.getInterpolationIdentifier=function(){return this.id},e.prototype.useSanitizeValueStrategy=function(e){return this.savedSanitizeStrategy=e,this.wrappedInterpolation.useSanitizeValueStrategy(e),this},e.prototype.interpolate=function(e,t){this.wrappedInterpolation.useSanitizeValueStrategy(this.sanitizeStrategy);var r=this.wrappedInterpolation.interpolate(e,t);return this.wrappedInterpolation.useSanitizeValueStrategy(this.savedSanitizeStrategy),r},e}(),L=function(){function e(e,t,r,n){void 0===n&&(n=null),this.wrappedInterpolation=e,this.id=t,this.localize=r,this.sanitizeStrategy=n}return e.prototype.setLocale=function(e){this.wrappedInterpolation.setLocale(e)},e.prototype.getInterpolationIdentifier=function(){return this.id},e.prototype.useSanitizeValueStrategy=function(e){return this.savedSanitizeStrategy=e,this.wrappedInterpolation.useSanitizeValueStrategy(e),this},e.prototype.interpolate=function(e,t){var r=this,n={};_.each(t,function(e,i){n[i]=e;var o=i+"_LOC";_.has(t,o)||e!==+e||(n[o]=r.localize(e))}),this.wrappedInterpolation.useSanitizeValueStrategy(this.sanitizeStrategy);var i=this.wrappedInterpolation.interpolate(e,n);return this.wrappedInterpolation.useSanitizeValueStrategy(this.savedSanitizeStrategy),i},e}();t.Interpolations={Escaped:"escaped",Count:"localizedCount",CountEscaped:"localizedCountEscaped",Float:"localizedFloat",FloatEscaped:"localizedFloatEscaped",Percent:"localizedPercent",PercentEscaped:"localizedPercentEscaped"};var O="EscapedTranslateInterpolation";angular.module("pascalprecht.translate").factory(O,["$translateMessageFormatInterpolation",function(e){return new N(e,t.Interpolations.Escaped)}]);var q="LocalizedCountTranslateInterpolation";angular.module("pascalprecht.translate").factory(q,["$translateMessageFormatInterpolation",function(e){return new L(e,t.Interpolations.Count,s)}]);var G="LocalizedCountEscapedTranslateInterpolation";angular.module("pascalprecht.translate").factory(G,["$translateMessageFormatInterpolation",function(e){return new L(e,t.Interpolations.CountEscaped,s,"escaped")}]);var W="LocalizedFloatTranslateInterpolation";angular.module("pascalprecht.translate").factory(W,["$translateMessageFormatInterpolation",function(e){return new L(e,t.Interpolations.Float,a)}]);var j="LocalizedFloatEscapedTranslateInterpolation";angular.module("pascalprecht.translate").factory(j,["$translateMessageFormatInterpolation",function(e){return new L(e,t.Interpolations.FloatEscaped,a,"escaped")}]);var H="LocalizedPercentTranslateInterpolation";angular.module("pascalprecht.translate").factory(H,["$translateMessageFormatInterpolation",function(e){return new L(e,t.Interpolations.Percent,c)}]);var B="LocalizedPercentEscapedTranslateInterpolation";angular.module("pascalprecht.translate").factory(B,["$translateMessageFormatInterpolation",function(e){return new L(e,t.Interpolations.PercentEscaped,c,"escaped")}]),e.Module.instance().config(["$translateProvider",function(e){e.translationNotFoundIndicatorLeft("[").translationNotFoundIndicatorRight("]").useMissingTranslationHandler(t.MissingTranslationHandlerName).useStaticFilesLoader({prefix:"loc/",suffix:".json"}).useMessageFormatInterpolation().addInterpolation(O).addInterpolation(q).addInterpolation(G).addInterpolation(W).addInterpolation(j).addInterpolation(H).addInterpolation(B)}])}(t=e.L10n||(e.L10n={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"auth/clientCertificateLogin",t)}return __extends(t,e),t}(e.Request);e.ClientCertificateLoginRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){void 0===t&&(t={}),e.call(this,"generatePublicKey",t)}return __extends(t,e),t}(e.Request);e.GeneratePublicKeyRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){void 0===t&&(t={}),e.call(this,"getServerSettingsUnauthenticated",t)}return __extends(t,e),t}(e.Request);e.GetServerSettingsUnauthenticatedRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(){e.call(this,"getSessionInfo",{})}return __extends(t,e),t}(e.Request);e.GetSessionInfoRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"initializeServerWithActiveDirectoryUser",t)}return __extends(t,e),t}(e.Request);e.InitializeServerWithActiveDirectoryUserRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"initializeServerWithExternalUser",t)}return __extends(t,e),t}(e.Request);e.InitializeServerWithExternalUserRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"initializeServerWithLocalUser",t)}return __extends(t,e),t}(e.Request);e.InitializeServerWithLocalUserRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"auth/kerberosLogin",t)}return __extends(t,e),t}(e.Request);e.KerberosLoginRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"login",t)}return __extends(t,e),t}(e.Request);e.LoginRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(){e.call(this,"logout",{})}return __extends(t,e),t}(e.Request);e.LogoutRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"auth/sspiLogin",t)}return __extends(t,e),t}(e.Request);e.SspiLoginRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"switchSite",t)}return __extends(t,e),t}(e.Request);e.SwitchSiteRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){e.SiteRoles={ServerAdministrator:"ServerAdministrator",SiteAdministrator:"SiteAdministrator",Publisher:"Publisher",Interactor:"Interactor",Viewer:"Viewer",Unlicensed:"Unlicensed",ViewerWithPublish:"ViewerWithPublish",UnlicensedWithPublish:"UnlicensedWithPublish",Guest:"Guest"}}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){!function(e){e[e.Info=0]="Info",e[e.Error=1]="Error",e[e.External=2]="External"}(e.ToastType||(e.ToastType={}));var t=e.ToastType,r=function(){function r(e){this.listeners=[],this.nextToastId=0,this.nextListenerId=0,this.$interval=e,this.toasts=[]}return r.prototype.pop=function(r){var n=this.nextToastId++,i={id:n,type:t[r.type].toLowerCase(),isClosed:!1,lines:r.text?r.text.split("\n"):void 0,templateUrl:r.templateUrl,data:r.data,timeoutDelay:r.timeoutDelay,content:r.content};return i.timeoutDelay=_.isNumber(r.timeoutDelay)?r.timeoutDelay:this.defaultTimeoutForType(r.type),this.toasts.push(i),e.FeatureFlags.reactToasts&&this.notifyListeners(),i.id},r.prototype.defaultTimeoutForType=function(e){return e===t.Info?r.DefaultTimeOutForInfo:r.DefaultTimeOutForError},r.prototype.notifyListeners=function(){var e=this;_.each(this.listeners,function(t){return t.toastsUpdated(e.toasts)})},r.prototype.close=function(t){var r=this;e.FeatureFlags.reactToasts?(this.toasts=_.filter(this.toasts,function(e){return e.id!==t}),this.notifyListeners()):_.find(this.toasts,function(e,n){return e.id===t?(r.toasts.splice(n,1),r.$interval.cancel(e.timeout),e.isClosed=!0,!0):!1})},r.prototype.isClosed=function(e){return _.each(this.toasts,function(t){return t.id===e?!1:void 0}),!0},r.prototype.addListener=function(e){var t=this.nextListenerId++;return e.id=t,this.listeners.push(e),t},r.prototype.removeListener=function(e){this.listeners=_.filter(this.listeners,function(t){return t.id!==e})},r.NoTimeout=0,r.DefaultTimeOutForInfo=1e4,r.DefaultTimeOutForError=r.NoTimeout,r.$inject=["$interval"],r}();e.ToasterService=r,e.Module.instance().service("ToasterService",r)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().constant("ApiPrefix","vizportal/api/web/v1/"),e.Module.instance().constant("RestApiPrefix","vizportal/api/rest/v1/");var t;!function(e){e[e.Exists=0]="Exists",e[e.NoSession=1]="NoSession",e[e.Unknown=2]="Unknown"}(t||(t={})),function(e){e[e.Canceled=1000001]="Canceled",e[e.ResourceNotFound=1000002]="ResourceNotFound",e[e.Unauthorized=1000003]="Unauthorized",e[e.Unknown=1000004]="Unknown"}(e.ErrorReason||(e.ErrorReason={}));var r=e.ErrorReason;!function(e){e[e.Anonymous=0]="Anonymous",e[e.Authenticated=1]="Authenticated",e[e.SiteAdmin=2]="SiteAdmin",e[e.SelfOrAdmin=3]="SelfOrAdmin",e[e.SelfOrServerAdmin=4]="SelfOrServerAdmin",e[e.ServerAdmin=5]="ServerAdmin"}(e.AuthLevel||(e.AuthLevel={}));var n=e.AuthLevel;e.MaxRequestArrayLength=1e3;var i=function(){function i(r,n,i,o,s,a,c,l,u,d,p,h){this.$http=r,this.$location=n,this.$q=i,this.$state=o,this.$stateParams=s,this.$translate=a,this.$cookies=c,this.apiPrefix=l,this.restApiPrefix=u,this.toaster=d,this.windowLocation=p,this.stateWrapperService=h,this.sessionState=t.Unknown,this.numSessionInfoRequests=0,this.sessionInfoPromise=null,this.caseInsensitiveSiteUrlNames=new e.Set(function(e){return e.toLowerCase()})}return i.prototype.getSessionInfoPromise=function(){return this.sessionInfoPromise?this.sessionInfoPromise:this.$q.when()},i.prototype.sendRequest=function(e){var t=this;return this.numSessionInfoRequests>0?this.sessionInfoPromise.then(function(){return t.requestPost(e)}):this.requestPost(e)},i.prototype.sendRequests=function(e,t){var r=this,n=function(i,o){return r.sendRequest(e[i]).then(function(r){o[i]=r;var s=i+1;return s<e.length?n(s,o):t(o)})};return n(0,[])},i.prototype.sendRequestsParallel=function(e,t){var r=this,n=e.map(function(e){return r.sendRequest(e)});return this.$q.all(n).then(function(e){return t(e)})},i.prototype.login=function(t,r,n){var i=this;return this.sessionInfoRequest(function(){return i.requestPost(new e.ServerApi.GeneratePublicKeyRequest).then(function(o){var s={username:t,encryptedPassword:rsa.encrypt(r,o.key),keyId:o.keyId};_.isString(n)&&(s.siteUrlName=n);var a=new e.ServerApi.LoginRequest(s);return i.requestPost(a).then(function(e){return e.errors?i.$q.reject(e.errors[0]):i.setSessionInfo(e)})})})},i.prototype.autoLogin=function(t){var n=this;return this.sessionInfoRequest(function(){var i={};_.isString(t)&&(i.siteUrlName=t);var o,s=n.authenticationType();switch(s){case e.ServerApi.AuthenticationType.Sspi:o=new e.ServerApi.SspiLoginRequest(i);break;case e.ServerApi.AuthenticationType.Kerberos:o=new e.ServerApi.KerberosLoginRequest(i);break;case e.ServerApi.AuthenticationType.ClientCertificate:case e.ServerApi.AuthenticationType.ClientCertificateWithFallback:o=new e.ServerApi.ClientCertificateLoginRequest(i)}return n.requestGet(o).then(function(e){return e.errors?n.$q.reject(e.errors[0]&&e.errors[0].code):n.setSessionInfo(e)},function(t){if(n.clearSessionInfo(),t===r.Unauthorized||t===r.Unknown)switch(s){case e.ServerApi.AuthenticationType.Sspi:t=e.LoginErrorCodes.SspiFailed;break;case e.ServerApi.AuthenticationType.Kerberos:t=e.LoginErrorCodes.KerberosFailed;break;case e.ServerApi.AuthenticationType.ClientCertificate:case e.ServerApi.AuthenticationType.ClientCertificateWithFallback:t=e.LoginErrorCodes.ClientCertificateNotFound}return n.$q.reject(t)})})},i.prototype.initialize=function(t,r,n){var i=this;return this.sessionInfoRequest(function(){return i.requestPost(new e.ServerApi.GeneratePublicKeyRequest).then(function(o){var s,a=rsa.encrypt(r,o.key);if(i.isServerDomainFamilyActiveDirectory())s=new e.ServerApi.InitializeServerWithActiveDirectoryUserRequest({username:t,encryptedPassword:a,keyId:o.keyId});else if(i.isServerDomainFamilyLocal())s=new e.ServerApi.InitializeServerWithLocalUserRequest({username:t,encryptedPassword:a,keyId:o.keyId,displayName:n});else{if(!i.isServerDomainFamilyExternal())throw new Error("Unknown domain family type. Current implementation only supports: AD, local, and external.");s=new e.ServerApi.InitializeServerWithExternalUserRequest({username:t,encryptedPassword:a,keyId:o.keyId})}return i.requestPost(s).then(function(e){return e.errors?i.$q.reject(e.errors[0]&&e.errors[0].code):i.setSessionInfo(e)})})})},i.prototype.refreshSessionInfo=function(){var r=this;return this.sessionInfoRequest(function(){return r.requestPost(new e.ServerApi.GetSessionInfoRequest).then(function(e){return e.errors?(r.sessionState=t.NoSession,e.errors[0]&&e.errors[0].code):r.setSessionInfo(e)}).fail(function(e){return r.clearSessionInfo(),e})})},i.prototype.refreshServerSettings=function(){var t=this;return this.requestPost(new e.ServerApi.GetServerSettingsUnauthenticatedRequest).then(function(e){t.serverSettings=e})},i.prototype.overrideAuthenticationType=function(e){this.authenticationTypeOverride=e},i.prototype.bootstrapSession=function(){var e=this,t=null;return this.$q.all([this.refreshServerSettings(),this.refreshSessionInfo()]).then(function(r){return t=r[1],e.updateLanguageAndLocale()}).then(function(){return e.$q.when(t)})},i.prototype.switchSiteIfNeeded=function(t,r){var n=this;return this.sessionInfoRequest(function(){return t=t||"",n.isCurrentSiteUrlName(t)?n.$q.when(null):n.requestPost(new e.ServerApi.SwitchSiteRequest({urlName:t})).then(function(r){if(r&&r.errors){var i=r.errors[0];return i&&i.code===e.SiteSwitchErrorCodes.AttemptedToSwitchSiteToCurrentSite?void n.caseInsensitiveSiteUrlNames.add(t):n.$q.reject(i)}n.setSessionInfo(r)},function(t){return t&&t.code===e.CommonErrorCode.RedirectToOtherPod?(n.redirectToOtherPod(t,r),n.$q.defer().promise):void 0})})},i.prototype.redirectToOtherPod=function(e,t){var r=this.getDestinationPodFromError(e),n=r+t;this.windowLocation.navigateToWithoutAddingToHistory(n)},i.prototype.isCurrentSiteUrlName=function(e){return this.caseInsensitiveSiteUrlNames.contains(e)?this.sessionSiteUrlName().toLowerCase()===e.toLowerCase():this.sessionSiteUrlName()===e},i.prototype.isUserAuthorized=function(e){switch(e){case n.Anonymous:default:return!0;case n.Authenticated:return this.inSession();case n.SiteAdmin:return this.isSessionSiteOrServerAdmin();case n.SelfOrAdmin:return this.isSessionSiteOrServerAdmin()||this.isSessionUserSelf();case n.SelfOrServerAdmin:return this.isSessionServerAdmin()||this.isSessionUserSelf();case n.ServerAdmin:return this.isSessionServerAdmin()}},i.prototype.signOut=function(){var t=this;this.requestPost(new e.ServerApi.LogoutRequest).then(function(e){t.windowLocation.navigateTo(e.redirectUrl||"/")})},i.prototype.sessionStateString=function(){return t[this.sessionState]},i.prototype.sessionUserInfo=function(){return this.sessionInfo&&this.sessionInfo.user},i.prototype.isSessionRestrictedTrustedTicket=function(){return this.sessionInfo&&this.sessionInfo.isRestrictedTrustedTicketSession},i.prototype.sessionUserDisplayName=function(){return this.sessionInfo&&this.sessionInfo.user&&this.sessionInfo.user.displayName||""},i.prototype.sessionUserId=function(){return this.sessionInfo&&this.sessionInfo.user&&this.sessionInfo.user.id},i.prototype.sessionAuthUserId=function(){return this.sessionInfo&&this.sessionInfo.user&&this.sessionInfo.user.authId},i.prototype.sessionSiteLuid=function(){return this.sessionInfo&&this.sessionInfo.site&&this.sessionInfo.site.luid},i.prototype.sessionUsername=function(){return this.sessionInfo&&this.sessionInfo.user&&this.sessionInfo.user.username},i.prototype.sessionUserDomainName=function(){return this.sessionInfo&&this.sessionInfo.user&&this.sessionInfo.user.domainName},i.prototype.inSession=function(){return!!this.sessionInfo},i.prototype.isSessionUserEqualTo=function(e,t){return this.sessionInfo&&this.sessionInfo.user&&this.sessionInfo.user.username===e&&this.sessionInfo.user.domainName===t},i.prototype.isSessionUserSelf=function(){return this.isSessionUserEqualTo(this.$stateParams.username,this.$stateParams.domainName)},i.prototype.isSessionServerAdmin=function(){return this.sessionInfo&&this.sessionInfo.user&&this.sessionInfo.user.serverAdmin},i.prototype.isSessionSiteAdmin=function(){return this.sessionInfo&&this.sessionInfo.site.role===e.ServerApi.SiteRoles.SiteAdministrator},i.prototype.isSessionSiteOrServerAdmin=function(){return this.isSessionServerAdmin()||this.isSessionSiteAdmin()},i.prototype.sessionSiteId=function(){return this.sessionInfo?this.sessionInfo.site.id:""},i.prototype.sessionServerId=function(){return this.sessionInfo?this.sessionInfo.server.logicalServerInstanceId:""},i.prototype.sessionSite=function(){return this.sessionInfo&&this.sessionInfo.site},i.prototype.sessionSiteUrlName=function(){return this.sessionInfo&&this.sessionInfo.site.urlName||""},i.prototype.sessionSiteName=function(){return this.sessionInfo?this.sessionInfo.site.name:""},i.prototype.sessionServerVersion=function(){return this.sessionInfo?this.sessionInfo.server.version:null},i.prototype.thirdPartyAuthState=function(){return this.sessionInfo&&this.sessionInfo.site.thirdPartyAuthState||{allowed:!1,enabled:!1,serverEnabled:!1,hasThirdPartyAuthenticatedUsers:!1}},i.prototype.isThirdPartyAuthAllowed=function(){return this.thirdPartyAuthState().allowed},i.prototype.isThirdPartyAuthConfiguredForServer=function(){return this.thirdPartyAuthState().serverEnabled},i.prototype.isThirdPartyAuthEnabled=function(){return this.thirdPartyAuthState().enabled},i.prototype.isThirdPartyAuthEditable=function(){return this.thirdPartyAuthState().enabled||this.thirdPartyAuthState().hasThirdPartyAuthenticatedUsers},i.prototype.sessionSupportHost=function(){return this.sessionInfo&&this.sessionInfo.server.supportHost},i.prototype.sessionSupportPath=function(){return this.sessionInfo&&this.sessionInfo.server.supportPath},i.prototype.isSessionStateUnknown=function(){return this.sessionState===t.Unknown},i.prototype.isSessionMultiSite=function(){return this.sessionInfo&&this.sessionInfo.user&&this.sessionInfo.user.numberOfSites>1},i.prototype.isLogoutEnabled=function(){return this.sessionInfo&&this.sessionInfo.site&&this.sessionInfo.site.logoutEnabled},i.prototype.isLiveDBAvailable=function(){return this.sessionInfo&&this.sessionInfo.site&&this.sessionInfo.site.liveDBAvailable},i.prototype.siteLogo=function(){return this.sessionInfo&&this.sessionInfo.site&&this.sessionInfo.site.customization},i.prototype.isSiteCustomizationEnabled=function(){return this.sessionInfo&&this.sessionInfo.server&&this.sessionInfo.server.siteCustomizationEnabled},i.prototype.isTabAdminServiceEnabled=function(){return this.sessionInfo&&this.sessionInfo.server&&this.sessionInfo.server.tabAdminServiceEnabled},i.prototype.isSiteAdminSettingsEnabled=function(){return this.sessionInfo&&this.sessionInfo.server&&this.sessionInfo.server.siteAdminSettingsEnabled},i.prototype.waitForSession=function(){return this.numSessionInfoRequests>0?this.sessionInfoPromise:this.$q.when()},i.prototype.sessionLanguage=function(){return this.sessionInfo&&this.sessionInfo.user&&this.sessionInfo.user.language},i.prototype.sessionLocale=function(){return this.sessionInfo&&this.sessionInfo.user&&this.sessionInfo.user.locale},i.prototype.updateDisplayNameAllowed=function(){return this.sessionInfo&&this.sessionInfo.server&&this.sessionInfo.server.updateDisplayNameAllowed},i.prototype.defaultSubscriptionsEmail=function(){return this.sessionInfo&&this.sessionInfo.server&&this.sessionInfo.server.defaultSubscriptionsEmail},i.prototype.featureFlags=function(){return this.sessionInfo&&this.sessionInfo.server&&this.sessionInfo.server.featureFlags},i.prototype.changePasswordUrl=function(){return this.sessionInfo&&this.sessionInfo.server&&this.sessionInfo.server.changePasswordUrl},i.prototype.datasourceHelpUrl=function(){return this.sessionInfo&&this.sessionInfo.server&&this.sessionInfo.server.datasourceHelpUrl},i.prototype.offlineHelpEnabled=function(){return this.sessionInfo&&this.sessionInfo.server&&this.sessionInfo.server.offlineHelpEnabled},i.prototype.helpEdition=function(){return this.sessionInfo&&this.sessionInfo.server&&this.sessionInfo.server.helpEdition},i.prototype.oauthGoogleEnabled=function(){return this.sessionInfo&&this.sessionInfo.server&&this.sessionInfo.server.oauthGoogleEnabled},i.prototype.oauthSalesforceEnabled=function(){return this.sessionInfo&&this.sessionInfo.server&&this.sessionInfo.server.oauthSalesforceEnabled},i.prototype.rebuildingSearchIndex=function(){return this.sessionInfo&&this.sessionInfo.server&&this.sessionInfo.server.rebuildingSearchIndex},i.prototype.canSessionUserManageUsers=function(){return this.sessionInfo&&this.sessionInfo.user&&this.sessionInfo.user.canManageUsers},i.prototype.domainFamily=function(){return this.serverSettings&&this.serverSettings.domainFamily},i.prototype.isServerDomainFamilyActiveDirectory=function(){return this.serverSettings&&this.serverSettings.domainFamily===e.ServerApi.DomainFamily.ActiveDirectory},i.prototype.isServerDomainFamilyLocal=function(){return this.serverSettings&&this.serverSettings.domainFamily===e.ServerApi.DomainFamily.Local},i.prototype.isServerDomainFamilyExternal=function(){return this.serverSettings&&this.serverSettings.domainFamily===e.ServerApi.DomainFamily.External},i.prototype.getStartPage=function(){return this.sessionInfo&&this.sessionInfo.user&&this.sessionInfo.user.startPage||"/"},i.prototype.sessionUserDisplayMode=function(){return this.sessionInfo&&this.sessionInfo.user&&this.sessionInfo.user.displayMode},i.prototype.isAlertFailureCountEnabled=function(){
return this.sessionInfo.server.alertFailureCountEnabled},i.prototype.authenticationType=function(){return this.authenticationTypeOverride||this.serverSettings&&this.serverSettings.authenticationType&&this.serverSettings.authenticationType.type},i.prototype.licenseExpirationDateIfWithinWarningPeriod=function(){return this.serverSettings&&this.serverSettings.licenseExpirationDate},i.prototype.serverCustomization=function(){return this.serverSettings&&this.serverSettings.customization},i.prototype.serverName=function(){var t=this.serverCustomization();return t&&t.serverName||this.$translate.instant(e.L10n.Keys.title)},i.prototype.serverLanguage=function(){return this.serverSettings&&this.serverSettings.defaultLanguage},i.prototype.serverLocale=function(){return this.serverSettings&&this.serverSettings.defaultLocale},i.prototype.isGuestEnabled=function(){return this.serverSettings&&this.serverSettings.guestEnabled},i.prototype.preloginCustomization=function(){return this.serverSettings&&this.serverSettings.preloginCustomization},i.prototype.sessionInfoRequest=function(e){var t=this;return this.numSessionInfoRequests>0?this.sessionInfoPromise=this.sessionInfoPromise.then(e):this.sessionInfoPromise=e(),this.numSessionInfoRequests++,this.sessionInfoPromise.fin(function(){t.numSessionInfoRequests--}),this.sessionInfoPromise},i.prototype.getFirstErrorFromResponse=function(e){return e&&e.data&&e.data.result&&e.data.result.errors&&e.data.result.errors[0]},i.prototype.getCodeFromError=function(e){return e&&e.code},i.prototype.getDestinationPodFromError=function(e){var t=e;return t&&t.destinationPodUrl},i.prototype.request=function(e){var t=this;return this.$http(e).then(function(e){var r=t.getFirstErrorFromResponse(e),n=t.getCodeFromError(r);if(t.maybeHandleSearchServerDown(n))return t.$q.reject(n);var i=t.getDestinationPodFromError(r);return t.maybeHandleRedirectionToOtherPod(n,i)?t.$q.reject(r):e.data&&!_.isUndefined(e.data.result)?e.data.result:null},function(e){var n=t.getCodeFromError(t.getFirstErrorFromResponse(e));return 401===e.status&&t.handle401(n),t.$q.reject(n||r.Unknown)})},i.prototype.requestGet=function(e){var t="";if(e.params){var r=$.param(e.params);r&&(t="?"+r)}return this.request({method:"GET",url:this.apiPrefix+e.method+t})},i.prototype.requestPost=function(e){return this.request({method:"POST",url:this.apiPrefix+e.method,data:e})},i.prototype.requestPostFormDataToRestApi=function(e,t){return this.request({method:"POST",transformRequest:function(e){return e},headers:{"Content-Type":void 0},url:this.restApiPrefix+t,data:e})},i.prototype.handle401=function(t){if(this.$state.current.name&&this.$state.current.data.authLevel!==n.Anonymous)if(this.isAuthenticationAutoLogin()||this.isAuthenticationExternal())this.windowLocation.reload();else{var r=this.$state.href("login.authenticate",{redirect:this.$location.url()||null,error:t||e.CommonErrorCode.InvalidSession});this.windowLocation.navigateTo(r.replace(/^#/,""))}},i.prototype.maybeHandleSearchServerDown=function(t){return t&&t===e.SolrErrorCode.SolrCommunicationError||t===e.SolrErrorCode.SolrDisabled?(this.isUserAuthorized(n.ServerAdmin)?this.$state.is("main.server.status")||this.$state.go("main.error",{detailsLocKey:"searchServerDown",redirectState:"main.server.status",redirectLocKey:"goToServerStatus"}):this.$state.go("login.error.errorCode",{errorCode:t}),!0):!1},i.prototype.maybeHandleRedirectionToOtherPod=function(t,r){return t&&t===e.CommonErrorCode.RedirectToOtherPod&&null!==r},i.prototype.isAuthenticationAutoLogin=function(){return this.isWindowsCredentialsAutoLogin()||this.authenticationType()===e.ServerApi.AuthenticationType.ClientCertificate||this.authenticationType()===e.ServerApi.AuthenticationType.ClientCertificateWithFallback},i.prototype.isWindowsCredentialsAutoLogin=function(){return this.authenticationType()===e.ServerApi.AuthenticationType.Sspi||this.authenticationType()===e.ServerApi.AuthenticationType.Kerberos},i.prototype.isAuthenticationSaml=function(){return this.authenticationType()===e.ServerApi.AuthenticationType.Saml},i.prototype.isAuthenticationOpenId=function(){return this.authenticationType()===e.ServerApi.AuthenticationType.OpenId},i.prototype.isAuthenticationExternal=function(){return this.isAuthenticationSaml()||this.isAuthenticationOpenId()},i.prototype.getSessionIdleLimitSeconds=function(){return this.sessionInfo&&this.sessionInfo.server&&this.sessionInfo.server.sessionIdleLimitSeconds||300},i.prototype.setSessionInfo=function(r){var n=this;return this.sessionInfo=r,this.sessionState=t.Exists,FeatureFlagsHelper.overwriteFeatureFlagsFromServerFeatureFlags(r.server.featureFlags,e.FeatureFlags),this.updateLanguageAndLocale().then(function(){n.showOrHideRebuildingSearchIndexToast()})},i.prototype.clearSessionInfo=function(){this.sessionState=t.NoSession,this.sessionInfo=null},i.prototype.showOrHideRebuildingSearchIndexToast=function(){this.inSession()&&e.L10n.language&&this.rebuildingSearchIndex()?(!this.rebuildingSearchIndexToast||this.rebuildingSearchIndexToast.isClosed)&&(this.toaster.pop({type:e.ToastType.Error,text:this.$translate.instant("rebuildingSearchIndexMessage")}),this.rebuildingSearchIndexToast=this.toaster.toasts[this.toaster.toasts.length-1]):this.rebuildingSearchIndexToast&&this.toaster.close(this.rebuildingSearchIndexToast.id)},i.prototype.updateLanguageAndLocale=function(){var t=this,r=e.L10n.language,n=e.L10n.locale,i=this.sessionLanguage()||this.serverLanguage()||"en",o=this.sessionLocale()||this.serverLocale()||"en_US",s=this.$q.when(),a=this.$q.when();return i!==r&&(e.L10n.language=i,s=this.$translate.use(i).then(function(){e.L10n.language===i&&(document.title=t.serverName())})),o!==n&&(e.L10n.locale=o,a=this.$q.all([this.getSupplementalLocaleJson(),this.getLocaleJson(o)]).then(function(t){e.L10n.locale===o&&(e.L10n.loadLocaleJson(t[1]),e.L10n.useLocale(o))})),this.$q.all([s,a])},i.prototype.getSupplementalLocaleJson=function(){return this.supplementalLocaleJsonPromise||(this.supplementalLocaleJsonPromise=this.getLocaleJson("supplemental").then(function(t){e.L10n.loadLocaleJson(t)})),this.supplementalLocaleJsonPromise},i.prototype.getLocaleJson=function(e){return this.$http.get("locales/"+e+".json").then(function(e){return e.data})},i.prototype.updateSiteLogo=function(t,r){var n=new FormData;return n.append("updateSiteCustomLogoInput",t),n.append(e.CookieKeys.XsrfToken,this.$cookies[e.CookieKeys.XsrfToken]),n.append("useCustomLogo",!r),n.append("useIframeResponse",!1),this.requestPostFormDataToRestApi(n,"updateSiteLogo")},i.$inject=["$http","$location","$q","$state","$stateParams","$translate","$cookies","ApiPrefix","RestApiPrefix","ToasterService","WindowLocationService","StateWrapperService"],i}();e.ServerService=i,e.Module.instance().service("ServerService",i)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,r,n){this.$location=e,this.ServerService=r,this.BrowserSupportService=n,this.displayModeUpdatedFromSession=!1,this.displayModeUpdatedFromUrl=!1,this.displayMode=t.DefaultDisplayMode,this.topBar={collapsed:!1,height:null},this.showFilterPanel=!n.isTouch()}return t.prototype.saveDisplayMode=function(){this.ServerService.sendRequest(new e.ServerApi.UpdateDisplayModeRequest({displayMode:this.displayMode})),this.$location.search().mode&&this.$location.search("mode",this.displayMode)},t.prototype.maybeUpdateDisplayModeFromSession=function(){if(!this.displayModeUpdatedFromSession&&!this.displayModeUpdatedFromUrl){this.displayModeUpdatedFromSession=!0;var e=this.ServerService.sessionUserDisplayMode();e&&(this.displayMode=e)}},t.prototype.updateDisplayModeFromUrl=function(){this.displayMode=this.getDisplayModeFromUrl(this.displayMode)},t.prototype.getDisplayModeFromUrl=function(t){var r=this.$location.search(),n=r.mode;switch(n){case e.ServerApi.DisplayModes.list:case e.ServerApi.DisplayModes.thumbnail:return this.displayModeUpdatedFromUrl=!0,n;default:return this.displayModeUpdatedFromUrl=!1,t}},t.prototype.updateShowFilterPanel=function(){var t=this;_.each(_.keys(this.$location.search()),function(r){_.has(e.ContentFiltersKeys,r)&&(t.showFilterPanel=!0)})},t.DefaultDisplayMode=e.ServerApi.DisplayModes.thumbnail,t.$inject=["$location","ServerService","BrowserSupportService"],t}();e.DisplaySettingsService=t,e.Module.instance().service("DisplaySettingsService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.UrlParamKeys={SiteUrlName:"siteUrlName",IsFromSaml:":isFromSaml",ClosePopupWhenDone:"closePopupWhenDone",AuthenticationType:"auth"}}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e,t){this.$translate=e,this.ServerService=t}return e.prototype.setTitle=function(e,t){document.title=this.getTitle(e,t)},e.prototype.getTitle=function(e,t){var r=this.ServerService.serverName();if(e){var n=this.$translate.instant(e);return t?this.$translate.instant("browserTitle_objectPlace",{OBJECT:t,PLACE:n,SERVER_NAME:r}):this.$translate.instant("browserTitle_place",{PLACE:n,SERVER_NAME:r})}return r},e.prototype.setVizTitle=function(e,t){var r=this.ServerService.serverName();document.title=this.$translate.instant("browserTitle_viz",{VIEW:e,WORKBOOK:t,SERVER_NAME:r})},e.$inject=["$translate","ServerService"],e}();e.BrowserTitleService=t,e.Module.instance().service("BrowserTitleService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){!function(e){e[e.None=0]="None",e[e.CallingUserInsufficientPermissions=1]="CallingUserInsufficientPermissions",e[e.SiteUserNotFound=4]="SiteUserNotFound",e[e.SystemUserNotFound=5]="SystemUserNotFound",e[e.GroupNotFound=6]="GroupNotFound",e[e.WorkbookNotFound=7]="WorkbookNotFound",e[e.ViewNotFound=8]="ViewNotFound",e[e.ProjectNotFound=9]="ProjectNotFound",e[e.DataConnectionNotFound=10]="DataConnectionNotFound",e[e.DatasourceNotFound=11]="DatasourceNotFound",e[e.SiteNotFound=12]="SiteNotFound",e[e.EncryptionTokenNotFound=13]="EncryptionTokenNotFound",e[e.FileUploadNotFound=14]="FileUploadNotFound",e[e.AdGroupNotFound=15]="AdGroupNotFound",e[e.UnexpectedErrorOccurred=17]="UnexpectedErrorOccurred",e[e.InvalidNumberOrderClauses=18]="InvalidNumberOrderClauses",e[e.InvalidPageSize=19]="InvalidPageSize",e[e.InvalidStartIndex=20]="InvalidStartIndex",e[e.InvalidNumberFilterClauses=21]="InvalidNumberFilterClauses",e[e.InvalidSortClauseFieldName=22]="InvalidSortClauseFieldName",e[e.InProgress=23]="InProgress",e[e.UnexpectedNullOrEmptyParameter=24]="UnexpectedNullOrEmptyParameter",e[e.UnexpectedParameterValue=25]="UnexpectedParameterValue",e[e.DomainNotFound=26]="DomainNotFound",e[e.CommentNotFound=27]="CommentNotFound",e[e.AsyncJobNotFound=28]="AsyncJobNotFound",e[e.SubscriptionNotFound=29]="SubscriptionNotFound",e[e.ADUserNotFound=30]="ADUserNotFound",e[e.InvalidSession=46]="InvalidSession",e[e.UnlicensedServer=50]="UnlicensedServer",e[e.InsecureSAMLEndpoint=53]="InsecureSAMLEndpoint",e[e.RedirectToOtherPod=55]="RedirectToOtherPod",e[e.SiteSAMLUserCannotAddTableauIDUser=64]="SiteSAMLUserCannotAddTableauIDUser",e[e.FeatureNotEnabled=67]="FeatureNotEnabled",e[e.FileSizeTooLarge=68]="FileSizeTooLarge"}(e.CommonErrorCode||(e.CommonErrorCode={}));e.CommonErrorCode;!function(e){e[e.AlertUnknownFailure=1e3]="AlertUnknownFailure",e[e.AlertRemoteUnknownFailure=1001]="AlertRemoteUnknownFailure",e[e.AlertSignInFailed=2e3]="AlertSignInFailed",e[e.AlertRemoteSignInFailed=2001]="AlertRemoteSignInFailed",e[e.AlertExpiredPassword=2100]="AlertExpiredPassword",e[e.AlertRemoteExpiredPassword=2101]="AlertRemoteExpiredPassword",e[e.AlertAccessTokenValidation=2200]="AlertAccessTokenValidation",e[e.AlertAuthConfiguration=2300]="AlertAuthConfiguration",e[e.AlertConnectionFailure=3e3]="AlertConnectionFailure",e[e.AlertRemoteConnectionFailure=3001]="AlertRemoteConnectionFailure",e[e.AlertOverlappingSchedules=4e3]="AlertOverlappingSchedules",e[e.AlertFullRefreshRequired=5e3]="AlertFullRefreshRequired",e[e.AlertConnectionlessFailure=1e4]="AlertConnectionlessFailure"}(e.AlertErrorCode||(e.AlertErrorCode={}));e.AlertErrorCode;!function(e){e[e.DataConnectionNullOrEmptyDataConnectionIds=6e4]="DataConnectionNullOrEmptyDataConnectionIds",e[e.UpdateConnectionsInvalidPort=60005]="UpdateConnectionsInvalidPort"}(e.DataConnectionErrorCode||(e.DataConnectionErrorCode={}));e.DataConnectionErrorCode;!function(e){e[e.DatasourceDescriptionGreaterThanMaxLength=5e4]="DatasourceDescriptionGreaterThanMaxLength",e[e.DatasourceMoveInsufficientPermissionsOnDestinationProject=50001]="DatasourceMoveInsufficientPermissionsOnDestinationProject",e[e.DatasourceMoveInsufficientPermissionsOnSourceProject=50002]="DatasourceMoveInsufficientPermissionsOnSourceProject",e[e.DatasourceMoveInsufficientPermissionsOnDatasource=50003]="DatasourceMoveInsufficientPermissionsOnDatasource",e[e.DatasourceWithSameNameInDestinationProject=50004]="DatasourceWithSameNameInDestinationProject",e[e.DatasourceNullOrEmptyProjectIds=50005]="DatasourceNullOrEmptyProjectIds",e[e.DatasourceNullOrEmptyUserIds=50006]="DatasourceNullOrEmptyUserIds",e[e.DatasourceNullOrEmptyDatasourceIds=50007]="DatasourceNullOrEmptyDatasourceIds",e[e.DatasourceNullOrEmptyWorkbookIds=50008]="DatasourceNullOrEmptyWorkbookIds",e[e.DatasourceChangeOwnerDisabled=50009]="DatasourceChangeOwnerDisabled",e[e.DatasourceChangeOwnerToGuest=50010]="DatasourceChangeOwnerToGuest"}(e.DatasourceErrorCode||(e.DatasourceErrorCode={}));e.DatasourceErrorCode;!function(e){e[e.UnifiedDatasourceNullOrEmptyDatasourceIds=16e4]="UnifiedDatasourceNullOrEmptyDatasourceIds",e[e.OperationOnlySupportedForPublishedDatasource=160001]="OperationOnlySupportedForPublishedDatasource"}(e.UnifiedDatasourceErrorCode||(e.UnifiedDatasourceErrorCode={}));e.UnifiedDatasourceErrorCode;!function(e){e[e.BadCredentials=16]="BadCredentials",e[e.SspiFailed=42]="SspiFailed",e[e.KerberosFailed=43]="KerberosFailed",e[e.ClientCertificateNotFound=59]="ClientCertificateNotFound",e[e.ClientCertificateUserNotFoundInCertificate=60]="ClientCertificateUserNotFoundInCertificate",e[e.ClientCertificateUserNotFoundOnServer=61]="ClientCertificateUserNotFoundOnServer",e[e.OpenIdFailed=69]="OpenIdFailed"}(e.LoginErrorCodes||(e.LoginErrorCodes={}));e.LoginErrorCodes;!function(e){e[e.ProjectNullOrEmptyProjectIds=3e4]="ProjectNullOrEmptyProjectIds",e[e.ProjectNullOrEmptyUserIds=30001]="ProjectNullOrEmptyUserIds",e[e.ProjectNameAlreadyExists=30002]="ProjectNameAlreadyExists",e[e.ProjectNameTooLong=30003]="ProjectNameTooLong",e[e.ProjectDescriptionGreaterThanMaxLength=30004]="ProjectDescriptionGreaterThanMaxLength",e[e.ProjectChangeOwnerDisabled=30005]="ProjectChangeOwnerDisabled",e[e.ProjectDefaultAlreadyExists=30006]="ProjectDefaultAlreadyExists",e[e.ProjectNameEmpty=30007]="ProjectNameEmpty",e[e.DeletingDefaultProject=30010]="DeletingDefaultProject",e[e.DefaultProjectCannotBeRenamed=30011]="DefaultProjectCannotBeRenamed",e[e.TargetUserInsufficientPermissions=30012]="TargetUserInsufficientPermissions"}(e.ProjectErrorCode||(e.ProjectErrorCode={}));e.ProjectErrorCode;!function(e){e[e.TagNameTooLong=11e4]="TagNameTooLong"}(e.TagErrorCode||(e.TagErrorCode={}));e.TagErrorCode;!function(e){e[e.WorkbookDisabled=4e4]="WorkbookDisabled",e[e.WorkbookDestinationProjectNotFound=40001]="WorkbookDestinationProjectNotFound",e[e.WorkbookMoveInsufficientPermissionsOnDestinationProject=40002]="WorkbookMoveInsufficientPermissionsOnDestinationProject",e[e.WorkbookMoveInsufficientPermissionsOnSourceProject=40003]="WorkbookMoveInsufficientPermissionsOnSourceProject",e[e.WorkbookMoveInsufficientPermissionsOnWorkbook=40004]="WorkbookMoveInsufficientPermissionsOnWorkbook",e[e.WorkbookNameAlreadyExistsInDestinationProject=40005]="WorkbookNameAlreadyExistsInDestinationProject",e[e.WorkbookDescriptionTooLong=40006]="WorkbookDescriptionTooLong",e[e.WorkbookInvalidViewPath=40007]="WorkbookInvalidViewPath",e[e.WorkbookNullOrEmptyWorkbookIds=40008]="WorkbookNullOrEmptyWorkbookIds",e[e.WorkbookNullOrEmptyViewIds=40009]="WorkbookNullOrEmptyViewIds",e[e.WorkbookNullOrEmptyUserIds=40010]="WorkbookNullOrEmptyUserIds"}(e.WorkbookErrorCode||(e.WorkbookErrorCode={}));e.WorkbookErrorCode;!function(e){e[e.UserNotMemberOfSiteOrSiteNotExist=16]="UserNotMemberOfSiteOrSiteNotExist",e[e.UserUnlicensedForSite=10028]="UserUnlicensedForSite",e[e.SiteSuspended=10029]="SiteSuspended",e[e.SiteLocked=10030]="SiteLocked",e[e.AttemptedToSwitchSiteToCurrentSite=10056]="AttemptedToSwitchSiteToCurrentSite"}(e.SiteSwitchErrorCodes||(e.SiteSwitchErrorCodes={}));e.SiteSwitchErrorCodes;!function(e){e[e.SiteNotFound=12]="SiteNotFound",e[e.SiteNameIsEmptyOrNull=7e4]="SiteNameIsEmptyOrNull",e[e.SiteAdminCannotAddUsersButUserQuotaIsSet=70001]="SiteAdminCannotAddUsersButUserQuotaIsSet",e[e.InvalidUserQuotaOrStorageQuota=70002]="InvalidUserQuotaOrStorageQuota",e[e.UserQuotaGreaterThanServerLicenseLimit=70003]="UserQuotaGreaterThanServerLicenseLimit",e[e.InvalidCustomEmailAddress=70004]="InvalidCustomEmailAddress",e[e.SiteNameOrUrlNameAlreadyExists=70005]="SiteNameOrUrlNameAlreadyExists",e[e.SiteIdsAreNullOrEmpty=70006]="SiteIdsAreNullOrEmpty",e[e.SiteSubscriptionsSetWithDisabledServerSubscriptions=70007]="SiteSubscriptionsSetWithDisabledServerSubscriptions",e[e.AttemptedToUpdateDefaultSiteUrlName=70008]="AttemptedToUpdateDefaultSiteUrlName",e[e.AttemptedToSuspendDefaultSite=70009]="AttemptedToSuspendDefaultSite",e[e.SiteNameTooLong=70010]="SiteNameTooLong",e[e.SiteUrlNameTooLong=70011]="SiteUrlNameTooLong",e[e.AttemptedToDeleteDefaultSite=70012]="AttemptedToDeleteDefaultSite",e[e.StorageQuotaLessThanStorageUsed=70013]="StorageQuotaLessThanStorageUsed"}(e.SiteSettingsErrorCode||(e.SiteSettingsErrorCode={}));e.SiteSettingsErrorCode;!function(e){e[e.NotAnInteger=8e4]="NotAnInteger",e[e.NotASiterole=80001]="NotASiterole",e[e.InvalidStartIndex=80002]="InvalidStartIndex",e[e.InvalidMaxItems=80003]="InvalidMaxItems",e[e.MutuallyExclusiveParametersPresent=80004]="MutuallyExclusiveParametersPresent",e[e.SiteSubscriptionSettingsMissing=80005]="SiteSubscriptionSettingsMissing",e[e.NotAScheduledAction=80006]="NotAScheduledAction",e[e.NotAScheduleType=80007]="NotAScheduleType",e[e.NotADayOfMonth=80008]="NotADayOfMonth",e[e.NotADayOfWeek=80009]="NotADayOfWeek",e[e.NotATaskType=80010]="NotATaskType",e[e.NotATargetType=80011]="NotATargetType",e[e.TaskTypeIncrementExtractNotAllowed=80012]="TaskTypeIncrementExtractNotAllowed",e[e.TaskTypeRefreshExtractNotAllowed=80013]="TaskTypeRefreshExtractNotAllowed",e[e.UnableToDeleteUserWhoOwnsContent=80014]="UnableToDeleteUserWhoOwnsContent"}(e.WebClientErrorCode||(e.WebClientErrorCode={}));e.WebClientErrorCode;!function(e){e[e.SchedulingNullOrEmptyScheduleIds=12e4]="SchedulingNullOrEmptyScheduleIds",e[e.SchedulingScheduleNotFound=120001]="SchedulingScheduleNotFound",e[e.SchedulingTaskNotFound=120002]="SchedulingTaskNotFound",e[e.SchedulingNameEmpty=120003]="SchedulingNameEmpty",e[e.SchedulingNameTooLong=120004]="SchedulingNameTooLong",e[e.SchedulingNameAlreadyExists=120005]="SchedulingNameAlreadyExists",e[e.SchedulingStartTimeValueInvalid=120006]="SchedulingStartTimeValueInvalid",e[e.SchedulingEndTimeValueInvalid=120007]="SchedulingEndTimeValueInvalid",e[e.SchedulingRecurrenceMinutesValueInvalid=120008]="SchedulingRecurrenceMinutesValueInvalid",e[e.SchedulingRecurrenceDaysOfWeekValueMissing=120009]="SchedulingRecurrenceDaysOfWeekValueMissing",e[e.SchedulingRecurrenceDayOfMonthValueMissing=120010]="SchedulingRecurrenceDayOfMonthValueMissing",e[e.SchedulingPriorityValueInvalid=120011]="SchedulingPriorityValueInvalid",e[e.SchedulingExtractTaskExistsForTarget=120012]="SchedulingExtractTaskExistsForTarget"}(e.SchedulingErrorCode||(e.SchedulingErrorCode={}));e.SchedulingErrorCode;!function(e){e[e.UntrustedMachine=80015]="UntrustedMachine",e[e.ReadyToInitialize=80018]="ReadyToInitialize"}(e.UninitializedServerErrorCode||(e.UninitializedServerErrorCode={}));e.UninitializedServerErrorCode;!function(e){e[e.UserNotSupportedAdminOperation=9e4]="UserNotSupportedAdminOperation",e[e.UserInvalidSiteRole=90001]="UserInvalidSiteRole",e[e.ADNotConfigured=90002]="ADNotConfigured",e[e.ADDomainInvalid=90003]="ADDomainInvalid",e[e.InvalidPageNumber=90004]="InvalidPageNumber",e[e.InvalidRequestPayload=90005]="InvalidRequestPayload",e[e.AmbiguousWorkbookPublishSource=90006]="AmbiguousWorkbookPublishSource",e[e.InvalidWorkbookFile=90007]="InvalidWorkbookFile",e[e.InvalidOverwriteParameter=90008]="InvalidOverwriteParameter",e[e.InvalidPageSize=90009]="InvalidPageSize",e[e.GroupUserExists=90010]="GroupUserExists",e[e.GroupUserNotFound=90011]="GroupUserNotFound",e[e.CannotModifyADGroupName=90012]="CannotModifyADGroupName",e[e.GroupAlreadyExists=90013]="GroupAlreadyExists",e[e.InvalidEmbedParameter=90014]="InvalidEmbedParameter",e[e.InvalidDatasourceFile=90015]="InvalidDatasourceFile",e[e.MismatchADGroupDomainNameOnSync=90016]="MismatchADGroupDomainNameOnSync",e[e.InsufficientProject_permissions=90017]="InsufficientProject_permissions",e[e.InvalidShowTabsParameter=90018]="InvalidShowTabsParameter",e[e.WorkbookChangeOwnerInsufficientPermissions=90019]="WorkbookChangeOwnerInsufficientPermissions",e[e.WorkbookChangeDisplayTabsInsufficientPermissions=90020]="WorkbookChangeDisplayTabsInsufficientPermissions",e[e.InvalidOAuthParameter=90021]="InvalidOAuthParameter"}(e.RestApiErrorCode||(e.RestApiErrorCode={}));e.RestApiErrorCode;!function(e){e[e.UserGroupInvalidName=10001]="UserGroupInvalidName",e[e.UserDomainInvalidName=10002]="UserDomainInvalidName",e[e.UserGroupWithNameAlreadyExists=10003]="UserGroupWithNameAlreadyExists",e[e.UserCsvParamNotText=10004]="UserCsvParamNotText",e[e.UserCsvParamerterTooLong=10005]="UserCsvParamerterTooLong",e[e.UserCannotSetAdminStatusForSystemAdmin=10006]="UserCannotSetAdminStatusForSystemAdmin",e[e.UserCannotRenameSystemGroup=10007]="UserCannotRenameSystemGroup",e[e.UserCannotRenameNonLocalGroup=10008]="UserCannotRenameNonLocalGroup",e[e.UserInsufficientLicenses=10009]="UserInsufficientLicenses",e[e.UserCannotUnlicenseAdmin=10010]="UserCannotUnlicenseAdmin",e[e.UserInvalidEmailAddress=10011]="UserInvalidEmailAddress",e[e.UserSystemUserWithEmailAddressAlreadyExists=10012]="UserSystemUserWithEmailAddressAlreadyExists",e[e.UserOverlappedGroupidInUpdate=10013]="UserOverlappedGroupidInUpdate",e[e.UserAllUsersGroupAlreadyExists=10014]="UserAllUsersGroupAlreadyExists",e[e.UserGuestAlreadyExists=10015]="UserGuestAlreadyExists",e[e.UserCannotAutocreateUser=10016]="UserCannotAutocreateUser",e[e.UserInvalidPassword=10017]="UserInvalidPassword",e[e.UserCannotUpdatePassword=10018]="UserCannotUpdatePassword",e[e.UserCannotUpdateFriendlyName=10019]="UserCannotUpdateFriendlyName",e[e.UserInvalidUserName=10020]="UserInvalidUserName",e[e.UserAlreadyExists=10021]="UserAlreadyExists",e[e.UserOverlappedSiteidInUpdate=10022]="UserOverlappedSiteidInUpdate",e[e.UserNotSupportedGuestOperation=10023]="UserNotSupportedGuestOperation",e[e.UserNotSupportedAdminOperation=10024]="UserNotSupportedAdminOperation",e[e.UserNotSupportedSelfOperation=10025]="UserNotSupportedSelfOperation",e[e.UserInvalidFriendlyName=10026]="UserInvalidFriendlyName",e[e.UserInvalidSiteRole=10027]="UserInvalidSiteRole",e[e.UserLoginFailedUnlicensedOnSite=10028]="UserLoginFailedUnlicensedOnSite",e[e.UserLoginFailedSuspendedSite=10029]="UserLoginFailedSuspendedSite",e[e.UserLoginFailedLockedSite=10030]="UserLoginFailedLockedSite",e[e.UserGuestLoginFailed=10031]="UserGuestLoginFailed",e[e.UserMissingPasswordParameters=10032]="UserMissingPasswordParameters",e[e.UserCannotFavoriteType=10033]="UserCannotFavoriteType",e[e.UserCannotDeleteSystemUserWithAssociatedUsers=10040]="UserCannotDeleteSystemUserWithAssociatedUsers",e[e.UserCsvMissingUsername=10050]="UserCsvMissingUsername",e[e.UserCsvInvalidAdminLevel=10051]="UserCsvInvalidAdminLevel",e[e.UserCsvInvalidLicense=10052]="UserCsvInvalidLicense",e[e.UserCsvInvalidPublisher=10053]="UserCsvInvalidPublisher",e[e.UserCsvMissingPassword=10054]="UserCsvMissingPassword",e[e.UserCsvPasswordMismatch=10055]="UserCsvPasswordMismatch",e[e.UserTriedSwitchSiteToCurrentSite=10056]="UserTriedSwitchSiteToCurrentSite",e[e.UserInsufficientSiteQuota=10057]="UserInsufficientSiteQuota",e[e.UserCannotUpdateMinimumSiteRoleNonAdGroup=10058]="UserCannotUpdateMinimumSiteRoleNonAdGroup",e[e.UserOpenIdBadConfig=10059]="UserOpenIdBadConfig",e[e.UserOpenIdIdpNotReachable=10060]="UserOpenIdIdpNotReachable",e[e.UserOpenIdUserNotFound=10061]="UserOpenIdUserNotFound",e[e.UserOpenIdConflictingUserAccount=10062]="UserOpenIdConflictingUserAccount"}(e.UserErrorCode||(e.UserErrorCode={}));e.UserErrorCode;!function(e){e[e.GroupNullOrEmptyName=2e4]="GroupNullOrEmptyName",e[e.GroupAmbiguousNameSearch=20001]="GroupAmbiguousNameSearch",e[e.GroupCannotBeDeleted=20002]="GroupCannotBeDeleted",e[e.InvalidGroupMembershipUpdate=20003]="InvalidGroupMembershipUpdate"}(e.GroupErrorCode||(e.GroupErrorCode={}));e.GroupErrorCode;!function(e){e[e.LdapOperationsError=100001]="LdapOperationsError",e[e.LdapProtocolError=100002]="LdapProtocolError",e[e.LdapTimelimitExceeded=100003]="LdapTimelimitExceeded",e[e.LdapSizelimitExceeded=100004]="LdapSizelimitExceeded",e[e.LdapCompareFalse=100005]="LdapCompareFalse",e[e.LdapCompareTrue=100006]="LdapCompareTrue",e[e.LdapAuthMethodNotSupported=100007]="LdapAuthMethodNotSupported",e[e.LdapStrongAuthRequired=100008]="LdapStrongAuthRequired",e[e.LdapPartialResults=100009]="LdapPartialResults",e[e.LdapReferral=100010]="LdapReferral",e[e.LdapAdminLimitExceeded=100011]="LdapAdminLimitExceeded",e[e.LdapUnavailableCritExtension=100012]="LdapUnavailableCritExtension",e[e.LdapConfidentialityRequired=100013]="LdapConfidentialityRequired",e[e.LdapSaslBindInProgress=100014]="LdapSaslBindInProgress",e[e.LdapReferralV2=100015]="LdapReferralV2",e[e.LdapNoSuchAttribute=100016]="LdapNoSuchAttribute",e[e.LdapUndefinedType=100017]="LdapUndefinedType",e[e.LdapInappropriateMatching=100018]="LdapInappropriateMatching",e[e.LdapConstraintViolation=100019]="LdapConstraintViolation",e[e.LdapAttributeOrValueExists=100020]="LdapAttributeOrValueExists",e[e.LdapInvalidSyntax=100021]="LdapInvalidSyntax",e[e.LdapNoSuchObject=100032]="LdapNoSuchObject",e[e.LdapAliasProblem=100033]="LdapAliasProblem",e[e.LdapInvalidDnSyntax=100034]="LdapInvalidDnSyntax",e[e.LdapIsLeaf=100035]="LdapIsLeaf",e[e.LdapAliasDerefProblem=100036]="LdapAliasDerefProblem",e[e.LdapInappropriateAuth=100048]="LdapInappropriateAuth",e[e.LdapInvalidCredentials=100049]="LdapInvalidCredentials",e[e.LdapInsufficientRights=100050]="LdapInsufficientRights",e[e.LdapBusy=100051]="LdapBusy",e[e.LdapUnavailable=100052]="LdapUnavailable",e[e.LdapUnwillingToPerform=100053]="LdapUnwillingToPerform",e[e.LdapLoopDetect=100054]="LdapLoopDetect",e[e.LdapSortControlMissing=100060]="LdapSortControlMissing",e[e.LdapOffsetRangeError=100061]="LdapOffsetRangeError",e[e.LdapNamingViolation=100064]="LdapNamingViolation",e[e.LdapObjectClassViolation=100065]="LdapObjectClassViolation",e[e.LdapNotAllowedOnNonleaf=100066]="LdapNotAllowedOnNonleaf",e[e.LdapNotAllowedOnRdn=100067]="LdapNotAllowedOnRdn",e[e.LdapAlreadyExists=100068]="LdapAlreadyExists",e[e.LdapNoObjectClassMods=100069]="LdapNoObjectClassMods",e[e.LdapResultsTooLarge=100070]="LdapResultsTooLarge",e[e.LdapAffectsMultipleDsas=100071]="LdapAffectsMultipleDsas",e[e.LdapVirtualListViewError=100076]="LdapVirtualListViewError",e[e.LdapOther=100080]="LdapOther",e[e.LdapServerDown=100081]="LdapServerDown",e[e.LdapLocalError=100082]="LdapLocalError",e[e.LdapEncodingError=100083]="LdapEncodingError",e[e.LdapDecodingError=100084]="LdapDecodingError",e[e.LdapTimeout=100085]="LdapTimeout",e[e.LdapAuthUnknown=100086]="LdapAuthUnknown",e[e.LdapFilterError=100087]="LdapFilterError",e[e.LdapUserCancelled=100088]="LdapUserCancelled",e[e.LdapParamError=100089]="LdapParamError",e[e.LdapNoMemory=100090]="LdapNoMemory",e[e.LdapConnectError=100091]="LdapConnectError",e[e.LdapNotSupported=100092]="LdapNotSupported",e[e.LdapNoResultsReturned=100094]="LdapNoResultsReturned",e[e.LdapControlNotFound=100093]="LdapControlNotFound",e[e.LdapMoreResultsToReturn=100095]="LdapMoreResultsToReturn",e[e.LdapClientLoop=100096]="LdapClientLoop",e[e.LdapReferralLimitExceeded=100097]="LdapReferralLimitExceeded",e[e.NotUniqueUserSearch=101e3]="NotUniqueUserSearch",e[e.NotUniqueGroupSearch=101001]="NotUniqueGroupSearch",e[e.UserNotFound=101002]="UserNotFound",e[e.GroupNotFound=101003]="GroupNotFound",e[e.NullOrEmptySearch=101004]="NullOrEmptySearch",e[e.UnknownObject=101005]="UnknownObject",e[e.UnknownSidType=101006]="UnknownSidType",e[e.UnknownNativeError=101007]="UnknownNativeError"}(e.LdapErrorCode||(e.LdapErrorCode={}));e.LdapErrorCode;!function(e){e[e.SolrCommunicationError=2e5]="SolrCommunicationError",e[e.SolrDisabled=200001]="SolrDisabled",e[e.SolrIndexingFailed=200002]="SolrIndexingFailed"}(e.SolrErrorCode||(e.SolrErrorCode={}));e.SolrErrorCode;!function(e){e[e.InvalidImage=25e4]="InvalidImage",e[e.ImageProcessingError=250001]="ImageProcessingError",e[e.StorageException=250010]="StorageException",e[e.SiteCustomizationUnavailable=250011]="SiteCustomizationUnavailable"}(e.OnlineErrorCode||(e.OnlineErrorCode={}));e.OnlineErrorCode}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){e.SiteKeys={id:"id"}}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i,o){this.ConfirmActionDialog=e,this.$translate=t,this.toaster=r,this.server=n,this.Sites=i,this.$q=o}return t.prototype.execute=function(t){var r=this;return this.getPlaceholderSiteSettings().then(function(n){var i=t.$new(!0),o={id:void 0,siteAdminSettings:{liveDBConnectionsWhitelistEnabled:!1,refreshTokenEnabled:!0}};return i.siteSettingsForServerAdmin=n,i.siteSettingsForSiteAdmin=o,i.isDefaultSite=!1,i.hideNameAndId=!1,i.hideAvailability=!0,i.autoSelectSiteName=!0,i.liveDBAvailable=r.server.isLiveDBAvailable(),i.siteSettingsForServerAdminFormState={},r.ConfirmActionDialog.open({scope:i,title:r.$translate.instant("newSiteDialogTitle"),bodyTemplateUrl:"siteDialog.html",actionName:r.$translate.instant("newSiteDialogSubmit"),confirmDisabled:function(){return _.isEmpty(i.siteSettingsForServerAdminFormState)||!i.siteSettingsForServerAdminFormState.isValid()},action:function(){return r.Sites.createSite(i.siteSettingsForServerAdmin.settings,i.siteSettingsForSiteAdmin.siteAdminSettings,i.siteSettingsForServerAdmin.subscriptionSettings).then(function(){r.toaster.pop({type:e.ToastType.Info,text:r.$translate.instant("siteCreateSuccess",{SITE_NAME:e.L10n.elideIfLong(i.siteSettingsForServerAdmin.settings.name)})}),r.server.refreshSessionInfo()},function(e){return r.errorMessages(e,i.siteSettingsForServerAdmin),r.$q.reject()})},size:e.ModalSize.fitToContent}).result.fin(function(){return i.$destroy()})})},t.prototype.isServerLevelSubscriptionsEnabled=function(){return this.Sites.getCurrentSiteSettingsForServerAdmin().then(function(e){return!_.isUndefined(e.subscriptionSettings)})},t.prototype.errorMessages=function(t,r){var n=this;_.each(t,function(t){n.toaster.pop({type:e.ToastType.Error,text:n.Sites.errorMessage(t.code,r)})})},t.prototype.getPlaceholderSiteSettings=function(){return this.isServerLevelSubscriptionsEnabled().then(function(t){var r={id:void 0,userCount:1,licensedUserCount:1,adminCount:void 0,availability:e.SiteAvailabilityState.ACTIVE,currentLoggedInUserCount:void 0,storageQuotaPercentUsed:void 0,storageUsedBytes:void 0,createdAt:void 0,settings:{urlName:"",name:"",storageQuotaEnabled:!1,storageQuotaBytes:e.ByteSizeConversionFactor.ONE_GB,siteAdminsCanAddUsers:!0,userQuotaEnabled:!1,userQuota:1,metricsEnabled:!1,authoringEnabled:!0,sheetImageEnabled:!0}};return t&&(r.subscriptionSettings={subscriptionsEnabled:!0,customSubscriptionEmailEnabled:!1,customSubscriptionEmail:"no-reply@tableau.com",customSubscriptionFooterEnabled:!1,customSubscriptionFooter:""}),r})},t.$inject=["ConfirmActionDialog","$translate","ToasterService","ServerService","Sites","$q"],t}();e.CreateSiteAction=t,e.Module.instance().service("CreateSiteAction",t)}(VizPortal||(VizPortal={}));var VizPortal;
!function(e){var t=function(){function e(e,t,r,n){r.setTitle("serverSettings_addSite"),e.createSite=function(){return n.execute(e).then(function(){return t.go("main.server.sites.sites")})}}return e.$inject=["$scope","$state","BrowserTitleService","CreateSiteAction"],e}();e.AddSiteCtrl=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e,t,r,n,i){this.$state=e,this.$location=t,this.WindowLocationService=r,this.server=n,this.BrowserSupportService=i}return e.prototype.reloadOnLocationChange=function(e){var t=this;this.$state.current.reloadOnSearch=!0,e.$on("$locationChangeSuccess",function(){if(t.$state.current.reloadOnSearch){var e=t.$state.$current.url,r=e.exec(t.$location.path(),t.$location.search());r&&t.$state.transitionTo(t.$state.current.name,r,{location:!1,reload:!0})}})},e.prototype.updatePath=function(e,t){var r=_.extend(t,{siteUrlName:this.server.sessionSiteUrlName()}),n=this.$state.href(this.$state.current,r);n=n.replace(/^#/,""),n=decodeURIComponent(n),n!==this.$location.path()&&(this.dontReloadNextLocationChange(e),this.$location.replace().path(n))},e.prototype.updateInstanceId=function(t,r){this.dontReloadNextLocationChange(t),this.$location.replace().search(e.InstanceIdKey,r)},e.prototype.updateExplicitOriginalViz=function(t,r){this.dontReloadNextLocationChange(t),this.$location.replace().search(e.ExplicitOriginalVizParamKey,r?"y":null)},e.prototype.getIsExplicitOriginalViz=function(){return Helpers.BooleanQueryParamRegex.test(this.getExplicitLocationSearchValue(e.ExplicitOriginalVizParamKey))},e.prototype.getInstanceId=function(){return this.getExplicitLocationSearchValue(e.InstanceIdKey)},e.prototype.getExplicitLocationSearchValue=function(e){var t=this.$location.search()[e];return _.isString(t)?t:null},e.prototype.getVizParams=function(){return _.omit(this.$location.search(),e.InstanceIdKey)},e.prototype.getIsExplicitOriginalVizFromUrl=function(e){var t=decodeURIComponent(e).match(/[&\?]:original_view=([^&#$]+)/);return!!(t&&t[1]&&Helpers.BooleanQueryParamRegex.test(t[1]))},e.prototype.getPath=function(e){var t=e.match(/[^/]\/views\/([^?#]*)/);return t&&t[1]||null},e.prototype.getUri=function(e){var t=[this.WindowLocationService.getOrigin()];return e.isAdminViz?t=t.concat(["vizql","showadminview"]):(e.siteUrlName&&(t=t.concat(["t",e.siteUrlName])),t.push("views")),t.push(e.path),t.join("/")},e.prototype.isEmbedParamOn=function(){return Helpers.BooleanQueryParamRegex.test(this.getExplicitLocationSearchValue(e.EmbedParamKey))},e.prototype.pathHasExportableFileType=function(){return e.VizExportFileTypeRegex.test(this.$location.path())},e.prototype.getEmbeddedVizqlUrl=function(t){return void 0===t&&(t={}),t.isFromGuest&&this.$location.search(e.IsGuestRedirectFromVizPortalParamKey,"y"),this.isEmbedParamOn()||this.$location.search(e.EmbedParamKey,"y"),this.getVizqlUrl()},e.prototype.getVizqlUrl=function(){return this.$location.url().replace(/^\/site/,"/t")},e.prototype.dontReloadNextLocationChange=function(e){var t=this,r=e.$on("$locationChangeSuccess",function(){t.$state.current.reloadOnSearch=!0,r()});this.$state.current.reloadOnSearch=!1},e.$inject=["$state","$location","WindowLocationService","ServerService","BrowserSupportService"],e.ExplicitOriginalVizParamKey=":original_view",e.EmbedParamKey=":embed",e.InstanceIdKey=":iid",e.IsGuestRedirectFromVizPortalParamKey=":isGuestRedirectFromVizportal",e.VizExportFileTypeRegex=/\.(pdf|csv|png)$/,e}();e.VizService=t,e.Module.instance().service("VizService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(t,r,n,i,o,s,a,c){var l=this;this.sheetUrlId=r.sheetUrlId,t.viz={path:c+"/"+this.sheetUrlId,isAdminViz:!0,params:n.search()},a.reloadOnLocationChange(t),t.$watch("viz.path",function(e){l.sheetUrlId=e.split("/")[1],a.updatePath(t,{sheetUrlId:l.sheetUrlId}),s.setVizTitle(t.viewName(),o.instant(t.isServerAnalysis()?"serverStatus":"siteStatus"))}),t.isServerAnalysis=function(){return i.includes("**.server.**")},t.viewName=function(){return o.instant(e.ViewNameLocKeyDict[l.sheetUrlId])}}return e.ViewNameLocKeyDict={ActionsbyAllUsers:"actionsByAllUsersTitle",ActionsbySpecificUser:"actionsByASpecificUserTitle",ActionsbyRecentUsers:"actionsByRecentlySignedInUsersTitle",BackgroundTasksforExtracts:"backgroundTasksExtractsTitle",BackgroundTasksforNonExtracts:"backgroundTasksNonExtractsTitle",StatsforLoadTimes:"statsLoadTimesTitle",StatsforSpaceUsage:"statsSpaceUsageTitle",TraffictoDataSources:"trafficToDataSourcesTitle",TraffictoViews:"trafficToViewsTitle"},e.$inject=["$scope","$stateParams","$location","$state","$translate","BrowserTitleService","VizService","workbookUrlId"],e}();e.AdminVizViewerCtrl=t,e.Module.instance().controller("AdminVizViewerCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e){this.$http=e}return e.prototype.authenticate=function(e,t){return this.$http({method:"POST",url:e,headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},data:$.param(t)})},e.$inject=["$http","$window","WindowLocationService"],e}();e.ConnectionAuthService=t,e.Module.instance().service("ConnectionAuthService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e){this.$window=e}return e.prototype.download=function(e){this.navigateTo(e)},e.prototype.formatWindowOpenSpecs=function(e){return _.map(e,function(e,t){return t+"="+e}).join(",")},e.prototype.open=function(e,t,r){return void 0===t&&(t="_blank"),this.$window.open(e,t,this.formatWindowOpenSpecs(r))},e.prototype.navigateTo=function(e){this.$window.location.href=e},e.prototype.navigateIFrameTo=function(e,t){e.contentWindow.location.href=t},e.prototype.navigateToWithoutAddingToHistory=function(e){this.$window.location.replace(e)},e.prototype.getOrigin=function(){return this.$window.location.protocol+"//"+this.$window.location.host},e.prototype.getPathQueryFragment=function(){return this.$window.location.href.split(this.$window.location.host)[1]},e.prototype.getPathQuery=function(){return this.getPathQueryFragment().replace(this.$window.location.hash,"")},e.prototype.setPathQueryFragment=function(e){this.$window.location.href=this.getOrigin()+(/^\//.test(e)?"":"/")+e},e.prototype.reload=function(){this.$window.location.reload()},e.$inject=["$window"],e}();e.WindowLocationService=t,e.Module.instance().service("WindowLocationService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r){this.$location=e,this.$stateParams=t,this.$window=r}return t.prototype.safelyCallFunction=function(e){try{e()}catch(t){console.error(t)}},t.prototype.maybeNotifyAndClose=function(){var t=Helpers.BooleanQueryParamRegex.test(this.$location.search()[e.UrlParamKeys.ClosePopupWhenDone]),r=this.$window.opener;return r&&t?(r.tableauPopupComplete&&this.safelyCallFunction(function(){return r.tableauPopupComplete()}),r.tab&&r.tab.LogOnView&&this.safelyCallFunction(function(){return r.tab.LogOnView.fireLogOnComplete()}),this.$window.close(),!0):void 0},t.$inject=["$location","$stateParams","$window"],t}();e.WindowPopupService=t,e.Module.instance().service("WindowPopupService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e,t,r,n,i,o){var s=this;this.$scope=e,this.$stateParams=t,this.connectionAuthService=r,this.windowLocationService=n,this.authInfo=i,this.windowPopupService=o,e.authVM={},e.authVM.username=i.defaultUsername,e.focusOnPassword=!!i.defaultUsername,e.doneWithWindow=!1,e.rememberPasswordsForever=i.rememberPasswordsForever;var a;i.allowedAuthenticationModes&&(1===i.allowedAuthenticationModes.length?a=i.allowedAuthenticationModes[0].modeFriendlyName:i.allowedAuthenticationModes.length>=2&&(e.authModeOptions=i.allowedAuthenticationModes)),e.authVM.selectedAuthMode=i.authenticationMode,e.connectionProperties=[];var c=e.connectionProperties;i.connectionType&&c.push({translate:"authConnectionConnectionType",value:i.connectionTypeDisplayName}),a&&c.push({translate:"authConnectionAuthentication",value:a,tbTestId:"auth-connection-fixed-auth-mode"}),i.databaseServer&&c.push({translate:"authConnectionServer",value:i.databaseServer}),i.databaseName&&c.push({translate:"authConnectionDatabase",value:i.databaseName}),i.databaseSchema&&c.push({translate:"authConnectionSchema",value:i.databaseSchema}),i.databaseFilename&&c.push({translate:"authConnectionFilename",value:i.databaseFilename}),e.attemptAuth=function(){e.busy=!0,r.authenticate(i.actionPath,s.getAuthenticateDatabaseParams()).then(function(){(i.isAuthoringSession||!o.maybeNotifyAndClose())&&n.navigateTo(t.path),e.doneWithWindow=!0,e.busy=!1},function(){e.errorMessageKey="errorUnknown",e.busy=!1})},e.isPreview=Helpers.BooleanQueryParamRegex.test(t.isPreview)}return e.prototype.getAuthenticateDatabaseParams=function(){var e={authentication:this.$scope.authVM.selectedAuthMode,username:this.$scope.authVM.username,crypted:rsa.encrypt(this.$scope.authVM.password,{n:this.authInfo.modulus,e:this.authInfo.exponent}),connection:this.authInfo.connection,path:this.$stateParams.path,oauthrequest:!1};return this.$scope.authVM.rememberPassword&&(this.authInfo.rememberPasswordsForever&&(e.reuse_forever=!0),this.authInfo.rememberPasswordsForever||(e.reuse=!0)),e},e.$inject=["$scope","$stateParams","ConnectionAuthService","WindowLocationService","authInfo","WindowPopupService"],e}();e.AuthenticateConnectionCtrl=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){function t(e){var t=e.split(":");return 2===t.length?{field:t[0],ascending:"asc"===t[1]}:null}function r(e,t){return _.isUndefined(t)?!0:_(t).contains(e)}function n(n,i){var o=[];return _.isString(n)&&_.each(n.split(","),function(n){var s=t(n);s&&r(s.field,i)&&o.length<e.MaxLength&&o.push(s)}),_.isEmpty(o)?null:o}function i(e,t){return e.length>0&&e[0].field===t}function o(e){var t=_.map(e,_.clone);return t.length>0&&(t[0].ascending=!t[0].ascending),t}function s(t,r){var n;return r?(n=_.reject(t,function(e){return e.field===r.field}),n.unshift(r),n.length>e.MaxLength&&(n.length=e.MaxLength)):n=_.clone(t),n}function a(e){return{field:e,ascending:!0}}function c(e){return{field:e,ascending:!1}}function l(e,t){return t?_.reject(e,function(e){return e.field===t}):e}function u(e,t){return _.findWhere(e,{field:t})}function d(e){return _.map(e,p).join(",")}function p(e){return e.field+":"+(e.ascending?"asc":"desc")}e.MaxLength=3,e.fromInput=n,e.startsWithField=i,e.withFirstClauseToggled=o,e.withClausePrepended=s,e.asc=a,e.desc=c,e.withoutField=l,e.findOrderClauseForField=u,e.serialize=d}(t=e.Order||(e.Order={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.OrderKeys={adminCount:"adminCount",authoringEnabled:"authoringEnabled",availability:"availability",connectionTypeDisplayName:"connectionTypeDisplayName",currentLoggedInUserCount:"currentLoggedInUserCount",createdAt:"createdAt",datasourceCount:"datasourceCount",definition:"definition",displayName:"displayName",domainName:"domainName",favoritesTotal:"favoritesTotal",groupCount:"groupCount",hasAlert:"hasAlert",hasExtracts:"hasExtracts",hitsTotal:"hitsTotal",hitsLastDayTotal:"hitsLastDayTotal",hitsLastMonthTotal:"hitsLastMonthTotal",hitsLastTwoWeeksTotal:"hitsLastTwoWeeksTotal",index:"index",lastRefreshedAt:"lastRefreshedAt",lastRunAt:"lastRunAt",lastSentAt:"lastSentAt",lastSignIn:"lastSignIn",liveDBConnectionsWhitelistEnabled:"liveDBConnectionsWhitelistEnabled",maxSiteRole:"maxSiteRole",metricsEnabled:"metricsEnabled",minimumSiteRole:"minimumSiteRole",name:"name",numSheets:"numSheets",ownerName:"ownerName",parentName:"parentName",priority:"priority",projectName:"projectName",refreshType:"refreshType",relevancy:"relevancy",runNextAt:"runNextAt",scheduleName:"scheduleName",siteAdminsCanAddUsers:"siteAdminsCanAddUsers",siteCount:"siteCount",siteName:"siteName",siteRole:"siteRole",size:"size",sheetImageEnabled:"sheetImageEnabled",storageQuotaBytes:"storageQuotaBytes",storageQuotaPercentUsed:"storageQuotaPercentUsed",storageUsedBytes:"storageUsedBytes",subject:"subject",targetName:"targetName",type:"type",updatedAt:"updatedAt",urlName:"urlName",userCount:"userCount",userName:"userName",username:"username",userQuota:"userQuota",versionNumber:"versionNumber",viewCount:"viewCount",workbookCount:"workbookCount",workbookName:"workbookName"}}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.ProjectContentType={name:"project",filterKeys:[e.ContentFiltersKeys.search,e.ContentFiltersKeys.owner,e.ContentFiltersKeys.createdAfter,e.ContentFiltersKeys.createdBefore],orderKeys:[e.OrderKeys.createdAt,e.OrderKeys.datasourceCount,e.OrderKeys.name,e.OrderKeys.ownerName,e.OrderKeys.viewCount,e.OrderKeys.workbookCount],defaultOrder:[e.Order.asc(e.OrderKeys.name)]},e.WorkbookContentType={name:"workbook",filterKeys:[e.ContentFiltersKeys.search,e.ContentFiltersKeys.favorite,e.ContentFiltersKeys.recent,e.ContentFiltersKeys.hasAlert,e.ContentFiltersKeys.project,e.ContentFiltersKeys.owner,e.ContentFiltersKeys.tag,e.ContentFiltersKeys.modifiedAfter,e.ContentFiltersKeys.modifiedBefore],orderKeys:[e.OrderKeys.name,e.OrderKeys.favoritesTotal,e.OrderKeys.hitsTotal,e.OrderKeys.hitsLastDayTotal,e.OrderKeys.hitsLastMonthTotal,e.OrderKeys.hitsLastTwoWeeksTotal,e.OrderKeys.numSheets,e.OrderKeys.ownerName,e.OrderKeys.projectName,e.OrderKeys.size,e.OrderKeys.updatedAt,e.OrderKeys.hasAlert],extraQueryParams:{statFields:[e.OrderKeys.hitsTotal,e.OrderKeys.favoritesTotal,e.OrderKeys.hitsLastTwoWeeksTotal]},defaultOrder:[e.Order.asc(e.OrderKeys.name)]},e.WorkbookRevisionContentType={name:"workbookRevision",filterKeys:[],orderKeys:[e.OrderKeys.versionNumber],defaultOrder:[e.Order.desc(e.OrderKeys.versionNumber)]},e.ViewContentType={name:"view",filterKeys:[e.ContentFiltersKeys.search,e.ContentFiltersKeys.favorite,e.ContentFiltersKeys.recent,e.ContentFiltersKeys.project,e.ContentFiltersKeys.owner,e.ContentFiltersKeys.tag,e.ContentFiltersKeys.modifiedAfter,e.ContentFiltersKeys.modifiedBefore],orderKeys:[e.OrderKeys.index,e.OrderKeys.name,e.OrderKeys.ownerName,e.OrderKeys.projectName,e.OrderKeys.updatedAt,e.OrderKeys.workbookName],defaultOrder:[e.Order.asc(e.OrderKeys.name)]},e.ViewInWorkbookContentType=_.extend({},e.ViewContentType,{defaultOrder:[e.Order.asc(e.OrderKeys.index)]}),e.DatasourceContentType={name:"datasource",filterKeys:[e.ContentFiltersKeys.search,e.ContentFiltersKeys.hasAlert,e.ContentFiltersKeys.project,e.ContentFiltersKeys.owner,e.ContentFiltersKeys.tag,e.ContentFiltersKeys.modifiedAfter,e.ContentFiltersKeys.modifiedBefore,e.ContentFiltersKeys.hasExtracts,e.ContentFiltersKeys.showEmbedded,e.ContentFiltersKeys.connectionType,e.ContentFiltersKeys.serverName,e.ContentFiltersKeys.serverPort,e.ContentFiltersKeys.databaseUsername,e.ContentFiltersKeys.hasPassword],orderKeys:[e.OrderKeys.connectionTypeDisplayName,e.OrderKeys.hasExtracts,e.OrderKeys.hasAlert,e.OrderKeys.lastRefreshedAt,e.OrderKeys.name,e.OrderKeys.ownerName,e.OrderKeys.projectName,e.OrderKeys.updatedAt],defaultOrder:[e.Order.asc(e.OrderKeys.name)]},e.SitesContentType={name:"sites",filterKeys:[e.ContentFiltersKeys.search],orderKeys:[e.OrderKeys.adminCount,e.OrderKeys.authoringEnabled,e.OrderKeys.availability,e.OrderKeys.createdAt,e.OrderKeys.currentLoggedInUserCount,e.OrderKeys.liveDBConnectionsWhitelistEnabled,e.OrderKeys.metricsEnabled,e.OrderKeys.name,e.OrderKeys.sheetImageEnabled,e.OrderKeys.siteAdminsCanAddUsers,e.OrderKeys.storageUsedBytes,e.OrderKeys.storageQuotaBytes,e.OrderKeys.storageQuotaPercentUsed,e.OrderKeys.urlName,e.OrderKeys.userCount,e.OrderKeys.userQuota],defaultOrder:[e.Order.asc(e.OrderKeys.name)]},e.GroupContentType={name:"group",filterKeys:[e.ContentFiltersKeys.search,e.ContentFiltersKeys.domain,e.ContentFiltersKeys.groupsMinimumSiteRole],orderKeys:[e.OrderKeys.name,e.OrderKeys.domainName,e.OrderKeys.userCount,e.OrderKeys.minimumSiteRole],defaultOrder:[e.Order.asc(e.OrderKeys.name)]},e.SiteUserContentType={name:"siteUser",filterKeys:[e.ContentFiltersKeys.search,e.ContentFiltersKeys.siteRole],orderKeys:[e.OrderKeys.displayName,e.OrderKeys.domainName,e.OrderKeys.groupCount,e.OrderKeys.lastSignIn,e.OrderKeys.siteRole,e.OrderKeys.username],defaultOrder:[e.Order.asc(e.OrderKeys.displayName)]},e.ScheduleContentType={name:"schedule",filterKeys:[],orderKeys:[e.OrderKeys.name,"scheduleType","scheduledAction","taskCount","parallel","runNextAt"],defaultOrder:[e.Order.asc(e.OrderKeys.name)]},e.ExtractTaskContentType={name:"extractTask",filterKeys:[],orderKeys:[e.OrderKeys.type,e.OrderKeys.targetName,e.OrderKeys.scheduleName,e.OrderKeys.priority,e.OrderKeys.lastRunAt,e.OrderKeys.runNextAt,e.OrderKeys.siteName],defaultOrder:[e.Order.asc(e.OrderKeys.targetName)]},e.RemoteRefreshScheduleContentType={name:"remoteRefreshSchedule",filterKeys:[],orderKeys:[e.OrderKeys.refreshType,e.OrderKeys.definition,e.OrderKeys.lastRunAt,e.OrderKeys.runNextAt],defaultOrder:[e.Order.asc(e.OrderKeys.runNextAt)]},e.SubscriptionContentType={name:"subscription",filterKeys:[],orderKeys:[e.OrderKeys.userName,e.OrderKeys.subject,e.OrderKeys.scheduleName,e.OrderKeys.lastSentAt,e.OrderKeys.runNextAt,e.OrderKeys.siteName],defaultOrder:[e.Order.asc(e.OrderKeys.subject)]},e.ServerUserContentType={name:"serverUser",filterKeys:[e.ContentFiltersKeys.search,e.ContentFiltersKeys.maxSiteRole],orderKeys:[e.OrderKeys.displayName,e.OrderKeys.domainName,e.OrderKeys.siteCount,e.OrderKeys.lastSignIn,e.OrderKeys.maxSiteRole,e.OrderKeys.username],defaultOrder:[e.Order.asc(e.OrderKeys.displayName)]},e.GroupUserContentType={name:"groupUser",filterKeys:[],orderKeys:[e.OrderKeys.displayName,e.OrderKeys.siteCount,e.OrderKeys.lastSignIn,e.OrderKeys.siteRole,e.OrderKeys.username],defaultOrder:[e.Order.asc(e.OrderKeys.displayName)]}}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.ContentTypes={project:e.ProjectContentType.name,datasource:e.DatasourceContentType.name,workbook:e.WorkbookContentType.name,view:e.ViewContentType.name}}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e,t,r){this.items=e,this.index=t||0,this.total=r||(e?e.length:0)}return e.empty=function(){return new e([],0,0)},e}();e.ListResult=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){e.FilterOps={and:"and",eq:"eq",lte:"lte",gte:"gte",has:"has",inArray:"in",matches:"matches"},e.FilterFieldNames={connectionType:"connectionType",createdAt:"createdAt",databaseUsername:"databaseUsername",datasourceId:"datasourceId",domainId:"domainId",groupId:"groupId",groupIds:"groupIds",hasAlert:"hasAlert",hasExtracts:"hasExtracts",hasEmbeddedPassword:"hasEmbeddedPassword",isDefaultPort:"isDefaultPort",isFavorite:"isFavorite",isPublished:"isPublished",isRecent:"isRecent",lastRefreshedAt:"lastRefreshedAt",maxSiteRole:"maxSiteRole",minimumSiteRole:"minimumSiteRole",ownerId:"ownerId",parentId:"parentId",parentType:"parentType",projectId:"projectId",scheduledAction:"scheduledAction",scheduleId:"scheduleId",serverName:"serverName",serverPort:"serverPort",siteId:"siteId",siteRole:"siteRole",tags:"tags",updatedAt:"updatedAt",workbookId:"workbookId"}}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){function r(t){return{operator:e.ServerApi.FilterOps.and,clauses:t}}function n(t){return{operator:e.ServerApi.FilterOps.matches,value:t}}function i(t,r){return{operator:e.ServerApi.FilterOps.eq,field:t,value:r}}function o(e,t){return i(e,t)}function s(e,t){return i(e,t)}function a(t,r){return{operator:e.ServerApi.FilterOps.gte,field:t,value:r}}function c(t,r){return{operator:e.ServerApi.FilterOps.lte,field:t,value:r}}function l(t,r){return{operator:e.ServerApi.FilterOps.matches,field:t,value:r}}function u(t,r){return{operator:e.ServerApi.FilterOps.has,field:t,value:r}}function d(t,r){return{operator:e.ServerApi.FilterOps.inArray,field:t,values:r}}function p(e,t,r){return r&&r.clauses?_.find(r.clauses,function(r){var n=r;return n.field===e&&n.operator===t}):null}t.and=r,t.search=n,t.fieldEq=i,t.stringFieldEq=o,t.numberFieldEq=s,t.stringFieldGte=a,t.stringFieldLte=c,t.stringFieldMatches=l,t.stringArrayFieldHas=u,t.stringFieldInArray=d,t.findFieldFilterClause=p}(t=e.Filter||(e.Filter={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e){this.fetcher=e,this.filterClauses=[],this.order=[],this.extraParams={}}return t.formatFilterClauses=function(t){return t&&t.length>0?e.Filter.and(t):void 0},t.getPage=function(e,t){return{startIndex:e,maxItems:t}},t.prototype.getSlice=function(e,r){return this.fetcher.fetchList(_.extend({filter:t.formatFilterClauses(this.filterClauses),order:this.order.length>0?this.order:void 0,page:t.getPage(e,r)},this.extraParams))},t.prototype.getFirst=function(){return this.getSlice(0,1).then(function(e){return e.items&&e.items.length>0?e.items[0]:null})},t.prototype.getCount=function(){return this.getSlice(0,0).then(function(e){return e.total})},t.prototype.getFilters=function(){return this.filterClauses},t.prototype.getOrder=function(){return this.order},t.prototype.withFiltersAndOrder=function(e,t){return this.clone().setFilterClauses(e).setOrder(t)},t.prototype.withExtraParams=function(e){return e?this.clone().setExtraParams(e):this},t.prototype.withFilters=function(e){return this.clone().setFilterClauses(e)},t.prototype.addFilter=function(e){return this.withFilters((this.filterClauses||[]).concat([e]))},t.prototype.withOrder=function(e){return this.clone().setOrder(e)},t.prototype.clone=function(){return new t(this.fetcher).setFilterClauses(this.filterClauses).setOrder(this.order)},t.prototype.setFilterClauses=function(e){return this.filterClauses=e,this},t.prototype.setOrder=function(e){return this.order=e,this},t.prototype.setExtraParams=function(e){return this.extraParams=e,this},t}();e.ResourceQuery=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){e.FieldValueResourceType={dataConnection:"dataConnection",datasource:"datasource",project:"project",view:"view",workbook:"workbook"}}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r){this.fetcher=e,this.field=t,this.resourceType=r}return t.prototype.getSlice=function(t,r){var n={field:this.field,labelMatchText:this.matchText,page:e.ResourceQuery.getPage(t,r),resourceType:this.resourceType,resourceCountFilter:e.ResourceQuery.formatFilterClauses(this.filterClauses)};return this.fetcher.fetchList(n)},t.prototype.getFilters=function(){return this.filterClauses},t.prototype.withMatchText=function(e){return this.clone().setMatchText(e)},t.prototype.withFilters=function(e){return this.clone().setFilterClauses(e)},t.prototype.clone=function(){return new t(this.fetcher,this.field,this.resourceType).setFilterClauses(this.filterClauses).setMatchText(this.matchText)},t.prototype.setFilterClauses=function(e){return this.filterClauses=e,this},t.prototype.setMatchText=function(e){return this.matchText=e,this},t}();e.FieldValuesQuery=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){function r(e){var t=[];return _.forEach(e,function(e,r){e&&t.push(i[r](e))}),_.compact(t)}var n="default",i={connectionType:function(t){return e.Filter.stringFieldEq(e.ServerApi.FilterFieldNames.connectionType,t)},createdBefore:function(t){return e.Filter.stringFieldLte(e.ServerApi.FilterFieldNames.createdAt,t)},createdAfter:function(t){return e.Filter.stringFieldGte(e.ServerApi.FilterFieldNames.createdAt,t)},databaseUsername:function(t){return e.Filter.stringFieldMatches(e.ServerApi.FilterFieldNames.databaseUsername,t)},domain:function(t){return e.Filter.stringFieldEq(e.ServerApi.FilterFieldNames.domainId,t)},forWorkbook:function(t){return e.Filter.stringFieldEq(e.ServerApi.FilterFieldNames.workbookId,t)},group:function(t){return e.Filter.stringFieldEq(e.ServerApi.FilterFieldNames.groupId,t)},inGroup:function(t){return e.Filter.stringArrayFieldHas(e.ServerApi.FilterFieldNames.groupIds,t)},hasDatasource:function(t){return e.Filter.stringArrayFieldHas(e.ServerApi.FilterFieldNames.datasourceId,t)},hasAlert:function(t){return e.Filter.fieldEq(e.ServerApi.FilterFieldNames.hasAlert,Helpers.toBoolean(t))},hasExtracts:function(t){return e.Filter.fieldEq(e.ServerApi.FilterFieldNames.hasExtracts,Helpers.toBoolean(t))},hasPassword:function(t){return e.Filter.fieldEq(e.ServerApi.FilterFieldNames.hasEmbeddedPassword,Helpers.toBoolean(t))},lastRefreshedBefore:function(t){return e.Filter.stringFieldLte(e.ServerApi.FilterFieldNames.lastRefreshedAt,t)},lastRefreshedAfter:function(t){return e.Filter.stringFieldGte(e.ServerApi.FilterFieldNames.lastRefreshedAt,t)},maxSiteRole:function(t){return e.Filter.stringFieldEq(e.ServerApi.FilterFieldNames.maxSiteRole,t)},groupsMinimumSiteRole:function(t){return e.Filter.stringFieldEq(e.ServerApi.FilterFieldNames.minimumSiteRole,t)},modifiedBefore:function(t){return e.Filter.stringFieldLte(e.ServerApi.FilterFieldNames.updatedAt,t)},modifiedAfter:function(t){return e.Filter.stringFieldGte(e.ServerApi.FilterFieldNames.updatedAt,t)},owner:function(t){return e.Filter.stringFieldEq(e.ServerApi.FilterFieldNames.ownerId,t)},project:function(t){return e.Filter.stringFieldEq(e.ServerApi.FilterFieldNames.projectId,t)},schedule:function(t){return e.Filter.stringFieldEq(e.ServerApi.FilterFieldNames.scheduleId,t)},search:function(t){return e.Filter.search(t)},serverName:function(t){return e.Filter.stringFieldMatches(e.ServerApi.FilterFieldNames.serverName,t)},serverPort:function(t){return t===n?e.Filter.fieldEq(e.ServerApi.FilterFieldNames.isDefaultPort,!0):e.Filter.stringFieldEq(e.ServerApi.FilterFieldNames.serverPort,t)},showEmbedded:function(t){return t+""=="true"?null:t+""=="only"?e.Filter.fieldEq(e.ServerApi.FilterFieldNames.isPublished,!1):e.Filter.fieldEq(e.ServerApi.FilterFieldNames.isPublished,!0)},siteId:function(t){return e.Filter.fieldEq(e.ServerApi.FilterFieldNames.siteId,t)},siteRole:function(t){return e.Filter.stringFieldEq(e.ServerApi.FilterFieldNames.siteRole,t)},tag:function(t){return e.Filter.stringArrayFieldHas(e.ServerApi.FilterFieldNames.tags,t)},workbook:function(t){return e.Filter.stringFieldEq(e.ServerApi.FilterFieldNames.workbookId,t)},datasource:function(t){return e.Filter.stringFieldEq(e.ServerApi.FilterFieldNames.datasourceId,t)},favorite:function(t){return e.Filter.fieldEq(e.ServerApi.FilterFieldNames.isFavorite,Helpers.toBoolean(t))},recent:function(t){return e.Filter.fieldEq(e.ServerApi.FilterFieldNames.isRecent,Helpers.toBoolean(t))}};t.create=r}(t=e.ServerFilterClauses||(e.ServerFilterClauses={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(){this.subplaceMap={},this.subplaceList=[]}return e.prototype.subplace=function(e){return this.subplaceMap[e]},e.prototype.subplaces=function(){return this.subplaceList},e.prototype.addSubplace=function(e){this.subplaceMap[e.name]=e,this.subplaceList.push(e)},e}();e.Place=t;var r=function(){function t(e,t,r,n,i,o,s){void 0===s&&(s=[]),this.name=e,this.type=t,this.resourceQueryFn=r,this.filterValuesQueryFn=n,this.resource=i,this.defaultFilters=o,this.excludeFilters=s}return t.prototype.filterKeys=function(){return _.difference(this.type.filterKeys,this.excludeFilters)},t.prototype.query=function(){return this.resourceQueryFn()},t.prototype.filterValuesQuery=function(e){return this.filterValuesQueryFn?this.filterValuesQueryFn(e):void 0},t.empty=function(r,n,i){var o=new e.ResourceQuery({fetchList:function(e){return i.when({items:[],index:0,total:0})}});return new t(r,n,function(){return o},void 0,{all:function(){return o}},{})},t.create=function(r,n,i,o,s,a){void 0===s&&(s={}),void 0===a&&(a=[]);var c=function(t){return e.ServerFilterClauses.create(_.defaults(_(t).pick(n.filterKeys),s||{}))};return new t(r,n,function(){var t=o(),r=c(t),s=e.Order.fromInput(t.order,n.orderKeys)||n.defaultOrder;return i.all().withFiltersAndOrder(r,s)},i.valuesForField?function(e){var t=_.reject(c(o()),function(t){var r=t;return e&&r.field===e});return i.valuesForField(e).withFilters(t)}:void 0,i,s,a)},t}();e.Subplace=r}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.NamedItemInfoKeys={id:"id",name:"name"}}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(){}return e.prototype.forgetWorkbook=function(){this.workbook=null,this.workbookUrl=null},e.prototype.forgetProject=function(){this.project=null,this.projectUrl=null},e.prototype.rememberSiteUrl=function(e){this.forgetWorkbook(),this.forgetProject(),this.siteUrl=e},e.prototype.rememberProjectUrl=function(e,t){this.forgetWorkbook(),this.project=e,this.projectUrl=t},e.prototype.rememberWorkbookUrl=function(e,t){this.workbook=e,this.workbookUrl=t,!this.project||e&&e.project&&this.project.id===e.project.id||this.forgetProject()},e.prototype.workbookChanged=function(e){!this.workbook||e&&this.workbook.id===e.id||this.forgetWorkbook(),!this.project||e&&e.project&&this.project.id===e.project.id||this.forgetProject()},e.prototype.projectChanged=function(e){!this.project||e&&this.project.id===e.id||this.forgetProject()},e.prototype.rememberGroupsUrl=function(e){this.groupsUrl=e},e}();e.BreadcrumbsService=t,e.Module.instance().service("BreadcrumbsService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=15,r=29;e.ModalSize={medium:"400px",fitToContent:"auto"};var n=function(){function r(t,r,n,i,o,s,a,c,l){this.$window=t,this.$compile=r,this.$rootScope=n,this.$q=i,this.$controller=o,this.$injector=s,this.$templateCache=a,this.$http=c,this.StackedElementsService=l,this.id=0,this.modalInstances=new e.Set(function(e){return e._id})}return r.anchoredTo=function(e){return{hostElement:e}},r.prototype.open=function(t){var r=this;if(!t.templateUrl)throw new Error("templateUrl option is required.");_.defaults(t,{size:e.ModalSize.medium,keyboard:!0,resolve:{},scope:this.$rootScope,backdrop:!0,closeX:!0,tbTestId:"modal"});var n,i,o,s=this.$q.defer(),a=t.scope.$new(),c={result:s.promise,close:function(e){r.close(c,n,i,o.scope),s.resolve(e)},dismiss:function(e){r.close(c,n,i,o.scope),s.reject(e)},_id:(this.id++).toString(),_scope:a};this.modalInstances.add(c);var l=this.getResolvePromises(t.resolve);return l.push(this.$http.get(t.templateUrl,{cache:this.$templateCache})),this.$q.all(l).then(function(e){var s=$("<tb:modal />");if(t.classes&&s.addClass(t.classes),o=r.createBackdrop(c,t),a.options=t,a.close=c.close,a.dismiss=c.dismiss,t.controller){var l={$scope:a,modalInstance:c},u=0;angular.forEach(t.resolve,function(t,r){l[r]=e[u++]}),r.$controller(t.controller,l)}r.$compile(s)(a);var d=function(){return{left:0,top:0,right:0,bottom:0}};i=r.StackedElementsService.addStackedElement({contentElement:o.element,getContentElementPosition:d});var p=void 0;n=r.StackedElementsService.addStackedElement({contentElement:s,getContentElementPosition:function(){var e=r.position(s,t);return _.isEqual(e,p)||(a.$broadcast("positionChanged",e),p=e),e}}),r.attachKeydownHandler(c,t)}),c},r.prototype.alert=function(e){var t=this.$rootScope.$new(),r=this.open({scope:angular.extend(t,e),templateUrl:"alert.html"});return r.result.fin(function(){return t.$destroy()}),r},r.prototype.createBackdrop=function(e,t){var n=$('<div ng-click="backdropClick()" ng-if="options.backdrop" />').addClass(r.BackdropClass),i=this.$rootScope.$new();return i.options=t,i.options.backdropClasses&&n.addClass(i.options.backdropClasses),i.backdropClick=function(){t.backdrop&&"static"!==t.backdrop&&e.dismiss()},this.$compile(n)(i),{element:n,scope:i}},r.prototype.attachKeydownHandler=function(t,r){var n=this;$(this.$window.document).on("keydown.modal"+t._id,function(i){i.which===e.Keys.Escape&&r.keyboard&&n.$rootScope.$apply(function(){return t.dismiss()})})},r.prototype.detachKeydownHandler=function(e){$(this.$window.document).off(".modal"+e._id)},r.prototype.getWindowSize=function(){var e=$(this.$window);return{width:e.width(),height:e.height()}},r.prototype.position=function(e,t){var n=r.MinimumSpaceBetweenDialogAndViewport,i=Math.max(e.outerHeight(),t.position&&t.position.reserveHeight||0),o=this.positionRelativeToHostElement(e,t,i);
if(!o){var s=this.getWindowSize();t._showArrow=!1,o={left:s.width/2-e.outerWidth()/2,top:Math.max(s.height/2-i/2,n)}}return o},r.prototype.positionRelativeToHostElement=function(e,n,i){if(!n.position||!n.position.hostElement||0===n.position.hostElement.parents("body").length)return null;var o=r.MinimumSpaceBetweenDialogAndViewport,s=this.getWindowSize(),a=n.position.hostElement,c=a.offset(),l=c.left+a.outerWidth()/2-e.outerWidth()/2,u=c.top+a.outerHeight()+t;if(l=Math.min(l,s.width-o-e.outerWidth()),l=Math.max(l,o),u+i>s.height-o){var d=c.top-t-i;if(!(d>=o))return null;u=c.top-e.outerHeight()-t}return n._showArrow=!0,{left:l,top:u}},r.prototype.getResolvePromises=function(e){var t=this,r=[];return angular.forEach(e,function(e){(angular.isFunction(e)||angular.isArray(e))&&r.push(t.$q.when(t.$injector.invoke(e)))}),r},r.prototype.close=function(e,t,r,n){this.detachKeydownHandler(e),e._scope.$destroy(),this.StackedElementsService.removeStackedElement(t),n.$destroy(),this.StackedElementsService.removeStackedElement(r),this.modalInstances.remove(e)},r.prototype.dismissAll=function(){var e=this;_.each(this.modalInstances.toArray(),function(t){t.dismiss(),e.modalInstances.remove(t)})},r.$inject=["$window","$compile","$rootScope","$q","$controller","$injector","$templateCache","$http","StackedElementsService"],r.BackdropClass="tb-backdrop",r.MinimumSpaceBetweenDialogAndViewport=18,r}();e.ModalService=n,e.Module.instance().service("ModalService",n),e.Module.instance().directive("tbModal",["$window",function(t){return{restrict:"E",replace:!0,templateUrl:"modal.html",link:function(n,i){$(t);n.showArrow=function(){return!!n.options._showArrow},n.arrowUp=!0,n.arrowLeft=0;var o=(i.find(".tb-modal-content")[0],0);i.on("keydown",function(t){if(t.which===e.Keys.Tab){var r=i.find(":tabbable"),n=r.filter(":first"),o=r.filter(":last");t.target!==o[0]||t.shiftKey?t.target===n[0]&&t.shiftKey&&(t.preventDefault(),o.focus()):(t.preventDefault(),n.focus())}}),n.$on("positionChanged",function(e,t){if(n.options.position){var i=n.options.position,s=i.hostElement;if(t&&s){var a=s.offset();n.arrowUp=t.top>a.top,o=t.top;var c=a.left+s.outerWidth()/2;n.arrowLeft=c-r/2-t.left}}}),i.css("width",n.options.size)}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){function t(e){var t=angular.element(e.currentTarget);return{scope:t.scope(),targetElement:t}}e.fromEvent=t}(t=e.ActionContext||(e.ActionContext={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){function t(e,t){var n={};return e.anySucceeded()&&(n.successSummary=r(function(){return t.describeSuccessSummary(e.successCount)})),e.anyFailed()&&(n.errorSummary=r(function(){return t.describeErrorSummary(e.errorCount)}),n.errorDetails=_.compact(_.map(e.errorItems(),function(e){return r(function(){return t.describeErrorDetail(e)})}))),n}function r(e){try{return e()}catch(t){return void console.error("Error translation failed",t)}}e.create=t}(t=e.MultipleResultNotificationOptions||(e.MultipleResultNotificationOptions={}));var r=function(){function t(e,t,r,n,i){this.$translate=e,this.scope=t,this.toaster=r,this.modal=n,this.SliceableFactory=i}return t.prototype.notifyResult=function(t,r,n,i){var o=r?r.length:0,s=t.size()-o,a=[];s&&a.push(this.$translate.instant(n.successId,angular.extend({ITEM_COUNT:s},i),e.L10n.Interpolations.Count)),o&&a.push(this.$translate.instant(n.errorId,angular.extend({ERROR_COUNT:o},i),e.L10n.Interpolations.Count)),this.toaster.pop({type:o?e.ToastType.Error:e.ToastType.Info,text:a.join("\n")})},t.prototype.notify=function(t){function r(t){o.open({scope:i,templateUrl:"errorDetailsDialog.html",size:e.ModalSize.fitToContent,position:e.ModalService.anchoredTo(t)}).result.fin(function(){return i.$destroy()})}if(t.successSummary&&this.toaster.pop({type:e.ToastType.Info,text:t.successSummary}),t.errorSummary)if(e.FeatureFlags.reactToasts){var n=React.createClass({showDetails:function(){this.props.openModal($(React.findDOMNode(this)))},render:function(){var e=t.errorDetails.length>0?React.DOM.a({onClick:this.showDetails},this.props.detailsLinkText):null;return React.DOM.div({},React.DOM.span({},t.errorSummary+"Â "),e)}}),i=this.scope.$new();i.errorDetailsSliceable=this.SliceableFactory.fromArray(t.errorDetails);var o=this.modal;this.toaster.pop({type:e.ToastType.Error,content:React.createElement(n,{detailsLinkText:this.$translate.instant("details"),openModal:r})})}else this.toaster.pop({type:e.ToastType.Error,templateUrl:"errorDetailsToast.html",data:t})},t.prototype.notifySuccess=function(t){this.toaster.pop({type:e.ToastType.Info,text:t})},t.prototype.notifyFailure=function(t){this.toaster.pop({type:e.ToastType.Error,text:t})},t.$inject=["$translate","$rootScope","ToasterService","ModalService","SliceableFactory"],t}();e.ContentActionNotification=r,e.Module.instance().service("ContentActionNotification",r)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t){this.ConfirmActionDialog=e,this.ContentActionNotification=t}return t.prototype.executeFromEvent=function(t,r){return this.execute(t,e.ActionContext.fromEvent(r))},t.prototype.execute=function(e,t){var r=this,n=this.defaultDialogConfig(t);this.configureDialog(n,e);var i=this.ConfirmActionDialog.open(n);return i.result.then(function(t){return r.ContentActionNotification.notifyResult(e,t.errors,r.notificationTranslationIds(),r.notificationTranslationValues(n.scope))}),i.result.fin(function(){return n.scope.$destroy()}),i.result},t.prototype.defaultDialogConfig=function(e){return{scope:e.scope.$new(),title:"",actionName:"OK",action:angular.noop}},t.prototype.configureDialog=function(e,t){},t.prototype.notificationTranslationIds=function(){throw"notificationTranslationIds() must be implemented in a subclass"},t.prototype.notificationTranslationValues=function(e){return{}},t}();e.AbstractContentAction=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(t){function r(e,r,n,i){t.call(this,e,r),this.$translate=n,this.Sites=i}return __extends(r,t),r.prototype.configureDialog=function(t,r){var n=this,i=t.scope;i.dialog={siteName:r.first().settings.name},t.bodyText=this.$translate.instant("confirmActivateSites",{SITE_NAME:e.L10n.elideIfLong(i.dialog.siteName),ITEM_COUNT:r.size()},e.L10n.Interpolations.Count),t.title=this.$translate.instant("activateSites"),t.actionName=this.$translate.instant("activateButtonConfirm",{ITEM_COUNT:r.size()},e.L10n.Interpolations.Count),t.action=function(){return n.Sites.activate(r.keys())}},r.prototype.notificationTranslationIds=function(){return{successId:"sitesActivateSuccess",errorId:"sitesActivateFailed"}},r.prototype.notificationTranslationValues=function(t){return{SITE_NAME:e.L10n.elideIfLong(t.dialog.siteName)}},r.$inject=["ConfirmActionDialog","ContentActionNotification","$translate","Sites"],r}(e.AbstractContentAction);e.ActivateSitesAction=t,e.Module.instance().service("ActivateSitesAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){function r(r,n){var i=[],o=function(s){return void 0===s&&(s=0),r.getSlice(s,t.BlockSize).then(function(t){var r=!1;return n&&(r=!!n(t.items)),i=i.concat(t.items),!r&&t.total>i.length?o(i.length):new e.ListResult(i)})};return o()}t.BlockSize=e.MaxRequestArrayLength,t.fetchAll=r}(t=e.SliceableHelper||(e.SliceableHelper={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){function r(e,t){if(e.length<=t)return[e];for(var r=[],n=Math.ceil(e.length/t),i=0;n>i;i++)r[i]=e.slice(i*t,(i+1)*t);return r}function n(e,n,i){void 0===i&&(i=t.DefaultBlockSize);for(var o=[],s=r(e,i),a=0,c=s.length;c>a;a++){var l=n(s[a]);l&&o.push(l)}return o}function i(e,n,i,o){void 0===o&&(o=t.DefaultBlockSize);for(var s=[],a=r(e,o),c=r(n,o),l=0,u=a.length;u>l;l++)for(var d=0,p=c.length;p>d;d++){var h=i(a[l],c[d]);h&&s.push(h)}return s}function o(e,n,i,o,s){void 0===s&&(s=t.DefaultBlockSize);for(var a=[],c=r(e,s),l=r(n,s),u=r(i,s),d=0,p=c.length;p>d;d++)for(var h=0,f=l.length;f>h;h++)for(var m=0,v=u.length;v>m;m++){var S=o(c[d],l[h],u[m]);S&&a.push(S)}return a}t.DefaultBlockSize=e.MaxRequestArrayLength,t.makeBlocks=r,t.buildRequests=n,t.buildRequests2=i,t.buildRequests3=o}(t=e.RequestHelper||(e.RequestHelper={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e){this.items={},this.keyForItem=e}return e.fromKeyArray=function(t){var r=new e(function(e){return e});return r.addItems(t),r},e.fromIdItemArray=function(t){var r=new e(function(e){return e.id});return r.addItems(t),r},e.singleton=function(t,r){var n=new e(r);return n.add(t),n},e.prototype.keyFor=function(e){return this.keyForItem(e)},e.prototype.containsKey=function(e){return _.has(this.items,e)},e.prototype.contains=function(e){return this.containsKey(this.keyForItem(e))},e.prototype.size=function(){return _.size(this.items)},e.prototype.isEmpty=function(){return _.isEmpty(this.items)},e.prototype.keys=function(){return _.keys(this.items)},e.prototype.get=function(e){return this.items[e]},e.prototype.add=function(e){this.items[this.keyForItem(e)]=e},e.prototype.addItems=function(e){var t=this;_.each(e,function(e){t.add(e)})},e.prototype.update=function(e){this.contains(e)&&this.add(e)},e.prototype.updateItems=function(e){var t=this;_.each(e,function(e){t.update(e)})},e.prototype.remove=function(e){delete this.items[this.keyForItem(e)]},e.prototype.removeItems=function(e){var t=this;_.each(e,function(e){t.remove(e)})},e.prototype.removeItemsIn=function(e){var t=this;_.each(this.items,function(r,n){e.containsKey(n)&&t.remove(r)})},e.prototype.removeItemsNotIn=function(e){var t=this;_.each(this.items,function(r,n){e.containsKey(n)||t.remove(r)})},e.prototype.toggle=function(e){return this.contains(e)?(this.remove(e),!1):(this.add(e),!0)},e.prototype.toggleItems=function(e){var t=this;_.each(e,function(e){t.toggle(e)})},e.prototype.clear=function(){this.items={}},e.prototype.toArray=function(){return _.values(this.items)},e.prototype.each=function(e,t){_.each(this.items,e,t)},e.prototype.find=function(e,t){return _.find(this.items,e,t)},e.prototype.pluck=function(e){return _.pluck(this.toArray(),e)},e.prototype.map=function(e,t){return _.map(this.items,e,t)},e.prototype.reduce=function(e,t,r){return _.reduce(this.items,e,t,r)},e.prototype.sum=function(e){return this.reduce(function(t,r){return t+e(r)},0)},e.prototype.all=function(e){return _.all(this.items,e)},e.prototype.any=function(e){return _.any(this.items,e)},e.prototype.filter=function(t){var r=new e(this.keyForItem);return this.each(function(e){t(e)&&r.add(e)}),r},e.prototype.clone=function(){var t=new e(this.keyForItem);return t.addItems(this.toArray()),t},e.prototype.first=function(){return this.get(this.keys()[0])},e.prototype.getByIndex=function(e){return this.get(this.keys()[e])},e}();e.Set=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){function r(e,t){return _.compact(_.flatten(_.map(_.compact(e),t)))}function n(e,t){var r=_.compact(_.map(_.compact(e),t));return r.unshift({}),_.extend.apply(null,r)}function i(e){return r(e,function(e){return e.errors})}function o(e){return r(e,function(e){return e.ids})}function s(e){return r(e,function(e){return e.users})}function a(e){return{errors:i(e)}}function c(e){return r(e,function(e){return e.results})}function l(e){return{errors:i(e),users:s(e),results:c(e)}}function u(e){return{errors:i(e),users:s(e)}}function d(e){return!(!e||!e.errors)&&e.errors.length>0}function p(e){return function(t){return d(t)?e.reject(t):e.when(t)}}function h(t,r){return void 0===r&&(r={}),e.Set.fromKeyArray(_.compact(_.map(t&&t.errors||[],function(e){return e.code===r.excludeCode?null:e.id})))}function f(t,r){return e.Set.fromKeyArray(_.compact(_.map(t&&t.errors||[],function(e){return e.code===r?e.id:null})))}t.combine=r,t.combineByKey=n,t.combineErrors=i,t.combineIds=o,t.combineUsers=s,t.combineResults=a,t.combineCodes=c,t.combineUserResults=l,t.combineImportUserResults=u,t.hasErrors=d,t.rejectResultOnError=p,t.getErrorIds=h,t.getErrorIdsWithCode=f}(t=e.ResultHelper||(e.ResultHelper={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){e.ScheduleTypes={Hourly:"Hourly",Daily:"Daily",Weekly:"Weekly",Monthly:"Monthly"},e.ScheduleActions={Extract:"Extract",Subscription:"Subscription"},e.ScheduleDaysOfTheWeek={Sun:"Sun",Mon:"Mon",Tue:"Tue",Wed:"Wed",Thu:"Thu",Fri:"Fri",Sat:"Sat"},e.ScheduleLastDayOfMonth="Last"}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"createSchedule",t)}return __extends(t,e),t}(e.Request);e.CreateScheduleRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"deleteSchedules",{ids:t})}return __extends(t,e),t}(e.Request);e.DeleteSchedulesRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getSchedules",t)}return __extends(t,e),t}(e.Request);e.GetSchedulesRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"runServerSchedules",{ids:t})}return __extends(t,e),t}(e.Request);e.RunServerSchedulesRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"runSchedules",{ids:t})}return __extends(t,e),t}(e.Request);e.RunSchedulesRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t,r){e.call(this,"setEnabledStatusForSchedules",{ids:t,enabled:r})}return __extends(t,e),t}(e.Request);e.SetEnabledStatusForSchedulesRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t,r){e.call(this,"setScheduleName",{id:t,name:r})}return __extends(t,e),t}(e.Request);e.SetScheduleNameRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t){this.fetcher=t,this.allQuery=new e.ResourceQuery(this.fetcher)}return t.prototype.all=function(){return this.allQuery},t.prototype.getById=function(t,r){var n=this.all();return r&&(n=n.withFilters(r)),n.addFilter(e.Filter.stringFieldEq(e.ServerApi.NamedItemKeys.id,t)).getFirst()},t}();e.Resource=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(t){function r(r,n){t.call(this,n.getServerResourceFetcher(e.ServerApi.GetSchedulesRequest,function(e){return e.schedules})),this.ErrorNotifyingServer=r}return __extends(r,t),r.filterByActionType=function(t){return e.Filter.fieldEq(e.ServerApi.FilterFieldNames.scheduledAction,t)},r.prototype.getByIdForSite=function(t,r){return this.getById(t,_(r).isString()?[e.Filter.fieldEq(e.ServerApi.FilterFieldNames.siteId,r)]:[])},r.prototype.setEnabledStatus=function(t,r){return this.ErrorNotifyingServer.sendRequests(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.SetEnabledStatusForSchedulesRequest(t,r)}),e.ResultHelper.combineResults)},r.prototype.disable=function(e){return this.setEnabledStatus(e,!1)},r.prototype.enable=function(e){return this.setEnabledStatus(e,!0)},r.prototype.del=function(t){return this.ErrorNotifyingServer.sendRequests(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.DeleteSchedulesRequest(t)}),e.ResultHelper.combineResults)},r.prototype.runServer=function(t){return this.ErrorNotifyingServer.sendRequests(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.RunServerSchedulesRequest(t)}),e.ResultHelper.combineResults)},r.prototype.run=function(t){return this.ErrorNotifyingServer.sendRequests(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.RunSchedulesRequest(t)}),e.ResultHelper.combineResults)},r.prototype.create=function(t){return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.CreateScheduleRequest(t))},r.prototype.update=function(t){return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.UpdateScheduleRequest(t))},r.prototype.rename=function(t,r){return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.SetScheduleNameRequest(t,r))},r.$inject=["ErrorNotifyingServer","FetcherFactory"],r}(e.Resource);e.Schedules=t,e.Module.instance().service("Schedules",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){!function(e){e[e.AllowRefreshNow=0]="AllowRefreshNow",e[e.AllowSchedule=1]="AllowSchedule",e[e.AllowBoth=2]="AllowBoth"}(e.CreateExtractTasksMode||(e.CreateExtractTasksMode={}));var t=e.CreateExtractTasksMode,r={RefreshNow:"RefreshNow",ScheduleRefresh:"ScheduleRefresh"},n=function(){function n(e,t,r,n,i,o,s,a){this.ConfirmActionDialog=e,this.ContentUrl=t,this.$translate=r,this.Workbooks=n,this.Datasources=i,this.SearchSuggestionsService=o,this.ActionHelpers=s,this.ModalService=a,this.notificationTranslationIds={successId:"extractTasksCreateSuccess",errorId:"extractTasksCreateError"}}return n.prototype.createDialogScope=function(n,i,o,s){var a=n.$new();return a.extractTask={type:e.ServerApi.ExtractTaskType.RefreshExtract},a.schedulePrompt=o,a.scheduleSource=this.SearchSuggestionsService.schedulesSource(e.ServerApi.ScheduleActions.Extract),a.allowIncremental=_.any(i.toArray(),function(e){return e.hasIncrementalExtract}),a.allowIncremental&&(a.extractTaskTypeOptions=[{value:e.ServerApi.ExtractTaskType.RefreshExtract,labelTranslateKey:"extractTasksTypeRefreshExtract",tbTestId:"create-extract-refresh-type-full"},{value:e.ServerApi.ExtractTaskType.IncrementExtract,labelTranslateKey:"extractTasksTypeIncrementExtract",tbTestId:"create-extract-refresh-type-incremental"}]),a.dialog={mode:s===t.AllowSchedule?r.ScheduleRefresh:r.RefreshNow,showModeSelector:s===t.AllowBoth},a},n.prototype.execute=function(t,n,i,o,s,a,c,l){var u=this,d=this.createDialogScope(n.scope,t,i,l);d.refreshNowPrompt=s;var p=[];d.$watch(function(){return d.dialog.mode},function(){p.length=0,d.dialog.mode===r.ScheduleRefresh?p.push({label:u.$translate.instant("extractTasksCreateConfirm"),action:function(){return o(t.keys(),d.extractTask.schedule.id,d.extractTask.type)},disabled:function(){return!d.extractTask.schedule||!d.extractTask.type}}):(p.push({label:u.$translate.instant("fullRefresh"),action:function(){return a(t.keys(),e.ServerApi.ExtractTaskType.RefreshExtract)}}),d.allowIncremental&&p.push({label:u.$translate.instant("incrementalRefresh"),action:function(){return a(t.keys(),e.ServerApi.ExtractTaskType.IncrementExtract)}}))});var h=this.ConfirmActionDialog.open({scope:d,position:{reserveHeight:550},bodyTemplateUrl:"confirmActionDialogExtractRefresh.html",title:this.dialogTitle(l),buttons:p,size:"600px"});return h.result.then(this.ActionHelpers.notifyStandardError(t,this.notificationTranslationIds,function(e){return c(d.extractTask.schedule)(e)})).fin(function(){return d.$destroy()}),h.result},n.prototype.dialogTitle=function(e){switch(e){case t.AllowBoth:return this.$translate.instant("extractTasksDialogTitle_AllowBoth");case t.AllowRefreshNow:return this.$translate.instant("extractTasksDialogTitle_AllowRefreshNow");case t.AllowSchedule:return this.$translate.instant("extractTasksDialogTitle_AllowSchedule");default:throw"Unknown allowed mode: "+e}},n.prototype.createExtractErrorMessageFor=function(t,r){switch(t.error.code){case e.SchedulingErrorCode.SchedulingScheduleNotFound:return this.$translate.instant("scheduleNotFound",{SCHEDULE:r.name})}return this.$translate.instant("errorUnknown")},n.prototype.forWorkbook=function(t,r,n){var i=e.Set.singleton(t,function(e){return e.id});return this.forWorkbooks(i,r,n)},n.prototype.forWorkbooks=function(t,r,n){var i=this,o=1===t.size()?this.$translate.instant("schedulesLabelPromptWorkbook",{WORKBOOK_NAME:e.L10n.elideIfLong(t.first().name)}):this.$translate.instant("schedulesLabelPromptWorkbooks",{COUNT:t.size()},e.L10n.Interpolations.Count),s=this.$translate.instant("extractTasksRefreshNowOnWorkbooksPrompt",{WORKBOOK_COUNT:t.size(),WORKBOOK_NAME:e.L10n.elideIfLong(t.first().name)},e.L10n.Interpolations.Count);return this.execute(t,r,o,function(e,t,r){return i.Workbooks.createExtractTask(e,t,r)},s,function(e,t){return i.Workbooks.refreshExtracts(e,t)},function(e){return i.workbookErrorDetailFactory(e)},n)},n.prototype.workbookErrorDetailFactory=function(t){var r=this;return function(n){return{itemName:n.item.name,itemUrl:r.ContentUrl.forItem(n.item,e.WorkbookContentType),errorMessage:r.workbookErrorMessageFor(n,t)}}},n.prototype.workbookErrorMessageFor=function(t,r){switch(t.error.code){case e.WebClientErrorCode.TaskTypeRefreshExtractNotAllowed:return this.$translate.instant("extractTasksWorkbookNoExtract");case e.WebClientErrorCode.TaskTypeIncrementExtractNotAllowed:return this.$translate.instant("extractTasksWorkbookNoIncrementalExtract");case e.SchedulingErrorCode.SchedulingExtractTaskExistsForTarget:return this.$translate.instant("extractTasksRefreshAlreadyExistsForWorkbook",{SCHEDULE:r.name});case e.CommonErrorCode.CallingUserInsufficientPermissions:return this.$translate.instant("extractTasksWorkbookErrorInsufficientPermissions")}return this.createExtractErrorMessageFor(t,r)},n.prototype.forDatasource=function(t,r,n){var i=e.Set.singleton(t,function(e){return e.id});return this.forDatasources(i,r,n)},n.prototype.forDatasources=function(t,r,n){var i=this;if(!this.anyRefreshableDatasources(t))return this.showCannotRefreshErrorAlert(t);var o=1===t.size()?this.$translate.instant("schedulesLabelPromptDatasource",{DATASOURCE_NAME:e.L10n.elideIfLong(t.first().name)}):this.$translate.instant("schedulesLabelPromptDatasources",{COUNT:t.size()},e.L10n.Interpolations.Count),s=this.$translate.instant("extractTasksRefreshNowOnDatasourcesPrompt",{DATASOURCE_COUNT:t.size(),DATASOURCE_NAME:e.L10n.elideIfLong(t.first().name)},e.L10n.Interpolations.Count);return this.execute(t,r,o,function(e,t,r){return i.Datasources.createExtractTask(e,t,r)},s,function(e,t){return i.Datasources.refreshExtracts(e,t)},function(e){return i.datasourceErrorDetailFactory(e)},n)},n.prototype.anyRefreshableDatasources=function(e){var t=this;return _.any(e.toArray(),function(e){return t.isRefreshableDatasource(e)})},n.prototype.isRefreshableDatasource=function(e){return _.isObject(e.workbook)?!1:e.hasExtracts?!0:!1},n.prototype.showCannotRefreshErrorAlert=function(e){var t=e.all(function(e){return _.isObject(e.workbook)}),r=e.any(function(e){return _.isObject(e.workbook)}),n="refreshExtracts_cannotRefreshAlertMessage_allLive";return t?n="refreshExtracts_cannotRefreshAlertMessage_allEmbedded":r&&(n="refreshExtracts_cannotRefreshAlertMessage_mixedEmbeddedAndLive"),this.ModalService.alert({titleId:"refreshExtracts_cannotRefreshAlertTitle",messageId:n}).result},n.prototype.datasourceErrorDetailFactory=function(t){var r=this;return function(n){return{itemName:n.item.name,itemUrl:r.ContentUrl.forItem(n.item,e.DatasourceContentType),errorMessage:r.datasourceErrorMessageFor(n,t)}}},n.prototype.datasourceErrorMessageFor=function(t,r){switch(t.error.code){case e.WebClientErrorCode.TaskTypeRefreshExtractNotAllowed:return this.$translate.instant("extractTasksDatasourceNoExtract");case e.WebClientErrorCode.TaskTypeIncrementExtractNotAllowed:return this.$translate.instant("extractTasksDatasourceNoIncrementalExtract");case e.SchedulingErrorCode.SchedulingExtractTaskExistsForTarget:return this.$translate.instant("extractTasksRefreshAlreadyExistsForDatasource",{SCHEDULE:r.name});case e.CommonErrorCode.CallingUserInsufficientPermissions:return this.$translate.instant("extractTasksDatasourceErrorInsufficientPermissions");case e.UnifiedDatasourceErrorCode.OperationOnlySupportedForPublishedDatasource:return this.$translate.instant("errorOperationOnlySupportedForPublishedDatasource")}return this.createExtractErrorMessageFor(t,r)},n.$inject=["ConfirmActionDialog","ContentUrl","$translate","Workbooks","DataSources","SearchSuggestionsService","ActionHelpers","ModalService"],n}();e.CreateExtractTasksAction=n,e.Module.instance().service("CreateExtractTasksAction",n)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i,o,s){this.DataSourceErrors=e,this.ActionHelpers=t,this.ConfirmActionDialog=r,this.$translate=n,this.DataSources=i,this.suggestions=o,this.ModalService=s}return t.prototype.confirmChangeOwner=function(t,r){var n=this;if(t.all(function(e){return _.isObject(e.workbook)}))return this.ModalService.alert({titleId:"changeOwnerDatasources_cannotChangeOwnerAlertTitle",messageId:"changeOwnerDatasources_cannotChangeOwnerAlertMessage"}).result;var i={prompt:1===t.size()?this.$translate.instant("changeOwnerDatasourcePrompt",{NAME:e.L10n.elideIfLong(t.first().name)}):this.$translate.instant("changeOwnerDatasourcesPrompt",{COUNT:t.size()},e.L10n.Interpolations.Count),ownerQuery:function(e){return n.suggestions.usersWithoutGuest(e)},targetOwner:null},o=r.scope.$new();o.ownerPicker=i;var s=t.first().owner.id;return _.any(t.toArray(),function(e){return e.owner.id!==s})&&(s=null),this.ConfirmActionDialog.open({scope:o,title:this.$translate.instant("changeOwner"),bodyTemplateUrl:"changeOwnerDialog.html",actionName:this.$translate.instant("changeOwnerConfirm",{COUNT:t.size()},e.L10n.Interpolations.Count),action:function(e){return n.DataSources.setOwner(t.keys(),i.targetOwner.id).then(function(e){return n.notifyResult(t,e)})},confirmDisabled:function(){return!i.targetOwner||i.targetOwner.id===s}}).result.fin(function(){return o.$destroy()})},t.prototype.notifyResult=function(e,t){var r=this;this.ActionHelpers.notifyStandardError(e,{successId:"changeOwnerDatasourcesSuccess",errorId:"changeOwnerDatasourcesError"},function(e){return r.DataSourceErrors.errorDetailsFor(e)})(t)},t.$inject=["DataSourceErrors","ActionHelpers","ConfirmActionDialog","$translate","DataSources","SearchSuggestionsService","ModalService"],t}();e.ChangeDatasourceOwnerAction=t,e.Module.instance().service("ChangeDatasourceOwnerAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){function r(e){var t={};e.each(function(e){_.forEach(e.tags,function(e){t[e]=(t[e]||0)+1})});var r=_.map(t,function(t,r){var n={name:r};return e.size()>t&&(n.count=t),n});return _(r).sortBy(function(e){return e.name.toLowerCase()})}function n(t){var r=new e.Set(function(e){return e.name});return r.addItems(t),r}function i(e,t){var r={addTags:[],removeTags:[]},n={};return _.forEach(t,function(t){t.added&&r.addTags.push(t.name);var i=t.name,o=e.get(i)||e.get(a(i));o&&(n[o.name]=!0)}),r.removeTags=_.filter(e.keys(),function(e){return!n[e]}),r}function o(e){var t=[];e=e.replace(/"[^"]*?"/g,function(e){return t.push(e),""});var r=_.flatten(_.map(e.split(","),function(e){return e.split(" ")}));return _.union(t,r)}function s(e){return _(e).contains('"')?e:'"'+e+'"'}function a(e){return e.replace(/^"([^"]*)"$/,"$1")}function c(e){return _.escape(a(e)).replace(/ /g,"&nbsp;")}t.tagsListFromTaggedItemSet=r,t.tagSetFromTagsList=n,t.getTagsChange=i,t.parseTagString=o,t.quote=s,t.unquote=a,t.displayTagHtml=c}(t=e.TagsHelper||(e.TagsHelper={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r){this.ConfirmActionDialog=e,this.ActionHelpers=t,this.$translate=r}return t.prototype.createExecuteFn=function(t){var r=this;return function(n,i){var o=r.configureScope(i.scope,n,t.getDescription),s=e.TagsHelper.tagSetFromTagsList(o.tags.model),a={scope:o,bodyTemplateUrl:"confirmActionDialogTags.html",title:r.$translate.instant("changeTags"),actionName:r.$translate.instant("changeTagsConfirm"),action:function(){var r=e.TagsHelper.getTagsChange(s,o.tags.model);return t.changeTagsAction(n.keys(),r.addTags,r.removeTags)},position:{reserveHeight:450}},c=r.ConfirmActionDialog.open(a);return c.result.then(r.ActionHelpers.notifyStandardError(n,t.notificationIds,t.errorDetailFn)).fin(function(){return o.$destroy()}),c.result}},t.prototype.configureScope=function(t,r,n){var i=t.$new();return i.description=n(r),i.tags={model:e.TagsHelper.tagsListFromTaggedItemSet(r)},i},t.prototype.errorMessageFor=function(t){switch(t.error.code){case e.CommonErrorCode.CallingUserInsufficientPermissions:return this.$translate.instant("changeTagsErrorNoPermission");case e.TagErrorCode.TagNameTooLong:return this.$translate.instant("changeTagsErrorNameTooLong");default:return this.$translate.instant("errorUnknown")}},t.$inject=["ConfirmActionDialog","ActionHelpers","$translate","DataSources"],t}();e.ChangeTagsActionHelperService=t,e.Module.instance().service("ChangeTagsActionHelperService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,r,n,i,o){var s=this;this.ChangeTagsActionHelper=e,this.$translate=r,this.DataSources=n,this.ContentUrl=i,this.ModalService=o,this.execute=e.createExecuteFn({changeTagsAction:function(e,t,r){return s.DataSources.changeTags(e,t,r)},getDescription:function(e){return s.getDescription(e)},notificationIds:t.notificationTranslationIds,errorDetailFn:function(e){return s.changeTagsErrorDetail(e)}})}return t.prototype.getDescription=function(t){return 1===t.size()?this.$translate.instant("changeTagsDatasourceDescription",{NAME:e.L10n.elideIfLong(t.first().name)}):this.$translate.instant("changeTagsDatasourcesDescription",{COUNT:t.size()},e.L10n.Interpolations.Count)},t.prototype.showChangeTagsDialog=function(e,t){return e.all(function(e){return _.isObject(e.workbook)})?this.ModalService.alert({titleId:"changeTagsDatasource_cannotTagAlertTitle",messageId:"changeTagsDatasource_cannotTagAlertMessage"}).result:this.execute(e,t)},t.prototype.changeTagsErrorDetail=function(t){return{itemName:t.item.name,itemUrl:this.ContentUrl.forItem(t.item,e.DatasourceContentType),errorMessage:this.ChangeTagsActionHelper.errorMessageFor(t)}},t.notificationTranslationIds={successId:"changeTagsDatasourcesSuccess",errorId:"changeTagsDatasourcesError"},t.$inject=["ChangeTagsActionHelperService","$translate","DataSources","ContentUrl","ModalService"],t}();e.ChangeDatasourcesTagsAction=t,e.Module.instance().service("ChangeDatasourcesTagsAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i,o){this.ProjectErrors=e,this.ActionHelpers=t,this.ConfirmActionDialog=r,this.$translate=n,this.Projects=i,this.suggestions=o}return t.prototype.confirmChangeOwner=function(t,r){var n=this,i={prompt:1===t.size()?this.$translate.instant("changeOwnerProjectPrompt",{NAME:e.L10n.elideIfLong(t.first().name)}):this.$translate.instant("changeOwnerProjectsPrompt",{COUNT:t.size()},e.L10n.Interpolations.Count),ownerQuery:function(e){return n.suggestions.adminUsers(e)},targetOwner:null},o=r.scope.$new();return o.ownerPicker=i,this.ConfirmActionDialog.open({scope:o,title:this.$translate.instant("changeOwner"),bodyTemplateUrl:"changeOwnerDialog.html",actionName:this.$translate.instant("changeOwnerConfirm",{COUNT:t.size()},e.L10n.Interpolations.Count),action:function(e){return n.Projects.setOwner(t.keys(),i.targetOwner.id).then(function(e){return n.notifyResult(t,e)})},confirmDisabled:function(){return!i.targetOwner||!i.targetOwner.id}}).result.fin(function(){return o.$destroy()})},t.prototype.notifyResult=function(e,t){var r=this;this.ActionHelpers.notifyStandardError(e,{successId:"changeOwnerProjectsSuccess",errorId:"changeOwnerProjectsError"},function(e){return r.ProjectErrors.errorDetailsFor(e)})(t)},t.$inject=["ProjectErrors","ActionHelpers","ConfirmActionDialog","$translate","Projects","SearchSuggestionsService"],t}();e.ChangeProjectOwnerAction=t,e.Module.instance().service("ChangeProjectOwnerAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,r,n,i){var o=this;this.ChangeTagsActionHelper=e,this.$translate=r,this.Views=n,this.ContentUrl=i,this.execute=e.createExecuteFn({changeTagsAction:function(e,t,r){
return o.Views.changeTags(e,t,r)},getDescription:function(e){return o.getDescription(e)},notificationIds:t.notificationTranslationIds,errorDetailFn:function(e){return o.changeTagsErrorDetail(e)}})}return t.prototype.getDescription=function(t){return 1===t.size()?this.$translate.instant("changeTagsViewDescription",{NAME:e.L10n.elideIfLong(t.first().name)}):this.$translate.instant("changeTagsViewsDescription",{COUNT:t.size()},e.L10n.Interpolations.Count)},t.prototype.changeTagsErrorDetail=function(t){return{itemName:t.item.name,itemUrl:this.ContentUrl.forItem(t.item,e.ViewContentType),errorMessage:this.ChangeTagsActionHelper.errorMessageFor(t)}},t.notificationTranslationIds={successId:"changeTagsViewsSuccess",errorId:"changeTagsViewsError"},t.$inject=["ChangeTagsActionHelperService","$translate","Views","ContentUrl"],t}();e.ChangeViewTagsAction=t,e.Module.instance().service("ChangeViewTagsAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i,o){this.WorkbookErrors=e,this.ActionHelpers=t,this.ConfirmActionDialog=r,this.$translate=n,this.Workbooks=i,this.suggestions=o}return t.prototype.confirmChangeOwner=function(t,r){var n=this,i={prompt:1===t.size()?this.$translate.instant("changeOwnerWorkbookPrompt",{NAME:e.L10n.elideIfLong(t.first().name)}):this.$translate.instant("changeOwnerWorkbooksPrompt",{COUNT:t.size()},e.L10n.Interpolations.Count),ownerQuery:function(e){return n.suggestions.usersWithoutGuest(e)},targetOwner:null},o=r.scope.$new();return o.ownerPicker=i,this.ConfirmActionDialog.open({scope:o,title:this.$translate.instant("changeOwner"),bodyTemplateUrl:"changeOwnerDialog.html",actionName:this.$translate.instant("changeOwnerConfirm",{COUNT:t.size()},e.L10n.Interpolations.Count),action:function(e){return n.Workbooks.setOwner(t.keys(),i.targetOwner.id).then(function(e){return n.notifyResult(t,e)})},confirmDisabled:function(){return!i.targetOwner||!i.targetOwner.id}}).result.fin(function(){return o.$destroy()})},t.prototype.notifyResult=function(e,t){var r=this;this.ActionHelpers.notifyStandardError(e,{successId:"changeOwnerWorkbooksSuccess",errorId:"changeOwnerWorkbooksError"},function(e){return r.WorkbookErrors.errorDetailsFor(e)})(t)},t.$inject=["WorkbookErrors","ActionHelpers","ConfirmActionDialog","$translate","Workbooks","SearchSuggestionsService"],t}();e.ChangeWorkbookOwnerAction=t,e.Module.instance().service("ChangeWorkbookOwnerAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,r,n,i){var o=this;this.ChangeTagsActionHelper=e,this.$translate=r,this.Workbooks=n,this.ContentUrl=i,this.execute=e.createExecuteFn({changeTagsAction:function(e,t,r){return o.Workbooks.changeTags(e,t,r)},getDescription:function(e){return o.getDescription(e)},notificationIds:t.notificationTranslationIds,errorDetailFn:function(e){return o.changeTagsErrorDetail(e)}})}return t.prototype.getDescription=function(t){return 1===t.size()?this.$translate.instant("changeTagsWorkbookDescription",{NAME:e.L10n.elideIfLong(t.first().name)}):this.$translate.instant("changeTagsWorkbooksDescription",{COUNT:t.size()},e.L10n.Interpolations.Count)},t.prototype.changeTagsErrorDetail=function(t){return{itemName:t.item.name,itemUrl:this.ContentUrl.forItem(t.item,e.WorkbookContentType),errorMessage:this.ChangeTagsActionHelper.errorMessageFor(t)}},t.notificationTranslationIds={successId:"changeTagsWorkbooksSuccess",errorId:"changeTagsWorkbooksError"},t.$inject=["ChangeTagsActionHelperService","$translate","Workbooks","ContentUrl"],t}();e.ChangeWorkbooksTagsAction=t,e.Module.instance().service("ChangeWorkbooksTagsAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n){this.ConfirmActionDialog=e,this.$translate=t,this.toaster=r,this.Projects=n}return t.prototype.execute=function(t){var r=this,n=t.scope.$new();return n.dialog={name:"",description:""},this.ConfirmActionDialog.open({scope:n,title:this.$translate.instant("createProjectDialogTitle"),bodyTemplateUrl:"createProjectDialog.html",position:{reserveHeight:750},actionName:this.$translate.instant("createProjectDialogSubmit"),action:function(t){return r.Projects.create(n.dialog.name,n.dialog.description).then(function(i){return i.errors&&i.errors.length?t.showErrorMessage(r.errorMessage(i.errors)):r.toaster.pop({type:e.ToastType.Info,text:r.$translate.instant("createProjectSuccess",{PROJECT_NAME:e.L10n.elideIfLong(n.dialog.name)})}),i})}}).result.fin(function(){return n.$destroy()})},t.prototype.errorMessage=function(t){switch(t[0].code){case e.ProjectErrorCode.ProjectNameAlreadyExists:return this.$translate.instant("errorProjectNameAlreadyExists");default:return this.$translate.instant("createProjectFailed")}},t.$inject=["ConfirmActionDialog","$translate","ToasterService","Projects"],t}();e.CreateProjectAction=t,e.Module.instance().service("CreateProjectAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i,o){this.DataSourceErrors=e,this.ActionHelpers=t,this.ConfirmActionDialog=r,this.$translate=n,this.DataSources=i,this.ModalService=o}return t.prototype.confirmDeleteDatasource=function(t,r){return this.confirmDeleteDatasources(e.Set.singleton(t,function(e){return e.id}),r)},t.prototype.confirmDeleteDatasources=function(t,r){var n=this;if(t.all(function(e){return _.isObject(e.workbook)}))return this.ModalService.alert({titleId:"deleteDatasources_cannotDeleteAlertTitle",messageId:"deleteDatasources_cannotDeleteAlertMessage"}).result.then(function(){return{allowed:!1}});var i=1===t.size()?this.$translate.instant("confirmDeleteDatasource",{DATASOURCE_NAME:e.L10n.elideIfLong(t.first().name)}):this.$translate.instant("confirmDeleteDatasources",{DATASOURCE_COUNT:t.size()},e.L10n.Interpolations.Count);return this.ConfirmActionDialog.open({scope:r.scope,title:this.$translate.instant("delete"),bodyText:i,actionName:this.$translate.instant("confirmDeleteButton",{ITEM_COUNT:t.size()},e.L10n.Interpolations.Count),isDeleteAction:!0,action:function(e){return n.DataSources.del(t.keys()).then(function(e){return n.notifyResult(t,e)})}}).result.then(function(e){return{allowed:!0,serverResult:e}})},t.prototype.notifyResult=function(e,t){var r=this;this.ActionHelpers.notifyStandardError(e,{successId:"deleteDatasourcesSuccess",errorId:"deleteDatasourcesError"},function(e){return r.DataSourceErrors.errorDetailsFor(e)})(t)},t.$inject=["DataSourceErrors","ActionHelpers","ConfirmActionDialog","$translate","DataSources","ModalService"],t}();e.DeleteDatasourcesAction=t,e.Module.instance().service("DeleteDatasourcesAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i){this.ProjectErrors=e,this.ActionHelpers=t,this.ConfirmActionDialog=r,this.$translate=n,this.Projects=i}return t.prototype.confirmDeleteProjects=function(t,r){var n=this,i=t.sum(function(e){return e.workbookCount}),o=t.sum(function(e){return e.datasourceCount}),s=1===t.size()?this.$translate.instant("confirmDeleteProject",{PROJECT_NAME:e.L10n.elideIfLong(t.first().name),WORKBOOK_COUNT:i,DATASOURCE_COUNT:o},e.L10n.Interpolations.Count):this.$translate.instant("confirmDeleteProjects",{PROJECT_COUNT:t.size(),WORKBOOK_COUNT:i,DATASOURCE_COUNT:o},e.L10n.Interpolations.Count);return this.ConfirmActionDialog.open({scope:r.scope,title:this.$translate.instant("delete"),bodyText:s,actionName:this.$translate.instant("confirmDeleteButton",{ITEM_COUNT:t.size()},e.L10n.Interpolations.Count),isDeleteAction:!0,action:function(e){return n.Projects.del(t.keys()).then(function(e){return n.notifyResult(t,e)})}}).result},t.prototype.notifyResult=function(e,t){var r=this;this.ActionHelpers.notifyStandardError(e,{successId:"deleteProjectsSuccess",errorId:"deleteProjectsError"},function(e){return r.ProjectErrors.errorDetailsFor(e)})(t)},t.$inject=["ProjectErrors","ActionHelpers","ConfirmActionDialog","$translate","Projects"],t}();e.DeleteProjectsAction=t,e.Module.instance().service("DeleteProjectsAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i,o,s){this.$translate=e,this.$state=t,this.server=r,this.SiteSwitchService=n,this.ConfirmActionDialog=i,this.Sites=o,this.ToasterService=s}return t.prototype.execute=function(t,r){var n=this;return this.ConfirmActionDialog.open({title:this.$translate.instant("delete"),bodyText:this.$translate.instant("confirmDeleteSites",{ITEM_COUNT:t.size(),ITEM_NAME:e.L10n.elideIfLong(t.first().settings.name)},e.L10n.Interpolations.Count),actionName:this.$translate.instant("confirmDeleteButton",{ITEM_COUNT:t.size()},e.L10n.Interpolations.Count),isDeleteAction:!0,action:function(e){n.sites=t,n.confirmActionDialogInstance=e;var r=""!==n.server.sessionSiteUrlName()&&!_.isUndefined(n.sites.find(function(e){return n.server.isCurrentSiteUrlName(e.settings.urlName)}));return r?n.SiteSwitchService.switchIfNeededNoFeedback("").then(function(){return n.deleteSites()},function(){return n.deleteSites().then(function(){return n.$state.go("login.authenticate")})}):n.deleteSites()}}).result},t.prototype.deleteSites=function(){var e=this;return this.Sites.del(this.sites.keys()).then(function(t){return e.onComplete(t)},function(t){return e.onFail(t)},function(t){return e.onNotify(t)})},t.prototype.onComplete=function(t){t&&t.succeeded===!1?this.onFail(t.response&&t.response.errors):(this.confirmActionDialogInstance.setProgress(100),this.ToasterService.pop({type:e.ToastType.Info,text:this.$translate.instant("deleteSitesSuccess",{ITEM_COUNT:this.sites.size()},e.L10n.Interpolations.Count)}),this.server.refreshSessionInfo())},t.prototype.onFail=function(t){var r=this.sites.size();if(this.confirmActionDialogInstance.setProgress(void 0),t&&t.length){r-=t.length;var n=_.find(t,function(t){return t.code===e.SiteSettingsErrorCode.AttemptedToDeleteDefaultSite});n&&this.ToasterService.pop({type:e.ToastType.Error,text:this.$translate.instant("siteSettingsFailedAttemptedToDeleteDefaultSite")}),(t.length>1||!n)&&this.confirmActionDialogInstance.showErrorMessage(this.$translate.instant("deleteSitesFailed",{ITEM_COUNT:t.length},e.L10n.Interpolations.Count)),r>0&&(this.ToasterService.pop({type:e.ToastType.Info,text:this.$translate.instant("deleteSitesSuccess",{ITEM_COUNT:r},e.L10n.Interpolations.Count)}),this.server.refreshSessionInfo())}else this.confirmActionDialogInstance.showErrorMessage(this.$translate.instant("deleteSitesFailed",{ITEM_COUNT:this.sites.size()},e.L10n.Interpolations.Count))},t.prototype.onNotify=function(e){this.confirmActionDialogInstance.setProgress(e.percentComplete)},t.$inject=["$translate","$state","ServerService","SiteSwitchService","ConfirmActionDialog","Sites","ToasterService"],t}();e.DeleteSitesAction=t,e.Module.instance().service("DeleteSitesAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i){this.WorkbookErrors=e,this.ActionHelpers=t,this.ConfirmActionDialog=r,this.$translate=n,this.Workbooks=i}return t.prototype.confirmDeleteWorkbooks=function(t,r){var n=this,i=t.sum(function(e){return e.numSheets}),o=1===t.size()?this.$translate.instant("confirmDeleteWorkbook",{WORKBOOK_NAME:e.L10n.elideIfLong(t.first().name),VIEW_COUNT:i},e.L10n.Interpolations.Count):this.$translate.instant("confirmDeleteWorkbooks",{WORKBOOK_COUNT:t.size(),VIEW_COUNT:i},e.L10n.Interpolations.Count);return this.ConfirmActionDialog.open({scope:r.scope,title:this.$translate.instant("delete"),bodyText:o,actionName:this.$translate.instant("confirmDeleteButton",{ITEM_COUNT:t.size()},e.L10n.Interpolations.Count),isDeleteAction:!0,action:function(e){return n.Workbooks.del(t.keys()).then(function(e){return n.notifyResult(t,e)})}}).result},t.prototype.notifyResult=function(e,t){var r=this;this.ActionHelpers.notifyStandardError(e,{successId:"deleteWorkbooksSuccess",errorId:"deleteWorkbooksError"},function(e){return r.WorkbookErrors.errorDetailsFor(e)})(t)},t.$inject=["WorkbookErrors","ActionHelpers","ConfirmActionDialog","$translate","Workbooks"],t}();e.DeleteWorkbooksAction=t,e.Module.instance().service("DeleteWorkbooksAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i,o){this.$translate=e,this.$q=t,this.toaster=r,this.windowLocationService=n,this.Workbooks=i,this.DataSources=o}return t.prototype.download=function(e){return e.downloadUrl?(this.windowLocationService.download(e.downloadUrl),!0):!1},t.prototype.downloadWorkbook=function(t){var r=this;return this.Workbooks.getById(t.id).then(function(t){var n=r.download(t);return n||r.toaster.pop({type:e.ToastType.Error,text:r.$translate.instant("downloadDatasourceError",{NAME:e.L10n.elideIfLong(t.name)})}),t}).fail(function(n){return r.toaster.pop({type:e.ToastType.Error,text:r.$translate.instant("downloadWorkbookError",{NAME:e.L10n.elideIfLong(t.name)})}),r.$q.reject(n)})},t.prototype.downloadDatasource=function(t){var r=this;return this.DataSources.getById(t.id).then(function(t){var n=r.download(t);return n||r.toaster.pop({type:e.ToastType.Error,text:r.$translate.instant("downloadDatasourceError",{NAME:e.L10n.elideIfLong(t.name)})}),t}).fail(function(n){return r.toaster.pop({type:e.ToastType.Error,text:r.$translate.instant("downloadDatasourceError",{NAME:e.L10n.elideIfLong(t.name)})}),r.$q.reject(n)})},t.prototype.downloadWorkbookRevision=function(t){var r=this.download(t);r||this.toaster.pop({type:e.ToastType.Error,text:this.$translate.instant("downloadRevisionError")})},t.$inject=["$translate","$q","ToasterService","WindowLocationService","Workbooks","DataSources"],t}();e.DownloadActions=t,e.Module.instance().service("DownloadActions",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i,o,s){this.ConfirmActionDialog=e,this.$translate=t,this.$timeout=r,this.$window=n,this.$q=i,this.toaster=o,this.server=s}return t.prototype.execute=function(t,r){var n=this,i=r.scope.$new();return i.siteSettingsForServerAdminFormState={},i.siteSettingsForSiteAdminFormState={},i.siteSettingsForServerAdmin=angular.copy(t),i.siteSettingsForSiteAdmin={id:t.id,siteAdminSettings:angular.copy(t.siteAdminSettings)},i.isDefaultSite=""===t.settings.urlName,i.liveDBAvailable=this.server.isLiveDBAvailable(),this.ConfirmActionDialog.open({scope:i,title:this.$translate.instant("editSiteSettings"),bodyTemplateUrl:"siteDialog.html",actionName:this.$translate.instant("save"),confirmDisabled:function(){return _.isEmpty(i.siteSettingsForServerAdminFormState)||i.siteSettingsForServerAdminFormState.isFormUnchanged()&&i.siteSettingsForSiteAdminFormState.isFormUnchanged()||!i.siteSettingsForServerAdminFormState.isValid()},action:function(){return n.$q.all([i.siteSettingsForServerAdminFormState.save(),i.siteSettingsForSiteAdminFormState.save()]).then(function(){return n.$timeout(function(){n.toaster.pop({type:e.ToastType.Info,text:n.$translate.instant("settingsUpdateSuccess")}),_.extend(t,i.siteSettingsForServerAdmin),_.extend(t.siteAdminSettings,i.siteSettingsForSiteAdmin.siteAdminSettings)},e.ErrorNotifyingServer.ResponseDelay)})},size:e.ModalSize.fitToContent}).result.fin(function(){return i.$destroy()})},t.$inject=["ConfirmActionDialog","$translate","$timeout","$window","$q","ToasterService","ServerService"],t}();e.EditSiteAction=t,e.Module.instance().service("EditSiteAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e,t){this.items=e,this.serverResult=t,this.errorCount=t.errors?t.errors.length:0,this.successCount=e.size()-this.errorCount}return e.prototype.anySucceeded=function(){return this.successCount>0},e.prototype.anyFailed=function(){return this.errorCount>0},e.prototype.errorItems=function(){var e=this;return _.map(this.serverResult.errors,function(t){return{error:t,item:e.items.get(t.id)}})},e.prototype.firstSuccessfulItem=function(){var e=this;return 0===this.successCount?null:_.once(function(){var t=_.map(e.serverResult.errors,function(e){return e.id}),r=_.difference(e.items.keys(),t);return e.items.get(r[0])})()},e}();e.MultipleItemResult=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t){this.$translate=e,this.ContentActionNotification=t}return t.prototype.standardErrorDetails=function(e,r,n,i){return void 0===i&&(i=t.DefaultItemNameFn),i=i||function(e){return e.name},_.map(e.errorItems(),function(e){return{itemName:i(e.item),itemUrl:r(e.item),errorMessage:n(e)}})},t.prototype.standardErrorNotification=function(r,n,i,o){var s=this;void 0===o&&(o=t.DefaultItemNameFn);var a=r.anyFailed()?r.errorItems()[0]:void 0,c=a&&a.item?o(a.item):"";return e.MultipleResultNotificationOptions.create(r,{describeSuccessSummary:function(t){return s.$translate.instant(n.successId,{ITEM_COUNT:t,ITEM_NAME:e.L10n.elideIfLong(o(r.firstSuccessfulItem()))},e.L10n.Interpolations.Count)},describeErrorSummary:function(t){return s.$translate.instant(n.errorId,{ERROR_COUNT:t,ITEM_NAME:e.L10n.elideIfLong(c)},e.L10n.Interpolations.Count)},describeErrorDetail:i})},t.prototype.notifyStandardError=function(t,r,n){var i=this;return function(o){var s=new e.MultipleItemResult(t,o),a=i.standardErrorNotification(s,r,n);return i.ContentActionNotification.notify(a),o}},t.deselectNotFound=function(t,r,n){t.removeItemsIn(e.ResultHelper.getErrorIdsWithCode(r,n))},t.deselectAllExceptErrors=function(t,r,n){t.removeItemsNotIn(e.ResultHelper.getErrorIds(r,{excludeCode:n}))},t.$inject=["$translate","ContentActionNotification"],t.DefaultItemNameFn=function(e){return e.name},t}();e.ActionHelpers=t,e.Module.instance().service("ActionHelpers",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i,o,s,a,c){this.ConfirmActionDialog=e,this.$translate=t,this.ContentActionNotification=r,this.suggestions=n,this.Workbooks=i,this.WorkbookErrors=o,this.DataSources=s,this.DataSourceErrors=a,this.ModalService=c}return t.prototype.moveWorkbooks=function(t,r){var n=this;return this.move({promptId:"selectProjectForWorkbooks",successId:"moveWorkbooksToProjectSuccess",errorId:"moveWorkbooksToProjectError"},t,e.WorkbookContentType,function(e){return n.Workbooks.moveToProject(e,t.keys())},r)},t.prototype.moveDatasources=function(t,r){var n=this;return t.all(function(e){return _.isObject(e.workbook)})?this.ModalService.alert({titleId:"moveDatasourcesToProject_cannotMoveAlertTitle",messageId:"moveDatasourcesToProject_cannotMoveAlertMessage"}).result:this.move({promptId:"selectProjectForDatasources",successId:"moveDatasourcesToProjectSuccess",errorId:"moveDatasourcesToProjectError"},t,e.DatasourceContentType,function(e){return n.DataSources.moveToProject(e,t.keys())},r)},t.prototype.move=function(t,r,n,i,o){var s=this,a={prompt:this.$translate.instant(t.promptId,{ITEM_COUNT:r.size(),ITEM_NAME:e.L10n.elideIfLong(r.first().name)},e.L10n.Interpolations.Count),projectsQuery:function(e){return s.suggestions.projects(e)},targetProject:null},c=o.scope.$new();c.projectPicker=a;var l=this.ConfirmActionDialog.open({scope:c,title:this.$translate.instant("moveToProject"),bodyTemplateUrl:"moveToProjectDialog.html",actionName:this.$translate.instant("confirmMoveToProject",{ITEM_COUNT:r.size()},e.L10n.Interpolations.Count),action:function(){return i(a.targetProject.id)},confirmDisabled:function(){return!a.targetProject}});return l.result.then(function(i){s.ContentActionNotification.notify(s.notification(new e.MultipleItemResult(r,i),t,n,a.targetProject.name))}),l.result.fin(function(){return c.$destroy()})},t.prototype.notification=function(t,r,n,i){var o=this;return e.MultipleResultNotificationOptions.create(t,{describeSuccessSummary:function(t){return o.$translate.instant(r.successId,{ITEM_COUNT:t,PROJECT_NAME:e.L10n.elideIfLong(i)},e.L10n.Interpolations.Count)},describeErrorSummary:function(t){return o.$translate.instant(r.errorId,{ERROR_COUNT:t,PROJECT_NAME:e.L10n.elideIfLong(i)},e.L10n.Interpolations.Count)},describeErrorDetail:function(t){return n===e.DatasourceContentType?o.DataSourceErrors.errorDetailsFor(t):o.WorkbookErrors.errorDetailsFor(t)}})},t.$inject=["ConfirmActionDialog","$translate","ContentActionNotification","SearchSuggestionsService","Workbooks","WorkbookErrors","DataSources","DataSourceErrors","ModalService"],t}();e.MoveToProjectAction=t,e.Module.instance().service("MoveToProjectAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n){this.ConfirmActionDialog=e,this.$translate=t,this.toaster=r,this.Projects=n}return t.prototype.execute=function(t,r){var n=this,i=r.scope.$new();return i.description=this.$translate.instant("confirmRenameProject",{PROJECT_NAME:e.L10n.elideIfLong(t.name)}),i.input={text:t.name,maxLength:255},this.ConfirmActionDialog.open({title:this.$translate.instant("rename"),bodyTemplateUrl:"confirmActionDialogInput.html",scope:i,actionName:this.$translate.instant("rename"),action:function(r){return n.Projects.rename(t.id,i.input.text).then(function(o){return o.errors&&o.errors.length?r.showErrorMessage(n.getErrorMessage(o.errors[0],t)):(n.toaster.pop({type:e.ToastType.Info,text:n.$translate.instant("projectRenamed",{PROJECT_NAME:e.L10n.elideIfLong(i.input.text)})}),t.name=i.input.text),o})}}).result.fin(function(){return i.$destroy()})},t.prototype.executeInPlace=function(t,r){var n=this;return this.Projects.rename(t.id,r).then(function(i){return i.errors&&i.errors.length?n.toaster.pop({type:e.ToastType.Error,text:n.getErrorMessage(i.errors[0],t)}):t.name=r,i})},t.prototype.getErrorMessage=function(t,r){switch(t.code){case e.ProjectErrorCode.ProjectNameAlreadyExists:return this.$translate.instant("errorProjectNameAlreadyExists");default:return this.$translate.instant("projectRenameError",{PROJECT_NAME:e.L10n.elideIfLong(r.name)})}},t.$inject=["ConfirmActionDialog","$translate","ToasterService","Projects"],t}();e.RenameProjectAction=t,e.Module.instance().service("RenameProjectAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t){this.$state=e,this.$translate=t}return t.prototype.errorDetailsFor=function(t){return{itemName:t.item.name,itemUrl:t.error.code===e.CommonErrorCode.WorkbookNotFound?null:this.workbookUrl(t.item),errorMessage:this.errorMessageFor(t)}},t.prototype.workbookUrl=function(e){return this.$state.href("main.site.content.workbook.details",{id:e.id})},t.prototype.errorMessageFor=function(t){var r=t.item;switch(t.error.code){case e.WorkbookErrorCode.WorkbookDescriptionTooLong:return this.$translate.instant("errorWorkbookDescriptionTooLong");case e.CommonErrorCode.WorkbookNotFound:return this.$translate.instant("errorWorkbookNotFound",{WORKBOOK_NAME:e.L10n.elideIfLong(r.name)});case e.WorkbookErrorCode.WorkbookDisabled:return this.$translate.instant("errorWorkbookDisabled",{WORKBOOK_NAME:e.L10n.elideIfLong(r.name)});case e.WorkbookErrorCode.WorkbookNameAlreadyExistsInDestinationProject:return this.$translate.instant("errorWorkbookNameAlreadyExistsInDestinationProject");case e.WorkbookErrorCode.WorkbookDestinationProjectNotFound:return this.$translate.instant("errorWorkbookDestinationProjectNotFound");case e.WorkbookErrorCode.WorkbookMoveInsufficientPermissionsOnDestinationProject:case e.WorkbookErrorCode.WorkbookMoveInsufficientPermissionsOnSourceProject:case e.WorkbookErrorCode.WorkbookMoveInsufficientPermissionsOnWorkbook:return this.$translate.instant("errorWorkbookMoveInsufficientPermissions");case e.CommonErrorCode.CallingUserInsufficientPermissions:return this.$translate.instant("errorWorkbookInsufficientPermissions");default:return this.$translate.instant("errorUnknown")}},t.$inject=["$state","$translate"],t}();e.WorkbookErrors=t,e.Module.instance().service("WorkbookErrors",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i){this.ConfirmActionDialog=e,this.$translate=t,this.Workbooks=r,this.WorkbookErrors=n,this.ActionHelpers=i}return t.prototype.setDisplayTabs=function(t,r){return this.setDisplayTabsAction(e.Set.singleton(t,function(e){return e.id}),r)()},t.prototype.confirmSetDisplayTabs=function(t,r){var n=t.toArray(),i=_.any(n,function(e){return e.displayTabs}),o=_.any(n,function(e){return!e.displayTabs});return this.ConfirmActionDialog.open({scope:r.scope,title:this.$translate.instant("confirmSetDisplayTabsTitle"),bodyText:this.$translate.instant("confirmSetDisplayTabsPrompt",{ITEM_COUNT:t.size(),ITEM_NAME:e.L10n.elideIfLong(t.first().name)},e.L10n.Interpolations.Count),buttons:[{label:this.$translate.instant("confirmSetDisplayTabsShowButton"),testId:"confirm-show-tabs",action:this.setDisplayTabsAction(t,!0),disabled:function(){return!o}},{label:this.$translate.instant("confirmSetDisplayTabsHideButton"),testId:"confirm-hide-tabs",action:this.setDisplayTabsAction(t,!1),disabled:function(){return!i}}],size:"600px"}).result},t.prototype.setDisplayTabsAction=function(e,t){var r=this;return function(){return r.Workbooks.setDisplayTabs(e.keys(),t).then(function(n){return r.notifyResult(t,e,n)})}},t.prototype.notifyResult=function(e,t,r){var n=this;this.ActionHelpers.notifyStandardError(t,{successId:e?"setDisplayTabsShowSuccess":"setDisplayTabsHideSuccess",errorId:e?"setDisplayTabsShowError":"setDisplayTabsHideError"},function(e){return n.WorkbookErrors.errorDetailsFor(e)})(r)},t.$inject=["ConfirmActionDialog","$translate","Workbooks","WorkbookErrors","ActionHelpers"],t}();e.SetDisplayTabsAction=t,e.Module.instance().service("SetDisplayTabsAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n){this.ConfirmActionDialog=e,this.$translate=t,this.toaster=r,this.Sites=n}return t.prototype.execute=function(t,r){var n=this;return this.ConfirmActionDialog.open({title:this.$translate.instant("suspendSites"),bodyText:this.$translate.instant("confirmSuspendSites",{SITE_NAME:e.L10n.elideIfLong(t.first().settings.name),ITEM_COUNT:t.size()},e.L10n.Interpolations.Count),actionName:this.$translate.instant("suspendButtonConfirm",{ITEM_COUNT:t.size()},e.L10n.Interpolations.Count),isDeleteAction:!0,action:function(r){return n.Sites.suspend(t.keys()).then(function(i){return i.errors&&i.errors.length?1===i.errors.length&&i.errors[0].code===e.SiteSettingsErrorCode.AttemptedToSuspendDefaultSite?(n.toaster.pop({type:e.ToastType.Error,text:n.$translate.instant("siteSettingsFailedAttemptedToSuspendDefaultSite")}),n.toaster.pop({type:e.ToastType.Info,text:n.$translate.instant("sitesSuspendSuccess",{ITEM_COUNT:t.size()-1},e.L10n.Interpolations.Count)})):r.showErrorMessage(n.$translate.instant("sitesSuspendFailed")):n.toaster.pop({type:e.ToastType.Info,text:n.$translate.instant("sitesSuspendSuccess",{ITEM_COUNT:t.size()},e.L10n.Interpolations.Count)}),i})}}).result},t.$inject=["ConfirmActionDialog","$translate","ToasterService","Sites"],t}();e.SuspendSitesAction=t,e.Module.instance().service("SuspendSitesAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i,o,s,a,c,l,u,d,p,h,f,m,v,S,g,y,A,P,C,b,R){this.windowLocationService=e,this.contentActionNotification=t,this.ActionHelpers=r,this.Projects=n,this.Workbooks=i,this.DataSources=o,this.Views=s,this.ChangeDatasourceOwnerAction=a,this.ChangeProjectOwnerAction=c,this.ChangeWorkbookOwnerAction=l,this.MoveToProjectAction=u,this.DeleteDatasourcesAction=d,this.DeleteProjectsAction=p,this.DeleteWorkbooksAction=h,this.CreateProjectAction=f,this.RenameProjectAction=m,this.ChangeViewTagsAction=v,this.ChangeWorkbooksTagsAction=S,this.ChangeDatasourcesTagsAction=g,this.SuspendSitesAction=y,this.ActivateSitesAction=A,this.DeleteSitesAction=P,this.EditSiteAction=C,this.CreateExtractTasksAction=b,this.DownloadActions=R}return t.prototype.deleteProject=function(t,r){var n=this;return this.Projects.all().withFilters([e.Filter.fieldEq("id",t.id)]).getFirst().then(function(e){return n.deleteProjects(n.singleton(e),r)})},t.prototype.deleteProjects=function(e,t){return this.DeleteProjectsAction.confirmDeleteProjects(e,t)},t.prototype.deleteWorkbook=function(t,r){var n=this;return this.Workbooks.all().withFilters([e.Filter.fieldEq("id",t.id)]).getFirst().then(function(e){return n.deleteWorkbooks(n.singleton(e),r)})},t.prototype.deleteWorkbooks=function(e,t){return this.DeleteWorkbooksAction.confirmDeleteWorkbooks(e,t)},t.prototype.moveWorkbooksToProject=function(e,t){return this.MoveToProjectAction.moveWorkbooks(e,t)},t.prototype.moveDatasourcesToProject=function(e,t){return this.MoveToProjectAction.moveDatasources(e,t)},t.prototype.createProject=function(e){return this.CreateProjectAction.execute(e)},t.prototype.singleton=function(t){return e.Set.singleton(t,function(e){return e.id})},t.prototype.renameProjectPopup=function(e,t){return this.RenameProjectAction.execute(e,t)},t.prototype.renameProject=function(e,t){return this.RenameProjectAction.executeInPlace(e,t)},t.prototype.downloadWorkbook=function(e){return this.DownloadActions.downloadWorkbook(e)},t.prototype.downloadDatasource=function(e){return this.DownloadActions.downloadDatasource(e)},t.prototype.changeOwnerOnDatasources=function(e,t){return this.ChangeDatasourceOwnerAction.confirmChangeOwner(e,t)},t.prototype.changeOwnerOnProjects=function(e,t){return this.ChangeProjectOwnerAction.confirmChangeOwner(e,t)},t.prototype.changeOwnerOnWorkbooks=function(e,t){return this.ChangeWorkbookOwnerAction.confirmChangeOwner(e,t)},t.prototype.suspendSite=function(e,t){return this.SuspendSitesAction.execute(e,t)},t.prototype.activateSite=function(e,t){return this.ActivateSitesAction.execute(e,t)},t.prototype.editSite=function(e,t){return this.EditSiteAction.execute(e,t)},t.prototype.deleteSites=function(e,t){return this.DeleteSitesAction.execute(e,t)},t.prototype.authoring=function(e){this.windowLocationService.open(e)},t.prototype.editWorkbook=function(e){this.authoring(e.editUrl)},t.prototype.editView=function(e){this.authoring(e.editUrl)},t.prototype.newWorkbook=function(e){this.authoring(e.newWorkbookUrl)},t.prototype.handleSingleItemResponse=function(t,r){var n=this;return function(i){var o=e.Set.singleton(t,function(e){return e.id});return n.contentActionNotification.notifyResult(o,i.errors,r),i}},t.prototype.setTagsOnViews=function(e,t){return this.ChangeViewTagsAction.execute(e,t)},t.prototype.setTagsOnView=function(t,r){var n=this,i=_.difference(r,t.tags),o=_.difference(t.tags,r);return this.Views.changeTags([t.id],i,o).then(this.ActionHelpers.notifyStandardError(e.Set.fromIdItemArray([t]),e.ChangeViewTagsAction.notificationTranslationIds,function(e){return n.ChangeViewTagsAction.changeTagsErrorDetail(e)}))},t.prototype.setTagsOnWorkbook=function(t,r){var n=this,i=_.difference(r,t.tags),o=_.difference(t.tags,r);return this.Workbooks.changeTags([t.id],i,o).then(this.ActionHelpers.notifyStandardError(e.Set.fromIdItemArray([t]),e.ChangeWorkbooksTagsAction.notificationTranslationIds,function(e){return n.ChangeWorkbooksTagsAction.changeTagsErrorDetail(e)}))},t.prototype.setTagsOnWorkbooks=function(e,t){return this.ChangeWorkbooksTagsAction.execute(e,t)},t.prototype.setTagsOnDatasource=function(t,r){var n=this,i=_.difference(r,t.tags),o=_.difference(t.tags,r);return this.DataSources.changeTags([t.id],i,o).then(this.ActionHelpers.notifyStandardError(e.Set.fromIdItemArray([t]),e.ChangeDatasourcesTagsAction.notificationTranslationIds,function(e){return n.ChangeDatasourcesTagsAction.changeTagsErrorDetail(e)}))},t.prototype.setTagsOnDatasources=function(e,t){return this.ChangeDatasourcesTagsAction.showChangeTagsDialog(e,t)},t.$inject=["WindowLocationService","ContentActionNotification","ActionHelpers","Projects","Workbooks","DataSources","Views","ChangeDatasourceOwnerAction","ChangeProjectOwnerAction","ChangeWorkbookOwnerAction","MoveToProjectAction","DeleteDatasourcesAction","DeleteProjectsAction","DeleteWorkbooksAction","CreateProjectAction","RenameProjectAction","ChangeViewTagsAction","ChangeWorkbooksTagsAction","ChangeDatasourcesTagsAction","SuspendSitesAction","ActivateSitesAction","DeleteSitesAction","EditSiteAction","CreateExtractTasksAction","DownloadActions"],
t}();e.ContentActions=t,e.Module.instance().service("ContentActions",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r){this.$translate=e,this.toaster=t,this.DataSources=r}return t.prototype.execute=function(t,r){var n=this;return this.DataSources.setDescription(t.id,r).then(function(r){return r.errors&&r.errors.length&&n.toaster.pop({type:e.ToastType.Error,text:n.errorMessageFor(r.errors[0],t)}),r})},t.prototype.errorMessageFor=function(t,r){switch(t.code){case e.DatasourceErrorCode.DatasourceDescriptionGreaterThanMaxLength:return this.$translate.instant("errorDatasourceDescriptionTooLong");case e.CommonErrorCode.DatasourceNotFound:return this.$translate.instant("errorDatasourceNotFound",{DATASOURCE_NAME:e.L10n.elideIfLong(r.name)});default:return this.$translate.instant("errorUnknown")}},t.$inject=["$translate","ToasterService","DataSources"],t}();e.ChangeDatasourceDescriptionAction=t,e.Module.instance().service("ChangeDatasourceDescriptionAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r){this.$translate=e,this.toaster=t,this.Projects=r}return t.prototype.execute=function(t,r){var n=this;return this.Projects.setDescription(t.id,r).then(function(r){return r.errors&&r.errors.length&&n.toaster.pop({type:e.ToastType.Error,text:n.errorMessageFor(r.errors[0],t)}),r})},t.prototype.errorMessageFor=function(t,r){switch(t.code){case e.ProjectErrorCode.ProjectDescriptionGreaterThanMaxLength:return this.$translate.instant("errorProjectDescriptionTooLong");case e.CommonErrorCode.ProjectNotFound:return this.$translate.instant("errorProjectNotFound",{PROJECT_NAME:e.L10n.elideIfLong(r.name)});default:return this.$translate.instant("errorUnknown")}},t.$inject=["$translate","ToasterService","Projects"],t}();e.ChangeProjectDescriptionAction=t,e.Module.instance().service("ChangeProjectDescriptionAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n){this.$translate=e,this.toaster=t,this.Workbooks=r,this.WorkbookErrors=n}return t.prototype.execute=function(t,r){var n=this;return this.Workbooks.setDescription(t.id,r).then(function(r){return r.errors&&r.errors.length&&n.toaster.pop({type:e.ToastType.Error,text:n.WorkbookErrors.errorMessageFor({item:t,error:r.errors[0]})}),r})},t.$inject=["$translate","ToasterService","Workbooks","WorkbookErrors"],t}();e.ChangeWorkbookDescriptionAction=t,e.Module.instance().service("ChangeWorkbookDescriptionAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i,o){this.$translate=e,this.$q=t,this.$rootScope=r,this.ConfirmActionDialog=n,this.toaster=i,this.Workbooks=o}return t.prototype.showRevisionHistory=function(t){var r=this,n=this.$rootScope.$new(!0);n.workbookId=t.id,n.selectedItems=new e.Set(function(e){return e.id}),n.prompt=this.$translate.instant("revisionHistoryDialogDescription",{NAME:e.L10n.elideIfLong(t.name)});var i=function(){return r.Workbooks.revertWorkbook(n.workbookId,n.selectedItems.first().versionNumber).then(function(t){e.ResultHelper.hasErrors(t)?r.toaster.pop({type:e.ToastType.Error,text:r.$translate.instant("revisionHistoryActionError")}):r.toaster.pop({type:e.ToastType.Info,text:r.$translate.instant("revisionHistoryActionSuccess")})})},o=this.ConfirmActionDialog.open({scope:n,title:this.$translate.instant("revisionHistoryDialogTitle"),bodyTemplateUrl:"revisionHistoryDialog.html",actionName:this.$translate.instant("revisionHistoryDialogSubmit"),action:i,confirmDisabled:function(){return n.selectedItems&&1!=n.selectedItems.size()},size:"600px"});return o.result.fin(function(){return n.$destroy()})},t.$inject=["$translate","$q","$rootScope","ConfirmActionDialog","ToasterService","Workbooks"],t}();e.RevisionHistoryAction=t,e.Module.instance().service("RevisionHistoryAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n,i,o,s,a){r.place="site",e.SubplaceCountsHelper.keepSubplaceCountsUpdated(r,s),e.SubplaceTabsHelper.refreshWhenCurrentTabClicked(r,n),i.rememberSiteUrl(t.url()),r.$on("$locationChangeSuccess",function(){var e=t.path();/^(\/site\/[^\/]+)?\/(projects|workbooks|views|datasources)(\/)?$/.test(e)&&i.rememberSiteUrl(t.url())})}return t.$inject=["$location","$scope","$state","BreadcrumbsService","ContentActions","place","ServerService"],t}();e.SitePlaceCtrl=t;var r=function(){function t(t,r,n,i,o,s,a,c,l,u,d){var p=this;this.$q=r,n.place=e.ContentTypes.project,n.objectName=u.name,n.project=u,n.projectSet=e.Set.singleton(u,function(e){return e.id}),e.SubplaceCountsHelper.keepSubplaceCountsUpdated(n,l),e.SubplaceTabsHelper.refreshWhenCurrentTabClicked(n,i),n.allowedAction=function(e){return!!d&&d[e]},n.del=function(t){a.deleteProject(u,e.ActionContext.fromEvent(t)).then(function(){return i.go("main.site.content.site.projects")})},n.changeDescription=function(t){return c.execute(u,t).then(e.ResultHelper.rejectResultOnError(p.$q))},n.changeOwner=function(t){return a.changeOwnerOnProjects(n.projectSet,e.ActionContext.fromEvent(t)).then(function(){return i.hardReload()})},n.rename=function(t){return a.renameProjectPopup(u,e.ActionContext.fromEvent(t)).then(function(){return i.hardReload()})},n.contentBreadcrumbUrl=function(){return o.siteUrl?"#"+o.siteUrl:i.href("main.site.content.site.projects")},o.rememberProjectUrl(u,t.url()),n.$on("$locationChangeSuccess",function(){var e=t.path();/^(\/site\/[^\/]+)?\/projects\/[^\/]+\/(workbooks|views|datasources|permissions|details)(\/)?$/.test(e)&&o.rememberProjectUrl(u,t.url())})}return t.$inject=["$location","$q","$scope","$state","BreadcrumbsService","BrowserTitleService","ContentActions","ChangeProjectDescriptionAction","place","project","projectActions"],t}();e.ProjectPlaceCtrl=r,e.Module.instance().controller("ProjectPlaceCtrl",r);var n=function(){function t(t,r,n,i,o,s,a,c,l,u,d,p,h,f,m,v,S){var g=this;this.$q=r,n.place=e.ContentTypes.workbook;var y=function(t){f=t,n.objectName=f.name,n.workbook=f,n.workbookSet=e.Set.singleton(f,function(e){return e.id}),n.ownerId=f.owner.id,e.FeatureFlags.projectControlledPermissionsEnabled||(n.permissionsInfoMessage=f.displayTabs?null:o.instant("permissions_workbooksWithTabsDisabledMessage"))};y(f),v.markRecentlyViewed(f.id),e.SubplaceCountsHelper.keepSubplaceCountsUpdated(n,h),e.SubplaceTabsHelper.refreshWhenCurrentTabClicked(n,i),n.del=function(t){a.deleteWorkbook(f,e.ActionContext.fromEvent(t)).then(function(){return i.go("main.site.content.project.workbooks",{id:f.project.id})})},n.changeDescription=function(t){return c.execute(f,t).then(e.ResultHelper.rejectResultOnError(g.$q))},n.download=function(e){u.downloadWorkbook(f).then(y).fail(function(){return i.hardReload()}),e.preventDefault()},n.changeOwner=function(t){return a.changeOwnerOnWorkbooks(n.workbookSet,e.ActionContext.fromEvent(t)).then(function(){return i.hardReload()})},n.moveToProject=function(t){return a.moveWorkbooksToProject(n.workbookSet,e.ActionContext.fromEvent(t)).then(function(){return i.hardReload()})},n.showRevisionHistory=function(){return S.showRevisionHistory(f).then(function(){return i.hardReload()})},n.editWorkbook=function(e){a.editWorkbook(n.workbook),e.preventDefault()},n.$watch("workbook.displayTabs",function(e,t){e!==t&&l.setDisplayTabs(f,e).then(function(){return i.hardReload()})}),n.changeTags=function(t){return a.setTagsOnWorkbook(n.workbook,t).then(e.ResultHelper.rejectResultOnError(g.$q)).then(function(){return i.hardReload()})},n.refreshNow=function(t){d.forWorkbook(n.workbook,e.ActionContext.fromEvent(t),e.CreateExtractTasksMode.AllowRefreshNow).then(function(){return i.hardReload()})},n.addFavorite=function(){return p.addWorkbook(n.workbook)},n.removeFavorite=function(){return p.removeWorkbook(n.workbook)},n.allowedAction=function(e){return!!m&&m[e]},n.contentBreadcrumbUrl=function(){return s.siteUrl?"#"+s.siteUrl:i.href("main.site.content.site.projects")},n.projectBreadcrumbUrl=function(){return s.projectUrl?"#"+s.projectUrl:i.href("main.site.content.project.workbooks",{id:f.project.id})},s.rememberWorkbookUrl(f,t.url()),n.$on("$locationChangeSuccess",function(){var e=t.path();/^(\/site\/[^\/]+)?\/workbooks\/[^\/]+\/(views|datasources|permissions|details)(\/)?$/.test(e)&&s.rememberWorkbookUrl(f,t.url())}),n.isWorkbookRevisionHistoryEnabled=e.FeatureFlags.workbookVersionHistoryEnabled}return t.$inject=["$location","$q","$scope","$state","$translate","BreadcrumbsService","ContentActions","ChangeWorkbookDescriptionAction","SetDisplayTabsAction","DownloadActions","CreateExtractTasksAction","Favorites","place","workbook","workbookActions","Workbooks","RevisionHistoryAction"],t}();e.WorkbookPlaceCtrl=n,e.Module.instance().controller("WorkbookPlaceCtrl",n);var i=function(){function t(t,r,n,i,o,s,a,c,l,u,d,p){var h=this;this.$q=t,this.server=o,this.DeleteDatasourcesAction=l,this.datasource=u,r.place=e.ContentTypes.datasource;var f=function(t){u=t,r.objectName=u.name,r.datasource=u,r.datasourceSet=e.Set.singleton(u,function(e){return e.id}),r.ownerId=u.owner.id};f(u),e.SubplaceCountsHelper.keepSubplaceCountsUpdated(r,p),e.SubplaceTabsHelper.refreshWhenCurrentTabClicked(r,n),r.del=function(t){h.DeleteDatasourcesAction.confirmDeleteDatasource(u,e.ActionContext.fromEvent(t)).then(function(e){e.allowed&&n.go("main.site.content.project.datasources",{id:u.project.id})})},r.changeDescription=function(t){return a.execute(u,t).then(e.ResultHelper.rejectResultOnError(h.$q))},r.download=function(e){c.downloadDatasource(u).then(f).fail(function(){return n.hardReload()}),e.preventDefault()},r.changeOwner=function(t){return s.changeOwnerOnDatasources(r.datasourceSet,e.ActionContext.fromEvent(t)).then(function(){return n.hardReload()})},r.moveToProject=function(t){return s.moveDatasourcesToProject(r.datasourceSet,e.ActionContext.fromEvent(t)).then(function(){return n.hardReload()})},r.newWorkbook=function(e){s.newWorkbook(r.datasource),e.preventDefault()},r.changeTags=function(t){return s.setTagsOnDatasource(r.datasource,t).then(e.ResultHelper.rejectResultOnError(h.$q)).then(function(){return n.hardReload()})},r.allowedAction=function(e){return!!d&&d[e]},i.projectChanged(u.project),r.contentBreadcrumbUrl=function(){return i.siteUrl?"#"+i.siteUrl:n.href("main.site.content.site.projects")},r.projectBreadcrumbUrl=function(){return i.projectUrl?"#"+i.projectUrl:n.href("main.site.content.project.datasources",{id:u.project.id})},r.refreshModeIsRemote=function(){return h.remoteRefreshesEnabled()&&u.refreshMode===e.ServerApi.RefreshModeTypes.Remote},r.refreshModeIsServer=function(){return h.datasource.hasExtracts&&!r.refreshModeIsRemote()}}return t.prototype.remoteRefreshesEnabled=function(){return this.server.featureFlags().dataSyncEnabled&&this.datasource.hasExtracts},t.$inject=["$q","$scope","$state","BreadcrumbsService","ServerService","ContentActions","ChangeDatasourceDescriptionAction","DownloadActions","DeleteDatasourcesAction","datasource","datasourceActions","place"],t}();e.DatasourcePlaceCtrl=i,e.Module.instance().controller("DatasourcePlaceCtrl",i)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e){this.$location=e}return t.prototype.getFilter=function(t,r){return e.Filter.and(this.getFilterClauses(t,r))},t.prototype.getFilterClauses=function(t,r){var n=_(this.$location.search()).pick(t),i=_.extend(n,r);return e.ServerFilterClauses.create(i)},t.$inject=["$location"],t}();e.ContentFilterService=t,e.Module.instance().service("ContentFilterService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){function t(t,r){r||(r={});var n=[{value:e.AnyRole,translate:"siteRole_Any",count:r[e.AnyRole]}];return _.each(t,function(e){n.push({value:e,translate:"siteRole_"+e,count:r[e]})}),n}e.AnyRole="Any",e.siteRoleOptions=t}(t=e.SiteRoleFilterHelper||(e.SiteRoleFilterHelper={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.FilterCategories={general:"general",datasource:"datasource"},function(e){e[e.Any=0]="Any",e[e.Embedded=1]="Embedded",e[e.NotEmbedded=2]="NotEmbedded"}(e.PasswordStatus||(e.PasswordStatus={}));var t=e.PasswordStatus;!function(e){e[e.All=1]="All",e[e.Embedded=2]="Embedded",e[e.Published=3]="Published"}(e.DatasourceType||(e.DatasourceType={}));var r=e.DatasourceType,n="default",i=function(){function i(e,t){this.suggestions=e,this.$q=t,this.createFilterDefinitions()}return i.prototype.createFilterDefinitions=function(){var i=this;this.filterDefinitions=_.indexBy([{name:"project",type:"typeahead",category:e.FilterCategories.general,field:e.ServerApi.FilterFieldNames.projectId,valueFromParams:this.fromSingleParam("project",function(e){return i.suggestions.project(e)}),valueToParams:this.toSingleParam("project",function(e){return e.value}),matchPrefixesOnly:!1},{name:"owner",type:"typeahead",category:e.FilterCategories.general,field:e.ServerApi.FilterFieldNames.ownerId,valueFromParams:this.fromSingleParam("owner",function(e){return i.suggestions.user(e)}),valueToParams:this.toSingleParam("owner",function(e){return e.value}),matchPrefixesOnly:!0},{name:"tag",type:"typeahead",category:e.FilterCategories.general,field:e.ServerApi.FilterFieldNames.tags,valueFromParams:this.fromSingleParam("tag",function(e){return i.$q.when({value:e,label:e,count:0})}),valueToParams:this.toSingleParam("tag",function(e){return e.value}),matchPrefixesOnly:!1},this.siteRoleFilterDefinition(),this.groupsMinimumSiteRoleDefinition(),this.maxSiteRoleDefinition(),this.afterDateFilterDefinition("createdAfter",e.FilterCategories.general),this.beforeDateFilterDefinition("createdBefore",e.FilterCategories.general),this.afterDateFilterDefinition("modifiedAfter",e.FilterCategories.general),this.beforeDateFilterDefinition("modifiedBefore",e.FilterCategories.general),this.booleanFilterDefinition("favorite",e.FilterCategories.general),this.booleanFilterDefinition("recent",e.FilterCategories.general),this.booleanFilterDefinition("hasAlert",e.FilterCategories.general),this.selectFilterDefinition("showEmbedded",{"":r.Published,"true":r.All,only:r.Embedded},[{value:r.All,translate:"datasourceTypeAll"},{value:r.Published,translate:"datasourceTypePublishedOnly"},{value:r.Embedded,translate:"datasourceTypeEmbeddedOnly"}],e.FilterCategories.datasource),{name:"connectionType",type:"typeahead",category:e.FilterCategories.datasource,field:e.ServerApi.FilterFieldNames.connectionType,valueFromParams:this.fromSingleParam("connectionType",function(e){return i.suggestions.dataConnectionType(e)}),valueToParams:this.toSingleParam("connectionType",function(e){return e.value}),matchPrefixesOnly:!0},this.textFilterDefinition("serverName",e.FilterCategories.datasource),this.textDropdownFilterDefinition("serverPort",[{value:null,translate:"serverPortAny"},{value:"default",translate:"serverPortDefault"}],function(e){return e===n||/^\d*$/.exec(e)&&parseInt(e,10)<=65535},e.FilterCategories.datasource),this.textFilterDefinition("databaseUsername",e.FilterCategories.datasource),this.selectFilterDefinition("hasPassword",{"":t.Any,"true":t.Embedded,"false":t.NotEmbedded},[{value:t.Any,translate:"hasPasswordAny"},{value:t.Embedded,translate:"hasPasswordEmbedded"},{value:t.NotEmbedded,translate:"hasPasswordNotEmbedded"}],e.FilterCategories.datasource),this.booleanFilterDefinition("hasExtracts",e.FilterCategories.datasource)],"name")},i.prototype.siteRoleFilterDefinition=function(){return this.siteRoleSelectFilterDefinition("siteRole",e.SiteRoles.WithoutGuest)},i.prototype.groupsMinimumSiteRoleDefinition=function(){return this.siteRoleSelectFilterDefinition("groupsMinimumSiteRole",e.SiteRoles.WithoutGuestOrServerAdmin)},i.prototype.maxSiteRoleDefinition=function(){return this.siteRoleSelectFilterDefinition("maxSiteRole",e.SiteRoles.WithoutGuest)},i.prototype.siteRoleSelectFilterDefinition=function(t,r){return this.selectFilterDefinition(t,_.extend({},e.ServerApi.SiteRoles,{"":e.SiteRoleFilterHelper.AnyRole}),e.SiteRoleFilterHelper.siteRoleOptions(r),e.FilterCategories.general)},i.prototype.selectFilterDefinition=function(e,t,r,n){var i=this,o=Helpers.swapDict(t);return{name:e,type:"select",category:n,valueFromParams:function(r){return i.$q.when(t[r[e]]||t[""])},valueToParams:this.toSingleParam(e,function(e){return o[e+""]||null}),options:r}},i.prototype.booleanFilterDefinition=function(e,t){var r=this;return{name:e,type:"boolean",category:t,valueFromParams:this.fromSingleParam(e,function(e){return r.$q.when(Helpers.toBoolean(e))}),valueToParams:this.toSingleParam(e,function(e){return""+e})}},i.prototype.textFilterDefinition=function(e,t){var r=this;return{name:e,type:"text",category:t,valueFromParams:this.fromSingleParam(e,function(e){return r.$q.when(e)}),valueToParams:this.toSingleParam(e,function(e){return e})}},i.prototype.textDropdownFilterDefinition=function(e,t,r,n){var i=this;return{name:e,type:"textDropdown",category:n,valueFromParams:this.fromSingleParam(e,function(e){return i.$q.when(r(e)?e:null)}),valueToParams:this.toSingleParam(e,function(e){return e}),options:t,isValid:r}},i.prototype.afterDateFilterDefinition=function(t,r){var n=this;return{name:t,type:"date",category:r,valueFromParams:this.fromSingleParam(t,function(e){return n.dateFromISOString(e)}),valueToParams:this.toSingleParam(t,function(t){return e.DateHelpers.toISOString(t)})}},i.prototype.beforeDateFilterDefinition=function(t,r){var n=this;return{name:t,type:"date",category:r,valueFromParams:this.fromSingleParam(t,function(e){return n.dateFromISOString(e)}),valueToParams:this.toSingleParam(t,function(t){return e.DateHelpers.toISOString(e.DateHelpers.endOfDay(t))})}},i.prototype.dateFromISOString=function(t){return this.$q.when(e.DateHelpers.midnight(e.DateHelpers.fromISOString(t)))},i.prototype.fromSingleParam=function(e,t){var r=this;return function(n){return n[e]?t(n[e]):r.$q.when(null)}},i.prototype.toSingleParam=function(e,t){return function(r){var n={};return n[e]=r?t(r):null,n}},i.prototype.getFilterDefinitions=function(e){var t=this,r=_.map(e,function(e){return t.filterDefinitions[e]});return _.filter(r,function(e){return null!=e})},i.$inject=["SearchSuggestionsService","$q"],i}();e.FilterPanelService=i,e.Module.instance().service("FilterPanelService",i)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n){var i=t.filterDefinitions;t.filters=_.map(i,function(e){return{definition:e,ready:!1,value:void 0}});var o=function(t){return t.definition.category===e.FilterCategories.general},s=function(t){return t.definition.category===e.FilterCategories.datasource},a=function(e){return"boolean"===e.definition.type};t.anyGeneralFilters=function(){return _.some(t.filters,o)},t.anyDatasourceFilters=function(){return _.some(t.filters,s)},t.generalFilter=function(e){return o(e)&&!a(e)},t.generalCheckbox=function(e){return o(e)&&a(e)},t.datasourceFilter=function(e){return s(e)&&!a(e)},t.datasourceCheckbox=function(e){return s(e)&&a(e)},t.filterControls.clearAllFilters=function(){var n=r.search();_.each(_.keys(n),function(t){_.has(e.ContentFiltersKeys,t)&&r.search(t,null)}),_.each(t.filters,function(e){e.clear&&e.clear()})},t.submitSearch=function(t,i){r.search(e.ContentFiltersKeys.search,t||null),n.isTouch()&&i&&$(i.target).blur()},_.each(t.filters,function(e){t.$watch(function(){return e.value},function(){if(e.ready){var t=e.definition.valueToParams(e.value);_.each(t,function(e,t){r.search(t,e)})}})});var c=function(){var n=r.search();t.anyFiltersActive=_.some(_.keys(n),function(t){return _.has(e.ContentFiltersKeys,t)}),t.searchText=n.search||"",_.each(t.filters,function(e){e.ready=!1,e.definition.valueFromParams(n).then(function(t){e.ready=!0,e.value=t})})};c(),t.$on("$locationChangeSuccess",function(){c()})}return t.$inject=["$scope","$location","BrowserSupportService"],t}();e.FilterPanelCtrl=t,e.Module.instance().controller("FilterPanelCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.SelectionEvent={SelectionStarted:"selectionStartedEvent",SelectionEnded:"selectionEndedEvent"},e.Module.instance().directive("tbSelectionMenu",function(){return{restrict:"E",replace:!0,templateUrl:"selectionMenu.html",scope:{selection:"=",sliceable:"="},link:function(t){var r=!1;t.$on("$destroy",function(){r=!0}),t.selectAll=function(){t.$emit(e.SelectionEvent.SelectionStarted),t.selecting=!0,e.SliceableHelper.fetchAll(t.sliceable,function(e){return t.selection.addItems(e),r}).fin(function(){t.$emit(e.SelectionEvent.SelectionEnded),t.selecting=!1})}}}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(){}return t.setupDropdownScope=function(t,r,n,i){function o(){t.editMode=!1,t.textValue="",t.currentRow.index=-1}function s(){r(function(){return n.focus()})}t.currentRow={index:0,object:null},o(),t.select=function(e){try{t.model=i(e)}catch(r){return}o()},t.cancel=function(){o()},t.clear=function(){t.model=null,o()},t.edit=function(){t.editMode=!0,s()},t.mousedownOutside=function(e){0===$(e.target).closest(n).length&&t.cancel()},t.handleKeyEvent=function(r){switch(r.which){case e.Keys.ArrowDown:t.currentRow.index++;break;case e.Keys.ArrowUp:t.currentRow.index=Math.max(t.currentRow.index-1,0);break;case e.Keys.Enter:case e.Keys.Tab:r.preventDefault(),t.select(t.currentRow.object);break;case e.Keys.Escape:r.preventDefault(),t.cancel()}}},t}();e.DropdownHelper=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e){void 0===e&&(e=[]),this.widths=e}return e.prototype.getActual=function(e){return this.widths[e]},e.prototype.setWidths=function(e,t){var r=t-(e[1]||0);this.widths=[r].concat(e.slice(1))},e}();e.Module.instance().directive("tbTypeahead",["$timeout","$parse",function(r,n){return{restrict:"E",templateUrl:"typeahead.html",replace:!0,scope:{model:"=ngModel",autoEdit:"=",typeaheadItemText:"@"},link:{pre:function(e,t,r){e.placeholder=n(r.typeaheadPlaceholder)(e.$parent),e.matchPrefixesOnly="true"===r.typeaheadMatchPrefixesOnly,e.withCounts="true"===r.typeaheadWithCounts,e.typeaheadSource=n(r.typeaheadSource)(e.$parent)},post:function(n,i,o){n.itemText=function(e){return e?e[n.typeaheadItemText]:n.placeholder||""};var s=function(e){if(!e)throw new Error("No row is selected");return e};e.DropdownHelper.setupDropdownScope(n,r,i.find("input"),s),n.$watch("textValue",function(e){n.editMode&&(n.items=n.typeaheadSource(e),e?n.currentRow.index=0:n.currentRow.index=-1)}),n.$watch("editMode",function(e){e&&(n.width=i.width(),n.items=n.typeaheadSource(n.textValue),n.columnWidths=new t)}),n.$watch("autoEdit",function(e){e&&n.edit()})}}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(){}return e.ONE_KB=1e3,e.ONE_MB=1e6,e.ONE_GB=1e9,e}();e.ByteSizeConversionFactor=t,e.Module.instance().filter("size",["$translate",function(r){function n(e,t){var r=Math.pow(10,t+1),n=Math.floor(e*r);return 10*Math.round(n/10)/r}return function(i){return!_.isFinite(i)||0>i?"":i>=t.ONE_GB?r.instant(e.L10n.Keys.sizeInGB,{SIZE:n(i/t.ONE_GB,1)},e.L10n.Interpolations.Float):i>=t.ONE_MB?r.instant(e.L10n.Keys.sizeInMB,{SIZE:n(i/t.ONE_MB,1)},e.L10n.Interpolations.Float):i>=t.ONE_KB?r.instant(e.L10n.Keys.sizeInKB,{SIZE:n(i/t.ONE_KB,1)},e.L10n.Interpolations.Float):r.instant(e.L10n.Keys.sizeInBytes,{SIZE:n(i,0)},e.L10n.Interpolations.Count)}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e){void 0===e&&(e=t.DefaultRowHeight),this.rowHeight=e}return t.prototype.metrics=function(e){return{numberOfRows:Math.max(Math.ceil(e.height/this.rowHeight),1),numberOfCols:1,heightOfRowInPx:this.rowHeight}},t.DefaultRowHeight=e.FeatureFlags.useTallerRowHeight?38:28,t}();e.ListLayout=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"checkConnection",t)}return __extends(t,e),t}(e.Request);e.CheckConnectionRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"updateConnections",t)}return __extends(t,e),t}(e.Request);e.UpdateConnectionsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t="__ADD_NEW_OAUTH_CREDENTIAL";e.PasswordUnchanged=null;var r={none:"none",oauth:"oauth",password:"password"},n="mixed",i=450,o=function(){function o(e,t,r,n,i,o,s){this.ConfirmActionDialog=e,this.$translate=t,this.ContentActionNotification=r,this.ModalService=n,this.DataConnections=i,this.OAuthCredentials=o,this.AddOAuthCredentialAction=s}return o.prototype.confirmEditConnections=function(e,t){var r=e.toArray();return this.haveSameConnectionType(r)?this.areEditable(r)?e.first().connectionOAuth?this.confirmEditOAuthConnections(e,t):this.confirmEditDatabaseConnections(e,t):this.ModalService.alert({titleId:"editDataConnections_nonEditableTitle",messageId:"editDataConnections_nonEditableMessage"}).result:this.ModalService.alert({titleId:"editDataConnections_mixedConnectionTypesTitle",messageId:"editDataConnections_mixedConnectionTypesMessage"}).result},o.prototype.haveSameConnectionType=function(e){var t=_.uniq(_.map(e,function(e){return e.connectionType}));return 1===t.length},o.prototype.areEditable=function(e){return _.all(e,function(e){return e.connectionTypeEditable})},o.prototype.confirmEditDatabaseConnections=function(t,r){var n=this,o=t.first(),s=t.toArray(),a=r.scope.$new();return a.prompt=this.makePrompt(t),a.editModel={serverName:this.uniqueValueOrMixed(s,function(e){return e.connectionDetails.serverName}),serverPort:this.uniqueValueOrMixed(s,function(e){return e.connectionDetails.serverPort}),username:this.uniqueValueOrMixed(s,function(e){return e.connectionDetails.databaseUsername}),password:{isEmbedded:this.uniqueValueOrUndefined(s,function(e){return e.connectionDetails.hasEmbeddedPassword}),newPassword:e.PasswordUnchanged}},a.showTestConnection=1===t.size(),a.testConnection=function(){a.testConnectionResult=n.checkEditedConnection(o.id,a.editModel)},this.ConfirmActionDialog.open({scope:a,title:this.$translate.instant("editConnection"),bodyTemplateUrl:"editConnectionDialog.html",position:{reserveHeight:i},actionName:this.$translate.instant("save"),action:function(e){return n.applyConnectionEdits(t,a.editModel)}}).result.fin(function(){return a.$destroy()})},o.prototype.makePrompt=function(t){return this.$translate.instant("editDataConnections_prompt",{ITEM_COUNT:t.size(),ITEM_NAME:e.L10n.elideIfLong(t.first().name)},e.L10n.Interpolations.Count)},o.prototype.configureEditOAuthScope=function(i,s){var a=this,c=s.first().connectionType;i.allowOAuthWithPassword=c===o.SalesforceConnectionType,i.promptEmbedCredential=this.$translate.instant("editDataConnections_"+c+"_embedCredential"),i.promptNoCredential=this.$translate.instant("editDataConnections_"+c+"_noCredential"),i.describeEmbedCredential=this.$translate.instant("editDataConnections_"+c+"_describeEmbedCredential"),i.describeNoCredential=this.$translate.instant("editDataConnections_"+c+"_describeNoCredential"),i.connectionTypeDisplayName=s.first().connectionTypeDisplayName,i.oauthEditModel=this.createOAuthEditModel(s);var l=function(){return e.SliceableHelper.fetchAll(a.OAuthCredentials.all().addFilter(e.Filter.fieldEq("type",c))).then(function(e){return i.credentials=e.items,e})};l(),this.OAuthCredentials.canAddForConnectionType(c)&&(i.addNewOAuthCredentialOptionValue=t),i.$watch(function(){return i.oauthEditModel.credentialId},function(e){e===t&&(i.oauthEditModel.credentialId=void 0,a.AddOAuthCredentialAction.attemptAuth(c).then(function(e){l().then(function(t){_.find(t.items,function(t){return t.id===e})&&(i.oauthEditModel.credentialId=e)})}))}),i.showTestConnection=1===s.size(),i.testConnection=function(){i.testConnectionResult=i.oauthEditModel.credentialOption===r.password?a.checkEditedConnection(s.first().id,i.oauthEditModel.usernamePassword):a.checkOAuthConnection(i.oauthEditModel.credentialId)},i.testConnectionDisabled=function(){return i.testConnectionResult&&i.testConnectionResult.isPending||i.oauthEditModel.credentialOption===n||i.oauthEditModel.credentialOption===r.password&&!i.oauthEditModel.usernamePassword.username||i.oauthEditModel.credentialOption===r.oauth&&!i.oauthEditModel.credentialId||i.oauthEditModel.credentialOption===r.none}},o.prototype.confirmEditOAuthConnections=function(t,r){var n=this,o=r.scope.$new();return this.configureEditOAuthScope(o,t),o.prompt=this.makePrompt(t),o.withAuthenticationSubHeader=!0,this.ConfirmActionDialog.open({scope:o,title:this.$translate.instant("editConnection"),size:e.ModalSize.medium,bodyTemplateUrl:o.allowOAuthWithPassword?"editSalesforceConnectionDialog.html":"editOAuthConnectionDialog.html",position:{reserveHeight:i},actionName:this.$translate.instant("save"),action:function(e){return n.updateOAuthConnections(t,o.oauthEditModel)}}).result.fin(function(){return o.$destroy()})},o.prototype.createOAuthEditModel=function(t){var i={credentialOption:n,credentialId:void 0,credentialNoValueOptionText:void 0,usernamePassword:{username:"",password:{isEmbedded:!1,newPassword:""}}};return this.OAuthCredentials.commonCredentialForDatasources(t.keys()).then(function(t){var n=0;t.hasEmbeddedPassword&&n++,t.hasManagedKeychain&&n++,t.hasOAuthCredential&&n++,t.hasNone&&n++,1===n&&(t.hasEmbeddedPassword?(i.credentialOption=r.password,i.usernamePassword={username:t.commonUsername,password:{isEmbedded:!0,newPassword:e.PasswordUnchanged}}):t.hasManagedKeychain||t.hasOAuthCredential?(i.credentialOption=r.oauth,t.oauthCredentialId?i.credentialId=t.oauthCredentialId:i.credentialNoValueOptionText=t.commonUsername):t.hasNone&&(i.credentialOption=r.none))}),i},o.prototype.updateOAuthConnections=function(e,t){var n,i=this;switch(t.credentialOption){case r.password:n=this.updateConnections(e,t.usernamePassword);break;case r.oauth:n=this.DataConnections.updateConnectionsOAuth(e.keys(),t.credentialId);break;case r.none:n=this.DataConnections.updateConnectionsOAuth(e.keys());break;default:throw"Unexpected credential option: "+t.credentialOption}return n.then(function(t){return i.notifyResult(t,e),t})},o.prototype.uniqueValueOrMixed=function(t,r){var n=_.map(t,r),i=n[0];return _.all(n,function(e){return e===i})?i:e.TextBoxMixedValues},o.prototype.uniqueValueOrUndefined=function(e,t){var r=_.map(e,t),n=r[0];return _.all(r,function(e){return e===n})?n:void 0},o.prototype.applyConnectionEdits=function(e,t){var r=this;return this.updateConnections(e,t).then(function(t){return r.notifyResult(t,e),t})},o.prototype.updateConnections=function(e,t){return this.DataConnections.updateConnections(e.keys(),this.editModelToConnectionUpdate(t))},o.prototype.editModelToConnectionUpdate=function(t){return{server:t.serverName===e.TextBoxMixedValues?void 0:t.serverName,port:t.serverPort===e.TextBoxMixedValues?void 0:t.serverPort,username:t.username===e.TextBoxMixedValues?void 0:t.username,passwordUpdate:_.isUndefined(t.password.isEmbedded)?void 0:t.password}},o.prototype.notifyResult=function(t,r){t&&t.errors&&t.errors.length?this.ContentActionNotification.notifyFailure(this.errorMessage(t.errors[0])):this.ContentActionNotification.notifySuccess(this.$translate.instant("updateConnectionsSuccess",{ITEM_COUNT:r.size(),ITEM_NAME:e.L10n.elideIfLong(r.first().name)},e.L10n.Interpolations.Count))},o.prototype.errorMessage=function(t){switch(t.code){case e.CommonErrorCode.DatasourceNotFound:case e.CommonErrorCode.DataConnectionNotFound:return this.$translate.instant("updateConnectionsError_datasourceNotFound");case e.CommonErrorCode.CallingUserInsufficientPermissions:return this.$translate.instant("updateConnectionsError_insufficientPermissions");case e.DataConnectionErrorCode.UpdateConnectionsInvalidPort:return this.$translate.instant("updateConnectionsError_invalidPort");default:return this.$translate.instant("errorUnknown")}},o.prototype.checkEditedConnection=function(e,t){var r=this,n={isPending:!0};return this.DataConnections.checkConnection(e,this.editModelToConnectionUpdate(t)).then(function(e){return r.updateTestConnectionResult(n,e);
}),n},o.prototype.checkExistingConnection=function(e){var t=this,r={isPending:!0};return this.DataConnections.checkExistingConnection(e).then(function(e){return t.updateTestConnectionResult(r,e)}),r},o.prototype.updateTestConnectionResult=function(e,t){e.isPending=!1,e.succeeded=t.succeeded,e.messages=t.messages},o.prototype.checkOAuthConnection=function(e){var t={isPending:!0},r=function(e){t.succeeded=e,t.isPending=!1};return this.OAuthCredentials.test(e).then(r,function(){return r(!1)}),t},o.SalesforceConnectionType="salesforce",o.$inject=["ConfirmActionDialog","$translate","ContentActionNotification","ModalService","DataConnections","OAuthCredentials","AddOAuthCredentialAction"],o}();e.EditConnectionAction=o,e.Module.instance().service("EditConnectionAction",o)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(){this.resizer=new r(this),this.actualWidths=[]}return e.prototype.getTotal=function(){return this.totalActualWidth||null},e.prototype.updateTotal=function(){this.totalActualWidth=_.reduce(this.actualWidths,function(e,t){return e+t},0)},e.prototype.getActual=function(e){return this.actualWidths[e]},e.prototype.setActual=function(e,t){this.actualWidths[e]=t},e.prototype.resetActual=function(){this.actualWidths=[]},e.prototype.getMin=function(e){return this.minWidths&&this.minWidths[e]},e.prototype.setMinWidths=function(e){this.minWidths=e,this.maybeExpand()},e.prototype.hasMinWidths=function(){return!!this.minWidths},e.prototype.getPreferred=function(e){var t=this.preferredWidths&&this.preferredWidths[e],r=this.getMin(e);return _.isNumber(t)?_.isNumber(r)?Math.max(t,r):t:r},e.prototype.getPreferredWithMax=function(e,t){var r=this.preferredWidths&&this.preferredWidths[e],n=this.getMin(e);if(_.isNumber(r)){var i=Math.min(r,t);return _.isNumber(n)?Math.max(i,n):i}return n},e.prototype.setPreferredWidths=function(e,t){this.preferredWidths=e,this.containerWidth=t,this.maybeExpand()},e.prototype.hasPreferredWidths=function(){return!!this.preferredWidths},e.prototype.setContainerWidth=function(e){this.containerWidth=e,this.maybeExpand()},e.prototype.hasContainerWidth=function(){return!!this.containerWidth},e.prototype.maybeExpand=function(){this.hasMinWidths()&&this.hasPreferredWidths()&&this.hasContainerWidth()&&this.expandToFill(this.containerWidth)},e.prototype.expandToFill=function(t){var r=this,n=Math.max(this.minWidths&&this.minWidths.length||0,this.preferredWidths&&this.preferredWidths.length||0),i=0;_.times(n,function(t){var n=r.getPreferredWithMax(t,e.MaxStartWidth);r.setActual(t,n),i+=n});var o=t-i;o>0&&_.each(this.actualWidths,function(e,t){var n=r.getPreferred(t);if(o>0&&n>e){var i=Math.min(n-e,o);r.setActual(t,e+i),o-=i}}),this.updateTotal()},e.MaxStartWidth=200,e}();e.ColumnWidths=t;var r=function(){function e(e){this.widths=e}return e.prototype.startResize=function(e,t){this.index=e,this.startX=t,this.startWidth=this.widths.getActual(e)||0,this.minWidth=this.widths.getMin(e)||0},e.prototype.continueResize=function(e){var t=e-this.startX;this.startWidth+t<this.minWidth&&(t=this.minWidth-this.startWidth),this.widths.setActual(this.index,this.startWidth+t),this.widths.updateTotal()},e}();e.ColumnWidthsResizer=r}(VizPortal||(VizPortal={}));var VizPortalReact;!function(e){var t;!function(e){var t;!function(e){e.White="rgb(255,255,255)",e.Black="rgb(0,0,0)",e.Grey40="rgb(40,40,40)",e.Grey68="rgb(68,68,68)",e.Grey89="rgb(89,89,89)",e.Grey102="rgb(102,102,102)",e.Grey136="rgb(136,136,136)",e.Grey153="rgb(153,153,153)",e.Grey178="rgb(178,178,178)",e.Grey218="rgb(218,218,218)",e.Grey224="rgb(224,224,224)",e.Grey230="rgb(230,230,230)",e.Grey245="rgb(245,245,245)",e.Grey250="rgb(250,250,250)",e.BlueHighlight="rgb(212,225,237)",e.BorderColor=e.Grey178,e.GreyTextColor=e.Grey153,e.NormalTextColor=e.Grey102,e.DisabledTextColor=e.Grey218,e.ActionOrange="rgb(235,143,80)",e.ActionOrangeDark="rgb(209,107,54)"}(t=e.Colors||(e.Colors={}));var r;!function(e){e.MinSupportedAppWidth=1e3,e.TextBoxPadding=4,e.TextBoxBorderSize=1,e.LineWidth=1,e.SmallSpace=3,e.DefaultSpace=6,e.LineHeight=16,e.LargeSpace=18,e.RowHeight=23,e.XLargeSpace=35,e.SmallFontSize=11,e.NormalFontSize=12,e.HeaderFontSize=VizPortal.FeatureFlags.useUpdatedFontStyles?13:12,e.SmallIconSize=17,e.NormalIconSize=19,e.DataGridHeaderHeight=VizPortal.FeatureFlags.useTallerRowHeight?37:e.XLargeSpace,e.DropdownOffset=3}(r=e.Sizes||(e.Sizes={}));var n;!function(e){e.BodyFont=VizPortal.FeatureFlags.useUpdatedFontStyles?"BentonSans-Book, Verdana, Geneva, sans-serif":"Verdana, Geneva, sans-serif",e.HeaderFont=VizPortal.FeatureFlags.useUpdatedFontStyles?"BentonSans-Book, Arial, Verdana, Geneva, sans-serif":"Arial, Verdana, Geneva, sans-serif"}(n=e.Fonts||(e.Fonts={}));var i;!function(e){e.Workbook="img/workbook_content_type_small.png",e.View="img/view_content_type_small.png"}(i=e.IconUrls||(e.IconUrls={}));var o;!function(e){function t(e){return{position:"absolute",left:e,right:e,top:e,bottom:e}}e.Edges=t}(o=e.Helpers||(e.Helpers={}))}(t=e.CommonStyles||(e.CommonStyles={}))}(VizPortalReact||(VizPortalReact={}));var VizPortal;!function(e){function t(t){return e.FeatureFlags.projectPermissionsTemplatesEnabled?new i(t,n.MinColumnWidthsByField,n.DefaultColumnWidthsByField,n.ColumnIndicesByContentType,n.CapabilityColumnWidth,n.MinDialogWidth):new o(t)}function r(e){return _.reduce(e,function(e,t){return e+t})}var n;!function(e){e.CapabilityColumnWidth=30,e.MinDialogWidth=703,e.MinColumnWidthsByField={granteeName:200,permissionRole:64},e.DefaultColumnWidthsByField={granteeName:200,permissionRole:180};var t={granteeName:[0],permissionRole:[2,5,10]},r={granteeName:[0],permissionRole:[2]};e.ColumnIndicesByContentType={project:t,workbook:r,datasource:r,view:r}}(n||(n={})),e.getPermissionsPanelColumnWidths=t;var i=function(e){function t(t,r,n,i,o,s){e.call(this),this.contentType=t,this.MinColumnWidthsByField=r,this.DefaultColumnWidthsByField=n,this.ColumnIndicesByContentType=i,this.CapabilityColumnWidth=o,this.MinDialogWidth=s;var a=this.orderedWidthsFromFieldNames(this.MinColumnWidthsByField);this.setMinWidths(a)}return __extends(t,e),t.prototype.orderedWidthsFromFieldNames=function(e){var t=[],r=this.ColumnIndicesByContentType[this.contentType];return _.each(e,function(e,n){_.each(r[n],function(r){t[r]=e})}),t},t.prototype.setPreferredWidths=function(t,r){var n=this.getPreferredColumnWidths(t);e.prototype.setPreferredWidths.call(this,n,r)},t.prototype.getPreferredColumnWidths=function(e){var t=this,r={},n=this.ColumnIndicesByContentType[this.contentType];return _.each(n,function(n,i){var o=_.map(n,function(t){return e[t]}),s=_.max(o.concat(t.DefaultColumnWidthsByField[i]));r[i]=s}),this.orderedWidthsFromFieldNames(r)},t.prototype.getPermissionsDialogWidth=function(e){var t=this.calculatePermissionsDialogWidths(),r=2*VizPortalReact.CommonStyles.Sizes.LargeSpace,n=Math.max(e,VizPortalReact.CommonStyles.Sizes.MinSupportedAppWidth)-r;return Math.min(Math.max(t[this.contentType],this.MinDialogWidth),n)},t.prototype.calculatePermissionsDialogWidths=function(){var e=15,t=20,n=r(this.DefaultColumnWidthsByField)+t;return{project:14*this.CapabilityColumnWidth+3*e+n+2*this.DefaultColumnWidthsByField.permissionRole,workbook:14*this.CapabilityColumnWidth+3*e+n,view:11*this.CapabilityColumnWidth+3*e+n,datasource:6*this.CapabilityColumnWidth+2*e+n}},t}(e.ColumnWidths);e.PermissionsPanelColumnWidthsImpl=i;var o=function(e){function t(t){e.call(this),this.contentType=t,this.CapabilityColumnWidth=28,this.MinDialogWidth=703,this.MinColumnWidths={granteeName:234,permissionRole:100,editRuleButton:this.CapabilityColumnWidth,deleteRuleButton:this.CapabilityColumnWidth},this.setMinWidths(this.getMinColumnWidths())}return __extends(t,e),t.prototype.getMinColumnWidths=function(){return[this.MinColumnWidths.granteeName,this.MinColumnWidths.permissionRole,this.MinColumnWidths.editRuleButton,this.MinColumnWidths.deleteRuleButton]},t.prototype.getPermissionsDialogWidth=function(e){var t=this.calculatePermissionsDialogWidths();return t[this.contentType]},t.prototype.calculatePermissionsDialogWidths=function(){var e=15,t=20,n=r(this.MinColumnWidths)+t;return{project:Math.max(16*this.CapabilityColumnWidth+3*e+n,this.MinDialogWidth),workbook:Math.max(14*this.CapabilityColumnWidth+3*e+n,this.MinDialogWidth),view:Math.max(11*this.CapabilityColumnWidth+3*e+n,this.MinDialogWidth),datasource:Math.max(6*this.CapabilityColumnWidth+2*e+n,this.MinDialogWidth)}},t}(e.ColumnWidths)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){function t(e){if(e){var t=/(\d\d\d\d)-(\d\d)-(\d\d)T(\d\d):(\d\d):(\d\d)(?:(?:\.|,)(\d\d\d))?((Z)|([+-]\d\d(:?\d\d)?))?/.exec(e),r=parseInt(t[1],10),n=parseInt(t[2],10)-1,i=parseInt(t[3],10),o=parseInt(t[4],10),s=parseInt(t[5],10),a=parseInt(t[6],10),c=t[7]?parseInt(t[7],10):null;return new Date(Date.UTC(r,n,i,o,s,a,c))}return void 0}function r(e){function t(e){return 10>e?"0"+e:""+e}return e?e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+(e.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z":void 0}function n(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0)}function i(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59,999)}e.fromISOString=t,e.toISOString=r,e.midnight=n,e.endOfDay=i}(t=e.DateHelpers||(e.DateHelpers={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){function r(e){return _.isNumber(e)||_.isNull(e)||_.isUndefined(e)?e:parseInt(e,10)}function n(t){return e.DateHelpers.fromISOString(t)}function i(e){return _.object(e,e)}function o(e){return _(e).sortBy(function(e){return e.toLowerCase()})}t.toNumber=r,t.toDate=n,t.arrayToMap=i,t.sortTags=o}(t=e.MapperHelper||(e.MapperHelper={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){function r(e,t,r,i){return{total:e,alerts:_.map(t,function(e){return{id:e.id,statusCode:n.toNumber(e.statusCode),taskId:e.taskId,mostRecentFailureAt:n.toDate(e.mostRecentFailureAt),lastSuccessAt:n.toDate(e.lastSuccessAt),workbooks:_.map(e.affectedWorkbookIds,function(e){return r[e]}),datasource:i[e.datasourceId],alertType:e.alertType,suspended:e.suspended,consecutiveFailureCount:e.consecutiveFailureCount}})}}var n=e.MapperHelper;t.map=r}(t=e.AlertListMapper||(e.AlertListMapper={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){function r(e,t){return _.map(e,function(e){return{id:e.id,text:e.text,owner:t[e.ownerId],createdAt:n.toDate(e.createdAt),updatedAt:n.toDate(e.updatedAt)}})}var n=e.MapperHelper;t.map=r}(t=e.CommentMapper||(e.CommentMapper={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){function r(e,t,r,n,s){return void 0===r&&(r={}),void 0===n&&(n={}),void 0===s&&(s={}),_.map(e,function(e){return{downloadUrl:e.downloadUrl,favorite:!!s[e.id],hasExtracts:e.hasExtracts,hasAlert:e.hasAlert,hasIncrementalExtract:e.hasIncrementalExtract,lastRefreshedAt:o.toDate(e.lastRefreshedAt),id:e.id,name:e.name,owner:t[e.ownerId],project:r[e.projectId],updatedAt:o.toDate(e.updatedAt),tags:o.sortTags(e.tags),refreshMode:e.refreshMode,remoteAgentName:e.remoteAgentName,remoteRunNextAt:e.remoteRunNextAt,connectionType:e.connectionType,connectionTypeDisplayName:e.connectionTypeDisplayName,connectionDetails:i(e.connectionDetails),connectionTypeEditable:e.connectionTypeEditable,connectionOAuth:e.connectionOAuth,workbook:n[e.workbookId]}})}function n(t){var r=e.UserMapper.mapOne(t.owner),n=e.ProjectMapper.mapName(t.project),s={createdAt:o.toDate(t.createdAt),description:t.description,downloadUrl:t.downloadUrl,favorite:t.favorite,hasExtracts:t.hasExtracts,hasAlert:t.hasAlert,hasIncrementalExtract:t.hasIncrementalExtract,lastRefreshedAt:o.toDate(t.lastRefreshedAt),id:t.id,name:t.name,tags:o.sortTags(t.tags),updatedAt:o.toDate(t.updatedAt),newWorkbookUrl:t.newWorkbookUrl,refreshMode:t.refreshMode,remoteAgentName:t.remoteAgentName,remoteRunNextAt:t.remoteRunNextAt,connectionType:t.connectionType,connectionTypeDisplayName:t.connectionTypeDisplayName,connectionDetails:i(t.connectionDetails),connectionTypeEditable:t.connectionTypeEditable,connectionOAuth:t.connectionOAuth,owner:r,project:n};return t.workbook&&(s.workbook=e.WorkbookMapper.mapOne(t.workbook,r,n)),s}function i(t){var r=_.clone(t);if(r.type===e.ServerApi.ConnectionDetailType.File){var n=r;n.fileName=a(n.fileName)}return r}var o=e.MapperHelper;t.map=r,t.mapDetail=n;var s=/[/\\]([^/\\]*)$/,a=function(e){var t=e&&e.match(s);return t?t[1]:e}}(t=e.DatasourceMapper||(e.DatasourceMapper={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){function r(t,r,i,o,s){return _.map(t,function(t){var a=t.targetType===e.ServerApi.ExtractTaskTargetType.Workbook?o[t.targetId]:void 0,c=t.targetType===e.ServerApi.ExtractTaskTargetType.Datasource?s[t.targetId]:void 0;return{id:t.id,priority:t.priority,type:t.type,lastRunAt:n.toDate(t.lastRunAt),runNextAt:n.toDate(t.runNextAt),schedule:r[t.scheduleId],site:i[t.siteId],workbook:a,datasource:c}})}var n=e.MapperHelper;t.map=r}(t=e.ExtractTaskMapper||(e.ExtractTaskMapper={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){function r(e,t){return _.map(e,function(e){return n(e,t[e.ownerId])})}function n(e,t){return{createdAt:a.toDate(e.createdAt),datasourceCount:a.toNumber(e.datasourceCount),description:e.description,id:e.id,name:e.name,owner:t,viewCount:a.toNumber(e.viewCount),workbookCount:a.toNumber(e.workbookCount),controlledPermissionsEnabled:e.controlledPermissionsEnabled}}function i(t){return{createdAt:a.toDate(t.createdAt),description:t.description,id:t.id,name:t.name,owner:e.UserMapper.mapOne(t.owner),controlledPermissionsEnabled:t.controlledPermissionsEnabled}}function o(e){return{id:e.id,name:e.name}}function s(e){return _.map(e,o)}var a=e.MapperHelper;t.map=r,t.mapOne=n,t.mapDetail=i,t.mapName=o,t.mapNames=s}(t=e.ProjectMapper||(e.ProjectMapper={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){function r(t){return _.map(t,function(t){var r=new e.Set(function(e){return e.id});return r.addItems(t.content),{id:t.id,name:t.name,ownerId:t.ownerId,content:r}})}e.MapperHelper;t.mapToResource=r}(t=e.RemoteRefreshAgentMapper||(e.RemoteRefreshAgentMapper={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){function r(e){return _.map(e,function(e){return{definition:e.definition,refreshType:e.refreshType,runNextAt:e.runNextAt,lastRunAt:e.lastRunAt}})}function n(e){var t=this;return _.map(e,function(e){return t.mapSingleToApi(e)})}function i(e){return{definition:e.definition,refreshType:e.refreshType}}e.DateHelpers;t.mapToResource=r,t.mapToApi=n,t.mapSingleToApi=i}(t=e.RemoteRefreshScheduleMapper||(e.RemoteRefreshScheduleMapper={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.SubscriptionTargetTypes={view:"view",workbook:"workbook"}}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){function r(e,t,r,i){return _.map(e,function(e){return{id:e.id,subject:e.subject,targetId:e.targetId,targetName:e.targetName,targetType:e.targetType.toLowerCase(),targetPath:e.targetPath,lastSentAt:n.toDate(e.lastSentAt),runNextAt:n.toDate(e.runNextAt),schedule:t[e.scheduleId],site:r[e.siteId],user:i[e.userId]}})}var n=e.MapperHelper;t.map=r}(t=e.SubscriptionMapper||(e.SubscriptionMapper={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){function t(e){return _.map(e,r)}function r(e){return{id:e.id,authId:e.authId,displayName:e.displayName,username:e.username,domainName:e.domainName,readOnly:e.readOnly}}e.map=t,e.mapOne=r}(t=e.UserMapper||(e.UserMapper={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){function r(e,t,r){return void 0===r&&(r={}),_.map(e,function(e){return{favorite:!!r[e.id],id:e.id,index:i.toNumber(e.index),name:e.name,path:e.path,tags:i.sortTags(e.tags),thumbnailUrl:e.thumbnailUrl,updatedAt:i.toDate(e.updatedAt),workbook:t[e.workbookId],hitsTotal:e.hitsTotal,favoritesTotal:e.favoritesTotal}})}function n(t){return{createdAt:i.toDate(t.createdAt),favorite:t.favorite,id:t.id,index:i.toNumber(t.index),name:t.name,path:t.path,tags:i.sortTags(t.tags),thumbnailUrl:t.thumbnailUrl,updatedAt:i.toDate(t.updatedAt),editUrl:t.editUrl,workbook:e.WorkbookMapper.mapParent(t.workbook,e.UserMapper.mapOne(t.owner),e.ProjectMapper.mapName(t.project))}}var i=e.MapperHelper;t.map=r,t.mapDetail=n}(t=e.ViewMapper||(e.ViewMapper={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){function r(e,t,r,i,o){return void 0===o&&(o={}),_.map(e,function(e){return n(e,t[e.ownerId],r[e.projectId],i,!!o[e.id])})}function n(e,t,r,n,i){return{defaultViewId:e.defaultViewId,displayTabs:e.displayTabs,downloadUrl:e.downloadUrl,favorite:i,id:e.id,name:e.name,numSheets:a.toNumber(e.sheetCount),owner:t,project:r,repositoryUrl:e.repositoryUrl,size:a.toNumber(e.size),tags:a.sortTags(e.tags),thumbnailUrl:e.thumbnailUrl,updatedAt:a.toDate(e.updatedAt),hasAlert:e.hasAlert,hasExtracts:e.hasExtracts,hasIncrementalExtract:e.hasIncrementalExtract,hitsTotal:e.hitsTotal,hitsLastTwoWeeksTotal:e.hitsLastTwoWeeksTotal,favoritesTotal:e.favoritesTotal,maxStatValues:n}}function i(t){return{createdAt:a.toDate(t.createdAt),description:t.description,displayTabs:t.displayTabs,downloadUrl:t.downloadUrl,favorite:t.favorite,id:t.id,name:t.name,owner:e.UserMapper.mapOne(t.owner),project:e.ProjectMapper.mapName(t.project),size:a.toNumber(t.size),tags:a.sortTags(t.tags),thumbnailUrl:t.thumbnailUrl,updatedAt:a.toDate(t.updatedAt),editUrl:t.editUrl,hasAlert:t.hasAlert,hasExtracts:t.hasExtracts,hasIncrementalExtract:t.hasIncrementalExtract,hitsTimeSeries:t.hitsTimeSeries}}function o(e,t,r,n){return void 0===r&&(r={}),void 0===n&&(n={}),_.map(e,function(e){return s(e,t[e.ownerId],r[e.projectId],!!n[e.id])})}function s(e,t,r,n){return{favorite:n,id:e.id,name:e.name,numSheets:a.toNumber(e.sheetCount),displayTabs:e.displayTabs,owner:t,project:r}}var a=e.MapperHelper;t.map=r,t.mapOne=n,t.mapDetail=i,t.mapParents=o,t.mapParent=s}(t=e.WorkbookMapper||(e.WorkbookMapper={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getComments",t)}return __extends(t,e),t}(e.Request);e.GetCommentsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){e.DataConnectionTypeKeys={connectionTypeDisplayName:"connectionTypeDisplayName",connectionType:"connectionType"}}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){e.ConnectionDetailType={Database:"database",TableauServer:"tableauserver",File:"file"}}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){e.ProjectKeys=e.NamedItemKeys}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getDatasources",t)}return __extends(t,e),t}(e.Request);e.GetDatasourcesRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getProjects",t)}return __extends(t,e),t}(e.Request);e.GetProjectsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getUsers",t)}return __extends(t,e),t}(e.Request);e.GetUsersRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getViews",t)}return __extends(t,e),t}(e.Request);e.GetViewsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getWorkbooks",t)}return __extends(t,e),t}(e.Request);e.GetWorkbooksRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){e.RefreshModeTypes={Server:"Server",Remote:"Remote"}}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){function r(t){if(!t.projects||t.projects.length<=0)return[];var r=f(e.UserMapper.map(t.users));return e.ProjectMapper.map(t.projects,r)}function n(t){if(!t.datasources||t.datasources.length<=0)return[];var r=f(e.UserMapper.map(t.users)),n=f(e.ProjectMapper.mapNames(t.projects)),i=f(e.WorkbookMapper.map(t.workbooks,r,n));return e.DatasourceMapper.map(t.datasources,r,n,i,h(t.favorites))}function i(t){if(!t.workbooks||t.workbooks.length<=0)return[];var r=f(e.UserMapper.map(t.users)),n=f(e.ProjectMapper.mapNames(t.projects));return e.WorkbookMapper.map(t.workbooks,r,n,t.stats,h(t.favorites))}function o(t){if(!t.views||t.views.length<=0)return[];var r=f(e.UserMapper.map(t.users)),n=f(e.ProjectMapper.mapNames(t.projects)),i=f(e.WorkbookMapper.mapParents(t.workbooks,r,n));return e.ViewMapper.map(t.views,i,h(t.favorites))}function s(t){if(!(t&&t.alerts&&t.alerts.length>0))return{total:0,alerts:[]};var r=f(t.workbooks),n=f(t.datasources);return e.AlertListMapper.map(t.totalCount,t.alerts,r,n)}function a(t){if(_.size(t.comments)<=0)return[];var r=f(t.users);return e.CommentMapper.map(t.comments,r)}function c(t){if(_.size(t.tasks)<=0)return[];var r=f(t.schedules),n=f(t.sites),i=f(t.workbooks),o=f(t.datasources);return e.ExtractTaskMapper.map(t.tasks,r,n,i,o)}function l(t){return _.size(t.schedules)<=0?[]:e.RemoteRefreshScheduleMapper.mapToResource(t.schedules)}function u(t){return _.size(t.agents)<=0?[]:e.RemoteRefreshAgentMapper.mapToResource(t.agents)}function d(t){return _.size(t.subscriptions)<=0?[]:e.SubscriptionMapper.map(t.subscriptions,f(t.schedules),f(t.sites),f(t.users))}function p(e){return e.fieldValues}function h(e){return _.indexBy(e,_.identity)}function f(t){return _.indexBy(t,e.NamedItemInfoKeys.id)}t.projects=r,t.dataSources=n,t.workbooks=i,t.views=o,t.alertList=s,t.comments=a,t.extractTasks=c,t.remoteRefreshSchedules=l,t.remoteRefreshAgents=u,t.subscriptions=d,t.fieldValues=p}(t=e.ServerApiMapper||(e.ServerApiMapper={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t,r){e.call(this,"addTagsToWorkbooks",{ids:t,tags:r})}return __extends(t,e),t}(e.Request);e.AddTagsToWorkbooksRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){e.ExtractTaskTargetType={Workbook:"Workbook",Datasource:"Datasource"},e.ExtractTaskType={RefreshExtract:"RefreshExtract",IncrementExtract:"IncrementExtract"}}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"createExtractTasks",t)}return __extends(t,e),t}(e.Request);e.CreateExtractTasksRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"deleteWorkbooks",{ids:t})}return __extends(t,e),t}(e.Request);e.DeleteWorkbooksRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getWorkbookActions",{id:t})}return __extends(t,e),t}(e.Request);e.GetWorkbookActionsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){e.RecentlyViewedObjectType={View:"view",Workbook:"workbook"};var t=function(e){function t(t){e.call(this,"markRecentlyViewed",t)}return __extends(t,e),t}(e.Request);e.MarkRecentlyViewedRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"moveWorkbooksToProject",t)}return __extends(t,e),t}(e.Request);e.MoveWorkbooksToProjectRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){var r=function(t){function r(r,n){var i=_.map(n,function(t){return e.TagsHelper.quote(t)});t.call(this,"removeTagsFromWorkbooks",{ids:r,tags:i})}return __extends(r,t),r}(t.Request);t.RemoveTagsFromWorkbooksRequest=r}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"revertWorkbook",t)}return __extends(t,e),t}(e.Request);e.RevertWorkbookRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t,r){e.call(this,"runExtractRefreshesOnWorkbooks",{ids:t,type:r})}return __extends(t,e),t}(e.Request);e.RunExtractRefreshesOnWorkbooksRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"setDisplayTabs",t)}return __extends(t,e),t}(e.Request);e.SetDisplayTabsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t,r){e.call(this,"setWorkbookDescription",{id:t,description:r})}return __extends(t,e),t}(e.Request);e.SetWorkbookDescriptionRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t,r){e.call(this,"setWorkbooksOwner",{ids:t,ownerId:r})}return __extends(t,e),t}(e.Request);e.SetWorkbooksOwnerRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n){this.$q=t,this.ErrorNotifyingServer=r,this.server=r.getServerService(),this.listFetcher=n.getServerResourceFetcher(e.ServerApi.GetWorkbooksRequest,e.ServerApiMapper.workbooks),this.allQuery=new e.ResourceQuery(this.listFetcher),this.detailFetcher=n.getServerDetailFetcher("getWorkbook",e.WorkbookMapper.mapDetail),this.fieldValuesFetcher=n.getServerResourceFetcher(e.ServerApi.GetFieldValuesRequest,e.ServerApiMapper.fieldValues)}return t.prototype.all=function(){return this.allQuery},t.prototype.getById=function(e){return this.detailFetcher.fetchById(e)},t.prototype.valuesForField=function(t){return new e.FieldValuesQuery(this.fieldValuesFetcher,t,e.ServerApi.FieldValueResourceType.workbook)},t.prototype.actions=function(t){return this.server.sendRequest(new e.ServerApi.GetWorkbookActionsRequest(t))},t.prototype.del=function(t){return this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.DeleteWorkbooksRequest(t)}),e.ResultHelper.combineResults)},t.prototype.setDescription=function(t,r){return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.SetWorkbookDescriptionRequest(t,r))},t.prototype.setOwner=function(t,r){return this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.SetWorkbooksOwnerRequest(t,r)}),e.ResultHelper.combineResults)},t.prototype.moveToProject=function(t,r){return this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests(r,function(r){return new e.ServerApi.MoveWorkbooksToProjectRequest({ids:r,projectId:t})}),e.ResultHelper.combineResults)},t.prototype.setDisplayTabs=function(t,r){return this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.SetDisplayTabsRequest({ids:t,displayTabs:r})}),e.ResultHelper.combineResults)},t.prototype.addTags=function(t,r){return r.length>0?this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests2(t,r,function(t,r){return new e.ServerApi.AddTagsToWorkbooksRequest(t,r)}),e.ResultHelper.combineResults):this.$q.when({})},t.prototype.removeTags=function(t,r){return r.length>0?this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests2(t,r,function(t,r){return new e.ServerApi.RemoveTagsFromWorkbooksRequest(t,r)}),e.ResultHelper.combineResults):this.$q.when({})},t.prototype.revertWorkbook=function(t,r){var n=new e.ServerApi.RevertWorkbookRequest({id:t,version:r});return this.ErrorNotifyingServer.sendRequest(n)},t.prototype.changeTags=function(t,r,n){var i=this;return this.removeTags(t,n).then(function(n){return e.ResultHelper.hasErrors(n)?n:i.addTags(t,r)})},t.prototype.createExtractTask=function(t,r,n){return this.ErrorNotifyingServer.sendRequests(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.CreateExtractTasksRequest({targetType:e.ServerApi.ExtractTaskTargetType.Workbook,targetIds:t,scheduleId:r,type:n})}),e.ResultHelper.combineResults)},t.prototype.refreshExtracts=function(t,r){return this.ErrorNotifyingServer.sendRequests(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.RunExtractRefreshesOnWorkbooksRequest(t,r)}),e.ResultHelper.combineResults)},t.prototype.markRecentlyViewed=function(t){return this.server.sendRequest(new e.ServerApi.MarkRecentlyViewedRequest({objectId:t,objectType:e.ServerApi.RecentlyViewedObjectType.Workbook}))},t.$inject=["$q","ErrorNotifyingServer","FetcherFactory"],t}();e.Workbooks=t,e.Module.instance().service("Workbooks",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i){this.modalService=e,this.$q=t,this.$window=r,this.$translate=n,this.getActionableObjectsForAction=i}return t.prototype.showEditPermissionsDialog=function(t){var r=this,n=t.scope.$new();return n.contentType===e.DatasourceContentType.name&&this.areAnyEmbeddedDatasourcesSelected(n.selectedItems)?this.$q.when(this.alertCantShowPermissions({translatedMessage:this.$translate.instant("permissions_notShowingEmbeddedAndPublishedDataSources",{ITEM_COUNT:n.selectedItems.size()},e.L10n.Interpolations.Count)})):this.getActionableObjectsForAction.editPermissions({type:n.contentType,ids:n.selectedItems.keys()}).then(function(t){var i=t.ids,o=n.selectedItems.clone();if(n.actionableItems=new e.Set(function(e){return e.id}),_.each(i,function(e){var t=n.selectedItems.get(e);n.actionableItems.add(t),o.remove(t)}),o.size()>0)return r.alertCantShowPermissions({translatedMessage:r.getCannotViewAllSelectedMessage(n.contentType,n.selectedItems)}).result;if(e.FeatureFlags.projectControlledPermissionsEnabled){n.authorizables=n.actionableItems.clone(),n.authorizableType=n.contentType,n.templateType=n.contentType;var s=e.getPermissionsPanelColumnWidths(n.templateType);n.permissionsContainerWidth=s.getPermissionsDialogWidth($(r.$window).width()),n.permissionsPanelHeight=r.calculatePermissionsPanelHeight()}else{if(r.determineInfoMessageFromAuthorizables(n),n.readOnly){var a=new e.Set(function(e){return e.id});n.actionableItems.each(function(e){e.workbook.displayTabs&&a.add(e.workbook)}),n.authorizables=a,n.authorizableType=e.WorkbookContentType.name,n.templateType=e.ViewContentType.name}else n.authorizables=n.actionableItems.clone(),n.authorizableType=n.contentType,n.templateType=n.contentType;var c=r.headerWidth(n.authorizableType,n.readOnly),s=e.getPermissionsPanelColumnWidths(n.templateType);n.permissionsContainerWidth=Math.max(s.getPermissionsDialogWidth($(r.$window).width()),c),r.setupDescriptionOnScope(n,n.readOnly),n.permissionsPanelHeight=r.calculatePermissionsPanelHeightWithoutPCP(!!n.permissionsInfoMessage)}return r.openPermissionsDialog(n).result}).fin(function(){return n.$destroy()})},t.prototype.determineInfoMessageFromAuthorizables=function(t){if(t.contentType===e.ViewContentType.name){var r=0,n=0;if(t.actionableItems.each(function(e){e.workbook.displayTabs?++r:++n}),r>0&&n>0)return this.alertCantShowPermissions({translatedMessage:this.$translate.instant("mixedTabbedWorkbookMessage",{ITEM_COUNT:t.selectedItems.size()},e.L10n.Interpolations.Count)}).result;r===t.actionableItems.size()&&(t.readOnly=!0,this.setupPermissionsInfoMessageForTabbedViewsOnScope(t,t.actionableItems));
}else t.contentType===e.WorkbookContentType.name&&this.setupPermissionsInfoMessageForWorkbooksOnScope(t,t.actionableItems)},t.prototype.openPermissionsDialog=function(t){return this.modalService.open({scope:t,templateUrl:e.FeatureFlags.projectControlledPermissionsEnabled?"permissionsDialog.html":"permissionsDialogWithoutPCP.html",size:e.ModalSize.fitToContent})},t.prototype.alertCantShowPermissions=function(e){return this.modalService.alert(_.extend({titleId:"permissions_cannotViewPermissions"},e))},t.prototype.headerWidth=function(t,r){var n=0;return r||t!==e.ProjectContentType.name&&t!==e.WorkbookContentType.name||(n=256),703+n},t.prototype.calculatePermissionsPanelHeightWithoutPCP=function(t){var r=42,n=33,i=28;t&&(i*=2,i+=17);var o=$(this.$window).height();return o-(r+n+i+e.ModalService.MinimumSpaceBetweenDialogAndViewport)},t.prototype.calculatePermissionsPanelHeight=function(){var t=44,r=39,n=$(this.$window).height();return n-(t+r+e.ModalService.MinimumSpaceBetweenDialogAndViewport)},t.prototype.setupDescriptionOnScope=function(r,n){var i,o=r.actionableItems.size(),s=o>0?r.authorizables.first().name:"";i=n?"readonlyViewPermissionsDescription":t.descriptionStringIdMap[r.contentType],r.editPermissionsDescription=this.$translate.instant(i,{ITEM_NAME:e.L10n.elideIfLong(s),ITEM_COUNT:o},e.L10n.Interpolations.Count)},t.prototype.setupPermissionsInfoMessageForWorkbooksOnScope=function(e,t){var r=0,n=0;t.each(function(e){e.displayTabs?++r:++n}),0===r?e.permissionsInfoMessage=this.$translate.instant("permissionsLongMessage_workbooksAllWithIndependentViews"):n>0&&(e.permissionsInfoMessage=this.$translate.instant("permissionsLongMessage_workbooksSomeWithIndependentViews"))},t.prototype.setupPermissionsInfoMessageForTabbedViewsOnScope=function(t,r){var n=_.uniq(r.map(function(e){return e.workbook.id})).length;if(1===n)var i=r.first().workbook,o=i.name;t.permissionsInfoMessage=this.$translate.instant("permissions_tabbedViewsMessage",{VIEW_COUNT:r.size(),WORKBOOK_COUNT:n,WORKBOOK_NAME:e.L10n.elideIfLong(o)},e.L10n.Interpolations.Count)},t.prototype.getCannotViewAllSelectedMessage=function(r,n){return this.$translate.instant(t.cannotViewAllSelectedMessageIdMap[r],{ITEM_NAME:e.L10n.elideIfLong(n.first().name),ITEM_COUNT:n.size()},e.L10n.Interpolations.Count)},t.prototype.areAnyEmbeddedDatasourcesSelected=function(e){return!!e.find(function(e){return!!e.workbook})},t.$inject=["ModalService","$q","$window","$translate","GetActionableObjectsForAction"],t.descriptionStringIdMap=function(){var t={};return t[e.ProjectContentType.name]="editProjectPermissionsDescription",t[e.WorkbookContentType.name]="editWorkbookPermissionsDescription",t[e.ViewContentType.name]="editViewPermissionsDescription",t[e.DatasourceContentType.name]="editDatasourcePermissionsDescription",t}(),t.cannotViewAllSelectedMessageIdMap=function(){var t={};return t[e.ProjectContentType.name]="permissions_cannotViewSelectedProjects",t[e.WorkbookContentType.name]="permissions_cannotViewSelectedWorkbooks",t[e.ViewContentType.name]="permissions_cannotViewSelectedViews",t[e.DatasourceContentType.name]="permissions_cannotViewSelectedDataSources",t}(),t}();e.EditPermissionsAction=t,e.Module.instance().service("EditPermissionsAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i){this.ViewErrors=e,this.ActionHelpers=t,this.ConfirmActionDialog=r,this.$translate=n,this.Views=i}return t.prototype.confirmDeleteViews=function(t,r){var n=this,i=r.scope,o=this.workbooksWithNoViews(t);return i.deleteViewsConfirmation=this.$translate.instant("confirmDeleteViews",{VIEW_COUNT:t.size(),VIEW_NAME:e.L10n.elideIfLong(t.first().name)},e.L10n.Interpolations.Count),i.deleteWorkbooksConfirmation=o.length>0?this.$translate.instant("confirmDeleteViewsWorkbookWarning",{WORKBOOK_COUNT:o.length,WORKBOOK_NAME:e.L10n.elideIfLong(o[0].name)},e.L10n.Interpolations.Count):null,this.ConfirmActionDialog.open({scope:r.scope,title:this.$translate.instant("delete"),bodyTemplateUrl:"confirmDeleteViews.html",actionName:this.$translate.instant("confirmDeleteButton",{ITEM_COUNT:t.size()},e.L10n.Interpolations.Count),isDeleteAction:!0,action:function(e){return n.Views.hide(t.keys()).then(function(e){return n.notifyResult(t,e)})}}).result},t.prototype.workbooksWithNoViews=function(e){var t=[],r={};return e.each(function(e){var n=r[e.workbook.id]||0;n++,n===e.workbook.numSheets&&t.push(e.workbook),r[e.workbook.id]=n}),t},t.prototype.notifyResult=function(e,t){var r=this;this.ActionHelpers.notifyStandardError(e,{successId:"deleteViewsSuccess",errorId:"deleteViewsError"},function(e){return r.ViewErrors.errorDetailsFor(e)})(t)},t.$inject=["ViewErrors","ActionHelpers","ConfirmActionDialog","$translate","Views"],t}();e.HideViewsAction=t,e.Module.instance().service("HideViewsAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n,i,o,s,a,c,l,u){this.$state=t,this.ServerService=r,this.contentActions=n,this.EditConnectionAction=i,this.EditPermissionsAction=o,this.HideViewsAction=s,this.SetDisplayTabsAction=a,this.CreateExtractTasksAction=c,this.DeleteDatasourcesAction=l,this.RevisionHistoryAction=u,this.contentActionDefinitions={project:[this.permissionsAction(),this.renameAction(this.bind(n.renameProjectPopup)),this.changeOwnerAction(this.bind(n.changeOwnerOnProjects),e.CommonErrorCode.ProjectNotFound),this.deleteProjectsAction()],datasource:[this.newWorkbookAction(),this.downloadDatasourceAction(),this.setTagsOnDatasourcesAction(),this.datasourcePermissionsAction(),this.moveDatasourcesToProjectAction(),this.changeOwnerOnDatasourcesAction(),this.createExtractRefreshForDatasourcesAction(),this.editConnectionAction(),this.deleteDatasourcesAction()],workbook:[this.editAction(this.bind(n.editWorkbook),"editWorkbook_action"),this.downloadWorkbookAction(),this.changeTags(this.bind(n.setTagsOnWorkbooks),e.CommonErrorCode.WorkbookNotFound),this.permissionsAction(),this.moveWorkbooksToProjectAction(),this.changeOwnerAction(this.bind(n.changeOwnerOnWorkbooks),e.CommonErrorCode.WorkbookNotFound),this.createExtractRefreshForWorkbooksAction(),this.setDisplayTabsAction(),this.viewWorkbookRevisionHistoryAction(),this.deleteWorkbooksAction()],view:[this.editAction(this.bind(n.editView),"editView_action"),this.changeTags(this.bind(n.setTagsOnViews),e.CommonErrorCode.ViewNotFound),this.permissionsAction(),this.deleteViewsAction()],sites:[this.activateSiteAction(this.bind(n.activateSite)),this.suspendSiteAction(this.bind(n.suspendSite)),this.editSiteSettingsAction(this.bind(n.editSite)),this.deleteSitesAction(this.bind(n.deleteSites))]}}return t.prototype.bind=function(e){return angular.bind(this.contentActions,e)},t.anySelected=function(e){return e.size()>0},t.oneSelected=function(e){return 1===e.size()},t.oneSelectedEmbeddedDatasource=function(e){return t.oneSelected(e)&&!!e.first().workbook},t.prototype.oneSelectedUnrefreshableItem=function(e){if(t.oneSelected(e)){var r=e.first();return!r.hasExtracts||!this.isAdminOrOwner(r.owner.id)}return!1},t.prototype.oneSelectedUnrefreshableDatasource=function(e){if(t.oneSelected(e)){var r=e.first();return!this.CreateExtractTasksAction.isRefreshableDatasource(r)||!this.isAdminOrOwner(r.owner.id)}return!1},t.prototype.isAdminOrOwner=function(e){return this.ServerService.isSessionSiteOrServerAdmin()||e===this.ServerService.sessionUserId()},t.prototype.getUpdateSiteAvailabilityDisabledFn=function(t){return function(r){if(1===r.size()){var n=r.first();return""===n.settings.urlName||n.availability===t||n.availability===e.SiteAvailabilityState.LOCKED}return!1}},t.prototype.moveDatasourcesToProjectAction=function(){var r=this;return{name:"move",translate:"move_action",isAvailable:t.anySelected,isDisabled:function(e,r,n){return!!n&&!n.setProject||t.oneSelectedEmbeddedDatasource(e)},execute:function(t,n){var i=n.scope;r.contentActions.moveDatasourcesToProject(t,n).then(function(t){"project"===i.place?e.ActionHelpers.deselectAllExceptErrors(i.selectedItems,t,e.CommonErrorCode.DatasourceNotFound):e.ActionHelpers.deselectNotFound(i.selectedItems,t,e.CommonErrorCode.DatasourceNotFound),i.refreshContent()})}}},t.prototype.moveWorkbooksToProjectAction=function(){var r=this;return{name:"move",translate:"move_action",isAvailable:t.anySelected,isDisabled:function(e,t,r){return!!r&&!r.setProject},execute:function(t,n){var i=n.scope;r.contentActions.moveWorkbooksToProject(t,n).then(function(t){"project"===i.place?e.ActionHelpers.deselectAllExceptErrors(i.selectedItems,t,e.CommonErrorCode.WorkbookNotFound):e.ActionHelpers.deselectNotFound(i.selectedItems,t,e.CommonErrorCode.WorkbookNotFound),i.refreshContent()})}}},t.prototype.deleteProjectsAction=function(){var r=this;return{name:"delete",translate:"delete_action",isAvailable:t.anySelected,isDisabled:function(e,t,r){return!!r&&!r.del},execute:function(t,n){var i=n.scope;r.contentActions.deleteProjects(t,n).then(function(t){e.ActionHelpers.deselectAllExceptErrors(i.selectedItems,t,e.CommonErrorCode.ProjectNotFound),i.refreshContent()})}}},t.prototype.deleteDatasourcesAction=function(){var r=this;return{name:"delete",translate:"delete_action",isAvailable:t.anySelected,isDisabled:function(e,r,n){return!!n&&!n.del||t.oneSelectedEmbeddedDatasource(e)},execute:function(t,n){var i=n.scope;r.DeleteDatasourcesAction.confirmDeleteDatasources(t,n).then(function(t){t.allowed&&(e.ActionHelpers.deselectAllExceptErrors(i.selectedItems,t.serverResult,e.CommonErrorCode.DatasourceNotFound),i.refreshContent())})}}},t.prototype.deleteWorkbooksAction=function(){var r=this;return{name:"delete",translate:"delete_action",isAvailable:t.anySelected,isDisabled:function(e,t,r){return!!r&&!r.del},execute:function(t,n){var i=n.scope;r.contentActions.deleteWorkbooks(t,n).then(function(t){e.ActionHelpers.deselectAllExceptErrors(i.selectedItems,t,e.CommonErrorCode.WorkbookNotFound),i.refreshContent()})}}},t.prototype.deleteViewsAction=function(){var r=this;return{name:"delete",translate:"delete_action",isAvailable:t.anySelected,isDisabled:function(e,t,r){return!!r&&!r.del},execute:function(t,n){var i=n.scope;r.HideViewsAction.confirmDeleteViews(t,n).then(function(o){var s=t.size()===i.subplaceCounts.views;i.place===e.ContentTypes.workbook&&s?r.$state.go("main.site.content.project.workbooks",{id:n.scope.workbook.project.id}):(e.ActionHelpers.deselectAllExceptErrors(i.selectedItems,o,e.CommonErrorCode.ViewNotFound),i.refreshContent())})}}},t.prototype.viewWorkbookRevisionHistoryAction=function(){var r=this;return{name:"view-revision-history",translate:"revisionHistory_action",isAvailable:function(){return t.anySelected&&e.FeatureFlags.workbookVersionHistoryEnabled},isDisabled:function(){return!1},execute:function(e){r.RevisionHistoryAction.showRevisionHistory(e.first())}}},t.prototype.renameAction=function(e){return{name:"rename",translate:"rename_action",isAvailable:t.anySelected,isDisabled:function(e,r,n){return!!n&&!n.setName||!t.oneSelected(e)},execute:function(t,r){var n=r.scope;e(t.first(),r).then(function(){return n.refreshContent()})}}},t.prototype.downloadDatasourceAction=function(){var e=this;return{name:"download",isAvailable:t.anySelected,isDisabled:function(e,r,n){return!!n&&!n.download||!t.oneSelected(e)||t.oneSelectedEmbeddedDatasource(e)},execute:function(t,r){var n=r.scope;e.contentActions.downloadDatasource(t.first()).fail(function(){return n.refreshContent()})}}},t.prototype.downloadWorkbookAction=function(){var e=this;return{name:"download",isAvailable:t.anySelected,isDisabled:function(e,r,n){return!!n&&!n.download||!t.oneSelected(e)},execute:function(t,r,n){var i=n||t.first(),o=r.scope;e.contentActions.downloadWorkbook(i).fail(function(){return o.refreshContent()})}}},t.prototype.permissionsAction=function(){var e=this;return{name:"permissions",translate:"permissions_action",isAvailable:t.anySelected,isDisabled:function(e,t,r){return r&&!r.setPermissions},execute:function(t,r){e.EditPermissionsAction.showEditPermissionsDialog(r)}}},t.prototype.datasourcePermissionsAction=function(){var e=this;return{name:"permissions",translate:"permissions_action",isAvailable:t.anySelected,isDisabled:function(e,r,n){return n&&!n.setPermissions||t.oneSelectedEmbeddedDatasource(e)},execute:function(t,r){e.EditPermissionsAction.showEditPermissionsDialog(r)}}},t.prototype.changeOwnerAction=function(r,n){return{name:"change-owner",translate:"changeOwner_action",isAvailable:t.anySelected,isDisabled:function(e,t,r){return!!r&&!r.setOwner},execute:function(t,i){var o=i.scope,s=i.scope;r(t,i).then(function(t){s.user?e.ActionHelpers.deselectAllExceptErrors(o.selectedItems,t,n):e.ActionHelpers.deselectNotFound(o.selectedItems,t,n),o.refreshContent()})}}},t.prototype.changeOwnerOnDatasourcesAction=function(){var r=this;return{name:"change-owner",translate:"changeOwner_action",isDisabled:function(e,r,n){return!!n&&!n.setOwner||t.oneSelectedEmbeddedDatasource(e)},isAvailable:t.anySelected,execute:function(t,n){var i=n.scope,o=n.scope;r.contentActions.changeOwnerOnDatasources(t,n).then(function(t){o.user?e.ActionHelpers.deselectAllExceptErrors(i.selectedItems,t,e.CommonErrorCode.DatasourceNotFound):e.ActionHelpers.deselectNotFound(i.selectedItems,t,e.CommonErrorCode.DatasourceNotFound),i.refreshContent()})}}},t.prototype.suspendSiteAction=function(r){return{name:"suspend-site",translate:"suspend_action",isAvailable:t.anySelected,isDisabled:this.getUpdateSiteAvailabilityDisabledFn(e.SiteAvailabilityState.SUSPENDED),execute:function(t,n){var i=n.scope;r(t,n).then(function(t){e.ActionHelpers.deselectNotFound(i.selectedItems,t,e.CommonErrorCode.SiteNotFound),i.refreshContent()})}}},t.prototype.activateSiteAction=function(r){return{name:"activate-site",translate:"activate_action",isAvailable:t.anySelected,isDisabled:this.getUpdateSiteAvailabilityDisabledFn(e.SiteAvailabilityState.ACTIVE),execute:function(t,n){var i=n.scope;r(t,n).then(function(t){e.ActionHelpers.deselectNotFound(i.selectedItems,t,e.CommonErrorCode.SiteNotFound),i.refreshContent()})}}},t.prototype.editSiteSettingsAction=function(e){return{name:"edit-site-settings",translate:"editSiteSettings_action",isAvailable:t.anySelected,isDisabled:function(e){return!t.oneSelected(e)},execute:function(t,r){var n=r.scope;e(t.first(),r).then(function(){return n.refreshContent()})}}},t.prototype.deleteSitesAction=function(r){return{name:"delete",translate:"delete_action",isAvailable:t.anySelected,isDisabled:function(e){return 1===e.size()&&""===e.first().settings.urlName},execute:function(t,n){var i=n.scope;r(t,n).then(function(t){e.ActionHelpers.deselectAllExceptErrors(i.selectedItems,t,e.CommonErrorCode.SiteNotFound),i.refreshContent()})}}},t.prototype.editAction=function(e,r){return{name:"edit-workbook",translate:r,isAvailable:t.anySelected,isDisabled:function(e,t,r){return!t||!t.editUrl||!!r&&!r.launchWebAuthoring},execute:function(t,r,n){n&&e(n)}}},t.prototype.newWorkbookAction=function(){var e=this;return{name:"new-workbook",translate:"newWorkbook",isAvailable:t.anySelected,isDisabled:function(e,t,r){return!t||!t.newWorkbookUrl||!!r&&!r.launchWebAuthoring},execute:function(t,r,n){n&&e.contentActions.newWorkbook(n)}}},t.prototype.changeTags=function(r,n){return{name:"change-tags",translate:"tag_action",isAvailable:t.anySelected,execute:function(t,i){var o=i.scope;r(t,i).then(function(t){e.ActionHelpers.deselectNotFound(o.selectedItems,t,n),o.refreshContent()})}}},t.prototype.setTagsOnDatasourcesAction=function(){var r=this;return{name:"change-tags",translate:"tag_action",isAvailable:t.anySelected,isDisabled:function(e){return t.oneSelectedEmbeddedDatasource(e)},execute:function(t,n){var i=n.scope;r.contentActions.setTagsOnDatasources(t,n).then(function(t){e.ActionHelpers.deselectNotFound(i.selectedItems,t,e.CommonErrorCode.DatasourceNotFound),i.refreshContent()})}}},t.prototype.createExtractRefreshForDatasourcesAction=function(){var r=this;return{name:"create-extract-refresh",translate:"extractTasks_action",isAvailable:t.anySelected,isDisabled:function(e){return r.oneSelectedUnrefreshableDatasource(e)},execute:function(t,n){var i=n.scope;r.CreateExtractTasksAction.forDatasources(t,n,e.CreateExtractTasksMode.AllowBoth).then(function(t){e.ActionHelpers.deselectNotFound(i.selectedItems,t,e.CommonErrorCode.DatasourceNotFound),i.refreshContent()})}}},t.prototype.createExtractRefreshForWorkbooksAction=function(){var r=this;return{name:"create-extract-refresh",translate:"extractTasks_action",isAvailable:t.anySelected,isDisabled:function(e,t){return r.oneSelectedUnrefreshableItem(e)},execute:function(t,n){var i=n.scope;r.CreateExtractTasksAction.forWorkbooks(t,n,e.CreateExtractTasksMode.AllowBoth).then(function(t){e.ActionHelpers.deselectNotFound(i.selectedItems,t,e.CommonErrorCode.WorkbookNotFound),i.refreshContent()})}}},t.prototype.editConnectionAction=function(){var r=this;return{name:"edit-connection",translate:"editConnection_action",isAvailable:t.anySelected,isDisabled:function(e){return 1===e.size()&&!r.isConnectionEditable(e.first())},execute:function(t,n){var i=n.scope;r.EditConnectionAction.confirmEditConnections(t,n).then(function(t){e.ActionHelpers.deselectNotFound(i.selectedItems,t,e.CommonErrorCode.DatasourceNotFound),i.refreshContent()})}}},t.prototype.setDisplayTabsAction=function(){var r=this;return{name:"setDisplayTabs",translate:"setDisplayTabs_action",isAvailable:t.anySelected,isDisabled:function(e,t,r){return!!r&&!r.setDisplayTabs},execute:function(t,n){var i=n.scope;r.SetDisplayTabsAction.confirmSetDisplayTabs(t,n).then(function(t){e.ActionHelpers.deselectNotFound(i.selectedItems,t,e.CommonErrorCode.WorkbookNotFound),i.refreshContent()})}}},t.prototype.isConnectionEditable=function(e){return e.connectionTypeEditable&&this.isAdminOrOwner(e.owner.id)},t.prototype.getContentActionButtons=function(t,r){return r===e.WorkbookContentType.name&&t===e.DatasourceContentType.name?[this.editConnectionAction()]:this.contentActionDefinitions[t]},t.$inject=["$state","ServerService","ContentActions","EditConnectionAction","EditPermissionsAction","HideViewsAction","SetDisplayTabsAction","CreateExtractTasksAction","DeleteDatasourcesAction","RevisionHistoryAction"],t}();e.ActionPanelService=t,e.Module.instance().service("ActionPanelService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){function r(t,r){t.menuActions=r,t.showActionMenu=function(){return _.any(t.menuActions,t.availableAction)},t.actionButtonContext=e.ActionContext.fromEvent,t.actionMenuContext=function(e){return{scope:t}}}t.setupActionButtons=r}(t=e.ActionButtonsHelper||(e.ActionButtonsHelper={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(){}return e.Refresh="Refresh",e.RefreshCounts="RefreshCounts",e}();e.SubplaceEvents=t;var r;!function(e){function r(e,r){e.subplaceTabClicked=function(n){var i=r.includes("**."+n+".**");i?e.$broadcast(t.Refresh):e.$broadcast(t.RefreshCounts,n)}}e.refreshWhenCurrentTabClicked=r}(r=e.SubplaceTabsHelper||(e.SubplaceTabsHelper={}));var n;!function(e){function r(e,t,r){e.subplaceCounts[t.name]=r}function n(e,r){var n={};e.subplaceCounts=e.subplaceCounts||{};var i=function(t){_.each(r.subplaces(),function(r){var i=r.name,o=r.query(),s=o.getFilters();(t||!_.isEqual(s,n[i]))&&(n[i]=s,o.getCount().then(function(t){e.subplaceCounts[r.name]=t}))})};e.$on("$locationChangeSuccess",function(){i()}),e.$on(t.RefreshCounts,function(){i(!0)}),i()}e.updateCountsFromSubplace=r,e.keepSubplaceCountsUpdated=n}(n=e.SubplaceCountsHelper||(e.SubplaceCountsHelper={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e,t){this.itemWidth=e,this.itemHeight=t}return e.prototype.metrics=function(e){return{numberOfRows:Math.max(Math.ceil(e.height/this.itemHeight),1),numberOfCols:Math.max(Math.floor(e.width/this.itemWidth),1),heightOfRowInPx:this.itemHeight}},e}();e.FlowLayout=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e,t){this.$window=e,this.server=t}return e.prototype.search=function(e){e=encodeURIComponent(e),this.server.offlineHelpEnabled()?this.$window.open(this.offlineHelpRoute("search-")+e,"_blank"):this.$window.open(this.supportUrlPrefix()+"/search/support/"+e,"_blank")},e.prototype.getServerHelpUrlByCategory=function(t){if(this.server.offlineHelpEnabled())return this.offlineHelpRoute(e.ONLINE_TOKEN_OFFLINE_PAGE_DICT[t]);var r=this.helpUrlLanguage(),n=$.param({edition:this.server.helpEdition(),lang:r,version:this.externalVersion()});return e.tableauUrl+"/"+r+"/app/server-"+(t?t:"help1")+"?"+n},e.prototype.getGeneralSupportUrl=function(){return"online"!==this.server.helpEdition()?this.supportUrlPrefix()+"/support":"https://"+this.server.sessionSupportHost()+this.server.sessionSupportPath()+"?"+$.param({uid:this.server.sessionAuthUserId(),serverSiteUserId:this.server.sessionUserId(),serverSiteId:this.server.sessionSiteLuid(),serverInstanceId:this.server.sessionServerId()})},e.prototype.getDatasourceHelpUrl=function(){var e=this.server.datasourceHelpUrl();if(!e)return"";var t=e.indexOf("?")>=0?"&":"?",r=$.param({lang:this.helpUrlLanguage(),version:this.externalVersion()});return e+t+r},e.prototype.getHelpLinkLocKey=function(){return"online"===this.server.helpEdition()?"onlineHelp":"serverHelp"},e.prototype.supportUrlPrefix=function(){var t=this.helpUrlLanguage();return e.tableauUrl+("en-us"===t?"":"/"+t)},e.prototype.offlineHelpRoute=function(e){var t=this.helpUrlLanguage().replace("-","_");return"offline_help/"+t+"/help.htm"+(e?"#"+e:"")},e.prototype.externalVersion=function(){var e=this.server.sessionServerVersion().externalVersion,t=/^\d+$/;return t.test(e.major)&&t.test(e.minor)?e.major+"."+e.minor:"0.0"},e.prototype.helpUrlLanguage=function(){switch(this.server.sessionLanguage()){case"de":return"de-de";case"en":return"en-us";case"es":return"es-es";case"fr":return"fr-fr";case"ja":return"ja-jp";case"ko":return"ko-kr";case"pt":return"pt-br";case"zh":return"zh-cn";default:return"en-us"}},e.ONLINE_TOKEN_OFFLINE_PAGE_DICT={adminusers2:"csvguidelines.htm",status1:"service_viewstatus.htm","settings-adsync1":"groups_globalsync.htm"},e.tableauUrl="http://www.tableau.com",e.$inject=["$window","ServerService"],e}();e.HelpService=t,e.Module.instance().service("HelpService",t)}(VizPortal||(VizPortal={}));var VizPortalReact;!function(e){var t;!function(e){e.instance=new Flux.Dispatcher}(t=e.Dispatcher||(e.Dispatcher={}))}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){function t(r){var n={actionType:t.Type,order:r};e.Dispatcher.instance.dispatch(n)}e.SetOrderAction=t;var t;!function(e){e.Type="set-order"}(t=e.SetOrderAction||(e.SetOrderAction={}))}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(){function e(){this.changeListeners=[]}return e.prototype.addChangeListener=function(e){this.changeListeners=this.changeListeners.concat(e)},e.prototype.removeChangeListener=function(e){this.changeListeners=_.without(this.changeListeners,e)},e.prototype.broadcast=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this.changeListeners.map(function(t){t.apply(null,e)})},e}();e.Store=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(r){var n=this;t.call(this),this.order=r,e.Dispatcher.instance.register(function(t){switch(t.actionType){case e.SetOrderAction.Type:n.order=t.order,n.broadcast()}})}return __extends(r,t),r.prototype.getOrderClauses=function(){return this.order},r}(e.Store);e.OrderStore=t}(VizPortalReact||(VizPortalReact={}));var VizPortal;!function(e){var t=function(){function e(e){this.$location=e}return e.prototype.create=function(e){return new r(this.$location,e)},e.$inject=["$location"],e}();e.SorterFactory=t;var r=function(){function t(e,t){this.$location=e,this.defaultOrder=t,this.orderStore=new VizPortalReact.OrderStore(t)}return t.prototype.setPrimary=function(t,r){if(t){var n=this.orderStore.getOrderClauses();e.Order.startsWithField(n,t)?(_.isEqual(n,this.defaultOrder)&&n.length>0&&(n=n.slice(0,1)),n=e.Order.withFirstClauseToggled(n)):(_.isEqual(n,this.defaultOrder)&&(n=[]),n=e.Order.withClausePrepended(n,{field:t,ascending:"asc"===r})),VizPortalReact.SetOrderAction(n),this.updateOrder()}},t.prototype.removeFieldFromOrder=function(t){var r=this.orderStore.getOrderClauses();r=e.Order.withoutField(r,t),r.length||(r=this.defaultOrder),VizPortalReact.SetOrderAction(r),this.updateOrder()},t.prototype.setOrder=function(e){VizPortalReact.SetOrderAction(e),this.updateOrder()},t.prototype.getOrderClauses=function(){return this.orderStore.getOrderClauses()},t.prototype.isSortAscending=function(){var e=this.orderStore.getOrderClauses();return e[0].ascending},t.prototype.selectedColumnKey=function(){var e=this.orderStore.getOrderClauses();return e.length>0?e[0].field:""},t.prototype.isSortAscendingBy=function(e){return this.selectedColumnKey()===e&&this.isSortAscending()},t.prototype.isSortDescendingBy=function(e){return this.selectedColumnKey()===e&&!this.isSortAscending()},t.prototype.getOrderStore=function(){return this.orderStore},t.prototype.updateOrder=function(){var t=this.orderStore.getOrderClauses();t&&t.length>0&&this.$location.search("order",_.isEqual(t,this.defaultOrder)?null:e.Order.serialize(t))},t}();e.Sorter=r,e.Module.instance().service("SorterFactory",t)}(VizPortal||(VizPortal={}));var VizPortalReact;!function(e){var t=function(){function e(e){var t=_.isString(e.queryString)?e.queryString:"";t&&t.length>0&&"?"!==t[0]&&(t="?"+t);var r=_.isString(e.siteUrlName)&&e.siteUrlName.length>0?"/site/"+e.siteUrlName:"";this.prefix="/"+t+"#"+r,this.queryString=t}return e.prototype.forSiteUrlName=function(t){return new e({siteUrlName:t,queryString:this.queryString})},e.prototype.home=function(){return this.prefix+"/home"},e.prototype.projectUrl=function(e){return this.prefix+"/projects/"+e},e.prototype.projectViewsUrl=function(e){return this.projectUrl(e)+"/views"},e.prototype.projectsUrl=function(){return this.prefix+"/projects"},e.prototype.workbookUrl=function(e){return this.prefix+"/workbooks/"+e},e.prototype.workbookViewsUrl=function(e){return this.workbookUrl(e)+"/views"},e.prototype.workbookDatasourcesUrl=function(e){return this.workbookUrl(e)+"/datasources"},e.prototype.favoriteWorkbook=function(e){return this.workbookUrl(e)},e.prototype.viewUrl=function(e){return this.prefix+"/views/"+e},e.prototype.favoriteView=function(e){return this.prefix+"/redirect_to_view/"+e},e.prototype.usersUrl=function(){return this.prefix+"/users"},e.prototype.userContentUrl=function(e){return this.prefix+"/user/"+e.domainName+"/"+e.username+"/workbooks"},e.prototype.userSettingsUrl=function(e){return this.prefix+"/user/"+e.domainName+"/"+e.username+"/settings"},e.prototype.datasourceUrl=function(e){return this.prefix+"/datasources/"+e},e.prototype.datasourceDetailsUrl=function(e){return this.datasourceUrl(e)+"/details"},e.prototype.datasourceDataConnectionUrl=function(e){return this.datasourceUrl(e)+"/dataConnection"},e.prototype.groupsUrl=function(){return this.prefix+"/groups"},e.prototype.group=function(e){return this.prefix+"/groups/"+e},e.prototype.schedule=function(e,t){return this.prefix+"/schedules/"+e+"/"+(t===VizPortal.ServerApi.ScheduleActions.Extract?"extractRefreshes":"subscriptions")},e.prototype.schedulesUrl=function(){return this.prefix+"/schedules"},e.prototype.settingsUrl=function(){return this.prefix+"/settings"},e.prototype.statusUrl=function(){return this.prefix+"/status"},e.prototype.tasksUrl=function(){return this.prefix+"/tasks"},e}();e.SiteUrls=t}(VizPortalReact||(VizPortalReact={}));var VizPortal;!function(e){var t=function(){function e(e,t,r){this.$scope=e,this.$injector=t,this.$compile=r}return e.prototype.compileElement=function(e,t){var r=t?t(this.$scope):this.$scope;return this.$compile(e)(r),e},e.prototype.getService=function(e){return this.$injector.get(e)},e.prototype.enqueueDigest=function(){this.$scope.$evalAsync(angular.noop)},e.prototype.evalAsync=function(e){this.$scope.$evalAsync(e)},e}();e.AngularContext=t,e.Module.instance().factory("AngularContextFactory",["$injector","$compile",function(e,r){return{create:function(n){return new t(n,e,r)}}}])}(VizPortal||(VizPortal={}));var VizPortalReact;!function(e){var t=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.shouldComponentUpdate=function(e,t){return React.addons.PureRenderMixin.shouldComponentUpdate.call(this,e,t)},t.prototype.render=function(){var e=this,t=["tb-favorite-button"];return this.props.isFavorite&&t.push("tb-selected"),React.DOM.span({className:"tb-favorite-button-cell",onClick:function(t){return e.handleClick(t)},"data-tb-test-id":this.props.testId},React.DOM.span({className:t.join(" ")}))},t.prototype.handleClick=function(e){this.props.onSetFavorite&&this.props.onSetFavorite(!this.props.isFavorite),e.preventDefault(),e.stopPropagation()},t.displayName="DataGridFavoriteToggle",t.element=React.createFactory(t),t}(React.Component);e.DataGridFavoriteToggle=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t;!function(t){function r(e){return React.createFactory(React.createClass({handleClick:function(t){var r=this.props;e.onCheckboxClicked(r.row),t.preventDefault(),t.stopPropagation()},render:function(){var t=this.props,r=["tb-checkbox"];return t.isSelected&&r.push("tb-checked"),React.DOM.span({className:"tb-checkbox-cell",onClick:this.handleClick,"data-tb-test-id":e.checkboxCellTestId},React.DOM.span({className:r.join(" ")}))}}))}function n(t){return React.createFactory(React.createClass({render:function(){var r=this.props;return e.DataGridFavoriteToggle.element({isFavorite:r.row.data.favorite,onSetFavorite:function(e){e?t.onAddFavorite(r.row):t.onRemoveFavorite(r.row)},testId:t.favoriteCellTestId})}}))}function i(t,r){return React.createFactory(React.createClass({render:function(){var n=t(this.props);return r.menuDisabled&&r.menuDisabled(this.props.row)?n:e.ActionsMenuColumnCell.element({actions:r.actions,getActionTarget:r.getActionTarget,translate:r.translate,testId:r.testId},n)}}))}function o(e,t,r){return React.createFactory(React.createClass({render:function(){var n=this.props,i=n.row.data[e];if(!i)return null;var o="siteRole_"+i;return React.DOM.span({"data-tb-test-id":r},t.instant(o))}}))}function s(e){return React.createFactory(React.createClass({render:function(){var t=this.props,r=React.DOM.a({href:"/#/user/"+t.row.data.domainName+"/"+t.row.data.username+"/workbooks"},t.value);return"Guest"===t.row.data.siteRole&&(r=React.DOM.span({},t.value)),React.DOM.span({"data-tb-test-id":e},React.DOM.span({className:"tb-grid-icon-user"}),r)}}))}function a(e){return React.createFactory(React.createClass({render:function(){var t=e(this.props.row),r=React.DOM.a({href:t.url,title:t.text,style:t.style},t.text);return React.DOM.span({"data-tb-test-id":t.testId},React.DOM.span({className:t.iconClassName,title:t.iconTitle}),r)}}))}function c(e){return React.createFactory(React.createClass({render:function(){return React.DOM.span({title:e},e)}}))}function l(e,t){return React.createFactory(React.createClass({render:function(){var r=this.props,n=r.row.data[e];return React.DOM.span({title:n,"data-tb-test-id":t},n)}}))}function u(e,t,r){return React.createFactory(React.createClass({render:function(){var n=this.props,i=t(n.row.data[e]);return React.DOM.span({title:i,"data-tb-test-id":r},i)}}))}function d(e,t,r){return React.createFactory(React.createClass({render:function(){var n=this.props,i=n.row.data[e];return React.DOM.span({"data-tb-test-id":r},i?VizPortal.L10n.localizedDateTime(i):t)}}))}function p(e,t,r){return React.createFactory(React.createClass({render:function(){var n=this.props,i=n.row.data[e];return React.DOM.span({"data-tb-test-id":r},t(i))}}))}function h(e){var t=e.split(".");return React.createFactory(React.createClass({render:function(){var e=this.props.row.data;return _.each(t,function(t){e=e[t]}),React.DOM.span({className:e?"tb-icon-checkmark":null})}
}))}function f(t){return React.createFactory(React.createClass({render:function(){return e.AngularDirective.element({angularContext:t,template:"<tb:popup-menu>  <tb:popup-menu-custom-button class='tb-data-grid-action-menu'>    <span class='tb-action-icon'></span>  </tb:popup-menu-custom-button>  <tb:popup-menu-content>    <div ng-include=\"'actionMenu.html'\"></div>  </tb:popup-menu-content></tb:popup-menu>"})}}))}function m(e,t){return React.createFactory(React.createClass({render:function(){var r=this.props,n=r.row.data[e],i=VizPortal.L10n.localizedCount(n);return React.DOM.span({"data-tb-test-id":t},i)}}))}function v(t,r,n){return React.createFactory(React.createClass({render:function(){var i=this.props,o=i.row.data[t],s=VizPortal.L10n.localizedCount(o),a=r(i.row.data)[t],c=a?o/a:0,l=VizPortal.FeatureFlags.useTallerRowHeight?e.CommonStyles.Sizes.DefaultSpace:e.CommonStyles.Sizes.SmallSpace;return React.DOM.div({style:{marginTop:l,height:e.DataGrid.BodyRow.InnerHeight-2*l,width:100*c+"%",backgroundColor:i.isSelected?e.CommonStyles.Colors.Grey245:e.CommonStyles.Colors.Grey218},"data-tb-test-id":n},React.DOM.span({style:{lineHeight:e.DataGrid.BodyRow.InnerHeight-2*l+"px",paddingLeft:e.CommonStyles.Sizes.DefaultSpace,verticalAlign:"top"}},s))}}))}function S(t,r,n,i){return React.createFactory(React.createClass({render:function(){var o=this.props,s=o.row.data.hasAlert;if(!s)return null;var a=o.row.data.id;return e.Menu.element({tbTestId:i,menuButtonFactory:function(){return React.DOM.span({className:"tb-data-grid-icon tb-icon-alert","data-tb-test-id":i,title:r("hasAlert")},"")},menuPanelFactory:function(){return e.AngularDirective.element({angularContext:n,template:"<div class='tb-popup-menu-content tb-padded-small' style='min-width: 250px; white-space: normal; line-height: normal'>  <tb:alert-info type=\"'"+t+"'\" id=\"'"+a+"'\"></tb:alert-info></div>"})}})}}))}function g(e,t){return React.createFactory(React.createClass({render:function(){var r=this.props.row,n=r.data.schedule;return React.DOM.span({},React.DOM.a({href:e(r),title:n.name},n.name),React.DOM.span({dangerouslySetInnerHTML:{__html:"&nbsp;&ndash;&nbsp;"}}),React.DOM.span({},t(n)))}}))}t.CheckboxCell=r,t.FavoriteCell=n,t.ActionsCell=i,t.SiteRoleCell=o,t.UserDisplayNameCell=s,t.Link=a,t.FixedValue=c,t.PlainTextCell=l,t.PlainTextCellWithTransform=u,t.DateTimeCell=d,t.SizeCell=p,t.Checkmark=h,t.AngularActionsCell=f,t.LocalizedCount=m,t.LocalizedCountWithBar=v,t.AlertCell=S,t.ScheduleDescriptionCell=g}(t=e.DataGridCells||(e.DataGridCells={}))}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t;!function(t){function r(t,r){return _.extend({},t,{cellFormatter:e.DataGridCells.ActionsCell(t.cellFormatter,r),cellStyle:_.extend({},t.cellStyle,{paddingRight:0,overflow:"visible"})})}function n(t){return{name:"selected-col",dataKey:"selected",text:"",cellFormatter:e.DataGridCells.CheckboxCell({onCheckboxClicked:function(e){return o(t,e)}}),resizable:!1,sortable:!1,cellStyle:{padding:0}}}function i(t){return{name:"favorite-col",dataKey:"favorite",text:"",cellFormatter:e.DataGridCells.FavoriteCell({onAddFavorite:function(e){return s(t,e)},onRemoveFavorite:function(e){return a(t,e)}}),resizable:!1,sortable:!1,cellStyle:{padding:0}}}function o(e,t){e.$apply(function(){e.selectedItems.toggle(t.data)})}function s(e,t){e.$apply(function(){e.addFavorite(t.data),t.data.favorite=!0,e.dataGridProps.update++})}function a(e,t){e.$apply(function(){e.removeFavorite(t.data),t.data.favorite=!1,e.dataGridProps.update++})}function c(t,r,n){return{name:"owner-name-col",dataKey:"ownerName",text:t("column_owner"),direction:"asc",cellFormatter:e.DataGridCells.Link(function(e){var t=n?n(e):e.data.owner;return{text:t.displayName,url:r.userContentUrl(t)}})}}function l(t,r,n){return{name:"has-alert-col",dataKey:"hasAlert",text:"",tooltip:r("column_has_alert"),resizable:!1,cellFormatter:e.DataGridCells.AlertCell(t,r,n),headerStyle:{backgroundImage:"url(img/alert_list_header_normal.png)",backgroundRepeat:"no-repeat",backgroundPosition:"center",width:19},cellStyle:{overflow:"visible"}}}t.withActions=r,t.selected=n,t.favorite=i,t.owner=c,t.alert=l}(t=e.CommonDataGridColumns||(e.CommonDataGridColumns={}))}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(e){function t(){e.apply(this,arguments),this.state={measuredHeaderWidths:null,measuredColumnWidths:null,colWidths:null,scrollLeft:0,rows:null,isShowingLoadingIndicator:!0}}return __extends(t,e),t.prototype.componentDidMount=function(){var e=React.findDOMNode(this).getBoundingClientRect();this.gridWidth=Math.ceil(e.right-e.left),this.fetchInitialData(this.props)},t.prototype.componentWillReceiveProps=function(e){this.fetchInitialData(e)},t.prototype.fetchInitialData=function(e){this.setState({isShowingLoadingIndicator:!0}),this.fetchUsingProps(e,0,0)},t.prototype.fetch=function(e,t){this.fetchUsingProps(this.props,e,t)},t.prototype.fetchUsingProps=function(e,t,r){var n=this;e.rowStore&&e.rowStore.getItems(t,r).then(function(e){n.setState({rows:e,isShowingLoadingIndicator:!1},function(){n.props.updated&&n.props.updated(e)})})},t.prototype.onColumnResize=function(e,t){var r={};r[e.name]=t,this.setState({colWidths:React.addons.update(this.state.colWidths||{},{$merge:r})})},t.prototype.handleClick=function(e,t){this.props.onCellClick&&this.props.onCellClick(e.data,t.dataKey)},t.prototype.handleMeasureHeaderWidths=function(e){var t=this;this.setState({measuredHeaderWidths:e},function(){return t.maybeUpdateColumnWidths()})},t.prototype.handleMeasureColumnWidths=function(e){var t=this;this.setState({measuredColumnWidths:e},function(){return t.maybeUpdateColumnWidths()})},t.prototype.maybeUpdateColumnWidths=function(){var e=this;if(this.state.measuredColumnWidths&&this.state.measuredHeaderWidths){var r={},n={},i=0;_.each(this.props.cols,function(o){var s,a=o.name;s=o.preferredWidth?o.preferredWidth:Math.max(e.state.measuredColumnWidths[a],e.state.measuredHeaderWidths[a]),r[a]=s,n[a]=Math.min(s,t.MaxInitialColumnWidth),i+=n[a]});for(var o=this.gridWidth-t.ScrollbarWidth-i,s=0,a=0;a<this.props.cols.length&&o>0;a++){var c=this.props.cols[a],l=r[c.name]-n[c.name];if(l>0){var u=Math.min(l,o);n[c.name]+=u,o-=u}c.growToFit&&(s+=1)}if(o>0&&s>0){var d=o/s;_.each(this.props.cols,function(e){e.growToFit&&(n[e.name]+=d)})}this.setState({colWidths:n})}},t.prototype.render=function(){var e=this.props.cols,r=this.state.rows,n=this.state.colWidths,i=this.state.scrollLeft,o=[];return _.isArray(r)&&(o.push(t.HeaderRow.element({key:"header",cols:e,colWidths:n||this.getProvisionalColumnWidths(),sortKey:this.props.sortKey,sortAscending:this.props.sortAscending!==!1,onHeaderClicked:this.props.onHeaderClicked?this.props.onHeaderClicked.bind(this):null,measureColumnWidths:!n&&this.handleMeasureHeaderWidths.bind(this),scrollLeft:i,onColumnResize:this.onColumnResize.bind(this)})),r.length>0?o.push(t.Body.element({key:"body",cols:e,colWidths:n,measureColumnWidths:!n&&this.handleMeasureColumnWidths.bind(this),reportScrollLeftFn:this.bodyScrollLeft.bind(this),rows:r,selectedKeys:this.props.selectedKeys||{},onClick:this.handleClick.bind(this),fetch:this.fetch.bind(this)})):o.push(t.EmptyBody.element({key:"emptyBody",emptyChild:this.props.emptyChild}))),VizPortal.FeatureFlags.reactDataGridLoadingIndicator&&this.state.isShowingLoadingIndicator&&(o.push(React.DOM.div({className:"tb-backdrop-white"})),o.push(React.DOM.span({className:"tb-loading-indicator"}))),React.DOM.div({className:"tb-react-data-grid",tabIndex:0,style:{outline:"none"}},o)},t.prototype.getProvisionalColumnWidths=function(){var e=this;if(!this.state.measuredHeaderWidths)return null;var r=0,n=0;_.each(this.props.cols,function(t){r+=t.preferredWidth?t.preferredWidth:e.state.measuredHeaderWidths[t.name],t.resizable!==!1&&n++});var i=this.gridWidth-t.ScrollbarWidth-r,o={};if(i>0){var s=i/n;_.each(this.props.cols,function(t){if(t.resizable!==!1){var r;r=t.preferredWidth?t.preferredWidth:e.state.measuredHeaderWidths[t.name],o[t.name]=r+s}})}return o},t.prototype.bodyScrollLeft=function(e){e!==this.state.scrollLeft&&this.setState({scrollLeft:e})},t.displayName="DataGrid",t.element=React.createFactory(t),t.MaxInitialColumnWidth=200,t.ScrollbarWidth=20,t.MinimumColumnWidth=35,t}(React.Component);e.DataGrid=t;var t;!function(e){function t(e){var t=React.findDOMNode(e),r=t.getBoundingClientRect();return Math.ceil(r.right-r.left)}var r=function(e){function r(){e.apply(this,arguments)}return __extends(r,e),r.prototype.componentDidMount=function(){if(this.props.reportWidthFn){var e=t(this);this.props.reportWidthFn(this.props.col.name,e)}},r.prototype.shouldComponentUpdate=function(e,t){return React.addons.PureRenderMixin.shouldComponentUpdate.call(this,e,t)},r.prototype.render=function(){var e=this,t=this.props.col.cellFormatter?this.props.col.cellFormatter(this.props):this.props.value,r={className:"tb-react-dg-bcell",style:{display:"inline-block",boxSizing:"border-box",width:this.props.width},onClick:function(t){t.defaultPrevented||e.props.onClick&&e.props.onClick(e.props.row,e.props.col)}};return this.props.col.cellStyle&&_.extend(r.style,this.props.col.cellStyle),React.DOM.div(r,t)},r.displayName="DataGridBodyCell",r.element=React.createFactory(r),r}(React.Component),n=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.shouldComponentUpdate=function(e,t){return React.addons.PureRenderMixin.shouldComponentUpdate.call(this,e,t)},t.prototype.render=function(){var e=this,n=this.props.row,i=this.props.colWidths,o=null;this.props.isSelected?o=t.SelectedColor:this.props.isHovered&&(o=t.HoverColor);var s=n?this.props.cols.map(function(t,o){return r.element({key:o,col:t,row:n,value:n.data[t.dataKey],width:i&&i[t.name],reportWidthFn:!t.preferredWidth&&e.props.handleReportCellWidth,isSelected:e.props.isSelected,onClick:e.props.onClick.bind(e)})}):null,a={className:"tb-react-dg-brow",style:{height:t.InnerHeight,borderBottom:"1px solid #e6e6e6",backgroundColor:o,whiteSpace:"nowrap"},onMouseEnter:function(){return e.props.handleMouseEnter(n)},onMouseLeave:function(){return e.props.handleMouseLeave()}};return n&&n.rowStyle&&_.extend(a.style,n.rowStyle),React.DOM.div(a,s)},t.displayName="DataGridBodyRow",t.element=React.createFactory(t),t.InnerHeight=VizPortal.FeatureFlags.useTallerRowHeight?37:27,t.OuterHeight=t.InnerHeight+1,t.SelectedColor="#d4e1ed",t.HoverColor="#f5f5f5",t}(React.Component);e.BodyRow=n;var i=function(e){function t(){e.apply(this,arguments),this.state={hoverRow:null}}return __extends(t,e),t.prototype.handleMouseEnter=function(e){this.setState({hoverRow:e})},t.prototype.handleMouseLeave=function(){this.setState({hoverRow:null})},t.prototype.handleReportCellWidth=function(e,t){this.measuredWidths[e]=Math.max(t,this.measuredWidths[e]||0)},t.prototype.componentWillMount=function(){this.measuredWidths={}},t.prototype.componentDidMount=function(){this.props.measureColumnWidths&&this.props.measureColumnWidths(this.measuredWidths)},t.prototype.shouldComponentUpdate=function(e,t){return React.addons.PureRenderMixin.shouldComponentUpdate.call(this,e,t)},t.prototype.render=function(){for(var e=this.props.cols,t=this.props.colWidths,r=this.props.rows,i=this.props.onClick,o=this.handleMouseEnter.bind(this),s=this.handleMouseLeave.bind(this),a=this.props.measureColumnWidths?this.handleReportCellWidth.bind(this):null,c=[],l=0;l<r.length;l++){var u=r[l];c.push(n.element({key:l,row:u,cols:e,colWidths:t,onClick:i,isSelected:u&&_.has(this.props.selectedKeys,u.key),isHovered:u&&this.state.hoverRow===u,handleMouseEnter:o,handleMouseLeave:s,handleReportCellWidth:a}))}return React.DOM.div({className:"tb-react-dg-bsection",style:{height:r.length*n.OuterHeight}},React.DOM.div({style:{position:"absolute",minWidth:"100%"}},c))},t.displayName="DataGridBodySection",t.element=React.createFactory(t),t}(React.Component),o=function(e){function t(){e.apply(this,arguments),this.state={indexOfFirstVisibleSection:0,indexOfLastVisibleSection:0}}return __extends(t,e),t.prototype.render=function(){var e=this,r=this.props.rows;if(!r||0===r.length)return React.DOM.div({className:"tb-react-dg-body"});var i=this.renderSections(),o=this.state.indexOfFirstVisibleSection*t.SectionHeight,s=React.DOM.div({style:{paddingTop:o,height:r.length*n.OuterHeight-o}},i);return React.DOM.div({className:"tb-react-dg-body",onScroll:function(){return e.onScroll()}},s)},t.prototype.renderSections=function(){for(var e=[],r=this.state.indexOfFirstVisibleSection;r<=this.state.indexOfLastVisibleSection;r++){var n=this.props.rows.slice(r*t.SectionRows,Math.min((r+1)*t.SectionRows,this.props.rows.length));e.push(i.element({key:r,cols:this.props.cols,colWidths:this.props.colWidths,measureColumnWidths:r===this.state.indexOfFirstVisibleSection?this.props.measureColumnWidths:null,rows:n,onClick:this.props.onClick,selectedKeys:this.props.selectedKeys}))}return e},t.prototype.componentDidMount=function(){var e=this;if(!window.addEventListener&&window.attachEvent){var t=React.findDOMNode(this);t.attachEvent("onscroll",function(){e.onScroll()})}this.updateSections()},t.prototype.componentWillUnmount=function(){if(!window.addEventListener&&window.attachEvent){var e=React.findDOMNode(this);e.detachEvent("onscroll")}},t.prototype.onScroll=function(){this.updateSections();var e=this.props.reportScrollLeftFn;e&&e(React.findDOMNode(this).scrollLeft)},t.prototype.updateSections=function(){var e=this,r=$(React.findDOMNode(this)),n=r.scrollTop(),i=n+r.height(),o=Math.floor(n/t.SectionHeight),s=Math.ceil(i/t.SectionHeight);(o!==this.state.indexOfFirstVisibleSection||s!==this.state.indexOfLastVisibleSection)&&this.setState({indexOfFirstVisibleSection:o,indexOfLastVisibleSection:s},function(){return e.fetch()})},t.prototype.fetch=function(){this.props.fetch&&this.props.fetch(this.state.indexOfFirstVisibleSection*t.SectionRows,(this.state.indexOfLastVisibleSection+1)*t.SectionRows-1)},t.displayName="DataGridBody",t.element=React.createFactory(t),t.SectionRows=10,t.SectionHeight=t.SectionRows*n.OuterHeight,t}(React.Component);e.Body=o;var s=function(r){function n(e){var t=this;r.call(this,e),this.state={hovered:!1},this.boundMouseEnter=function(){return t.setState({hovered:!0})},this.boundMouseLeave=function(){return t.setState({hovered:!1})}}return __extends(n,r),n.prototype.startResize=function(t){var r=this,n=t.clientX,i=React.findDOMNode(this),o=i.getBoundingClientRect(),s=o.right-o.left;$(document).on("mousemove.mousecapture",function(t){var i=t.clientX-n;r.props.onColumnResize(r.props.col,Math.max(s+i,e.MinimumColumnWidth)),t.preventDefault()}),$(document).on("mouseup.mousecapture",function(e){$(document).off(".mousecapture"),e.preventDefault()}),t.preventDefault()},n.prototype.shouldComponentUpdate=function(e,t){return React.addons.PureRenderMixin.shouldComponentUpdate.call(this,e,t)},n.prototype.render=function(){var e=this,t=this.props.col,r=t.sortable!==!1,n=t.resizable!==!1,i=["tb-react-dg-hcell"];r&&i.push("tb-react-dg-hcell-sortable"),this.props.sorted&&i.push(this.props.sortAscending?"tb-react-dg-hcell-sort-asc":"tb-react-dg-hcell-sort-desc"),n&&i.push("tb-react-dg-hcell-resizable");var o={className:i.join(" "),onMouseEnter:this.boundMouseEnter,onMouseLeave:this.boundMouseLeave};r&&this.props.onHeaderClicked&&(o.onClick=function(){return e.props.onHeaderClicked(t.dataKey,t.direction)}),t.headerStyle&&(o.style=t.headerStyle),t.tooltip&&(o.title=t.tooltip);var s=this.props.col.headerFormatter?t.headerFormatter(_.extend({},this.props,this.state)):React.DOM.span({className:"tb-react-dg-hcell-text"},t.text);return React.DOM.span({className:"tb-react-dg-hcol",style:{width:this.props.width}},React.DOM.div(o,s),t.resizable===!1?null:React.DOM.div({className:"tb-react-dg-hdivider tb-disable-selection",onMouseDown:this.startResize.bind(this)}))},n.prototype.componentDidMount=function(){if(this.props.reportWidthFn){var e=t(this);this.props.reportWidthFn(this.props.col.name,e)}},n.displayName="DataGridHeaderColumn",n.element=React.createFactory(n),n}(React.Component),a=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.componentWillMount=function(){this.measuredWidths={}},t.prototype.componentDidMount=function(){this.props.measureColumnWidths&&this.props.measureColumnWidths(this.measuredWidths)},t.prototype.handleReportHeaderWidth=function(e,t){this.measuredWidths[e]=Math.max(t,this.measuredWidths[e]||0)},t.prototype.shouldComponentUpdate=function(e,t){return React.addons.PureRenderMixin.shouldComponentUpdate.call(this,e,t)},t.prototype.render=function(){var e=this,t=this.props.cols,r=this.props.colWidths,n=this.handleReportHeaderWidth.bind(this),i=this.props.scrollLeft,o=this.props.onColumnResize,a=t.map(function(t){return s.element({key:t.name,col:t,sorted:e.props.sortKey===t.dataKey,sortAscending:e.props.sortAscending,reportWidthFn:!t.preferredWidth&&n,width:r&&r[t.name],onColumnResize:o,onHeaderClicked:e.props.onHeaderClicked})});return React.DOM.div({className:"tb-react-dg-hrow"},React.DOM.span({className:"tb-react-dg-hcols",style:{marginLeft:-i}},a))},t.displayName="DataGridHeaderRow",t.element=React.createFactory(t),t}(React.Component);e.HeaderRow=a;var c=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.shouldComponentUpdate=function(e,t){return React.addons.PureRenderMixin.shouldComponentUpdate.call(this,e,t)},t.prototype.render=function(){return React.DOM.div({className:"tb-react-dg-body"},this.props.emptyChild)},t.displayName="EmptyBody",t.element=React.createFactory(t),t}(React.Component);e.EmptyBody=c}(t=e.DataGrid||(e.DataGrid={}))}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t;!function(t){function r(t,r,i,o,a,c,l,u,d){var p=[];return c&&p.push(e.CommonDataGridColumns.selected(r)),p=p.concat([n(c,t,i,o,a,u),{name:"connection-type-col",dataKey:"connectionTypeDisplayName",text:t("column_connection_type"),direction:"asc"},{name:"connects-to-col",dataKey:"connectsTo",text:t("column_connects_to"),sortable:!1,cellFormatter:s(i)},{name:"last-refreshed-at-col",dataKey:"lastRefreshedAt",text:t("column_last_refresh"),cellFormatter:e.DataGridCells.DateTimeCell("lastRefreshedAt",t("live")),direction:"desc"}]),l||u||p.push({name:"project-name-col",dataKey:"projectName",text:t("column_project"),direction:"asc",cellFormatter:e.DataGridCells.Link(function(e){return{text:e.data.project?e.data.project.name:"",url:e.data.project?i.projectUrl(e.data.project.id):""}})}),u||(p.push(e.CommonDataGridColumns.owner(t,i)),p.push({name:"updated-at-col",dataKey:"updatedAt",text:t("column_updated"),direction:"desc",cellFormatter:e.DataGridCells.DateTimeCell("updatedAt")})),p.push(e.CommonDataGridColumns.alert("datasource",t,d)),p}function n(t,r,n,s,a,c){var l={name:"name-col",dataKey:"name",text:r("column_name"),direction:"asc",cellFormatter:React.createFactory(React.createClass({render:function(){var e=this.props,t=e.row.data,r=!!t.workbook;return r?i(t,c,n):o(t,n)}}))};return t&&(l=e.CommonDataGridColumns.withActions(l,{actions:s,getActionTarget:a,translate:r})),l}function i(e,t,r){var n=e.name,i=[React.DOM.span({key:"icon",className:"tb-icon-datasource-embedded"}),React.DOM.span({key:"name"},e.name)];return t||(n+=" - "+e.workbook.name,i.push(React.DOM.span({key:"dash"}," - ")),i.push(React.DOM.a({key:"workbookLink",href:r.workbookDatasourcesUrl(e.workbook.id),title:e.workbook.name},e.workbook.name))),React.DOM.span({title:n},i)}function o(e,t){return React.DOM.span({title:e.name},React.DOM.span({className:"tb-icon-datasource-published"}),React.DOM.a({href:t.datasourceUrl(e.id),title:e.name},e.name))}function s(e){return React.createFactory(React.createClass({render:function(){var t=this.props,r=t.row.data;switch(r.connectionDetails.type){case VizPortal.ServerApi.ConnectionDetailType.TableauServer:return React.DOM.a({href:e.datasourceUrl(r.connectionDetails.id)},React.DOM.span({className:"tb-icon-datasource-connection-tableau"}),React.DOM.span({title:r.connectionDetails.name},r.connectionDetails.name));case VizPortal.ServerApi.ConnectionDetailType.File:return React.DOM.span({},React.DOM.span({className:"tb-icon-datasource-connection-file"}),React.DOM.span({title:r.connectionDetails.fileName},r.connectionDetails.fileName));default:return React.DOM.span({},React.DOM.span({className:"tb-icon-datasource-connection-external"}),React.DOM.span({title:r.connectionDetails.serverName},r.connectionDetails.serverName))}}}))}t.columns=r}(t=e.DatasourceGrid||(e.DatasourceGrid={}))}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t;!function(t){function r(t,r,i,o,s,a){var c=[];return a&&c.push(e.CommonDataGridColumns.selected(s)),c=c.concat([n(t,r,a,i,o),{name:"workbook-count-col",dataKey:"workbookCount",text:t("column_numWorkbooks"),cellFormatter:e.DataGridCells.LocalizedCount("workbookCount"),direction:"asc",headerStyle:{textAlign:"right"},cellStyle:{textAlign:"right"}},{name:"view-count-col",dataKey:"viewCount",text:t("column_numViews"),cellFormatter:e.DataGridCells.LocalizedCount("viewCount"),direction:"asc",headerStyle:{textAlign:"right"},cellStyle:{textAlign:"right"}},{name:"datasource-count-col",dataKey:"datasourceCount",text:t("column_numDatasources"),cellFormatter:e.DataGridCells.LocalizedCount("datasourceCount"),direction:"asc",headerStyle:{textAlign:"right"},cellStyle:{textAlign:"right"}},e.CommonDataGridColumns.owner(t,r),{name:"created-at-col",dataKey:"createdAt",text:t("column_created"),direction:"desc",cellFormatter:e.DataGridCells.DateTimeCell("createdAt")}])}function n(t,r,n,i,o){var s={name:"name-col",dataKey:"name",text:t("column_name"),direction:"asc",cellFormatter:e.DataGridCells.Link(function(e){return{text:e.data.name,url:r.projectUrl(e.data.id),iconClassName:"tb-grid-icon-project",iconTitle:t("project")}})};return n&&(s=e.CommonDataGridColumns.withActions(s,{actions:i,getActionTarget:o,translate:t})),s}t.columns=r}(t=e.ProjectGrid||(e.ProjectGrid={}))}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t;!function(t){function r(t,r,a,c,l,u,d){var p=[e.CommonDataGridColumns.selected(r),n(t,u,c,l),{name:"user-count-col",dataKey:"userCount",text:t("column_userCount"),cellFormatter:e.DataGridCells.LocalizedCount("userCount"),direction:"asc",headerStyle:{textAlign:"right"},cellStyle:{textAlign:"right"}},{name:"admin-count-col",dataKey:"adminCount",text:t("column_adminCount"),cellFormatter:e.DataGridCells.LocalizedCount("adminCount"),direction:"asc",headerStyle:{textAlign:"right"},cellStyle:{textAlign:"right"}},{name:"user-quota-col",dataKey:"userQuota",text:t("column_maxUsers"),cellFormatter:i(t),direction:"asc",headerStyle:{textAlign:"right"},cellStyle:{textAlign:"right"}},{name:"storage-used-col",dataKey:"storageUsedBytes",text:t("column_storageUsed"),cellFormatter:o(a),direction:"asc",headerStyle:{textAlign:"right"},cellStyle:{textAlign:"right"}},{name:"storage-quota-col",dataKey:"storageQuotaBytes",text:t("column_storageQuota"),cellFormatter:s(t,a),direction:"asc",headerStyle:{textAlign:"right"},cellStyle:{textAlign:"right"}},{name:"status-col",dataKey:"availability",text:t("column_status"),cellFormatter:e.DataGridCells.PlainTextCellWithTransform("availability",t),direction:"asc"},{name:"metrics-col",dataKey:"metricsEnabled",text:t("column_metrics"),cellFormatter:e.DataGridCells.Checkmark("settings.metricsEnabled"),direction:"desc"},{name:"web-authoring-col",dataKey:"authoringEnabled",text:t("column_webAuthoring"),cellFormatter:e.DataGridCells.Checkmark("settings.authoringEnabled"),direction:"desc"},{name:"sheet-image-col",dataKey:"sheetImageEnabled",text:t("column_sheetImage"),cellFormatter:e.DataGridCells.Checkmark("settings.sheetImageEnabled"),direction:"desc"}];return d&&p.push({name:"live-connections-whitelist-enabled-col",dataKey:"liveDBConnectionsWhitelistEnabled",text:t("column_liveDBConnectionsWhitelistEnabled"),cellFormatter:e.DataGridCells.Checkmark("siteAdminSettings.liveDBConnectionsWhitelistEnabled"),direction:"desc"}),p.push({name:"edit-membership-col",dataKey:"siteAdminsCanAddUsers",text:t("column_editMembership"),cellFormatter:e.DataGridCells.Checkmark("settings.siteAdminsCanAddUsers"),direction:"desc"}),p.push({name:"created-at-col",dataKey:"createdAt",text:t("column_created"),direction:"desc",cellFormatter:e.DataGridCells.DateTimeCell("createdAt")}),p}function n(t,r,n,i){var o=t("site");return e.CommonDataGridColumns.withActions({name:"name-col",dataKey:"name",text:t("column_name"),direction:"asc",cellFormatter:e.DataGridCells.Link(function(e){var t=e.data;return{text:t.settings.name,url:r.forSiteUrlName(t.settings.urlName).projectsUrl(),iconClassName:"tb-grid-icon-site",iconTitle:o}})},{actions:n,getActionTarget:i,translate:t})}function i(e){var t=React.DOM.span({},e("serverLimit"));return React.createFactory(React.createClass({render:function(){var e=this.props.row.data;return e.settings.userQuotaEnabled?React.DOM.span({},VizPortal.L10n.localizedCount(e.settings.userQuota)):t}}))}function o(e){return React.createFactory(React.createClass({render:function(){var t=this.props.row.data;return React.DOM.span({},t.settings.storageQuotaEnabled?React.DOM.span({},"("+VizPortal.L10n.localizedPercent(t.storageQuotaPercentUsed)+") "):null,React.DOM.span({},e(t.storageUsedBytes)))}}))}function s(e,t){var r=React.DOM.span({},e("serverLimit"));return React.createFactory(React.createClass({render:function(){var e=this.props.row.data;return e.settings.storageQuotaEnabled?React.DOM.span({},t(e.settings.storageQuotaBytes)):r}}))}t.columns=r}(t=e.SiteGrid||(e.SiteGrid={}))}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t;!function(t){function r(t,r,i,o,s,a,c,l){var u=[];return a&&u.push(_.extend({},e.CommonDataGridColumns.selected(r),{headerStyle:{borderRight:"none"}})),u.push(e.CommonDataGridColumns.favorite(r)),u.push(n(t,i,a,o,s)),l||u.push({name:"workbook-name-col",dataKey:"workbookName",text:t("column_workbook"),direction:"asc",cellFormatter:e.DataGridCells.Link(function(e){return{text:e.data.workbook.name,url:i.workbookViewsUrl(e.data.workbook.id)}})}),u.push({name:"index-col",dataKey:"index",text:t("column_sheetNumber"),cellFormatter:e.DataGridCells.LocalizedCount("index"),direction:"asc",headerStyle:{textAlign:"right"},cellStyle:{textAlign:"right"}}),l||c||u.push({name:"project-name-col",dataKey:"projectName",text:t("column_project"),direction:"asc",cellFormatter:e.DataGridCells.Link(function(e){return{text:e.data.workbook.project.name,url:i.projectViewsUrl(e.data.workbook.project.id)}})}),l||(u.push(e.CommonDataGridColumns.owner(t,i,function(e){return e.data.workbook.owner})),u.push({name:"updated-at-col",dataKey:"updatedAt",text:t("column_updated"),direction:"desc",cellFormatter:e.DataGridCells.DateTimeCell("updatedAt")})),u}function n(t,r,n,i,o){var s={name:"name-col",dataKey:"name",text:t("column_name"),direction:"asc",cellFormatter:e.DataGridCells.Link(function(e){return{text:e.data.name,url:r.viewUrl(e.data.path),iconClassName:"tb-grid-icon-view",iconTitle:t("view")}})};return n&&(s=e.CommonDataGridColumns.withActions(s,{actions:i,getActionTarget:o,translate:t})),s}t.columns=r}(t=e.ViewGrid||(e.ViewGrid={}))}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){function t(e,t,i,o,s){return _.extend(e,r(i,t)),e.text=t[e.dataKey],e.headerFormatter=n(t,o),e.cellFormatter=s?s[e.dataKey]:null,e}function r(e,t){for(var r=e.getOrderClauses(),n=0;n<r.length;n++){var i=r[n];if(t[i.field])return{dataKey:i.field,direction:i.ascending?"asc":"desc",text:t[i.field]}}return void 0}function n(t,r){return React.createFactory(React.createClass({displayName:"SelectableSortKeyColumnHeaderFormatter",getInitialState:function(){return{menuHovered:!1}},render:function(){var n=this,i=(e.CommonStyles.Sizes.DataGridHeaderHeight-e.CommonStyles.Sizes.NormalIconSize)/2,o=e.Menu.element({ref:"menu",style:{lineHeight:"normal",fontFamily:e.CommonStyles.Fonts.BodyFont,fontSize:e.CommonStyles.Sizes.NormalFontSize,position:"absolute",top:i,right:e.CommonStyles.Sizes.DefaultSpace},menuButtonFactory:function(e){return React.DOM.span({className:"tb-drop-down-icon"})},menuPanelFactory:function(e){var i=n.props,o=i.col.dataKey,s=_.map(t,function(e,t){var i=t===o,s=[React.DOM.span({className:"tb-padded-right",style:{visibility:i?"visible":"hidden"}},"â€¢"),React.DOM.span({},e)];return React.DOM.div({className:"tb-popup-menu-item","data-tb-test-id":t,onClick:function(){n.selectKey(t,r),n.refs.menu.closeMenu()}},s)});return React.DOM.div({className:"tb-popup-menu-content tb-padded-small"},s)},menuPanelStyle:{top:i+e.CommonStyles.Sizes.NormalIconSize+e.CommonStyles.Sizes.DropdownOffset,right:-e.CommonStyles.Sizes.DefaultSpace,left:"auto"}});return React.DOM.div({style:{textDecoration:this.props.hovered&&!this.state.menuHovered?"underline":"none"}},React.DOM.div({style:{marginRight:e.CommonStyles.Sizes.NormalIconSize-e.CommonStyles.Sizes.DefaultSpace,overflow:"hidden",textOverflow:"ellipsis"}},this.props.col.text),React.DOM.div({onClick:function(e){return e.stopPropagation()},onMouseOver:function(){return n.setState({menuHovered:!0})},onMouseOut:function(){return n.setState({menuHovered:!1})}},o))},selectKey:function(e,t){var r=this.props;r.col.dataKey!==e&&(t.removeFieldFromOrder(r.col.dataKey),t.setPrimaryOrder(e,r.col.direction))}}))}e.SelectableSortKeyDataGridColumn=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t;!function(t){function r(t,r,i,o,s,a,c,l,u,d,p){var h=[];if(l&&h.push(_.extend({},e.CommonDataGridColumns.selected(i),{headerStyle:{borderRight:"none"}})),h.push(e.CommonDataGridColumns.favorite(i)),h.push(n(t,s,l,a,c)),VizPortal.FeatureFlags.contentAnalyticsEnabled){var f=["hitsTotal","hitsLastMonthTotal","hitsLastTwoWeeksTotal","hitsLastDayTotal"],m=_.reduce(f,function(e,r){return e[r]=t("metric_"+r),e},{}),v="hitsTotal",S=m[v];h.push(e.SelectableSortKeyDataGridColumn({name:"hits-col",dataKey:v,text:S,direction:"desc",headerStyle:{textAlign:"left"},cellStyle:{textAlign:"left"},preferredWidth:200},m,d,p,{hitsTotal:e.DataGridCells.LocalizedCountWithBar("hitsTotal",function(e){return e.maxStatValues},"metrics-column-bars"),hitsLastTwoWeeksTotal:e.DataGridCells.LocalizedCountWithBar("hitsLastTwoWeeksTotal",function(e){return e.maxStatValues},"metrics-column-bars")})),h.push({name:"favorites-col",dataKey:"favoritesTotal",text:t("metric_favoritesTotal"),cellFormatter:e.DataGridCells.LocalizedCountWithBar("favoritesTotal",function(e){return e.maxStatValues},"favorites-column-bars"),direction:"desc",headerStyle:{textAlign:"left"},cellStyle:{textAlign:"left"},preferredWidth:200})}return h.push({name:"num-sheets-col",dataKey:"numSheets",text:t("column_numSheets"),cellFormatter:e.DataGridCells.LocalizedCount("numSheets"),direction:"asc",headerStyle:{textAlign:"right"},cellStyle:{textAlign:"right"}}),h.push({name:"size-col",dataKey:"size",text:t("column_size"),cellFormatter:e.DataGridCells.SizeCell("size",r),direction:"asc",headerStyle:{textAlign:"right"},cellStyle:{textAlign:"right"}}),u&&h.push({name:"project-name-col",dataKey:"projectName",text:t("column_project"),direction:"asc",cellFormatter:e.DataGridCells.Link(function(e){return{text:e.data.project.name,url:s.projectUrl(e.data.project.id)}})}),h=h.concat([e.CommonDataGridColumns.owner(t,s),{name:"updated-at-col",dataKey:"updatedAt",text:t("column_updated"),direction:"desc",cellFormatter:e.DataGridCells.DateTimeCell("updatedAt")},e.CommonDataGridColumns.alert("workbook",t,o)])}function n(t,r,n,i,o){var s={name:"name-col",dataKey:"name",text:t("column_name"),direction:"asc",cellFormatter:e.DataGridCells.Link(function(e){return{text:e.data.name,url:r.workbookUrl(e.data.id),iconClassName:"tb-grid-icon-workbook",iconTitle:t("workbook")}})};return n&&(s=e.CommonDataGridColumns.withActions(s,{actions:i,getActionTarget:o,translate:t})),s}t.columns=r}(t=e.WorkbookGrid||(e.WorkbookGrid={}))}(VizPortalReact||(VizPortalReact={}));var VizPortal;!function(e){var t=function(){
function t(t,r,n,i,o,s,a,c,l,u,d,p,h,f,m,v,S,g,y,A,P,C,b,R){var w=this;this.$scope=t,this.$translate=r,this.AngularToReactDataGridBridge=i,this.sizeFilter=o,this.actionPanelService=d,this.ServerService=p,this.HelpService=v,this.AngularContextFactory=S,this.subplace=g,this.projectUrl=P,t.sorter=h.create(b);var T=this.isReactDataGridEnabled(g.type);t.useReactDataGrid=T,T&&this.configureForReactDataGrid(g.type,t.place,t.sorter),t.busy=!1,s.setTitle(g.name,t.objectName),t.isTouch=m.isTouch(),t.selectedItems=new e.Set(function(e){return e.id}),t.contentType=g.type.name;var k=g.filterKeys();t.filterControls={},t.filterDefinitions=u.getFilterDefinitions(k),t.filterFieldValues=function(e){return function(t){return g.filterValuesQuery(e).withMatchText(t)}},t.getFieldValueQuery=function(e){return g.filterValuesQuery(e).withMatchText("")},t.availableAction=function(e){return e.isAvailable(t.selectedItems,t.detailedItem,t.allowedActions)},e.ActionButtonsHelper.setupActionButtons(t,d.getContentActionButtons(t.contentType,t.place)),t.listActions=[{name:"create-project",translate:"createProject",isAvailable:function(){return g.type.name===e.ProjectContentType.name&&p.isSessionSiteOrServerAdmin()},execute:function(r){a.createProject(e.ActionContext.fromEvent(r)).then(function(e){e.id&&t.refreshContent()})}},{name:"create-new-site",translate:"newSite",isAvailable:function(){return g.type.name===e.SitesContentType.name},execute:function(e){c.execute(t).then(function(){return n.hardReload()})}}],t.availableListAction=function(e){return e.isAvailable()},t.gridLayout=_.once(function(t,r){return new e.FlowLayout(t,r)}),t.getItemDetails=function(e){var t=y;return t.getById(e.id)};var E=function(e){var t=y;return t.actions?t.actions(e.id):null};t.detailedItem=null;var z;t.$watch(function(){return 1===t.selectedItems.size()?t.selectedItems.first().id:null},function(e){if(t.detailedItem=null,t.allowedActions=null,_.isString(e)){z=e;var r=t.selectedItems.first();R(r)&&t.getItemDetails(r).then(function(r){e===z&&(t.detailedItem=r,t.dataGridProps&&t.dataGridProps.update++)}),(E(r)||{then:angular.noop}).then(function(r){e===z&&(t.allowedActions=r)})}else z=null}),t.refreshContent=function(){w.refresh(),t.$emit(e.SubplaceEvents.RefreshCounts,g.name)},t.$on(e.SubplaceEvents.Refresh,function(){t.refreshContent()}),t.$on(e.SelectionEvent.SelectionStarted,function(){t.busy=!0}),t.$on(e.SelectionEvent.SelectionEnded,function(){t.busy=!1}),this.query=l.createQueryUpdaterFromSubplace(t,g,function(e){T&&w.AngularToReactDataGridBridge.updateReactDataGridRowStore({scope:t,sliceable:e}),t.sliceable=e,t.sorter.setOrder(e.getOrder())}),t.detailsUrl=A,t.projectUrl=P,t.workbookUrl=C,t.sliceChanged=function(r){t.isEmpty=0===r.total,t.selectedItems.updateItems(r.items),e.SubplaceCountsHelper.updateCountsFromSubplace(t,g,r.total)},t.anyActionsAllowed=function(){return w.anyActionsAllowed(g.type.name,t.place,t.ownerId)},t.showModeSwitcher=function(){switch(t.contentType){case e.ContentTypes.project:case e.ContentTypes.workbook:case e.ContentTypes.view:return!0;default:return!1}},t.shouldShowReadMore=function(e){var t=$(e.currentTarget).parent(),r=t.find(".tb-card-view-description").height()-16,n=t.find(".tb-card-view-description-text").height();return n>r},t.addFavorite=function(r){switch(t.contentType){case e.ContentTypes.workbook:return f.addWorkbook(r);case e.ContentTypes.view:return f.addView(r);default:return}},t.removeFavorite=function(r){switch(t.contentType){case e.ContentTypes.workbook:return f.removeWorkbook(r);case e.ContentTypes.view:return f.removeView(r);default:return}},t.isLiveDBAvailable=p.isLiveDBAvailable(),t.emptyTemplateModel=this.createEmptyTemplateModel(t.contentType,t.place),this.refresh()}return t.prototype.isReactDataGridEnabled=function(t){switch(t){case e.DatasourceContentType:return e.FeatureFlags.reactDatasourceGrid;case e.ProjectContentType:return e.FeatureFlags.reactProjectGrid;case e.SitesContentType:return e.FeatureFlags.reactSitesGrid;case e.WorkbookContentType:return e.FeatureFlags.reactWorkbookGrid;case e.ViewContentType:case e.ViewInWorkbookContentType:return e.FeatureFlags.reactViewGrid}return!1},t.prototype.configureForReactDataGrid=function(t,r,n){var i=this,o=n.getOrderStore(),s={setPrimaryOrder:function(e,t){return i.$scope.$apply(function(){return i.$scope.sorter.setPrimary(e,t)})},removeFieldFromOrder:function(e){return i.$scope.$apply(function(){return i.$scope.sorter.removeFieldFromOrder(e)})}},a=this.reactDataGridColumnsFor(t,r,o,s),c=this.createEmptyTemplateModel(t.name,r);this.AngularToReactDataGridBridge.attachReactDataGridToScope(this.$scope,a,c),this.$scope.dataGridProps.updated=function(t){i.$scope.isEmpty=0===t.length,i.$scope.selectedItems.updateItems(_.map(t,function(e){return e.data})),e.SubplaceCountsHelper.updateCountsFromSubplace(i.$scope,i.subplace,t.length)},this.$scope.$watch(function(){return i.$scope.sorter.selectedColumnKey()+";"+i.$scope.sorter.isSortAscending()},function(){i.$scope.dataGridProps.cols=i.reactDataGridColumnsFor(t,r,o,s),i.$scope.dataGridProps.update++})},t.prototype.reactDataGridColumnsFor=function(t,r,n,i){var o=this,s=new VizPortalReact.SiteUrls({siteUrlName:this.ServerService.sessionSiteUrlName(),queryString:window.location.search}),a=function(){return{items:o.$scope.selectedItems,detailedItem:o.$scope.detailedItem,actionContext:{scope:o.$scope},allowedActions:o.$scope.allowedActions}};switch(t){case e.ProjectContentType:return VizPortalReact.ProjectGrid.columns(function(e){return o.$translate.instant(e)},s,this.actionPanelService.getContentActionButtons(t.name,r),a,this.$scope,this.anyActionsAllowed(t.name,r,this.$scope.ownerId));case e.SitesContentType:return VizPortalReact.SiteGrid.columns(function(e){return o.$translate.instant(e)},this.$scope,this.sizeFilter,this.actionPanelService.getContentActionButtons(t.name,r),a,s,this.ServerService.isLiveDBAvailable());case e.WorkbookContentType:return VizPortalReact.WorkbookGrid.columns(function(e){return o.$translate.instant(e)},this.sizeFilter,this.$scope,this.AngularContextFactory.create(this.$scope),s,this.actionPanelService.getContentActionButtons(t.name,r),a,this.anyActionsAllowed(t.name,r,this.$scope.ownerId),"project"!==r,n,i);case e.ViewContentType:case e.ViewInWorkbookContentType:return VizPortalReact.ViewGrid.columns(function(e){return o.$translate.instant(e)},this.$scope,s,this.actionPanelService.getContentActionButtons(t.name,r),a,this.anyActionsAllowed(t.name,r,this.$scope.ownerId),"project"===r,"workbook"===r);case e.DatasourceContentType:return VizPortalReact.DatasourceGrid.columns(function(e){return o.$translate.instant(e)},this.$scope,s,this.actionPanelService.getContentActionButtons(t.name,r),a,this.anyActionsAllowed(t.name,r,this.$scope.ownerId),"project"===r,"workbook"===r,this.AngularContextFactory.create(this.$scope));default:throw"No react data grid for content type "+t.name}},t.prototype.anyActionsAllowed=function(t,r,n){switch(t){case e.ProjectContentType.name:return this.ServerService.isSessionSiteOrServerAdmin();case e.DatasourceContentType.name:if(r===e.WorkbookContentType.name)return this.ServerService.isSessionSiteOrServerAdmin()||n===this.ServerService.sessionUserId();default:return!0}},t.prototype.refresh=function(){this.query.refresh()},t.prototype.createEmptyTemplateModel=function(t,r){var n={};switch(t){case e.ContentTypes.view:n.title="viewsEmptyMessage";break;case e.ContentTypes.workbook:var i=r===e.DatasourceContentType.name;n.title=i?"workbooksForDataSourceEmptyMessage":"workbooksEmptyMessage";break;case e.ContentTypes.project:n.title="projectsEmptyMessage";break;case e.ContentTypes.datasource:var o=this.HelpService.getDatasourceHelpUrl();n.title="datasourcesEmptyMessage",o&&(n.help={links:[{localizedValueKey:"remoteRefreshSchedulesEmptyHelp",url:o}]});break;case e.SitesContentType.name:n.title="sitesEmptyMessage"}return n},t.$inject=["$scope","$translate","$state","AngularToReactDataGridBridge","sizeFilter","BrowserTitleService","ContentActions","CreateSiteAction","QueryService","FilterPanelService","ActionPanelService","ServerService","SorterFactory","Favorites","BrowserSupportService","HelpService","AngularContextFactory","subplace","resource","detailsUrl","projectUrl","workbookUrl","defaultOrder","shouldFetchDetails"],t}();e.ContentSubplaceCtrl=t,e.Module.instance().controller("ContentSubplaceCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n,i){var o=+n.errorCode;if(o)switch(o){case e.SolrErrorCode.SolrDisabled:case e.SolrErrorCode.SolrCommunicationError:t.redirectLocKey=null,t.redirectUrl=null,t.detailsLocKey="serverDown";break;default:t.redirectLocKey=null,t.redirectUrl=null,t.detailsLocKey=n.detailsLocKey||"pageDoesNotExist"}else{var s=n.redirectState||"main.site.content.site.projects",a=n.redirectSiteUrlName||i.sessionSiteUrlName();t.redirectLocKey=n.redirectLocKey||"backToContent",t.redirectUrl=r.href(s,{siteUrlName:a}),t.detailsLocKey=n.detailsLocKey||"pageDoesNotExist"}}return t.StateParamKeys={DetailsLocKey:"detailsLocKey",RedirectState:"redirectState",RedirectLocKey:"redirectLocKey",RedirectSiteUrlName:"redirectSiteUrlName"},t.$inject=["$scope","$state","$stateParams","ServerService"],t}();e.ErrorCtrl=t,e.Module.instance().controller("ErrorCtrl",t)}(VizPortal||(VizPortal={}));var VizPortalReact;!function(e){var t;!function(t){function r(t,r,i,o,s,a,c,l,u,d,p){var h=[e.CommonDataGridColumns.selected(r)];return u&&h.push({name:"workbook-datasource-col",dataKey:"targetName",direction:"asc",text:t("column_task_workbook_data_source"),cellFormatter:n(c,t)}),h.push({name:"task-type-col",dataKey:"type",direction:"asc",text:t("column_task_type"),cellFormatter:e.DataGridCells.PlainTextCellWithTransform("type",function(e){return t(e===VizPortal.ServerApi.ExtractTaskType.IncrementExtract?"extractTasksIncremental":"extractTasksFull")})}),d&&h.push({name:"schedule-name-col",dataKey:"scheduleName",direction:"asc",text:t("column_task_schedule"),cellFormatter:e.DataGridCells.ScheduleDescriptionCell(function(e){var t=e.data,r=t.schedule;return s?a.schedule(r.id,r.scheduledAction):c.schedule(r.id,r.scheduledAction)},l)}),h.push({name:"priority-col",dataKey:"priority",direction:"asc",text:t("column_task_priority"),cellFormatter:e.DataGridCells.LocalizedCount("priority"),headerStyle:{textAlign:"right"},cellStyle:{textAlign:"right"}}),p&&h.push({name:"site-name-col",dataKey:"siteName",direction:"asc",text:t("column_task_site"),cellFormatter:e.DataGridCells.PlainTextCellWithTransform("site",function(e){return e.name})}),h.push({name:"last-run-at-col",dataKey:"lastRunAt",text:t("column_task_last_update"),direction:"desc",cellFormatter:e.DataGridCells.DateTimeCell("lastRunAt",t("never"))}),h.push({name:"next-run-at-col",dataKey:"runNextAt",text:t("column_task_next_update"),direction:"asc",cellFormatter:e.DataGridCells.DateTimeCell("runNextAt",t("disabled"))}),i&&(h[1]=e.CommonDataGridColumns.withActions(h[1],{actions:o,getActionTarget:function(){return{items:r.selectedItems,actionContext:{scope:r}}},translate:t})),h}function n(t,r){return e.DataGridCells.Link(function(e){var n=e.data,i=t.forSiteUrlName(n.site.urlName);if(e.data.datasource){var o=e.data.datasource;return{text:o.name,url:i.datasourceUrl(o.id),iconClassName:"tb-grid-icon-datasource",iconTitle:r("datasource")}}var s=e.data.workbook;return{text:s.name,url:i.workbookUrl(s.id),iconClassName:"tb-grid-icon-workbook",iconTitle:r("workbook")}})}t.columns=r}(t=e.ExtractTasksGrid||(e.ExtractTasksGrid={}))}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t;!function(t){function r(t,r,n,i,o,s){var a=[];n&&a.push(e.CommonDataGridColumns.selected(r));var c={name:"refreshType-col",dataKey:"refreshType",text:t("column_remote_schedule_refresh_type"),direction:"asc",cellFormatter:e.DataGridCells.PlainTextCellWithTransform("refreshType",o)};return n&&(c=e.CommonDataGridColumns.withActions(c,{actions:i,getActionTarget:function(){return{items:r.selectedItems,actionContext:{scope:r}}},translate:t})),a=a.concat([c,{name:"definition-col",dataKey:"definition",text:t("column_remote_schedule_definition"),direction:"asc",cellFormatter:e.DataGridCells.PlainTextCellWithTransform("definition",s)},{name:"priority-col",dataKey:"priority",text:t("column_task_priority"),cellFormatter:e.DataGridCells.FixedValue(t("notApplicable")),direction:"asc"},{name:"lastRunAt-col",dataKey:"lastRunAt",text:t("column_task_last_update"),direction:"asc",cellFormatter:e.DataGridCells.DateTimeCell("lastRunAt",t("unavailable"))},{name:"runNextAt-col",dataKey:"runNextAt",text:t("column_task_next_update"),direction:"asc",cellFormatter:e.DataGridCells.DateTimeCell("runNextAt",t("unavailable"))}])}t.columns=r}(t=e.RemoteRefreshScheduleGrid||(e.RemoteRefreshScheduleGrid={}))}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(){function t(e,t){this.$translate=e,this.locLinkifier=t}return t.prototype.attachReactDataGridToScope=function(e,t,r){e.dataGridProps={emptyChild:this.emptyTemplateElementFor(r),update:0,cols:t,onHeaderClicked:function(t,r){e.$apply(function(){e.sorter.setPrimary(t,r)})},onCellClick:function(t,r){e.$apply(function(){if(VizPortal.FeatureFlags.toggleSelectableRow){var n=1===e.selectedItems.size()&&e.selectedItems.contains(t),i="actions"===r;n&&!i?e.selectedItems.toggle(t):(e.selectedItems.clear(),e.selectedItems.add(t))}else e.selectedItems.clear(),e.selectedItems.add(t);var o=e.selectedItems.keys();e.dataGridProps.selectedKeys=_.object(o,o),e.dataGridProps.update++})}},e.$watch(function(){return e.sorter.selectedColumnKey()+";"+e.sorter.isSortAscending()},function(){e.dataGridProps.sortKey=e.sorter.selectedColumnKey(),e.dataGridProps.sortAscending=e.sorter.isSortAscending(),e.dataGridProps.update++}),e.$watch(function(){return e.selectedItems.size()},function(){var t=e.selectedItems.keys();e.dataGridProps.selectedKeys=_.object(t,t),e.dataGridProps.update++})},t.prototype.emptyTemplateElementFor=function(e){var t=this,r=[];return e.title&&r.push(React.DOM.div({key:"title",className:"tb-data-grid-empty-title"},this.$translate.instant(e.title))),e.body&&r.push(React.DOM.div({key:"body",className:"tb-data-grid-empty-body"},_.map(e.body,function(e){return React.DOM.div({className:"tb-data-grid-empty-body-paragraph"},_.map(e.statements,function(e){return React.DOM.div({key:"help",dangerouslySetInnerHTML:{__html:t.locLinkifier(e)}})}))}))),e.help&&r.push(React.DOM.div({key:"help",className:"tb-data-grid-empty-help-link",dangerouslySetInnerHTML:{__html:this.locLinkifier(e.help)}})),React.DOM.div({className:"tb-data-grid-empty"},r)},t.prototype.updateReactDataGridRowStore=function(t){var r=t.keyForItem||function(e){return e.id};t.scope.dataGridProps.rowStore=new e.SparseCachedList(t.sliceable,function(e){return{key:r(e),data:e,rowStyle:t.getRowStyle?t.getRowStyle(e):null}}),t.scope.dataGridProps.update++},t.$inject=["$translate","locLinkifierFilter"],t}();e.AngularToReactDataGridBridge=t,VizPortal.Module.instance().service("AngularToReactDataGridBridge",t)}(VizPortalReact||(VizPortalReact={}));var VizPortal;!function(e){var t=function(){function e(){this.comparableValueTransforms={}}return e.prototype.addTransformForValueComparison=function(e,t){this.comparableValueTransforms[e]=_.memoize(t)},e.prototype.sortByClauses=function(e,t){var r=this;if(!e||0==e.length)return e;var n=e.slice(0);return t&&0!=t.length?(n.sort(function(e,n){return r.compareByClauses(e,n,t,0)}),n):n},e.prototype.compareByClauses=function(e,t,r,n){if(n>=r.length)return 0;var i=r[n],o=i.field,s=e[o],a=t[o],c=this.comparableValueTransforms[o];return c&&(s=c(s),a=c(a)),s>a?i.ascending?1:-1:a>s?i.ascending?-1:1:this.compareByClauses(e,t,r,n+1)},e}();e.LocalSorter=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){function r(t){var r=[];return r.push(e.ServerApi.RemoteRefreshTypes.Full),t.hasIncrementalExtract&&r.push(e.ServerApi.RemoteRefreshTypes.Incremental),r}function n(t){return t.hasExtracts&&!(t.connectionOAuth&&t.connectionDetails&&t.connectionDetails.type===e.ServerApi.ConnectionDetailType.Database)}function i(t,r){return r&&r.refreshMode===e.ServerApi.RefreshModeTypes.Remote&&r.remoteAgentName?r.remoteAgentName:r&&r.refreshMode===e.ServerApi.RefreshModeTypes.Remote&&!r.remoteAgentName?t.instant("remoteRefreshModeUnlinkedLabel"):t.instant("remoteRefreshModeServerLabel")}function o(t,r){t.is("main.site.content.datasource.remoteRefreshSchedules")&&r!==e.ServerApi.RefreshModeTypes.Remote&&t.go("^.extractTasks"),t.is("main.site.content.datasource.extractTasks")&&r===e.ServerApi.RefreshModeTypes.Remote&&t.go("^.remoteRefreshSchedules")}t.getAvailableRefreshTypes=r,t.canBeRefreshedRemotely=n,t.getCurrentRefreshLocation=i,t.redirectByDatasourceRefreshMode=o}(t=e.RefreshPropertyHelper||(e.RefreshPropertyHelper={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i,o,s,a,c,l,u,d,p){this.$q=e,this.$translate=t,this.$window=r,this.$state=n,this.ConfirmActionDialog=i,this.ToasterService=o,this.HelpService=s,this.ServerService=a,this.RemoteRefreshAgents=c,this.ChangeDatasourceRefreshModeAction=l,this.ChangeDatasourceRemoteAgentAction=u,this.CreateExtractTasksAction=d,this.CreateRemoteRefreshScheduleAction=p,this.AddNewAgentOption="@@add-new-agent@@"}return t.prototype.execute=function(t,r,n,i){var o=this,s=e.ActionContext.fromEvent(t),a=s.scope.$new();return a.prompt=this.$translate.instant("editRemoteRefreshPropertiesDialogPrompt",{DATASOURCE_NAME:e.L10n.elideIfLong(r.name)}),a.remoteRefreshModeOptions=[e.ServerApi.RefreshModeTypes.Server,e.ServerApi.RefreshModeTypes.Remote],a.remoteAgentOptions=[],a.remoteAgentOptionsEnabled=function(){return a.editModel.refreshMode===e.ServerApi.RefreshModeTypes.Remote},a.remoteRefreshDescription=function(){return{localizedStatementKey:"remoteRefreshModeEditRemoteDescription",links:[{key:"{LEARN_HOW_TO_ADD_A_COMPUTER_TO_THE_LIST}",localizedValueKey:"remoteRefreshModeEditRemoteDescriptionSetupLink",url:o.HelpService.getServerHelpUrlByCategory("dataconnections7")}]}},a.editModel={refreshMode:r.refreshMode,remoteAgentName:r.remoteAgentName},a.existingRefreshSchedules=function(){return i},a.warnRefreshesToBeDeleted=function(){return r.refreshMode===e.ServerApi.RefreshModeTypes.Server&&a.editModel.refreshMode===e.ServerApi.RefreshModeTypes.Remote&&i>0},a.warnEmbeddedPassword=function(){return r.refreshMode===e.ServerApi.RefreshModeTypes.Server&&a.editModel.refreshMode===e.ServerApi.RefreshModeTypes.Remote&&r.connectionDetails&&r.connectionDetails.hasEmbeddedPassword},a.remoteAgentSelectClicked=function(){return o.refreshAvailableRemoteAgents(r,a)},a.$watch("editModel.remoteAgentName",function(t,r,n){t!==r&&t===o.AddNewAgentOption&&(a.editModel.remoteAgentName=r,o.$window.open(o.HelpService.getServerHelpUrlByCategory("dataconnections7"),e.LinkTargetAttributes.Blank))}),this.refreshAvailableRemoteAgents(r,a),this.ConfirmActionDialog.open({scope:a,title:this.$translate.instant("editRemoteRefreshScheduleDialogTitle"),bodyTemplateUrl:"confirmActionDialogRemoteRefreshProperties.html",size:"400px",actionName:n?this.$translate.instant("next"):this.$translate.instant("save"),action:angular.noop,confirmDisabled:function(){return a.editModel.refreshMode===e.ServerApi.RefreshModeTypes.Remote&&!a.editModel.remoteAgentName}}).result.then(function(t){var i=n||r.refreshMode===e.ServerApi.RefreshModeTypes.Server&&a.editModel.refreshMode===e.ServerApi.RefreshModeTypes.Remote&&r.remoteAgentName!==a.editModel.remoteAgentName;return o.ChangeDatasourceRefreshModeAction.execute(r,r.refreshMode,a.editModel.refreshMode,a.editModel.remoteAgentName,i,!1)}).then(e.ResultHelper.rejectResultOnError(this.$q)).then(function(e){return o.ChangeDatasourceRemoteAgentAction.execute(r,r.remoteAgentName,a.editModel.remoteAgentName,a.editModel.refreshMode,n,!1)}).then(e.ResultHelper.rejectResultOnError(this.$q)).then(function(i){return n?a.editModel.refreshMode===e.ServerApi.RefreshModeTypes.Remote?o.CreateRemoteRefreshScheduleAction.execute(t,r,e.RefreshPropertyHelper.getAvailableRefreshTypes(r)):o.CreateExtractTasksAction.forDatasource(r,e.ActionContext.fromEvent(t),e.CreateExtractTasksMode.AllowSchedule):o.$q.when(i)}).then(function(){n&&(a.editModel.refreshMode===e.ServerApi.RefreshModeTypes.Remote?o.ToasterService.pop({type:e.ToastType.Info,text:o.$translate.instant("editRemoteRefreshPropertiesAgentSuccess",{AGENT_NAME:e.L10n.elideIfLong(a.editModel.remoteAgentName)})}):o.ToasterService.pop({type:e.ToastType.Info,text:o.$translate.instant("editRemoteRefreshPropertiesServerSuccess")}))}).fin(function(){a.$destroy(),o.$state.hardReload()})},t.prototype.refreshAvailableRemoteAgents=function(t,r){var n=this;this.RemoteRefreshAgents.get().then(function(i){var o=_.map(i.agents,function(e){return e.name});t.remoteAgentName&&(o=_.union(o,[t.remoteAgentName])),t.remoteAgentName||t.refreshMode!==e.ServerApi.RefreshModeTypes.Server||o.length>0&&(r.editModel.remoteAgentName=o[0]),r.remoteAgentOptions=_.map(o,function(e){return{display:e,name:e}}),r.remoteAgentOptions.push({display:n.$translate.instant("remoteRefreshAgentAddNew"),name:n.AddNewAgentOption})})},t.$inject=["$q","$translate","$window","$state","ConfirmActionDialog","ToasterService","HelpService","ServerService","RemoteRefreshAgents","ChangeDatasourceRefreshModeAction","ChangeDatasourceRemoteAgentAction","CreateExtractTasksAction","CreateRemoteRefreshScheduleAction"],t}();e.ChangeDatasourceRemoteRefreshPropertiesAction=t,e.Module.instance().service("ChangeDatasourceRemoteRefreshPropertiesAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(){}return e.seconds="0",e.minutes="0",e.hours="0",e.dayOfMonth="?",e.month="*",e.dayOfWeek="*",e.year="",e.expression=e.seconds+" "+e.minutes+" "+e.hours+" "+e.dayOfMonth+" "+e.month+" "+e.dayOfWeek+" "+e.year,e}();e.CronExpressionDefaultValues=t;var r=function(){function e(e,r,n,i,o,s,a){void 0===e&&(e=t.seconds),void 0===r&&(r=t.minutes),void 0===n&&(n=t.hours),void 0===i&&(i=t.dayOfMonth),void 0===o&&(o=t.month),void 0===s&&(s=t.dayOfWeek),void 0===a&&(a=t.year),this.seconds=e,this.minutes=r,this.hours=n,this.dayOfMonth=i,this.month=o,this.dayOfWeek=s,this.year=a}return e}();e.CronExpressionFieldValues=r;var n=function(){function e(){}return e.All="1",e.Any="2",e.Specific="3",e.SpecificIncrement="4",e.Range="5",e.RangeIncrement="6",e.Invalid="7",e}();e.CronExpressionFieldSubsetTypes=n;var i=function(){function e(){this.hoursOfDay=_.clone(e.defaultHoursOfDay),this.dayOfWeek=_.clone(e.defaultDayOfWeek),this.editorModeIsDaily=e.defaultEditorModeIsDaily}return e.prototype.getCronExpression=function(){var e=new r;return e.minutes=this.buildMinutesExpression(),e.hours=this.buildHoursExpression(),e.dayOfWeek=this.buildDayOfWeekExpression(),o.buildFromFields(e)},e.prototype.setFromCronExpression=function(e){var t=o.getMinutesField(e),r=o.getHoursField(e),i=o.getDayOfWeekField(e),s=[!1,!1,!1,!1,!1,!1,!1],a=o.getTimeFieldSubsetParts(t),c=o.getTimeFieldSubsetParts(r);void 0!==a.increment||void 0!==c.increment?(this.editorModeIsDaily=!1,this.hoursOfDay.increment=(void 0!==a.increment?a.increment:0)+(void 0!==c.increment?60*c.increment:0),this.hoursOfDay.from=60*c.from,this.hoursOfDay.to=60*c.to):(this.editorModeIsDaily=!0,this.hoursOfDay.specific=60*c.specific),_.each(i.split(","),function(t){var r=o.getTypeFromFieldSubset(t);if(r===n.Range){var i=o.getFromPartFromSubset(t),a=o.getToPartFromSubset(t);_.each(_.range(i,a+1),function(e){return s[e-1]=!0})}else if(r===n.Specific)s[o.getSpecificPartFromSubset(t)-1]=!0;else{if(r!==n.All)throw"#setFromCronExpression failed when parsing the dayOfWeek field of the expression: {"+e+"}. #getTypeFromFieldSubset returned: {"+r+"} for subset parameter: {"+t+"}";s=[!0,!0,!0,!0,!0,!0,!0]}}),this.dayOfWeek={sunday:s[0],monday:s[1],tuesday:s[2],wednesday:s[3],thursday:s[4],friday:s[5],saturday:s[6]}},e.prototype.isValid=function(){return this.intervalIsValid()&&this.dayOfWeekNotEmpty()},e.isEqual=function(e,t){return _.isEqual(e.hoursOfDay,t.hoursOfDay)&&_.isEqual(e.dayOfWeek,t.dayOfWeek)&&e.editorModeIsDaily===t.editorModeIsDaily},e.prototype.isEqual=function(t){return e.isEqual(this,t)},e.clone=function(e,t){return e.hoursOfDay=_.clone(t.hoursOfDay),e.dayOfWeek=_.clone(t.dayOfWeek),e.editorModeIsDaily=t.editorModeIsDaily,e},e.prototype.clone=function(t){return e.clone(this,t)},e.prototype.intervalIsValid=function(){return this.editorModeIsDaily||this.hoursOfDay.from<this.hoursOfDay.to},e.prototype.dayOfWeekNotEmpty=function(){return!_.isEqual(this.dayOfWeek,e.emptyDayOfWeek)},e.prototype.buildMinutesExpression=function(){if(this.editorModeIsDaily)return"0";var e=this.hoursOfDay.increment%60;return"0"+(e>0?"/"+e:"")},e.prototype.buildHoursExpression=function(){if(this.editorModeIsDaily)return this.hoursOfDay.specific/60+"";var e=this.hoursOfDay.increment%60,t=(this.hoursOfDay.increment>=60?this.hoursOfDay.increment-e:0)/60;return t>0?this.hoursOfDay.from/60+"-"+this.hoursOfDay.to/60+"/"+t:this.hoursOfDay.from/60+"-"+this.hoursOfDay.to/60},e.prototype.buildDayOfWeekExpression=function(){var e=[this.dayOfWeek.sunday,this.dayOfWeek.monday,this.dayOfWeek.tuesday,this.dayOfWeek.wednesday,this.dayOfWeek.thursday,this.dayOfWeek.friday,this.dayOfWeek.saturday],t="",r=e.indexOf(!0),n=e.indexOf(!1,r);if(-1===r)return"?";if(0===r&&-1===n)return"*";for(;;){if(n=e.indexOf(!1,r),-1===n){t=r===e.length-1?t+(r+1)+"":r===e.length-2?t+(r+1)+","+(r+2):t+(r+1)+"-"+e.length;break}if(n-r===1?t+=r+1:t=n-r===2?t+(r+1)+","+n:t+(r+1)+"-"+n,r=e.indexOf(!0,n),-1===r)break;t+=","}return t},e.minuteIncrementOptions=[15,30,60,120,240,480,720],e.defaultHoursOfDay={specific:300,increment:120,from:480,to:1020},e.defaultDayOfWeek={sunday:!1,monday:!0,tuesday:!0,wednesday:!0,thursday:!0,friday:!0,saturday:!1},e.emptyDayOfWeek={sunday:!1,monday:!1,tuesday:!1,wednesday:!1,thursday:!1,friday:!1,saturday:!1},e.defaultEditorModeIsDaily=!0,e}();e.RemoteRefreshScheduleEditorViewModel=i;var o;!function(e){function t(e){var t=e.seconds+" "+e.minutes+" "+e.hours+" "+e.dayOfMonth+" "+e.month+" "+e.dayOfWeek;return e.year&&(t=t+" "+e.year),t}function i(e){var t=new r,n=e.split(" ");return t.seconds=n[0],t.minutes=n[1],t.hours=n[2],t.dayOfMonth=n[3],t.month=n[4],t.dayOfWeek=n[5],7===n.length&&(t.year=n[6]),t}function o(e){return"*"===e?n.All:"?"===e?n.Any:-1!==e.search("^([0-9]|[0-9][0-9])$")?n.Specific:-1!==e.search("((^)|(^([0-9]|[0-9][0-9])))/([0-9]|[0-9][0-9])$")?n.SpecificIncrement:-1!==e.search("^(([0-9]|[0-9][0-9])-([0-9]|[0-9][0-9]))$")?n.Range:-1!==e.search("^(([0-9]|[0-9][0-9])-([0-9]|[0-9][0-9]))/([0-9]|[0-9][0-9])$")?n.RangeIncrement:n.Invalid}function s(e){var t=e.indexOf("/");if(0===t)return 0;var r=-1===t?e:e.substring(0,t);return parseInt(r,10)}function a(e){var t=e.substring(0,e.indexOf("-"));return parseInt(t,10)}function c(e){var t=e.indexOf("/"),r=e.substring(e.indexOf("-")+1,-1===t?e.length:t);return parseInt(r,10)}function l(e){var t=e.substring(e.indexOf("/")+1);return parseInt(t,10)}function u(t){var r={},i=e.getTypeFromFieldSubset(t);if(i===n.Specific)r.specific=s(t);else if(i===n.SpecificIncrement)r.specific=s(t),r.increment=l(t);else if(i===n.Range)r.from=a(t),r.to=c(t);else{if(i!==n.RangeIncrement)throw"#getTimeFieldSubsetParts failed. #getTypeFromFieldSubset returned: {"+i+"} for subset parameter: {"+t+"}";r.from=a(t),r.to=c(t),r.increment=l(t)}return r}function d(e){return i(e).seconds}function p(e){return i(e).minutes}function h(e){return i(e).hours}function f(e){return i(e).dayOfMonth}function m(e){return i(e).month}function v(e){return i(e).dayOfWeek}function S(e){return i(e).year}function g(e,r){var n=i(e);return n.seconds=r,t(n)}function y(e,r){var n=i(e);return n.minutes=r,t(n)}function A(e,r){var n=i(e);return n.hours=r,t(n)}function P(e,r){var n=i(e);return n.dayOfMonth=r,t(n)}function C(e,r){var n=i(e);return n.month=r,t(n)}function b(e,r){var n=i(e);return n.dayOfWeek=r,t(n)}function R(e,r){var n=i(e);return n.year=r,t(n)}e.buildFromFields=t,e.buildFromExpression=i,e.getTypeFromFieldSubset=o,e.getSpecificPartFromSubset=s,e.getFromPartFromSubset=a,e.getToPartFromSubset=c,e.getIncrementPartFromSubset=l,e.getTimeFieldSubsetParts=u,e.getSecondsField=d,e.getMinutesField=p,e.getHoursField=h,e.getDayOfMonthField=f,e.getMonthField=m,e.getDayOfWeekField=v,e.getYearField=S,e.setSecondsField=g,e.setMinutesField=y,e.setHoursField=A,e.setDayOfMonthField=P,e.setMonthField=C,e.setDayOfWeekField=b,e.setYearField=R}(o=e.CronExpressionHelper||(e.CronExpressionHelper={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r){this.server=e,this.requestType=t,this.resultMapper=r}return t.prototype.fetchList=function(t){var r=this;return this.server.sendRequest(new this.requestType(t)).then(function(n){var i=t.page?t.page.startIndex:0;return new e.ListResult(r.resultMapper(n),i,n.totalCount)})},t}();e.ServerResourceFetcher=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"createRemoteRefreshSchedule",t)}return __extends(t,e),t}(e.Request);e.CreateRemoteRefreshScheduleRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"deleteRemoteRefreshSchedules",t)}return __extends(t,e),t}(e.Request);e.DeleteRemoteRefreshSchedulesRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){e.RemoteRefreshTypes={Full:"Full",Incremental:"Incremental"};var t=function(e){function t(t){e.call(this,"getRemoteRefreshSchedules",t)}return __extends(t,e),t}(e.Request);e.GetRemoteRefreshSchedulesRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"updateRemoteRefreshSchedule",t)}return __extends(t,e),t}(e.Request);e.UpdateRemoteRefreshScheduleRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n){this.ServerService=e,this.toaster=t,this.$translate=r,this.$timeout=n}return t.prototype.notifyOnFail=function(t){var r=this;return t.fail(function(t){t===e.ErrorReason.Unknown&&r.toaster.pop({type:e.ToastType.Error,text:r.$translate.instant("unexpectedError")})}),t},t.prototype.addDelay=function(e){var r=this;return e.then(function(e){return r.$timeout(function(){return e},t.ResponseDelay)})},t.prototype.sendRequest=function(e){return this.notifyOnFail(this.ServerService.sendRequest(e))},t.prototype.sendRequestAndDelay=function(e){return this.addDelay(this.sendRequest(e))},t.prototype.sendRequests=function(e,t){return this.notifyOnFail(this.ServerService.sendRequests(e,t))},t.prototype.sendRequestsAndDelay=function(e,t){return this.addDelay(this.sendRequests(e,t))},t.prototype.getServerService=function(){return this.ServerService},t.ResponseDelay=2e3,t.$inject=["ServerService","ToasterService","$translate","$timeout"],t}();e.ErrorNotifyingServer=t,e.Module.instance().service("ErrorNotifyingServer",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(t){function r(r,n){t.call(this,n.getServerResourceFetcher(e.ServerApi.GetRemoteRefreshSchedulesRequest,e.ServerApiMapper.remoteRefreshSchedules)),this.ErrorNotifyingServer=r}return __extends(r,t),r.prototype.create=function(t,r){return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.CreateRemoteRefreshScheduleRequest({targetId:t,definition:r.definition,refreshType:r.refreshType}))},r.prototype.update=function(t,r,n){return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.UpdateRemoteRefreshScheduleRequest({targetId:t,initial:e.RemoteRefreshScheduleMapper.mapSingleToApi(r),"final":e.RemoteRefreshScheduleMapper.mapSingleToApi(n)}))},r.prototype.del=function(t,r){var n=r.toArray();return this.ErrorNotifyingServer.sendRequests(e.RequestHelper.buildRequests(n,function(r){
return new e.ServerApi.DeleteRemoteRefreshSchedulesRequest({targetId:t,schedules:e.RemoteRefreshScheduleMapper.mapToApi(r)})}),e.ResultHelper.combineResults)},r.$inject=["ErrorNotifyingServer","FetcherFactory"],r}(e.Resource);e.RemoteRefreshSchedules=t,e.Module.instance().service("RemoteRefreshSchedules",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i){this.$translate=e,this.$filter=t,this.ConfirmActionDialog=r,this.ContentActionNotification=n,this.RemoteRefreshSchedules=i}return t.prototype.execute=function(t,r,n){var i=this,o=e.ActionContext.fromEvent(t);this.scope=o.scope.$new(),this.scope.availableTypeOptions=n,this.scope.minuteIncrementOptions=e.RemoteRefreshScheduleEditorViewModel.minuteIncrementOptions,this.scope.prompt=this.$translate.instant("createRemoteRefreshScheduleCustomDialogPrompt",{ITEM_NAME:e.L10n.elideIfLong(r.name)}),this.scope.startOnMonday=e.L10n.firstDayOfWeekIsMonday(),this.scope.editorViewModel=new e.RemoteRefreshScheduleEditorViewModel,this.scope.scheduleInfo={definition:this.scope.editorViewModel.getCronExpression(),refreshType:e.ServerApi.RemoteRefreshTypes.Full,runNextAt:null};var s=this.ConfirmActionDialog.open({title:this.$translate.instant("createRemoteRefreshScheduleDialogTitle"),bodyTemplateUrl:"confirmActionDialogRemoteRefreshSchedule.html",size:"500px",scope:this.scope,position:_.extend(e.ModalService.anchoredTo(o.targetElement),{reserveHeight:600}),actionName:this.$translate.instant("createRemoteRefreshScheduleDialogSubmit"),action:function(){return i.scope.scheduleInfo.definition=i.scope.editorViewModel.getCronExpression(),i.RemoteRefreshSchedules.create(r.id,i.scope.scheduleInfo)},confirmDisabled:function(){return!i.scope.editorViewModel.isValid()}});return s.result.then(function(e){if(e.errors&&e.errors.length){var t=i.errorMessageFor(e.errors[0]);s.showErrorMessage(t)}else i.ContentActionNotification.notifySuccess(i.$translate.instant("createRemoteRefreshScheduleSuccess",{REFRESH_TYPE_NAME:i.$filter("remoteRefreshScheduleTypeName")(i.scope.scheduleInfo.refreshType)}));return e}).fin(function(){return i.scope.$destroy()})},t.prototype.errorMessageFor=function(e){return this.$translate.instant("errorUnknown")},t.$inject=["$translate","$filter","ConfirmActionDialog","ContentActionNotification","RemoteRefreshSchedules"],t}();e.CreateRemoteRefreshScheduleAction=t,e.Module.instance().service("CreateRemoteRefreshScheduleAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n){this.$translate=e,this.ConfirmActionDialog=t,this.ContentActionNotification=r,this.RemoteRefreshSchedules=n}return t.prototype.execute=function(t,r,n){var i=this;return this.ConfirmActionDialog.open({scope:t.scope,title:this.$translate.instant("delete"),bodyText:this.$translate.instant("confirmDeleteRemoteRefreshSchedules",{COUNT:n.size()},e.L10n.Interpolations.Count),actionName:this.$translate.instant("confirmDeleteButton",{ITEM_COUNT:n.size()},e.L10n.Interpolations.Count),isDeleteAction:!0,action:function(t){return i.RemoteRefreshSchedules.del(r.id,n).then(function(r){if(r.errors&&r.errors.length){var o=i.errorMessageFor(r.errors[0]);t.showErrorMessage(o)}else i.ContentActionNotification.notifySuccess(i.$translate.instant("deleteRemoteRefreshScheduleSuccess",{ITEM_COUNT:n.size()},e.L10n.Interpolations.Count));return r})}}).result},t.prototype.errorMessageFor=function(e){return this.$translate.instant("errorUnknown")},t.$inject=["$translate","ConfirmActionDialog","ContentActionNotification","RemoteRefreshSchedules"],t}();e.DeleteRemoteRefreshSchedulesAction=t,e.Module.instance().service("DeleteRemoteRefreshSchedulesAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i){this.$translate=e,this.$filter=t,this.ConfirmActionDialog=r,this.ContentActionNotification=n,this.RemoteRefreshSchedules=i}return t.prototype.execute=function(t,r,n,i){var o=this;this.scope=t.scope.$new(),this.scope.availableTypeOptions=i,this.scope.minuteIncrementOptions=e.RemoteRefreshScheduleEditorViewModel.minuteIncrementOptions,this.scope.prompt=this.$translate.instant("editRemoteRefreshScheduleCustomDialogPrompt",{DATASOURCE_NAME:e.L10n.elideIfLong(r.name)}),this.scope.startOnMonday=e.L10n.firstDayOfWeekIsMonday(),this.scope.editorViewModel=new e.RemoteRefreshScheduleEditorViewModel,this.scope.editorViewModel.setFromCronExpression(n.definition),this.scope.scheduleInfo=_.clone(n);var s=(new e.RemoteRefreshScheduleEditorViewModel).clone(this.scope.editorViewModel),a=this.ConfirmActionDialog.open({title:this.$translate.instant("editRemoteRefreshScheduleDialogTitle"),bodyTemplateUrl:"confirmActionDialogRemoteRefreshSchedule.html",size:"500px",scope:this.scope,position:_.extend(e.ModalService.anchoredTo(t.targetElement),{reserveHeight:600}),actionName:this.$translate.instant("editRemoteRefreshSchedule"),action:function(){return o.scope.scheduleInfo.definition=o.scope.editorViewModel.getCronExpression(),o.RemoteRefreshSchedules.update(r.id,n,o.scope.scheduleInfo)},confirmDisabled:function(){return!o.scope.editorViewModel.isValid()||o.scope.editorViewModel.isEqual(s)&&o.scope.scheduleInfo.refreshType===n.refreshType}});return a.result.then(function(e){if(e.errors&&e.errors.length){var t=o.errorMessageFor(e.errors[0]);a.showErrorMessage(t)}else o.ContentActionNotification.notifySuccess(o.$translate.instant("editRemoteRefreshScheduleSuccess",{REFRESH_TYPE_NAME:o.$filter("remoteRefreshScheduleTypeName")(o.scope.scheduleInfo.refreshType)}));return e}).fin(function(){return o.scope.$destroy()})},t.prototype.errorMessageFor=function(e){return this.$translate.instant("errorUnknown")},t.$inject=["$translate","$filter","ConfirmActionDialog","ContentActionNotification","RemoteRefreshSchedules"],t}();e.EditRemoteRefreshScheduleAction=t,e.Module.instance().service("EditRemoteRefreshScheduleAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e){this.$location=e}return e.prototype.createQueryUpdaterFromSubplace=function(e,t,n){return new r(this.$location,e,t.type,t.resource,n,t.defaultFilters,t.filterKeys())},e.prototype.createQueryUpdater=function(e,t,n,i,o){return new r(this.$location,e,t,n,i,o)},e.$inject=["$location"],e}();e.QueryService=t;var r=function(){function t(e,t,r,n,i,o,s){var a=this;void 0===s&&(s=r.filterKeys),this.$location=e,this.$scope=t,this.type=r,this.resource=n,this.refreshFn=i,this.defaultFilters=o,this.filterKeys=s,this.order=null,this.filters=null,t.$on("$locationChangeSuccess",function(e,t,r){t=t.split("?")[0],r=r.split("?")[0],t===r&&a.refreshIfOrderOrFilterChanged()})}return t.prototype.refresh=function(){var e=this.getCurrentOrderAndFilters(),t=e.order,r=e.filters,n=this.type.extraQueryParams;this.rememberOrderAndFilter(t,r);var i=this.createResourceQuery(t,r,n);this.refreshFn(i)},t.prototype.refreshIfOrderOrFilterChanged=function(){var e=this.getCurrentOrderAndFilters(),t=e.order,r=e.filters,n=this.type.extraQueryParams;if(this.didOrderOrFilterChanged(t,r)){this.rememberOrderAndFilter(t,r);var i=this.createResourceQuery(t,r,n);this.refreshFn(i)}},t.prototype.didOrderOrFilterChanged=function(e,t){return!_.isEqual(e,this.order)||!_.isEqual(t,this.filters)},t.prototype.rememberOrderAndFilter=function(e,t){this.order=e,this.filters=t},t.prototype.createResourceQuery=function(e,t,r){return this.resource.all().withFilters(t).withOrder(e).withExtraParams(r)},t.prototype.getCurrentOrderAndFilters=function(){var t=this.$location.search();return{order:e.Order.fromInput(t.order,this.type.orderKeys)||this.type.defaultOrder,filters:this.getFilterClauses(t,this.filterKeys,this.defaultFilters)}},t.prototype.getFilterClauses=function(t,r,n){return e.ServerFilterClauses.create(_.defaults(_(t).pick(r),n||{}))},t}();e.Module.instance().service("QueryService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(){}return e.prototype.rowClicked=function(e,t,r){var n=0===r;n?e.toggle(t):(e.clear(),e.add(t))},e}();e.SelectionService=t,e.Module.instance().service("SelectionService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(n,i,o,s,a,c,l,u,d,p,h,f,m,v,S,g,y,A){var P=this;this.$q=n,this.$translate=i,this.AngularToReactDataGridBridge=o,this.$scope=s,this.$filter=c,this.serverService=d,this.HelpService=f,this.datasource=v,this.DeleteRemoteRefreshSchedulesAction=g,this.EditRemoteRefreshScheduleAction=y,s.selectedItems=new e.Set(t.keyForSchedule);var C=this.createActions(s.selectedItems);e.FeatureFlags.reactRemoteSchedulesGrid&&this.configureForReactDataGrid(C),l.setTitle("refreshSchedule",s.objectName),this.redirectByExtractsAndRefreshMode(a,v),s.$on(e.SubplaceEvents.Refresh,function(){P.refreshRemoteRefreshSchedules()}),s.datasource=v,s.anyActionsAllowed=function(){return P.anyActionsAllowed()},s.refreshPropertiesAreEditable=function(){return s.anyActionsAllowed()&&e.RefreshPropertyHelper.canBeRefreshedRemotely(v)},s.currentRefreshLocation=function(){return e.RefreshPropertyHelper.getCurrentRefreshLocation(i,s.datasource)},s.sorter=m.create(e.RemoteRefreshScheduleContentType.defaultOrder),s.availableAction=function(e){return e.isAvailable(s.selectedItems)},e.ActionButtonsHelper.setupActionButtons(s,C),s.listActions=[{name:"new-remote-refresh-schedule",translate:"newExtractRefresh",isAvailable:function(){return s.anyActionsAllowed()},execute:function(t){return S.execute(t,v,e.RefreshPropertyHelper.getAvailableRefreshTypes(s.datasource)).then(function(){return P.refreshRemoteRefreshSchedules()})}}],s.availableListAction=function(e){return e.isAvailable()},s.headerClicked=function(e){return s.sorter.setPrimary(e.attrs.key,e.attrs.direction)},s.rowClicked=function(e,t){s.anyActionsAllowed()&&h.rowClicked(s.selectedItems,e,t)},this.waitForCountOfSchedules=n.defer(),s.changeRemoteRefreshProperties=function(e){P.waitForCountOfSchedules.promise.then(function(t){A.execute(e,s.datasource,!1,t)})},s.sliceChanged=function(t){P.waitForCountOfSchedules.resolve(t.total),s.selectedItems.updateItems(t.items),e.SubplaceCountsHelper.updateCountsFromSubplace(s,u,t.total)},s.emptyTemplateModel=this.emptyTemplateModel(),this.query=p.createQueryUpdaterFromSubplace(s,u,function(n){s.sliceable=new r(n,c),e.FeatureFlags.reactRemoteSchedulesGrid&&P.AngularToReactDataGridBridge.updateReactDataGridRowStore({scope:s,sliceable:s.sliceable,keyForItem:t.keyForSchedule})}),this.refreshRemoteRefreshSchedules()}return t.keyForSchedule=function(e){return e.definition+"_"+e.refreshType},t.prototype.anyActionsAllowed=function(){return this.serverService.isSessionSiteOrServerAdmin()||this.datasource.owner.id===this.serverService.sessionUserId()},t.prototype.emptyTemplateModel=function(){return{title:"extractTasksEmptyMessage",body:[{statements:[{localizedStatementKey:"remoteRefreshSchedulesEmptyParagraph1"}]}],help:{links:[{localizedValueKey:"remoteRefreshSchedulesEmptyHelp",url:this.HelpService.getDatasourceHelpUrl()}]}}},t.prototype.configureForReactDataGrid=function(e){var t=this;this.$scope.useReactDataGrid=!0;var r=VizPortalReact.RemoteRefreshScheduleGrid.columns(function(e){return t.$translate.instant(e)},this.$scope,this.anyActionsAllowed(),e,this.$filter("remoteRefreshScheduleTypeName"),this.$filter("cronExpression"));this.AngularToReactDataGridBridge.attachReactDataGridToScope(this.$scope,r,this.emptyTemplateModel())},t.prototype.redirectByExtractsAndRefreshMode=function(t,r){r.hasExtracts||t.go("^.connectedWorkbooks"),e.RefreshPropertyHelper.redirectByDatasourceRefreshMode(t,r.refreshMode)},t.prototype.createActions=function(t){var r=this;return[{name:"delete",translate:"delete_action",isAvailable:function(e){return!e.isEmpty()&&r.$scope.anyActionsAllowed()},execute:function(t,n){r.DeleteRemoteRefreshSchedulesAction.execute(n,r.datasource,r.$scope.selectedItems).then(function(t){e.ActionHelpers.deselectAllExceptErrors(r.$scope.selectedItems,t,e.SchedulingErrorCode.SchedulingTaskNotFound),r.refreshRemoteRefreshSchedules()})}},{name:"edit",translate:"editRemoteRefreshSchedule_action",isAvailable:function(e){return 1===e.size()&&r.$scope.anyActionsAllowed()},execute:function(t,n){r.EditRemoteRefreshScheduleAction.execute(n,r.datasource,t.first(),e.RefreshPropertyHelper.getAvailableRefreshTypes(r.datasource)).then(function(t){e.ActionHelpers.deselectNotFound(r.$scope.selectedItems,t,e.SchedulingErrorCode.SchedulingTaskNotFound),r.refreshRemoteRefreshSchedules()})}}]},t.prototype.refreshRemoteRefreshSchedules=function(){this.waitForCountOfSchedules=this.$q.defer(),this.query.refresh()},t.$inject=["$q","$translate","AngularToReactDataGridBridge","$scope","$state","$filter","BrowserTitleService","subplace","ServerService","QueryService","SelectionService","HelpService","SorterFactory","datasource","CreateRemoteRefreshScheduleAction","DeleteRemoteRefreshSchedulesAction","EditRemoteRefreshScheduleAction","ChangeDatasourceRemoteRefreshPropertiesAction"],t}();e.RemoteRefreshSchedulesCtrl=t;var r=function(){function t(t,r){this.wrappedQuery=t,this.localSorter=new e.LocalSorter,this.localSorter.addTransformForValueComparison("refreshType",r("remoteRefreshScheduleTypeName")),this.localSorter.addTransformForValueComparison("definition",r("cronExpression"))}return t.prototype.getSlice=function(t,r){var n=this;return this.wrappedQuery.getSlice(t,r).then(function(t){return new e.ListResult(n.localSorter.sortByClauses(t.items,n.wrappedQuery.getOrder()))})},t}();e.Module.instance().controller("RemoteRefreshSchedulesCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){function r(){return _.extend({name:"",scheduledAction:e.ServerApi.ScheduleActions.Extract,priority:50,parallel:!0},this.defaultScheduleFrequency())}function n(){return{scheduleType:e.ServerApi.ScheduleTypes.Hourly,hourly:{startTime:0,endTime:0,recurrenceMinutes:60},daily:{startTime:0},weekly:{startTime:0,recurrenceDaysOfWeek:[]},monthly:{startTime:0,recurrenceDayOfMonth:e.ServerApi.ScheduleLastDayOfMonth}}}function i(e){var t=this.defaultSchedule();return t.id=e.id,t.name=e.name,t.scheduleType=e.scheduleType,t.scheduledAction=e.scheduledAction,t.priority=e.priority,t.parallel=e.parallel,_.extend(t,this.viewModelFromScheduleFrequency({scheduleType:e.scheduleType,scheduleDetails:e.scheduleDetails}))}function o(t){var r=this.defaultScheduleFrequency();switch(r.scheduleType=t.scheduleType,t.scheduleType){case e.ServerApi.ScheduleTypes.Hourly:r.hourly=_.clone(t.scheduleDetails);break;case e.ServerApi.ScheduleTypes.Daily:r.daily=_.clone(t.scheduleDetails);break;case e.ServerApi.ScheduleTypes.Weekly:r.weekly={startTime:t.scheduleDetails.startTime,recurrenceDaysOfWeek:_.clone(t.scheduleDetails.recurrenceDaysOfWeek)};break;case e.ServerApi.ScheduleTypes.Monthly:r.monthly=_.clone(t.scheduleDetails)}return r}function s(e){return{name:e.name,priority:e.priority,scheduleType:e.scheduleType,parallel:e.parallel,scheduledAction:e.scheduledAction,scheduleDetails:l(e)}}function a(e){return{id:e.id,name:e.name,priority:e.priority,scheduleType:e.scheduleType,parallel:e.parallel,scheduleDetails:l(e)}}function c(e){return{scheduleType:e.scheduleType,scheduleDetails:l(e)}}function l(t){switch(t.scheduleType){case e.ServerApi.ScheduleTypes.Daily:return t.daily;case e.ServerApi.ScheduleTypes.Hourly:return t.hourly;case e.ServerApi.ScheduleTypes.Weekly:return t.weekly;case e.ServerApi.ScheduleTypes.Monthly:return t.monthly}throw"Unknown scheduleType: "+t.scheduleType}t.defaultSchedule=r,t.defaultScheduleFrequency=n,t.viewModelFromSchedule=i,t.viewModelFromScheduleFrequency=o,t.createScheduleParamsFromViewModel=s,t.updateScheduleParamsFromViewModel=a,t.scheduleFrequencyFromViewModel=c}(t=e.CreateOrEditScheduleViewModelMapper||(e.CreateOrEditScheduleViewModelMapper={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r){this.$translate=r,t.scheduleActions=_.values(e.ServerApi.ScheduleActions),t.hourlyFrequencies=this.hourlyFrequencies(),t.daysOfMonth=this.daysOfMonth()}return t.prototype.hourlyFrequencies=function(){var e=this,t=[];return _.each([15,30],function(r){t.push({label:e.$translate.instant("minutes",{MINUTES:r}),value:r})}),_.each([1,2,4,6,8,12],function(r){t.push({label:e.$translate.instant("hours",{HOURS:r}),value:60*r})}),t},t.prototype.daysOfMonth=function(){var t=this,r=[];return _.each(_.range(1,32),function(e){r.push({label:t.$translate.instant("dayOfMonth",{DAY:e}),value:""+e})}),r.push({label:this.$translate.instant("last"),value:e.ServerApi.ScheduleLastDayOfMonth}),r},t.$inject=["$scope","$translate"],t}();e.CreateOrEditScheduleCtrl=t,e.Module.instance().controller("CreateOrEditScheduleCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"updateSchedule",t)}return __extends(t,e),t}(e.Request);e.UpdateScheduleRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){e[e.Create=0]="Create",e[e.Edit=1]="Edit"}(t||(t={}));var r=function(){function r(e,t,r,n,i){this.ConfirmActionDialog=e,this.$translate=t,this.ContentActionNotification=r,this.Schedules=n,this.ScheduleErrors=i}return r.prototype.createSchedule=function(r){return this.showDialog(t.Create,e.CreateOrEditScheduleViewModelMapper.defaultSchedule(),r)},r.prototype.editSchedule=function(r,n){return this.showDialog(t.Edit,e.CreateOrEditScheduleViewModelMapper.viewModelFromSchedule(r),n)},r.prototype.showDialog=function(r,n,i){var o=this,s=i.scope.$new();s.scheduleViewModel=n;var a,c,l;if(r===t.Create)a=this.$translate.instant("createScheduleDialogTitle"),c=this.$translate.instant("createScheduleDialog_create"),l=function(e){return o.submitScheduleCreate(s.scheduleViewModel,e)};else{a=this.$translate.instant("editScheduleDialogTitle"),c=this.$translate.instant("createScheduleDialog_save");var u=n.name;l=function(e){return o.submitScheduleUpdate(s.scheduleViewModel,u,e)}}return this.ConfirmActionDialog.open({scope:s,title:a,bodyTemplateUrl:"createScheduleDialog.html",actionName:c,action:l,size:e.ModalSize.fitToContent}).result.fin(function(){return s.$destroy()})},r.prototype.submitScheduleCreate=function(t,r){var n=this,i=e.CreateOrEditScheduleViewModelMapper.createScheduleParamsFromViewModel(t);return this.Schedules.create(i).then(function(t){if(t.errors&&t.errors.length){var o=n.ScheduleErrors.errorMessageFor(t.errors[0]);r.showErrorMessage(o)}else n.ContentActionNotification.notifySuccess(n.$translate.instant("createScheduleSuccess",{SCHEDULE_NAME:e.L10n.elideIfLong(i.name)}));return t})},r.prototype.submitScheduleUpdate=function(t,r,n){var i=this,o=e.CreateOrEditScheduleViewModelMapper.updateScheduleParamsFromViewModel(t);return this.Schedules.update(o).then(function(t){if(t.errors&&t.errors.length){var s=i.ScheduleErrors.errorMessageFor(t.errors[0],r);n?n.showErrorMessage(s):i.ContentActionNotification.notifyFailure(s)}else i.ContentActionNotification.notifySuccess(i.$translate.instant("updateScheduleSuccess",{SCHEDULE_NAME:e.L10n.elideIfLong(o.name)}));return t})},r.$inject=["ConfirmActionDialog","$translate","ContentActionNotification","Schedules","ScheduleErrors"],r}();e.CreateScheduleAction=r,e.Module.instance().service("CreateScheduleAction",r)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i){this.ScheduleErrors=e,this.ActionHelpers=t,this.ConfirmActionDialog=r,this.$translate=n,this.Schedules=i}return t.prototype.deleteSchedules=function(t,r){var n,i=this,o=t.size(),s=this.countExtractTasks(t),a=this.countSubscriptionSchedules(t);return n=1===o?a>0?this.$translate.instant("confirmDeleteSubscriptionSchedule",{SCHEDULE_NAME:e.L10n.elideIfLong(t.first().name)}):this.$translate.instant("confirmDeleteExtractRefreshSchedule",{SCHEDULE_NAME:e.L10n.elideIfLong(t.first().name),EXTRACT_COUNT:s},e.L10n.Interpolations.Count):this.$translate.instant("confirmDeleteSchedules",{SCHEDULE_COUNT:o,EXTRACT_COUNT:s,SUBSCRIPTION_COUNT:a},e.L10n.Interpolations.Count),this.ConfirmActionDialog.open({scope:r.scope,title:this.$translate.instant("delete"),bodyText:n,actionName:this.$translate.instant("confirmDeleteButton",{ITEM_COUNT:t.size()},e.L10n.Interpolations.Count),isDeleteAction:!0,action:function(e){return i.Schedules.del(t.keys()).then(function(e){return i.notifyResult(t,e)})}}).result},t.prototype.notifyResult=function(e,t){var r=this;this.ActionHelpers.notifyStandardError(e,{successId:"deleteSchedulesSuccess",errorId:"deleteSchedulesError"},function(e){return r.ScheduleErrors.errorDetailsFor(e)})(t)},t.prototype.countExtractTasks=function(t){return _.reduce(t.toArray(),function(t,r){return t+(r.scheduledAction===e.ServerApi.ScheduleActions.Extract?r.taskCount:0)},0)},t.prototype.countSubscriptionSchedules=function(t){return _.reduce(t.toArray(),function(t,r){return t+(r.scheduledAction===e.ServerApi.ScheduleActions.Subscription?1:0)},0)},t.$inject=["ScheduleErrors","ActionHelpers","ConfirmActionDialog","$translate","Schedules"],t}();e.DeleteSchedulesAction=t,e.Module.instance().service("DeleteSchedulesAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i){this.toaster=e,this.ConfirmActionDialog=t,this.$translate=r,this.Schedules=n,this.ScheduleErrors=i}return t.prototype.confirmRename=function(t,r){var n=this,i=r.scope.$new();return i.description=this.$translate.instant("confirmRenameSchedule",{SCHEDULE_NAME:e.L10n.elideIfLong(t.name)}),i.input={text:t.name,maxLength:255},this.ConfirmActionDialog.open({title:this.$translate.instant("rename"),bodyTemplateUrl:"confirmActionDialogInput.html",scope:i,actionName:this.$translate.instant("rename"),action:function(e){return n.Schedules.rename(t.id,i.input.text).then(function(r){return n.handleResult(t,i.input.text,r,e)})}}).result.fin(function(){return i.$destroy()})},t.prototype.renameInPlace=function(e,t){var r=this;return this.Schedules.rename(e.id,t).then(function(n){return r.handleResult(e,t,n)})},t.prototype.handleResult=function(t,r,n,i){if(n.errors&&n.errors.length){var o=this.ScheduleErrors.errorMessageFor(n.errors[0],t.name);i?i.showErrorMessage(o):this.toaster.pop({type:e.ToastType.Error,text:o})}else{var s=this.$translate.instant("updateScheduleNameSuccess",{ITEM_NAME:e.L10n.elideIfLong(t.name),NEW_ITEM_NAME:e.L10n.elideIfLong(r)});this.toaster.pop({type:e.ToastType.Info,text:s}),t.name=r}return n},t.$inject=["ToasterService","ConfirmActionDialog","$translate","Schedules","ScheduleErrors"],t}();e.RenameScheduleAction=t,e.Module.instance().service("RenameScheduleAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(t){function r(e,r,n,i){t.call(this,e,r),this.$translate=n,this.Schedules=i}return __extends(r,t),r.prototype.configureDialog=function(t,r){var n=this;t.bodyText=this.$translate.instant("schedulesRunPrompt",{ITEM_COUNT:r.size(),ITEM_NAME:e.L10n.elideIfLong(r.first().name)},e.L10n.Interpolations.Count),t.title=this.$translate.instant("runNow"),t.actionName=this.$translate.instant("runNowConfirmButton"),t.action=function(){return n.Schedules.run(r.keys())}},r.prototype.notificationTranslationIds=function(){return{successId:"schedulesRunSuccess",errorId:"schedulesRunError"}},r.$inject=["ConfirmActionDialog","ContentActionNotification","$translate","Schedules"],r}(e.AbstractContentAction);e.RunSchedulesAction=t,e.Module.instance().service("RunSchedulesAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(t){function r(e,r,n,i){t.call(this,e,r),this.$translate=n,this.Schedules=i}return __extends(r,t),r.prototype.configureDialog=function(t,r){var n=this;t.bodyText=this.$translate.instant("schedulesRunPrompt",{ITEM_COUNT:r.size(),ITEM_NAME:e.L10n.elideIfLong(r.first().name)},e.L10n.Interpolations.Count),t.title=this.$translate.instant("runNow"),t.actionName=this.$translate.instant("runNowConfirmButton",{ITEM_COUNT:r.size()},e.L10n.Interpolations.Count),t.action=function(){return n.Schedules.runServer(r.keys())}},r.prototype.notificationTranslationIds=function(){return{successId:"schedulesRunSuccess",errorId:"schedulesRunError"}},r.$inject=["ConfirmActionDialog","ContentActionNotification","$translate","Schedules"],r}(e.AbstractContentAction);e.RunServerSchedulesAction=t,e.Module.instance().service("RunServerSchedulesAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e){this.ServerService=e}return e.prototype.canEditSchedule=function(){return this.ServerService.isSessionServerAdmin()},e.prototype.canRunSchedule=function(){return this.ServerService.isSessionSiteOrServerAdmin()},e.$inject=["ServerService"],e}();e.SchedulePermissions=t,e.Module.instance().service("SchedulePermissions",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r){this.ServerService=e,this.SchedulesConfig=t,this.$translate=r}return t.prototype.errorDetailsFor=function(t){return{itemName:t.item.name,itemUrl:t.error.code===e.SchedulingErrorCode.SchedulingScheduleNotFound?null:this.scheduleUrl(t.item),errorMessage:this.errorMessageForItem(t)}},t.prototype.scheduleUrl=function(e){return this.ServerService.sessionSiteId()?this.SchedulesConfig.siteUrlFor(e):this.SchedulesConfig.serverUrlFor(e)},t.prototype.errorMessageForItem=function(e){return this.errorMessageFor(e.error,e.item.name)},t.prototype.errorMessageFor=function(t,r){switch(void 0===r&&(r=""),t.code){case e.SchedulingErrorCode.SchedulingScheduleNotFound:return this.$translate.instant("errorScheduleNotFound",{SCHEDULE_NAME:e.L10n.elideIfLong(r)});case e.SchedulingErrorCode.SchedulingNameAlreadyExists:return this.$translate.instant("errorScheduleNameAlreadyExists");case e.SchedulingErrorCode.SchedulingNameTooLong:return this.$translate.instant("errorScheduleNameTooLong");default:return this.$translate.instant("errorUnknown")}},t.$inject=["ServerService","SchedulesConfig","$translate"],t}();e.ScheduleErrors=t,e.Module.instance().service("ScheduleErrors",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i){this.ScheduleErrors=e,this.ActionHelpers=t,this.ConfirmActionDialog=r,this.$translate=n,this.Schedules=i}return t.prototype.enableSchedule=function(e){return this.enableSchedules(this.singleton(e))},t.prototype.disableSchedule=function(e){return this.disableSchedules(this.singleton(e))},t.prototype.singleton=function(t){return e.Set.singleton(t,function(e){return e.id})},t.prototype.confirmEnableSchedules=function(e,r){var n=this;return this.confirmAction(e,r,function(){return n.enableSchedules(e)},t.EnableTranslationIds)},t.prototype.confirmDisableSchedules=function(e,r){var n=this;return this.confirmAction(e,r,function(){return n.disableSchedules(e)},t.DisableTranslationIds)},t.prototype.confirmAction=function(t,r,n,i){return this.ConfirmActionDialog.open({scope:r.scope,title:this.$translate.instant(i.title),bodyText:this.$translate.instant(i.body,{ITEM_COUNT:t.size(),NAME:e.L10n.elideIfLong(t.first().name)},e.L10n.Interpolations.Count),actionName:this.$translate.instant(i.actionName,{ITEM_COUNT:t.size()},e.L10n.Interpolations.Count),action:n}).result},t.prototype.enableSchedules=function(e){var r=this;return this.Schedules.enable(e.keys()).then(function(n){return r.notifyResult(e,n,t.EnableTranslationIds)})},t.prototype.disableSchedules=function(e){var r=this;return this.Schedules.disable(e.keys()).then(function(n){return r.notifyResult(e,n,t.DisableTranslationIds)})},t.prototype.notifyResult=function(e,t,r){var n=this;this.ActionHelpers.notifyStandardError(e,r,function(e){return n.ScheduleErrors.errorDetailsFor(e)})(t)},t.$inject=["ScheduleErrors","ActionHelpers","ConfirmActionDialog","$translate","Schedules"],t.EnableTranslationIds={successId:"enableSchedulesSuccess",errorId:"enableSchedulesError",title:"enableSchedulesDialogTitle",body:"enableSchedulesDialogPrompt",actionName:"enableSchedulesDialogSubmit"},t.DisableTranslationIds={successId:"disableSchedulesSuccess",errorId:"disableSchedulesError",title:"disableSchedulesDialogTitle",body:"disableSchedulesDialogPrompt",actionName:"disableSchedulesDialogSubmit"},t}();e.SetScheduleStatusAction=t,e.Module.instance().service("SetScheduleStatusAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n,i,o,s,a,c,l,u,d,p){var h=this;this.SchedulePermissions=o,this.CreateScheduleAction=s,this.DeleteSchedulesAction=a,this.SetScheduleStatusAction=c,this.RunServerSchedulesAction=l,this.RunSchedulesAction=u,this.RenameScheduleAction=d,t.objectName=n.name,e.SubplaceTabsHelper.refreshWhenCurrentTabClicked(t,r),e.SubplaceCountsHelper.keepSubplaceCountsUpdated(t,i),t.schedule=n,t.canRunNow=function(){return o.canRunSchedule()},t.canEditSchedule=function(){return o.canEditSchedule()},t.isSubscription=n.scheduledAction===e.ServerApi.ScheduleActions.Subscription,t.rename=function(t){d.confirmRename(n,e.ActionContext.fromEvent(t)).then(function(){return r.hardReload()})},t.beginEdit=function(){t.scheduleViewModel=e.CreateOrEditScheduleViewModelMapper.viewModelFromSchedule(n),t.editMode=!0},t.cancelEdit=function(){return t.editMode=!1},t.save=function(e){t.busy=!0,h.CreateScheduleAction.submitScheduleUpdate(t.scheduleViewModel,t.schedule.name).then(function(){t.editMode=!1,r.hardReload()}).fin(function(){return t.busy=!1})},t.scheduleStatus={enabled:!!n.runNextAt},t.$watch("scheduleStatus.enabled",function(e,t){if(e!==t){var i=e?h.SetScheduleStatusAction.enableSchedule(n):h.SetScheduleStatusAction.disableSchedule(n);i.then(function(){return r.hardReload()})}});var f=e.Set.singleton(n,function(e){return e.id});t.del=function(t){h.DeleteSchedulesAction.deleteSchedules(f,e.ActionContext.fromEvent(t)).then(function(){return r.go("^.^.schedules")})},t.runNow=function(t){p?h.RunSchedulesAction.execute(f,e.ActionContext.fromEvent(t)).then(function(){return r.hardReload()}):h.RunServerSchedulesAction.execute(f,e.ActionContext.fromEvent(t)).then(function(){return r.hardReload()})}}return t.$inject=["$scope","$state","schedule","place","SchedulePermissions","CreateScheduleAction","DeleteSchedulesAction","SetScheduleStatusAction","RunServerSchedulesAction","RunSchedulesAction","RenameScheduleAction","siteId"],t}();e.ScheduleCtrl=t,e.Module.instance().controller("ScheduleCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(t){function r(e,r,n,i){t.call(this,e,r),this.$translate=n,this.ExtractTasks=i}return __extends(r,t),r.prototype.configureDialog=function(t,r){var n=this,i=t.scope;if(1===r.size()){var o=r.first();o.workbook?i.description=this.$translate.instant("extractTasksSetPriorityWorkbookPrompt",{PARENT_NAME:e.L10n.elideIfLong(o.workbook.name)}):o.datasource&&(i.description=this.$translate.instant("extractTasksSetPriorityDatasourcePrompt",{PARENT_NAME:e.L10n.elideIfLong(o.datasource.name)}))}else i.description=this.$translate.instant("extractTasksSetPriorityMultiplePrompt",{ITEM_COUNT:r.size()},e.L10n.Interpolations.Count);i.numberDescription=this.$translate.instant("createScheduleFormPriorityDescription"),i.input={num:Math.min.apply(Math,_.map(r.toArray(),function(e){return e.priority})),min:e.ExtractTasks.MIN_PRIORITY,max:e.ExtractTasks.MAX_PRIORITY,isInteger:!0,width:"75px"},t.bodyTemplateUrl="confirmActionDialogInputNumber.html",t.title=this.$translate.instant("tasksSetPriority"),t.actionName=this.$translate.instant("tasksSetPriorityConfirm",{ITEM_COUNT:r.size()},e.L10n.Interpolations.Count),t.action=function(){return n.ExtractTasks.setPriority(r.keys(),i.input.num)}},r.prototype.notificationTranslationIds=function(){return{successId:"extractTasksSetPrioritySuccess",errorId:"extractTasksSetPriorityError"}},r.$inject=["ConfirmActionDialog","ContentActionNotification","$translate","ExtractTasks"],r}(e.AbstractContentAction);e.ChangeExtractTaskPriorityAction=t,e.Module.instance().service("ChangeExtractTaskPriorityAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){
var t=function(){function t(e,t,r,n,i,o){this.$translate=e,this.ConfirmActionDialog=t,this.SearchSuggestionsService=r,this.Subscriptions=n,this.ExtractTasks=i,this.ActionHelpers=o}return t.prototype.createDialogScope=function(e,t,r){var n=e.$new();return n.descriptionTranslateKey=r.descriptionTranslateKey,n.descriptionTranslateValues=r.descriptionTranslateValues,n.filterList={model:null,displayField:"name",suggestions:this.SearchSuggestionsService.schedulesSource(r.scheduledActionType)},n},t.prototype.execute=function(t,r,n){var i=this.createDialogScope(r.scope,t,n),o=function(){return i.filterList.model},s=this.ConfirmActionDialog.open({scope:i,bodyTemplateUrl:"confirmActionDialogFilterListBox.html",title:this.$translate.instant("changeSchedule"),actionName:this.$translate.instant("changeScheduleConfirm",{COUNT:t.size()},e.L10n.Interpolations.Count),action:function(){return n.action(t.keys(),o().id)},confirmDisabled:function(){return!o()}});return s.result.then(this.ActionHelpers.notifyStandardError(t,n.notificationTranslationIds,function(e){return n.errorDetailFn(o())(e)})),s.result.fin(function(){return i.$destroy()}),s.result},t.prototype.setScheduleErrorMessageFor=function(t,r){switch(t.error.code){case e.SchedulingErrorCode.SchedulingScheduleNotFound:return this.$translate.instant("scheduleNotFound",{SCHEDULE:r.name})}return null},t.prototype.forSubscriptions=function(t,r){var n,i,o=this;if(1===t.size()){var s=t.first();i={TARGET_NAME:e.L10n.elideIfLong(s.targetName)},s.targetType===e.SubscriptionTargetTypes.view?n="changeScheduleSubscriptionViewPrompt":s.targetType===e.SubscriptionTargetTypes.workbook&&(n="changeScheduleSubscriptionWorkbookPrompt")}else n="changeScheduleSubscriptionsPrompt",i={COUNT:t.size()};var a={action:function(e,t){return o.Subscriptions.setSchedule(e,t)},notificationTranslationIds:{successId:"changeScheduleSubscriptionsSuccess",errorId:"changeScheduleSubscriptionsError"},errorDetailFn:function(e){return o.subscriptionErrorDetailFactory(e)},scheduledActionType:e.ServerApi.ScheduleActions.Subscription,descriptionTranslateKey:n,descriptionTranslateValues:i};return this.execute(t,r,a)},t.prototype.subscriptionErrorDetailFactory=function(e){var t=this;return function(r){return{itemName:r.item.subject,errorMessage:t.subscriptionErrorMessageFor(r,e)}}},t.prototype.subscriptionErrorMessageFor=function(t,r){switch(t.error.code){case e.CommonErrorCode.SubscriptionNotFound:return this.$translate.instant("subscriptionNotFound",{SUBSCRIPTION_SUBJECT:t.item.subject})}return this.setScheduleErrorMessageFor(t,r)},t.prototype.forExtractTasks=function(t,r){var n,i,o=this;if(1===t.size()){var s=t.first();s.workbook?(n="changeScheduleExtractTasksWorkbookPrompt",i={PARENT_NAME:e.L10n.elideIfLong(s.workbook.name)}):s.datasource&&(n="changeScheduleExtractTasksDatasourcePrompt",i={PARENT_NAME:e.L10n.elideIfLong(s.datasource.name)})}else n="changeScheduleExtractTasksPrompt",i={COUNT:t.size()};var a={action:function(e,t){return o.ExtractTasks.setSchedule(e,t)},notificationTranslationIds:{successId:"changeScheduleExtractTasksSuccess",errorId:"changeScheduleExtractTasksError"},errorDetailFn:function(e){return o.extractTaskErrorDetailFactory(e)},scheduledActionType:e.ServerApi.ScheduleActions.Extract,descriptionTranslateKey:n,descriptionTranslateValues:i};return this.execute(t,r,a)},t.prototype.extractTaskErrorDetailFactory=function(e){var t=this;return function(r){var n=r.item.datasource||r.item.workbook;return{itemName:n.name,errorMessage:t.extractTaskErrorMessageFor(r,e)}}},t.prototype.extractTaskErrorMessageFor=function(t,r){switch(t.error.code){case e.SchedulingErrorCode.SchedulingTaskNotFound:if(t.item.workbook)return this.$translate.instant("extractTaskNotFoundForWorkbook",{WORKBOOK_NAME:e.L10n.elideIfLong(t.item.workbook.name)});if(t.item.datasource)return this.$translate.instant("extractTaskNotFoundForDatasource",{DATASOURCE_NAME:e.L10n.elideIfLong(t.item.datasource.name)})}return this.setScheduleErrorMessageFor(t,r)},t.$inject=["$translate","ConfirmActionDialog","SearchSuggestionsService","Subscriptions","ExtractTasks","ActionHelpers"],t}();e.ChangeScheduleAction=t,e.Module.instance().service("ChangeScheduleAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i){this.ConfirmActionDialog=e,this.ActionHelpers=t,this.ContentUrl=r,this.$translate=n,this.ExtractTasks=i}return t.prototype.executeWithContext=function(t,r){var n,i=this;if(1===t.size()){var o=t.first();o.workbook?n=this.$translate.instant("confirmDeleteExtractWorkbook",{PARENT_NAME:e.L10n.elideIfLong(o.workbook.name)}):o.datasource&&(n=this.$translate.instant("confirmDeleteExtractDatasources",{PARENT_NAME:e.L10n.elideIfLong(o.datasource.name)}))}else n=this.$translate.instant("confirmDeleteExtracts",{ITEM_COUNT:t.size()},e.L10n.Interpolations.Count);return this.ConfirmActionDialog.open({scope:r.scope,title:this.$translate.instant("delete"),bodyText:n,actionName:this.$translate.instant("confirmDeleteButton",{ITEM_COUNT:t.size()},e.L10n.Interpolations.Count),isDeleteAction:!0,action:function(e){return i.ExtractTasks.del(t.keys()).then(i.ActionHelpers.notifyStandardError(t,{successId:"deleteExtractTasksSuccess",errorId:"deleteExtractTasksError"},function(e){var t=e.item.workbook||e.item.datasource;return{itemName:t.name,itemUrl:i.urlFor(e),errorMessage:i.errorMessageFor(e)}}))}}).result},t.prototype.urlFor=function(t){var r;return t.item.workbook&&(r=this.ContentUrl.forItem(t.item.workbook,e.WorkbookContentType)),t.item.datasource&&(r=this.ContentUrl.forItem(t.item.datasource,e.DatasourceContentType)),r},t.prototype.errorMessageFor=function(t){switch(t.error.code){case e.SchedulingErrorCode.SchedulingTaskNotFound:if(t.item.workbook)return this.$translate.instant("errorExtractTaskForWorkbookNotFound",{WORKBOOK_NAME:e.L10n.elideIfLong(t.item.workbook.name),SCHEDULE_NAME:e.L10n.elideIfLong(t.item.schedule.name)});if(t.item.datasource)return this.$translate.instant("errorExtractTaskForDatasourceNotFound",{DATASOURCE_NAME:e.L10n.elideIfLong(t.item.datasource.name),SCHEDULE_NAME:e.L10n.elideIfLong(t.item.schedule.name)})}},t.$inject=["ConfirmActionDialog","ActionHelpers","ContentUrl","$translate","ExtractTasks"],t}();e.DeleteExtractTasksAction=t,e.Module.instance().service("DeleteExtractTasksAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"deleteExtractTasks",{ids:t})}return __extends(t,e),t}(e.Request);e.DeleteExtractTasksRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getExtractTasks",t)}return __extends(t,e),t}(e.Request);e.GetExtractTasksRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"runExtractTasks",{ids:t})}return __extends(t,e),t}(e.Request);e.RunExtractTasksRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t,r){e.call(this,"setExtractTasksPriority",{ids:t,priority:r})}return __extends(t,e),t}(e.Request);e.SetExtractTasksPriorityRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t,r){e.call(this,"setExtractTasksSchedule",{ids:t,scheduleId:r})}return __extends(t,e),t}(e.Request);e.SetExtractTasksScheduleRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(t){function r(r,n){t.call(this,n.getServerResourceFetcher(e.ServerApi.GetExtractTasksRequest,e.ServerApiMapper.extractTasks)),this.ErrorNotifyingServer=r}return __extends(r,t),r.prototype.del=function(t){return this.ErrorNotifyingServer.sendRequests(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.DeleteExtractTasksRequest(t)}),e.ResultHelper.combineResults)},r.prototype.run=function(t){return this.ErrorNotifyingServer.sendRequests(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.RunExtractTasksRequest(t)}),e.ResultHelper.combineResults)},r.prototype.setPriority=function(t,r){return this.ErrorNotifyingServer.sendRequests(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.SetExtractTasksPriorityRequest(t,r)}),e.ResultHelper.combineResults)},r.prototype.setSchedule=function(t,r){return this.ErrorNotifyingServer.sendRequests(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.SetExtractTasksScheduleRequest(t,r)}),e.ResultHelper.combineResults)},r.MAX_PRIORITY=100,r.MIN_PRIORITY=1,r.$inject=["ErrorNotifyingServer","FetcherFactory"],r}(e.Resource);e.ExtractTasks=t,e.Module.instance().service("ExtractTasks",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(t){function r(e,r,n,i){t.call(this,e,r),this.$translate=n,this.ExtractTasks=i}return __extends(r,t),r.prototype.configureDialog=function(t,r){var n=this,i=r.size();if(1===i){var o=r.first();o.datasource?t.bodyText=this.$translate.instant("extractTaskForDataSourceRunPrompt",{DATASOURCE_NAME:e.L10n.elideIfLong(o.datasource.name)}):o.workbook?t.bodyText=this.$translate.instant("extractTaskForWorkbookRunPrompt",{WORKBOOK_NAME:e.L10n.elideIfLong(o.workbook.name)}):t.bodyText=this.$translate.instant("extractTasksRunPrompt",{ITEM_COUNT:i},e.L10n.Interpolations.Count)}else t.bodyText=this.$translate.instant("extractTasksRunPrompt",{ITEM_COUNT:i},e.L10n.Interpolations.Count);t.title=this.$translate.instant("runNow"),t.actionName=this.$translate.instant("runNowConfirmButton",{ITEM_COUNT:i},e.L10n.Interpolations.Count),t.action=function(){return n.ExtractTasks.run(r.keys())}},r.prototype.notificationTranslationIds=function(){return{successId:"extractTasksRunSuccess",errorId:"extractTasksRunError"}},r.$inject=["ConfirmActionDialog","ContentActionNotification","$translate","ExtractTasks"],r}(e.AbstractContentAction);e.RunExtractTasksAction=t,e.Module.instance().service("RunExtractTasksAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"deleteSubscriptions",{ids:t})}return __extends(t,e),t}(e.Request);e.DeleteSubscriptionsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getSubscriptions",t)}return __extends(t,e),t}(e.Request);e.GetSubscriptionsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t,r){e.call(this,"setSubscriptionsSchedule",{ids:t,scheduleId:r})}return __extends(t,e),t}(e.Request);e.SetSubscriptionsScheduleRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t,r){e.call(this,"setSubscriptionSubject",{id:t,subject:r})}return __extends(t,e),t}(e.Request);e.SetSubscriptionSubjectRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(t){function r(r,n){t.call(this,n.getServerResourceFetcher(e.ServerApi.GetSubscriptionsRequest,e.ServerApiMapper.subscriptions)),this.ErrorNotifyingServer=r}return __extends(r,t),r.prototype.del=function(t){return this.ErrorNotifyingServer.sendRequests(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.DeleteSubscriptionsRequest(t)}),e.ResultHelper.combineResults)},r.prototype.setSchedule=function(t,r){return this.ErrorNotifyingServer.sendRequests(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.SetSubscriptionsScheduleRequest(t,r)}),e.ResultHelper.combineResults)},r.prototype.changeSubject=function(t,r){return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.SetSubscriptionSubjectRequest(t,r))},r.$inject=["ErrorNotifyingServer","FetcherFactory"],r}(e.Resource);e.Subscriptions=t,e.Module.instance().service("Subscriptions",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r){var n=this;this.$location=e,this.ExtractTasks=t,this.Subscriptions=r,this.urlParamsFn=function(){return n.$location.search()}}return t.prototype.create=function(r,n){void 0===n&&(n={});var i=new e.Place,o=_.union(t.ExcludeFilterKeys,_.keys(n));return i.addSubplace(e.Subplace.create("extractTasks",e.ExtractTaskContentType,this.ExtractTasks,this.urlParamsFn,_.extend({},n,{siteId:r}),o)),i.addSubplace(e.Subplace.create("subscriptions",e.SubscriptionContentType,this.Subscriptions,this.urlParamsFn,_.extend({},n,{siteId:r}),o)),i},t.ExcludeFilterKeys=[e.ContentFiltersKeys.siteId],t.$inject=["$location","ExtractTasks","Subscriptions"],t}();e.TaskPlace=t,e.Module.instance().service("TaskPlace",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n){e.SubplaceTabsHelper.refreshWhenCurrentTabClicked(t,r),e.SubplaceCountsHelper.keepSubplaceCountsUpdated(t,n)}return t.$inject=["$scope","$state","place"],t}();e.TasksCtrl=t,e.Module.instance().controller("TasksCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n,i,o,s,a,c,l,u,d,p,h,f,m,v,S,g,y){var A=this;this.$q=t,this.$translate=r,this.AngularToReactDataGridBridge=n,this.$filter=i,this.$scope=o,this.$state=s,this.extractTasksContext=l,this.DeleteExtractTasksAction=h,this.RunExtractTasksAction=f,this.ChangeExtractTaskPriorityAction=m,this.ChangeScheduleAction=v,this.ServerService=g,this.HelpService=y,a.setTitle(o.objectName?"refreshSchedule":"extractTasks",o.objectName),this.redirectByExtractsAndRefreshMode(s,l.datasource),this.waitForCountOfSchedules=t.defer(),o.selectedItems=new e.Set(function(e){return e.id});var P=this.createActions(o.selectedItems);o.useReactDataGrid=e.FeatureFlags.reactExtractTasksGrid,e.FeatureFlags.reactExtractTasksGrid&&this.configureForReactDataGrid(P),o.rowClicked=function(e,t){o.anyActionsAllowed()&&d.rowClicked(o.selectedItems,e,t)},o.sorter=p.create(e.ExtractTaskContentType.defaultOrder),this.query=u.createQueryUpdaterFromSubplace(o,c,function(t){e.FeatureFlags.reactExtractTasksGrid&&A.AngularToReactDataGridBridge.updateReactDataGridRowStore({scope:o,sliceable:t}),o.sliceable=t,o.sorter.setOrder(t.getOrder())}),this.refreshExtractTasks(),o.$on(e.SubplaceEvents.Refresh,function(){A.refreshExtractTasks()}),o.availableAction=function(e){return e.isAvailable(o.selectedItems)},e.ActionButtonsHelper.setupActionButtons(o,P),o.listActions=[{name:"new-refresh-task",translate:"newExtractRefresh",isAvailable:function(){return!!A.extractTasksContext.createExtractTaskFn&&A.extractTasksContext.modifyExtractTasksPermission},execute:function(t){o.refreshPropertiesAreEditable()?A.waitForCountOfSchedules.promise.then(function(r){0===r?S.execute(t,l.datasource,!0,r):A.extractTasksContext.createExtractTaskFn(e.ActionContext.fromEvent(t)).then(function(){return A.refreshExtractTasks()})}):A.extractTasksContext.createExtractTaskFn(e.ActionContext.fromEvent(t)).then(function(){return A.refreshExtractTasks()})}}],o.availableListAction=function(e){return e.isAvailable()},o.anyActionsAllowed=function(){return A.anyActionsAllowed()},o.headerClicked=function(e){return o.sorter.setPrimary(e.attrs.key,e.attrs.direction)},o.extractTypeTranslationKey=function(t){switch(t.type){case e.ServerApi.ExtractTaskType.IncrementExtract:return"extractTasksIncremental";case e.ServerApi.ExtractTaskType.RefreshExtract:return"extractTasksFull";default:return null}},o.sliceChanged=function(t){A.waitForCountOfSchedules.resolve(t.total),o.selectedItems.updateItems(t.items),e.SubplaceCountsHelper.updateCountsFromSubplace(o,c,t.total)},o.emptyTemplateModel=this.createEmptyTemplateModel(l),o.showRefreshProperties=function(){return g.featureFlags().dataSyncEnabled&&void 0!==l.datasource},o.currentRefreshLocation=function(){return e.RefreshPropertyHelper.getCurrentRefreshLocation(A.$translate,l.datasource)},o.refreshPropertiesAreEditable=function(){return o.showRefreshProperties()&&l.modifyExtractTasksPermission&&e.RefreshPropertyHelper.canBeRefreshedRemotely(l.datasource)},o.changeRemoteRefreshProperties=function(e){A.waitForCountOfSchedules.promise.then(function(t){S.execute(e,l.datasource,!1,t)})}}return t.prototype.anyActionsAllowed=function(){return this.extractTasksContext.modifyExtractTasksPermission},t.prototype.isServerPage=function(){return this.$state.includes("main.server.**")},t.prototype.showWorkbookOrDatasourceColumn=function(){var e=this.$scope.place;return!("workbook"===e||"datasource"===e)},t.prototype.showScheduleColumn=function(){return!this.$state.includes("**.schedule.**")},t.prototype.showSiteColumn=function(){return this.isServerPage()},t.prototype.redirectByExtractsAndRefreshMode=function(t,r){r&&(r.hasExtracts||t.go("^.connectedWorkbooks"),e.RefreshPropertyHelper.redirectByDatasourceRefreshMode(t,r.refreshMode))},t.prototype.createActions=function(t){var r=this;return[{name:"tasks-run-now",translate:"runNow_action",isAvailable:function(e){return!e.isEmpty()&&r.extractTasksContext.modifyExtractTasksPermission},execute:function(n,i){r.RunExtractTasksAction.execute(n,i).then(function(n){e.ActionHelpers.deselectNotFound(t,n,e.SchedulingErrorCode.SchedulingTaskNotFound),r.refreshExtractTasks()})}},{name:"tasks-change-schedule",translate:"changeSchedule_action",isAvailable:function(e){return!e.isEmpty()&&r.extractTasksContext.modifyExtractTasksPermission},execute:function(n,i){r.ChangeScheduleAction.forExtractTasks(n,i).then(function(n){var i=r.$scope;i.schedule?e.ActionHelpers.deselectAllExceptErrors(t,n,e.SchedulingErrorCode.SchedulingTaskNotFound):e.ActionHelpers.deselectNotFound(t,n,e.SchedulingErrorCode.SchedulingTaskNotFound),r.refreshExtractTasks()})}},{name:"tasks-priority",translate:"tasksSetPriority_action",isAvailable:function(e){return!e.isEmpty()&&r.ServerService.isSessionSiteOrServerAdmin()},execute:function(n,i){r.ChangeExtractTaskPriorityAction.execute(n,i).then(function(n){e.ActionHelpers.deselectNotFound(t,n,e.SchedulingErrorCode.SchedulingTaskNotFound),r.refreshExtractTasks()})}},{name:"tasks-delete",translate:"delete_action",isAvailable:function(e){return!e.isEmpty()&&r.extractTasksContext.modifyExtractTasksPermission},execute:function(n,i){r.DeleteExtractTasksAction.executeWithContext(n,i).then(function(n){e.ActionHelpers.deselectAllExceptErrors(t,n,e.SchedulingErrorCode.SchedulingTaskNotFound),r.refreshExtractTasks()})}}]},t.prototype.refreshExtractTasks=function(){this.waitForCountOfSchedules=this.$q.defer(),this.query.refresh()},t.prototype.createEmptyTemplateModel=function(e){var t={};return t.title="extractTasksEmptyMessage",this.ServerService.featureFlags().dataSyncEnabled&&e.datasource&&(t.help={links:[{localizedValueKey:"remoteRefreshSchedulesEmptyHelp",url:this.HelpService.getDatasourceHelpUrl()}]},e.datasource&&!e.datasource.connectionOAuth&&(t.body=[{statements:[{localizedStatementKey:"remoteRefreshSchedulesEmptyParagraph1"}]}])),t},t.prototype.configureForReactDataGrid=function(e){var t=this,r=new VizPortalReact.SiteUrls({siteUrlName:this.ServerService.sessionSiteUrlName(),queryString:window.location.search}),n=VizPortalReact.ExtractTasksGrid.columns(function(e){return t.$translate.instant(e)},this.$scope,this.anyActionsAllowed(),e,this.isServerPage(),new VizPortalReact.ServerUrls(window.location.search),r,this.$filter("scheduleFrequencyDescription"),this.showWorkbookOrDatasourceColumn(),this.showScheduleColumn(),this.showSiteColumn());this.AngularToReactDataGridBridge.attachReactDataGridToScope(this.$scope,n,this.createEmptyTemplateModel(this.extractTasksContext))},t.$inject=["$q","$translate","AngularToReactDataGridBridge","$filter","$scope","$state","BrowserTitleService","subplace","extractTasksContext","QueryService","SelectionService","SorterFactory","DeleteExtractTasksAction","RunExtractTasksAction","ChangeExtractTaskPriorityAction","ChangeScheduleAction","ChangeDatasourceRemoteRefreshPropertiesAction","ServerService","HelpService"],t}();e.ExtractTasksCtrl=t,e.Module.instance().controller("ExtractTasksCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"createGroup",t)}return __extends(t,e),t}(e.Request);e.CreateGroupRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"deleteGroups",{ids:t})}return __extends(t,e),t}(e.Request);e.DeleteGroupsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){e.LocalGroupDomainName="local",e.GroupKeys=e.NamedItemKeys}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getGroups",t)}return __extends(t,e),t}(e.Request);e.GetGroupsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"updateGroupName",t)}return __extends(t,e),t}(e.Request);e.UpdateGroupNameRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"updateGroupsMinimumSiteRole",t)}return __extends(t,e),t}(e.Request);e.UpdateGroupsMinimumSiteRoleRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(t){function r(r,n){t.call(this,n.getServerResourceFetcher(e.ServerApi.GetGroupsRequest,function(e){return e.groups})),this.ErrorNotifyingServer=r,this.server=r.getServerService()}return __extends(r,t),r.isActiveDirectory=function(t){return t.domainName&&t.domainName!==e.ServerApi.LocalGroupDomainName},r.prototype.createGroup=function(t){var r={name:t};return this.ErrorNotifyingServer.sendRequestAndDelay(new e.ServerApi.CreateGroupRequest(r))},r.prototype.deleteGroups=function(t){return this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.DeleteGroupsRequest(t)}),e.ResultHelper.combineResults)},r.prototype.updateGroupName=function(t,r){var n={groupId:t,name:r};return this.ErrorNotifyingServer.sendRequestAndDelay(new e.ServerApi.UpdateGroupNameRequest(n))},r.prototype.getGroupDetails=function(t){var r={id:t};return this.server.sendRequest(new e.ServerApi.GetGroupDetailsRequest(r))},r.prototype.updateGroupsMinimumSiteRole=function(t,r){return this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.UpdateGroupsMinimumSiteRoleRequest({groupIds:t,minimumSiteRole:r})}),e.ResultHelper.combineResults)},r.$inject=["ErrorNotifyingServer","FetcherFactory"],r}(e.Resource);e.Groups=t,e.Module.instance().service("Groups",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e){this.serverService=e}return t.prototype.optionsForCurrentUser=function(){var r=[e.ServerApi.SiteRoles.Guest];return this.serverService.isSessionServerAdmin()||r.push(e.ServerApi.SiteRoles.ServerAdministrator),_.difference(t.All,r)},t.All=[e.ServerApi.SiteRoles.ServerAdministrator,e.ServerApi.SiteRoles.SiteAdministrator,e.ServerApi.SiteRoles.Publisher,e.ServerApi.SiteRoles.Interactor,e.ServerApi.SiteRoles.Viewer,e.ServerApi.SiteRoles.Unlicensed,e.ServerApi.SiteRoles.ViewerWithPublish,e.ServerApi.SiteRoles.UnlicensedWithPublish,e.ServerApi.SiteRoles.Guest],t.WithoutGuest=_.without(t.All,e.ServerApi.SiteRoles.Guest),t.WithoutGuestOrServerAdmin=_.without(t.All,e.ServerApi.SiteRoles.Guest,e.ServerApi.SiteRoles.ServerAdministrator),t.Mixed="Mixed",t.$inject=["ServerService"],t}();e.SiteRoles=t,e.Module.instance().service("SiteRoles",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getGroup",t)}return __extends(t,e),t}(e.Request);e.GetGroupDetailsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"searchActiveDirectoryGroupName",t)}return __extends(t,e),t}(e.Request);e.SearchActiveDirectoryGroupNameRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"syncActiveDirectoryGroup",t)}return __extends(t,e),t}(e.Request);e.SyncActiveDirectoryGroupRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"syncActiveDirectoryGroups",{groups:t})}return __extends(t,e),t}(e.Request);e.SyncActiveDirectoryGroupsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(e){return{name:e.name,domainName:e.domainName}},r=function(){function r(e){this.ErrorNotifyingServer=e}return r.prototype.searchActiveDirectoryGroupName=function(t){var r=new e.ServerApi.SearchActiveDirectoryGroupNameRequest({name:t});return this.ErrorNotifyingServer.sendRequest(r)},r.prototype.syncAdGroup=function(t,r,n){var i=new e.ServerApi.SyncActiveDirectoryGroupRequest({name:t,domainName:r,siteRole:n});return this.ErrorNotifyingServer.sendRequest(i)},r.prototype.syncAdGroups=function(r){var n=_.map(r,t),i=new e.ServerApi.SyncActiveDirectoryGroupsRequest(n);return this.ErrorNotifyingServer.sendRequest(i)},r.$inject=["ErrorNotifyingServer"],r}();e.ActiveDirectoryGroups=r,e.Module.instance().service("ActiveDirectoryGroups",r)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.SyncGroupEvent={groupSynced:"groupSynced"};var t=function(){function t(e,t,r,n,i,o,s){this.$timeout=e,this.$translate=t,this.$q=r,this.ActiveDirectoryGroups=n,this.ConfirmActionDialog=i,this.longRunningActionService=o,this.toaster=s}return t.prototype.showSyncAdGroupDialog=function(r,n){var i=this,o=n.$new();o.group={model:r};var s=this.$translate.instant("confirmSyncAdGroup",{GROUP_NAME:e.L10n.elideIfLong(r.name)}),a=this.ConfirmActionDialog.open({scope:o,title:this.$translate.instant("synchronize"),bodyText:s,actionName:this.$translate.instant("synchronize"),action:function(){return i.ActiveDirectoryGroups.syncAdGroup(r.name,r.domainName)}});return a.result.then(e.ResultHelper.rejectResultOnError(this.$q)).then(function(t){return i.toaster.pop({type:e.ToastType.Info,text:i.$translate.instant("syncAdGroupSubmitted",{GROUP_NAME:e.L10n.elideIfLong(o.group.model.name)})}),t}).then(this.longRunningActionService.startProgressTrackingForResponse()).then(this.longRunningActionService.delayResultForSolr()).then(this.handleSyncCompleteFor(o,t.Mode.sync)).fail(this.handleSyncErrorResultFor(o,t.Mode.sync)).fin(function(){return o.$destroy()})},t.prototype.showSyncAdGroupsDialog=function(t,r){var n=this,i=_.filter(t,e.Groups.isActiveDirectory);if(0===i.length)return this.ConfirmActionDialog.open({scope:r,title:this.$translate.instant("synchronize"),bodyText:this.$translate.instant("syncAdGroupsNoGroups")}).result;if(1===i.length)return this.showSyncAdGroupDialog(i[0],r);var o=this.ConfirmActionDialog.open({scope:r,title:this.$translate.instant("synchronize"),bodyText:this.$translate.instant("confirmSyncAdGroups",{GROUP_COUNT:i.length},e.L10n.Interpolations.Count),actionName:this.$translate.instant("synchronizeConfirm",{COUNT:i.length},e.L10n.Interpolations.Count),action:function(){var t=n.ActiveDirectoryGroups.syncAdGroups(i);return t.then(e.ResultHelper.rejectResultOnError(n.$q)).then(function(t){var r=n.$translate.instant("syncAdGroupsSubmitted",{GROUP_COUNT:i.length},e.L10n.Interpolations.Count);return n.toaster.pop({type:e.ToastType.Info,text:r}),t}).fail(function(t){var r=n.$translate.instant("syncAdGroupsError",{GROUP_COUNT:i.length},e.L10n.Interpolations.Count);n.toaster.pop({type:e.ToastType.Error,text:r})}),t}});return o.result},t.prototype.showAddAdGroupDialog=function(r){var n=this,i=r.$new();i.group={};var o=this.ConfirmActionDialog.open({scope:i,title:this.$translate.instant("addUsersImportAdGroupTitle"),bodyTemplateUrl:"addActiveDirectoryGroupDialog.html",actionName:this.$translate.instant("addUsersImportAdGroupSubmit"),action:function(){var t=i.group.model,r=i.group.siteRole||e.ServerApi.SiteRoles.Unlicensed;return n.ActiveDirectoryGroups.syncAdGroup(t.name,t.domainName,r)},position:{reserveHeight:450},size:e.ModalSize.fitToContent,confirmDisabled:function(){return!i.group.model||!i.group.siteRole}});return o.result.then(e.ResultHelper.rejectResultOnError(this.$q)).then(function(t){return n.toaster.pop({type:e.ToastType.Info,text:n.$translate.instant("addAdGroupSubmitted",{GROUP_NAME:e.L10n.elideIfLong(i.group.model.name)})}),t}).then(this.longRunningActionService.startProgressTrackingForResponse()).then(this.longRunningActionService.delayResultForSolr()).then(this.handleSyncCompleteFor(i,t.Mode.add)).fail(this.handleSyncErrorResultFor(i,t.Mode.add)).fin(function(){return i.$destroy()})},t.prototype.handleSyncErrorResultFor=function(t,r){var n=this;return function(i){if(i&&i.errors){var o=t.group.model,s={GROUP_NAME:e.L10n.elideIfLong(o.name),DOMAIN_NAME:e.L10n.elideIfLong(o.domainName)};return i.errors[0].code===e.CommonErrorCode.AdGroupNotFound?n.toaster.pop({type:e.ToastType.Error,text:n.$translate.instant("errorActiveDirectoryGroupNotFound",s)}):n.toaster.pop({type:e.ToastType.Error,text:n.$translate.instant(r+"AdGroupError",s)}),i}}},t.prototype.handleSyncCompleteFor=function(t,r){var n=this;return function(i){t.$emit(e.SyncGroupEvent.groupSynced);var o={GROUP_NAME:e.L10n.elideIfLong(t.group.model.name),DOMAIN_NAME:e.L10n.elideIfLong(t.group.model.domainName)},s=[n.$translate.instant(r+"AdGroupSuccess",o),n.$translate.instant("syncAdGroupSuccessSummary",{NUM_ADDED:i.usersAddedToGroup||0,NUM_REMOVED:i.usersRemovedFromGroup||0},e.L10n.Interpolations.Count)];i.usersAddedToSite>0&&s.push(n.$translate.instant("syncAdGroupSuccessNumAddedToSite",{NUM_ADDED:i.usersAddedToSite},e.L10n.Interpolations.Count)),i.usersSiteRoleUpdated>0&&s.push(n.$translate.instant("syncAdGroupSuccessNumSiteRoleUpdated",{NUM_UPDATED:i.usersSiteRoleUpdated},e.L10n.Interpolations.Count)),n.toaster.pop({type:e.ToastType.Info,text:s.join("\n"),timeout:e.ToasterService.NoTimeout});var a=[n.$translate.instant(r+"AdGroupError",o)];return i.usersWithInsufficientLicenses>0&&a.push(n.$translate.instant("syncAdGroupErrorInsufficientLicenses",{COUNT:i.usersWithInsufficientLicenses},e.L10n.Interpolations.Count)),i.usersSkipped>0&&a.push(n.$translate.instant("syncAdGroupErrorNumUsersSkipped",{COUNT:i.usersWithInsufficientLicenses},e.L10n.Interpolations.Count)),a.length>1&&n.toaster.pop({type:e.ToastType.Error,text:a.join("\n")}),i}},t.$inject=["$timeout","$translate","$q","ActiveDirectoryGroups","ConfirmActionDialog","LongRunningActionService","ToasterService"],t.Mode={add:"add",sync:"sync"},t}();e.ActiveDirectoryGroupAction=t,e.Module.instance().service("ActiveDirectoryGroupAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i,o){this.$translate=e,this.$q=t,this.$filter=r,this.Groups=n,this.toaster=i,this.confirmActionDialog=o}return t.prototype.executeInPlace=function(t,r){var n=this,i=e.Set.fromIdItemArray([t]);return this.Groups.updateGroupsMinimumSiteRole([t.id],r).then(e.ResultHelper.rejectResultOnError(this.$q)).then(function(){return n.handleSuccessResult(i,r)}).fail(function(e){return n.handleErrorResult(i,r,e)})},t.prototype.showUpdateGroupsMinimumSiteRoleDialog=function(t,r){var n=this,i=t.filter(e.Groups.isActiveDirectory);if(0===i.size())return this.confirmActionDialog.open({scope:r.scope,title:this.$translate.instant("minimumSiteRole"),bodyText:this.$translate.instant("minimumSiteRoleNoADGroups")}).result;var o=r.scope.$new();o.siteRole=1===i.size()?i.first().minimumSiteRole:e.ServerApi.SiteRoles.Unlicensed,
o.siteRoleOptions=e.SiteRoles.WithoutGuestOrServerAdmin,o.setSiteRole=function(e){o.siteRole=e},o.description=this.$translate.instant("confirmSetGroupsMinimumSiteRoleDesc",{GROUP_NAME:e.L10n.elideIfLong(i.first().name),GROUP_COUNT:i.size()},e.L10n.Interpolations.Count);var s=this.confirmActionDialog.open({title:this.$translate.instant("confirmSetGroupsMinimumSiteRoleTitle"),bodyTemplateUrl:"confirmActionDialogInputRole.html",scope:o,confirmDisabled:function(){return!1},actionName:this.$translate.instant("confirmSetGroupsMinimumSiteRoleButton",{ITEM_COUNT:i.size()},e.L10n.Interpolations.Count),action:function(e){return n.setGroupsSiteRoles(i,o.siteRole)}});return s.result.fin(function(){return o.$destroy()}),s.result},t.prototype.setGroupsSiteRoles=function(t,r){var n=this,i=_.map(t.toArray(),function(e){return e.id});return this.Groups.updateGroupsMinimumSiteRole(i,r).then(e.ResultHelper.rejectResultOnError(this.$q)).then(function(){return n.handleSuccessResult(t,r)}).fail(function(e){return n.handleErrorResult(t,r,e)})},t.prototype.handleSuccessResult=function(t,r){this.toaster.pop({type:e.ToastType.Info,text:this.$translate.instant("updateGroupsMinimumSiteRoleSuccess",{GROUP_NAME:e.L10n.elideIfLong(t.first().name),COUNT:t.size(),SITE_ROLE:this.$filter("siteRole")(r)},e.L10n.Interpolations.Count)})},t.prototype.handleErrorResult=function(t,r,n){return this.toaster.pop({type:e.ToastType.Error,text:this.$translate.instant("updateGroupsMinimumSiteRoleError",{GROUP_NAME:e.L10n.elideIfLong(t.first().name),COUNT:t.size(),SITE_ROLE:this.$filter("siteRole")(r)},e.L10n.Interpolations.Count)}),this.$q.reject(n)},t.$inject=["$translate","$q","$filter","Groups","ToasterService","ConfirmActionDialog"],t}();e.UpdateGroupsMinimumSiteRoleAction=t,e.Module.instance().service("UpdateGroupsMinimumSiteRoleAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(){}return e.toggle=function(t){switch(t){case e.checked:return e.empty;default:return e.checked}},e.checked="checked",e.mixed="mixed",e.empty="empty",e}();e.CheckboxState=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"importExternalUsers",t)}return __extends(t,e),t}(e.Request);e.ImportExternalSiteUsersRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"importThirdPartyUsers",t)}return __extends(t,e),t}(e.Request);e.ImportThirdPartySiteUsersRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t,r){e.call(this,"addUsersToSite",{usernames:t,siteRole:r})}return __extends(t,e),t}(e.Request);e.AddUsersToSiteRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"createLocalUser",t)}return __extends(t,e),t}(e.Request);e.CreateLocalUserRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"deleteUsers",{ids:t})}return __extends(t,e),t}(e.Request);e.DeleteUsersRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(){e.call(this,"getRemainingUserQuota",{})}return __extends(t,e),t}(e.Request);e.GetRemainingUserQuotaRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){e.SiteUserAuthSetting={Saml:"SAML",Default:"DEFAULT"}}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getSiteUsers",t)}return __extends(t,e),t}(e.Request);e.GetSiteUsersRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"importUsersFromActiveDirectory",t)}return __extends(t,e),t}(e.Request);e.ImportSiteUsersFromActiveDirectoryRequest=t;var r=function(e){function t(t){e.call(this,"importServerUsersFromActiveDirectory",t)}return __extends(t,e),t}(e.Request);e.ImportServerUsersFromActiveDirectoryRequest=r}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"updateUsersAdminStatus",t)}return __extends(t,e),t}(e.Request);e.UpdateUsersAdminStatusRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"updateUsersGroupMembership",t)}return __extends(t,e),t}(e.Request);e.UpdateUsersGroupMembershipRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"updateUsersSiteRole",t)}return __extends(t,e),t}(e.Request);e.UpdateUsersSiteRoleRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(t){function r(r,n,i){t.call(this,n.getServerResourceFetcher(e.ServerApi.GetSiteUsersRequest,function(e){return e.users})),this.ErrorNotifyingServer=r,this.$q=i,this.server=r.getServerService()}return __extends(r,t),r.prototype.getUserByUsernameAndDomain=function(t,r){return this.all().addFilter(e.Filter.stringFieldEq("username",t)).addFilter(e.Filter.stringFieldEq("domainName",r)).getFirst()},r.prototype.removeFromGroups=function(t,r){return this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests2(t,r,function(t,r){return new e.ServerApi.UpdateUsersGroupMembershipRequest({userIds:t,addToGroupIds:[],removeFromGroupIds:r})}),e.ResultHelper.combineResults)},r.prototype.getUserCountsBySiteRole=function(t){var r=_.filter(t.getFilters(),function(t){return!(t.field&&t.field===e.ServerApi.FilterFieldNames.siteRole)}),n=t.withFilters(r),i={},o=_.map(e.SiteRoles.WithoutGuest,function(t){return n.addFilter(e.Filter.stringFieldEq(e.ServerApi.FilterFieldNames.siteRole,t)).getCount().then(function(e){i[t]=e})});return o.push(n.getCount().then(function(e){i.Any=e})),this.$q.all(o).then(function(){return i})},r.prototype.addToGroups=function(t,r){return this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests2(t,r,function(t,r){return new e.ServerApi.UpdateUsersGroupMembershipRequest({userIds:t,addToGroupIds:r,removeFromGroupIds:[]})}),e.ResultHelper.combineResults)},r.prototype.updateUsersGroupMembership=function(t,r,n){return this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests3(t,r,n,function(t,r,n){return new e.ServerApi.UpdateUsersGroupMembershipRequest({userIds:t,addToGroupIds:r,removeFromGroupIds:n})}),e.ResultHelper.combineResults)},r.prototype.createLocalUser=function(t,r,n,i,o,s){var a=this;return this.server.sendRequest(new e.ServerApi.GeneratePublicKeyRequest).then(function(c){var l=c.key,u=c.keyId,d=rsa.encrypt(i,l),p=new e.ServerApi.CreateLocalUserRequest({username:t,displayName:r,email:n,encryptedPassword:d,keyId:u,admin:o,siteRole:s});return a.ErrorNotifyingServer.sendRequestAndDelay(p)})},r.prototype.addUsersToSite=function(t,r){return this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.AddUsersToSiteRequest(t,r)}),e.ResultHelper.combineResults)},r.prototype.deleteUsers=function(t){return this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.DeleteUsersRequest(t)}),e.ResultHelper.combineUserResults)},r.prototype.importUsersFromActiveDirectory=function(t,r,n){void 0===n&&(n=!1);var i;return i=n?function(t){return new e.ServerApi.ImportSiteUsersFromActiveDirectoryRequest({usernames:t,admin:!0})}:function(t){return new e.ServerApi.ImportSiteUsersFromActiveDirectoryRequest({usernames:t,siteRole:r})},this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests(t,i),e.ResultHelper.combineUserResults)},r.prototype.importExternalUsers=function(t,r){return this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.ImportExternalSiteUsersRequest({emailAddresses:t,siteRole:r})}),e.ResultHelper.combineImportUserResults)},r.prototype.importThirdPartyUsers=function(t,r){return this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.ImportThirdPartySiteUsersRequest({emailAddresses:t,siteRole:r})}),e.ResultHelper.combineImportUserResults)},r.prototype.updateUsersSiteRole=function(t,r){return this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.UpdateUsersSiteRoleRequest({userIds:t,siteRole:r})}),e.ResultHelper.combineResults)},r.prototype.updateServerAdminStatusAndDelay=function(t,r){return this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.UpdateUsersAdminStatusRequest({userIds:t,admin:r})}),e.ResultHelper.combineResults)},r.prototype.updateServerAdminStatusNoDelay=function(t,r){return this.ErrorNotifyingServer.sendRequests(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.UpdateUsersAdminStatusRequest({userIds:t,admin:r})}),e.ResultHelper.combineResults)},r.prototype.getRemainingUserQuota=function(){return this.server.sendRequest(new e.ServerApi.GetRemainingUserQuotaRequest).then(function(e){return e.usersRemaining})},r.$inject=["ErrorNotifyingServer","FetcherFactory","$q"],r}(e.Resource);e.SiteUsers=t,e.Module.instance().service("SiteUsers",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getUsersGroupMembership",t)}return __extends(t,e),t}(e.Request);e.GetUsersGroupMembershipRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e){this.$q=e}return t.prototype.fromArray=function(t){var r=this;return void 0===t&&(t=[]),{getSlice:function(n,i){var o=t.slice(n,n+i);return r.$q.when(new e.ListResult(o,n,t.length))}}},t.prototype.searchArray=function(e,t){var r,n=this;return function(i){var o,s=function(){var t=_.filter(r,function(t){return e(t,i)});t=_.map(t,_.clone),o=n.fromArray(t)};return s(),{getSlice:function(e,n){return r?o.getSlice(e,n):t.then(function(t){return r=t,s(),o.getSlice(e,n)})}}}},t.$inject=["$q"],t}();e.SliceableFactory=t,e.Module.instance().service("SliceableFactory",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t){this.$translate=e,this.toaster=t}return t.prototype.notify=function(t){var r=this;_.defaults(t,{results:[],errors:[]}),this.notifyErrors(t);var n=_.groupBy(t.errors,"id"),i=this.getUsersByResultMap(t.users,t.results,t.successCode,n);_.each(i,function(n,i){var o=i===t.successCode?e.ToastType.Info:e.ToastType.Error,s=_.unique(n),c=s.length>1?r.multiResultMessageFor(i,s.length):r.resultMessageFor(i,a(s[0],r.$translate));r.toaster.pop({type:o,text:c})})},t.prototype.notifyErrors=function(t){var r=this;_.defaults(t,{errors:[]}),t.errors.length>0&&_.each(t.errors,function(n){var i=t.users.get(n.id),o=i&&a(i,r.$translate)||n.username;_.isFunction(t.showErrorMsgFunc)?t.showErrorMsgFunc(r.errorMessageFor(n,o)):r.toaster.pop({type:e.ToastType.Error,text:r.errorMessageFor(n,o)})})},t.prototype.errorMessageFor=function(t,r){var n=t.code;if(e.LdapErrorCode[n])return this.ldapErrorMessage(t,r);switch(n){case e.UserErrorCode.UserAlreadyExists:return this.$translate.instant("errorUserAlreadyExists",{NEW_ITEM_NAME:e.L10n.elideIfLong(r)});case e.UserErrorCode.UserNotSupportedGuestOperation:return this.$translate.instant("errorUserNotSupportedGuestOperation");case e.UserErrorCode.UserNotSupportedSelfOperation:return this.$translate.instant("errorUserNotSupportedSelfOperation");case e.UserErrorCode.UserInsufficientSiteQuota:return this.$translate.instant("errorUserInsufficientSiteQuota");case e.CommonErrorCode.CallingUserInsufficientPermissions:return this.$translate.instant("errorInsufficientPermision",{USER_NAME:e.L10n.elideIfLong(r)});case e.CommonErrorCode.ADUserNotFound:return this.$translate.instant("errorUserNotFoundInAD",{USER_NAME:e.L10n.elideIfLong(r)});case e.CommonErrorCode.UnexpectedErrorOccurred:return this.$translate.instant("unexpectedErrorOnServer");default:return this.$translate.instant("errorUnknown")}},t.prototype.ldapErrorMessage=function(t,r){var n=t.code;switch(n){case e.LdapErrorCode.LdapServerDown:return this.$translate.instant("errorLdapServerDown",{USER_NAME:e.L10n.elideIfLong(r)});case e.LdapErrorCode.LdapInvalidCredentials:return this.$translate.instant("errorLdapInvalidCredentials",{USER_NAME:e.L10n.elideIfLong(r)});default:return this.$translate.instant("errorUnknownLdapError",{USER_NAME:e.L10n.elideIfLong(r)})}},t.prototype.resultMessageFor=function(t,r){return this.$translate.instant("userActionResult_"+t,{USER_NAME:e.L10n.elideIfLong(r)})},t.prototype.multiResultMessageFor=function(t,r){return this.$translate.instant("userActionBulkOperationResult_"+t,{COUNT:r},e.L10n.Interpolations.Count)},t.prototype.getUsersByResultMap=function(t,r,n,i){var o=this,s=e.Set.fromIdItemArray(r),a={};return t.each(function(e){var t=s.get(e.id),r=t&&s.get(e.id).codes||[];r.length>0?_.each(r,function(t){var r=o.isErrorResult(t)?t.toString():n;a[r]?a[r].push(e):a[r]=[e]}):i[e.id]||(a[n]?a[n].push(e):a[n]=[e])}),a},t.prototype.isErrorResult=function(e){switch(e){case 14:case 15:case 32:case 31:case 42:case 52:return!0;default:return!1}},t.$inject=["$translate","ToasterService"],t}();e.UserActionNotification=t,e.Module.instance().service("UserActionNotification",t);var r=function(){function t(e,t){this.$translate=e,this.toaster=t}return t.prototype.notify=function(t,r,n,i){if(r.errors&&r.errors.length>0){var o=this.errorMessageFor(r.errors[0],n);t(o)}else{var s=this.$translate.instant(i),a=this.$translate.instant("addUserToSiteWithSiteRoleSuccessMsg",{NEW_ITEM_NAME:e.L10n.elideIfLong(n),SITE_ROLE:s});this.toaster.pop({type:e.ToastType.Info,text:a})}},t.prototype.errorMessageFor=function(t,r){switch(t.code){case e.CommonErrorCode.SystemUserNotFound:return this.$translate.instant("errorSystemUserNotFound",{USER_NAME:e.L10n.elideIfLong(r)});case e.UserErrorCode.UserAlreadyExists:return this.$translate.instant("errorUserAlreadyExists",{NEW_ITEM_NAME:e.L10n.elideIfLong(r)});case e.UserErrorCode.UserInsufficientSiteQuota:return this.$translate.instant("errorUserInsufficientSiteQuota");default:return this.$translate.instant("errorUnknown")}},t.$inject=["$translate","ToasterService"],t}();e.AddUserToSiteActionNotification=r,e.Module.instance().service("AddUserToSiteActionNotification",r);var n=function(){function t(e,t,r,n){this.$state=e,this.$filter=t,this.$translate=r,this.contentActionNotification=n}return t.prototype.notify=function(t,r,n){var i=this,o=this.$filter("siteRole")(n),s=c(r,t,this.$translate),a=l(r,t,this.$translate),u=e.MultipleResultNotificationOptions.create(new e.MultipleItemResult(r,t),{describeSuccessSummary:function(t){return i.$translate.instant("updateSiteRoleSuccess",{SUCCESS_COUNT:t,USER_NAME:e.L10n.elideIfLong(s),SITE_ROLE:o},e.L10n.Interpolations.Count)},describeErrorSummary:function(t){return i.$translate.instant("updateSiteRoleError",{ERROR_COUNT:t,USER_NAME:e.L10n.elideIfLong(a),SITE_ROLE:o},e.L10n.Interpolations.Count)},describeErrorDetail:function(e){return{itemName:e.item.username,itemUrl:p(i.$state,e.item),errorMessage:i.errorMessageFor(e,o)}}});this.contentActionNotification.notify(u)},t.prototype.errorMessageFor=function(t,r){switch(t.error.code){case e.UserErrorCode.UserInsufficientLicenses:return this.$translate.instant("errorUserInsufficientLicenses_updateSiteRole",{SITE_ROLE:r});case e.UserErrorCode.UserNotSupportedGuestOperation:return this.$translate.instant("errorUserNotSupportedGuestOperation");case e.UserErrorCode.UserNotSupportedAdminOperation:return this.$translate.instant("errorUserNotSupportedAdminOperation");case e.UserErrorCode.UserNotSupportedSelfOperation:return this.$translate.instant("errorUserNotSupportedSelfOperation");case e.UserErrorCode.UserInsufficientSiteQuota:return this.$translate.instant("errorUserInsufficientSiteQuota");default:return this.$translate.instant("errorUnknown")}},t.$inject=["$state","$filter","$translate","ContentActionNotification"],t}();e.SiteRolesUpdateActionNotification=n,e.Module.instance().service("SiteRolesUpdateActionNotification",n);var i=function(){function t(e,t,r){this.$state=e,this.$translate=t,this.contentActionNotification=r}return t.prototype.notify=function(t,r,n,i,o,s,c,l){var u,d,h=this,f={USER_NAME:e.L10n.elideIfLong(a(i,this.$translate))};o>0?c>0?(u="siteRolesChanged_usersAddedToSitesAndRemovedFromSites",d="siteRolesChanged_usersAddedToSitesAndRemovedFromSites_failed",angular.extend(f,{ADD_COUNT:o,ADD_NAME:e.L10n.elideIfLong(s),REMOVE_COUNT:c,REMOVE_NAME:e.L10n.elideIfLong(l)})):(u="siteRolesChanged_usersAddedToSites",d="siteRolesChanged_usersAddedToSites_failed",angular.extend(f,{ADD_COUNT:o,ADD_NAME:e.L10n.elideIfLong(s)})):(u="siteRolesChanged_usersRemovedFromSites",d="siteRolesChanged_usersRemovedFromSites_failed",angular.extend(f,{REMOVE_COUNT:c,REMOVE_NAME:e.L10n.elideIfLong(l)}));var m=e.MultipleResultNotificationOptions.create(new e.MultipleItemResult(r,t),{describeSuccessSummary:function(t){return angular.extend(f,{USER_COUNT:t}),h.$translate.instant(u,f,e.L10n.Interpolations.Count)},describeErrorSummary:function(t){return angular.extend(f,{USER_COUNT:t}),h.$translate.instant(d,f,e.L10n.Interpolations.Count)},describeErrorDetail:function(e){return{itemName:e.item.username,itemUrl:p(h.$state,e.item),errorMessage:h.errorMessageFor(e)}}});this.contentActionNotification.notify(m)},t.prototype.errorMessageFor=function(t){switch(t.error.code){case e.CommonErrorCode.SystemUserNotFound:return this.$translate.instant("errorSystemUserNotFound",{USER_NAME:e.L10n.elideIfLong(t.item.username)});case e.UserErrorCode.UserInsufficientLicenses:return this.$translate.instant("errorUserInsufficientLicenses");case e.UserErrorCode.UserNotSupportedGuestOperation:return this.$translate.instant("errorUserNotSupportedGuestOperation");case e.UserErrorCode.UserInsufficientSiteQuota:return this.$translate.instant("errorUserInsufficientSiteQuota");default:return this.$translate.instant("errorUnknown")}},t.$inject=["$state","$translate","ContentActionNotification"],t}();e.SiteMembershipUpdateActionNotification=i,e.Module.instance().service("SiteMembershipUpdateActionNotification",i);var o=function(){function t(e,t,r,n){this.$filter=e,this.$state=t,this.$translate=r,this.contentActionNotification=n}return t.prototype.notify=function(t,r,n){var i,o,s=this;n?(i="serverAdminPromotionSuccess",o="serverAdminPromotionFailed"):(i="serverAdminDemotionSuccess",o="serverAdminDemotionFailed");var a=c(r,t,this.$translate),u=l(r,t,this.$translate),d=e.MultipleResultNotificationOptions.create(new e.MultipleItemResult(r,t),{describeSuccessSummary:function(t){var r={USER_COUNT:t,USER_NAME:e.L10n.elideIfLong(a)};return s.$translate.instant(i,r,e.L10n.Interpolations.Count)},describeErrorSummary:function(t){var r={USER_COUNT:t,USER_NAME:e.L10n.elideIfLong(u)};return s.$translate.instant(o,r,e.L10n.Interpolations.Count)},describeErrorDetail:function(e){return{itemName:e.item.username,itemUrl:p(s.$state,e.item),errorMessage:s.errorMessageFor(e)}}});this.contentActionNotification.notify(d)},t.prototype.errorMessageFor=function(t){switch(t.error.code){case e.UserErrorCode.UserInsufficientLicenses:var r=this.$filter("siteRole")(e.ServerApi.SiteRoles.ServerAdministrator);return this.$translate.instant("errorUserInsufficientLicenses_updateSiteRole",{SITE_ROLE:r});case e.CommonErrorCode.CallingUserInsufficientPermissions:return this.$translate.instant("errorCallingUserInsufficientPermissions_serverAdminChange");case e.CommonErrorCode.SystemUserNotFound:return this.$translate.instant("errorSystemUserNotFound",{USER_NAME:e.L10n.elideIfLong(t.item.username)});case e.UserErrorCode.UserNotSupportedGuestOperation:return this.$translate.instant("errorUserNotSupportedGuestOperation");case e.UserErrorCode.UserNotSupportedSelfOperation:return this.$translate.instant("errorUserNotSupportedSelfOperation");case e.UserErrorCode.UserInsufficientSiteQuota:return this.$translate.instant("errorUserInsufficientSiteQuota");default:return this.$translate.instant("errorUnknown")}},t.$inject=["$filter","$state","$translate","ContentActionNotification"],t}();e.ServerAdminUpdateActionNotification=o,e.Module.instance().service("ServerAdminUpdateActionNotification",o);var s=function(){function t(e,t,r){this.$state=e,this.$translate=t,this.contentActionNotification=r}return t.prototype.notify=function(t,r,n,i,o,s){var c,l=this;if(t.errors&&t.errors.length&&t.errors[0].code===e.CommonErrorCode.GroupNotFound)c={errorSummary:this.$translate.instant("errorGroupNotFound",{ITEM_NAME:e.L10n.elideIfLong(i||s)})};else{var u,d,h={USER_NAME:e.L10n.elideIfLong(a(r.first(),this.$translate))};n>0?o>0?(u="groupMembershipChanged_usersAddedToGroupsAndRemovedFromGroups",d="groupMembershipChanged_usersAddedToGroupsAndRemovedFromGroups_failed",angular.extend(h,{ADD_COUNT:n,ADD_NAME:e.L10n.elideIfLong(i),REMOVE_COUNT:o,REMOVE_NAME:e.L10n.elideIfLong(s)})):(u="groupMembershipChanged_usersAddedToGroups",d="groupMembershipChanged_usersAddedToGroups_failed",angular.extend(h,{ADD_COUNT:n,ADD_NAME:e.L10n.elideIfLong(i)})):(u="groupMembershipChanged_usersRemovedFromGroups",d="groupMembershipChanged_usersRemovedFromGroups_failed",angular.extend(h,{REMOVE_COUNT:o,REMOVE_NAME:e.L10n.elideIfLong(s)})),c=e.MultipleResultNotificationOptions.create(new e.MultipleItemResult(r,t),{describeSuccessSummary:function(t){return angular.extend(h,{USER_COUNT:t}),l.$translate.instant(u,h,e.L10n.Interpolations.Count)},describeErrorSummary:function(t){return angular.extend(h,{USER_COUNT:t}),l.$translate.instant(d,h,e.L10n.Interpolations.Count)},describeErrorDetail:function(e){return{itemName:e.item.username,itemUrl:p(l.$state,e.item),errorMessage:l.errorMessageFor(e)}}})}this.contentActionNotification.notify(c)},t.prototype.errorMessageFor=function(t){switch(t.error.code){case e.GroupErrorCode.InvalidGroupMembershipUpdate:return this.$translate.instant("errorInvalidAllUsersGroupMembershipUpdate");case e.CommonErrorCode.SiteUserNotFound:return this.$translate.instant("errorUserNotFound");case e.CommonErrorCode.SystemUserNotFound:return this.$translate.instant("errorSystemUserNotFound",{USER_NAME:e.L10n.elideIfLong(t.item.username)});case e.CommonErrorCode.GroupNotFound:return this.$translate.instant("errorGroupNotFound");default:return this.$translate.instant("errorUnknown")}},t.$inject=["$state","$translate","ContentActionNotification"],t}();e.GroupMembershipUpdateActionNotification=s,e.Module.instance().service("GroupMembershipUpdateActionNotification",s);var a=function(t,r){return r.instant("userActionNameFormattedForToast",{DISPLAY_NAME:e.L10n.elideIfLong(t.displayName),USER_NAME:e.L10n.elideIfLong(t.username)})},c=function(e,t,r){var n=u(e,t);return n?a(n,r):""},l=function(e,t,r){var n=d(e,t);return n?a(n,r):""},u=function(e,t){return e.find(function(e){var r=void 0;return t.errors&&(r=_.find(t.errors,function(t){return e.id===t.id})),!r})},d=function(e,t){return e.find(function(e){var r=void 0;return t.errors&&(r=_.find(t.errors,function(t){return e.id===t.id})),!!r})},p=function(e,t){return"guest"===t.username&&"local"===t.domainName?null:e.href("main.site.user.workbooks",{username:t.username,domainName:t.domainName})}}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.GroupMembershipEvent={MembershipChanged:"MembershipChanged"},e.GroupMembershipDialogFilters={AllGroups:"groupMembershipAllGroups",AssignedGroups:"groupMembershipAssignedGroups",SearchResults:"groupMembershipSearchResults"};var t=function(){function t(r,n,i,o,s,a,c,l,u,d){var p=this;this.$q=r,this.$translate=i,this.groupMembershipUpdateActionNotification=o,this.groups=s,this.SiteUsers=c,this.toaster=l,this.sliceableFactory=d,this.server=a,this.serverState={},this.groupIdToGroup={},this.clientChanges={},this.scope=n,this.scope.busy=!1,this.scope.needsAssignedGroupsRefresh=!1,this.scope.sliceable=s.all().withOrder(t.ListOrder),this.scope.columnWidths={getActual:this.getColumnWidths,getMin:this.getColumnWidths,hasPreferredWidths:function(){return!0}},this.uncheckedAssignedGroups=0,this.scope.groupFilter={selection:e.GroupMembershipDialogFilters.AllGroups},this.scope.lastGroupFilter=this.scope.groupFilter.selection,this.updateGroupFilters(),this.scope.searchInput={text:""};var h=n.users.size()>0?n.users.first().displayName:"";this.scope.editGroupMembershipDescription=i.instant("editGroupMembershipDescription",{USER_COUNT:n.users.size(),USER_NAME:e.L10n.elideIfLong(h)},e.L10n.Interpolations.Count),this.scope.isDirty=function(){return!_.isEmpty(p.clientChanges)},this.scope.applyCancelButtons={applyString:i.instant("save"),cancelString:i.instant("cancel"),apply:function(){return p.apply()},cancel:function(){return p.scope.dismiss()},disableApply:function(){return!p.scope.isDirty()||p.scope.busy},disableCancel:function(){return p.scope.busy},isBusy:function(){return p.scope.busy}},this.scope.isGroupDirty=function(e){return!!p.clientChanges[e.id]},this.scope.checkboxClicked=function(t,r){t.isAllUsersGroup||(p.scope.groupFilter.selection===e.GroupMembershipDialogFilters.AssignedGroups&&(p.scope.clientState[t.id]===e.CheckboxState.empty?p.uncheckedAssignedGroups--:p.scope.clientState[t.id]===e.CheckboxState.checked&&p.uncheckedAssignedGroups++,p.scope.needsAssignedGroupsRefresh=p.uncheckedAssignedGroups>0),p.scope.clientState[t.id]=e.CheckboxState.toggle(p.scope.clientState[t.id]),p.isClientAndServerStateEqualFor(t.id)?delete p.clientChanges[t.id]:(p.clientChanges[t.id]=p.scope.clientState[t.id],p.groupIdToGroup[t.id]=p.clone(t)))},this.scope.submitSearch=function(r,n){r?(p.scope.groupFilter.selection!==e.GroupMembershipDialogFilters.SearchResults&&(p.scope.groupFilter.selection=e.GroupMembershipDialogFilters.SearchResults),p.scope.sliceable=s.all().withFiltersAndOrder([e.Filter.search(r)],t.ListOrder)):p.scope.groupFilter.selection=p.scope.lastGroupFilter,u.isTouch()&&n&&$(n.target).blur()},this.scope.refreshAssignedGroups=function(){p.scope.sliceable=p.getAssignedGroupsList(),p.scope.needsAssignedGroupsRefresh=!1},this.scope.$watch("groupFilter.selection",function(r){p.updateGroupFilters(),r===e.GroupMembershipDialogFilters.AssignedGroups&&p.scope.refreshAssignedGroups(),r===e.GroupMembershipDialogFilters.AllGroups&&(p.scope.sliceable=s.all().withOrder(t.ListOrder)),r!==e.GroupMembershipDialogFilters.SearchResults&&(p.scope.lastGroupFilter=r,p.scope.searchInput.text=""),p.scope.needsAssignedGroupsRefresh=!1}),this.getServerState(this.scope.users)}return t.prototype.getColumnWidths=function(e){var t=[27,278],r=$(".tb-group-membership .tb-data-grid-body-background").width()-t[0]-t[1];return 2===e?r:t[e]},t.prototype.updateGroupFilters=function(){var t=[e.GroupMembershipDialogFilters.AllGroups,e.GroupMembershipDialogFilters.AssignedGroups];this.scope.groupFilter.selection===e.GroupMembershipDialogFilters.SearchResults&&t.push(e.GroupMembershipDialogFilters.SearchResults),this.scope.groupFilters=t},t.prototype.getAssignedGroupsList=function(){var t=this,r=[];return _.each(this.scope.clientState,function(n,i){n!==e.CheckboxState.empty&&r.push(t.groupIdToGroup[i])}),this.uncheckedAssignedGroups=0,this.sliceableFactory.fromArray(r.sort(function(t,r){return t.name.localeCompare(r.name,e.L10n.language)}))},t.prototype.isClientAndServerStateEqualFor=function(t){return this.scope.clientState[t]===this.serverState[t]||this.scope.clientState[t]===e.CheckboxState.empty&&!this.serverState[t]},t.prototype.clone=function(e){return{name:e.name,id:e.id,userCount:e.userCount,isAllUsersGroup:e.isAllUsersGroup,domainName:e.domainName}},t.prototype.getServerState=function(t){var r=this,n=t.keys();n&&n.length>0&&this.server.sendRequest(new e.ServerApi.GetUsersGroupMembershipRequest({userIds:n})).then(function(e){var t=_.countBy(e.members,function(e){return e.groupId});r.serverState={};var n=r.scope.users.size();_.each(t,function(e,t){r.serverState[t]=r.stringForGroupState(e,n)}),r.scope.clientState=_.clone(r.serverState),_.each(r.clientChanges,function(e,t){r.scope.clientState[t]=e}),_.each(e.groups,function(e){r.groupIdToGroup[e.id]=e})})},t.prototype.apply=function(){var t=this,r=_.clone(this.scope.users),n=r.keys(),i={userIds:n,addToGroupIds:[],removeFromGroupIds:[]};return _.each(this.clientChanges,function(t,r){t===e.CheckboxState.checked&&i.addToGroupIds.push(r),t===e.CheckboxState.empty&&i.removeFromGroupIds.push(r)}),this.isValidParamsForUpdate(i)?(this.scope.busy=!0,this.SiteUsers.updateUsersGroupMembership(i.userIds,i.addToGroupIds,i.removeFromGroupIds).then(function(n){var o="";i.addToGroupIds.length>0&&(o=t.groupIdToGroup[i.addToGroupIds[0]].name);var s="";i.removeFromGroupIds.length>0&&(s=t.groupIdToGroup[i.removeFromGroupIds[0]].name),t.groupMembershipUpdateActionNotification.notify(n,r,i.addToGroupIds.length,o,i.removeFromGroupIds.length,s),t.scope.$emit(e.GroupMembershipEvent.MembershipChanged),t.scope.close(n)})):this.$q.when({})},t.prototype.isValidParamsForUpdate=function(e){return e.userIds.length>0&&(e.addToGroupIds.length>0||e.removeFromGroupIds.length>0)},t.prototype.stringForGroupState=function(t,r){return t===r?e.CheckboxState.checked:t>0?e.CheckboxState.mixed:e.CheckboxState.empty},t.$inject=["$q","$scope","$translate","GroupMembershipUpdateActionNotification","Groups","ServerService","SiteUsers","ToasterService","BrowserSupportService","SliceableFactory"],t.ListOrder=[e.Order.asc(e.OrderKeys.name)],t}();e.GroupMembershipDialogCtrl=t,e.Module.instance().controller("GroupMembershipDialogCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e){this.modalService=e}return t.prototype.showEditGroupMembershipDialog=function(t,r){var n=r.scope.$new(!0);n.users=t;var i=this.modalService.open({scope:n,templateUrl:"groupMembershipDialog.html",size:e.ModalSize.fitToContent,controller:e.GroupMembershipDialogCtrl});return i.result.fin(function(){return n.$destroy()})},t.$inject=["ModalService"],t}();e.EditGroupMembershipAction=t,e.Module.instance().service("EditGroupMembershipAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i,o,s){this.$state=e,this.$translate=t,this.ConfirmActionDialog=r,this.userActionNotification=n,this.serverService=i,this.SiteUsers=o,this.toaster=s}return t.prototype.showRemoveUsersFromSiteDialog=function(t,r){var n=this,i=this.$translate.instant("confirmRemoveUsersFromSite",{USER_NAME:e.L10n.elideIfLong(t.first().displayName),USER_COUNT:t.size(),SITE_NAME:e.L10n.elideIfLong(this.serverService.sessionSiteName())},e.L10n.Interpolations.Count),o=this.ConfirmActionDialog.open({scope:r.scope,title:this.$translate.instant("remove"),bodyText:i,actionName:this.$translate.instant("confirmRemoveButton",{ITEM_COUNT:t.size()},e.L10n.Interpolations.Count),action:function(){return n.SiteUsers.deleteUsers(t.keys())},isDeleteAction:!0});return o.result.then(function(e){var r={users:t,results:e.results,errors:e.errors,successCode:"13"};n.userActionNotification.notify(r)}),o.result},t.$inject=["$state","$translate","ConfirmActionDialog","UserActionNotification","ServerService","SiteUsers","ToasterService"],t}();e.RemoveUsersFromSiteAction=t,e.Module.instance().service("RemoveUsersFromSiteAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i,o,s,a,c){this.$translate=e,this.$q=t,this.confirmActionDialog=r,this.serverAdminUpdateActionNotification=n,this.serverService=i,
this.siteRolesUpdateActionNotification=o,this.siteRoles=s,this.siteUsers=a,this.toaster=c}return t.prototype.showSetSiteUsersSiteRoleDialog=function(t,r){var n=this,i=r.scope.$new();i.siteRole=1===t.size()?t.first().siteRole:e.ServerApi.SiteRoles.Unlicensed,i.siteRoleOptions=this.siteRoles.optionsForCurrentUser(),i.setSiteRole=function(e){i.siteRole=e},i.description=this.$translate.instant("confirmSetUsersSiteRoleDesc",{USER_NAME:e.L10n.elideIfLong(t.first().displayName),USER_COUNT:t.size()},e.L10n.Interpolations.Count);var o=this.confirmActionDialog.open({title:this.$translate.instant("confirmSetUsersSiteRoleTitle"),bodyTemplateUrl:"confirmActionDialogInputRole.html",scope:i,confirmDisabled:function(){return!1},actionName:this.$translate.instant("confirmSetUsersSiteRoleButton",{ITEM_COUNT:t.size()},e.L10n.Interpolations.Count),action:function(e){return n.setSiteUsersSiteRoles(t,i.siteRole)}});return o.result.fin(function(){return i.$destroy()}),o.result},t.prototype.setSiteUsersSiteRoles=function(t,r){var n=this,i=t.clone();if(r===e.ServerApi.SiteRoles.ServerAdministrator)return this.makeUsersServerAdmins(i).then(function(e){return e()});var o=function(){},s=i.filter(function(t){return t.siteRole===e.ServerApi.SiteRoles.ServerAdministrator});return this.demoteServerAdminsNoDelay(s).then(function(e){return e.errors&&_.each(e.errors,function(e){i.remove(i.get(e.id))}),o=function(){return n.serverAdminUpdateActionNotification.notify(e,s,!1)},n.updateUsersSiteRole(i,r)}).then(function(e){o(),i.size()>0&&e()})},t.prototype.demoteServerAdminsNoDelay=function(t){if(0===t.size())return this.$q.when({});if(this.serverService.isSessionServerAdmin())return this.siteUsers.updateServerAdminStatusNoDelay(t.keys(),!1);var r={errors:[]};return t.each(function(t){r.errors.push({id:t.id,code:e.CommonErrorCode.CallingUserInsufficientPermissions})}),this.$q.when(r)},t.prototype.updateUsersSiteRole=function(e,t){var r=this;return this.siteUsers.updateUsersSiteRole(e.keys(),t).then(function(n){return function(){return r.siteRolesUpdateActionNotification.notify(n,e,t)}})},t.prototype.makeUsersServerAdmins=function(e){var t=this;return this.siteUsers.updateServerAdminStatusAndDelay(e.keys(),!0).then(function(r){return function(){return t.serverAdminUpdateActionNotification.notify(r,e,!0)}})},t.$inject=["$translate","$q","ConfirmActionDialog","ServerAdminUpdateActionNotification","ServerService","SiteRolesUpdateActionNotification","SiteRoles","SiteUsers","ToasterService"],t}();e.SetSiteUsersSiteRoleAction=t,e.Module.instance().service("SetSiteUsersSiteRoleAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t,r){e.call(this,"updateUserAuthSettings",{userIds:t,authSetting:r})}return __extends(t,e),t}(e.Request);e.UpdateUserAuthSettingsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e){this.modal=e}return e.prototype.showUpdateUserAuthenticationDialog=function(e,t){var n=t.scope.$new();n.siteUsersToUpdate=e;var i=this.modal.open({scope:n,templateUrl:"updateUserAuthenticationDialog.html",controller:r});return i.result.fin(function(){return n.$destroy()}),i.result},e.$inject=["ModalService"],e}();e.UpdateUserAuthenticationAction=t,e.Module.instance().service("UpdateUserAuthenticationAction",t);var r=function(){function t(t,r,n,i){this.$scope=t,this.$translate=r,this.toaster=n,this.server=i,t.defaultDisabled=_.all(t.siteUsersToUpdate.toArray(),function(t){return t.authSetting===e.ServerApi.SiteUserAuthSetting.Default||!t.authSetting}),t.samlDisabled=!i.thirdPartyAuthState().enabled||_.all(t.siteUsersToUpdate.toArray(),function(t){return t.authSetting===e.ServerApi.SiteUserAuthSetting.Saml});var o=function(o){t.busy=!0;var s=t.siteUsersToUpdate.keys();i.sendRequest(new e.ServerApi.UpdateUserAuthSettingsRequest(s,o)).then(function(i){return t.busy=!1,i.errors&&i.errors.length?void n.pop({type:e.ToastType.Error,text:r.instant("unexpectedError")}):void t.close(i)},function(i){t.busy=!1,n.pop({type:e.ToastType.Error,text:r.instant("unexpectedError")})})};t.confirmDefault=function(){return o(e.ServerApi.SiteUserAuthSetting.Default)},t.confirmSAML=function(){return o(e.ServerApi.SiteUserAuthSetting.Saml)}}return t.$inject=["$scope","$translate","ToasterService","ServerService"],t}();e.Module.instance().controller("UpdateUserAuthenticationCtrl",r)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i){this.EditGroupMembershipAction=e,this.RemoveUsersFromSiteAction=t,this.SetSiteUsersSiteRoleAction=r,this.serverService=n,this.UpdateUserAuthenticationAction=i,this.siteUsersActionDefinition=[this.editUsersGroupMembershipAction(),this.setSiteUsersSiteRoleAction(),this.updateUserAuthenticationAction(),this.removeUsersFromSiteAction()]}return t.prototype.getSiteUsersActionsButtons=function(){return this.siteUsersActionDefinition},t.prototype.editUsersGroupMembershipAction=function(){var t=this;return{name:"groupMembership",translate:"groupMembership_action",isAvailable:function(e){return e.size()>0},execute:function(r,n){var i=n.scope;t.EditGroupMembershipAction.showEditGroupMembershipDialog(r,n).then(function(t){t&&(e.ActionHelpers.deselectNotFound(i.selectedItems,t,e.CommonErrorCode.SiteUserNotFound),i.refreshItems())})}}},t.prototype.removeUsersFromSiteAction=function(){var t=this;this.serverService.canSessionUserManageUsers();return{name:"remove",translate:"remove_action",isAvailable:function(e){return t.canRemove(e)},execute:function(r,n){var i=n.scope;t.RemoveUsersFromSiteAction.showRemoveUsersFromSiteDialog(r,n).then(function(t){t&&(e.ActionHelpers.deselectAllExceptErrors(i.selectedItems,t,e.CommonErrorCode.SiteUserNotFound),i.refreshItems())})}}},t.prototype.updateUserAuthenticationAction=function(){var t=this;return{name:"authentication",translate:"authentication_action",isAvailable:function(e){return t.canEditAuthenticationSetting(e)},execute:function(r,n){var i=n.scope;t.UpdateUserAuthenticationAction.showUpdateUserAuthenticationDialog(r,n).then(function(r){e.ActionHelpers.deselectNotFound(i.selectedItems,r,e.CommonErrorCode.SiteUserNotFound),i.refreshItems(),t.serverService.refreshSessionInfo()})}}},t.prototype.canEditAuthenticationSetting=function(e){return!e.isEmpty()&&this.serverService.isThirdPartyAuthEditable()},t.prototype.setSiteUsersSiteRoleAction=function(){var t=this;return{name:"siteRole",translate:"siteRole_action",isAvailable:function(e){return t.canChangeRole(e)},execute:function(r,n){var i=n.scope;t.SetSiteUsersSiteRoleAction.showSetSiteUsersSiteRoleDialog(r,n).then(function(t){e.ActionHelpers.deselectNotFound(i.selectedItems,t,e.CommonErrorCode.SiteUserNotFound),i.refreshItems()})}}},t.prototype.canChangeRole=function(e){return e.size()>0&&!t.isSingleSelectAndGuest(e)&&(!t.areAllSelectedUsersServerAdmins(e)||this.serverService.isSessionServerAdmin())&&this.serverService.canSessionUserManageUsers()},t.prototype.canRemove=function(e){var r=this.serverService.canSessionUserManageUsers();return e.size()>0&&r&&!t.isSingleSelectAndGuest(e)&&(!t.areAllSelectedUsersServerAdmins(e)||this.serverService.isSessionServerAdmin())},t.isSingleSelectAndGuest=function(t){return 1===t.size()&&t.first().siteRole===e.ServerApi.SiteRoles.Guest},t.areAllSelectedUsersServerAdmins=function(t){return _.every(t.toArray(),function(t){return t.siteRole===e.ServerApi.SiteRoles.ServerAdministrator})},t.$inject=["EditGroupMembershipAction","RemoveUsersFromSiteAction","SetSiteUsersSiteRoleAction","ServerService","UpdateUserAuthenticationAction"],t}();e.SiteUsersActions=t,e.Module.instance().service("SiteUsersActions",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.GroupUsersEvent={usersRemoved:"usersRemoved",usersAdded:"usersAdded"};var t=function(){function t(e,t,r,n,i,o,s,a,c,l,u){this.$q=e,this.$translate=t,this.ActiveDirectoryGroupAction=r,this.AddUsersToGroupAction=n,this.CreateGroupDialogAction=i,this.DeleteGroupAction=o,this.UpdateGroupsMinimumSiteRoleAction=s,this.EditGroupMembershipAction=a,this.RemoveUsersFromGroupAction=c,this.SiteUsersActions=l,this.UpdateGroupNameAction=u,this.groupsActionDefinition=[this.syncGroupsAction(),this.updateGroupNameAction(),this.setGroupSiteRoleAction(),this.deleteGroupAction()],this.groupUsersActionDefinition=[this.editUsersGroupMembershipAction(),this.SiteUsersActions.setSiteUsersSiteRoleAction(),this.removeUsersFromGroupAction()],this.allUsersGroupUsersActionDefinition=[this.SiteUsersActions.setSiteUsersSiteRoleAction()]}return t.prototype.getGroupsActionButtons=function(){return this.groupsActionDefinition},t.prototype.getGroupUsersActionButtons=function(e){return e?this.allUsersGroupUsersActionDefinition:this.groupUsersActionDefinition},t.prototype.createGroup=function(e){return this.CreateGroupDialogAction.showCreateGroupDialog(e)},t.prototype.deleteGroup=function(t,r){var n=new e.Set(function(e){return e.id});return n.add(t),this.DeleteGroupAction.showDeleteGroupDialog(n,r)},t.prototype.addUsersToGroup=function(e){return this.AddUsersToGroupAction.showAddUsersToGroupDialog(e)},t.prototype.renameGroup=function(e,t){return this.UpdateGroupNameAction.showUpdateGroupNameDialog(e,t)},t.prototype.syncAdGroup=function(e,t){return this.ActiveDirectoryGroupAction.showSyncAdGroupDialog(e,t.$new(!0))},t.prototype.removeUsersFromGroupAction=function(){var t=this;return{name:"remove",translate:"remove_action",isAvailable:function(e){return e.size()>0},execute:function(r,n){var i=n.scope;t.RemoveUsersFromGroupAction.showRemoveUsersFromGroupDialog(r,i.group).then(function(t){t&&(e.ActionHelpers.deselectAllExceptErrors(i.selectedItems,t,e.CommonErrorCode.SiteUserNotFound),i.refreshItems(),i.$emit(e.GroupUsersEvent.usersRemoved))})}}},t.prototype.editUsersGroupMembershipAction=function(){var t=this;return{name:"groupMembership",translate:"groupMembership_action",isAvailable:function(e){return e.size()>0},execute:function(r,n){var i=n.scope;t.EditGroupMembershipAction.showEditGroupMembershipDialog(r,n).then(function(t){t&&(e.ActionHelpers.deselectAllExceptErrors(i.selectedItems,t,e.CommonErrorCode.SiteUserNotFound),i.refreshItems())})}}},t.prototype.setGroupSiteRoleAction=function(){var t=this;return{name:"siteRole",translate:"minimumSiteRole_action",isAvailable:function(e){return e.size()>0},isDisabled:function(e){return 1===e.size()&&!t.isActiveDirectoryGroup(e.first())},execute:function(r,n){var i=n.scope;t.UpdateGroupsMinimumSiteRoleAction.showUpdateGroupsMinimumSiteRoleDialog(r,n).then(function(t){e.ActionHelpers.deselectNotFound(i.selectedItems,t,e.CommonErrorCode.GroupNotFound),i.refreshItems()})}}},t.prototype.deleteGroupAction=function(){var t=this;return{name:"delete",translate:"delete_action",isAvailable:function(e){return e.size()>0},isDisabled:function(e){return 1===e.size()&&!t.isDeletable(e.first())},execute:function(r,n){var i=n.scope;t.DeleteGroupAction.showDeleteGroupDialog(r,i).then(function(t){t&&(e.ActionHelpers.deselectAllExceptErrors(i.selectedItems,t,e.CommonErrorCode.GroupNotFound),i.refreshItems())})}}},t.prototype.updateGroupNameAction=function(){var t=this;return{name:"rename",translate:"rename_action",isAvailable:function(e){return e.size()>0},isDisabled:function(e){return 1!==e.size()||!t.isRenamable(e.first())},execute:function(r,n){var i=n.scope;t.UpdateGroupNameAction.showUpdateGroupNameDialog(r.first(),i).then(function(t){t&&(e.ActionHelpers.deselectNotFound(i.selectedItems,t,e.CommonErrorCode.GroupNotFound),i.refreshItems())})}}},t.prototype.syncGroupsAction=function(){var t=this;return{name:"synchronize",translate:"synchronize_action",isAvailable:function(e){return e.size()>0},isDisabled:function(e){return 1===e.size()&&!t.isSyncable(e.first())},execute:function(r,n){var i=n.scope;t.ActiveDirectoryGroupAction.showSyncAdGroupsDialog(r.toArray(),n.scope).then(function(t){t&&(e.ActionHelpers.deselectNotFound(i.selectedItems,t,e.CommonErrorCode.GroupNotFound),i.refreshItems())})}}},t.prototype.isDeletable=function(e){return!e.isAllUsersGroup},t.prototype.isRenamable=function(e){return!e.isAllUsersGroup&&!this.isActiveDirectoryGroup(e)},t.prototype.isSyncable=function(e){return!e.isAllUsersGroup&&this.isActiveDirectoryGroup(e)},t.prototype.isActiveDirectoryGroup=function(t){return e.Groups.isActiveDirectory(t)},t.$inject=["$q","$translate","ActiveDirectoryGroupAction","AddUsersToGroupAction","CreateGroupDialogAction","DeleteGroupAction","UpdateGroupsMinimumSiteRoleAction","EditGroupMembershipAction","RemoveUsersFromGroupAction","SiteUsersActions","UpdateGroupNameAction"],t}();e.GroupActions=t,e.Module.instance().service("GroupActions",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n,i,o,s,a,c){var l=this;if(this.$scope=t,this.$state=r,this.groupDetails=o,this.groupActions=s,n.setTitle("details",t.objectName),t.canSessionUserManageUsers=i,this.$scope.groupDetailsModel={domainName:o.domainName,createdAt:o.createdAt,updatedAt:o.updatedAt,isAllUsersGroup:o.isAllUsersGroup,minimumSiteRole:o.minimumSiteRole},this.$scope.isLocalGroup=function(){var e=l.$scope.groupDetailsModel.domainName;return!(e&&"local"!==e)},this.$scope.isAllUsersGroup=function(){return l.$scope.groupDetailsModel.isAllUsersGroup||!1},this.$scope.deleteGroup=function(e){l.groupActions.deleteGroup(o,l.$scope).then(function(){r.go("main.site.groups")})},t.allowMinimumSiteRole=a.isServerDomainFamilyActiveDirectory()&&e.Groups.isActiveDirectory(o),t.allowMinimumSiteRole){t.isEditingMinimumSiteRole=!1,t.siteRoleOptions=e.SiteRoles.WithoutGuestOrServerAdmin,t.editSiteRole=function(){t.isEditingMinimumSiteRole=!0,t.isSavingMinimumSiteRole=!1};var u=function(){t.isEditingMinimumSiteRole=!1,t.groupDetailsModel.minimumSiteRole=o.minimumSiteRole};t.saveSiteRole=function(){t.isSavingMinimumSiteRole=!0;var e=t.groupDetailsModel.minimumSiteRole;c.executeInPlace(o,e).then(function(){o.minimumSiteRole=e,u()}).fin(function(){t.isSavingMinimumSiteRole=!1})},t.cancelSiteRole=u}}return t.$inject=["$scope","$state","BrowserTitleService","canSessionUserManageUsers","groupDetails","GroupActions","ServerService","UpdateGroupsMinimumSiteRoleAction"],t}();e.GroupDetailsCtrl=t,e.Module.instance().controller("GroupDetailsCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n,i,o,s,a){var c=this;this.$scope=t,this.$state=r,this.groupsResource=o,this.groupActions=s,this.serverService=a,t.objectName=i.name,t.group=i,t.$on(e.GroupUsersEvent.usersAdded,function(){c.refreshGroup()}),t.$on(e.GroupUsersEvent.usersRemoved,function(){c.refreshGroup()}),t.$on(e.SyncGroupEvent.groupSynced,function(){c.refreshGroup()}),t.$on(e.GroupMembershipEvent.MembershipChanged,function(){c.refreshGroup()}),t.groupsBreadcrumbUrl=function(){return n.groupsUrl?"#"+n.groupsUrl:c.$state.href("main.site.groups")},t.canRename=function(){return!i.isAllUsersGroup&&!c.isActiveDirectoryGroup(i)},t.rename=function(e){c.groupActions.renameGroup(i,t).then(function(){return c.$state.hardReload()})},t.canSynchronize=function(){return c.serverService.canSessionUserManageUsers()&&!i.isAllUsersGroup&&c.isActiveDirectoryGroup(i)},t.synchronize=function(r){c.groupActions.syncAdGroup(i,c.$scope).then(function(){c.refreshGroup(),t.$broadcast(e.SubplaceEvents.Refresh,"users")})},t.subplaceTabClicked=function(r){"users"===r&&(c.refreshGroup(),t.$broadcast(e.SubplaceEvents.Refresh,r))}}return t.prototype.refreshGroup=function(){var e=this;this.groupsResource.getById(this.$scope.group.id).then(function(t){t?e.$scope.group=t:e.$state.hardReload()})},t.prototype.isActiveDirectoryGroup=function(e){return e.domainName&&"local"!==e.domainName},t.$inject=["$scope","$state","BreadcrumbsService","group","Groups","GroupActions","ServerService"],t}();e.GroupPlaceCtrl=t,e.Module.instance().controller("GroupPlaceCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e){this.modal=e}return t.prototype.showAddGroupsOptionsDialog=function(n){var i=this.modal.open({scope:n.scope,templateUrl:"addGroupsOptionsDialog.html",size:e.ModalSize.fitToContent,position:_.extend(e.ModalService.anchoredTo(n.targetElement),{reserveHeight:t.reserveHeight}),controller:r});return i.result},t.$inject=["ModalService"],t.reserveHeight=450,t}();e.AddGroupsOptionsAction=t,e.Module.instance().service("AddGroupsOptionsAction",t);var r=function(){function e(e,t,r){this.createGroupDialogAction=t,this.activeDirectoryGroupAction=r,e.addLocalGroup=function(){var r=t.showCreateGroupDialog(e.$parent);e.close(r)},e.importAdGroup=function(){r.showAddAdGroupDialog(e.$parent),e.close({})}}return e.$inject=["$scope","CreateGroupDialogAction","ActiveDirectoryGroupAction"],e}();e.AddGroupsOptionsDialogCtrl=r,e.Module.instance().controller("AddGroupsOptionsDialogCtrl",r)}(VizPortal||(VizPortal={}));var VizPortalReact;!function(e){var t=function(t){function r(){t.apply(this,arguments)}return __extends(r,t),r.prototype.render=function(){var t=this,n=this.props.actions,i=this.props.translate,o=this.props.getActionTarget,s=e.Menu.element({ref:"menu",menuButtonFactory:function(e){return r.MenuButton.element(e)},menuPanelFactory:function(e){var r=o(),s=_.map(_.filter(n,function(e){return e.isAvailable(r.items,r.detailedItem,r.allowedActions)}),function(e){var n=e.isDisabled&&e.isDisabled(r.items,r.detailedItem,r.allowedActions);return React.DOM.div({className:"tb-popup-menu-item"+(n?" tb-disabled":""),"data-tb-test-id":"action-"+e.name,onClick:function(){t.refs.menu.closeMenu(),n||e.execute(r.items,r.actionContext,r.detailedItem)}},i(e.translate||e.name))});return React.DOM.div({className:"tb-popup-menu-content tb-padded-small"},s)}});return React.DOM.div({style:{position:"relative"},"data-tb-test-id":this.props.testId},React.DOM.div({style:{marginRight:e.DataGrid.BodyRow.InnerHeight+e.CommonStyles.Sizes.DefaultSpace,overflow:"hidden",textOverflow:"ellipsis"}},this.props.children),React.DOM.div({style:{position:"absolute",right:0,top:0}},s))},r.displayName="ActionsMenuColumnCell",r.element=React.createFactory(r),r}(React.Component);e.ActionsMenuColumnCell=t;var t;!function(e){var t=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.render=function(){var e=this.props.hovered||this.props.menuOpen;return React.DOM.span({className:"tb-action-icon tb-data-grid-action-menu"+(e?" tb-selected":"")})},t.displayName="MenuButton",t.element=React.createFactory(t),t}(React.Component);e.MenuButton=t}(t=e.ActionsMenuColumnCell||(e.ActionsMenuColumnCell={}))}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(){function e(t,r,n){void 0===n&&(n=e.DefaultBlockSize),this.sliceable=t,this.transform=r,this.blockSize=n,this.cachedData=null,this.fetching=[]}return e.prototype.getItems=function(e,t){var r=this;if(e=Math.max(e,0),this.cachedData){if(0===this.cachedData.length)return Q.when(this.cachedData);t=Math.min(t,this.cachedData.length-1)}for(var n=[],i=this.blockSize,o=Math.floor(e/i),s=Math.floor(t/i),a=o;s>=a;a++)this.fetching[a]!==!0&&(this.fetching[a]=!0,n.push(this.fetchBlock(a)));return Q.all(n).then(function(){return r.cachedData})},e.prototype.fetchBlock=function(e){var t=this;return Q(this.sliceable.getSlice(e*this.blockSize,this.blockSize)).then(function(e){var r=_.clone(t.cachedData||[]);r.length=e.total;for(var n=0;n<e.items.length;n++)r[e.index+n]=t.transform(e.items[n]);return t.cachedData=r,r})},e.DefaultBlockSize=1e3,e}();e.SparseCachedList=t}(VizPortalReact||(VizPortalReact={}));var VizPortal;!function(e){var t=function(){function t(r,n,i,o,s,a,c,l,u,d,p,h,f,m,v){var S=this;this.$scope=n,this.$translate=i,this.AngularToReactDataGridBridge=o,this.groups=c,this.groupActions=l,this.addGroupsOptionsAction=u,this.queryService=d,this.ServerService=f,this.AngularContextFactory=m,this.filterPanelService=v;var g=this.ServerService.isServerDomainFamilyActiveDirectory(),y=this.ServerService.canSessionUserManageUsers(),A=g;n.reactDataGridInGroupsPlace=e.FeatureFlags.reactDataGridInGroupsPlace,a.setTitle("groups"),n.model={itemsCount:0},n.selectedItems=new e.Set(function(e){return e.id}),e.FeatureFlags.reactDataGridInGroupsPlace&&this.configureForReactDataGrid(A),n.rowClicked=function(e,t){p.rowClicked(n.selectedItems,e,t)},n.filterControls={},n.filterDefinitions=A?v.getFilterDefinitions(["groupsMinimumSiteRole"]):[],n.sorter=h.create(e.GroupContentType.defaultOrder);var P=this.createQueryUpdater();n.sliceChanged=function(e){n.selectedItems.updateItems(e.items),n.model.itemsCount=e.total},n.refreshItems=function(){P.refresh()},n.refreshItems(),n.placeTitleClicked=function(){n.refreshItems()},n.$on(e.SyncGroupEvent.groupSynced,n.refreshItems),n.headerClicked=function(e){return n.sorter.setPrimary(e.attrs.key,e.attrs.direction)},n.getDomainString=function(e){return e.domainName||i.instant("localDomain")},n.isAD=g,n.availableAction=function(e){return e.isAvailable(n.selectedItems)},e.ActionButtonsHelper.setupActionButtons(n,l.getGroupsActionButtons()),n.listActions=[{name:"add-groups",translate:"addGroups",isAvailable:function(){return g&&y},execute:function(t){u.showAddGroupsOptionsDialog(e.ActionContext.fromEvent(t)).then(function(e){n.refreshItems()})}},{name:"create-group",translate:"createGroup",isAvailable:function(){return!(g&&y)},execute:function(e){S.groupActions.createGroup(n).then(function(e){n.refreshItems()})}}],n.availableListAction=function(e){return e.isAvailable()},s.rememberGroupsUrl(r.url()),n.$on("$locationChangeSuccess",function(){var e=r.path();/^(\/site\/[^\/]+)?\/groups(\/)?$/.test(e)&&s.rememberGroupsUrl(r.url())}),n.emptyTemplateModel=t.emptyTemplateModel,n.showMinimumSiteRole=A}return t.prototype.configureForReactDataGrid=function(e){var r=this.dataGridColumns(this.$scope,e);this.AngularToReactDataGridBridge.attachReactDataGridToScope(this.$scope,r,t.emptyTemplateModel)},t.prototype.createQueryUpdater=function(){var t=this;return e.FeatureFlags.reactDataGridInGroupsPlace?this.queryService.createQueryUpdater(this.$scope,e.GroupContentType,this.groups,function(e){t.AngularToReactDataGridBridge.updateReactDataGridRowStore({scope:t.$scope,sliceable:e}),t.$scope.sliceable=e,t.$scope.sorter.setOrder(e.getOrder()),e.getCount().then(function(e){t.$scope.model.itemsCount=e})},{}):this.queryService.createQueryUpdater(this.$scope,e.GroupContentType,this.groups,function(e){t.$scope.sliceable=e,e.getCount().then(function(e){t.$scope.model.itemsCount=e})},{})},t.prototype.dataGridColumns=function(e,t){var r={name:"name-col",dataKey:"name",text:this.$translate.instant("column_name"),direction:"asc",cellFormatter:this.groupNameCellFormatter(e),cellStyle:{paddingRight:0,verticalAlign:"top",overflow:"visible"}},n=[VizPortalReact.CommonDataGridColumns.selected(e),r];return this.ServerService.isServerDomainFamilyActiveDirectory()&&n.push({name:"domain-name-col",dataKey:"domainName",direction:"asc",text:this.$translate.instant("column_domainName")}),n.push({name:"user-count-col",dataKey:"userCount",text:this.$translate.instant("column_userCount"),direction:"asc",cellFormatter:VizPortalReact.DataGridCells.LocalizedCount("userCount"),headerStyle:{textAlign:"right"},cellStyle:{textAlign:"right"}}),t&&n.push({name:"min-site-role-col",dataKey:"minimumSiteRole",text:this.$translate.instant("column_minimumSiteRole"),cellFormatter:VizPortalReact.DataGridCells.SiteRoleCell("minimumSiteRole",this.$translate),direction:"asc"}),n},t.prototype.groupNameCellFormatter=function(e){var t=new VizPortalReact.SiteUrls({siteUrlName:this.ServerService.sessionSiteUrlName(),queryString:window.location.search}),r=this.groupActions.getGroupsActionButtons(),n=this.$translate;return React.createFactory(React.createClass({render:function(){return VizPortalReact.ActionsMenuColumnCell.element({actions:r,getActionTarget:function(){return{items:e.selectedItems,actionContext:{scope:e}}},translate:function(e){return n.instant(e)}},React.DOM.span({className:"tb-grid-icon-group"}),React.DOM.a({href:t.group(this.props.row.data.id)},this.props.value))}}))},t.$inject=["$location","$scope","$translate","AngularToReactDataGridBridge","BreadcrumbsService","BrowserTitleService","Groups","GroupActions","AddGroupsOptionsAction","QueryService","SelectionService","SorterFactory","ServerService","AngularContextFactory","FilterPanelService"],t.emptyTemplateModel={title:"groupsEmptyMessage"},t}();e.GroupsPlaceCtrl=t,e.Module.instance().controller("GroupsPlaceCtrl",t)}(VizPortal||(VizPortal={}));var VizPortalReact;!function(e){var t;!function(t){function r(t,r,i,o,s){var a=[e.CommonDataGridColumns.selected(r),n(t,i,s,r),{name:"username-col",dataKey:"username",text:t("column_username"),direction:"asc"},{name:"siteRole-col",dataKey:"siteRole",text:t("column_site_role"),direction:"asc",cellFormatter:e.DataGridCells.PlainTextCellWithTransform("siteRole",function(e){return o(e)})},{name:"lastSignIn-col",dataKey:"lastSignIn",text:t("column_last_sign_in"),direction:"desc",cellFormatter:e.DataGridCells.DateTimeCell("lastSignIn")}];return a}function n(t,r,n,i){var o={color:e.CommonStyles.Colors.Grey102,textDecoration:"none",pointerEvents:"none"},s=function(e){var t=e.data;return t.readOnly||"Guest"===t.siteRole};return e.CommonDataGridColumns.withActions({name:"displayName-col",dataKey:"displayName",text:t("column_fullName"),direction:"asc",cellFormatter:e.DataGridCells.Link(function(e){var n=s(e),i=e.data;return{text:i.displayName,url:n?null:r.userContentUrl(i),style:n?o:null,iconClassName:"tb-grid-icon-user",iconTitle:t("user")}})},{actions:n,getActionTarget:function(){return{items:i.selectedItems,actionContext:{scope:i}}},translate:t,scope:i,menuDisabled:s})}t.columns=r}(t=e.GroupUsersGrid||(e.GroupUsersGrid={}))}(VizPortalReact||(VizPortalReact={}));var VizPortal;!function(e){var t=function(){function t(r,n,i,o,s,a,c,l,u,d,p,h){var f=this;this.$scope=r,this.$translate=n,this.AngularToReactDataGridBridge=i,this.siteRoleFilter=o,this.ServerService=s;var m=h.getGroupUsersActionButtons(u.isAllUsersGroup);e.FeatureFlags.reactGroupUsersGrid&&this.configureForReactDataGrid(m),a.setTitle("members",u.name),r.group=u,r.selectedItems=new e.Set(function(e){return e.id}),r.rowClicked=function(e,t){p.rowClicked(r.selectedItems,e,t)};var v=d.createQueryUpdater(r,e.GroupUserContentType,l,function(t){e.FeatureFlags.reactGroupUsersGrid&&f.AngularToReactDataGridBridge.updateReactDataGridRowStore({scope:r,sliceable:t}),r.sliceable=t},{inGroup:u.id});r.refreshItems=function(){v.refresh()},r.refreshItems(),r.$on(e.SubplaceEvents.Refresh,function(){r.refreshItems()}),r.sorter=c.create(e.GroupUserContentType.defaultOrder),r.headerClicked=function(e){return r.sorter.setPrimary(e.attrs.key,e.attrs.direction)},r.availableAction=function(e){return e.isAvailable(r.selectedItems)},e.ActionButtonsHelper.setupActionButtons(r,m),r.listActions=[{name:"add-users-to-group",translate:"addUsers",isAvailable:function(){return!u.isAllUsersGroup},execute:function(t){h.addUsersToGroup(u).then(function(){r.refreshItems(),r.$emit(e.GroupUsersEvent.usersAdded)})}}],r.availableListAction=function(e){return e.isAvailable()},r.emptyTemplateModel=t.emptyTemplateModel}return t.prototype.configureForReactDataGrid=function(e){var r=this;this.$scope.useReactDataGrid=!0;var n=new VizPortalReact.SiteUrls({siteUrlName:this.ServerService.sessionSiteUrlName(),queryString:window.location.search}),i=VizPortalReact.GroupUsersGrid.columns(function(e){return r.$translate.instant(e)},this.$scope,n,this.siteRoleFilter,e);this.AngularToReactDataGridBridge.attachReactDataGridToScope(this.$scope,i,t.emptyTemplateModel)},t.$inject=["$scope","$translate","AngularToReactDataGridBridge","siteRoleFilter","ServerService","BrowserTitleService","SorterFactory","SiteUsers","group","QueryService","SelectionService","GroupActions"],t.emptyTemplateModel={title:"usersEmptyMessage"},t}();e.GroupUsersSubplaceCtrl=t,e.Module.instance().controller("GroupUsersSubplaceCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"addFavorite",t)}return __extends(t,e),t}(e.Request);e.AddFavoriteRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getFavorites",t)}return __extends(t,e),t}(e.Request);e.GetFavoritesRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"removeFavorite",t)}return __extends(t,e),t}(e.Request);e.RemoveFavoriteRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(){}return e.VIEW="view",e.WORKBOOK="workbook",e}();e.FavoriteObjectType=t;var r=function(r){function n(t,n){r.call(this,n.getServerResourceFetcher(e.ServerApi.GetFavoritesRequest,function(e){return e.favorites})),this.server=t}return __extends(n,r),n.prototype.addView=function(e){return this.add(e.id,t.VIEW)},n.prototype.addWorkbook=function(e){return this.add(e.id,t.WORKBOOK)},n.prototype.removeView=function(e){return this.remove(e.id,t.VIEW)},n.prototype.removeViewById=function(e){return this.remove(e,t.VIEW)},n.prototype.removeWorkbook=function(e){return this.remove(e.id,t.WORKBOOK)},n.prototype.removeWorkbookById=function(e){return this.remove(e,t.WORKBOOK)},n.prototype.add=function(t,r){return this.server.sendRequest(new e.ServerApi.AddFavoriteRequest({objectId:t,objectType:r}))},n.prototype.remove=function(t,r){return this.server.sendRequest(new e.ServerApi.RemoveFavoriteRequest({objectId:t,objectType:r}))},n.$inject=["ServerService","FetcherFactory"],n}(e.Resource);e.Favorites=r,e.Module.instance().service("Favorites",r)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t,r){e.call(this,"addTagsToViews",{ids:t,tags:r})}return __extends(t,e),t}(e.Request);e.AddTagsToViewsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getFieldValues",t)}return __extends(t,e),t}(e.Request);e.GetFieldValuesRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getViewActions",{id:t})}return __extends(t,e),t}(e.Request);e.GetViewActionsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getViewByPath",{path:t})}return __extends(t,e),t}(e.Request);e.GetViewByPathRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"hideViews",{ids:t})}return __extends(t,e),t}(e.Request);e.HideViewsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){var r=function(t){function r(r,n){var i=_.map(n,function(t){return e.TagsHelper.quote(t)});t.call(this,"removeTagsFromViews",{ids:r,tags:i})}return __extends(r,t),r}(t.Request);t.RemoveTagsFromViewsRequest=r}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n){this.$q=t,this.ErrorNotifyingServer=r,this.server=r.getServerService(),this.listFetcher=n.getServerResourceFetcher(e.ServerApi.GetViewsRequest,e.ServerApiMapper.views),this.allQuery=new e.ResourceQuery(this.listFetcher),this.detailFetcher=n.getServerDetailFetcher("getView",e.ViewMapper.mapDetail),this.fieldValuesFetcher=n.getServerResourceFetcher(e.ServerApi.GetFieldValuesRequest,e.ServerApiMapper.fieldValues)}return t.prototype.all=function(){return this.allQuery},t.prototype.getById=function(e){return this.detailFetcher.fetchById(e)},t.prototype.getByPath=function(t){var r=this;return this.server.sendRequest(new e.ServerApi.GetViewByPathRequest(t)).then(function(t){
var n=t.errors&&t.errors[0]&&t.errors[0].code;return n?r.$q.reject(n):r.$q.when(e.ViewMapper.mapDetail(t))})},t.prototype.valuesForField=function(t){return new e.FieldValuesQuery(this.fieldValuesFetcher,t,e.ServerApi.FieldValueResourceType.view)},t.prototype.actions=function(t){return this.server.sendRequest(new e.ServerApi.GetViewActionsRequest(t))},t.prototype.hide=function(t){return this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.HideViewsRequest(t)}),e.ResultHelper.combineResults)},t.prototype.addTags=function(t,r){return r.length>0?this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests2(t,r,function(t,r){return new e.ServerApi.AddTagsToViewsRequest(t,r)}),e.ResultHelper.combineResults):this.$q.when({})},t.prototype.removeTags=function(t,r){return r.length>0?this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests2(t,r,function(t,r){return new e.ServerApi.RemoveTagsFromViewsRequest(t,r)}),e.ResultHelper.combineResults):this.$q.when({})},t.prototype.changeTags=function(t,r,n){var i=this;return this.removeTags(t,n).then(function(n){return e.ResultHelper.hasErrors(n)?n:i.addTags(t,r)})},t.prototype.markRecentlyViewed=function(t){return this.server.sendRequest(new e.ServerApi.MarkRecentlyViewedRequest({objectId:t,objectType:e.ServerApi.RecentlyViewedObjectType.View}))},t.$inject=["$q","ErrorNotifyingServer","FetcherFactory"],t}();e.Views=t,e.Module.instance().service("Views",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(r,n,i,o,s){r.favoriteViews=[],o.all().withFiltersAndOrder([e.Filter.fieldEq(e.ServerApi.FilterFieldNames.isFavorite,!0)],[e.Order.asc(e.ServerApi.NamedItemKeys.name)]).getSlice(0,t.ItemsPerSection).then(function(e){r.favoriteViews=e.items||[]}),r.favoriteWorkbooks=[],s.all().withFiltersAndOrder([e.Filter.fieldEq(e.ServerApi.FilterFieldNames.isFavorite,!0)],[e.Order.asc(e.ServerApi.NamedItemKeys.name)]).getSlice(0,t.ItemsPerSection).then(function(e){r.favoriteWorkbooks=e.items||[]}),r.recentViews=[],o.all().withFiltersAndOrder([e.Filter.fieldEq(e.ServerApi.FilterFieldNames.isRecent,!0)],[e.Order.asc(e.ServerApi.NamedItemKeys.name)]).getSlice(0,t.ItemsPerSection).then(function(e){r.recentViews=e.items||[]}),r.recentWorkbooks=[],s.all().withFiltersAndOrder([e.Filter.fieldEq(e.ServerApi.FilterFieldNames.isRecent,!0)],[e.Order.asc(e.ServerApi.NamedItemKeys.name)]).getSlice(0,t.ItemsPerSection).then(function(e){r.recentWorkbooks=e.items||[]}),r.updatedWorkbooks=[],s.all().withFiltersAndOrder([],[{field:e.OrderKeys.updatedAt,ascending:!1}]).getSlice(0,t.ItemsPerSection).then(function(e){r.updatedWorkbooks=e.items||[]}),r.viewUrl=function(e){return n.href("main.site.viz",{path:e.path})},r.workbookUrl=function(e){return n.href("main.site.content.workbook.views",{id:e.id})},r.recentViewsUrl=function(){return n.href("main.site.content.site.views")+"?recent=true"},r.recentWorkbooksUrl=function(){return n.href("main.site.content.site.workbooks")+"?recent=true"},r.favoriteViewsUrl=function(){return n.href("main.site.content.site.views")+"?favorite=true"},r.favoriteWorkbooksUrl=function(){return n.href("main.site.content.site.workbooks")+"?favorite=true"},r.updatedWorkbooksUrl=function(){return n.href("main.site.content.site.workbooks")+"?order=updatedAt:desc"},r.addViewFavorite=function(e){return i.addView(e)},r.removeViewFavorite=function(e){return i.removeView(e)},r.addWorkbookFavorite=function(e){return i.addWorkbook(e)},r.removeWorkbookFavorite=function(e){return i.removeWorkbook(e)},r.getItemDetails=function(e){var t=e,r=e;return r.numSheets?s.getById(r.id):o.getById(t.id)},r.scrollLeft=function(e){var t=$(".tb-home-section-"+e);t.scrollLeft(t.scrollLeft()-t.width())},r.scrollRight=function(e){var t=$(".tb-home-section-"+e);t.scrollLeft(t.scrollLeft()+t.width())},r.showScrollControls=function(e){var t=$(".tb-home-section-"+e),r=t.find(".tb-home-section-items-content");return t.width()<r.width()},r.canScrollLeft=function(e){var t=$(".tb-home-section-"+e);return t.scrollLeft()>0},r.canScrollRight=function(e){var t=$(".tb-home-section-"+e),r=t.find(".tb-home-section-items-content");return t.scrollLeft()+t.width()<r.width()}}return t.ItemsPerSection=12,t.$inject=["$scope","$state","Favorites","Views","Workbooks"],t}();e.HomeCtrl=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n){t.formData={username:"",password:"",confirmPassword:"",displayName:""},t.isActiveDirectory=function(){return n.isServerDomainFamilyActiveDirectory()},t.isLocal=function(){return n.isServerDomainFamilyLocal()},t.passwordFieldsAreNonEmpty=function(){return!t.isActiveDirectory()&&t.formData.password&&t.formData.confirmPassword&&t.formData.password.length>0&&t.formData.confirmPassword.length>0},t.maybeInitialize=function(){t.initializationForm.$valid?(t.busy=!0,n.initialize(t.formData.username,t.formData.password,t.formData.displayName).then(function(){t.result="success",r.go("main.site.content.site.projects",{siteUrlName:""})}).fail(function(r){switch(t.result="failure",t.busy=!1,r){case e.UserErrorCode.UserInsufficientLicenses:t.errorMessageKey="signInFailedUnlicensedServer";break;default:t.errorMessageKey="initializationFailed"}})):t.result="invalidForm"}}return t.$inject=["$scope","$state","ServerService"],t}();e.InitializationCtrl=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){void 0===t&&(t={}),e.call(this,"getLicensingInfo",t)}return __extends(t,e),t}(e.Request);e.GetLicensingInfoRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e){this.server=e}return t.prototype.fetch=function(){return this.server.sendRequest(new e.ServerApi.GetLicensingInfoRequest).then(function(e){if(e.isCore===!0){var t=_.reduce(e.coreLicensingInfos,function(e,t){return e+t.numLicensedCores},0),r=e.totalCoreLicenses-t;return _.extend(e,{totalLicensedCores:t,totalCoreLicensesAvailable:r})}if(e.isCore===!1){var n=e.seatLicensingInfo.numRemainingSeats+e.seatLicensingInfo.numLicensedUsers;return _.extend(e,{totalSeatLicenses:n})}})},t.$inject=["ServerService"],t}();e.LicensesService=t,e.Module.instance().service("LicensesService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(r,n,i,o){i.setTitle("serverSettings_licenses"),r.licensingInfo=o,r.isEmpty=!o.productKeyInfos||!o.productKeyInfos.length,r.formatExpirationDate=function(r){return!r||t.TrialRegExp.test(r)?"":t.PermanentRegExp.test(r)?n.instant("never"):e.L10n.localizedDate(r)}}return t.PermanentRegExp=/permanent/i,t.TrialRegExp=/trial/i,t.$inject=["$scope","$translate","BrowserTitleService","licensingInfo"],t}();e.LicensesCtrl=t,e.Module.instance().controller("LicensesCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t){this.server=e,this.$translate=t}return t.prototype.getSignInErrorMessages=function(t){var r=this,n=this.server.authenticationType()===e.ServerApi.AuthenticationType.ClientCertificateWithFallback,i=[];switch(t){case e.CommonErrorCode.SiteNotFound:case e.CommonErrorCode.SiteUserNotFound:i.push("signInFailedSiteNotFound"),i.push("contactServerAdmin");break;case e.CommonErrorCode.SystemUserNotFound:case e.UserErrorCode.UserOpenIdUserNotFound:i.push("errorUserNotFound"),i.push("contactServerAdmin");break;case e.UserErrorCode.UserOpenIdConflictingUserAccount:i.push("conflictingUserAccount"),i.push("contactServerAdmin");break;case e.SiteSwitchErrorCodes.UserUnlicensedForSite:i.push("signInFailedUserUnlicensedForSite"),i.push("contactServerAdmin");break;case e.SiteSwitchErrorCodes.SiteLocked:i.push("signInFailedSiteLocked"),i.push("contactServerAdmin");break;case e.SiteSwitchErrorCodes.SiteSuspended:i.push("signInFailedSiteSuspended"),i.push("contactServerAdmin");break;case e.LoginErrorCodes.ClientCertificateNotFound:i.push("signinFailedClientCertificateNotFound"),i.push(n?"signInUsingTableauServerCredentialsOption":"contactServerAdmin");break;case e.LoginErrorCodes.ClientCertificateUserNotFoundInCertificate:i.push("signinFailedClientCertificateUserNotFoundInCertificate"),i.push(n?"signInUsingTableauServerCredentialsOption":"contactServerAdmin");break;case e.LoginErrorCodes.ClientCertificateUserNotFoundOnServer:i.push("signinFailedClientCertificateUserNotFoundOnServer"),i.push(n?"signInUsingTableauServerCredentialsOption":"contactServerAdmin");break;case e.LoginErrorCodes.KerberosFailed:case e.LoginErrorCodes.SspiFailed:i.push("signInFailedAutoSignin"),i.push("signInUsingTableauServerCredentials");break;case e.LoginErrorCodes.BadCredentials:i.push("signInFailedBadCredentials");break;case e.CommonErrorCode.InvalidSession:i.push("sessionExpired");break;case e.CommonErrorCode.UnlicensedServer:i.push("signInFailedUnlicensedServer"),i.push("contactServerAdmin");break;case e.UserErrorCode.UserOpenIdIdpNotReachable:i.push("cannotReachOpenIdIdp"),i.push("contactServerAdmin");break;case e.UserErrorCode.UserOpenIdBadConfig:i.push("openIdBadConfig"),i.push("contactServerAdmin");break;case e.LoginErrorCodes.OpenIdFailed:i.push("signInFailedUnknownReason"),i.push("contactServerAdmin");break;default:i.push("signInFailedUnknownReason")}return _.map(i,function(e){return r.$translate.instant(e)})},t.$inject=["ServerService","$translate"],t}();e.ErrorMessageHandler=t,e.Module.instance().service("ErrorMessageHandler",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n){this.$stateParams=e,this.$location=t,this.serverService=r,this.windowLocationService=n}return t.prototype.getLoginUrl=function(){return this.serverService.isAuthenticationSaml()?t.SamlLoginUrl:this.serverService.isAuthenticationOpenId()?t.OpenIdLoginUrl:""},t.prototype.login=function(){if(!this.serverService.isAuthenticationExternal())throw new Error("This server doesn't use external authentication");var t,r=Helpers.BooleanQueryParamRegex.test(this.$location.search()[e.UrlParamKeys.ClosePopupWhenDone]);t=this.$stateParams.externalRedirect?this.$stateParams.externalRedirect:this.$stateParams.redirect?this.windowLocationService.getPathQuery()+"#"+this.$stateParams.redirect:r?"/"+this.serverService.serverLanguage()+"/closePopup.html":"/";var n;if(_.isString(this.$stateParams.site))n=this.$stateParams.site;else if(_.isString(this.$stateParams.redirect)){var i=this.$stateParams.redirect.match("^/site/([^/]*).*$");n=i&&i[1]}var o=this.getLoginUrl()+"?"+this.buildQueryParams(t,n,r);this.windowLocationService.navigateToWithoutAddingToHistory(o)},t.prototype.buildQueryParams=function(e,t,r){var n,i;this.serverService.isAuthenticationSaml()?(n="dest",i="target_site"):this.serverService.isAuthenticationOpenId()&&(n="path",i="siteUrlName");var o={};return o[n]=e,t&&_.isString(t)&&(o[i]=t),r&&(o.sendPodInfo=r),$.param(o)},t.SamlLoginUrl="vizportal/api/saml",t.OpenIdLoginUrl="vizportal/api/web/v1/auth/openId",t.$inject=["$stateParams","$location","ServerService","WindowLocationService"],t}();e.ExternalAuthService=t,e.Module.instance().service("ExternalAuthService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n){this.$location=e,this.$state=t,this.server=r,this.stateWrapperService=n}return t.prototype.getStartPageForSite=function(e,t){var r=this.getStartPageState(e),n=!!t;return r?this.isStartPageInASite(r)&&n?"/site/"+t+e:e:this.getDefaultStartPageForSite(t)},t.prototype.getCurrentUserStartPageForSite=function(e){return this.getStartPageForSite(this.server.getStartPage(),e)},t.prototype.getCurrentUserStartPageForCurrentSite=function(){return this.getStartPageForSite(this.server.getStartPage(),this.server.sessionSiteUrlName())},t.prototype.getCurrentUrlAsStartPage=function(){return this.$location.url().replace(e.SiteUrlNameCapturingRegex,"")},t.prototype.getStartPageState=function(e){if(!e)return null;var t=e.split("?"),r=t[0],n={};return this.stateWrapperService.getMatchingState(r,n)},t.prototype.isStartPageInASite=function(e){return this.stateWrapperService.isDescendantOf(e,"main.site")},t.prototype.getDefaultStartPageForSite=function(t){var r="main.site.content.site.projects";e.FeatureFlags.homePlaceEnabled&&(r="main.site.home");var n=this.$state.href(r,{siteUrlName:t});return n.replace(/^#/,"")},t.$inject=["$location","$state","ServerService","StateWrapperService"],t}();e.StartPageService=t,e.Module.instance().service("StartPageService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n,i,o,s,a,c,l,u,d){function p(){if(!u.maybeNotifyAndClose()){var e=i.redirect,t=i.externalRedirect,s=_.isString(i.site);t?l.setPathQueryFragment(t):e?o.url(e):r.isSessionMultiSite()&&!s?n.go("login.site"):o.url(c.getCurrentUserStartPageForCurrentSite())}}function h(r){t.errorMessages=d.getSignInErrorMessages(r),(r===e.LoginErrorCodes.KerberosFailed||r===e.LoginErrorCodes.SspiFailed)&&(t.autoLoginDidFail=!0)}t.maybeLogin=function(){r.authenticationType()===e.ServerApi.AuthenticationType.ClientCertificate?t.autoLogin():t.loginForm.$valid?(t.errorMessages=[],t.busy=!0,r.login(t.credentials.username,t.credentials.password,i.site).then(p,function(n){if(n&&n.code===e.CommonErrorCode.RedirectToOtherPod){var s=i.externalRedirect;return!s&&_.isString(i.redirect)&&(s="/#"+i.redirect),!s&&_.isString(i.site)&&(s="/#/site/"+i.site+"/"),s||(s="/#"+o.url()),void r.redirectToOtherPod(n,s)}t.credentials.password="",h(n&&n.code||n),t.busy=!1})):t.loginForm.$error.required&&(t.credentials.username?t.credentials.password||(t.errorMessages=[s.instant("enterYourPassword")],angular.element('input[name="password"]').focus()):(t.errorMessages=[s.instant("enterYourUsername")],angular.element('input[name="username"]').focus()))},t.shouldDisplayWindowsCredentialsLink=function(){return r.isWindowsCredentialsAutoLogin()&&!t.autoLoginDidFail},t.isUsernameAndPasswordEnabled=function(){return!r.isAuthenticationExternal()&&r.authenticationType()!==e.ServerApi.AuthenticationType.ClientCertificate},t.autoLogin=function(){return t.busy=!0,r.autoLogin(i.site).then(p,function(e){h(e),t.busy=!1,t.initialized=!0})},t.windowsCredentialsDisplayName=function(){return r.sessionUserDisplayName()};var f=r.licenseExpirationDateIfWithinWarningPeriod();if(i.error){var m=+i.error;h(m)}else f&&(t.errorMessages=[s.instant("licenseExpirationDateWarningMessage",{LICENSE_EXPIRATION_DATE:e.L10n.localizedDateTime(f)})]);t.preloginCustomization=r.preloginCustomization();var v=!Helpers.BooleanQueryParamRegex.test(i.disableAutoSignin);!r.inSession()&&r.isAuthenticationAutoLogin()&&v?t.autoLogin():r.isAuthenticationExternal()?a.login():t.initialized=!0,t.credentials={username:"",password:""}}return t.$inject=["$scope","ServerService","$state","$stateParams","$location","$translate","ExternalAuthService","StartPageService","WindowLocationService","WindowPopupService","ErrorMessageHandler"],t}();e.LoginCtrl=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){!function(e){e[e.Backspace=8]="Backspace",e[e.Tab=9]="Tab",e[e.Enter=13]="Enter",e[e.Escape=27]="Escape",e[e.Space=32]="Space",e[e.End=35]="End",e[e.Home=36]="Home",e[e.ArrowLeft=37]="ArrowLeft",e[e.ArrowUp=38]="ArrowUp",e[e.ArrowRight=39]="ArrowRight",e[e.ArrowDown=40]="ArrowDown",e[e.Delete=46]="Delete"}(e.Keys||(e.Keys={}));e.Keys}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getSiteNames",t)}return __extends(t,e),t}(e.Request);e.GetSiteNamesRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(t){function r(r){t.call(this,r.getServerResourceFetcher(e.ServerApi.GetSiteNamesAcrossAllPodsRequest,function(e){return e.siteNames}))}return __extends(r,t),r.$inject=["FetcherFactory"],r}(e.Resource);e.SiteNameSansIds=t,e.Module.instance().service("SiteNamesAcrossAllPods",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getSiteNamesAcrossAllPods",t)}return __extends(t,e),t}(e.Request);e.GetSiteNamesAcrossAllPodsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i,o,s,a,c){var l=this;this.$location=e,this.$q=t,this.$rootScope=r,this.$state=n,this.$translate=i,this.server=o,this.stateWrapper=s,this.toaster=a,this.windowLocation=c,r.$on("$locationChangeSuccess",function(){var e=l.stateWrapper.getMatchingState(l.$location.path(),l.$location.search());l.stateWrapper.isDescendantOf(e,"main.server")?l.previousServerUrl=l.$location.url():s.isDescendantOf(e,"main.site")&&(l.previousSiteUrl=l.$location.url())})}return t.prototype.serverUrl=function(){return this.previousServerUrl?"/#"+this.previousServerUrl:this.$state.href("main.server.status")},t.prototype.siteUrl=function(){return this.previousSiteUrl?"/#"+this.previousSiteUrl:this.$state.href("main.site.content.site.projects",{siteUrlName:this.server.sessionSiteUrlName()})},t.prototype.switchToSite=function(e){var t=this;this.server.isCurrentSiteUrlName(e)?this.inServerState()&&(this.previousSiteUrl?this.$location.url(this.previousSiteUrl):this.$state.go("main.site.content.site.projects",{siteUrlName:e})):this.switchIfNeeded(e,"/#/site/"+e+"/").then(function(){t.windowLocation.navigateTo(t.$state.href("main.site.content.site.projects",{siteUrlName:e},{absolute:!0})),t.windowLocation.reload()})},t.prototype.switchIfNeeded=function(e,t){var r=this;return this.previousSiteUrl=null,this.server.switchSiteIfNeeded(e,t).fail(function(e){var t=r.getSwitchSiteErrorLocKey(e);return r.server.isSessionMultiSite()?r.$state.go("login.error.noSite",{detailsLocKey:t,redirectState:"login.site",redirectLocKey:"goToSiteList"}):r.$state.go("login.error.noSite",{detailsLocKey:t}),r.$q.reject(e)})},t.prototype.getSwitchSiteErrorLocKey=function(t){switch(t.code){case e.SiteSwitchErrorCodes.UserNotMemberOfSiteOrSiteNotExist:return"switchSiteFailedNotMemberOrNotExist";case e.SiteSwitchErrorCodes.SiteLocked:return"switchSiteFailedSiteLocked";case e.SiteSwitchErrorCodes.SiteSuspended:return"switchSiteFailedSiteSuspended";case e.SiteSwitchErrorCodes.UserUnlicensedForSite:return"switchSiteFailedUserUnlicensed";default:return"switchSiteFailedUnknown"}},t.prototype.switchIfNeededNoFeedback=function(e){return this.previousSiteUrl=null,this.server.switchSiteIfNeeded(e)},t.prototype.inServerState=function(){return this.$state.includes("main.server.**")},t.$inject=["$location","$q","$rootScope","$state","$translate","ServerService","StateWrapperService","ToasterService","WindowLocationService"],t}();e.SiteSwitchService=t,e.Module.instance().service("SiteSwitchService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n,i,o){t.siteSearchValue="",t.$watch("siteSearchValue",function(r){var i=n.all();_.isString(r)&&r.length>0&&(i=i.withFilters([e.Filter.search(r)])),t.sliceableSiteNames=i}),t.currentRow={index:0},t.select=function(e){var t=e.urlName;i.switchIfNeeded(t,"/#/site/"+t+"/").then(function(){return r.url(o.getCurrentUserStartPageForCurrentSite())})},t.$watch("site",function(e){e&&t.select(e)}),t.handleKeyEvent=function(r){switch(r.which){case e.Keys.ArrowDown:r.preventDefault(),t.currentRow.index++;break;case e.Keys.ArrowUp:r.preventDefault(),t.currentRow.index--;break;case e.Keys.Enter:t.select(t.currentRow.object);break;case e.Keys.Escape:t.siteSearchValue=""}}}return t.$inject=["$scope","$location","SiteNamesAcrossAllPods","SiteSwitchService","StartPageService"],t}();e.LoginSitePickerCtrl=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getWorkbookVersions",t)}return __extends(t,e),t}(e.Request);e.GetWorkbookVersionsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"deleteWorkbookVersions",{ids:t})}return __extends(t,e),t}(e.Request);e.DeleteWorkbookVersionsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(t){function r(r,n){t.call(this,n.getServerResourceFetcher(e.ServerApi.GetWorkbookVersionsRequest,function(e){return e.versions})),this.ErrorNotifyingServer=r,this.server=r.getServerService()}return __extends(r,t),r.prototype.del=function(t){return this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests([t],function(t){return new e.ServerApi.DeleteWorkbookVersionsRequest(t)}),e.ResultHelper.combineResults)},r.$inject=["ErrorNotifyingServer","FetcherFactory"],r}(e.Resource);e.WorkbookRevisions=t,e.Module.instance().service("WorkbookRevisions",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e,t,r){this.$translate=e,this.toaster=t,this.windowLocationService=r}return e.prototype.openPreview=function(e){this.windowLocationService.open("http://www.google.com")},e.$inject=["$translate","ToasterService","WindowLocationService"],e}();e.PreviewWorkbookRevisionAction=t,e.Module.instance().service("PreviewWorkbookRevisionAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n){this.$translate=e,this.ConfirmActionDialog=t,this.toasterService=r,this.WorkbookRevisions=n}return t.prototype.showDialogForAction=function(t,r){var n=this;return this.ConfirmActionDialog.open({scope:r.scope,title:this.$translate.instant("delete"),bodyText:this.$translate.instant("deleteWorkbookRevisionConfirm"),actionName:this.$translate.instant("delete"),isDeleteAction:!0,action:function(r){return n.WorkbookRevisions.del(t.id).then(function(t){e.ResultHelper.hasErrors(t)?n.toasterService.pop({type:e.ToastType.Error,text:n.$translate.instant("deleteWorkbookRevisionError")}):n.toasterService.pop({type:e.ToastType.Info,text:n.$translate.instant("deleteWorkbookRevisionSuccess")})})}}).result},t.$inject=["$translate","ConfirmActionDialog","ToasterService","WorkbookRevisions"],t}();e.DeleteWorkbookRevisionAction=t,e.Module.instance().service("DeleteWorkbookRevisionAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e,t,r,n,i){this.$q=e,this.$translate=t,this.PreviewWorkbookRevisionAction=r,this.DeleteWorkbookRevisionAction=n,this.DownloadActions=i,this.workbookRevisionsActionDefinition=[this.previewWorkbookRevisionAction(),this.deleteWorkbookRevisionAction(),this.downloadWorkbookRevisionAction()]}return e.prototype.getWorkbookRevisionActionButtons=function(){return this.workbookRevisionsActionDefinition},e.prototype.previewWorkbookRevisionAction=function(){var e=this;return{name:"preview",translate:"preview_action",isAvailable:function(e){return!0},execute:function(t){return e.PreviewWorkbookRevisionAction.openPreview(t.first()),console.log("TODO: previewWorkbookRevisionAction"),e.$q.when({})}}},e.prototype.deleteWorkbookRevisionAction=function(){var e=this;return{name:"remove",translate:"remove_action",isAvailable:function(e){return 1===e.size()},execute:function(t,r){var n=r.scope;e.DeleteWorkbookRevisionAction.showDialogForAction(t.first(),r).then(function(){return n.refreshItems()})}}},e.prototype.downloadWorkbookRevisionAction=function(){var e=this;return{name:"download",translate:"download_action",isAvailable:function(e){return!0},execute:function(t){return e.DownloadActions.downloadWorkbookRevision(t.first())}}},e.$inject=["$q","$translate","PreviewWorkbookRevisionAction","DeleteWorkbookRevisionAction","DownloadActions"],e}();e.RevisionActions=t,e.Module.instance().service("RevisionActions",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i,o,s,a,c){this.$scope=e,this.$translate=t,this.AngularToReactDataGridBridge=r,this.queryService=n,this.AngularContextFactory=i,this.revisionActions=o,this.ServerService=s,this.WorkbookRevisions=a,this.sizeFilter=c,this.configureForReactDataGrid();var l=this.createQueryUpdater();e.refreshItems=function(){l.refresh()},e.refreshItems()}return t.prototype.configureForReactDataGrid=function(){var t=this;this.$scope.dataGridProps={cols:this.dataGridColumns(this.$scope),update:0,onCellClick:function(r,n){t.$scope.$apply(function(){if(!r.deleted){if(e.FeatureFlags.toggleSelectableRow){var i=1===t.$scope.selectedItems.size()&&t.$scope.selectedItems.contains(r),o="actions"===n;i&&!o?t.$scope.selectedItems.toggle(r):(t.$scope.selectedItems.clear(),t.$scope.selectedItems.add(r))}else t.$scope.selectedItems.clear(),t.$scope.selectedItems.add(r);var s=t.$scope.selectedItems.keys();t.$scope.dataGridProps.selectedKeys=_.object(s,s),t.$scope.dataGridProps.update++}})}},this.$scope.$watch(function(){return t.$scope.selectedItems.size()},function(){var e=t.$scope.selectedItems.keys();t.$scope.dataGridProps.selectedKeys=_.object(e,e),t.$scope.dataGridProps.update++})},t.prototype.createQueryUpdater=function(){var t=this;return this.queryService.createQueryUpdater(this.$scope,e.WorkbookRevisionContentType,this.WorkbookRevisions,function(e){t.AngularToReactDataGridBridge.updateReactDataGridRowStore({scope:t.$scope,sliceable:e,getRowStyle:t.getRowStyle}),t.$scope.sliceable=e},{forWorkbook:this.$scope.workbookId})},t.prototype.dataGridColumns=function(e){var t=[];return t.push({name:"version-num-col",dataKey:"versionNumber",text:this.$translate.instant("revisionHistoryRevisionNumberColumn"),cellFormatter:this.revisionNameCellFormatter(),headerStyle:{textAlign:"left"},cellStyle:{textAlign:"left"},resizable:!1,growToFit:!0,sortable:!1}),t.push({name:"owner-col",dataKey:"owner",text:this.$translate.instant("revisionHistoryOwnerColumn"),cellFormatter:VizPortalReact.DataGridCells.PlainTextCell("publisher"),headerStyle:{textAlign:"left"},cellStyle:{textAlign:"left"},resizable:!1,growToFit:!0,sortable:!1}),t.push({name:"publish-time-col",dataKey:"publishTime",text:this.$translate.instant("revisionHistoryPublishDateColumn"),cellFormatter:VizPortalReact.DataGridCells.DateTimeCell("publishTime"),headerStyle:{textAlign:"right"},cellStyle:{textAlign:"right"},resizable:!1,growToFit:!0,sortable:!1}),t.push({name:"actions-col",dataKey:"actions",text:"",cellFormatter:this.revisionActionsCellFormatter(e),headerStyle:{textAlign:"right"},cellStyle:{textAlign:"right",overflow:"visible"},resizable:!1,sortable:!1}),t},t.prototype.revisionNameCellFormatter=function(){var e=this.$translate;return React.createFactory(React.createClass({render:function(){var t=this.props,r=e.instant("revisionHistoryRevisionNumberLabel",{REVISION_NUMBER:t.value});return React.DOM.span({},r)}}))},t.prototype.revisionActionsCellFormatter=function(e){var t=this.revisionActions.getWorkbookRevisionActionButtons(),r=this.$translate;return React.createFactory(React.createClass({render:function(){var n=this.props.row.data;return n.deleted?React.DOM.span({},"ðŸ‘»"):VizPortalReact.ActionsMenuColumnCell.element({actions:t,getActionTarget:function(){return{items:e.selectedItems,actionContext:{scope:e}}},translate:function(e){return r.instant(e)}},React.DOM.div({key:"name"},""))}}))},t.prototype.getRowStyle=function(e){return e.deleted?{backgroundColor:VizPortalReact.CommonStyles.Colors.White,color:VizPortalReact.CommonStyles.Colors.DisabledTextColor}:null},t.$inject=["$scope","$translate","AngularToReactDataGridBridge","QueryService","AngularContextFactory","RevisionActions","ServerService","WorkbookRevisions","sizeFilter"],t}();e.RevisionHistoryDialogCtrl=t,e.Module.instance().controller("RevisionHistoryDialogCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e,t,r,n,i){var o=+t.errorCode,s=t.redirectPath||"/";e.tryAgain=function(){var e=r.protocol()+"://"+r.host()+":"+r.port()+s;n.navigateToWithoutAddingToHistory(e)},e.errorMessages=i.getSignInErrorMessages(o)}return e.$inject=["$scope","$stateParams","$location","WindowLocationService","ErrorMessageHandler"],e}();e.SignInErrorCtrl=t,e.Module.instance().controller("SignInErrorCtrl",t)}(VizPortal||(VizPortal={}));var VizPortalReact;!function(e){var t;!function(t){function r(t,r,i,o,s,a,c,l){var u=[e.CommonDataGridColumns.selected(r),n(t,o,s,a,i,r),{name:"frequency-col",dataKey:"scheduleType",text:t("column_schedule_frequency"),direction:"asc",cellFormatter:e.DataGridCells.PlainTextCellWithTransform("scheduleType",c)},{name:"task-type-col",dataKey:"scheduledAction",text:t("column_schedule_type"),direction:"asc",cellFormatter:e.DataGridCells.PlainTextCellWithTransform("scheduledAction",l)},{name:"task-count-col",dataKey:"taskCount",text:t("column_schedule_task_count"),cellFormatter:e.DataGridCells.LocalizedCount("taskCount"),direction:"asc",headerStyle:{textAlign:"right"},cellStyle:{textAlign:"right"}},{name:"execution-col",dataKey:"parallel",direction:"asc",text:t("column_schedule_behavior"),cellFormatter:e.DataGridCells.PlainTextCellWithTransform("parallel",function(e){return t(e?"scheduleBehaviorParallel":"scheduleBehaviorSerial")})},{name:"next-run-at-col",dataKey:"runNextAt",text:t("column_schedule_next_run"),direction:"asc",cellFormatter:e.DataGridCells.DateTimeCell("runNextAt",t("disabled"))}];return u}function n(t,r,n,i,o,s){return e.CommonDataGridColumns.withActions({name:"name-col",dataKey:"name",text:t("column_name"),direction:"asc",cellFormatter:e.DataGridCells.Link(function(e){return{text:e.data.name,url:r?n.schedule(e.data.id,e.data.scheduledAction):i.schedule(e.data.id,e.data.scheduledAction),iconClassName:"tb-grid-icon-schedule",iconTitle:t("schedule")}})},{actions:o,getActionTarget:function(){return{items:s.selectedItems,actionContext:{scope:s}}},translate:t})}t.columns=r}(t=e.ScheduleGrid||(e.ScheduleGrid={}))}(VizPortalReact||(VizPortalReact={}));var VizPortal;!function(e){var t=function(){function t(e){this.$state=e}return t.prototype.siteUrlFor=function(e){return this.$state.href("main.site.schedule."+this.defaultChildState(e),{id:e.id})},t.prototype.serverUrlFor=function(e){return this.$state.href("main.server.schedule."+this.defaultChildState(e),{id:e.id})},t.prototype.defaultChildState=function(t){return t.scheduledAction===e.ServerApi.ScheduleActions.Extract?"extractTasks":"subscriptions"},t.$inject=["$state"],t}();e.SchedulesConfig=t,e.Module.instance().service("SchedulesConfig",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(r,n,i,o,s,a,c,l,u,d,p,h,f,m,v,S,g,y,A,P){var C=this;this.$scope=r,this.$state=n,this.$translate=i,this.AngularToReactDataGridBridge=o,this.$filter=s,this.SchedulesConfig=u,this.SchedulePermissions=d,this.Schedules=h,this.ServerService=m,this.CreateScheduleAction=v,this.SetScheduleStatusAction=S,this.RunServerSchedulesAction=g,this.RunSchedulesAction=y,this.DeleteSchedulesAction=A,this.RenameScheduleAction=P;var b=new e.Set(function(e){return e.id}),R=this.createActions(b,c);r.selectedItems=b,r.useReactDataGrid=e.FeatureFlags.reactSchedulesGrid,e.FeatureFlags.reactSchedulesGrid&&this.configureForReactDataGrid(R),a.setTitle("schedules"),r.sorter=f.create(e.ScheduleContentType.defaultOrder),this.query=l.createQueryUpdater(r,e.ScheduleContentType,h,function(t){c&&(t=t.addFilter(e.Filter.fieldEq(e.ServerApi.FilterFieldNames.siteId,c))),e.FeatureFlags.reactSchedulesGrid&&C.AngularToReactDataGridBridge.updateReactDataGridRowStore({scope:r,sliceable:t}),r.sliceable=t,r.sorter.setOrder(t.getOrder()),t.getCount().then(function(e){C.$scope.schedules.count=e})},{}),this.query.refresh(),r.placeTitleClicked=function(){C.refreshSchedules()},r.availableAction=function(e){return e.isAvailable(r.selectedItems)},e.ActionButtonsHelper.setupActionButtons(r,R),r.listActions=[{name:"create-new-schedule",translate:"newSchedule",isAvailable:function(){return m.isSessionServerAdmin()},execute:function(t){v.createSchedule(e.ActionContext.fromEvent(t)).then(function(){return C.refreshSchedules()})}}],r.availableListAction=function(e){return e.isAvailable()},r.rowClicked=function(e,t){p.rowClicked(r.selectedItems,e,t);
},r.sliceChanged=function(e){r.selectedItems.updateItems(e.items),r.schedules.count=e.total},r.headerClicked=function(e){return r.sorter.setPrimary(e.attrs.key,e.attrs.direction)},r.schedules={count:0},r.scheduleUrl=function(e){return c?C.SchedulesConfig.siteUrlFor(e):C.SchedulesConfig.serverUrlFor(e)},r.emptyTemplateModel=t.emptyTemplateModel}return t.prototype.configureForReactDataGrid=function(e){var r=this,n=new VizPortalReact.SiteUrls({siteUrlName:this.ServerService.sessionSiteUrlName(),queryString:window.location.search}),i=VizPortalReact.ScheduleGrid.columns(function(e){return r.$translate.instant(e)},this.$scope,e,this.isServerPage(),new VizPortalReact.ServerUrls(window.location.search),n,this.$filter("scheduleTypeName"),this.$filter("scheduleActionName"));this.AngularToReactDataGridBridge.attachReactDataGridToScope(this.$scope,i,t.emptyTemplateModel)},t.prototype.isServerPage=function(){return this.$state.includes("main.server.**")},t.prototype.createActions=function(t,r){var n=this;return[{name:"schedules-run-now",translate:"runNow_action",isAvailable:function(e){return e.size()>0&&n.SchedulePermissions.canRunSchedule()},execute:function(i,o){r?n.RunSchedulesAction.execute(i,o).then(function(r){e.ActionHelpers.deselectNotFound(t,r,e.SchedulingErrorCode.SchedulingScheduleNotFound),n.refreshSchedules()}):n.RunServerSchedulesAction.execute(i,o).then(function(r){e.ActionHelpers.deselectNotFound(t,r,e.SchedulingErrorCode.SchedulingScheduleNotFound),n.refreshSchedules()})}},{name:"enableSchedules",translate:"enable_action",isAvailable:function(e){return e.size()>0&&n.SchedulePermissions.canEditSchedule()},isDisabled:function(e){return!_.any(e.toArray(),function(e){return!n.isScheduleEnabled(e)})},execute:function(r,i){n.SetScheduleStatusAction.confirmEnableSchedules(r,i).then(function(r){e.ActionHelpers.deselectNotFound(t,r,e.SchedulingErrorCode.SchedulingScheduleNotFound),n.refreshSchedules()})}},{name:"disableSchedules",translate:"disable_action",isAvailable:function(e){return e.size()>0&&n.SchedulePermissions.canEditSchedule()},isDisabled:function(e){return!_.any(e.toArray(),function(e){return n.isScheduleEnabled(e)})},execute:function(r,i){n.SetScheduleStatusAction.confirmDisableSchedules(r,i).then(function(r){e.ActionHelpers.deselectNotFound(t,r,e.SchedulingErrorCode.SchedulingScheduleNotFound),n.refreshSchedules()})}},{name:"rename-schedule",translate:"rename_action",isAvailable:function(e){return e.size()>0&&n.SchedulePermissions.canEditSchedule()},isDisabled:function(e){return 1!==e.size()},execute:function(r,i){n.RenameScheduleAction.confirmRename(r.first(),i).then(function(r){e.ActionHelpers.deselectNotFound(t,r,e.SchedulingErrorCode.SchedulingScheduleNotFound),n.refreshSchedules()})}},{name:"edit-schedule",translate:"editScheduleSettings_action",isAvailable:function(e){return e.size()>0&&n.SchedulePermissions.canEditSchedule()},isDisabled:function(e){return 1!==e.size()},execute:function(r,i){n.CreateScheduleAction.editSchedule(r.first(),i).then(function(r){e.ActionHelpers.deselectNotFound(t,r,e.SchedulingErrorCode.SchedulingScheduleNotFound),n.refreshSchedules()})}},{name:"delete-schedule",translate:"delete_action",isAvailable:function(e){return e.size()>0&&n.SchedulePermissions.canEditSchedule()},execute:function(r,i){n.DeleteSchedulesAction.deleteSchedules(r,i).then(function(r){e.ActionHelpers.deselectAllExceptErrors(t,r,e.SchedulingErrorCode.SchedulingScheduleNotFound),n.refreshSchedules()})}}]},t.prototype.refreshSchedules=function(){this.query.refresh()},t.prototype.isScheduleEnabled=function(e){return!!e.runNextAt},t.$inject=["$scope","$state","$translate","AngularToReactDataGridBridge","$filter","BrowserTitleService","siteId","QueryService","SchedulesConfig","SchedulePermissions","SelectionService","Schedules","SorterFactory","ServerService","CreateScheduleAction","SetScheduleStatusAction","RunServerSchedulesAction","RunSchedulesAction","DeleteSchedulesAction","RenameScheduleAction"],t.emptyTemplateModel={title:"schedulesEmptyMessage"},t}();e.SchedulesCtrl=t,e.Module.instance().controller("SchedulesCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){e.WorkerProcessType={clusterController:"clustercontroller",gateway:"gateway",vizportal:"vizportal",vizqlServer:"vizqlserver",cacheServer:"cacheserver",searchServer:"searchserver",backgrounder:"backgrounder",dataServer:"dataserver",dataEngine:"dataengine",wgServer:"wgserver",fileStore:"filestore",repository:"repository"}}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){e.WorkerStatusType={active:"active",activeSyncing:"activesyncing",busy:"busy",decommissionFailedReadOnly:"decommissionfailedreadonly",decommissioningReadOnly:"decommissioningreadonly",down:"down",passive:"passive",readOnly:"readonly",readyForRemoval:"readyforremoval",statusNotAvailable:"statusnotavailable",statusNotAvailableSyncing:"statusnotavailablesyncing",unlicensed:"unlicensed"};var t=function(e){function t(t){e.call(this,"getWorkerProcessStatus",t)}return __extends(t,e),t}(e.Request);e.GetWorkerProcessStatus=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e,t,r){this.$rootScope=e,this.modal=t,this.$q=r}return e.prototype.open=function(e){var t=this;if(!_.isUndefined(e.bodyText)&&!_.isUndefined(e.bodyTemplateUrl))throw new Error("bodyTemplateUrl cannot be defined if bodyText is defined on an IConfirmActionDialogOptions object");!e.buttons&&e.actionName&&(e.buttons=[{label:e.actionName,action:e.action,disabled:e.confirmDisabled}]);var r,n=void 0,i=(e.scope||this.$rootScope).$new();i.setActor=function(e){return r=e},i.isActor=function(e){return r===e},i.progress={percent:void 0},i.initialFocus=_.find(e.buttons,function(e){return!e.disabled||!e.disabled()});var o={templateUrl:"confirmActionDialog.html",position:e.position,scope:i,controller:["$scope",function(i){i.config=e,i.busy=!1,i.confirm=function(){if(r){i.busy=!0,i.errorMessage=void 0,n=void 0,i.progress.percent=void 0,o.keyboard=!1,o.backdrop="static";var e=t.$q.when(r.action(s));e.then(function(e){n?i.errorMessage=n:i.close(e)}).fin(function(){i.busy=!1,o.backdrop=!0,o.keyboard=!0})}}}],size:e.size};e.bodyTemplateUrl&&(o.resolve={bodyTemplateContent:["$http","$templateCache",function(t,r){return t.get(e.bodyTemplateUrl,{cache:r})}]});var s=this.modal.open(o);return s.showErrorMessage=function(e){n=e},s.setProgress=function(e){i.progress.percent=e},s.result.fin(function(){return i.$destroy()}),s},e.$inject=["$rootScope","ModalService","$q"],e}();e.ConfirmActionDialog=t,e.Module.instance().service("ConfirmActionDialog",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){void 0===t&&(t={}),e.call(this,"rebuildSearchIndex",t)}return __extends(t,e),t}(e.Request);e.RebuildSearchIndexRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n){this.$translate=e,this.server=t,this.lrActionService=r,this.toasterService=n,this.rebuildSearchIndexPercent=0,this.rebuildSearchIndexPending=!1}return t.prototype.handleCurrentJob=function(){var t=this;return this.lrActionService.getLastByType(e.LongRunningActionType.RebuildSearchIndex).then(function(e){return t.handleRebuildSearchIndexStatus(e)})},t.prototype.getRebuildSearchIndexPercent=function(){return this.rebuildSearchIndexPercent},t.prototype.getRebuildSearchIndexPending=function(){return this.rebuildSearchIndexPending},t.prototype.rebuildSearchIndex=function(){var t=this;return this.rebuildSearchIndexPercent=0,this.server.sendRequest(new e.ServerApi.RebuildSearchIndexRequest).then(function(e){var r=!e.actionId;r?t.getRebuildSearchIndexStatus():t.trackRebuildSearchIndexProgress(e.actionId)})},t.prototype.cancelPoll=function(){this.rebuildSearchIndexPoller&&this.rebuildSearchIndexPoller.cancel(),this.rebuildSearchIndexPercent=0,this.rebuildSearchIndexPending=!1},t.prototype.trackRebuildSearchIndexProgress=function(t){var r=this,n=function(t){t&&t.succeeded===!1?o(t&&t.response&&t.response.errors):(r.rebuildSearchIndexPercent=100,r.toasterService.pop({type:e.ToastType.Info,text:r.$translate.instant("rebuildSearchIndexSuccess")}))},i=function(e){r.rebuildSearchIndexPercent=e.percentComplete},o=function(t){t!==e.ErrorReason.Canceled&&r.toasterService.pop({type:e.ToastType.Error,text:r.$translate.instant("rebuildSearchIndexError")})};t?(this.rebuildSearchIndexPending=!0,this.rebuildSearchIndexPoller=this.lrActionService.trackProgress(t),this.rebuildSearchIndexPoller.promise.then(n,o,i).fin(function(){return r.rebuildSearchIndexPending=!1})):o(e.ErrorReason.Unknown)},t.prototype.getRebuildSearchIndexStatus=function(){var t=this;this.lrActionService.getLastByType(e.LongRunningActionType.RebuildSearchIndex).then(function(e){return t.handleRebuildSearchIndexStatus(e)})},t.prototype.handleRebuildSearchIndexStatus=function(t){t&&t.state!==e.LongRunningActionState.Complete&&(this.rebuildSearchIndexPercent=t.percentComplete,this.trackRebuildSearchIndexProgress(t.id))},t.$inject=["$translate","ServerService","LongRunningActionService","ToasterService"],t}();e.RebuildSearchIndexService=t,e.Module.instance().service("RebuildSearchIndexService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getServerInfo",t)}return __extends(t,e),t}(e.Request);e.GetServerInfoRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e){this.server=e}return t.prototype.fetch=function(){var t=this;return this.server.sendRequest(new e.ServerApi.GetServerInfoRequest({})).then(function(e){return t.makeHosts(e)})},t.prototype.makeHosts=function(e){var t=_.groupBy(e.processes,"host");return _.map(e.workerHosts,function(e){var r={name:e,processes:_.groupBy(t[e],"type")};return r})},t.$inject=["ServerService"],t}();e.ServerInfoService=t,e.Module.instance().service("ServerInfoService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(r,n,i,o,s,a,c,l,u){var d=this;this.hosts=u,o.setTitle("serverStatus"),r.showZiplog=s.isTabAdminServiceEnabled(),this.featureFlags=s.featureFlags(),r.hosts=this.hosts,r.isSingleHost=function(){return 1===r.hosts.length},r.components=this.getComponents(),r.legendStatuses=t.legendStatuses,r.isPreferred=function(t,r){return t===e.ServerApi.WorkerProcessType.repository&&d.featureFlags.ha2Enabled&&r.processes&&r.processes[e.ServerApi.WorkerProcessType.repository]&&r.processes[e.ServerApi.WorkerProcessType.repository][0].preferred},r.refreshStatuses=function(){r.refreshButtonBusy=!0,l.fetch().then(function(e){r.hosts=e,r.$broadcast(t.refreshProcessStatusEvent)}).fin(function(){return r.refreshButtonBusy=!1})},r.rebuildSearchIndexPending=function(){return a.getRebuildSearchIndexPending()},r.rebuildSearchIndexPercent=function(){return a.getRebuildSearchIndexPercent()},r.rebuildSearchIndex=function(){c.open({title:n.instant("rebuildSearchIndexConfirmTitle"),bodyText:n.instant("rebuildSearchIndexConfirmMessage"),actionName:n.instant("rebuildSearchIndexConfirmButton"),isDeleteAction:!0,action:function(){a.rebuildSearchIndex()},errorMessage:n.instant("rebuildSearchIndexError")})},r.$on("$destroy",function(){return a.cancelPoll()})}return t.prototype.getComponents=function(){return _.without(t.WorkerProcessTypes,this.featureFlags.ha2Enabled&&this.featureFlags.ha2FilestoreEnabled?"":e.ServerApi.WorkerProcessType.fileStore,this.featureFlags.ha2Enabled&&1!==this.hosts.length?"":e.ServerApi.WorkerProcessType.clusterController)},t.refreshProcessStatusEvent="refreshProcessStatus",t.legendStatuses=[e.ServerApi.WorkerStatusType.active,e.ServerApi.WorkerStatusType.busy,e.ServerApi.WorkerStatusType.passive,e.ServerApi.WorkerStatusType.unlicensed,e.ServerApi.WorkerStatusType.down,e.ServerApi.WorkerStatusType.statusNotAvailable],t.WorkerProcessTypes=[e.ServerApi.WorkerProcessType.clusterController,e.ServerApi.WorkerProcessType.gateway,e.ServerApi.WorkerProcessType.vizportal,e.ServerApi.WorkerProcessType.wgServer,e.ServerApi.WorkerProcessType.vizqlServer,e.ServerApi.WorkerProcessType.cacheServer,e.ServerApi.WorkerProcessType.searchServer,e.ServerApi.WorkerProcessType.backgrounder,e.ServerApi.WorkerProcessType.dataServer,e.ServerApi.WorkerProcessType.dataEngine,e.ServerApi.WorkerProcessType.fileStore,e.ServerApi.WorkerProcessType.repository],t.$inject=["$scope","$translate","$state","BrowserTitleService","ServerService","RebuildSearchIndexService","ConfirmActionDialog","ServerInfoService","hosts"],t}();e.ServerStatusCtrl=t,e.Module.instance().controller("ServerStatusCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getUserSettings",t)}return __extends(t,e),t}(e.Request);e.GetUserSettingsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e,t,r){this.$scope=e,this.serverUser=t,this.userSettings=r,e.serverUser=this.serverUser,e.userSettings=r}return e.$inject=["$scope","serverUser","userSettings"],e}();e.ServerUserPlaceCtrl=t,e.Module.instance().controller("ServerUserPlaceCtrl",t)}(VizPortal||(VizPortal={}));var VizPortalReact;!function(e){var t;!function(t){function r(t,r,i,o,s,a){var c=[e.CommonDataGridColumns.selected(r),n(t,i,s,r),{name:"username-col",dataKey:"username",text:t("column_username"),direction:"asc"},{name:"maxSiteRole-col",dataKey:"maxSiteRole",text:t("column_max_site_role"),direction:"asc",cellFormatter:e.DataGridCells.PlainTextCellWithTransform("maxSiteRole",function(e){return o(e)})},{name:"siteCount-col",dataKey:"siteCount",text:t("column_site_count"),cellFormatter:e.DataGridCells.LocalizedCount("siteCount"),direction:"asc",headerStyle:{textAlign:"right"},cellStyle:{textAlign:"right"}}];return a&&c.push({name:"domainName-col",dataKey:"domainName",text:t("column_domainName"),direction:"asc"}),c.push({name:"lastSignIn-col",dataKey:"lastSignIn",text:t("column_last_sign_in"),direction:"desc",cellFormatter:e.DataGridCells.DateTimeCell("lastSignIn")}),c}function n(t,r,n,i){var o={color:e.CommonStyles.Colors.Grey102,textDecoration:"none",pointerEvents:"none"},s=function(e){var t=e.data;return t.readOnly||"Guest"===t.maxSiteRole};return e.CommonDataGridColumns.withActions({name:"displayName-col",dataKey:"displayName",text:t("column_fullName"),direction:"asc",cellFormatter:e.DataGridCells.Link(function(e){var n=s(e),i=e.data;return{text:i.displayName,url:n?null:r.userSettingsUrl(i),style:n?o:null,iconClassName:"tb-grid-icon-user",iconTitle:t("user")}})},{actions:n,getActionTarget:function(){return{items:i.selectedItems,actionContext:{scope:i}}},translate:t,menuDisabled:s})}t.columns=r}(t=e.ServerUsersGrid||(e.ServerUsersGrid={}))}(VizPortalReact||(VizPortalReact={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"createLocalServerUser",t)}return __extends(t,e),t}(e.Request);e.CreateLocalServerUserRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getServerUsers",t)}return __extends(t,e),t}(e.Request);e.GetServerUsersRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getUserRefreshTokenCount",t)}return __extends(t,e),t}(e.Request);e.GetUserRefreshTokenCountRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getUserConnectedDevices",t)}return __extends(t,e),t}(e.Request);e.GetUserConnectedDevicesRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getUsersSiteRoles",t)}return __extends(t,e),t}(e.Request);e.GetUsersSiteRolesRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"deleteUserConnectedDevices",t)}return __extends(t,e),t}(e.Request);e.DeleteUserConnectedDevicesRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"updateServerUsersAdminStatus",t)}return __extends(t,e),t}(e.Request);e.UpdateServerUsersAdminStatusRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"updateServerUsersSiteMembership",t)}return __extends(t,e),t}(e.Request);e.UpdateServerUsersSiteMembershipRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(t){function r(r,n,i){t.call(this,n.getServerResourceFetcher(e.ServerApi.GetServerUsersRequest,function(e){return e.users})),this.ErrorNotifyingServer=r,this.$q=i}return __extends(r,t),r.prototype.getUserByUsernameAndDomain=function(t,r){return this.all().addFilter(e.Filter.stringFieldEq("username",t)).addFilter(e.Filter.stringFieldEq("domainName",r)).getFirst()},r.prototype.getByUserIds=function(t){var r=this.all(),n=e.Filter.stringFieldInArray(e.ServerApi.NamedItemKeys.id,t);return r=r.addFilter(n),r.getCount().then(function(e){return r.getSlice(0,e)})},r.prototype.getUserCountsByMaxSiteRole=function(t){var r=_.filter(t.getFilters(),function(t){return!(t.field&&t.field===e.ServerApi.FilterFieldNames.maxSiteRole)}),n=t.withFilters(r),i={},o=_.map(e.SiteRoles.WithoutGuest,function(t){return n.addFilter(e.Filter.stringFieldEq(e.ServerApi.FilterFieldNames.maxSiteRole,t)).getCount().then(function(e){i[t]=e})});return o.push(n.getCount().then(function(e){i.Any=e})),this.$q.all(o).then(function(){return i})},r.prototype.getUserSettings=function(t,r){var n={username:t,domainName:r};return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.GetUserSettingsRequest(n))},r.prototype.getUserRefreshTokenCount=function(t,r){var n={username:t,domainName:r};return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.GetUserRefreshTokenCountRequest(n)).then(function(e){return e.refreshTokenCount})},r.prototype.getUserConnectedDevices=function(t){var r={userId:t};return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.GetUserConnectedDevicesRequest(r)).then(function(e){return e.devices})},r.prototype.deleteUserConnectedDevices=function(t,r){var n={userId:t,deviceIds:r};return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.DeleteUserConnectedDevicesRequest(n))},r.prototype.getSiteRoles=function(t){return this.ErrorNotifyingServer.sendRequests(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.GetUsersSiteRolesRequest({ids:t})}),function(t){return{errors:e.ResultHelper.combineErrors(t),users:e.ResultHelper.combine(t,function(e){return e.users})}})},r.prototype.updateServerUsersSiteMembership=function(t,r,n){return this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests3(t,r,n,function(t,r,n){return new e.ServerApi.UpdateServerUsersSiteMembershipRequest({userIds:t,addToSiteRoles:r,removeFromSiteIds:n})}),e.ResultHelper.combineResults)},r.prototype.updateServerAdminStatus=function(t,r){return this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.UpdateServerUsersAdminStatusRequest({userIds:t,admin:r})}),e.ResultHelper.combineResults)},r.prototype.deleteUsers=function(t){return this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.DeleteServerUsersRequest({ids:t})}),e.ResultHelper.combineUserResults)},r.prototype.importUsersFromActiveDirectory=function(t){return this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.ImportServerUsersFromActiveDirectoryRequest({usernames:t})}),e.ResultHelper.combineImportUserResults)},r.prototype.createLocalServerUser=function(t,r,n,i){var o=this;return this.ErrorNotifyingServer.sendRequestAndDelay(new e.ServerApi.GeneratePublicKeyRequest).then(function(s){var a=s.key,c=s.keyId,l=rsa.encrypt(i,a),u=new e.ServerApi.CreateLocalServerUserRequest({username:t,displayName:r,email:n,encryptedPassword:l,keyId:c});return o.ErrorNotifyingServer.sendRequestAndDelay(u)})},r.$inject=["ErrorNotifyingServer","FetcherFactory","$q"],r}(e.Resource);e.ServerUsers=t,e.Module.instance().service("ServerUsers",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){function t(e){return _.chain(e.split(/[;,\r\n]+/)).map(function(e){return e.trim()}).compact().unique().value()}e.splitUsernames=t}(t=e.UsernameHelpers||(e.UsernameHelpers={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n,i,o,s,a,c,l,u){var d=this;this.$scope=t,this.$q=r,this.$translate=n,this.toaster=i,this.serverAdminUpdateActionNotification=o,this.siteRolesUpdateActionNotification=a,this.siteUsers=c,this.userActionNotification=l,t.siteRoleOptions=s.optionsForCurrentUser(),t.siteRole=0>=u?e.ServerApi.SiteRoles.Unlicensed:e.ServerApi.SiteRoles.Interactor,t.setSiteRole=function(e){t.siteRole=e},t.addActiveDirectoryUsers=function(e){return d.importUsers(e)},t.availableQuota=u,t.isSiteRoleOptionDisabled=function(t){return 0>=u&&t!==e.ServerApi.SiteRoles.Unlicensed&&t!==e.ServerApi.SiteRoles.UnlicensedWithPublish},t.isQuotaEnabledForSite=_.isNumber(u)}return t.prototype.importUsers=function(t){var r=this;this.$scope.busy=!0,this.$scope.usersToAdd=e.UsernameHelpers.splitUsernames(t);var n=this.$scope.siteRole,i=!1;return n===e.ServerApi.SiteRoles.ServerAdministrator&&(n=e.ServerApi.SiteRoles.Unlicensed,i=!0),this.siteUsers.importUsersFromActiveDirectory(this.$scope.usersToAdd,n,i).then(function(t){return r.userActionNotification.notify({users:e.Set.fromIdItemArray(t.users),results:t.results,errors:t.errors,successCode:"12"}),r.$scope.$emit(e.UserAddedEvent),r.$q.when({})}).then(function(e){return r.$scope.close(e)})},t.$inject=["$scope","$q","$translate","ToasterService","ServerAdminUpdateActionNotification","SiteRoles","SiteRolesUpdateActionNotification","SiteUsers","UserActionNotification","availableQuota"],t}();e.AddActiveDirectorySiteUsersDialogCtrl=t,e.Module.instance().controller("AddActiveDirectorySiteUsersDialogCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(t){function r(r){t.call(this,r.getServerResourceFetcher(e.ServerApi.GetSiteNamesRequest,function(e){return e.siteNames}))}return __extends(r,t),r.$inject=["FetcherFactory"],r}(e.Resource);e.SiteNameWithIds=t,e.Module.instance().service("SiteNames",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i){this.$state=e,this.$translate=t,this.serverAdminUpdateActionNotification=r,this.serverUsers=n,this.toaster=i}return t.prototype.siteRoleChangesToParams=function(t,r){var n=[],i=[];return _.each(r,function(t,r){t.checkboxState===e.CheckboxState.checked?n.push({siteId:r,siteRole:t.siteRole}):t.checkboxState===e.CheckboxState.empty&&i.push(r)}),{userIds:t,addToSiteRoles:n,removeFromSiteIds:i}},t.prototype.updateServerUsersSiteMembership=function(e){return this.serverUsers.updateServerUsersSiteMembership(e.userIds,e.addToSiteRoles,e.removeFromSiteIds)},t.prototype.updateServerAdmin=function(e,t){var r=this,n=e.pluck("id"),i=this.serverUsers.updateServerAdminStatus(n,t);return i.then(function(n){r.serverAdminUpdateActionNotification.notify(n,e,t)}),i},t.$inject=["$state","$translate","ServerAdminUpdateActionNotification","ServerUsers","ToasterService"],t}();e.SiteRolesPickerClientService=t,e.Module.instance().service("SiteRolesPickerClientService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.SiteMembershipDialogFilters={AllSites:"siteMembershipAllSites",AssignedSites:"siteMembershipAssignedSites",SearchResults:"siteMembershipSearchResults"};var t=function(){function t(t,r,n,i,o){var s=this;this.$scope=t,this.serverService=r,this.siteNamesResource=n,this.sliceableFactory=o,this.uncheckedAssignedSites=0,t.siteFilter={selection:e.SiteMembershipDialogFilters.AllSites},this.userCountsAndRolesBySiteId={},t.searchInput={text:""},t.changes||(t.changes={siteRoles:{},serverAdmin:void 0}),t.emptyTemplateModel={title:"noAssignedSites",action:function(){return t.siteFilter.selection=e.SiteMembershipDialogFilters.AllSites}},t.needsAssignedSitesRefresh=!1,t.siteNames=this.siteNamesResource.all(),t.sliceable=t.siteNames,t.columnWidths={getActual:this.getColumnWidths,getMin:this.getColumnWidths,hasPreferredWidths:function(){return!0}},t.adminCheckboxClicked=function(){var r=e.CheckboxState.toggle(s.$scope.adminCheckboxState());t.siteFilter.selection===e.SiteMembershipDialogFilters.AssignedSites?r===e.CheckboxState.empty?s.getAssignedSitesList().then(function(e){t.sliceable=e,s.updateAdminState(r)}):(s.updateAdminState(r),t.refreshAssignedSites()):s.updateAdminState(r)},t.adminCheckboxState=function(){return t.changes.serverAdmin?t.changes.serverAdmin:s.originalAdminState},t.checkboxState=function(r){return t.adminCheckboxState()===e.CheckboxState.checked?e.CheckboxState.checked:t.adminCheckboxState()===e.CheckboxState.mixed?e.CheckboxState.mixed:s.checkboxStateWithoutAdmin(r)},t.siteRole=function(r){if(t.adminCheckboxState()===e.CheckboxState.checked)return e.ServerApi.SiteRoles.ServerAdministrator;if(t.adminCheckboxState()===e.CheckboxState.mixed)return e.SiteRoles.Mixed;if(t.changes.siteRoles[r.id]&&t.changes.siteRoles[r.id].siteRole)return t.changes.siteRoles[r.id].siteRole;var n=s.userCountsAndRolesBySiteId[r.id],i=n?n.count:0;return i===s.numSelectedUsers?n.siteRole:i>0?e.SiteRoles.Mixed:e.ServerApi.SiteRoles.Unlicensed},t.selectCtrl={options:e.SiteRoles.WithoutGuestOrServerAdmin},t.checkboxClicked=function(r,n){var i=2;if(!(n===i&&t.checkboxState(r)!==e.CheckboxState.empty||t.modifySiteRolesDisabled())){var o=r.id;t.changes.siteRoles[o]||(t.changes.siteRoles[o]={siteName:r.name});var a=t.changes.siteRoles[o];t.siteFilter.selection===e.SiteMembershipDialogFilters.AssignedSites&&(s.$scope.checkboxState(r)===e.CheckboxState.empty?s.uncheckedAssignedSites--:s.$scope.checkboxState(r)===e.CheckboxState.checked&&s.uncheckedAssignedSites++,t.needsAssignedSitesRefresh=s.uncheckedAssignedSites>0),a.checkboxState=e.CheckboxState.toggle(s.$scope.checkboxState(r)),a.checkboxState!==e.CheckboxState.empty&&a.siteRole||(a.siteRole=e.ServerApi.SiteRoles.Interactor),s.getOriginalCheckboxStateForSite(o)===s.$scope.checkboxState(r)&&delete t.changes.siteRoles[o]}},t.setSiteRole=function(r,n){var i=r.id;t.changes.siteRoles[i]={siteRole:n,checkboxState:e.CheckboxState.checked,siteName:r.name}},t.$watch("usersWithSiteRoles",function(){s.updateModel()}),t.refreshAssignedSites=function(){t.needsAssignedSitesRefresh=!1,s.$scope.adminCheckboxState()!==e.CheckboxState.empty?s.$scope.sliceable=t.siteNames:s.getAssignedSitesList().then(function(e){s.$scope.sliceable=e})},t.$watch("siteFilter.selection",function(r){s.updateSiteFilters(),r===e.SiteMembershipDialogFilters.AssignedSites&&t.refreshAssignedSites(),r===e.SiteMembershipDialogFilters.AllSites&&(t.sliceable=t.siteNames),r!==e.SiteMembershipDialogFilters.SearchResults&&(t.lastSiteFilter=r,t.searchInput.text=""),t.needsAssignedSitesRefresh=!1}),t.isRowDirty=function(r){return!!t.changes.siteRoles[r.id]&&t.adminCheckboxState()===e.CheckboxState.empty},t.modifySiteRolesDisabled=function(){return t.adminCheckboxState()!==e.CheckboxState.empty},t.submitSearch=function(r,o){t.emptyTemplateModel.title="noMatchingResults",r?(t.siteFilter.selection!==e.SiteMembershipDialogFilters.SearchResults&&(t.siteFilter.selection=e.SiteMembershipDialogFilters.SearchResults),t.sliceable=n.all().withFilters([e.Filter.search(r)])):t.siteFilter.selection=t.lastSiteFilter,i.isTouch()&&o&&$(o.target).blur()},this.updateModel()}return t.adminStateFromUsers=function(t,r){return 0===t?e.CheckboxState.empty:r>t?e.CheckboxState.mixed:e.CheckboxState.checked},t.prototype.updateAdminState=function(e){e===this.originalAdminState?this.$scope.changes.serverAdmin=void 0:this.$scope.changes.serverAdmin=e},t.prototype.checkboxStateWithoutAdmin=function(t){if(this.$scope.changes.siteRoles[t.id]&&this.$scope.changes.siteRoles[t.id].checkboxState)return this.$scope.changes.siteRoles[t.id].checkboxState;var r=this.userCountsAndRolesBySiteId[t.id],n=r?r.count:0;return n===this.numSelectedUsers?e.CheckboxState.checked:n>0?e.CheckboxState.mixed:e.CheckboxState.empty},t.prototype.getColumnWidths=function(e){var t=2,r=[27,185],n=$(".tb-picker-container .tb-data-grid-body-background").width()-r[0]-r[1];return e===t?n:r[e]},t.prototype.updateSiteFilters=function(){var t=[e.SiteMembershipDialogFilters.AllSites,e.SiteMembershipDialogFilters.AssignedSites];this.$scope.siteFilter.selection===e.SiteMembershipDialogFilters.SearchResults&&t.push(e.SiteMembershipDialogFilters.SearchResults),this.$scope.siteFilters=t},t.prototype.getAssignedSitesList=function(){var t=this;return e.SliceableHelper.fetchAll(this.siteNamesResource.all()).then(function(r){var n=_.filter(r.items,function(r){return t.checkboxStateWithoutAdmin(r)!==e.CheckboxState.empty});return t.uncheckedAssignedSites=0,t.$scope.emptyTemplateModel.title="noAssignedSites",t.sliceableFactory.fromArray(n)})},t.prototype.updateModel=function(){this.$scope.usersWithSiteRoles?(this.updateSelectedUserCounts(),this.userCountsAndRolesBySiteId=t.calculateUserCountsAndRolesBySite(this.$scope.usersWithSiteRoles.userRoles)):(this.numSelectedUsers=1,this.numSelectedServerAdmins=0,this.userCountsAndRolesBySiteId={}),this.originalAdminState=t.adminStateFromUsers(this.numSelectedServerAdmins,this.numSelectedUsers),this.originalAdminState===this.$scope.changes.serverAdmin&&(this.$scope.changes.serverAdmin=void 0)},t.calculateUserCountsAndRolesBySite=function(t){var r={};return _.each(t,function(t){_.each(t.sites,function(t){var n=r[t.siteId];n?(++n.count,n.siteRole!==t.siteRole&&(n.siteRole=e.SiteRoles.Mixed)):r[t.siteId]={count:1,siteRole:t.siteRole}})}),r},t.prototype.updateSelectedUserCounts=function(){this.numSelectedUsers=this.$scope.usersWithSiteRoles.users.size(),this.numSelectedServerAdmins=this.$scope.usersWithSiteRoles.serverAdmins.length},t.prototype.getOriginalCheckboxStateForSite=function(t){return this.userCountsAndRolesBySiteId[t]?this.userCountsAndRolesBySiteId[t].count===this.$scope.usersWithSiteRoles.users.size()?e.CheckboxState.checked:e.CheckboxState.mixed:e.CheckboxState.empty},t.$inject=["$scope","ServerService","SiteNames","BrowserSupportService","SliceableFactory"],t}();e.SiteRolesPickerCtrl=t,e.Module.instance().controller("SiteRolesPickerCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i,o,s,a,c,l){var u=this;this.$scope=e,this.$q=t,this.$translate=r,this.toaster=n,this.serverAdminUpdateActionNotification=i,this.siteMembershipUpdateActionNotification=o,this.rolesPickerClient=a,this.serverUsers=c,this.userActionNotification=l,this.$scope.siteRoleChanges={siteRoles:{},serverAdmin:void 0},this.$scope.addActiveDirectoryUsers=function(e){return u.importUsers(e)}}return t.prototype.importUsers=function(t){var r=this;return this.$scope.busy=!0,this.$scope.usersToAdd=e.UsernameHelpers.splitUsernames(t),this.serverUsers.importUsersFromActiveDirectory(this.$scope.usersToAdd).then(function(t){var n=e.Set.fromIdItemArray(t.users),i=r.$q.when({});return!r.$scope.siteRoleChanges.serverAdmin&&_.isEmpty(r.$scope.siteRoleChanges.siteRoles)?r.userActionNotification.notify({users:n,results:t.results,errors:t.errors,successCode:"10"}):i=r.setRoles(n).then(function(){return t.errors&&t.errors.length>0&&r.userActionNotification.notifyErrors({users:n,errors:t.errors
}),{}}),i.then(function(){return r.$scope.$emit(e.UserAddedEvent)})}).then(function(){return r.$scope.close({})})},t.prototype.setRoles=function(e){return e.isEmpty()?this.$q.when({}):this.$scope.siteRoleChanges.serverAdmin?this.updateServerAdmin(e):_.isEmpty(this.$scope.siteRoleChanges.siteRoles)?void 0:this.updateSiteMembership(e)},t.prototype.updateServerAdmin=function(t){var r=this.$scope.siteRoleChanges.serverAdmin===e.CheckboxState.checked;return this.rolesPickerClient.updateServerAdmin(t,r)},t.prototype.updateSiteMembership=function(e){var t=this,r=e.keys(),n=this.rolesPickerClient.siteRoleChangesToParams(r,this.$scope.siteRoleChanges.siteRoles);return this.rolesPickerClient.updateServerUsersSiteMembership(n).then(function(i){var o=n.addToSiteRoles.length>0?t.$scope.siteRoleChanges.siteRoles[n.addToSiteRoles[0].siteId].siteName:"",s=n.removeFromSiteIds.length>0?t.$scope.siteRoleChanges.siteRoles[n.removeFromSiteIds[0]].siteName:"";t.siteMembershipUpdateActionNotification.notify(i,e,r.length,e.get(r[0]),n.addToSiteRoles.length,o,n.removeFromSiteIds.length,s)})},t.$inject=["$scope","$q","$translate","ToasterService","ServerAdminUpdateActionNotification","SiteMembershipUpdateActionNotification","SiteRoles","SiteRolesPickerClientService","ServerUsers","UserActionNotification"],t}();e.AddActiveDirectoryServerUsersDialogCtrl=t,e.Module.instance().controller("AddActiveDirectoryServerUsersDialogCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n){this.$translate=e,this.ConfirmActionDialog=t,this.modal=r,this.siteUsers=n}return t.prototype.showAddActiveDirectoryUsersToSiteDialog=function(t){var r=this,n=this.modal.open({scope:t,templateUrl:"addActiveDirectorySiteUsersDialog.html",size:e.ModalSize.fitToContent,controller:e.AddActiveDirectorySiteUsersDialogCtrl,resolve:{availableQuota:function(){return r.siteUsers.getRemainingUserQuota()}}});return n.result},t.prototype.showAddActiveDirectoryUsersToServerDialog=function(t){var r=this.modal.open({scope:t,templateUrl:"addActiveDirectoryServerUsersDialog.html",size:e.ModalSize.fitToContent,controller:e.AddActiveDirectoryServerUsersDialogCtrl});return r.result},t.$inject=["$translate","ConfirmActionDialog","ModalService","SiteUsers"],t}();e.AddActiveDirectoryUsersAction=t,e.Module.instance().service("AddActiveDirectoryUsersAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t,r=/^[^@ ]+@[^@ ]+$/;!function(e){function t(e){return r.test(e)}function n(e){return _.reject(e,t)}e.isValidEmail=t,e.getInvalidEmails=n}(t=e.EmailValidationHelper||(e.EmailValidationHelper={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(e){return _.chain(e.split(/[;,\r\n]+/)).map(function(e){return e.trim()}).compact().unique().value()},r=function(){function r(e,t,r,n,i,o,s){this.$translate=e,this.$q=t,this.ConfirmActionDialog=r,this.Toaster=n,this.SiteUsers=i,this.SiteRolesUpdateActionNotification=o,this.Server=s}return r.prototype.showAddExternalUsersToSiteDialog=function(r){var n=this,i=this.configureScope(r),o=this.ConfirmActionDialog.open({scope:i,bodyTemplateUrl:"confirmActionDialogAddExternalUsers.html",title:this.$translate.instant("addExternalUsersTitle"),actionName:this.$translate.instant("addUsersDialogSubmit"),action:function(){var r=t(i.input.text);return i.invalidEmails=e.EmailValidationHelper.getInvalidEmails(r),i.invalidEmails.length>0?n.$q.reject():i.input.thirdPartyUsers?n.SiteUsers.importThirdPartyUsers(r,i.siteRoleSelect.model):n.SiteUsers.importExternalUsers(r,i.siteRoleSelect.model)},size:e.ModalSize.fitToContent});return o.result.then(function(e){n.handleImportResult(e,i)}).fin(function(){return i.$destroy()}),o.result},r.prototype.configureScope=function(t){var r=this,n=t.$new();return n.showAuthenticationSelector=this.Server.isThirdPartyAuthEnabled(),n.input={text:"",thirdPartyUsers:this.Server.isThirdPartyAuthEnabled()},n.siteRoleSelect={options:e.SiteRoles.WithoutGuestOrServerAdmin,model:e.ServerApi.SiteRoles.Interactor},this.SiteUsers.getRemainingUserQuota().then(function(t){n.userQuotaMessage=_.isNumber(t)?r.$translate.instant("availableQuota",{NUM_USERS:t},e.L10n.Interpolations.Count):null}),n},r.prototype.handleImportResult=function(t,r){if(t.errors.length>0&&this.Toaster.pop({type:e.ToastType.Error,text:this.$translate.instant("addUsersFailed")}),t.users.length>0){var n=e.Set.fromIdItemArray(t.users);this.Toaster.pop({type:e.ToastType.Info,text:this.$translate.instant("usersAdded",{USER_NAME:e.L10n.elideIfLong(n.first().displayName),USER_COUNT:n.size()},e.L10n.Interpolations.Count)}),r.$emit(e.UserAddedEvent)}},r.$inject=["$translate","$q","ConfirmActionDialog","ToasterService","SiteUsers","SiteRolesUpdateActionNotification","ServerService"],r}();e.AddExternalUsersAction=r,e.Module.instance().service("AddExternalUsersAction",r)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbCheckboxTristate",function(){return{restrict:"E",replace:!0,require:"?ngModel",templateUrl:"checkboxTristate.html",scope:{state:"&",click:"&"},link:function(t,r,n,i){t.toggle=function(){r.hasClass("tb-disabled")||(i&&(i.$setViewValue(e.CheckboxState.toggle(i.$viewValue)),i.$render()),t.click())},i&&(t.state=function(){return i.$viewValue})}}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.SiteRolesEvent={SiteRolesChanged:"SiteRolesChanged"};var t=function(){function t(t,r,n,i,o,s,a){var c=this;this.$scope=t,this.$q=r,this.$translate=n,this.serverUsers=i,this.siteMembershipUpdateActionNotification=o,this.rolesPickerClient=s,this.toaster=a,t.applyCancelButtons={applyString:n.instant("save"),cancelString:n.instant("cancel"),apply:function(){return c.apply()},cancel:function(){return t.dismiss()},disableApply:function(){return!c.isDirty()||t.busy},disableCancel:function(){return t.busy},isBusy:function(){return t.busy}};var l=t.users.size()>0?t.users.first().displayName:"";t.editSiteMembershipDescription=n.instant("editSiteMembershipDescription",{USER_COUNT:t.users.size(),USER_NAME:e.L10n.elideIfLong(l)},e.L10n.Interpolations.Count),t.changes={siteRoles:{},serverAdmin:void 0},t.usersWithSiteRoles=null,t.busy=!1,t.haveSelectedUsers=function(){return t.users.size()>0},this.getSiteRolesForSelectedUsers()}return t.prototype.apply=function(){var t=this,r=this.$scope;r.busy=!0;var n,i=_.clone(r.users);if(void 0!==r.changes.serverAdmin)n=this.updateServerAdmin(i).then(function(){return r.changes.serverAdmin!==e.CheckboxState.empty||_.isEmpty(r.changes.siteRoles)?void 0:t.updateSiteMembership(i)});else{var o=e.SiteRolesPickerCtrl.adminStateFromUsers(this.getServerAdminCount(),r.users.size());o!==e.CheckboxState.empty||_.isEmpty(r.changes.siteRoles)||(n=this.updateSiteMembership(i))}return n.then(function(t){r.$emit(e.SiteRolesEvent.SiteRolesChanged),r.close(t)})},t.prototype.getServerAdminCount=function(){return this.$scope.usersWithSiteRoles?this.$scope.usersWithSiteRoles.serverAdmins.length:0},t.prototype.isDirty=function(){var t=this.$scope,r=e.SiteRolesPickerCtrl.adminStateFromUsers(this.getServerAdminCount(),t.users.size()),n=t.changes.serverAdmin&&t.changes.serverAdmin!==r,i=r===e.CheckboxState.empty&&!_.isEmpty(t.changes.siteRoles);return n||i},t.prototype.updateServerAdmin=function(t){var r=this;return this.getServerAdmins(t.keys()).then(function(n){var i,o=r.$scope.changes.serverAdmin===e.CheckboxState.checked;return i=o?t.filter(function(e){return!_.contains(n,e.id)}):t.filter(function(e){return _.contains(n,e.id)}),r.rolesPickerClient.updateServerAdmin(i,o)})},t.prototype.updateSiteMembership=function(e){var t=this,r=e.keys(),n=this.rolesPickerClient.siteRoleChangesToParams(r,this.$scope.changes.siteRoles);return this.rolesPickerClient.updateServerUsersSiteMembership(n).then(function(i){var o=n.addToSiteRoles.length>0?t.$scope.changes.siteRoles[n.addToSiteRoles[0].siteId].siteName:"",s=n.removeFromSiteIds.length>0?t.$scope.changes.siteRoles[n.removeFromSiteIds[0]].siteName:"";t.siteMembershipUpdateActionNotification.notify(i,e,r.length,e.get(r[0]),n.addToSiteRoles.length,o,n.removeFromSiteIds.length,s)})},t.prototype.getSiteRolesForSelectedUsers=function(){var e=this;if(0===this.$scope.users.size())return this.$q.when({});var t=this.$scope.users.keys();return this.serverUsers.getSiteRoles(t).then(function(r){var n={users:e.$scope.users,userRoles:r.users,serverAdmins:[]};return e.getServerAdmins(t).then(function(t){n.serverAdmins=t,e.$scope.usersWithSiteRoles=n})})},t.prototype.getServerAdmins=function(t){var r=this,n=[];return this.serverUsers.getByUserIds(t).then(function(t){return _.each(t.items,function(t){t.maxSiteRole===e.ServerApi.SiteRoles.ServerAdministrator&&n.push(t.id)}),r.$q.when(n)})},t.$inject=["$scope","$q","$translate","ServerUsers","SiteMembershipUpdateActionNotification","SiteRolesPickerClientService","ToasterService"],t}();e.SiteMembershipDialogCtrl=t,e.Module.instance().controller("SiteMembershipDialogCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(t){function r(){t.call(this,r.usernameSelector)}return __extends(r,t),r.singleton=function(t){return e.Set.singleton(t,r.usernameSelector)},r.usernameSelector=function(e){return e.username+(e.domainName?e.domainName:"")},r}(e.Set);e.SetOfUsers=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"checkUserNames",t)}return __extends(t,e),t}(e.Request);e.CheckUserNamesRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(t){function r(r,n){t.call(this,n.getServerResourceFetcher(e.ServerApi.GetUsersRequest,function(e){return e.users})),this.server=r}return __extends(r,t),r.prototype.checkUserNames=function(t){return this.server.sendRequests(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.CheckUserNamesRequest({usernames:t})}),function(t){return{errors:e.ResultHelper.combineErrors(t),users:e.ResultHelper.combine(t,function(e){return e.users})}})},r.prototype.getUserByUsernameAndDomain=function(t,r){return this.all().addFilter(e.Filter.stringFieldEq("username",t)).addFilter(e.Filter.stringFieldEq("domainName",r)).getFirst()},r.AdminsOnlyFilter=e.Filter.stringFieldInArray(e.ServerApi.FilterFieldNames.siteRole,[e.ServerApi.SiteRoles.ServerAdministrator,e.ServerApi.SiteRoles.SiteAdministrator]),r.WithoutGuestFilter=e.Filter.stringFieldInArray(e.ServerApi.FilterFieldNames.siteRole,_.without(e.SiteRoles.All,e.ServerApi.SiteRoles.Guest,e.ServerApi.SiteRoles.Unlicensed)),r.$inject=["ServerService","FetcherFactory"],r}(e.Resource);e.Users=t,e.Module.instance().service("Users",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.AddLocalUserFormState={Initial:"initial",NewUser:"newUser",OtherSite:"otherSite",NotAvailable:"notAvailable"};var t=function(){function t(t,r,n,i,o,s,a,c,l,u,d,p,h,f,m,v){var S=this;if(this.$scope=t,this.$q=r,this.$translate=n,this.addUserToSiteActionNotification=i,this.userActionNotification=o,this.mode=s,this.ServerUsers=a,this.serverAdminUpdateActionNotification=c,this.siteMembershipUpdateActionNotification=l,this.siteRoles=u,this.rolesPickerClient=d,this.siteRolesUpdateActionNotification=p,this.SiteUsers=h,this.toaster=f,this.Users=m,this.availableQuota=v,t.mode=s,t.isServerMode=function(){return"server"===t.mode},t.isSiteMode=function(){return"site"===t.mode},t.isServerMode())t.siteRoleChanges={siteRoles:{},serverAdmin:void 0};else{if(!t.isSiteMode())throw new Error('Unknown mode, it is neither "site" or "server"');t.siteRoleOptions=u.optionsForCurrentUser(),t.siteRole=0>=v?e.ServerApi.SiteRoles.Unlicensed:e.ServerApi.SiteRoles.Interactor,t.setSiteRole=function(e){t.siteRole=e}}t.formModel={username:"",formState:e.AddLocalUserFormState.Initial,errorText:"",newUserFlowModel:{authId:"",displayName:"",password:"",confirmPassword:"",email:"",usernameInfo:""},otherSiteFlowModel:{displayName:"",warningText:"",proceedClicked:!1},notAvailableFlowModel:{displayName:"",errorText:""}},t.proceed=function(){S.getOtherSiteFlowModel().proceedClicked=!0},t.proceedClicked=function(){return S.getOtherSiteFlowModel().proceedClicked},t.confirm=function(){S.confirm()},t.isConfirmDisabled=function(){return S.isConfirmDisabled()},t.checkDoesUsernameExists=function(r){m.checkUserNames([r]).then(function(r){if(0===r.users.length)return void(t.formModel.formState=e.AddLocalUserFormState.Initial);var n=r.users[0];t.isSiteMode()&&n.existsOnSite?S.setupFormForNotAvailable(n.displayName,"usernameExistsOnCurrentSite"):n.existsOnServer?t.isSiteMode()?S.setupFormForAddUserToSite(n.displayName):S.setupFormForNotAvailable(n.displayName,"usernameExistsOnServer"):S.setupFormForAvailable()})},t.passwordFieldsAreNonEmpty=function(){var e=t.formModel.newUserFlowModel;return e.password&&e.confirmPassword&&e.password.length>0&&e.confirmPassword.length>0},t.availableQuota=v,t.isSiteRoleOptionDisabled=function(t){return 0>=v&&t!==e.ServerApi.SiteRoles.Unlicensed&&t!==e.ServerApi.SiteRoles.UnlicensedWithPublish},t.isQuotaEnabledForSite=_.isNumber(v)}return t.prototype.setupFormForAddUserToSite=function(t){this.$scope.formModel.formState=e.AddLocalUserFormState.OtherSite,this.getOtherSiteFlowModel().displayName=t,this.getOtherSiteFlowModel().warningText=this.$translate.instant("usernameExistsOnAnotherSite",{USER_NAME:e.L10n.elideIfLong(t)}),this.getOtherSiteFlowModel().proceedClicked=!1},t.prototype.setupFormForNotAvailable=function(t,r){this.$scope.formModel.formState=e.AddLocalUserFormState.NotAvailable,this.getNotAvailableFlowModel().displayName=t,this.getNotAvailableFlowModel().errorText=this.$translate.instant(r,{USER_NAME:e.L10n.elideIfLong(t)})},t.prototype.setupFormForAvailable=function(){this.$scope.formModel.formState=e.AddLocalUserFormState.NewUser,this.getNewUserFlowModel().usernameInfo=this.$translate.instant("usernameAvailable")},t.prototype.confirm=function(){this.$scope.busy=!0;var t=this.$scope.formModel.username;switch(this.getFormState()){case e.AddLocalUserFormState.NewUser:this.$scope.isSiteMode()?this.createLocalSiteUser(t,this.getNewUserFlowModel()):this.$scope.isServerMode()&&this.createLocalServerUser(t,this.getNewUserFlowModel());break;case e.AddLocalUserFormState.OtherSite:this.addUserToSite(t,this.getOtherSiteFlowModel())}},t.prototype.isConfirmDisabled=function(){if(this.$scope.busy)return!0;if(this.$scope.addLocalUserForm.$invalid)return!0;switch(this.getFormState()){case e.AddLocalUserFormState.Initial:case e.AddLocalUserFormState.NewUser:return!1;case e.AddLocalUserFormState.OtherSite:return!this.getOtherSiteFlowModel().proceedClicked;case e.AddLocalUserFormState.NotAvailable:return!0}return!1},t.prototype.createLocalSiteUser=function(t,r){var n=this,i=this.$scope.siteRole,o=i===e.ServerApi.SiteRoles.ServerAdministrator||null;o&&(i=null),this.SiteUsers.createLocalUser(t,r.displayName,r.email,r.password,o,i).then(function(t){n.showNotificationForCreateUser(t),t.errors&&t.errors.length>0?n.reenableButtons():(n.$scope.$emit(e.UserAddedEvent),n.$scope.close(t))})},t.prototype.createLocalServerUser=function(e,t){var r=this;this.ServerUsers.createLocalServerUser(e,t.displayName,t.email,t.password).then(function(e){r.showNotificationForCreateUser(e),e.errors&&e.errors.length>0?r.reenableButtons():r.onServerUserCreateSuccess(e)})},t.prototype.onServerUserCreateSuccess=function(t){this.$scope.$emit(e.UserAddedEvent);var r={id:t.users[0].id,authId:t.users[0].authId,username:t.users[0].username,displayName:t.users[0].displayName};this.$scope.siteRoleChanges.serverAdmin?this.updateServerAdmin(r):_.isEmpty(this.$scope.siteRoleChanges.siteRoles)||this.updateSiteMembership(r.id,r.authId,r.username,r.displayName),this.$scope.close(t)},t.prototype.updateServerAdmin=function(t){var r=this,n=e.SetOfUsers.singleton(t),i=this.$scope.siteRoleChanges.serverAdmin===e.CheckboxState.checked;this.rolesPickerClient.updateServerAdmin(n,i).then(function(){r.$scope.$emit(e.SiteRolesEvent.SiteRolesChanged)})},t.prototype.updateSiteMembership=function(t,r,n,i){var o=this,s=this.rolesPickerClient.siteRoleChangesToParams([t],this.$scope.siteRoleChanges.siteRoles);this.rolesPickerClient.updateServerUsersSiteMembership(s).then(function(a){var c=s.addToSiteRoles.length>0?o.$scope.siteRoleChanges.siteRoles[s.addToSiteRoles[0].siteId].siteName:"",l={id:t,authId:r,username:n,displayName:i},u=e.SetOfUsers.singleton(l);o.siteMembershipUpdateActionNotification.notify(a,u,1,l,s.addToSiteRoles.length,c,0,""),o.$scope.$emit(e.SiteRolesEvent.SiteRolesChanged)})},t.prototype.updateSiteRole=function(t){var r=this,n=this.$scope.siteRole,i=[t.id],o=e.SetOfUsers.singleton(t);n===e.ServerApi.SiteRoles.ServerAdministrator?this.SiteUsers.updateServerAdminStatusAndDelay(i,!0).then(function(t){r.serverAdminUpdateActionNotification.notify(t,o,!0),r.$scope.$emit(e.SiteRolesEvent.SiteRolesChanged)}):this.SiteUsers.updateUsersSiteRole(i,n).then(function(t){r.siteRolesUpdateActionNotification.notify(t,o,n),r.$scope.$emit(e.SiteRolesEvent.SiteRolesChanged)})},t.prototype.addUserToSite=function(t,r){var n=this,i=this.$scope.siteRole,o=!1;i===e.ServerApi.SiteRoles.ServerAdministrator&&(o=!0,i=e.ServerApi.SiteRoles.Unlicensed),this.SiteUsers.addUsersToSite([t],i).then(function(r){if(n.showNotificationForAddUserToSite(r,t,i),r.errors&&r.errors.length>0)n.reenableButtons();else{var s=o?n.promoteToServerAdmin(t):n.$q.when({});s.then(function(t){t.errors&&t.errors.length>0?n.reenableButtons():(n.$scope.$emit(e.UserAddedEvent),n.$scope.close(r))})}})},t.prototype.promoteToServerAdmin=function(t){var r,n=this;return this.ServerUsers.getUserByUsernameAndDomain(t,"local").then(function(e){return r=e,n.ServerUsers.updateServerAdminStatus([e.id],!0)}).then(function(t){return n.serverAdminUpdateActionNotification.notify(t,e.SetOfUsers.singleton(r),!0),t})},t.prototype.reenableButtons=function(){this.$scope.busy=!1},t.prototype.getFormState=function(){return this.$scope.formModel.formState},t.prototype.showNotificationForCreateUser=function(t){var r=this,n={users:e.Set.fromIdItemArray(t.users),results:t.results,errors:t.errors,successCode:"30",showErrorMsgFunc:function(e){r.$scope.formModel.errorText=e}};this.userActionNotification.notify(n)},t.prototype.showNotificationForAddUserToSite=function(e,t,r){var n=this;this.addUserToSiteActionNotification.notify(function(e){n.$scope.formModel.errorText=e},e,t,r)},t.prototype.isNewUserFlow=function(){return this.getFormState()===e.AddLocalUserFormState.NewUser},t.prototype.getNewUserFlowModel=function(){return this.$scope.formModel.newUserFlowModel},t.prototype.isOtherSiteFlow=function(){return this.getFormState()===e.AddLocalUserFormState.OtherSite},t.prototype.getOtherSiteFlowModel=function(){return this.$scope.formModel.otherSiteFlowModel},t.prototype.getNotAvailableFlowModel=function(){return this.$scope.formModel.notAvailableFlowModel},t.$inject=["$scope","$q","$translate","AddUserToSiteActionNotification","UserActionNotification","mode","ServerUsers","ServerAdminUpdateActionNotification","SiteMembershipUpdateActionNotification","SiteRoles","SiteRolesPickerClientService","SiteRolesUpdateActionNotification","SiteUsers","ToasterService","Users","availableQuota"],t}();e.AddLocalUserDialogCtrl=t,e.Module.instance().controller("AddLocalUserDialogCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t){this.modal=e,this.siteUsers=t}return t.prototype.showAddLocalUserDialogForSite=function(t){var r=this,n=this.modal.open({scope:t,templateUrl:"addLocalUserDialog.html",size:e.ModalSize.fitToContent,controller:e.AddLocalUserDialogCtrl,resolve:{mode:function(){return"site"},availableQuota:function(){return r.siteUsers.getRemainingUserQuota()}}});return n.result},t.prototype.showAddLocalUserDialogForServer=function(t){var r=this.modal.open({scope:t,templateUrl:"addLocalUserDialog.html",size:e.ModalSize.fitToContent,controller:e.AddLocalUserDialogCtrl,resolve:{mode:function(){return"server"},availableQuota:function(){return void 0}}});return r.result},t.$inject=["ModalService","SiteUsers"],t}();e.AddLocalUserAction=t,e.Module.instance().service("AddLocalUserAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.UserAddedEvent="UserAddedEvent";var t=function(){function t(e,t){this.modal=e,this.serverService=t}return t.prototype.showAddSiteUsersOptionsDialog=function(e){var t=this.createDialogInstance(e,r);return t.result},t.prototype.showAddServerUsersOptionsDialog=function(e){var t=this.createDialogInstance(e,n);return t.result},t.prototype.createDialogInstance=function(t,r){var n=this;return this.modal.open({scope:t.scope,templateUrl:"addUsersOptionsDialog.html",size:e.ModalSize.fitToContent,position:_.extend(e.ModalService.anchoredTo(t.targetElement)),controller:r,resolve:{domainFamily:function(){return n.serverService.domainFamily()}}})},t.$inject=["ModalService","ServerService"],t}();e.AddUsersOptionsAction=t,e.Module.instance().service("AddUsersOptionsAction",t);var r=function(){function t(t,r,n,i,o,s,a){t.title="addUsersToSite",a===e.ServerApi.DomainFamily.Local&&(t.addLocalUser=function(){r.showAddLocalUserDialogForSite(t.$parent),t.close({})}),a===e.ServerApi.DomainFamily.ActiveDirectory&&(t.importAdUser=function(){i.showAddActiveDirectoryUsersToSiteDialog(t.$parent),t.close({})},t.importAdGroup=function(){n.showAddAdGroupDialog(t.$parent),t.close({})}),a===e.ServerApi.DomainFamily.External&&(t.importExternalUser=function(){o.showAddExternalUsersToSiteDialog(t.$parent),t.close({})}),t.importFromBulk=function(){s.showBulkImportSiteUsersDialog(t.$parent),t.close({})}}return t.$inject=["$scope","AddLocalUserAction","ActiveDirectoryGroupAction","AddActiveDirectoryUsersAction","AddExternalUsersAction","BulkImportUsersAction","domainFamily"],t}();e.AddSiteUsersOptionsDialogCtrl=r;var n=function(){function t(t,r,n,i,o){t.title="addUsersToServer",o===e.ServerApi.DomainFamily.Local&&(t.addLocalUser=function(){r.showAddLocalUserDialogForServer(t.$parent),t.close({})}),o===e.ServerApi.DomainFamily.ActiveDirectory&&(t.importAdUser=function(){n.showAddActiveDirectoryUsersToServerDialog(t.$parent),t.close({})}),t.importFromBulk=function(){i.showBulkImportServerUsersDialog(t.$parent),t.close({})}}return t.$inject=["$scope","AddLocalUserAction","AddActiveDirectoryUsersAction","BulkImportUsersAction","domainFamily"],t}();e.AddServerUsersOptionsDialogCtrl=n,e.Module.instance().controller("AddSiteUsersOptionsDialogCtrl",r),e.Module.instance().controller("AddServerUsersOptionsDialogCtrl",n)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e){this.modalService=e}return t.prototype.showEditSiteMembershipDialog=function(t,r){var n=r.scope.$new(!0);n.users=t;var i=this.modalService.open({scope:n,templateUrl:"siteMembershipDialog.html",size:e.ModalSize.fitToContent,controller:e.SiteMembershipDialogCtrl});return i.result.fin(function(){return n.$destroy()})},t.$inject=["ModalService"],t}();e.EditSiteMembershipAction=t,e.Module.instance().service("EditSiteMembershipAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r){this.DeleteUsersFromServerAction=e,this.EditSiteMembershipAction=t,this.serverService=r,this.serverUsersActionDefinition=[this.editSiteMembershipAction(),this.deleteUsersFromServerAction()]}return t.prototype.getServerUsersActionsButtons=function(){return this.serverUsersActionDefinition},t.prototype.editSiteMembershipAction=function(){var t=this;return{name:"siteMembership",isAvailable:function(e){return t.canEditSiteMembership(e)},execute:function(r,n){var i=n.scope;t.EditSiteMembershipAction.showEditSiteMembershipDialog(r,n).then(function(t){t&&e.ActionHelpers.deselectNotFound(i.selectedItems,t,e.CommonErrorCode.SystemUserNotFound)})}}},t.prototype.canEditSiteMembership=function(e){return e.size()>0&&!t.isSingleSelectAndGuest(e)},t.prototype.deleteUsersFromServerAction=function(){var t=this;return{name:"delete",isAvailable:function(e){return t.canDelete(e)},execute:function(r,n){var i=n.scope;t.DeleteUsersFromServerAction.showDeleteUsersFromServerDialog(r,n).then(function(t){t&&(e.ActionHelpers.deselectAllExceptErrors(i.selectedItems,t,e.CommonErrorCode.SystemUserNotFound),i.refreshItems())})}}},t.prototype.canDelete=function(e){return e.size()>0&&!t.isSingleSelectAndGuest(e)},t.isSingleSelectAndGuest=function(t){return 1===t.size()&&t.first().maxSiteRole===e.ServerApi.SiteRoles.Guest},t.$inject=["DeleteUsersFromServerAction","EditSiteMembershipAction","ServerService"],t}();e.ServerUsersActions=t,e.Module.instance().service("ServerUsersActions",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(r,n,i,o,s,a,c,l,u,d,p,h,f){var m=this;this.$scope=r,this.$translate=n,this.AngularToReactDataGridBridge=i,this.siteRoleFilter=o,this.serverService=u,this.users=d;var v=p.getServerUsersActionsButtons();e.FeatureFlags.reactServerUsersGrid&&this.configureForReactDataGrid(v),a.setTitle("serverUsers"),r.server=u,r.selectedItems=new e.Set(function(e){return e.id}),r.availableAction=function(e){return e.isAvailable(r.selectedItems)},e.ActionButtonsHelper.setupActionButtons(r,v),r.listActions=[{name:"add-users",translate:"addUsers",isAvailable:function(){return!0},execute:function(t){s.showAddServerUsersOptionsDialog(e.ActionContext.fromEvent(t))}}],r.availableListAction=function(e){return e.isAvailable()},r.rowClicked=function(e,t){l.rowClicked(r.selectedItems,e,t)},r.filterControls={},r.filterDefinitions=f.getFilterDefinitions(["maxSiteRole"]),this.maxSiteRoleFilterDefinition=r.filterDefinitions[0],r.sorter=h.create(e.ServerUserContentType.defaultOrder);var S=c.createQueryUpdater(r,e.ServerUserContentType,d,function(t){e.FeatureFlags.reactServerUsersGrid&&m.AngularToReactDataGridBridge.updateReactDataGridRowStore({scope:m.$scope,sliceable:t}),r.sliceable=t,r.sorter.setOrder(t.getOrder()),m.updateMaxSiteRoleCounts(t),t.getCount().then(function(e){m.$scope.model.itemsCount=e})},{});r.sliceChanged=function(e){r.selectedItems.updateItems(e.items),r.model.itemsCount=e.total},r.refreshItems=function(){S.refresh()},r.refreshItems(),r.placeTitleClicked=function(){r.refreshItems()},r.$on(e.UserAddedEvent,function(){r.refreshItems()}),r.$on(e.SiteRolesEvent.SiteRolesChanged,function(){r.refreshItems()}),r.headerClicked=function(e){return r.sorter.setPrimary(e.attrs.key,e.attrs.direction)},r.model={itemsCount:0},r.emptyTemplateModel=t.emptyTemplateModel}return t.prototype.configureForReactDataGrid=function(e){var r=this;this.$scope.useReactDataGrid=!0;var n=VizPortalReact.ServerUsersGrid.columns(function(e){return r.$translate.instant(e)},this.$scope,new VizPortalReact.ServerUrls(window.location.search),this.siteRoleFilter,e,this.serverService.isServerDomainFamilyActiveDirectory());this.AngularToReactDataGridBridge.attachReactDataGridToScope(this.$scope,n,t.emptyTemplateModel)},t.prototype.updateMaxSiteRoleCounts=function(t){var r=this;this.users.getUserCountsByMaxSiteRole(t).then(function(t){r.maxSiteRoleFilterDefinition.options=e.SiteRoleFilterHelper.siteRoleOptions(e.SiteRoles.WithoutGuest,t)})},t.$inject=["$scope","$translate","AngularToReactDataGridBridge","siteRoleFilter","AddUsersOptionsAction","BrowserTitleService","QueryService","SelectionService","ServerService","ServerUsers","ServerUsersActions","SorterFactory","FilterPanelService"],t.emptyTemplateModel={title:"usersEmptyMessage"},t}();e.ServerUsersPlaceCtrl=t,e.Module.instance().controller("ServerUsersPlaceCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e){this.server=e}return t.prototype.fetch=function(){return this.server.sendRequest(new e.ServerApi.GetServerSettingsRequest({})).then(function(e){return e.serverSettings})},t.prototype.updateBoolean=function(t,r){var n=new e.ServerApi.UpdateBooleanServerSettingRequest({setting:t,value:r});return this.server.sendRequest(n)},t.prototype.updateString=function(t,r){var n=new e.ServerApi.UpdateStringServerSettingRequest({setting:t,value:r});return this.server.sendRequest(n)},t.prototype.updateScheduleFrequency=function(t,r){var n=new e.ServerApi.UpdateScheduleFrequencyServerSettingRequest({setting:t,value:r});return this.server.sendRequest(n)},t.$inject=["ServerService"],t}();e.ServerSettings=t,e.Module.instance().service("ServerSettings",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"deleteUserRefreshTokens",t)}return __extends(t,e),t}(e.Request);e.ClearConnectedDevicesRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i){this.$translate=e,this.$q=t,this.ConfirmActionDialog=r,this.serverService=n,this.ToasterService=i}return t.prototype.showConfirmationDialog=function(t,r){var n=this,i=this.ConfirmActionDialog.open({title:this.$translate.instant("clearConnectedDevices"),bodyText:this.$translate.instant("clearConnectedDevicesConfirmMessage",{TOKEN_COUNT:r},e.L10n.Interpolations.Count),actionName:this.$translate.instant("clearConnectedDevicesConfirmButton"),isDeleteAction:!0,action:function(r){var i={userId:t};return n.serverService.sendRequest(new e.ServerApi.ClearConnectedDevicesRequest(i)).then(e.ResultHelper.rejectResultOnError(n.$q)).then(_.identity,function(){return r.showErrorMessage(n.$translate.instant("clearConnectedDevicesError"))})}});return i.result.then(function(t){n.ToasterService.pop({type:e.ToastType.Info,text:n.$translate.instant("clearConnectedDevicesSuccess")})}),i.result},t.$inject=["$translate","$q","ConfirmActionDialog","ServerService","ToasterService"],t}();e.ClearConnectedDevicesAction=t,e.Module.instance().service("ClearConnectedDevicesAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"changeUserPassword",t)}return __extends(t,e),t}(e.Request);e.ChangeUserPasswordRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"updateUserEmail",t)}return __extends(t,e),t}(e.Request);e.UpdateUserEmailRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"updateUserDisplayName",t)}return __extends(t,e),t}(e.Request);e.UpdateUserDisplayNameRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"updateUserLanguage",t)}return __extends(t,e),t}(e.Request);e.UpdateUserLanguageRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"updateUserLocale",t)}return __extends(t,e),t}(e.Request);e.UpdateUserLocaleRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"updateUserStartPage",t)}return __extends(t,e),t}(e.Request);e.UpdateUserStartPageRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e){this.ErrorNotifyingServer=e,this.server=e.getServerService()}return t.prototype.updateUserDisplayName=function(t,r){var n={userId:t,displayName:r};return this.ErrorNotifyingServer.sendRequestAndDelay(new e.ServerApi.UpdateUserDisplayNameRequest(n))},t.prototype.updateUserEmail=function(t,r){var n={userId:t,email:r};return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.UpdateUserEmailRequest(n))},t.prototype.updateUserEmailAndDelay=function(t,r){var n={userId:t,email:r};return this.ErrorNotifyingServer.sendRequestAndDelay(new e.ServerApi.UpdateUserEmailRequest(n))},t.prototype.updateUserLanguage=function(t,r){var n={userId:t,language:r};return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.UpdateUserLanguageRequest(n));
},t.prototype.updateUserLocale=function(t,r){var n={userId:t,locale:r};return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.UpdateUserLocaleRequest(n))},t.prototype.updateUserStartPage=function(r,n){var i={startPage:n};return r!==t.SameUserId&&(i.userId=r),this.ErrorNotifyingServer.sendRequest(new e.ServerApi.UpdateUserStartPageRequest(i))},t.prototype.updateCurrentUsersStartPage=function(t){var r={startPage:t};return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.UpdateUserStartPageRequest(r))},t.prototype.resetUserStartPage=function(e){return this.updateUserStartPage(e,t.ResetStartPage)},t.prototype.changeUserPassword=function(t,r,n){var i=this;return this.server.sendRequest(new e.ServerApi.GeneratePublicKeyRequest).then(function(o){var s,a=o.key,c=o.keyId;n&&n.length>0&&(s=rsa.encrypt(n,a));var l=rsa.encrypt(r,a),u=new e.ServerApi.ChangeUserPasswordRequest({userId:t,oldEncryptedPassword:s,newEncryptedPassword:l,keyId:c});return i.ErrorNotifyingServer.sendRequest(u)})},t.$inject=["ErrorNotifyingServer"],t.ResetStartPage="unspecified",t.SameUserId=null,t}();e.UserSettings=t,e.Module.instance().service("UserSettings",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i,o){this.$translate=e,this.toaster=t,this.userSettings=r,this.confirmActionDialog=n,this.startPageService=i,this.server=o}return t.prototype.updateStartPage=function(t,r){var n=this;return this.userSettings.updateUserStartPage(t.id,r).then(function(r){return r&&!r.errors&&(n.toaster.pop({type:e.ToastType.Info,text:n.$translate.instant("userStartPageSuccess")}),n.fetchUserSettings(t.username,t.domainName)),r})},t.prototype.confirmChangeUserStartPage=function(){var e=this;this.confirmActionDialog.open({title:this.$translate.instant("userStartPageChange"),bodyText:this.$translate.instant("userStartPageConfirm"),actionName:this.$translate.instant("userStartPageButton"),action:function(t){return e.updateCurrentUsersStartPage(e.startPageService.getCurrentUrlAsStartPage()).then(function(r){(!r||r.errors)&&t.showErrorMessage(e.$translate.instant("userStartPageError"))})}})},t.prototype.confirmChangeDefaultStartPage=function(){var t=this;this.confirmActionDialog.open({title:this.$translate.instant("defaultStartPageChange"),bodyText:this.$translate.instant("defaultStartPageConfirm"),actionName:this.$translate.instant("defaultStartPageButton"),action:function(r){return t.server.sendRequest(new e.ServerApi.UpdateStringServerSettingRequest({setting:"defaultStartPage",value:t.startPageService.getCurrentUrlAsStartPage()})).then(function(n){!n||n.errors?r.showErrorMessage(t.$translate.instant("defaultStartPageError")):t.server.refreshSessionInfo().then(function(){t.toaster.pop({type:e.ToastType.Info,text:t.$translate.instant("defaultStartPageSuccess")})})})}})},t.prototype.updateCurrentUsersStartPage=function(t){var r=this;return this.userSettings.updateCurrentUsersStartPage(t).then(function(t){return t&&!t.errors&&(r.toaster.pop({type:e.ToastType.Info,text:r.$translate.instant("userStartPageSuccess")}),r.fetchCurrentUsersUserSettings()),t})},t.prototype.resetStartPage=function(t){var r=this;return this.userSettings.resetUserStartPage(t.id).then(function(n){return n&&!n.errors&&(r.toaster.pop({type:e.ToastType.Info,text:r.$translate.instant("resetStartPageSuccess")}),r.fetchUserSettings(t.username,t.domainName)),n})},t.prototype.fetchUserSettings=function(e,r){VizPortalReact.Dispatcher.instance.dispatch({actionType:t.FetchUserSettingsActionType,username:e,domain:r})},t.prototype.fetchCurrentUsersUserSettings=function(){VizPortalReact.Dispatcher.instance.dispatch({actionType:t.FetchUserSettingsActionType,username:this.server.sessionUsername(),domain:this.server.sessionUserDomainName()})},t.FetchUserSettingsActionType="fetch-user-settings",t.$inject=["$translate","ToasterService","UserSettings","ConfirmActionDialog","StartPageService","ServerService"],t}();e.UserSettingsActions=t,e.Module.instance().service("UserSettingsActions",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(t){function r(e,r,n,i){t.call(this),this.$q=e,this.serverService=r,this.serverUsers=n,this.userSettings=i,VizPortalReact.Dispatcher.instance.register(this.handleAction.bind(this))}return __extends(r,t),r.prototype.getUserSettings=function(e,t){return this.fetchUserSettings(e,t)},r.prototype.fetchUserSettings=function(e,t){var n=this;return this.serverUsers.getUserSettings(e,t).then(function(i){return n.maybeRefreshSessionInfo(e,t),n.broadcast(r.ChangeEvent,{username:e,domain:t,userSettings:i}),i})},r.prototype.handleAction=function(t){switch(t.actionType){case e.UserSettingsActions.FetchUserSettingsActionType:this.fetchUserSettings(t.username,t.domain)}},r.prototype.maybeRefreshSessionInfo=function(e,t){e===this.serverService.sessionUsername()&&t===this.serverService.sessionUserDomainName()&&this.serverService.refreshSessionInfo()},r.ChangeEvent="user-settings-changed",r.$inject=["$q","ServerService","ServerUsers","UserSettings"],r}(VizPortalReact.Store);e.UserSettingsStore=t,e.Module.instance().service("UserSettingsStore",t),e.Module.registerEagerService("UserSettingsStore")}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i,o,s,a){this.$q=e,this.$state=t,this.$translate=r,this.clearConnectedDevicesAction=n,this.serverService=i,this.startPageService=o,this.serverSettings=s,this.userSettingsStore=a}return t.prototype.initScope=function(t,r,n,i,o,s){var a=this;this.scope=t,this.setupUserSettingsChangeListener(),t.isDomainFamilyAD=this.serverService.isServerDomainFamilyActiveDirectory(),t.isDomainFamilyExternal=this.serverService.isServerDomainFamilyExternal(),t.isDomainFamilyLocal=this.serverService.isServerDomainFamilyLocal(),t.isViewerSelf=r,t.isViewerServerAdmin=this.serverService.isSessionServerAdmin(),t.changePasswordUrl=this.serverService.changePasswordUrl(),t.updateDisplayNameAllowed=this.serverService.updateDisplayNameAllowed(),t.controls={editDisplayNameControls:null,editEmailControls:null},t.userSettings=o,t.serverUser=n,t.disableNameAndEmailSaveButton=function(){var e=t.controls.editDisplayNameControls,r=t.controls.editEmailControls;return e||r?e&&e.isBusy()?!0:r&&r.isBusy()?!0:(r||!e||e.isDirty())&&(e||!r||r.isDirty())?e&&!e.isDirty()&&r&&!r.isDirty()?!0:e&&e.isDirty()&&!e.isValid()?!0:r&&r.isDirty()&&!r.isValid()?!0:!1:!0:!0},t.saveChangesToEmailAndDisplayName=function(){var r=t.controls.editDisplayNameControls,o=t.controls.editEmailControls,s=!!i&&i.authSetting===e.ServerApi.SiteUserAuthSetting.Saml,c=a.$q.when({});r&&r.isDirty()&&(c=r.submit(n.id,n.username));var l=a.$q.when({});o&&o.isDirty()&&(l=o.submit(n.id,n.username),s&&(l=l.then(function(e){a.$state.params.username=e}))),a.$q.all([c,l]).then(function(){return a.$state.hardReload()})},t.updateUserStartPage=function(e){if(!e){if(t.isViewerServerAdmin)return void a.serverSettings.fetch().then(function(e){var r=e.defaultStartPage||"/";t.updateUserStartPage(r)});e=a.serverService.getStartPage()}var r=a.serverService.sessionSiteUrlName();t.startPageText=e,t.startPageHref=a.startPageService.getStartPageForSite(e,r)},t.updateUserStartPage(t.userSettings.startPage),t.clearConnectedDevices=function(){return a.clearConnectedDevicesAction.showConfirmationDialog(n.id,s)}},t.prototype.updateUserSettingsOnScope=function(e){this.scope.userSettings=e,this.scope.updateUserStartPage(e.startPage)},t.prototype.isSameUser=function(e){var t=e.username,r=e.domain;return this.scope.serverUser.username===t&&this.scope.serverUser.domainName===r},t.prototype.setupUserSettingsChangeListener=function(){var t=this,r=function(r,n){r===e.UserSettingsStore.ChangeEvent&&t.isSameUser(n)&&t.updateUserSettingsOnScope(n.userSettings)};this.userSettingsStore.addChangeListener(r),this.scope.$on("$destroy",function(){t.userSettingsStore.removeChangeListener(r)})},t.$inject=["$q","$state","$translate","ClearConnectedDevicesAction","ServerService","StartPageService","ServerSettings","UserSettingsStore"],t}();e.UserSettingsCtrlCommon=t,e.Module.instance().service("UserSettingsCtrlCommon",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e,t,r,n,i,o,s){this.$scope=e,this.userSettingsCtrlCommon=r,t.setTitle("serverSettings",s.displayName),r.initScope(e,n,s,null,i,o)}return e.$inject=["$scope","BrowserTitleService","UserSettingsCtrlCommon","isSessionUserSelf","userSettings","userRefreshTokenCount","serverUser"],e}();e.ServerUserSettingsSubplaceCtrl=t,e.Module.instance().controller("ServerUserSettingsSubplaceCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){function t(e){return["$scope","BrowserTitleService",function(t,r){r.setTitle(e,t.objectName)}]}e.setBrowserTitleCtrl=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e,t,r,n){e.tryAgainLink=n.isAuthenticationExternal()?r.getLoginUrl():t.href("login.authenticate")}return e.$inject=["$scope","$state","ExternalAuthService","ServerService"],e}();e.SignedOutCtrl=t,e.Module.instance().controller("SignedOutCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(){}return e.Blank="_blank",e.Self="_self",e.Parent="_parent",e.Top="_top",e}();e.LinkTargetAttributes=t,e.Module.instance().filter("locLinkifier",["$translate",function(e){return function(r){var n=function(e){for(var t={},r=0;r<e.length;r++){var n=e[r].key,i=n.substring(1,n.length-1);t[i]=e[r].key}return t},i=function(e,r,n){return n=n||t.Blank,'<a href="'+r+'" target="'+n+'">'+e+"</a>"};if(!r.localizedStatement&&!r.localizedStatementKey){var o=r.links[0],s=o.localizedValue||e.instant(o.localizedValueKey);return i(s,o.url,o.target)}var a="";if(r.links){a=r.localizedStatement||e.instant(r.localizedStatementKey,n(r.links));for(var c=0;c<r.links.length;c++){var o=r.links[c],s=o.localizedValue||e.instant(o.localizedValueKey);a=a.replace(o.key,i(s,o.url,o.target))}}else a=r.localizedStatement||e.instant(r.localizedStatementKey);return a}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.CookieKeys={XsrfToken:"XSRF-TOKEN"}}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(){e.call(this,"getSiteSAMLConfiguration",null)}return __extends(t,e),t}(e.Request);e.GetSiteSAMLConfigurationRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"setSiteSAMLEnabled",t)}return __extends(t,e),t}(e.Request);e.SetSiteSAMLEnabledRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(){e.call(this,"removeIdentityProvider",{})}return __extends(t,e),t}(e.Request);e.RemoveIdentityProviderRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"setSiteAttributeMapping",t)}return __extends(t,e),t}(e.Request);e.SetSiteAttributeMappingRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"updateSiteSettingsForSiteAdmin",t)}return __extends(t,e),t}(e.Request);e.UpdateSiteSettingsForSiteAdminRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n,i,o,s,a,c,l,u){t.siteSettingsForSiteAdmin=a,t.$watch("siteSettingsForSiteAdmin.siteAdminSettings.refreshTokenEnabled",function(r,n){r!==n&&o.sendRequest(new e.ServerApi.UpdateSiteSettingsForSiteAdminRequest(t.siteSettingsForSiteAdmin))}),t.configuration=s,t.$watch("configuration.enabled",function(e,r){e!==r&&t.setEnabled(e)}),t.isEnabled=function(){return t.configuration.enabled},t.isIdentityProviderConfigured=function(){return t.isEnabled()&&!!t.configuration.identityProviderEntityId},t.download=function(e,t){e.preventDefault(),i.download(t)},t.downloadLogUrl=function(){return u+s.downloadLogEndpoint},t.openAddExternalUsersDialog=function(t){l.showAddSiteUsersOptionsDialog(e.ActionContext.fromEvent(t))},t.testLogin=function(){t.isIdentityProviderConfigured()&&i.open(s.testLoginUrl,"testLogin","left=20,top=20,width=500,height=600,toolbar=1,resizable=1")},t.entityIdFormUrl=function(){return""===o.sessionSiteUrlName()?"/admin/site_saml":"/t/"+o.sessionSiteUrlName()+"/admin/site_saml"},t.returnUrl=function(){return i.getPathQueryFragment()},t.setEnabled=function(n){o.sendRequest(new e.ServerApi.SetSiteSAMLEnabledRequest({enable:n})).then(function(i){t.configuration=i,o.refreshSessionInfo(),c.pop({type:e.ToastType.Info,text:r.instant(n?"siteAuthenticationSAMLEnabled":"siteAuthenticationSAMLDisabled")})})},t.removeIdentityProvider=function(){o.sendRequest(new e.ServerApi.RemoveIdentityProviderRequest).then(function(e){t.configuration=e,o.refreshSessionInfo()})},t.setSiteAttributeMapping=function(){o.sendRequest(new e.ServerApi.SetSiteAttributeMappingRequest(t.configuration.siteSAMLAttributeMapping)).then(function(){c.pop({type:e.ToastType.Info,text:r.instant("siteAuthenticationAttributesSaved")})})},t.endpoint=u+"updateIdentityProvider",t.handleFormSubmitResult=function(n){if("number"==typeof n)switch(n){case e.CommonErrorCode.InsecureSAMLEndpoint:c.pop({type:e.ToastType.Error,text:r.instant("siteAuthenticationIdPImportFailureInsecureEndpoint")});break;default:c.pop({type:e.ToastType.Error,text:r.instant("unexpectedError")})}else t.configuration=n,c.pop({type:e.ToastType.Info,text:r.instant("siteAuthenticationIdPImportSuccess")});o.refreshSessionInfo()},t.xsrfToken=n[e.CookieKeys.XsrfToken],t.allowed=o.isThirdPartyAuthAllowed();var d="mailto:customerservice@tableau.com?Subject=Tableau%20Online%20Single%20Sign-on%20request&Body=Site%20Name%3A%20"+o.sessionSiteName()+"%0ASite%20Admin%20email%3A%20"+o.sessionUsername()+"%0AIdentity%20Provider%3A%20%28e.g.%20Ping%2C%20Okta%2C%20OneLogin%2C%20Shibboleth%2C%20Salesforce%2C%20other%3F%29";t.contactCustomerSupport=function(){return{localizedStatementKey:"siteAuthenticationFunctionalityInfo",links:[{key:"{CUSTOMER_SUPPORT_MAILTO_LINK}",localizedValueKey:"tableauSupport",url:d}]}}}return t.$inject=["$scope","$translate","$cookies","WindowLocationService","ServerService","configuration","siteSettingsForSiteAdmin","ToasterService","AddUsersOptionsAction","RestApiPrefix"],t}();e.SiteAuthenticationCtrl=t,e.Module.instance().controller("SiteAuthenticationCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n,i,o){e.SubplaceCountsHelper.keepSubplaceCountsUpdated(r,o),r.placeTitleClicked=function(){r.$broadcast(e.SubplaceEvents.Refresh)}}return t.$inject=["$location","$scope","$state","CreateSiteAction","place"],t}();e.SitesPlaceCtrl=t,e.Module.instance().controller("SitesPlaceCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n,i,o,s,a,c,l,u,d,p,h,f){this.$scope=t,this.$translate=r,this.AngularToReactDataGridBridge=n,this.queryService=s,this.serverService=c,this.users=u,this.angularContextFactory=h,t.multisite=c.isSessionMultiSite(),t.reactDataGridInSiteUsersPlace=e.FeatureFlags.reactDataGridInSiteUsersPlace,o.setTitle(t.multisite?"siteUsers":"users"),t.model={itemsCount:0},t.server=c,t.sorter=p.create(e.SiteUserContentType.defaultOrder),t.selectedItems=new e.Set(function(e){return e.id}),e.FeatureFlags.reactDataGridInSiteUsersPlace&&this.configureForReactDataGrid(),t.availableAction=function(e){return e.isAvailable(t.selectedItems)},e.ActionButtonsHelper.setupActionButtons(t,d.getSiteUsersActionsButtons()),t.listActions=[{name:"add-users",translate:"addUsers",isAvailable:function(){return l},execute:function(t){i.showAddSiteUsersOptionsDialog(e.ActionContext.fromEvent(t))}}],t.availableListAction=function(e){return e.isAvailable()},t.rowClicked=function(e,r){a.rowClicked(t.selectedItems,e,r)},t.filterControls={},t.filterDefinitions=f.getFilterDefinitions(["siteRole"]),this.siteRoleFilterDefinition=t.filterDefinitions[0];var m=this.createQueryUpdater();t.sliceChanged=function(e){t.selectedItems.updateItems(e.items),t.model.itemsCount=e.total},t.refreshItems=function(){m.refresh()},t.refreshItems(),t.placeTitleClicked=function(){t.refreshItems()},t.$on(e.UserAddedEvent,function(){t.refreshItems()}),t.$on(e.SiteRolesEvent.SiteRolesChanged,function(){t.refreshItems()}),t.$on(e.SyncGroupEvent.groupSynced,function(){t.refreshItems()}),t.headerClicked=function(e){return t.sorter.setPrimary(e.attrs.key,e.attrs.direction)},t.thirdPartyAuthEditable=c.isThirdPartyAuthEditable(),t.emptyTemplateModel={title:"usersEmptyMessage"}}return t.prototype.updateSiteRoleCounts=function(t){var r=this;this.users.getUserCountsBySiteRole(t).then(function(t){r.siteRoleFilterDefinition.options=e.SiteRoleFilterHelper.siteRoleOptions(e.SiteRoles.WithoutGuest,t)})},t.prototype.configureForReactDataGrid=function(){var t=this;this.$scope.dataGridProps={translate:this.$translate.instant,cols:this.dataGridColumns(this.$scope),data:null,emptyChild:React.DOM.div({className:"tb-data-grid-empty"},React.DOM.div({className:"tb-data-grid-empty-title"},this.$translate.instant("usersEmptyMessage"))),update:0,onHeaderClicked:function(e,r){t.$scope.$apply(function(){t.$scope.sorter.setPrimary(e,r)})},onCellClick:function(r,n){t.$scope.$apply(function(){if(e.FeatureFlags.toggleSelectableRow){var i=1===t.$scope.selectedItems.size()&&t.$scope.selectedItems.contains(r),o="actions"===n;i&&!o?t.$scope.selectedItems.toggle(r):(t.$scope.selectedItems.clear(),t.$scope.selectedItems.add(r))}else t.$scope.selectedItems.clear(),t.$scope.selectedItems.add(r);var s=t.$scope.selectedItems.keys();t.$scope.dataGridProps.selectedKeys=_.object(s,s),t.$scope.dataGridProps.update++})}},this.$scope.$watch(function(){return t.$scope.sorter.selectedColumnKey()+";"+t.$scope.sorter.isSortAscending()},function(){t.$scope.dataGridProps.sortKey=t.$scope.sorter.selectedColumnKey(),t.$scope.dataGridProps.sortAscending=t.$scope.sorter.isSortAscending(),t.$scope.dataGridProps.update++}),this.$scope.$watch(function(){return t.$scope.selectedItems.size()},function(){var e=t.$scope.selectedItems.keys();t.$scope.dataGridProps.selectedKeys=_.object(e,e),t.$scope.dataGridProps.update++})},t.prototype.createQueryUpdater=function(){var t=this;return e.FeatureFlags.reactDataGridInSiteUsersPlace?this.queryService.createQueryUpdater(this.$scope,e.SiteUserContentType,this.users,function(e){t.AngularToReactDataGridBridge.updateReactDataGridRowStore({scope:t.$scope,sliceable:e}),t.$scope.sliceable=e,t.$scope.sorter.setOrder(e.getOrder()),e.getCount().then(function(e){t.$scope.model.itemsCount=e})},{}):this.queryService.createQueryUpdater(this.$scope,e.SiteUserContentType,this.users,function(e){t.$scope.sliceable=e,t.$scope.sorter.setOrder(e.getOrder()),t.updateSiteRoleCounts(e),e.getCount().then(function(e){t.$scope.model.itemsCount=e})},{})},t.prototype.dataGridColumns=function(t){var r=this.$translate.instant,n=React.createFactory(React.createClass({render:function(){return React.DOM.span({},r("siteRole_"+this.props.value))}})),i=React.createFactory(React.createClass({render:function(){var t=this.props,r=t.row.data.lastSignIn;return React.DOM.span({},e.L10n.localizedDateTime(r))}})),o=this.angularContextFactory.create(t),s=[VizPortalReact.CommonDataGridColumns.selected(t),{name:"display-name-col",dataKey:"displayName",text:this.$translate.instant("column_fullName"),direction:"asc",cellFormatter:VizPortalReact.DataGridCells.UserDisplayNameCell()},{name:"actions-col",dataKey:"actions",text:"",cellFormatter:VizPortalReact.DataGridCells.AngularActionsCell(o),resizable:!1,sortable:!1,cellStyle:{padding:0}},{name:"username-col",dataKey:"username",text:this.$translate.instant("column_username"),direction:"asc"},{name:"site-role-col",dataKey:"siteRole",text:this.$translate.instant("column_site_role"),direction:"asc",cellFormatter:n},{name:"group-count-col",dataKey:"groupCount",text:this.$translate.instant("column_groupCount"),direction:"asc",headerStyle:{textAlign:"right"},cellStyle:{textAlign:"right"}}];return this.serverService.isServerDomainFamilyActiveDirectory()&&s.push({name:"domain-name-col",dataKey:"domainName",direction:"asc",text:this.$translate.instant("column_domainName")}),t.thirdPartyAuthEditable&&s.push({name:"authentication-col",dataKey:"authentication",direction:"asc",text:this.$translate.instant("column_authentication")}),s.push({name:"last-sign-in-col",dataKey:"lastSignIn",text:this.$translate.instant("column_last_sign_in"),direction:"desc",cellFormatter:i}),s},t.$inject=["$scope","$translate","AngularToReactDataGridBridge","AddUsersOptionsAction","BrowserTitleService","QueryService","SelectionService","ServerService","canSessionUserManageUsers","SiteUsers","SiteUsersActions","SorterFactory","AngularContextFactory","FilterPanelService"],t}();e.SiteUsersPlaceCtrl=t,e.Module.instance().controller("SiteUsersPlaceCtrl",t)}(VizPortal||(VizPortal={}));var VizPortalReact;!function(e){var t;!function(t){function r(t,r,i,o,s,a,c,l,u,d,p,h){var f=[e.CommonDataGridColumns.selected(r)];return l&&f.push({name:"user-col",dataKey:"userName",text:t("column_task_user"),cellFormatter:e.DataGridCells.Link(function(e){var r=e.data;return{text:r.user.displayName,url:a.forSiteUrlName(r.site.urlName).userContentUrl(r.user),iconClassName:"tb-grid-icon-user",iconTitle:t("user")}})}),u&&f.push({name:"subscription-col",dataKey:"targetName",text:t("column_task_subscription"),direction:"asc",cellFormatter:n(a,t)}),d&&f.push({name:"workbook-view-col",dataKey:"targetName",text:t("column_task_workbook_view"),direction:"asc",cellFormatter:n(a,t)}),f.push({name:"subject-col",dataKey:"subject",text:t("column_task_subject"),direction:"asc"}),p&&f.push({name:"schedule-name-col",dataKey:"scheduleName",direction:"asc",text:t("column_task_schedule"),cellFormatter:e.DataGridCells.ScheduleDescriptionCell(function(e){var t=e.data,r=t.schedule;return o?s.schedule(r.id,r.scheduledAction):a.forSiteUrlName(t.site.urlName).schedule(r.id,r.scheduledAction)},c)}),h&&f.push({name:"site-name-col",dataKey:"siteName",direction:"asc",text:t("column_task_site"),cellFormatter:e.DataGridCells.PlainTextCellWithTransform("site",function(e){return e.name})}),f.push({name:"last-sent-at-col",dataKey:"lastSentAt",text:t("column_task_last_update"),direction:"desc",cellFormatter:e.DataGridCells.DateTimeCell("lastSentAt",t("never"))}),f.push({name:"next-run-at-col",dataKey:"runNextAt",text:t("column_task_next_update"),direction:"asc",cellFormatter:e.DataGridCells.DateTimeCell("runNextAt",t("disabled"))}),f[1]=e.CommonDataGridColumns.withActions(f[1],{actions:i,getActionTarget:function(){return{items:r.selectedItems,actionContext:{scope:r}}},translate:t}),f}function n(t,r){return e.DataGridCells.Link(function(e){var n=e.data,i=t.forSiteUrlName(n.site.urlName);return n.targetType===VizPortal.SubscriptionTargetTypes.view?{text:n.targetName,url:i.viewUrl(n.targetPath),iconClassName:"tb-grid-icon-view",iconTitle:r("view")}:{text:n.targetName,url:i.workbookUrl(n.targetId),iconClassName:"tb-grid-icon-workbook",iconTitle:r("workbook")}})}t.columns=r}(t=e.SubscriptionGrid||(e.SubscriptionGrid={}))}(VizPortalReact||(VizPortalReact={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n){this.ConfirmActionDialog=e,this.ContentActionNotification=t,this.$translate=r,this.Subscriptions=n}return t.prototype.deleteSubscriptions=function(t,r){var n,i=this;if(1===t.size()){var o=t.first();o.targetType===e.SubscriptionTargetTypes.view?n=this.$translate.instant("confirmDeleteSubscriptionView",{TARGET_NAME:e.L10n.elideIfLong(o.targetName)}):o.targetType===e.SubscriptionTargetTypes.workbook&&(n=this.$translate.instant("confirmDeleteSubscriptionWorkbook",{TARGET_NAME:e.L10n.elideIfLong(o.targetName)}))}else n=this.$translate.instant("confirmDeleteSubscriptions",{SUBSCRIPTION_COUNT:t.size()},e.L10n.Interpolations.Count);return this.ConfirmActionDialog.open({scope:r.scope,title:this.$translate.instant("delete"),bodyText:n,actionName:this.$translate.instant("confirmDeleteButton",{ITEM_COUNT:t.size()},e.L10n.Interpolations.Count),isDeleteAction:!0,action:function(r){return i.Subscriptions.del(t.keys()).then(function(r){var n=e.MultipleResultNotificationOptions.create(new e.MultipleItemResult(t,r),{describeSuccessSummary:function(t){return i.$translate.instant("deleteSubscriptionsSuccess",{ITEM_COUNT:t},e.L10n.Interpolations.Count)},describeErrorSummary:function(t){return i.$translate.instant("deleteSubscriptionsError",{ERROR_COUNT:t},e.L10n.Interpolations.Count)},describeErrorDetail:function(e){return{itemName:e.item.subject,errorMessage:i.errorMessageFor(e)}}});i.ContentActionNotification.notify(n)})}}).result},t.prototype.errorMessageFor=function(t){switch(t.error.code){case e.CommonErrorCode.SubscriptionNotFound:return this.$translate.instant("errorSubscriptionNotFound",{SUBSCRIPTION_NAME:e.L10n.elideIfLong(t.item.subject)});default:return this.$translate.instant("errorUnknown")}},t.$inject=["ConfirmActionDialog","ContentActionNotification","$translate","Subscriptions"],t}();e.DeleteSubscriptionsAction=t,e.Module.instance().service("DeleteSubscriptionsAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n){this.ConfirmActionDialog=e,this.$translate=t,this.toaster=r,this.Subscriptions=n}return t.prototype.changeSubject=function(t,r){var n=this,i=r.scope.$new();switch(i.description="",t.targetType){case e.SubscriptionTargetTypes.view:i.description=this.$translate.instant("confirmChangeViewSubscriptionSubject",{VIEW_NAME:e.L10n.elideIfLong(t.targetName)});break;case e.SubscriptionTargetTypes.workbook:i.description=this.$translate.instant("confirmChangeWorkbookSubscriptionSubject",{WORKBOOK_NAME:e.L10n.elideIfLong(t.targetName)})}return i.input={text:t.subject,maxLength:255},this.ConfirmActionDialog.open({title:this.$translate.instant("changeSubject"),bodyTemplateUrl:"confirmActionDialogInput.html",scope:i,actionName:this.$translate.instant("changeSubject"),action:function(r){return n.Subscriptions.changeSubject(t.id,i.input.text).then(function(o){return o.errors&&o.errors.length?r.showErrorMessage(n.$translate.instant("changeSubjectFailure",{SUBJECT:t.subject})):(n.toaster.pop({type:e.ToastType.Info,text:n.$translate.instant("changeSubjectSuccess",{SUBJECT:i.input.text})}),t.subject=i.input.text),o})}}).result.fin(function(){return i.$destroy()})},t.$inject=["ConfirmActionDialog","$translate","ToasterService","Subscriptions"],t}();e.ChangeSubscriptionSubjectAction=t,e.Module.instance().service("ChangeSubscriptionSubjectAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(r,n,i,o,s,a,c,l,u,d,p,h,f,m){var v=this;this.$scope=r,this.$translate=n,this.AngularToReactDataGridBridge=i,this.$state=o,this.$filter=s,this.ServerService=p,this.DeleteSubscriptionsAction=h,this.changeScheduleAction=f,this.ChangeSubscriptionSubjectAction=m,a.setTitle("subscriptions",r.objectName);var S=new e.Set(function(e){return e.id});r.selectedItems=S;var g=this.createActions(S);r.useReactDataGrid=e.FeatureFlags.reactSubscriptionsGrid,e.FeatureFlags.reactSubscriptionsGrid&&this.configureForReactDataGrid(g),r.rowClicked=function(e,t){u.rowClicked(r.selectedItems,e,t)},r.sorter=d.create(e.SubscriptionContentType.defaultOrder),this.query=l.createQueryUpdaterFromSubplace(r,c,function(t){e.FeatureFlags.reactSubscriptionsGrid&&v.AngularToReactDataGridBridge.updateReactDataGridRowStore({scope:v.$scope,sliceable:t}),r.sliceable=t,r.sorter.setOrder(t.getOrder())}),this.refreshSubscriptions(),r.$on(e.SubplaceEvents.Refresh,function(){v.refreshSubscriptions()}),r.showUserNameColumn=this.showUserNameColumn(),r.showWorkbookViewColumn=this.showWorkbookViewColumn(),r.showHasSubscriptionColumn=this.showHasSubscriptionColumn(),r.availableAction=function(e){return e.isAvailable(r.selectedItems)},e.ActionButtonsHelper.setupActionButtons(r,g),r.headerClicked=function(e){return r.sorter.setPrimary(e.attrs.key,e.attrs.direction)},r.sliceChanged=function(t){r.selectedItems.updateItems(t.items),e.SubplaceCountsHelper.updateCountsFromSubplace(r,c,t.total)},r.emptyTemplateModel=t.emptyTemplateModel}return t.prototype.isServerPage=function(){return this.$state.includes("main.server.**")},t.prototype.showUserNameColumn=function(){return!this.$state.includes("**.user.**")},t.prototype.showHasSubscriptionColumn=function(){return!this.$state.includes("**.workbook.**")&&!this.$state.includes("**.user.**")},t.prototype.showWorkbookViewColumn=function(){return this.$state.includes("**.user.**")},t.prototype.showScheduleColumn=function(){return!this.$state.includes("**.schedule.**")},t.prototype.showSiteColumn=function(){return this.isServerPage()},t.prototype.configureForReactDataGrid=function(e){var r=this,n=window.location.search,i=VizPortalReact.SubscriptionGrid.columns(function(e){return r.$translate.instant(e)},this.$scope,e,this.isServerPage(),new VizPortalReact.ServerUrls(n),new VizPortalReact.SiteUrls({siteUrlName:this.ServerService.sessionSiteUrlName(),queryString:n}),this.$filter("scheduleFrequencyDescription"),this.showUserNameColumn(),this.showHasSubscriptionColumn(),this.showWorkbookViewColumn(),this.showScheduleColumn(),this.showSiteColumn());this.AngularToReactDataGridBridge.attachReactDataGridToScope(this.$scope,i,t.emptyTemplateModel)},t.prototype.createActions=function(t){var r=this;return[{name:"tasks-change-schedule",translate:"changeSchedule_action",isAvailable:function(e){return!e.isEmpty()},isDisabled:function(e){return 1===e.size()&&r.isCreatorOrAdminOnly(e.first())},execute:function(n,i){r.changeScheduleAction.forSubscriptions(n,i).then(function(n){e.ActionHelpers.deselectNotFound(t,n,e.CommonErrorCode.SubscriptionNotFound),r.refreshSubscriptions()})}},{name:"tasks-change-subject",translate:"changeSubject_action",isAvailable:function(e){return!e.isEmpty()},isDisabled:function(e){return 1!==e.size()||r.isCreatorOrAdminOnly(e.first())},execute:function(n,i){r.ChangeSubscriptionSubjectAction.changeSubject(n.first(),i).then(function(n){e.ActionHelpers.deselectNotFound(t,n,e.CommonErrorCode.SubscriptionNotFound),r.refreshSubscriptions()})}},{name:"delete-subscriptions",translate:"delete_action",isAvailable:function(e){return!e.isEmpty()},isDisabled:function(e){return 1===e.size()&&r.isCreatorOrAdminOnly(e.first())},execute:function(n,i){r.DeleteSubscriptionsAction.deleteSubscriptions(n,i).then(function(n){e.ActionHelpers.deselectAllExceptErrors(t,n,e.CommonErrorCode.SubscriptionNotFound),r.refreshSubscriptions()})}}]},t.prototype.isCreatorOrAdminOnly=function(e){return e.user.id!==this.ServerService.sessionUserId()&&!this.ServerService.isSessionSiteOrServerAdmin()},t.prototype.refreshSubscriptions=function(){this.query.refresh()},t.$inject=["$scope","$translate","AngularToReactDataGridBridge","$state","$filter","BrowserTitleService","subplace","QueryService","SelectionService","SorterFactory","ServerService","DeleteSubscriptionsAction","ChangeScheduleAction","ChangeSubscriptionSubjectAction"],t.emptyTemplateModel={title:"subscriptionsEmptyMessage"},t}();e.SubscriptionsCtrl=t,e.Module.instance().controller("SubscriptionsCtrl",t)}(VizPortal||(VizPortal={}));var VizPortalReact;!function(e){var t=function(){function e(e){e=_.isString(e)?e:"",e&&e.length>0&&"?"!==e[0]&&(e="?"+e),this.prefix="/"+e+"#"}return e.prototype.sitesUrl=function(){return this.prefix+"/server/sites"},e.prototype.usersUrl=function(){return this.prefix+"/server/users"},e.prototype.schedule=function(e,t){return this.prefix+"/server/schedules/"+e+"/"+(t===VizPortal.ServerApi.ScheduleActions.Extract?"extractRefreshes":"subscriptions")},e.prototype.schedules=function(){return this.prefix+"/server/schedules"},e.prototype.tasks=function(){return this.prefix+"/server/tasks"},e.prototype.status=function(){return this.prefix+"/server/status"},e.prototype.settings=function(){return this.prefix+"/server/settings";
},e.prototype.userSettingsUrl=function(e){return this.prefix+"/server/user/"+e.domainName+"/"+e.username+"/settings"},e}();e.ServerUrls=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t;!function(t){t.bluePalette=!VizPortal.FeatureFlags.reactTopBarDark,t.LetterSpacing="0.08em",t.MenuPanelStyle={width:240,height:308,backgroundColor:e.CommonStyles.Colors.White,borderWidth:e.CommonStyles.Sizes.LineWidth,borderColor:e.CommonStyles.Colors.BorderColor,borderStyle:"solid",fontSize:e.CommonStyles.Sizes.NormalFontSize,position:"relative"},t.AlertsCountFontSize=VizPortal.FeatureFlags.useUpdatedFontStyles?"10px":"inherit",t.HeaderDividerImage=t.bluePalette?"header_divider.png":"header_divider_black.png",t.SiteSwitcherDropdownRestImage=t.bluePalette?"signature_dropdown_small_white_normal.png":"signature_dropdown_small_normal.png",t.SiteSwitcherDropdownHoverImage=t.bluePalette?"signature_dropdown_small_white_normal.png":"signature_dropdown_small_hover.png",t.HeaderBackgroundColor=t.bluePalette?"rgb(55,102,129)":e.CommonStyles.Colors.Grey40,t.HeaderLinkSelectedColor=t.bluePalette?e.CommonStyles.Colors.White:e.CommonStyles.Colors.ActionOrange,t.HeaderLinkSelectedBackgroundColor=t.bluePalette?"rgb(36,68,87)":"inherit",t.HeaderLinkHoverBackgroundColor=t.bluePalette?"rgb(45,85,108)":"inherit",t.SiteSwitcherRestColor=t.bluePalette?e.CommonStyles.Colors.White:e.CommonStyles.Colors.ActionOrange,t.SiteSwitcherHoverColor=t.bluePalette?e.CommonStyles.Colors.White:e.CommonStyles.Colors.ActionOrangeDark,t.HoverOpacity=1,t.RestOpacity=t.bluePalette?.85:.5,t.SiteSwitcherHoverOpacity=t.bluePalette?t.HoverOpacity:1,t.SiteSwitcherRestOpacity=t.bluePalette?t.RestOpacity:1}(t=e.HeaderStyles||(e.HeaderStyles={}))}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(e){var r=this;t.call(this,e),this.state={hovered:!1},this.boundMouseEnter=function(){return r.setState({hovered:!0})},this.boundMouseLeave=function(){return r.setState({hovered:!1})}}return __extends(r,t),r.prototype.render=function(){var t="inherit",n=e.CommonStyles.Colors.White,i=e.HeaderStyles.RestOpacity;this.props.isSelected?(n=e.HeaderStyles.HeaderLinkSelectedColor,t=e.HeaderStyles.HeaderLinkSelectedBackgroundColor,i=e.HeaderStyles.HoverOpacity):this.state.hovered&&(t=e.HeaderStyles.HeaderLinkHoverBackgroundColor,i=e.HeaderStyles.HoverOpacity);var o=_.extend({},r.linkStyle,{color:n,backgroundColor:t},this.props.style);return React.DOM.a({href:this.props.url,style:o,onMouseEnter:this.boundMouseEnter,onMouseLeave:this.boundMouseLeave},React.DOM.span({style:{opacity:i}},this.props.label))},r.displayName="HeaderLink",r.element=React.createFactory(r),r.linkStyle={textDecoration:"none",display:"inline-block",fontFamily:e.CommonStyles.Fonts.HeaderFont,fontSize:e.CommonStyles.Sizes.HeaderFontSize,letterSpacing:e.HeaderStyles.LetterSpacing},r}(React.Component);e.HeaderLink=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(){t.apply(this,arguments)}return __extends(r,t),r.prototype.render=function(){var t=this,n=r.isServerLocation(this.props.currentLocation)?this.serverLinks():this.siteLinks(),i=_.map(n,function(n){return e.HeaderLink.element({key:n.label,label:n.label,url:n.url,isSelected:t.props.currentLocation===n.location,style:r.linkStyle})}),o=React.DOM.div({style:{background:this.props.hideRightDivider?"inherit":"url(img/"+e.HeaderStyles.HeaderDividerImage+") right center no-repeat"}},i);return React.DOM.div({style:r.containerStyle},o)},r.prototype.siteLinks=function(){var e=[];return VizPortal.FeatureFlags.homePlaceEnabled&&e.push({label:this.props.translate("home"),location:r.Location.SiteHome,url:this.props.siteUrls.home()}),e=e.concat([{label:this.props.translate("content"),location:r.Location.SiteContent,url:this.props.siteUrls.projectsUrl()},{label:this.props.translate("users"),location:r.Location.SiteUsers,url:this.props.siteUrls.usersUrl()},{label:this.props.translate("groups"),location:r.Location.SiteGroups,url:this.props.siteUrls.groupsUrl()},{label:this.props.translate("schedules"),location:r.Location.SiteSchedules,url:this.props.siteUrls.schedulesUrl()},{label:this.props.translate("tasks"),location:r.Location.SiteTasks,url:this.props.siteUrls.tasksUrl()},{label:this.props.translate("status"),location:r.Location.SiteStatus,url:this.props.siteUrls.statusUrl()},{label:this.props.translate("settings"),location:r.Location.SiteSettings,url:this.props.siteUrls.settingsUrl()}])},r.prototype.serverLinks=function(){return[{label:this.props.translate("sites"),location:r.Location.ServerSites,url:this.props.serverUrls.sitesUrl()},{label:this.props.translate("users"),location:r.Location.ServerUsers,url:this.props.serverUrls.usersUrl()},{label:this.props.translate("schedules"),location:r.Location.ServerSchedules,url:this.props.serverUrls.schedules()},{label:this.props.translate("tasks"),location:r.Location.ServerTasks,url:this.props.serverUrls.tasks()},{label:this.props.translate("status"),location:r.Location.ServerStatus,url:this.props.serverUrls.status()},{label:this.props.translate("settings"),location:r.Location.ServerSettings,url:this.props.serverUrls.settings()}]},r.displayName="Navigation",r.element=React.createFactory(r),r.linkPadding=15,r.linkStyle={paddingLeft:r.linkPadding,paddingRight:r.linkPadding},r.containerStyle={background:"url(img/"+e.HeaderStyles.HeaderDividerImage+") left center no-repeat",marginLeft:r.linkPadding,marginRight:r.linkPadding,lineHeight:"45px"},r}(React.Component);e.Navigation=t;var t;!function(e){function t(e){return e>=r.ServerSites}e.isServerLocation=t,function(e){e[e.Unknown=0]="Unknown",e[e.SiteHome=1]="SiteHome",e[e.SiteContent=2]="SiteContent",e[e.SiteUsers=3]="SiteUsers",e[e.SiteGroups=4]="SiteGroups",e[e.SiteSchedules=5]="SiteSchedules",e[e.SiteTasks=6]="SiteTasks",e[e.SiteStatus=7]="SiteStatus",e[e.SiteSettings=8]="SiteSettings",e[e.ServerSites=9]="ServerSites",e[e.ServerUsers=10]="ServerUsers",e[e.ServerSchedules=11]="ServerSchedules",e[e.ServerTasks=12]="ServerTasks",e[e.ServerStatus=13]="ServerStatus",e[e.ServerSettings=14]="ServerSettings"}(e.Location||(e.Location={}));var r=e.Location}(t=e.Navigation||(e.Navigation={}))}(VizPortalReact||(VizPortalReact={}));var VizPortal;!function(e){var t;!function(e){e.AlertTarget={datasource:"datasource",workbook:"workbook"};var t=function(e){function t(t){e.call(this,"getAlert",t)}return __extends(t,e),t}(e.Request);e.GetAlertRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){void 0===t&&(t={}),e.call(this,"getUserAlertList",t)}return __extends(t,e),t}(e.Request);e.GetUserAlertListRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e){this.ServerService=e}return t.prototype.getCount=function(){return this.ServerService.sendRequest(new e.ServerApi.GetUserAlertCountRequest).then(function(e){return e.totalCount})},t.prototype.getList=function(){return this.ServerService.sendRequest(new e.ServerApi.GetUserAlertListRequest).then(function(t){return e.ServerApiMapper.alertList(t)})},t.prototype.getForDatasource=function(t){return this.getForType(e.ServerApi.AlertTarget.datasource,t)},t.prototype.getForWorkbook=function(t){return this.getForType(e.ServerApi.AlertTarget.workbook,t)},t.prototype.getForType=function(t,r){return this.ServerService.sendRequest(new e.ServerApi.GetAlertRequest({targetType:t,targetId:r})).then(function(t){return e.ServerApiMapper.alertList(t)})},t.$inject=["ServerService"],t}();e.Alerts=t,e.Module.instance().service("Alerts",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getGettingStartedNotifications",t)}return __extends(t,e),t}(e.Request);e.GetGettingStartedNotificationsRequest=t;var r=function(e){function t(t){e.call(this,"setSuppressGettingStartedNotifications",t)}return __extends(t,e),t}(e.Request);e.SetSuppressGettingStartedNotification=r}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i,o,s){this.$sce=e,this.$q=t,this.$window=r,this.$rootScope=n,this.$state=i,this.modal=o,this.ServerService=s,this.notificationsShown=!1,this.notificationsEnabled=!1}return t.prototype.enableNotifications=function(){this.notificationsEnabled=!0},t.prototype.forceShowNotifications=function(){return this.showNotifications({checkUserPrefs:!1})},t.prototype.showNotificationsIfEnabled=function(){var e=this;return!this.notificationsEnabled||this.notificationsShown||this.$state.is("main.site.viz")?this.$q.when(null):this.showNotifications({checkUserPrefs:!0}).fin(function(){return e.notificationsShown=!0})},t.prototype.shouldShowGettingStartedLink=function(){return this.fetchNotificationsUrl({checkUserPrefs:!1}).then(function(e){return!!e})},t.prototype.showNotifications=function(r){var n=this;return this.fetchNotificationsUrl(r).then(function(r){if(r){var i="gettingStartedNotifications.html",o=n.$rootScope.$new(),s=".gettingStartedNotification"+o.$id,a=n.getHostName(r);r+="?"+$.param({__displayName:n.ServerService.sessionUserDisplayName()}),o.notificationsUrl=n.$sce.trustAsResourceUrl(r),o.dialog={showNotificationsOnLogIn:!0};var c=n.modal.open({scope:o,templateUrl:i,size:e.ModalSize.fitToContent,classes:"tb-modal-external-content",backdropClasses:"tb-backdrop-dark",closeX:!1,resolve:{bodyTemplate:["$http","$templateCache",function(e,t){return e.get(i,{cache:t})}]},tbTestId:"getting-started-notifications-modal"});return $(n.$window).on("message"+s,function(e){var r=e.originalEvent,i=n.getHostName(r.origin);i&&i===a&&r.data===t.CloseModalMessage&&c.dismiss()}),o.$on("$destroy",function(){$(n.$window).off(s)}),c.result.fin(function(){return n.updateUserPreference(o)}).fin(function(){return o.$destroy()})}})},t.prototype.getHostName=function(e){var t=document.createElement("a");return t.setAttribute("href",e),t.hostname},t.prototype.fetchNotificationsUrl=function(t){return this.ServerService.sendRequest(new e.ServerApi.GetGettingStartedNotificationsRequest(t)).then(function(e){return e.contentUrl})},t.prototype.updateUserPreference=function(t){return this.ServerService.sendRequest(new e.ServerApi.SetSuppressGettingStartedNotification({suppressGettingStartedNotifications:!t.dialog.showNotificationsOnLogIn}))},t.CloseModalMessage="tableau.closeModal",t.$inject=["$sce","$q","$window","$rootScope","$state","ModalService","ServerService"],t}();e.GettingStartedNotifications=t,e.Module.instance().service("GettingStartedNotifications",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t){this.server=e,this.startPageService=t,this.serverCustomization=e.serverCustomization(),this.siteCustomization=function(){return e.siteLogo()},this.isSiteCustomizationEnabled=e.isSiteCustomizationEnabled()}return t.prototype.resetSiteLogoToDefault=function(){return this.server.updateSiteLogo(void 0,!0)},t.prototype.uploadSiteLogo=function(e){return this.server.updateSiteLogo(e,!1)},t.prototype.isUsingCustomSiteLogo=function(){return this.siteCustomization()&&this.siteCustomization().useCustomLogo&&this.isSiteCustomizationEnabled},t.prototype.getTopBarLogo=function(){return this.isUsingCustomSiteLogo()?this.getSiteCustomLogo():this.getServerTopBarLogo()},t.prototype.getServerTopBarLogo=function(){return this.serverCustomization&&this.serverCustomization.useCustomLogo?this.getServerCustomLogo():{image:t.DefaultTopBarLogoImage+"?"+e.BuildId,width:t.DefaultTopBarLogoWidth,height:t.DefaultTopBarLogoHeight,href:this.getStartPageHref(),title:this.server.serverName()}},t.prototype.getSignInLogo=function(){return this.serverCustomization&&this.serverCustomization.useCustomLogo?this.getServerCustomLogo():{image:t.DefaultSignInLogoImage+"?"+e.BuildId,width:t.DefaultSignInLogoWidth,height:t.DefaultSignInLogoHeight,href:"",title:this.server.serverName()}},t.prototype.getStartPageHref=function(){return"#"+this.startPageService.getCurrentUserStartPageForCurrentSite()},t.prototype.getServerCustomLogo=function(){return{image:this.serverCustomization.customLogoPath,width:Math.min(Math.max(this.serverCustomization.customLogoWidth,0),t.MaximumLogoWidth),height:Math.min(Math.max(this.serverCustomization.customLogoHeight,0),t.MaximumLogoHeight),href:this.serverCustomization.customLogoLink||this.getStartPageHref(),title:this.server.serverName()}},t.prototype.getSiteCustomLogo=function(){var e=this.siteCustomization();return{image:e.customLogoPath,width:Math.min(Math.max(e.customLogoWidth,0),t.MaximumLogoWidth),height:Math.min(Math.max(e.customLogoHeight,0),t.MaximumLogoHeight),href:e.customLogoLink||this.getStartPageHref(),title:this.server.sessionSiteName()}},t.DefaultSignInLogoImage="img/tableau_sign_in_logo.png",t.DefaultSignInLogoWidth=277,t.DefaultSignInLogoHeight=58,t.DefaultTopBarLogoImage="img/tableau_mono_logo.png",t.DefaultTopBarLogoWidth=132,t.DefaultTopBarLogoHeight=27,t.MaximumLogoWidth=160,t.MaximumLogoHeight=160,t.$inject=["ServerService","StartPageService"],t}();e.LogoService=t,e.Module.instance().service("LogoService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.TopBarEvents={HeightChanged:"HeightChanged"};var t=function(){function t(r,n,i,o,s,a,c,l,u,d,p,h,f,m,v,S,g,y,A,P){this.$scope=n,this.$state=i,this.server=s,this.$translate=l,this.siteNames=u,this.favorites=d,this.angularContextFactory=p,this.alerts=h,this.extractTasks=f,this.userSettingsActions=m,this.help=v,this.gettingStartedNotifications=S,this.modalService=g,this.logoService=y,this.datasources=A,this.workbooks=P,n.logo=function(){return c.getTopBarLogo()},n.inServerArea=function(){return i.includes("main.server.**")},n.showServerSiteButtons=function(){return s.isSessionMultiSite()&&s.isSessionServerAdmin()},n.showSiteSwitcher=function(){return s.isSessionMultiSite()&&!n.inServerArea()},n.showSiteControls=function(){return!(s.isSessionMultiSite()&&n.inServerArea())},n.showNav=function(){return s.isSessionSiteOrServerAdmin()};var C=function(i){var s=0;if(!n.settings.collapsed){var a=n.logo(),c=a&&a.height?a.height:0;s=_.max([t.MinTopBarHeight,c])+2*t.VerticalPadding,i&&!e.FeatureFlags.reactTopBar&&(s+=t.NavHeight)}n.settings.height!==s&&(n.settings.height=s,o(function(){return r.$broadcast(e.TopBarEvents.HeightChanged)}))};n.$watch(function(){return n.settings.collapsed},function(){return C(n.showNav())}),n.$watch(function(){return n.showNav()},C),n.$watch(function(){return n.logo().height},function(){return C(n.showNav())}),n.serverUrl=function(){return a.serverUrl()},n.siteUrl=function(){return a.siteUrl()},n.siteSelected=function(e){a.switchToSite(e)},n.toggleCollapsed=function(){n.settings.collapsed=!n.settings.collapsed},n.server=s,e.FeatureFlags.reactTopBar&&this.configureReactTopBar()}return t.prototype.configureReactTopBar=function(){var e=this;this.$scope.topBarProps={logo:this.logoService.getTopBarLogo(),angularContext:this.angularContextFactory.create(this.$scope),translate:this.$translate.instant,siteStore:new VizPortalReact.SiteStore(this.siteNames),favoritesStore:new VizPortalReact.FavoritesStore(this.favorites),alertsStore:new VizPortalReact.AlertsStore,alertActions:new VizPortalReact.AlertActions(this.alerts,this.extractTasks,this.datasources,this.workbooks),userActions:new VizPortalReact.UserActions(this.server,this.userSettingsActions),user:this.server.sessionUserInfo(),serverUrls:new VizPortalReact.ServerUrls(window.location.search),navLocation:this.topBarLocationFromState(this.$state),isLogoutEnabled:this.server.isLogoutEnabled(),isSessionMultiSite:this.server.isSessionMultiSite(),isSessionServerAdmin:this.server.isSessionServerAdmin(),authenticationType:this.server.authenticationType(),helpActions:new VizPortalReact.HelpActions(this.help,this.server,this.$scope,this.gettingStartedNotifications,this.modalService),isOfflineHelpEnabled:this.server.offlineHelpEnabled(),serverHelpLabel:this.$translate.instant(this.help.getHelpLinkLocKey()),serverHelpUrl:this.help.getServerHelpUrlByCategory(),supportUrl:this.help.getGeneralSupportUrl(),serverName:this.server.serverName(),showGettingStartedLink:!1,currentSite:null,siteUrls:null},this.$scope.$watch(function(){return e.server.isSessionSiteOrServerAdmin()},function(){e.gettingStartedNotifications.shouldShowGettingStartedLink().then(function(t){e.$scope.topBarProps=_.extend({},e.$scope.topBarProps,{showGettingStartedLink:t})})});var t=function(){e.$scope.topBarProps=_.extend({},e.$scope.topBarProps,{currentSite:e.server.sessionSite(),siteUrls:new VizPortalReact.SiteUrls({siteUrlName:e.server.sessionSiteUrlName(),queryString:window.location.search})})};t(),this.$scope.$watch(function(){return e.server.sessionSiteUrlName()},t),this.$scope.$watch(function(){return e.$state.current.name},function(){e.$scope.topBarProps=_.extend({},e.$scope.topBarProps,{navLocation:e.topBarLocationFromState(e.$state)})})},t.prototype.topBarLocationFromState=function(e){var r=_.find(_.keys(t.stateNameToNavigationLocationMap),function(t){return e.includes(t)});return r?t.stateNameToNavigationLocationMap[r]:(console.error("Unexpected state: "+e.current.name),VizPortalReact.Navigation.Location.Unknown)},t.VerticalPadding=9,t.NavHeight=30,t.MinTopBarHeight=27,t.stateNameToNavigationLocationMap={"main.error":VizPortalReact.Navigation.Location.Unknown,"main.site.content":VizPortalReact.Navigation.Location.SiteContent,"main.site.home":VizPortalReact.Navigation.Location.SiteHome,"main.site.group":VizPortalReact.Navigation.Location.SiteGroups,"main.site.groups":VizPortalReact.Navigation.Location.SiteGroups,"main.site.schedule":VizPortalReact.Navigation.Location.SiteSchedules,"main.site.schedules":VizPortalReact.Navigation.Location.SiteSchedules,"main.site.settings":VizPortalReact.Navigation.Location.SiteSettings,"main.site.status":VizPortalReact.Navigation.Location.SiteStatus,"main.site.tasks":VizPortalReact.Navigation.Location.SiteTasks,"main.site.user":VizPortalReact.Navigation.Location.SiteUsers,"main.site.users":VizPortalReact.Navigation.Location.SiteUsers,"main.site.viz":VizPortalReact.Navigation.Location.SiteContent,"main.server.analysis":VizPortalReact.Navigation.Location.ServerStatus,"main.server.schedule":VizPortalReact.Navigation.Location.ServerSchedules,"main.server.schedules":VizPortalReact.Navigation.Location.ServerSchedules,"main.server.settings":VizPortalReact.Navigation.Location.ServerSettings,"main.server.sites":VizPortalReact.Navigation.Location.ServerSites,"main.server.status":VizPortalReact.Navigation.Location.ServerStatus,"main.server.tasks":VizPortalReact.Navigation.Location.ServerTasks,"main.server.user":VizPortalReact.Navigation.Location.ServerUsers,"main.server.users":VizPortalReact.Navigation.Location.ServerUsers},t.$inject=["$rootScope","$scope","$state","$timeout","ServerService","SiteSwitchService","LogoService","$translate","SiteNamesAcrossAllPods","Favorites","AngularContextFactory","Alerts","ExtractTasks","UserSettingsActions","HelpService","GettingStartedNotifications","ModalService","LogoService","DataSources","Workbooks"],t}();e.TopBarCtrl=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(e){return"none"!==e},r=function(e){return 0!==parseInt(e,10)&&"auto"!==e};e.Module.instance().directive("tbViz",["VizService","$timeout",function(n,i){return{restrict:"E",replace:!0,templateUrl:"viz.html",scope:{viz:"=",onVizSized:"&"},link:function(i,o){var s={toolbarPosition:tableau.ToolbarPosition.TOP,instanceIdToClone:i.viz.instanceId,onFirstVizSizeKnown:function(e){var n=e.getVizSize(),s=n.sheetSize;s.minSize&&(_.isNumber(s.minSize.height)&&!r(o.css("minHeight"))&&o.css("minHeight",s.minSize.height+(n.chromeHeight||0)),_.isNumber(s.minSize.width)&&!r(o.css("minWidth"))&&o.css("minWidth",s.minSize.width)),s.maxSize&&(_.isNumber(s.maxSize.height)&&!t(o.css("maxHeight"))&&o.css("maxHeight",s.maxSize.height+(n.chromeHeight||0)),_.isNumber(s.maxSize.width)&&!t(o.css("maxWidth"))&&o.css("maxWidth",s.maxSize.width)),i.$apply(i.onVizSized)},onFirstInteractive:function(){i.$apply(function(){i.viz.instanceId=l.getInstanceId()})}},a=_.extend(s,i.viz.params);a[":openAuthoringInTopWindow"]=!0,a[":browserBackButtonUndo"]=!0,a[":reloadOnCustomViewSave"]=!0,a[":showShareOptions"]=!0;var c=n.getUri(i.viz),l=new tableau.Viz(o.get(0),c,a);i.$on(e.TopBarEvents.HeightChanged,function(){l.refreshSize()}),i.$on("$destroy",function(){return l.dispose()});var u=[tableau.TableauEventName.CUSTOM_VIEW_LOAD,tableau.TableauEventName.CUSTOM_VIEW_SAVE,tableau.TableauEventName.TAB_SWITCH];_.each(u,function(e){l.addEventListener(e,function(e){l.getCurrentUrlAsync().then(function(e){i.$apply(function(){i.viz.instanceId=l.getInstanceId(),i.viz.path=n.getPath(e),i.viz.isExplicitOriginalViz=n.getIsExplicitOriginalVizFromUrl(e)})})})})}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"updateComment",t)}return __extends(t,e),t}(e.Request);e.UpdateCommentRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"deleteComment",t)}return __extends(t,e),t}(e.Request);e.DeleteCommentRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"createComment",t)}return __extends(t,e),t}(e.Request);e.CreateCommentRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(t){function r(r,n){t.call(this,n.getServerResourceFetcher(e.ServerApi.GetCommentsRequest,e.ServerApiMapper.comments)),this.ErrorNotifyingServer=r,this.commentFetcher=n.getServerResourceFetcher(e.ServerApi.GetCommentsRequest,e.ServerApiMapper.comments)}return __extends(r,t),r.prototype.createComment=function(t,r){return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.CreateCommentRequest({viewId:t,text:r}))},r.prototype.getSliceableCommentsForViz=function(t){var r=this;return{getSlice:function(n,i){return r.commentFetcher.fetchList({viewId:t,page:e.ResourceQuery.getPage(n,i)})}}},r.prototype.editComment=function(t,r){return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.UpdateCommentRequest({id:t,text:r}))},r.prototype.deleteComment=function(t){return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.DeleteCommentRequest({id:t}))},r.$inject=["ErrorNotifyingServer","FetcherFactory"],r}(e.Resource);e.Comments=t,e.Module.instance().service("Comments",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n){this.$translate=e,this.ConfirmActionDialog=t,this.Comments=r,this.toaster=n}return t.prototype.deleteComment=function(t,r){return this.showDeleteCommentDialog(t,e.ActionContext.fromEvent(r))},t.prototype.showDeleteCommentDialog=function(t,r){var n=this,i=this.ConfirmActionDialog.open({scope:r.scope,title:this.$translate.instant("delete"),bodyText:this.$translate.instant("confirmDeleteComment"),actionName:this.$translate.instant("confirmDeleteButton",{ITEM_COUNT:1},e.L10n.Interpolations.Count),isDeleteAction:!0,action:function(){return n.Comments.deleteComment(t.id)}});return i.result.then(function(t){t.errors?n.toaster.pop({type:e.ToastType.Error,text:n.$translate.instant("deleteFailed")}):n.toaster.pop({type:e.ToastType.Info,text:n.$translate.instant("commentDeleted")})}),i.result},t.$inject=["$translate","ConfirmActionDialog","Comments","ToasterService"],t}();e.DeleteCommentActions=t,e.Module.instance().service("DeleteCommentActions",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(r,n,i,o,s,a,c,l,u,d,p,h,f,m,v){function S(){var e={detailsLocKey:"viewCannotBeAccessed",redirectState:"main.site.content.site.views",redirectLocKey:"backToViews"};n.go("main.error",e)}var g=this;this.$scope=r,this.$q=i,this.breadcrumbs=s,this.BrowserTitleService=a,this.comments=c,this.contentActions=l,this.views=d,this.server=p,r.viz={path:o.path,isAdminViz:!1,params:h.getVizParams(),siteUrlName:p.sessionSiteUrlName(),instanceId:h.getInstanceId(),isExplicitOriginalViz:h.getIsExplicitOriginalViz()},r.onVizSized=function(){return r.vizInitialized=!0},r.vizProps={},r.commentsAndTagsInitialized=!1,r.contentBreadcrumbUrl=function(){return s.siteUrl?"#"+s.siteUrl:n.href("main.site.content.site.projects")},r.projectBreadcrumbUrl=function(){return s.projectUrl?"#"+s.projectUrl:n.href("main.site.content.project.workbooks",{id:r.vizProps.view.workbook.project.id})},r.workbookBreadcrumbUrl=function(){return s.workbookUrl?"#"+s.workbookUrl:n.href("main.site.content.workbook.views",{id:r.vizProps.view.workbook.id})},r.addFavorite=function(){return f.addView(r.vizProps.view)},r.removeFavorite=function(){return f.removeView(r.vizProps.view)},r.$watch("viz.path",function(t){return t?(h.updatePath(r,{path:t}),g.hasError=!1,void d.getByPath(t).then(function(e){return g.loadNewViewInfo(e)}).then(function(){return g.$scope.commentsAndTagsInitialized=!0}).fail(function(t){t===e.CommonErrorCode.ViewNotFound&&p.isGuestEnabled()&&!p.isSessionSiteOrServerAdmin()?v.navigateToWithoutAddingToHistory(h.getEmbeddedVizqlUrl()):S()})):void S()}),r.$watch("viz.instanceId",function(e){e&&h.updateInstanceId(r,e)}),r.$watch("viz.isExplicitOriginalViz",function(e){h.updateExplicitOriginalViz(r,e)}),r.changeTags=function(e){return g.contentActions.setTagsOnView(r.vizProps.view,e).then(function(e){return e.errors&&e.errors.length?i.reject(e):i.when(e)}).then(function(){return d.getById(r.vizProps.view.id).then(function(e){return g.loadNewViewInfo(e)})})},r.increaseCommentList=function(){g.loadNewCommentInfo(t.COMMENT_PAGE_SIZE)},r.deleteComment=function(e,t){r.deletingCommentId=t.id,u.deleteComment(t,e).then(function(){r.comments.items=_.filter(r.comments.items,function(e){return e.id!==t.id}),g.loadNewCommentInfo()}).fin(function(){return r.deletingCommentId=""})},r.editComment=function(e,t){return g.comments.editComment(t,e).then(function(){return g.loadNewCommentInfo()})},r.createComment=function(e){return g.comments.createComment(r.vizProps.view.id,e).then(function(){return g.loadNewCommentInfo(1)})},r.canCurrentUserModifyComment=function(e){return p.isSessionSiteOrServerAdmin()||g.isCurrentUserId(e.owner.id)},r.isTouch=function(){return m.isTouch()},r.shouldShowWhoHasSeenThisView=function(){return r.vizProps.view&&(p.isSessionSiteOrServerAdmin()||g.isCurrentUserId(r.vizProps.view.workbook.owner.id))},h.reloadOnLocationChange(r)}return t.prototype.isCurrentUserId=function(e){return parseInt(this.server.sessionUserId(),10)===parseInt(e,10)},t.prototype.loadNewCommentInfo=function(e){var t=this;return void 0===e&&(e=0),this.comments.getSliceableCommentsForViz(this.$scope.vizProps.view.id).getSlice(0,this.$scope.comments.items.length+e).then(function(e){t.$scope.comments=e})},t.prototype.loadNewViewInfo=function(r){var n=this;return this.BrowserTitleService.setVizTitle(r.name,r.workbook.name),this.$scope.vizProps.view=r,this.$scope.comments=new e.ListResult([]),this.breadcrumbs.workbookChanged(r.workbook),this.views.markRecentlyViewed(r.id),this.$q.all([this.loadNewCommentInfo(t.COMMENT_PAGE_SIZE),this.views.actions(r.id).then(function(e){n.$scope.canSetTags=function(){return e.setTags},n.$scope.allowedAction=e})])},t.$inject=["$scope","$state","$q","$stateParams","BreadcrumbsService","BrowserTitleService","Comments","ContentActions","DeleteCommentActions","Views","ServerService","VizService","Favorites","BrowserSupportService","WindowLocationService"],t.COMMENT_PAGE_SIZE=10,t}();e.VizViewerCtrl=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n,i,o,s){var a=this;this.forms=[],t.server=s,t.forms={save:function(){var t=_.map(a.forms,function(e){return e.save()}),i=_.map(a.forms,function(e){return e.onSave?e.onSave():void 0});return r.all(t).then(function(){return r.all(i).then(function(){return o.pop({type:e.ToastType.Info,text:n.instant("settingsUpdateSuccess")})})},function(t){return o.pop({type:e.ToastType.Error,text:n.instant("settingsUpdateFailure")})})},cancel:function(){_.each(a.forms,function(e){return e.cancel()}),o.pop({type:e.ToastType.Info,text:n.instant("settingsReverted")})},isBusy:function(){return _.some(a.forms,function(e){return e.isBusy()})},isValid:function(){return _.every(a.forms,function(e){return e.isValid?e.isValid():!0})},isFormUnchanged:function(){return _.every(a.forms,function(e){return e.isFormUnchanged()})},resetSettings:function(){_.each(a.forms,function(e){e.resetSettings&&e.resetSettings()})}},t.showResetSettingsBtn=function(){return _.some(a.forms,function(e){return!!e.resetSettings})}}return t.prototype.registerFormState=function(e){this.forms.push(e)},t.$inject=["$scope","$q","$translate","$state","ToasterService","ServerService"],t}();e.SettingsCoordinatorCtrl=t,e.Module.instance().directive("tbSettingsCoordinator",function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"settingsCoordinator.html",controller:t}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){function r(t,r,n){t.state(r+".extractTasks",{url:"/extractRefreshes",templateUrl:"extractTasks.html",resolve:{subplace:["place",function(e){return e.subplace("extractTasks")}],extractTasksContext:n||o},controller:e.ExtractTasksCtrl})}function n(t,r){t.state(r+".subscriptions",{url:"/subscriptions",templateUrl:"subscriptions.html",resolve:{subplace:["place",function(e){return e.subplace("subscriptions")}]},controller:e.SubscriptionsCtrl})}function i(e,t){r(e,t),n(e,t)}var o=["ServerService",function(e){return{modifyExtractTasksPermission:e.isSessionSiteOrServerAdmin(),createExtractTaskFn:void 0}}];t.addExtractTasksState=r,t.addSubscriptionsState=n,t.addTaskSubstates=i}(t=e.ConfigHelper||(e.ConfigHelper={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"createSite",t)}return __extends(t,e),t}(e.Request);e.CreateSiteRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"deleteSites",t)}return __extends(t,e),t}(e.Request);e.DeleteSitesRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getSites",t)}return __extends(t,e),t}(e.Request);e.GetSitesRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"updateSiteAvailability",t)}return __extends(t,e),t}(e.Request);e.UpdateSiteAvailabilityRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"updateSiteSettingsForServerAdmin",t)}return __extends(t,e),t}(e.Request);e.UpdateSiteSettingsForServerAdminRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){!function(e){e[e.Queued=0]="Queued",e[e.InProgress=1]="InProgress",e[e.Complete=2]="Complete"}(e.LongRunningActionState||(e.LongRunningActionState={}));e.LongRunningActionState;!function(e){e[e.RebuildSearchIndex=0]="RebuildSearchIndex",e[e.DeleteSites=1]="DeleteSites",e[e.AssignPermissionsToContents=2]="AssignPermissionsToContents"}(e.LongRunningActionType||(e.LongRunningActionType={}));e.LongRunningActionType}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getActionInfo",t)}return __extends(t,e),t}(e.Request);e.GetActionInfoRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n,i){this.server=t,this.pollService=r,this.$q=n,this.$timeout=i,this.StringToStateDict={
queued:e.LongRunningActionState.Queued,inProgress:e.LongRunningActionState.InProgress,completed:e.LongRunningActionState.Complete},this.StringToTypeDict={rebuildSearchIndex:e.LongRunningActionType.RebuildSearchIndex,deleteSites:e.LongRunningActionType.DeleteSites},this.TypeToStringDict=Helpers.swapDict(this.StringToTypeDict)}return t.prototype.getLastByType=function(t){var r=this,n=this.TypeToStringDict[t];return this.server.sendRequest(new e.ServerApi.GetActionInfoRequest({actionType:n})).then(function(e){return e.actions&&e.actions.length?r.toLongRunningAction(e.actions[0]):null})},t.prototype.trackProgress=function(t){var r=this,n=function(t){return t.actions&&t.actions.length?r.StringToStateDict[t.actions[0].state]===e.LongRunningActionState.Complete:!0},i=this.pollService.poll(new e.ServerApi.GetActionInfoRequest({actionId:t}),n),o=i.promise.then(function(t){return t.actions&&t.actions.length?r.$q.when(r.toLongRunningAction(t.actions[0])):r.$q.reject(e.ErrorReason.ResourceNotFound)}).progress(function(e){return r.toLongRunningAction(e.actions[0])}),s={promise:o,cancel:i.cancel};return s},t.prototype.startProgressTrackingForResult=function(e){var t=this;return void 0===e&&(e=angular.noop),function(r){if(!r.actionId)return t.$q.reject(r);var n=t.trackProgress(r.actionId);return e(n),n.promise.then(function(e){return t.getLongRunningActionResult(e)})}},t.prototype.getLongRunningActionResult=function(e){var t=e;return t.response},t.prototype.startProgressTrackingForResponse=function(e){var t=this;return void 0===e&&(e=angular.noop),function(r){var n=t.trackProgress(r.actionId);return e(n),n.promise.then(function(e){var r=t.getLongRunningActionResult(e);return r?r.result:void 0})}},t.prototype.toLongRunningAction=function(e){var t={id:e.id,type:this.StringToTypeDict[e.type],state:this.StringToStateDict[e.state],percentComplete:e.percentComplete,response:e.response,succeeded:e.succeeded};return t},t.prototype.delayResultForSolr=function(){var t=this;return function(r){return t.$timeout(function(){return r},e.ErrorNotifyingServer.ResponseDelay)}},t.$inject=["ServerService","PollService","$q","$timeout"],t}();e.LongRunningActionService=t,e.Module.instance().service("LongRunningActionService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(){}return e.ACTIVE="active",e.SUSPENDED="suspended",e.LOCKED="locked",e}();e.SiteAvailabilityState=t;var r=function(r){function n(t,n,i,o,s,a,c){r.call(this,c.getServerResourceFetcher(e.ServerApi.GetSitesRequest,function(e){return e.sites})),this.$q=t,this.$translate=n,this.$timeout=i,this.LongRunningActionService=o,this.errorNotifyingServer=s,this.sizeFilter=a}return __extends(n,r),n.prototype.getSiteSettingsForServerAdminById=function(t){return this.errorNotifyingServer.sendRequest(new e.ServerApi.GetDetailRequest("getSiteSettingsForServerAdmin",t))},n.prototype.getSiteSettingsForSiteAdminById=function(t){return this.errorNotifyingServer.sendRequest(new e.ServerApi.GetDetailRequest("getSiteSettingsForSiteAdmin",t))},n.prototype.getCurrentSiteSettingsForServerAdmin=function(){return this.getSiteSettingsForServerAdminById(this.errorNotifyingServer.getServerService().sessionSiteId())},n.prototype.getCurrentSiteSettingsForSiteAdmin=function(){return this.getSiteSettingsForSiteAdminById(this.errorNotifyingServer.getServerService().sessionSiteId())},n.prototype.updateSiteAvailability=function(t,r){return this.errorNotifyingServer.sendRequests(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.UpdateSiteAvailabilityRequest({ids:t,availability:r})}),e.ResultHelper.combineResults)},n.prototype.suspend=function(e){return this.updateSiteAvailability(e,t.SUSPENDED)},n.prototype.activate=function(e){return this.updateSiteAvailability(e,t.ACTIVE)},n.prototype.updateSiteSettingsForServerAdmin=function(t,r,n){var i={id:t,settings:r};return n&&(i.subscriptionSettings=n),this.errorNotifyingServer.sendRequest(new e.ServerApi.UpdateSiteSettingsForServerAdminRequest(i))},n.prototype.updateSiteSettingsForSiteAdmin=function(t,r){var n={id:t,siteAdminSettings:r};return this.errorNotifyingServer.sendRequest(new e.ServerApi.UpdateSiteSettingsForSiteAdminRequest(n))},n.prototype.createSite=function(t,r,n){var i=this,o={settings:t};return r&&(o.siteAdminSettings=r),n&&(o.subscriptionSettings=n),this.errorNotifyingServer.sendRequestAndDelay(new e.ServerApi.CreateSiteRequest(o)).then(function(e){return e.errors?i.$q.reject(e.errors):void 0})},n.prototype.del=function(t){var r=this;return this.errorNotifyingServer.sendRequest(new e.ServerApi.DeleteSitesRequest({ids:t})).then(function(t){return t.actionId?r.LongRunningActionService.trackProgress(t.actionId).promise:r.$q.reject(e.ErrorReason.Unknown)}).then(function(t){return r.$timeout(function(){return t},e.ErrorNotifyingServer.ResponseDelay)})},n.prototype.errorMessage=function(t,r){switch(t){case e.SiteSettingsErrorCode.SiteNotFound:return this.$translate.instant("siteSettingsFailedSiteNotFound");case e.SiteSettingsErrorCode.SiteNameIsEmptyOrNull:return this.$translate.instant("siteSettingsFailedSiteNameIsEmptyOrNull");case e.SiteSettingsErrorCode.SiteAdminCannotAddUsersButUserQuotaIsSet:return this.$translate.instant("siteSettingsFailedSiteAdminCannotAddUsersButUserQuotaIsSet");case e.SiteSettingsErrorCode.InvalidUserQuotaOrStorageQuota:return this.$translate.instant("siteSettingsFailedInvalidUserQuotaOrStorageQuota");case e.SiteSettingsErrorCode.UserQuotaGreaterThanServerLicenseLimit:return this.$translate.instant("siteSettingsFailedUserQuotaGreaterThanServerLicenseLimit");case e.SiteSettingsErrorCode.InvalidCustomEmailAddress:return this.$translate.instant("siteSettingsFailedInvalidCustomEmailAddress");case e.SiteSettingsErrorCode.SiteNameOrUrlNameAlreadyExists:return this.$translate.instant("siteSettingsFailedSiteNameOrUrlNameAlreadyExists");case e.SiteSettingsErrorCode.SiteSubscriptionsSetWithDisabledServerSubscriptions:return this.$translate.instant("siteSettingsFailedSiteSubscriptionsSetWithDisabledServerSubscriptions");case e.SiteSettingsErrorCode.AttemptedToUpdateDefaultSiteUrlName:return this.$translate.instant("siteSettingsFailedAttemptedToUpdateDefaultSiteUrlName");case e.SiteSettingsErrorCode.AttemptedToSuspendDefaultSite:return this.$translate.instant("siteSettingsFailedAttemptedToSuspendDefaultSite");case e.SiteSettingsErrorCode.SiteNameTooLong:return this.$translate.instant("siteSettingsFailedSiteNameTooLong");case e.SiteSettingsErrorCode.SiteUrlNameTooLong:return this.$translate.instant("siteSettingsFailedSiteUrlNameTooLong");case e.SiteSettingsErrorCode.StorageQuotaLessThanStorageUsed:return this.$translate.instant("siteSettingsFailedStorageQuotaLessThanStorageUsed",{STORAGE_USED:this.sizeFilter(r.storageUsedBytes)});default:return this.$translate.instant("settingsUpdateFailure")}},n.$inject=["$q","$translate","$timeout","LongRunningActionService","ErrorNotifyingServer","sizeFilter","FetcherFactory"],n}(e.Resource);e.Sites=r,e.Module.instance().service("Sites",r)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t){var r=this;this.$location=e,this.Sites=t,this.urlParamsFn=function(){return r.$location.search()}}return t.prototype.create=function(){var t=new e.Place;return t.addSubplace(e.Subplace.create("sites",e.SitesContentType,this.Sites,this.urlParamsFn)),t},t.$inject=["$location","Sites"],t}();e.SitesPlace=t,e.Module.instance().service("SitesPlace",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(){e.call(this,"getMastheadNotifications",{})}return __extends(t,e),t}(e.Request);e.GetMastheadNotificationsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n){this.$sce=e,this.$q=t,this.toaster=r,this.ServerService=n,this.notificationsShown=!1}return t.prototype.showNotificationsIfEnabled=function(){var t=this;return this.notificationsShown?this.$q.when(null):this.fetchNotificationsUrl().then(function(r){if(r)if(e.FeatureFlags.reactToasts){var n=React.createClass({render:function(){return React.DOM.iframe({src:this.$sce.trustAsResourceUrl(r),style:{verticalAlign:"top",width:"100%",height:"36px",frameborder:"0",scrolling:"no"}})}});t.toaster.pop({type:e.ToastType.External,content:React.createElement(n,{}),timeoutDelay:e.ToasterService.NoTimeout})}else t.toaster.pop({type:e.ToastType.External,templateUrl:"mastheadNotificationToast.html",data:{contentUrl:t.$sce.trustAsResourceUrl(r)},timeout:e.ToasterService.NoTimeout})}).fin(function(){return t.notificationsShown=!0})},t.prototype.fetchNotificationsUrl=function(){return this.ServerService.sendRequest(new e.ServerApi.GetMastheadNotificationsRequest).then(function(e){return e.contentUrl})},t.$inject=["$sce","$q","ToasterService","ServerService"],t}();e.MastheadNotifications=t,e.Module.instance().service("MastheadNotifications",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(){e.call(this,"getPostLoginNotifications",{})}return __extends(t,e),t}(e.Request);e.GetPostLoginNotificationsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i){this.$sce=e,this.$q=t,this.modal=r,this.$rootScope=n,this.ServerService=i,this.notificationsShown=!1,this.notificationsEnabled=!1}return t.prototype.enableNotifications=function(){this.notificationsEnabled=!0},t.prototype.showNotificationsIfEnabled=function(){var t=this;return!this.notificationsEnabled||this.notificationsShown?this.$q.when(null):this.fetchNotificationsUrl().then(function(r){if(r){var n=t.$rootScope.$new();return n.notificationsUrl=t.$sce.trustAsResourceUrl(r),t.modal.open({scope:n,templateUrl:"postLoginNotifications.html",size:e.ModalSize.fitToContent}).result.fin(function(){return n.$destroy()})}}).fin(function(){return t.notificationsShown=!0})},t.prototype.fetchNotificationsUrl=function(){return this.ServerService.sendRequest(new e.ServerApi.GetPostLoginNotificationsRequest).then(function(e){return e.contentUrl})},t.$inject=["$sce","$q","ModalService","$rootScope","ServerService"],t}();e.PostLoginNotifications=t,e.Module.instance().service("PostLoginNotifications",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.SiteUrlNameCapturingRegex=/^\/site\/([^\/]+)/;var t=function(){function t(e){this.matcher=e}return t.prototype.concat=function(e){return new t(this.matcher.concat(e))},t.prototype.exec=function(t,r){var n="",i=t.match(e.SiteUrlNameCapturingRegex);i&&(n=i[1],t=t.split(i[0])[1]);var o=this.matcher.exec(t,r);return null!==o&&(o[e.UrlParamKeys.SiteUrlName]=n),o},t.prototype.parameters=function(){var t=this.matcher.parameters();return t.push(e.UrlParamKeys.SiteUrlName),t},t.prototype.format=function(t){var r="";return t[e.UrlParamKeys.SiteUrlName]&&(r="/site/"+t[e.UrlParamKeys.SiteUrlName]),_.has(t,e.UrlParamKeys.SiteUrlName)&&(t=angular.copy(t),delete t[e.UrlParamKeys.SiteUrlName]),r+this.matcher.format(t)},t}();e.SiteUrlMatcher=t;var r=function(){function e(e){this.$urlMatcherFactory=e}return e.prototype.compile=function(e){return new t(this.$urlMatcherFactory.compile(e))},e.prototype.$get=function(){return this},e.$inject=["$urlMatcherFactoryProvider"],e}();e.SiteUrlMatcherFactory=r,e.Module.instance().provider("SiteUrlMatcherFactory",r)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getDataConnectionAuthInfo",t)}return __extends(t,e),t}(e.Request);e.GetDataConnectionAuthInfoRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){void 0===t&&(t={}),e.call(this,"getLastActiveDirectoryGroupsSyncTime",t)}return __extends(t,e),t}(e.Request);e.GetLastActiveDirectoryGroupsSyncTimeRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().config(["$httpProvider","$sceProvider","$stateProvider","$urlRouterProvider","SiteUrlMatcherFactoryProvider","ApiPrefix",function(t,r,n,i,o,s){n.decorator("parent",function(e,t){e.self.$$state=e;var r=["ServerService",function(e){return e.getSessionInfoPromise().fail(angular.noop)}],n=_.extend({getSessionInfoPromise:r},e.self.resolve);return e.self.resolve=n,e.resolve=e.self.resolve,t(e)}),t.interceptors.push(function(){var t=new RegExp("^"+s);return{request:function(r){var n="GET"===r.method,i=/^inline_/.test(r.url),o=t.test(r.url);if(n&&!i&&!o){var s=/\.html$/.test(r.url),a=r.url.indexOf("?")>=0?"&":"?";r.url=r.url+a+e.BuildId,e.L10n.language&&s&&(r.url=e.L10n.language+"/"+r.url)}return r}}}),navigator.userAgent.match(/msie/i)&&document.documentMode>0&&document.documentMode<8&&r.enabled(!1);var a=function(e){return o.compile(e)},c=function(e){return["$match",function(t){return a(e).format(t)}]};i.when(a("/groups/{id}"),c("/groups/{id}/users")).when(a("/user/{domainName}/{username}"),c("/user/{domainName}/{username}/workbooks")).when(a("/user/{domainName}/{username}/"),c("/user/{domainName}/{username}/workbooks")).when(a("/tasks"),c("/tasks/extractRefreshes")).when("/server","/server/status").when("/server/user/{domain}/{username}","/server/user/{domain}/{username}/settings").when("/server/user/{domain}/{username}/","/server/user/{domain}/{username}/settings").when("/server/tasks","/server/tasks/extractRefreshes").otherwise(function(e){if(e.get("ServerService").inSession())e.get("$state").go("main.error");else{var t=e.get("$location").url();e.get("$state").go("login.authenticate",{redirect:t})}});var l=["$location","GettingStartedNotifications","PostLoginNotifications",function(t,r,n){var i=t.search();_.has(i,e.UrlParamKeys.IsFromSaml)&&(Helpers.BooleanQueryParamRegex.test(i[e.UrlParamKeys.IsFromSaml])&&(r.enableNotifications(),n.enableNotifications()),t.search(e.UrlParamKeys.IsFromSaml,null))}];n.state("login",{"abstract":!0,template:"<div ui-view></div>",data:{authLevel:e.AuthLevel.Anonymous},onEnter:l}).state("login.interstitial",{template:"<tb:signing-in></tb:signing-in>"}).state("login.authenticate",{url:"/signin?redirect&error&externalRedirect&site&closePopupWhenDone&disableAutoSignin",templateUrl:"login.html",controller:e.LoginCtrl}).state("login.signedOut",{url:"/signedOut",templateUrl:"signedOut.html",controller:e.SignedOutCtrl}).state("login.site",{url:"/site",templateUrl:"loginSitePicker.html",data:{authLevel:e.AuthLevel.Authenticated},controller:e.LoginSitePickerCtrl}).state("login.init",{templateUrl:"initialization.html",controller:e.InitializationCtrl}).state("login.untrusted",{templateUrl:"untrusted.html"}).state("login.error",{url:"/error",templateUrl:"errorNoSite.html"}).state("login.error.errorCode",{url:"/{errorCode}",templateUrl:"error.html",controller:e.ErrorCtrl}).state("login.error.noSite",{templateUrl:"error.html",params:[e.ErrorCtrl.StateParamKeys.DetailsLocKey,e.ErrorCtrl.StateParamKeys.RedirectState,e.ErrorCtrl.StateParamKeys.RedirectLocKey],controller:e.ErrorCtrl}).state("login.error.auth",{url:"/signin/{errorCode}?redirectPath",templateUrl:"errorSignIn.html",controller:e.SignInErrorCtrl}),n.state("authenticate",{url:"/authenticate?path&attributes&sessionId&isPreview&closePopupWhenDone",templateUrl:"authenticateConnection.html",resolve:{authInfo:["$stateParams","ServerService",function(t,r){return r.sendRequest(new e.ServerApi.GetDataConnectionAuthInfoRequest(t))}]},controller:e.AuthenticateConnectionCtrl,data:{authLevel:e.AuthLevel.Anonymous}}),n.state("main",{"abstract":!0,url:"",templateUrl:"main.html",data:{authLevel:e.AuthLevel.Authenticated},onEnter:l,controller:["$scope","DisplaySettingsService",function(e,t){t.updateDisplayModeFromUrl(),t.maybeUpdateDisplayModeFromSession(),e.displaySettings=t,e.$on("$locationChangeSuccess",function(){t.updateDisplayModeFromUrl(),t.updateShowFilterPanel()}),e.$watch(function(){return e.displaySettings.displayMode},function(e,r){e!==r&&t.saveDisplayMode()})}]}),n.state("main.site",{"abstract":!0,url:o.compile(""),template:"<div ui-view></div>",onEnter:["PostLoginNotifications","GettingStartedNotifications","MastheadNotifications",function(e,t,r){e.showNotificationsIfEnabled().fin(function(){return t.showNotificationsIfEnabled()}).fin(function(){return r.showNotificationsIfEnabled()})}]}),n.state("main.server",{"abstract":!0,url:"/server",template:"<div ui-view></div>",data:{authLevel:e.AuthLevel.ServerAdmin}}).state("main.server.status",{url:"/status",templateUrl:"serverStatus.html",resolve:{hosts:["ServerInfoService",function(e){return e.fetch()}],rebuildSearchIndexCurrentJob:["RebuildSearchIndexService",function(e){return e.handleCurrentJob()}]},controller:e.ServerStatusCtrl}).state("main.server.settings",{templateUrl:"serverSettingsTabs.html","abstract":!0,controller:["$scope","ServerService",function(e,t){e.server=t}]}).state("main.server.settings.serverSettings",{url:"/settings",templateUrl:"serverSettings.html",data:{authLevel:e.AuthLevel.ServerAdmin},resolve:{serverSettings:["ServerSettings",function(e){return e.fetch()}],lastActiveDirectoryGroupsSyncTime:["ServerService",function(t){return t.sendRequest(new e.ServerApi.GetLastActiveDirectoryGroupsSyncTimeRequest).then(function(e){return e.time})}],siteSettingsForServerAdmin:["ServerService","Sites",function(e,t){return e.getSessionInfoPromise().then(function(){return t.getCurrentSiteSettingsForServerAdmin()})}],siteSettingsForSiteAdmin:["ServerService","Sites",function(e,t){return e.getSessionInfoPromise().then(function(){return t.getCurrentSiteSettingsForSiteAdmin()})}]},controller:["$scope","BrowserTitleService","ServerService","siteSettingsForServerAdmin","siteSettingsForSiteAdmin","serverSettings","lastActiveDirectoryGroupsSyncTime",function(e,t,r,n,i,o,s){t.setTitle("serverSettings_general"),e.server=r,e.siteSettingsForServerAdmin=n,e.siteSettingsForSiteAdmin=i,e.isDefaultSite=n.settings&&""===n.settings.urlName,e.hideNameAndId=!r.isSessionMultiSite(),e.serverSettings=o,e.liveDBAvailable=r.isLiveDBAvailable(),e.lastActiveDirectoryGroupsSyncTime=s}]}).state("main.server.settings.licenses",{url:"/licenses",templateUrl:"licenses.html",resolve:{licensingInfo:["LicensesService",function(e){return e.fetch()}]},controller:e.LicensesCtrl}).state("main.server.settings.addSite",{url:"/addSite",templateUrl:"addSite.html",controller:e.AddSiteCtrl}).state("main.server.analysis",{url:"/analysis/{sheetUrlId}",templateUrl:"adminVizViewer.html",resolve:{workbookUrlId:function(){return"tabbed_admin_views"}},controller:e.AdminVizViewerCtrl}).state("main.server.sites",{"abstract":!0,templateUrl:"sites.html",resolve:{place:["SitesPlace",function(e){return e.create()}]},controller:e.SitesPlaceCtrl});var u={subplace:["place",function(e){return e.subplace("sites")}],resource:"Sites",detailsUrl:function(){return""},projectUrl:function(){return""},workbookUrl:function(){return""},defaultOrder:function(){return e.SitesContentType.defaultOrder},shouldFetchDetails:function(){return function(){return!0}}};n.state("main.server.sites.sites",{url:"/sites",templateUrl:"contentSubplace.html",controller:e.ContentSubplaceCtrl,resolve:u}),n.state("main.server.users",{url:"/users",templateUrl:"serverUsersPlace.html",data:{authLevel:e.AuthLevel.ServerAdmin},controller:e.ServerUsersPlaceCtrl}),n.state("main.site.users",{url:"/users",templateUrl:"siteUsersPlace.html",data:{authLevel:e.AuthLevel.SiteAdmin},resolve:{canSessionUserManageUsers:["ServerService",function(e){return e.canSessionUserManageUsers()}]},controller:e.SiteUsersPlaceCtrl}),n.state("main.server.user",{"abstract":!0,url:"/user/:domainName/{username:.*}",templateUrl:"serverUserPlace.html",controller:e.ServerUserPlaceCtrl,resolve:{isSessionUserSelf:["ServerService",function(e){return e.isSessionUserSelf()}],serverUser:["ServerUsers","$stateParams",function(e,t){return e.getUserByUsernameAndDomain(t.username,t.domainName)}],userSettings:["UserSettingsStore","$stateParams",function(e,t){return e.getUserSettings(t.username,t.domainName)}],userDoesNotExist:["$state","serverUser","ServerService",function(e,t,r){if(!t)if(r.canSessionUserManageUsers()){var n={detailsLocKey:"userCannotBeAccessed",redirectState:"main.server.users",redirectLocKey:"backToUsers"};e.go("main.error",n)}else e.go("main.error")}]}}).state("main.server.user.settings",{url:"/settings",templateUrl:"serverUserSettingsSubplace.html",controller:e.ServerUserSettingsSubplaceCtrl,resolve:{serverUser:["ServerUsers","$stateParams",function(e,t){return e.getUserByUsernameAndDomain(t.username,t.domainName)}],userRefreshTokenCount:["ServerUsers","$stateParams",function(e,t){return e.getUserRefreshTokenCount(t.username,t.domainName)}]}}),n.state("main.site.groups",{url:"/groups",templateUrl:"groupsPlace.html",data:{authLevel:e.AuthLevel.SiteAdmin},controller:e.GroupsPlaceCtrl}),n.state("main.site.group",{"abstract":!0,url:"/groups/:id",templateUrl:"group.html",data:{authLevel:e.AuthLevel.SiteAdmin},resolve:{group:["Groups","$stateParams",function(e,t){return e.getById(t.id)}],groupDoesNotExist:["$state","group","ServerService",function(e,t,r){t||e.go("main.error",{detailsLocKey:"groupCannotBeAccessed",redirectState:"main.site.groups",redirectLocKey:"backToGroups"})}]},controller:e.GroupPlaceCtrl}).state("main.site.group.users",{url:"/users",templateUrl:"groupUsersSubplace.html",controller:e.GroupUsersSubplaceCtrl}).state("main.site.group.details",{url:"/details",templateUrl:"groupDetails.html",resolve:{groupDetails:["Groups","group",function(e,t){return e.getGroupDetails(t.id)}],canSessionUserManageUsers:["ServerService",function(e){return e.canSessionUserManageUsers()}]},controller:e.GroupDetailsCtrl});var d={data:{authLevel:e.AuthLevel.ServerAdmin},resolve:{siteId:function(){return null}}},p={data:{authLevel:e.AuthLevel.SiteAdmin},resolve:{siteId:["ServerService",function(e){return e.waitForSession().then(function(){return e.sessionSiteId()})}]}},h=function(t,r){var i={url:"/schedules",templateUrl:"schedules.html",controller:e.SchedulesCtrl};$.extend(!0,i,r),n.state(t+"s",i);var o={"abstract":!0,resolve:{schedule:["Schedules","$stateParams","siteId",function(e,t,r){return e.getByIdForSite(t.id,r)}],place:["TaskPlace","siteId","schedule",function(e,t,r){return e.create(t,{schedule:r.id})}]},url:"/schedules/:id",templateUrl:"schedule.html",controller:e.ScheduleCtrl};$.extend(!0,o,r),n.state(t,o),n.state(t+".details",{url:"/details",templateUrl:"scheduleDetails.html",controller:e.setBrowserTitleCtrl("details")}),e.ConfigHelper.addTaskSubstates(n,t)};h("main.server.schedule",d),h("main.site.schedule",p);var f=function(t,r){var i={"abstract":!0,url:"/tasks",templateUrl:"tasks.html",controller:e.TasksCtrl,resolve:{place:["TaskPlace","siteId",function(e,t){return e.create(t)}]}};$.extend(!0,i,r),n.state(t,i),e.ConfigHelper.addTaskSubstates(n,t)};f("main.server.tasks",d),f("main.site.tasks",p),n.state("main.site.viz",{url:"/views/*path",templateUrl:"vizViewer.html",controller:e.VizViewerCtrl}),n.state("main.site.status",{url:"/status",templateUrl:"siteStatus.html",data:{authLevel:e.AuthLevel.SiteAdmin},controller:e.setBrowserTitleCtrl("siteStatus")}).state("main.site.analysis",{url:"/analysis/{sheetUrlId}",templateUrl:"adminVizViewer.html",data:{authLevel:e.AuthLevel.SiteAdmin},resolve:{workbookUrlId:function(){return"tabbed_site_views"}},controller:e.AdminVizViewerCtrl}),n.state("main.site.settings",{templateUrl:"siteSettingsTabs.html","abstract":!0,controller:["$scope","ServerService",function(e,t){e.server=t}]}).state("main.site.settings.siteSettings",{url:"/settings",templateUrl:"siteSettings.html",data:{authLevel:e.AuthLevel.SiteAdmin},resolve:{siteSettingsForServerAdmin:["ServerService","Sites",function(e,t){return e.isSessionServerAdmin()?e.getSessionInfoPromise().then(function(){return t.getCurrentSiteSettingsForServerAdmin()}):null}],siteSettingsForSiteAdmin:["ServerService","Sites",function(e,t){return e.getSessionInfoPromise().then(function(){return t.getCurrentSiteSettingsForSiteAdmin()})}]},controller:["$scope","BrowserTitleService","ServerService","siteSettingsForServerAdmin","siteSettingsForSiteAdmin",function(e,t,r,n,i){var o=r.isSessionMultiSite();e.server=r,e.siteSettingsForServerAdmin=n,e.siteSettingsForSiteAdmin=i,e.liveDBAvailable=r.isLiveDBAvailable(),null!==e.siteSettingsForServerAdmin&&(e.isDefaultSite=e.siteSettingsForServerAdmin.settings&&""===e.siteSettingsForServerAdmin.settings.urlName),e.hideNameAndId=!o,t.setTitle(o?"siteSettings":"settings")}]}).state("main.site.settings.authentication",{url:"/authentication",templateUrl:"siteAuthenticationSettings.html",controller:e.SiteAuthenticationCtrl,resolve:{siteSettingsForSiteAdmin:["ServerService","Sites",function(e,t){return e.getSessionInfoPromise().then(function(){return t.getCurrentSiteSettingsForSiteAdmin()})}],configuration:["ServerService",function(t){return t.sendRequest(new e.ServerApi.GetSiteSAMLConfigurationRequest)}],allowTransition:["ServerService",function(e,t){return e.isThirdPartyAuthConfiguredForServer()?void 0:t.reject()}]},data:{authLevel:e.AuthLevel.SiteAdmin}}),n.state("main.error",{templateUrl:"error.html",params:[e.ErrorCtrl.StateParamKeys.DetailsLocKey,e.ErrorCtrl.StateParamKeys.RedirectState,e.ErrorCtrl.StateParamKeys.RedirectLocKey,e.ErrorCtrl.StateParamKeys.RedirectSiteUrlName],controller:e.ErrorCtrl}),e.FeatureFlags.homePlaceEnabled&&n.state("main.site.home",{url:"/home",templateUrl:"home.html",controller:e.HomeCtrl})}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n,i,o,s){var a=this;this.$scope=t,this.$state=r,this.EditConnectionAction=i,this.CreateExtractTasksAction=o,this.ServerService=s,n.setTitle("dataConnection",t.objectName),this.isEditing=!1,this.datasource=t.datasource;var c=e.Set.singleton(this.datasource,function(e){return e.id});t.isOAuth=this.isOAuth(),t.canEditConnection=this.canEditConnection(),t.dataConnectionIsReading=function(){return!t.dataConnectionIsEditing()},t.dataConnectionIsEditing=function(){return a.isEditing&&a.canEditConnection()},t.refreshNow=function(t){a.CreateExtractTasksAction.forDatasource(a.datasource,e.ActionContext.fromEvent(t),e.CreateExtractTasksMode.AllowRefreshNow).then(function(){return a.$state.hardReload()})},t.requestRefreshNowIsDisabled=function(){return a.currentRefreshModeIsRemote()},t.editOAuth=function(e){t.oauthEditModel=a.EditConnectionAction.createOAuthEditModel(c),t.testConnectionResult={isPending:!1},a.isEditing=!0},t.beginEdit=function(){a.isEditing=!0,t.editModel={serverName:a.datasource.connectionDetails.serverName,serverPort:a.datasource.connectionDetails.serverPort,username:a.datasource.connectionDetails.databaseUsername,password:{isEmbedded:a.datasource.connectionDetails.hasEmbeddedPassword,newPassword:e.PasswordUnchanged}}},t.save=function(){t.isSaving=!0;var e;t.canEditConnection&&!t.isOAuth?e=i.applyConnectionEdits(c,t.editModel):t.canEditConnection&&t.isOAuth&&(e=i.updateOAuthConnections(c,t.oauthEditModel)),e.then(function(){return a.$state.hardReload()})},t.cancel=function(){a.isEditing=!1,t.testConnectionResult={isPending:!1},t.oauthEditModel=a.$scope.oauthInitialEditModel},t.requestTestConnectionIsDisabled=function(){return a.currentRefreshModeIsRemote()},t.isOAuth?(this.EditConnectionAction.configureEditOAuthScope(this.$scope,c),this.$scope.oauthInitialEditModel=this.$scope.oauthEditModel):t.testConnection=function(){return a.testConnection()}}return t.prototype.testConnection=function(){this.$scope.testConnectionResult=this.isEditing?this.EditConnectionAction.checkEditedConnection(this.datasource.id,this.$scope.editModel):this.EditConnectionAction.checkExistingConnection(this.datasource.id)},t.prototype.isOAuth=function(){return this.datasource.connectionOAuth&&this.datasource.connectionDetails.type===e.ServerApi.ConnectionDetailType.Database},t.prototype.currentUserAllowedToEdit=function(){return this.ServerService.isSessionSiteOrServerAdmin()||this.datasource.owner.id===this.ServerService.sessionUserId()},t.prototype.canEditConnection=function(){return this.datasource.connectionTypeEditable&&this.currentUserAllowedToEdit()},t.prototype.hasRemoteRefreshProperties=function(){return this.ServerService.featureFlags().dataSyncEnabled&&this.datasource.hasExtracts&&!this.isOAuth()},t.prototype.currentRefreshModeIsRemote=function(){return this.hasRemoteRefreshProperties()&&this.datasource.refreshMode===e.ServerApi.RefreshModeTypes.Remote},t.$inject=["$scope","$state","BrowserTitleService","EditConnectionAction","CreateExtractTasksAction","ServerService"],t}();e.DatasourceDataConnectionCtrl=t,e.Module.instance().controller("DatasourceDataConnectionCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n,i,o,s,a,c,l,u){if(t.multisite=n.isSessionMultiSite(),c)t.siteRole=c.siteRole,t.user=c,t.objectName=c.displayName;else{if(!i)throw new Error("User does not exist on this site");t.siteRole=e.ServerApi.SiteRoles.ServerAdministrator,t.user=_.omit(u,"lastSignIn"),t.objectName=u.displayName}t.userSettings=l,t.hasUserSettings=!e.ResultHelper.hasErrors(l),t.isSessionServerAdmin=i,t.isSessionSiteOrServerAdmin=i||o,t.isSessionUserSelf=s,e.SubplaceCountsHelper.keepSubplaceCountsUpdated(t,a),e.SubplaceTabsHelper.refreshWhenCurrentTabClicked(t,r)}return t.$inject=["$scope","$state","ServerService","isSessionServerAdmin","isSessionSiteAdmin","isSessionUserSelf","place","siteUser","userSettings","serverUser"],t}();e.SiteUserPlaceCtrl=t,e.Module.instance().controller("SiteUserPlaceCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"associateOAuthCredential",t)}return __extends(t,e),t}(e.Request);e.AssociateOAuthCredentialRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"deleteOAuthCredentials",{ids:t})}return __extends(t,e),t}(e.Request);e.DeleteOAuthCredentialsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"disassociateOAuthCredential",t)}return __extends(t,e),t}(e.Request);e.DisassociateOAuthCredentialRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getCommonUserOAuthCredential",t)}return __extends(t,e),t}(e.Request);e.GetCommonUserOAuthCredentialRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){e.OAuthCredentialTypes={Salesforce:"salesforce",BigQuery:"bigquery",GoogleAnalytics:"google-analytics"}}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getOAuthCredentialAssociatedWithResource",t)}return __extends(t,e),t}(e.Request);e.GetOAuthCredentialAssociatedWithResourceRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getOAuthCredentials",t)}return __extends(t,e),t}(e.Request);e.GetOAuthCredentialsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"testOAuthCredential",{id:t})}return __extends(t,e),t}(e.Request);e.TestOAuthCredentialRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(t){function r(r,n,i){t.call(this,i.getServerResourceFetcher(e.ServerApi.GetOAuthCredentialsRequest,function(e){return e.credentials})),this.ErrorNotifyingServer=r,this.serverService=n}return __extends(r,t),r.prototype.del=function(t){return this.ErrorNotifyingServer.sendRequests(e.RequestHelper.buildRequests(t,function(t){
return new e.ServerApi.DeleteOAuthCredentialsRequest(t)}),e.ResultHelper.combineResults)},r.prototype.test=function(t){return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.TestOAuthCredentialRequest(t))},r.prototype.associateWithDatasource=function(t,r){return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.AssociateOAuthCredentialRequest({credentialId:r,resourceId:t,resourceType:"Datasource"}))},r.prototype.disassociateFromDatasource=function(t){return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.DisassociateOAuthCredentialRequest({resourceId:t,resourceType:"Datasource"}))},r.prototype.credentialForDatasource=function(t){return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.GetOAuthCredentialAssociatedWithResourceRequest({resourceId:t,resourceType:"Datasource"}))},r.prototype.commonCredentialForDatasources=function(t){return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.GetCommonUserOAuthCredentialRequest({ids:t}))},r.prototype.canAddForConnectionType=function(t){switch(t){case e.ServerApi.OAuthCredentialTypes.Salesforce:return this.serverService.oauthSalesforceEnabled();case e.ServerApi.OAuthCredentialTypes.BigQuery:case e.ServerApi.OAuthCredentialTypes.GoogleAnalytics:return this.serverService.oauthGoogleEnabled();default:return!1}},r.$inject=["ErrorNotifyingServer","ServerService","FetcherFactory"],r}(e.Resource);e.OAuthCredentials=t,e.Module.instance().service("OAuthCredentials",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e,t,r,n){var i=this;this.$window=e,this.$rootScope=t,this.$q=r,this.WindowLocationService=n,this.deferred=r.defer(),e.tableauPopupComplete=function(e){return i.handleResponse(e)},$(e).on("message",function(e){var t=e.originalEvent;if(t.source==i.openWindow){var r=t.data;_.isString(r)&&i.handleResponse(r)}}),$(e).on("unload",function(){return i.removeOpenWindow()})}return e.prototype.handleResponse=function(e){void 0===e&&(e="");var t=e.match(/errorCode=([^&]*)/);if(t){var r=parseInt(t[1],10)||0;return void this.notifyError(r)}var n=e.match(/id=([^&]*)/);return n?void this.notifySuccess(n[1]):void this.notifySuccess("")},e.prototype.removeOpenWindow=function(){try{this.openWindow.close()}catch(e){}this.openWindow=null},e.prototype.notifySuccess=function(e){this.deferred.resolve(e),this.removeOpenWindow()},e.prototype.notifyError=function(e){this.deferred.reject(e),this.removeOpenWindow()},e.prototype.getPopupSpecs=function(){var e={width:800,height:600,toolbar:1,resizable:1},t=this.$window.screenLeft||this.$window.screenX,r=this.$window.outerWidth||this.$window.innerWidth,n=this.$window.screenTop||this.$window.screenY,i=this.$window.outerHeight||this.$window.innerHeight;return e.left=t+(r-e.width)/2,e.top=n+(i-e.height)/8,e},e.prototype.href=function(t){return e.OAuthPath+"?"+$.param({data_class:t})},e.prototype.attemptAuth=function(t){this.cancelPendingAuthAttempt(),this.deferred=this.$q.defer(),this.openWindow=this.WindowLocationService.open(this.href(t),e.WindowName,this.getPopupSpecs());try{this.openWindow.focus()}catch(r){}return this.deferred.promise},e.prototype.cancelPendingAuthAttempt=function(){return this.notifyError()},e.OAuthPath="/auth/request_oauth",e.WindowName="TableauAuth",e.$inject=["$window","$rootScope","$q","WindowLocationService"],e}();e.AddOAuthCredentialAction=t,e.Module.instance().service("AddOAuthCredentialAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getRemoteRefreshAgents",t)}return __extends(t,e),t}(e.Request);e.GetRemoteRefreshAgentsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"deleteRemoteRefreshAgents",t)}return __extends(t,e),t}(e.Request);e.DeleteRemoteRefreshAgentsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(t){function r(r,n){t.call(this,n.getServerResourceFetcher(e.ServerApi.GetRemoteRefreshAgentsRequest,e.ServerApiMapper.remoteRefreshAgents)),this.ErrorNotifyingServer=r}return __extends(r,t),r.prototype.get=function(){return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.GetRemoteRefreshAgentsRequest({withContent:!1}))},r.prototype.getWithContent=function(){return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.GetRemoteRefreshAgentsRequest({withContent:!0}))},r.prototype.del=function(t){var r=_.map(t.toArray(),function(e){return e.name});return this.ErrorNotifyingServer.sendRequests(e.RequestHelper.buildRequests(r,function(t){return new e.ServerApi.DeleteRemoteRefreshAgentsRequest({agentNames:t})}),e.ResultHelper.combineResults)},r.$inject=["ErrorNotifyingServer","FetcherFactory"],r}(e.Resource);e.RemoteRefreshAgents=t,e.Module.instance().service("RemoteRefreshAgents",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n){this.$translate=e,this.ConfirmActionDialog=t,this.ContentActionNotification=r,this.RemoteRefreshAgents=n}return t.prototype.execute=function(t,r){var n=this;return this.ConfirmActionDialog.open({scope:r.scope.$new(),title:this.$translate.instant("delete"),bodyText:this.$translate.instant("confirmDeleteRemoteRefreshAgents",{COUNT:t.size()},e.L10n.Interpolations.Count),position:e.ModalService.anchoredTo(r.targetElement),actionName:this.$translate.instant("confirmDeleteButton",{ITEM_COUNT:t.size()},e.L10n.Interpolations.Count),action:function(r){return n.RemoteRefreshAgents.del(t).then(function(i){if(i.errors&&i.errors.length){var o=n.errorMessageFor(i.errors[0]);r.showErrorMessage(o)}else n.ContentActionNotification.notifySuccess(n.$translate.instant("deleteRemoteRefreshAgentsSuccess",{ITEM_COUNT:t.size()},e.L10n.Interpolations.Count));return i})}}).result},t.prototype.errorMessageFor=function(e){return this.$translate.instant("errorUnknown")},t.$inject=["$translate","ConfirmActionDialog","ContentActionNotification","RemoteRefreshAgents"],t}();e.DeleteRemoteRefreshAgentsAction=t,e.Module.instance().service("DeleteRemoteRefreshAgentsAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){void 0===t&&(t={}),e.call(this,"deleteMySavedPasswordsAndCredentials",t)}return __extends(t,e),t}(e.Request);e.DeleteMySavedPasswordsAndCredentialsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i){this.$translate=e,this.$q=t,this.ConfirmActionDialog=r,this.serverService=n,this.ToasterService=i}return t.prototype.executeFromEvent=function(t){var r=this,n=e.ActionContext.fromEvent(t),i=this.ConfirmActionDialog.open({scope:n.scope,title:this.$translate.instant("clearSavedCredentials"),bodyText:this.$translate.instant("clearUserSavedCredentialsConfirmMessage"),actionName:this.$translate.instant("clearSavedCredentialsConfirmButton"),isDeleteAction:!0,action:function(t){return r.serverService.sendRequest(new e.ServerApi.DeleteMySavedPasswordsAndCredentialsRequest).then(e.ResultHelper.rejectResultOnError(r.$q)).then(_.identity,function(){return t.showErrorMessage(r.$translate.instant("clearSavedCredentialsError"))})}});return i.result.then(function(t){r.ToasterService.pop({type:e.ToastType.Info,text:r.$translate.instant("clearSavedCredentialsSuccess")})}),i.result},t.$inject=["$translate","$q","ConfirmActionDialog","ServerService","ToasterService"],t}();e.DeleteMyCredentialsAction=t,e.Module.instance().service("DeleteMyCredentialsAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(t){function r(e,r,n,i,o){t.call(this,e,r),this.$translate=n,this.$filter=i,this.OAuthCredentials=o}return __extends(r,t),r.prototype.configureDialog=function(t,r){var n=this,i=1===r.size()?this.$translate.instant("confirmDeleteOAuthCredential",{USERNAME:e.L10n.elideIfLong(r.first().username),TRANSLATED_TYPE:this.$filter("credentialType")(r.first().type)}):this.$translate.instant("confirmDeleteOAuthCredentials",{CREDENTIAL_COUNT:r.size()},e.L10n.Interpolations.Count);t.bodyText=i,t.title=this.$translate.instant("delete"),t.actionName=this.$translate.instant("confirmDeleteButton",{ITEM_COUNT:r.size()},e.L10n.Interpolations.Count),t.isDeleteAction=!0,t.action=function(){return n.OAuthCredentials.del(r.keys())}},r.prototype.notificationTranslationIds=function(){return{successId:"deleteOAuthCredentialsSuccess",errorId:"deleteOAuthCredentialsError"}},r.$inject=["ConfirmActionDialog","ContentActionNotification","$translate","$filter","OAuthCredentials"],r}(e.AbstractContentAction);e.DeleteOAuthCredentialsAction=t,e.Module.instance().service("DeleteOAuthCredentialsAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n){this.$translate=e,this.ConfirmActionDialog=t,this.ContentActionNotification=r,this.ServerUsers=n}return t.prototype.execute=function(t,r,n){var i=this;return this.ConfirmActionDialog.open({scope:n.scope.$new(),title:this.$translate.instant("delete"),bodyText:this.$translate.instant("confirmDeleteConnectedDevice",{NAME:e.L10n.elideIfLong(t.displayName)}),position:e.ModalService.anchoredTo(n.targetElement),actionName:this.$translate.instant("delete"),action:function(n){return i.ServerUsers.deleteUserConnectedDevices(r,[t.id]).then(function(r){if(r.errors&&r.errors.length){var o=i.errorMessageFor(r.errors[0]);n.showErrorMessage(o)}else i.ContentActionNotification.notifySuccess(i.$translate.instant("deleteConnectedDeviceSuccess",{NAME:e.L10n.elideIfLong(t.displayName)}));return r})}}).result},t.prototype.errorMessageFor=function(e){return this.$translate.instant("errorUnknown")},t.$inject=["$translate","ConfirmActionDialog","ContentActionNotification","ServerUsers"],t}();e.DeleteConnectedDeviceAction=t,e.Module.instance().service("DeleteConnectedDeviceAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n,i,o,s,a,c,l,u,d,p,h,f,m,v,S,g){var y=this;if(this.serverService=l,this.oAuthCredentials=u,e.ResultHelper.hasErrors(o)&&r.go("main.error",{detailsLocKey:"userCannotBeAccessed",redirectState:"main.site.users",redirectLocKey:"backToUsers"}),p.setTitle("settings",t.objectName),n.initScope(t,i,a,c,o,s),t.canManageCredentials=!0,t.remoteRefreshAgents=[],t.isSAMLUser=!!c&&c.authSetting===e.ServerApi.SiteUserAuthSetting.Saml,t.remoteAgentManagerEnabled=e.FeatureFlags.dataSyncEnabled&&!e.FeatureFlags.connectedClientsTableEnabled,t.remoteAgentManagerEnabled){var A=function(){m.getWithContent().then(function(r){r&&(t.remoteRefreshAgents=e.RemoteRefreshAgentMapper.mapToResource(r.agents))})};A(),t.deleteRemoteRefreshAgent=function(t,r){return v.execute(e.Set.fromIdItemArray([t]),e.ActionContext.fromEvent(r)).then(A)}}if(t.oneByOneConnectedDeviceManagement=e.FeatureFlags.connectedClientsTableEnabled,t.oneByOneConnectedDeviceManagement){var P=function(){return S.getUserConnectedDevices(a.id).then(function(e){return t.connectedDevices=e})};P(),t.deleteConnectedDevice=function(t,r){return g.execute(t,a.id,e.ActionContext.fromEvent(r)).then(P)}}t.credentialsLists=this.createOAuthCredentialLists();var C=function(){e.SliceableHelper.fetchAll(u.all()).then(function(e){t.credentialsLists=y.createOAuthCredentialLists(e.items)})};C(),t.deleteAllCredentials=function(e){return f.executeFromEvent(e).then(C)},t.addCredentialHref=function(e){return d.href(e)},t.addCredential=function(e){d.attemptAuth(e).then(C)},t.deleteCredential=function(t,r){return h.executeFromEvent(e.Set.fromIdItemArray([t.credential]),r).then(C)},t.testCredential=function(e){return y.testCredential(e)},t.$on("$destroy",function(){return d.cancelPendingAuthAttempt()})}return t.prototype.testCredential=function(e){e.test={inProgress:!0};var t=function(t){e.test={success:t}};this.oAuthCredentials.test(e.credential.id).then(t,function(){return t(!1)})},t.prototype.oauthEnabledForCredentialType=function(t){switch(t){case e.ServerApi.OAuthCredentialTypes.Salesforce:return this.serverService.oauthSalesforceEnabled();case e.ServerApi.OAuthCredentialTypes.BigQuery:case e.ServerApi.OAuthCredentialTypes.GoogleAnalytics:return this.serverService.oauthGoogleEnabled()}},t.prototype.createOAuthCredentialLists=function(e){var r=this,n=function(e){return{credential:e,test:{}}},i=_.groupBy(e,function(e){return e.type});return _.compact(_.map(t.OAuthListOrder,function(e){var t={type:e,addEnabled:r.oauthEnabledForCredentialType(e),credentials:_.map(i[e],n)};return t.addEnabled||t.credentials.length>0?t:null}))},t.OAuthListOrder=[e.ServerApi.OAuthCredentialTypes.Salesforce,e.ServerApi.OAuthCredentialTypes.BigQuery,e.ServerApi.OAuthCredentialTypes.GoogleAnalytics],t.$inject=["$scope","$state","UserSettingsCtrlCommon","isSessionUserSelf","userSettings","userRefreshTokenCount","serverUser","siteUser","ServerService","OAuthCredentials","AddOAuthCredentialAction","BrowserTitleService","DeleteOAuthCredentialsAction","DeleteMyCredentialsAction","RemoteRefreshAgents","DeleteRemoteRefreshAgentsAction","ServerUsers","DeleteConnectedDeviceAction"],t}();e.SiteUserSettingsSubplaceCtrl=t,e.Module.instance().controller("SiteUserSettingsSubplaceCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n){var i=this;this.$location=e,this.Workbooks=t,this.ExtractTasks=r,this.RemoteRefreshSchedules=n,this.urlParamsFn=function(){return i.$location.search()}}return t.prototype.create=function(r){var n=new e.Place;return n.addSubplace(e.Subplace.create("connectedWorkbooks",e.WorkbookContentType,this.Workbooks,this.urlParamsFn,{hasDatasource:r},t.ExcludeFilterKeys)),n.addSubplace(e.Subplace.create("extractTasks",e.ExtractTaskContentType,this.ExtractTasks,this.urlParamsFn,{datasource:r},t.ExcludeFilterKeys)),n.addSubplace(e.Subplace.create("remoteRefreshSchedules",e.RemoteRefreshScheduleContentType,this.RemoteRefreshSchedules,this.urlParamsFn,{datasource:r},t.ExcludeFilterKeys)),n},t.ExcludeFilterKeys=[e.ContentFiltersKeys.datasource,e.ContentFiltersKeys.hasDatasource],t.$inject=["$location","Workbooks","ExtractTasks","RemoteRefreshSchedules"],t}();e.DatasourcePlace=t,e.Module.instance().service("DatasourcePlace",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t,r){e.call(this,"addTagsToDatasources",{ids:t,tags:r})}return __extends(t,e),t}(e.Request);e.AddTagsToDatasourcesRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"deleteDatasources",{ids:t})}return __extends(t,e),t}(e.Request);e.DeleteDatasourcesRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getDatasourceActions",{id:t})}return __extends(t,e),t}(e.Request);e.GetDatasourceActionsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"moveDatasourcesToProject",t)}return __extends(t,e),t}(e.Request);e.MoveDatasourcesToProjectRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){var r=function(t){function r(r,n){var i=_.map(n,function(t){return e.TagsHelper.quote(t)});t.call(this,"removeTagsFromDatasources",{ids:r,tags:i})}return __extends(r,t),r}(t.Request);t.RemoveTagsFromDatasourcesRequest=r}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t,r){e.call(this,"runExtractRefreshesOnDatasources",{ids:t,type:r})}return __extends(t,e),t}(e.Request);e.RunExtractRefreshesOnDatasourcesRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t,r){e.call(this,"setDatasourceDescription",{id:t,description:r})}return __extends(t,e),t}(e.Request);e.SetDatasourceDescriptionRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"setDatasourceRefreshMode",t)}return __extends(t,e),t}(e.Request);e.SetDatasourceRefreshModeRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"setDatasourceRemoteAgent",t)}return __extends(t,e),t}(e.Request);e.SetDatasourceRemoteAgentRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t,r){e.call(this,"setDatasourcesOwner",{ids:t,ownerId:r})}return __extends(t,e),t}(e.Request);e.SetDatasourcesOwnerRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n){this.$q=t,this.ErrorNotifyingServer=r,this.FetcherFactory=n,this.server=r.getServerService(),this.listFetcher=n.getServerResourceFetcher(e.ServerApi.GetDatasourcesRequest,e.ServerApiMapper.dataSources),this.allQuery=new e.ResourceQuery(this.listFetcher),this.detailFetcher=this.FetcherFactory.getServerDetailFetcher("getDatasource",e.DatasourceMapper.mapDetail),this.fieldValuesFetcher=n.getServerResourceFetcher(e.ServerApi.GetFieldValuesRequest,e.ServerApiMapper.fieldValues)}return t.isPublished=function(e){return!e.workbook},t.isEmbedded=function(e){return!t.isPublished(e)},t.prototype.all=function(){return this.allQuery},t.prototype.published=function(){return this.all().addFilter(e.Filter.fieldEq(e.ServerApi.FilterFieldNames.isPublished,!0))},t.prototype.getById=function(e){return this.detailFetcher.fetchById(e)},t.prototype.valuesForField=function(t){return new e.FieldValuesQuery(this.fieldValuesFetcher,t,e.ServerApi.FieldValueResourceType.datasource)},t.prototype.actions=function(t){return this.server.sendRequest(new e.ServerApi.GetDatasourceActionsRequest(t))},t.prototype.del=function(t){return this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.DeleteDatasourcesRequest(t)}),e.ResultHelper.combineResults)},t.prototype.setDescription=function(t,r){return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.SetDatasourceDescriptionRequest(t,r))},t.prototype.setOwner=function(t,r){return this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.SetDatasourcesOwnerRequest(t,r)}),e.ResultHelper.combineResults)},t.prototype.setRefreshMode=function(t,r){var n={id:t,refreshMode:r};return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.SetDatasourceRefreshModeRequest(n))},t.prototype.setRemoteAgent=function(t,r){var n={id:t,remoteAgentName:r};return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.SetDatasourceRemoteAgentRequest(n))},t.prototype.moveToProject=function(t,r){return this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests(r,function(r){return new e.ServerApi.MoveDatasourcesToProjectRequest({ids:r,projectId:t})}),e.ResultHelper.combineResults)},t.prototype.addTags=function(t,r){return r.length>0?this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests2(t,r,function(t,r){return new e.ServerApi.AddTagsToDatasourcesRequest(t,r)}),e.ResultHelper.combineResults):this.$q.when({})},t.prototype.removeTags=function(t,r){return r.length>0?this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests2(t,r,function(t,r){return new e.ServerApi.RemoveTagsFromDatasourcesRequest(t,r)}),e.ResultHelper.combineResults):this.$q.when({})},t.prototype.changeTags=function(t,r,n){var i=this;return this.removeTags(t,n).then(function(n){return e.ResultHelper.hasErrors(n)?n:i.addTags(t,r)})},t.prototype.createExtractTask=function(t,r,n){return this.ErrorNotifyingServer.sendRequests(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.CreateExtractTasksRequest({targetType:e.ServerApi.ExtractTaskTargetType.Datasource,targetIds:t,scheduleId:r,type:n})}),e.ResultHelper.combineResults)},t.prototype.refreshExtracts=function(t,r){return this.ErrorNotifyingServer.sendRequests(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.RunExtractRefreshesOnDatasourcesRequest(t,r)}),e.ResultHelper.combineResults)},t.$inject=["$q","ErrorNotifyingServer","FetcherFactory"],t}();e.DataSources=t,e.Module.instance().service("DataSources",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n){var i=this;this.$location=e,this.DataSources=t,this.Views=r,this.Workbooks=n,this.urlParamsFn=function(){return i.$location.search()}}return t.prototype.create=function(r){var n=new e.Place;return n.addSubplace(e.Subplace.create("workbooks",e.WorkbookContentType,this.Workbooks,this.urlParamsFn,{project:r},t.ExcludeFilterKeys)),n.addSubplace(e.Subplace.create("views",e.ViewContentType,this.Views,this.urlParamsFn,{project:r},t.ExcludeFilterKeys)),n.addSubplace(e.Subplace.create("datasources",e.DatasourceContentType,this.DataSources,this.urlParamsFn,{project:r,showEmbedded:"false"},t.ExcludeFilterKeys)),n},t.ExcludeFilterKeys=[e.ContentFiltersKeys.project],t.$inject=["$location","DataSources","Views","Workbooks"],t}();e.ProjectPlace=t,e.Module.instance().service("ProjectPlace",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i,o){var s=this;this.$location=e,this.$q=t,this.DataSources=r,this.Views=n,this.Workbooks=i,this.Subscriptions=o,this.urlParamsFn=function(){return s.$location.search()}}return t.prototype.create=function(r){var n=new e.Place;return n.addSubplace(e.Subplace.create("workbooks",e.WorkbookContentType,this.Workbooks,this.urlParamsFn,{owner:r},t.ExcludeFilterKeys)),n.addSubplace(e.Subplace.create("views",e.ViewContentType,this.Views,this.urlParamsFn,{owner:r},t.ExcludeFilterKeys)),n.addSubplace(e.Subplace.create("datasources",e.DatasourceContentType,this.DataSources,this.urlParamsFn,{owner:r,showEmbedded:"false"},t.ExcludeFilterKeys)),n.addSubplace(e.Subplace.create("subscriptions",e.SubscriptionContentType,this.Subscriptions,this.urlParamsFn,{owner:r},t.ExcludeFilterKeys)),n},t.prototype.empty=function(){var t=new e.Place;return t.addSubplace(e.Subplace.empty("workbooks",_.omit(e.WorkbookContentType,"filterKeys"),this.$q)),t.addSubplace(e.Subplace.empty("views",_.omit(e.ViewContentType,"filterKeys"),this.$q)),t.addSubplace(e.Subplace.empty("datasources",_.omit(e.DatasourceContentType,"filterKeys"),this.$q)),t.addSubplace(e.Subplace.empty("subscriptions",_.omit(e.SubscriptionContentType,"filterKeys"),this.$q)),t},t.ExcludeFilterKeys=[e.ContentFiltersKeys.owner],t.$inject=["$location","$q","DataSources","Views","Workbooks","Subscriptions"],t}();e.SiteUserPlace=t,e.Module.instance().service("SiteUserPlace",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"createProject",t)}return __extends(t,e),t}(e.Request);e.CreateProjectRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"deleteProjects",{ids:t})}return __extends(t,e),t}(e.Request);e.DeleteProjectsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getProjectActions",{id:t})}return __extends(t,e),t}(e.Request);e.GetProjectActionsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t,r){e.call(this,"setProjectName",{id:t,name:r})}return __extends(t,e),t}(e.Request);e.SetProjectNameRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"setProjectControlledPermissions",{ids:t})}return __extends(t,e),t}(e.Request);e.SetProjectControlledPermissionsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"setContentControlledPermissions",{ids:t})}return __extends(t,e),t}(e.Request);e.SetContentControlledPermissionsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t,r){e.call(this,"setProjectDescription",{id:t,description:r})}return __extends(t,e),t}(e.Request);e.SetProjectDescriptionRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t,r){e.call(this,"setProjectsOwner",{ids:t,ownerId:r})}return __extends(t,e),t}(e.Request);e.SetProjectsOwnerRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n){this.$q=t,this.ErrorNotifyingServer=r,this.server=r.getServerService(),this.listFetcher=n.getServerResourceFetcher(e.ServerApi.GetProjectsRequest,e.ServerApiMapper.projects),this.allQuery=new e.ResourceQuery(this.listFetcher),this.detailFetcher=n.getServerDetailFetcher("getProject",e.ProjectMapper.mapDetail),this.fieldValuesFetcher=n.getServerResourceFetcher(e.ServerApi.GetFieldValuesRequest,e.ServerApiMapper.fieldValues)}return t.prototype.all=function(){return this.allQuery},t.prototype.getById=function(e){return this.detailFetcher.fetchById(e)},t.prototype.valuesForField=function(t){return new e.FieldValuesQuery(this.fieldValuesFetcher,t,e.ServerApi.FieldValueResourceType.project)},t.prototype.actions=function(t){return this.server.sendRequest(new e.ServerApi.GetProjectActionsRequest(t))},t.prototype.del=function(t){return this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.DeleteProjectsRequest(t)}),e.ResultHelper.combineResults)},t.prototype.rename=function(t,r){return this.ErrorNotifyingServer.sendRequestAndDelay(new e.ServerApi.SetProjectNameRequest(t,r))},t.prototype.setDescription=function(t,r){return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.SetProjectDescriptionRequest(t,r))},t.prototype.setProjectControlledPermissions=function(t){return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.SetProjectControlledPermissionsRequest(t))},t.prototype.setContentControlledPermissions=function(t){return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.SetContentControlledPermissionsRequest(t))},t.prototype.setOwner=function(t,r){return this.ErrorNotifyingServer.sendRequestsAndDelay(e.RequestHelper.buildRequests(t,function(t){return new e.ServerApi.SetProjectsOwnerRequest(t,r)}),e.ResultHelper.combineResults)},t.prototype.create=function(t,r){return _.isString(r)?(r=r.trim(),0===r.length&&(r=void 0)):r=void 0,this.ErrorNotifyingServer.sendRequestAndDelay(new e.ServerApi.CreateProjectRequest({name:t,description:r}))},t.$inject=["$q","ErrorNotifyingServer","FetcherFactory"],t}();e.Projects=t,e.Module.instance().service("Projects",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i){var o=this;this.$location=e,this.DataSources=t,this.Projects=r,this.Views=n,this.Workbooks=i,this.urlParamsFn=function(){return o.$location.search()}}return t.prototype.create=function(){var t=new e.Place;return t.addSubplace(e.Subplace.create("projects",e.ProjectContentType,this.Projects,this.urlParamsFn)),t.addSubplace(e.Subplace.create("workbooks",e.WorkbookContentType,this.Workbooks,this.urlParamsFn)),t.addSubplace(e.Subplace.create("views",e.ViewContentType,this.Views,this.urlParamsFn)),t.addSubplace(e.Subplace.create("datasources",e.DatasourceContentType,this.DataSources,this.urlParamsFn,{showEmbedded:"false"})),t},t.$inject=["$location","DataSources","Projects","Views","Workbooks"],t}();e.SitePlace=t,e.Module.instance().service("SitePlace",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i){var o=this;this.$location=e,this.DataSources=t,this.Views=r,this.Subscriptions=n,this.ExtractTasks=i,this.urlParamsFn=function(){return o.$location.search()}}return t.prototype.create=function(r){var n=new e.Place;return n.addSubplace(e.Subplace.create("views",e.ViewInWorkbookContentType,this.Views,this.urlParamsFn,{workbook:r},t.ExcludeFilterKeys)),n.addSubplace(e.Subplace.create("datasources",e.DatasourceContentType,this.DataSources,this.urlParamsFn,{workbook:r},t.DataSourceExcludeFilterKeys)),n.addSubplace(e.Subplace.create("subscriptions",e.SubscriptionContentType,this.Subscriptions,this.urlParamsFn,{workbook:r},t.ExcludeFilterKeys)),n.addSubplace(e.Subplace.create("extractTasks",e.ExtractTaskContentType,this.ExtractTasks,this.urlParamsFn,{workbook:r},t.ExcludeFilterKeys)),n},t.ExcludeFilterKeys=[e.ContentFiltersKeys.workbook,e.ContentFiltersKeys.project,e.ContentFiltersKeys.owner,e.ContentFiltersKeys.modifiedAfter,e.ContentFiltersKeys.modifiedBefore],t.DataSourceExcludeFilterKeys=t.ExcludeFilterKeys.concat([e.ContentFiltersKeys.hasAlert,e.ContentFiltersKeys.tag,e.ContentFiltersKeys.showEmbedded]),t.$inject=["$location","DataSources","Views","Subscriptions","ExtractTasks"],t}();e.WorkbookPlace=t,e.Module.instance().service("WorkbookPlace",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t){this.$state=t,this.itemDetailsStateNames={},this.itemDetailsStateNames[e.ProjectContentType.name]="main.site.content.project",this.itemDetailsStateNames[e.DatasourceContentType.name]="main.site.content.datasource.connectedWorkbooks",this.itemDetailsStateNames[e.WorkbookContentType.name]="main.site.content.workbook.views",this.itemSubplaceStateNames={},this.itemSubplaceStateNames[e.ViewContentType.name]=".views",this.itemSubplaceStateNames[e.WorkbookContentType.name]=".workbooks",this.itemSubplaceStateNames[e.DatasourceContentType.name]=".datasources",this.itemSubplaceStateNames.details=".details"}return t.prototype.forItem=function(t,r,n){if(r.name===e.ViewContentType.name)return this.$state.href("main.site.viz",{path:t.path});var i=this.itemDetailsStateNames[r.name],o=this.itemSubplaceStateNames[n];if(i)return o&&(i+=o),this.$state.href(i,{id:t.id});throw"No URL for item type '"+r.name+"'"},t.$inject=["$state"],t}();e.ContentUrl=t,e.Module.instance().service("ContentUrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().config(["$stateProvider","$urlRouterProvider","SiteUrlMatcherFactoryProvider",function(t,r,n){function i(t,r,n,i){void 0===i&&(i="contentSubplace.html");var o={subplace:["place",function(e){return e.subplace(t)}],resource:c[r.name],detailsUrl:["ContentUrl",function(e){return function(t,n){return e.forItem(t,r,n)}}],projectUrl:["ContentUrl",function(t){return function(r,n){return t.forItem(r,e.ProjectContentType,n)}}],workbookUrl:["ContentUrl",function(t){return function(r,n){return t.forItem(r,e.WorkbookContentType,n)}}],defaultOrder:function(){return r.defaultOrder},shouldFetchDetails:function(){return function(){return!0}}};return _.extend(o,n),{url:"/"+t,templateUrl:i,controller:e.ContentSubplaceCtrl,resolve:o}}var o=function(e){return n.compile(e)},s=function(e){return["$match",function(t){return o(e).format(t)}]},a=["$match","StartPageService","$location",function(e,t,r){var n=!e.siteUrlName,i=$.param(r.search()),o=n?t.getCurrentUserStartPageForCurrentSite():t.getCurrentUserStartPageForSite(e.siteUrlName);return o+(i?(/\?/.test(o)?"&":"?")+i:"")}];r.when(o(""),a).when(o("/"),a).when(o("/{type}/"),s("/{type}")).when(o("/{type}/{id}/"),s("/{type}/{id}")).when(o("/projects/{id}"),s("/projects/{id}/workbooks")).when(o("/workbooks/{id}"),s("/workbooks/{id}/views")).when(o("/datasources/{id}"),s("/datasources/{id}/connectedWorkbooks")),(e.FeatureFlags.reactFavoritesMenu||e.FeatureFlags.reactTopBar)&&r.when(o("/redirect_to_view/{id}"),["$match","$state","Views",function(e,t,r){
return r.getById(e.id).then(function(e){t.transitionTo("main.site.viz",{path:e.path},{location:"replace"})}),!0}]);var c={project:"Projects",datasource:"DataSources",workbook:"Workbooks",view:"Views"};t.state("main.site.user",{"abstract":!0,url:"/user/:domainName/{username:.*}",templateUrl:"siteUserPlace.html",controller:e.SiteUserPlaceCtrl,resolve:{isSessionUserSelf:["$stateParams","ServerService",function(e,t){return t.isSessionUserEqualTo(e.username,e.domainName)}],isSessionServerAdmin:["ServerService",function(e){return e.isSessionServerAdmin()}],isSessionSiteAdmin:["ServerService",function(e){return e.isSessionSiteAdmin()}],siteUser:["SiteUsers","Users","$stateParams","isSessionUserSelf","isSessionServerAdmin","isSessionSiteAdmin",function(e,t,r,n,i,o){var s=r.username,a=r.domainName;return n||i||o?e.getUserByUsernameAndDomain(s,a):t.getUserByUsernameAndDomain(s,a)}],userSettings:["UserSettingsStore","$stateParams","isSessionUserSelf","isSessionServerAdmin","isSessionSiteAdmin",function(e,t,r,n,i){return r||n||i?e.getUserSettings(t.username,t.domainName):null}],place:["$state","siteUser","SiteUserPlace","isSessionServerAdmin","isSessionUserSelf","ServerService",function(e,t,r,n,i,o){if(t)return r.create(t.id);if(n&&i)return r.empty();if(o.canSessionUserManageUsers()){var s={detailsLocKey:"userCannotBeAccessed",redirectState:"main.site.users",redirectLocKey:"backToUsers"};e.go("main.error",s)}else e.go("main.error")}],serverUser:["isSessionServerAdmin","$stateParams","siteUser","ServerUsers",function(e,t,r,n){return!r&&e?n.getUserByUsernameAndDomain(t.username,t.domainName):null}]}}).state("main.site.user.workbooks",i("workbooks",e.WorkbookContentType)).state("main.site.user.views",i("views",e.ViewContentType)).state("main.site.user.datasources",i("datasources",e.DatasourceContentType,{shouldFetchDetails:function(){return e.DataSources.isPublished}})).state("main.site.user.settings",{url:"/settings",templateUrl:"siteUserSettingsSubplace.html",controller:e.SiteUserSettingsSubplaceCtrl,resolve:{serverUser:["ServerUsers","$stateParams",function(e,t){return e.getUserByUsernameAndDomain(t.username,t.domainName)}],userRefreshTokenCount:["ServerUsers","$stateParams",function(e,t){return e.getUserRefreshTokenCount(t.username,t.domainName)}]},data:{authLevel:e.AuthLevel.SelfOrAdmin}}).state("main.site.user.subscriptions",{url:"/subscriptions",templateUrl:"subscriptions.html",controller:e.SubscriptionsCtrl,resolve:{subplace:["place",function(e){return e.subplace("subscriptions")}]},data:{authLevel:e.AuthLevel.SelfOrAdmin}}),t.state("main.site.content",{url:"",template:'<div class="tb-fill" ui-view></div>',"abstract":!0}),t.state("main.site.content.site",{"abstract":!0,templateUrl:"site.html",resolve:{place:["SitePlace",function(e){return e.create()}]},controller:e.SitePlaceCtrl}).state("main.site.content.site.projects",i("projects",e.ProjectContentType)).state("main.site.content.site.workbooks",i("workbooks",e.WorkbookContentType)).state("main.site.content.site.views",i("views",e.ViewContentType)).state("main.site.content.site.datasources",i("datasources",e.DatasourceContentType,{shouldFetchDetails:function(){return e.DataSources.isPublished}})),t.state("main.site.content.project",{url:"/projects/:id",templateUrl:"project.html","abstract":!0,resolve:{project:["Projects","$stateParams",function(e,t){return e.getById(t.id)}],projectActions:["Projects","$stateParams",function(e,t){return e.actions(t.id)}],place:["project","ProjectPlace",function(e,t){return t.create(e.id)}]},controller:e.ProjectPlaceCtrl,data:{errorState:{detailsLocKey:"projectCannotBeAccessed",redirectState:"main.site.content.site.projects",redirectLocKey:"backToProjects"}}}).state("main.site.content.project.datasources",i("datasources",e.DatasourceContentType,{shouldFetchDetails:function(){return e.DataSources.isPublished}})).state("main.site.content.project.workbooks",i("workbooks",e.WorkbookContentType)).state("main.site.content.project.views",i("views",e.ViewContentType)).state("main.site.content.project.permissions",{url:"/permissions",templateUrl:"projectPermissions.html",controller:e.setBrowserTitleCtrl("permissions")}).state("main.site.content.project.details",{url:"/details",templateUrl:"projectSettings.html",controller:e.setBrowserTitleCtrl("details")}),t.state("main.site.content.workbook",{url:"/workbooks/:id",templateUrl:"workbook.html","abstract":!0,resolve:{workbook:["Workbooks","$stateParams",function(e,t){return e.getById(t.id)}],workbookActions:["Workbooks","$stateParams",function(e,t){return e.actions(t.id)}],place:["workbook","WorkbookPlace",function(e,t){return t.create(e.id)}]},controller:e.WorkbookPlaceCtrl,data:{errorState:{detailsLocKey:"workbookCannotBeAccessed",redirectState:"main.site.content.site.workbooks",redirectLocKey:"backToWorkbooks"}}}).state("main.site.content.workbook.datasources",i("datasources",e.DatasourceContentType,{shouldFetchDetails:function(){return e.DataSources.isPublished}},"workbookDatasourceSubplace.html")).state("main.site.content.workbook.views",i("views",e.ViewInWorkbookContentType)).state("main.site.content.workbook.permissions",{url:"/permissions",templateUrl:"workbookPermissions.html",controller:e.setBrowserTitleCtrl("permissions")}).state("main.site.content.workbook.details",{url:"/details",templateUrl:"workbookSettings.html",controller:e.setBrowserTitleCtrl("details")}),e.ConfigHelper.addSubscriptionsState(t,"main.site.content.workbook"),e.ConfigHelper.addExtractTasksState(t,"main.site.content.workbook",["workbook","ServerService","CreateExtractTasksAction",function(t,r,n){return{modifyExtractTasksPermission:r.isSessionSiteOrServerAdmin()||t.owner.id===r.sessionUserId(),createExtractTaskFn:function(r){return n.forWorkbook(t,r,e.CreateExtractTasksMode.AllowSchedule)}}}]),t.state("main.site.content.datasource",{url:"/datasources/:id",templateUrl:"datasource.html","abstract":!0,resolve:{datasource:["DataSources","$stateParams",function(e,t){return e.getById(t.id)}],datasourceActions:["DataSources","$stateParams",function(e,t){return e.actions(t.id)}],place:["datasource","DatasourcePlace",function(e,t){return t.create(e.id)}]},controller:e.DatasourcePlaceCtrl,data:{errorState:{detailsLocKey:"datasourceCannotBeAccessed",redirectState:"main.site.content.datasource",redirectLocKey:"backToDatasources"}}}).state("main.site.content.datasource.connectedWorkbooks",i("connectedWorkbooks",e.WorkbookContentType)).state("main.site.content.datasource.dataConnection",{url:"/dataConnection",templateUrl:"datasourceDataConnection.html",controller:e.DatasourceDataConnectionCtrl}).state("main.site.content.datasource.permissions",{url:"/permissions",templateUrl:"datasourcePermissions.html",controller:e.setBrowserTitleCtrl("permissions")}).state("main.site.content.datasource.details",{url:"/details",templateUrl:"datasourceSettings.html",controller:e.setBrowserTitleCtrl("details")}).state("main.site.content.datasource.remoteRefreshSchedules",{url:"/localExtractRefreshes",templateUrl:"remoteRefreshSchedules.html",controller:e.RemoteRefreshSchedulesCtrl,resolve:{datasource:["DataSources","$stateParams",function(e,t){return e.getById(t.id)}],subplace:["place",function(e){return e.subplace("remoteRefreshSchedules")}]}}),e.ConfigHelper.addExtractTasksState(t,"main.site.content.datasource",["datasource","ServerService","CreateExtractTasksAction",function(t,r,n){return{modifyExtractTasksPermission:r.isSessionSiteOrServerAdmin()||t.owner.id===r.sessionUserId(),createExtractTaskFn:function(r){return n.forDatasource(t,r,e.CreateExtractTasksMode.AllowSchedule)},datasource:t}}])}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().config(["$provide",function(e){e.decorator("$q",["$delegate",function(e){function t(){return o(this.originalThen.apply(this,arguments))}function r(){return o(this.originalCatch.apply(this,arguments))}function n(){return o(this.originalFinally.apply(this,arguments))}function i(e){return this.then(null,null,e)}function o(e){return e.fin=e["finally"],e.fail=e["catch"],e.progress=i,e.originalThen=e.then,e.originalCatch=e["catch"],e.originalFinally=e["finally"],e.then=t,e["catch"]=r,e["finally"]=n,e}function s(){return o(this.originalWhen.apply(this,arguments))}function a(){return o(this.originalReject.apply(this,arguments))}function c(){return o(this.originalAll.apply(this,arguments))}function l(){var e=this.originalDefer.apply(this,arguments);return e.promise=o(e.promise),e}return e.originalWhen=e.when,e.originalReject=e.reject,e.originalAll=e.all,e.originalDefer=e.defer,e.when=s,e.reject=a,e.all=c,e.defer=l,e}])}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().config(["$provide",function(e){e.decorator("$state",["$delegate",function(e){return e.hardReload=function(){e.transitionTo(e.current.name,e.params,{reload:!0,notify:!0,inherit:!1})},e}])}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(){}return t.prototype.preloadDynamicIconImages=function(){_.each(t.DynamicIconImages,function(t){(new Image).src="img/"+t+"?"+e.BuildId})},t.DynamicIconImages=["actions_hover.png","busy_large.gif","checkbox_empty_hover.png","checkbox_mixed_hover.png","checkbox_selected_hover.png","checkbox_selected_normal.png","close_x_hover.png","column_dropdown_arrow_hover.png","data_source_content_type_hover_small.png","down_arrow_hover.png","download_small_hover.png","edit_small_hover.png","expand_close_hover.png","expand_open_hover.png","grid_checkbox_corner_normal_hover.png","info_hover.png","magnifying_glass_large_hover.png","magnifying_glass_small_hover.png","new_workbook_small_hover.png","panel_hide_hover.png","panel_show_hover.png","radio_button_empty_disabled.png","radio_button_empty_hover.png","radio_button_empty_normal.png","radio_button_selected_disabled.png","radio_button_selected_hover.png","radio_button_selected_normal.png","refresh_small_hover.png","rename_small_hover.png","run_now_small_hover.png","signature_dropdown_small_hover.png","star_empty_small_hover.png","star_selected_small_normal.png","star_selected_small_hover.png","up_arrow_header_hover.png","view_content_type_hover_small.png","workbook_content_type_hover_small.png"],t}();e.ImagePreloadService=t,e.Module.instance().service("ImagePreloadService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e){this.$state=e}return e.prototype.t=function(e){return e.$$state},e.prototype.getMatchingState=function(e,t){var r=this;return _.find(this.$state.get(),function(n){var i=r.t(n);return i&&i.url&&!!i.url.exec(e,t)})},e.prototype.getStateParams=function(e,t){var r=this.getMatchingState(e,t);return r?this.t(r).url.exec(e,t):void 0},e.prototype.getSiteUrlNameIfLoginState=function(e,t){var r=this.getMatchingState(e,t);if(!r)return null;var n=this.t(r).url.exec(e,t);return"login.authenticate"===r.name?n.site:null},e.prototype.isDescendantOf=function(e,t){return e?this.t(e).includes[t]&&e.name!==t:void 0},e.$inject=["$state"],e}();e.StateWrapperService=t,e.Module.instance().service("StateWrapperService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){angular.module("VizPortalRun",["VizPortal"]).run(["$injector","$rootScope","$state","$window","$document","$interval","$location","$urlRouter","$translate","ServerService","ModalService","ToasterService","SiteSwitchService","StateWrapperService","WindowLocationService","VizService","WindowPopupService","BrowserTitleService","ImagePreloadService","BrowserSupportService",function(t,r,n,i,o,s,a,c,l,u,d,p,h,f,m,v,S,g,y,A){function P(t){var r={redirect:a.url()||null,error:t===e.CommonErrorCode.InvalidSession?null:t};u.isAuthenticationAutoLogin()&&(r.disableAutoSignin=!0);var i=f.getSiteUrlNameIfLoginState(a.path(),a.search());i&&(r.site=i),n.go("login.authenticate",r)}function C(t){if(!t)return!1;var r=t.data&&t.data.authLevel===e.AuthLevel.Anonymous;return!u.inSession()&&!r}function b(t){var r=t&&t.data&&t.data.authLevel===e.AuthLevel.Anonymous;return!u.inSession()&&!r&&u.isAuthenticationAutoLogin()}function R(e){return e&&"main.site.viz"===e.name&&(v.isEmbedParamOn()||u.isSessionRestrictedTrustedTicket())}function w(e){return e&&"main.site.viz"===e.name&&!u.inSession()&&u.isGuestEnabled()}function T(e){return e&&"main.site.viz"===e.name&&v.pathHasExportableFileType()}function k(e){return T(e)?(m.navigateToWithoutAddingToHistory(v.getVizqlUrl()),!0):R(e)?(m.navigateToWithoutAddingToHistory(v.getEmbeddedVizqlUrl()),!0):w(e)?(m.navigateToWithoutAddingToHistory(v.getEmbeddedVizqlUrl({isFromGuest:!0})),!0):!1}function E(e){return e.isSuccessfulSamlLogin&&u.isSessionMultiSite()&&z()}function z(){return""===a.path()||"/"===a.path()}function D(){$(i).focus(_.throttle(function(){return u.refreshSessionInfo()},15e3,{trailing:!1}));var e=3e5,t=1e3*u.getSessionIdleLimitSeconds(),r=Math.min(e,t);r=Math.max(r,15e3);var n=function(){s(function(){$(o).one("keydown mousemove touchstart",_.once(function(){u.refreshSessionInfo(),n()}))},r,1,!1)};n()}function F(){$(i.document.body).show()}function V(){var t=a.search()[e.UrlParamKeys.AuthenticationType];a.search(e.UrlParamKeys.AuthenticationType,null),u.overrideAuthenticationType(t?t.toUpperCase():null)}function I(t,r){D(),V(),t===e.UninitializedServerErrorCode.UntrustedMachine?(F(),n.go("login.untrusted")):t===e.UninitializedServerErrorCode.ReadyToInitialize?(F(),n.go("login.init")):U(t,r)}function U(e,t){b(t)?(n.go("login.interstitial").then(function(){return F()}),u.autoLogin().then(function(){z()&&u.isSessionMultiSite()?n.go("login.site"):M(e,t)},function(e){M(e,t)})):M(e,t)}function M(t,r){k(r)||(C(r)?(F(),P(t)):E({isSuccessfulSamlLogin:Helpers.BooleanQueryParamRegex.test(a.search()[e.UrlParamKeys.IsFromSaml])})?(F(),n.go("login.site")):(F(),c.sync()))}e.Module.initializeEagerServices(t);var x=r.$on("$stateChangeSuccess",function(){s(function(){return y.preloadDynamicIconImages()},1e3,1),x()});A.isAndroidChrome()&&A.setViewport(e.ViewportContent.deviceWidth),r.$on("$stateChangeSuccess",function(t,r,i){var o=r.data?r.data.authLevel:e.AuthLevel.Anonymous;u.isUserAuthorized(o)||(u.inSession()?n.go("main.error",{redirectSiteUrlName:i.siteUrlName}):n.go("login.authenticate"))}),r.$on("$stateChangeStart",function(e,t,r,n,i){g.setTitle(),_.isString(r.siteUrlName)&&h.switchIfNeeded(r.siteUrlName,"/#"+a.url())}),r.$on("$locationChangeStart",function(e){var t=f.getMatchingState(a.path(),a.search());u.isSessionStateUnknown()?(e.preventDefault(),u.bootstrapSession().then(function(e){return I(e,t)})):k(t)?e.preventDefault():C(t)&&(e.preventDefault(),P(null))}),r.$on("$locationChangeSuccess",function(){d.dismissAll()}),r.$on("$stateChangeError",function(e,t,r,i,o,s){t.data.errorState?n.go("main.error",t.data.errorState):n.go("main.error")}),r.$watch(function(){return e.L10n.language},function(){e.L10n.language&&angular.element("html").attr("lang",e.L10n.language).attr("xml:lang",e.L10n.language)})}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n,i){var o=this;this.$scope=t,this.$translate=r,this.activeDirectoryGroups=n,this.sliceableFactory=i,t.groupSearchValue={text:""},t.isSearchStringEmpty=function(){return""!==t.groupSearchValue.text};var s=_.debounce(function(e){o.$scope.$evalAsync(function(){o.onSearchTextChanged(e)})},200);t.$watch("groupSearchValue.text",function(e){o.resetSelection(),o.$scope.sliceable=o.sliceableFactory.fromArray(),_.isString(e)&&e.length>0?(o.$scope.hasResults=!1,o.$scope.statusMessage=o.$translate.instant("addUsersImportAdGroupSearching"),s(e)):(o.$scope.hasResults=!1,t.statusMessage="")}),t.hasResults=!1,t.statusMessage="",t.sliceable=this.sliceableFactory.fromArray(),t.selectedItems=new e.Set(function(e){return e.id}),t.disabledItems=new e.Set(function(e){return e.id}),t.groupsToImport=new e.Set(function(e){return e.id}),t.siteRoleOptions=e.SiteRoles.WithoutGuestOrServerAdmin,t.rowClicked=function(e,t){o.onRowClicked(e,t)},t.isRowSelected=function(e){return t.groupsToImport.contains(e.row)}}return t.prototype.onRowClicked=function(e,t){this.$scope.disabledItems.contains(e)||(this.$scope.selectedItems.contains(e)||this.resetSelection(),this.$scope.selectedItems.toggle(e),this.$scope.groupsToImport.toggle(e),this.$scope.group.model=e)},t.prototype.onSearchTextChanged=function(e){var r=this;if(_.isString(e)&&e.length>0){var n=t.prepareSearchTextInput(e);this.activeDirectoryGroups.searchActiveDirectoryGroupName(n).then(function(t){e===r.$scope.groupSearchValue.text&&(r.$scope.sliceable=r.sliceableFactory.fromArray(t.groups),t.hasMoreItems?(r.$scope.hasResults=!0,r.$scope.statusMessage=r.$translate.instant("addUsersImportAdGroupLimit")):t.groups&&0!=t.groups.length?(r.$scope.hasResults=!0,r.$scope.statusMessage=""):(r.$scope.hasResults=!1,r.$scope.statusMessage=r.$translate.instant("addUsersImportAdGroupNoResults")))})}},t.prototype.resetSelection=function(){this.$scope.selectedItems.clear(),this.$scope.groupsToImport.clear(),this.$scope.group.model=null,this.$scope.group.siteRole=null},t.prepareSearchTextInput=function(e){var t,r=/^["].+["]$/,n=/.*[*]+.*/;return t=r.test(e)?e.substring(1,e.length-1):n.test(e)?e:e.search(/\\/)>0?e.replace(/([^\\]+)\\([^\\]+)/g,"$1\\*$2*"):e.replace(/(.+)/g,"*$1*")},t.$inject=["$scope","$translate","ActiveDirectoryGroups","SliceableFactory"],t}();e.AddActiveDirectoryGroupDialogCtrl=t,e.Module.instance().controller("AddActiveDirectoryGroupDialogCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(r,n,i,o,s,a,c){var l=this;this.$scope=r,this.users=n,this.group=i,this.groupMembershipUpdateActionNotification=o,this.$translate=s,this.toaster=a,this.server=c,this.isGroupMembershipPrecomputed=!1,r.userSearchValue={text:""},r.$watch("userSearchValue.text",function(e){l.onSearchTextChanged(e)}),r.sliceable=this.users.all().withOrder(t.ListOrder),r.selectedItems=new e.Set(function(e){return e.id}),r.disabledItems=new e.Set(function(e){return e.id}),r.usersToBeAdded=new e.Set(function(e){return e.id}),this.tryPrecomputeGroupMembership(),r.usersSliceChanged=function(e){l.onUsersSliceChanged(e)},r.rowClicked=function(e,t){l.onRowClicked(e,t)},r.isRowSelected=function(e){return r.usersToBeAdded.contains(e.row)},r.addUsersToGroupDescription=this.$translate.instant("addUsersToGroupDescription",{GROUP_NAME:e.L10n.elideIfLong(i.name)}),r.confirmLabel=function(){return l.$translate.instant("confirmAddUsersToGroup",{ADD_USER_COUNT:r.usersToBeAdded.size()},e.L10n.Interpolations.Count)},r.busy=!1,r.confirm=function(){l.onConfirmAdd()},r.confirmDisabled=function(){return 0===r.usersToBeAdded.size()}}return t.prototype.onSearchTextChanged=function(r){var n=this.users.all().withOrder(t.ListOrder);_.isString(r)&&r.length>0&&(n=n.withFilters([e.Filter.search(r)])),this.$scope.sliceable=n},t.prototype.onConfirmAdd=function(){var e=this;this.$scope.busy=!0;var t=_.clone(this.$scope.usersToBeAdded);t.keys();this.users.addToGroups(t.keys(),[this.group.id]).then(function(r){e.groupMembershipUpdateActionNotification.notify(r,t,1,e.group.name,0,""),e.$scope.close(r)})},t.prototype.tryPrecomputeGroupMembership=function(){var t=this,r=[e.Filter.stringArrayFieldHas("groupIds",this.group.id)],n=this.users.all().withFilters(r);n.getCount().then(function(e){100>=e?n.getSlice(0,e).then(function(e){t.isGroupMembershipPrecomputed=!0,_.each(e.items,function(e){t.$scope.selectedItems.add(e),t.$scope.disabledItems.add(e)})}):t.isGroupMembershipPrecomputed=!1})},t.prototype.onRowClicked=function(e,t){this.$scope.disabledItems.contains(e)||(this.$scope.selectedItems.toggle(e),this.$scope.usersToBeAdded.toggle(e))},t.prototype.onUsersSliceChanged=function(t){var r=this;if(!this.isGroupMembershipPrecomputed){var n=_.map(t.items,function(e){return e.id}),i=Helpers.dictFromArray(t.items,e.ServerApi.UserKeys.id);n.length>0&&this.server.sendRequest(new e.ServerApi.GetUsersGroupMembershipRequest({userIds:n})).then(function(e){_.each(e.members,function(e){e.groupId===r.group.id&&(r.$scope.selectedItems.add(i[e.userId]),r.$scope.disabledItems.add(i[e.userId]))})})}},t.ListOrder=[e.Order.asc(e.OrderKeys.displayName)],t.$inject=["$scope","SiteUsers","group","GroupMembershipUpdateActionNotification","$translate","ToasterService","ServerService"],t}();e.AddUsersToGroupDialogCtrl=t,e.Module.instance().controller("AddUsersToGroupDialogCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r){this.server=e,this.$q=t,this.$interval=r}return t.prototype.poll=function(r,n,i){var o=this,s=this.$q.defer(),a=function(e){n(e)?s.resolve(e):(s.notify(e),u=i?i:Math.min(t.PollPeriodMultiplier*u,t.MaxPollPeriodMS),d=o.$interval(l,u,1))},c=function(e){s.reject(e)},l=function(){o.server.sendRequest(r).then(a,c)},u=t.InitialPollPeriodMS,d=this.$interval(l,u,1);return{promise:s.promise,cancel:function(){s.reject(e.ErrorReason.Canceled),o.$interval.cancel(d)}}},t.$inject=["ServerService","$q","$interval"],t.MaxPollPeriodMS=3e3,t.InitialPollPeriodMS=300,t.PollPeriodMultiplier=1.3,t}();e.PollService=t,e.Module.instance().service("PollService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){void 0===t&&(t={}),e.call(this,"getUserAlertCount",t)}return __extends(t,e),t}(e.Request);e.GetUserAlertCountRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(r,n,i,o,s,a,c,l){r.totalAlerts=0;var u=function(e){return r.totalAlerts=e.totalCount,!1},d=a.poll(new e.ServerApi.GetUserAlertCountRequest,u,t.POLL_DURATION);r.getAlertList=function(){return i.getList().then(function(t){var i=t.total;r.alertList=t.alerts,r.totalAlerts=i,r.showRemainingAlerts=n.instant("moreAlerts",{ITEM:i-r.alertList.length},e.L10n.Interpolations.Count)})},r.$on("$destroy",function(){d.cancel()}),r.workbooksAffectedString=function(t){if(t){var r=t.length;if(1===r)return n.instant("outOfDateWithName",{NAME:e.L10n.elideIfLong(t[0].name)});if(r>1)return n.instant("outOfDateWorkbooksWithCount",{LIST_COUNT:r},e.L10n.Interpolations.Count)}return n.instant("outOfDateWorkbookNone")},r.tryAgainClick=function(e,t){r.alertList.splice(t,1),r.totalAlerts--;var n=e.taskId,i=e.alertType;if(n)s.run([n]).then(function(){return r.getAlertList()});else if(i){var a=e.datasource&&e.datasource.id,l=e.workbooks&&e.workbooks[0]&&e.workbooks[0].id;a?o.refreshExtracts([a],i).then(function(){return r.getAlertList()}):l&&c.refreshExtracts([l],i).then(function(){return r.getAlertList()})}},r.getFailureType=function(t){var r="";switch(t.statusCode){case e.AlertErrorCode.AlertSignInFailed:case e.AlertErrorCode.AlertRemoteSignInFailed:r=n.instant("signInFailedUnknownReason");break;case e.AlertErrorCode.AlertExpiredPassword:case e.AlertErrorCode.AlertRemoteExpiredPassword:r=n.instant("expiredPassword");break;case e.AlertErrorCode.AlertAccessTokenValidation:r=n.instant("accessTokenValidation");break;case e.AlertErrorCode.AlertAuthConfiguration:r=n.instant("authConfiguration");break;case e.AlertErrorCode.AlertConnectionFailure:case e.AlertErrorCode.AlertRemoteConnectionFailure:r=n.instant("connectionFailure");break;case e.AlertErrorCode.AlertOverlappingSchedules:r=n.instant("overlappingSchedules");break;case e.AlertErrorCode.AlertFullRefreshRequired:r=n.instant("fullRefreshRequired");break;case e.AlertErrorCode.AlertConnectionlessFailure:r=n.instant("connectionlessFailure");break;default:r=n.instant("unknownFailure")}return t.suspended||l.isAlertFailureCountEnabled()?n.instant("failureNote",{COUNT:t.consecutiveFailureCount},e.L10n.Interpolations.Count)+r:r},r.editableFailure=function(t){return t!==e.AlertErrorCode.AlertOverlappingSchedules},r.isRemoteRefresh=function(e){return _.contains(t.REMOTE_REFRESH_STATUS_CODES,e)},r.hasSuspended=function(e){if(e){for(var t=0,r=e.length;r>t;t++)if(e[t].suspended)return!0;return!1}}}return t.POLL_DURATION=15e4,t.REMOTE_REFRESH_STATUS_CODES=[e.AlertErrorCode.AlertRemoteUnknownFailure,e.AlertErrorCode.AlertRemoteSignInFailed,e.AlertErrorCode.AlertRemoteExpiredPassword,e.AlertErrorCode.AlertRemoteConnectionFailure],t.$inject=["$scope","$translate","Alerts","DataSources","ExtractTasks","PollService","Workbooks","ServerService"],t}();e.AlertMenuCtrl=t,e.Module.instance().controller("AlertMenuCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.uploadCsvAction={importFile:"import",validateFile:"validate"},e.Module.instance().directive("tbBulkImportUsersForm",["$cookies","$q","$timeout","LongRunningActionService","ServerService",function(t,r,n,i,o){return{restrict:"E",replace:!0,templateUrl:"bulkImportUsersForm.html",scope:{endpoint:"=",formControls:"=?"},link:function(s,a,c){var l=!1;s.xsrfToken=t[e.CookieKeys.XsrfToken],s.authenticationSelector={visible:o.isThirdPartyAuthEnabled(),selectionValue:o.isThirdPartyAuthEnabled()};var u;s.formControls={canSubmitForm:function(){return s.bulkImportForm.$valid&&!l},submitFormForAction:function(e){return s.action=e,u=r.defer(),f(),u.promise}},s.handleFormSubmitResult=function(t){if(t.actionId){var r=i.trackProgress(t.actionId);r.promise.then(d,p,h)}else p(e.ErrorReason.Unknown)};var d=function(t){t&&t.succeeded===!1?p(e.ErrorReason.Unknown):n(function(){l=!1,u.resolve(t)},e.ErrorNotifyingServer.ResponseDelay)},p=function(e){l=!1,u.reject(e)},h=function(e){u.notify(e)},f=function(){l=!0,n(function(){return a.submit()})}}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){!function(e){e[e.SelectFile=0]="SelectFile",e[e.ImportInProgress=1]="ImportInProgress",e[e.PreviewComplete=2]="PreviewComplete",e[e.ImportComplete=3]="ImportComplete"}(e.BulkImportUsersDialogState||(e.BulkImportUsersDialogState={}));var t=e.BulkImportUsersDialogState,r=function(){function r(r,n,i,o,s,a){var c=this;this.$scope=r,this.$translate=n,this.toaster=a,r.form={controls:null},r.currentState=t.SelectFile,r.dialogState=t,r.endpoint=i+o,r.importFile=function(){r.currentState=t.ImportInProgress,r.percentComplete=0,r.form.controls.submitFormForAction(e.uploadCsvAction.importFile).then(d,u,l)},r.validateFile=function(){r.form.controls.submitFormForAction(e.uploadCsvAction.validateFile).then(d,u,l)},r.canSubmitForm=function(){return r.form.controls&&r.form.controls.canSubmitForm()},r.closeButtonText=function(){return r.currentState===t.ImportComplete?"done":"cancel"},r.csvHelpHref=s.getServerHelpUrlByCategory("adminusers2");var l=function(e){c.$scope.percentComplete=e.percentComplete},u=function(t){c.$scope.close({}),c.toaster.pop({type:e.ToastType.Error,text:c.$translate.instant("addUsersFailed")})},d=function(n){r.currentState=t.ImportComplete,c.$scope.percentComplete=n.percentComplete,c.$scope.importResults=n.response,c.$scope.$emit(e.UserAddedEvent)}}return r.Method={ImportUsersFromCsv:"importUsersFromCsv",ImportServerUsersFromCsv:"importServerUsersFromCsv"},r.$inject=["$scope","$translate","RestApiPrefix","method","HelpService","ToasterService"],r}();e.BulkImportUsersDialogCtrl=r,e.Module.instance().controller("BulkImportUsersDialogCtrl",r)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e,t){e.headerClicked=function(t){return e.sorter.setPrimary(t.attrs.key,t.attrs.direction)},e.rowClicked=function(r,n){e.anyActionsAllowed()&&t.rowClicked(e.selectedItems,r,n)}}return e.$inject=["$scope","SelectionService"],e}();e.ContentGridCtrl=t,e.Module.instance().controller("ContentGridCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbPopover",["$window","$compile","$timeout","$parse","StackedElementsService",function(e,t,r,n,i){return{restrict:"A",link:function(o,s,a){function c(){g.off(".popover_events"),u&&(i.removeStackedElement(u),u=null),l&&l.off(".popover_events"),S.visible=!1,l.remove()}var l,u,d,p,h=350,f=50,m=!1,v=a.tbPopover;if(!n(a.tbPopoverSuppress)(o)){l=$("<div>").addClass("tb-padded-wide").append($('<div tb-arrow="arrow">').addClass("tb-popover").append($("<div>").attr("ng-include",v))),a.tbPopoverClass&&l.addClass(a.tbPopoverClass),a.tbPopoverDelay&&(h=parseInt(a.tbPopoverDelay,10)),a.tbPopoverPreferOpenLeft&&(m=!0),a.tbPopoverHide&&o.$watch(a.tbPopoverHide,function(e){l.css({display:e?"none":"block"})});var S=o.$new();S.visible=!1,t(l)(S);var g=s.parents(".tb-scroll");s.on("mouseenter",function(){var t=function(){u=i.addStackedElement({contentElement:l,getContentElementPosition:function(){var t=l.outerWidth(),r=angular.element(e).width(),n=s.outerWidth(),i=s.offset(),o=i.left-t,a=i.left+n,c=a+t,u=m;return u?0>o&&r>=c&&(u=!1):c>r&&o>=0&&(u=!0),S.arrow=u?"right":"left",{left:u?o:a,top:i.top}}}),S.visible=!0,g.on("scroll.popover_events",function(){o.$apply(function(){c(),t()})})};d=r(t,h),l.on("mouseenter.popover_events",function(){r.cancel(p)}).on("mouseleave.popover_events",function(){o.$apply(c)})}),s.on("mouseleave",function(){g.off(".popover_events"),r.cancel(d),p=r(c,f)}),o.$on("$destroy",function(){S.$destroy(),c(),r.cancel(d),r.cancel(p)})}}}}]),e.Module.instance().directive("tbArrow",function(){return{restrict:"A",link:function(e,t,r){var n=$("<div></div>");t.append(n),e.$watch(r.tbArrow,function(e){n.removeClass(),"right"===e?n.addClass("tb-modal-arrow-right"):n.addClass("tb-modal-arrow-left")})}}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n){t.$location=r;var i=t.$watch("visible",function(r){r&&(t.getItemDetails(t.item).then(function(r){t.itemDetails=r,e.FeatureFlags.contentAnalyticsEnabled&&t.contentType!==e.ViewContentType.name&&(t.sparklineWithTitleProps={title:n.instant("metric_hitsTotal_sparklineTitle",{COUNT:t.item.hitsTotal},e.L10n.Interpolations.Count),caption:n.instant("metric_hitsTotal_sparklineCaption"),sparklineProps:{dataPoints:r.hitsTimeSeries,width:274,height:66}})}),i())})}return t.$inject=["$scope","$location","$translate"],t}();e.ContentItemPopoverCtrl=t,e.Module.instance().controller("ContentItemPopoverCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n){t.columnWidths||(t.columnWidths=new e.ColumnWidths),t.scrollLeftChanged=function(e){r.find(".tb-data-grid-headers").css({"margin-left":-e+"px"})}}return t.$inject=["$scope","$element","SliceableFactory"],t}();e.DataGridCtrl=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e){e.editMode=!1,e.clear=function(){e.filter.value=null},e.open=function(){e.editMode=!0},e.close=function(){e.editMode=!1}}return e.$inject=["$scope"],e}();e.DateFilterCtrl=t,e.Module.instance().controller("DateFilterCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n){var i=this;this.$scope=t,this.modal=r,this.SliceableFactory=n,t.showDetails=function(r){var n=t.toast.data;t.errorDetailsSliceable=i.SliceableFactory.fromArray(n.errorDetails),i.modal.open({scope:t,templateUrl:"errorDetailsDialog.html",size:e.ModalSize.fitToContent,position:e.ModalService.anchoredTo(angular.element(r.target))})}}return t.$inject=["$scope","ModalService","SliceableFactory"],t}();e.ErrorDetailsToastCtrl=t,e.Module.instance().controller("ErrorDetailsToastCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i,o,s,a,c){this.SliceableFactory=e,this.ProjectNames=t,this.UserNames=r,this.Groups=n,this.Tags=i,this.DataConnectionTypes=o,this.SiteNamesAcrossAllPods=s,this.Favorites=a,this.Schedules=c}return t.prototype.projects=function(t){return this.ProjectNames.all().withFiltersAndOrder([e.Filter.search(t)],[e.Order.asc(e.ServerApi.NamedItemKeys.name)])},t.prototype.project=function(e){return this.ProjectNames.getById(e).then(function(t){return{value:t?t.id:e,label:t?t.name:"",count:0}})},t.prototype.sites=function(t){return this.SiteNamesAcrossAllPods.all().withFilters([e.Filter.search(t)])},t.prototype.favorites=function(t){return this.Favorites.all().withFilters([e.Filter.search(t)])},t.prototype.users=function(t){return this.UserNames.all().withFiltersAndOrder([e.Filter.search(t)],[e.Order.asc(e.ServerApi.UserKeys.displayName)]);
},t.prototype.usersWithoutGuest=function(t){return this.users(t).addFilter(e.Users.WithoutGuestFilter)},t.prototype.adminUsers=function(t){return this.users(t).addFilter(e.Users.AdminsOnlyFilter)},t.prototype.user=function(e){return this.UserNames.getById(e).then(function(t){return{value:t?t.id:e,label:t?t.displayName:"",count:0}})},t.prototype.groups=function(t){return this.Groups.all().withFiltersAndOrder([e.Filter.search(t)],[e.Order.asc(e.ServerApi.GroupKeys.name)])},t.prototype.group=function(e){return this.Groups.getById(e)},t.prototype.tags=function(t){return this.Tags.all().withFiltersAndOrder([e.Filter.search(t)],[e.Order.asc(e.ServerApi.NamedItemKeys.name)])},t.prototype.dataConnectionType=function(e){return this.DataConnectionTypes.getByDataConnectionType(e).then(function(t){return{value:t?t.connectionType:e,label:t?t.connectionTypeDisplayName:"",count:0}})},t.prototype.dataConnectionTypes=function(t){return this.DataConnectionTypes.all().withFiltersAndOrder([e.Filter.search(t)],[e.Order.asc(e.ServerApi.DataConnectionTypeKeys.connectionTypeDisplayName)])},t.prototype.schedulesSource=function(t){var r=function(e,t){if(!t)return!0;var r=e.name.toLowerCase();return _.all(t.toLowerCase().split(" "),function(e){return r.indexOf(e)>=0})},n=this.Schedules.all().withOrder(e.ScheduleContentType.defaultOrder);t&&(n=n.addFilter(e.Schedules.filterByActionType(t)));var i=e.SliceableHelper.fetchAll(n).then(function(e){return e.items});return this.SliceableFactory.searchArray(r,i)},t.$inject=["SliceableFactory","ProjectNames","UserNames","Groups","Tags","DataConnectionTypes","SiteNamesAcrossAllPods","Favorites","Schedules"],t}();e.SearchSuggestionsService=t,e.Module.instance().service("SearchSuggestionsService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n,i,o,s){var a=this;this.$state=r,this.favorites=n,t.filteringList={chosenFavorite:null},t.getFavorites=function(e){return s.favorites(e)},t.goToFavorite=function(){var r=t.filteringList.chosenFavorite.objectId,n=t.filteringList.chosenFavorite.objectType;n===e.FavoriteObjectType.VIEW?i.getById(r).then(function(e){return a.$state.go("main.site.viz",{path:e.path})},function(e){return a.handleGoToDeletedFavorite(r,e)}):n===e.FavoriteObjectType.WORKBOOK&&o.getById(r).then(function(){return a.$state.go("main.site.content.workbook.views",{id:r})},function(e){return a.handleGoToDeletedFavorite(r,e)})}}return t.prototype.handleGoToDeletedFavorite=function(t,r){var n=this;r===e.CommonErrorCode.ViewNotFound?this.favorites.removeViewById(t).then(function(){return n.$state.go("main.error",{detailsLocKey:"favoriteViewCouldNotBeFound"})}):r===e.CommonErrorCode.WorkbookNotFound?this.favorites.removeWorkbookById(t).then(function(){return n.$state.go("main.error",{detailsLocKey:"favoriteWorkbookCouldNotBeFound"})}):this.$state.go("main.error")},t.$inject=["$scope","$state","Favorites","Views","Workbooks","SearchSuggestionsService"],t}();e.FavoritesMenuCtrl=t,e.Module.instance().controller("FavoritesMenuCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(){}return e.prototype.setFocusElement=function(e){this.$element=e},e.prototype.focus=function(){this.$element.focus()},e.prototype.hasFocusElement=function(){return!!this.$element},e}();e.FocusCtrl=t,e.Module.instance().controller("FocusCtrl",t)}(VizPortal||(VizPortal={}));var VizPortalReact;!function(e){var t=function(){function e(e,t,r,n,i){this.help=e,this.server=t,this.$scope=r,this.gettingStartedNotifications=n,this.modalService=i}return e.prototype.showAbout=function(){var e=this,t=this.$scope.$new();t.version=this.server.sessionServerVersion(),t.serverName=function(){return e.server.serverName()},this.modalService.open({templateUrl:"aboutServer.html",scope:t}).result.fin(function(){return t.$destroy()})},e.prototype.showGettingStarted=function(){this.gettingStartedNotifications.forceShowNotifications()},e.prototype.searchHelp=function(e){this.help.search(e)},e}();e.HelpActions=t}(VizPortalReact||(VizPortalReact={}));var VizPortal;!function(e){var t=function(){function e(e,t,r,n,i){var o=new VizPortalReact.HelpActions(n,t,e,i,r);e.showAbout=function(){return o.showAbout()},e.launchGettingStarted=function(){return o.showGettingStarted()},e.searchHelp=function(){return o.searchHelp(e.searchForm.searchText)},e.isOfflineHelpEnabled=t.offlineHelpEnabled(),e.searchForm={searchText:""},e.supportUrl=function(){return n.getGeneralSupportUrl()},e.serverHelpUrl=n.getServerHelpUrlByCategory(),e.helpLocKey=n.getHelpLinkLocKey(),e.reset=function(){return e.searchForm.searchText=""},e.serverName=function(){return t.serverName()},e.$watch(function(){return t.isSessionSiteOrServerAdmin()},function(){i.shouldShowGettingStartedLink().then(function(t){return e.showGettingStartedLink=t})})}return e.$inject=["$scope","ServerService","ModalService","HelpService","GettingStartedNotifications"],e}();e.HelpMenuCtrl=t,e.Module.instance().controller("HelpMenuCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n,i){var o=this;this.scope=t,this.viewport=r,this.$q=n,this.currentPage=0,this.currentItemsPerPage=0,this.currentTotal=0,t.scroller=this,t.transcludeFn=i,t.slice=e.ListResult.empty(),t.scrollControls={scrollIntoView:function(e){var t=Math.ceil(o.viewport.scrollTop()/o.metrics.heightOfRowInPx),r=Math.floor((o.viewport.scrollTop()+o.viewport.height())/o.metrics.heightOfRowInPx)-1,n=r-t+1;e>r?o.viewport.scrollTop((e-n+1)*o.metrics.heightOfRowInPx):t>e&&o.viewport.scrollTop(e*o.metrics.heightOfRowInPx)},setScrollLeft:function(e){o.viewport.scrollLeft(e)},getScrollLeft:function(){return o.viewport.scrollLeft()}};var s=0,a=function(){var e=o.viewport.scrollLeft();e!==s&&(s=e,t.scrollLeftChanged({scrollLeft:s}))};r.on("scroll",function(){a(),o.fetchItems()}),t.$watch("items",function(e,t){e!==t&&o.onItemsChanged()}),t.getViewportDimensions=function(){return o.getViewportDimensions()},t.$watch(t.getViewportDimensions,function(e){o.resize(e)},!0)}return t.prototype.fetchItems=function(){if(this.metrics&&!(this.viewport.scrollTop()<0)){var e=t.pageHeightInPx(this.metrics);if(e>0){var r={page:Math.floor(this.viewport.scrollTop()/e),itemsPerPage:t.itemsPerPage(this.metrics)};r.page===this.currentPage&&r.itemsPerPage===this.currentItemsPerPage||this.isInProgress(r)||this.getSlice(r)}}},t.prototype.onItemsChanged=function(){var e=this;if(this.metrics||this.updateLayoutMetrics()){var r={page:0,itemsPerPage:t.itemsPerPage(this.metrics)};this.getSlice(r).then(function(r){r&&(e.viewport.scrollTop(0),e.scope.$emit(t.ItemsChangeEvent))})}},t.prototype.resize=function(e){0!==e.width&&0!==e.height&&(this.metrics=this.getLayoutMetrics(e),this.fetchItems())},t.prototype.contentAreaHeight=function(){return this.metrics?this.totalNumberOfRows(this.metrics)*this.metrics.heightOfRowInPx:0},t.prototype.contentTop=function(){return this.metrics?this.currentPage*t.pageHeightInPx(this.metrics):0},t.prototype.getSlice=function(e){var t=this;return this.scope.items?(this.mostRecentInProgressRequest=e,this.scope.items.getSlice(e.page*e.itemsPerPage,2*e.itemsPerPage).then(function(r){return e===t.mostRecentInProgressRequest?(t.mostRecentInProgressRequest=null,t.currentPage=e.page,t.currentItemsPerPage=e.itemsPerPage,t.currentTotal=r.total,t.scope.slice.items=r.items,t.scope.slice.index=r.index,t.scope.slice.total=r.total,t.scope.sliceChanged&&t.scope.sliceChanged({newSlice:r}),r):null})):this.$q.when(null)},t.prototype.isInProgress=function(e){return!!this.mostRecentInProgressRequest&&e.page===this.mostRecentInProgressRequest.page&&e.itemsPerPage===this.mostRecentInProgressRequest.itemsPerPage},t.prototype.getViewportDimensions=function(){return{height:this.viewport.height(),width:this.contentArea.width()}},t.prototype.getLayoutMetrics=function(e){return this.scope.layout?this.scope.layout.metrics(e):null},t.prototype.updateLayoutMetrics=function(){var e=this.getViewportDimensions();return this.metrics=this.getLayoutMetrics(e),!!this.metrics},t.prototype.totalNumberOfRows=function(e){return e.numberOfCols>0?Math.ceil(this.currentTotal/e.numberOfCols):0},t.pageHeightInPx=function(e){return e.numberOfRows*e.heightOfRowInPx},t.itemsPerPage=function(e){return e.numberOfCols*e.numberOfRows},t.ItemsChangeEvent="scrollItemsChanged",t.$inject=["$scope","$element","$q","$transclude"],t}();e.ScrollCtrl=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){!function(e){e[e.Unspecified=0]="Unspecified",e[e.Allowed=1]="Allowed",e[e.Denied=2]="Denied",e[e.Mixed=3]="Mixed"}(e.Permission||(e.Permission={}));e.Permission;!function(e){e[e.Unspecified=0]="Unspecified",e[e.ImplicitDeny=1]="ImplicitDeny",e[e.GroupAllow=2]="GroupAllow",e[e.GroupDeny=3]="GroupDeny",e[e.UserAllow=4]="UserAllow",e[e.UserDeny=5]="UserDeny",e[e.UserLicensingDeny=6]="UserLicensingDeny",e[e.GuestAllow=7]="GuestAllow",e[e.UserAuthorizableOwnerAllow=8]="UserAuthorizableOwnerAllow",e[e.GroupProjectLeaderAllow=9]="GroupProjectLeaderAllow",e[e.UserProjectLeaderAllow=10]="UserProjectLeaderAllow",e[e.UserProjectOwnerAllow=11]="UserProjectOwnerAllow",e[e.UserAdminAllow=12]="UserAdminAllow",e[e.Mixed=13]="Mixed"}(e.PermissionReason||(e.PermissionReason={}));e.PermissionReason}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){function r(t,r,i,o){var s=Helpers.dictFromArray(i,e.ServerApi.GroupKeys.id),a=Helpers.dictFromArray(o,e.ServerApi.UserKeys.id),c=_.groupBy(t,function(e){return e.grantee.type+e.grantee.id}),l=_.map(c,function(e){return n(e,r,s,a)}),u=_.findWhere(i,{isAllUsersGroup:!0});if(u){var d=_.find(l,function(e){return e.group&&e.group.id===u.id});d||(d={group:u,permissions:{},permissionsByContentType:{}},l.push(d))}return l}function n(t,r,n,s){var a=t[0].grantee;if(e.FeatureFlags.projectPermissionsTemplatesEnabled)var c={permissionsByContentType:o(t,r)};else var c={permissions:i(t,r)};switch(a.type){case"group":c.group=n[a.id];break;case"user":c.user=s[a.id]}return c}function i(e,t){var r=_.indexBy(e,function(e){return e.authorizable.id});return _.reduce(t,function(e,t){var n=r[t];if(n){var i=a(n.permissions);return e?(u(e,i),e):i}return e?(d(e),e):{}},null)}function o(e,t){var r=_.groupBy(e,function(e){return e.authorizable.type}),n={};return _.each(r,function(e,r){var i=s(e,t);n[r]=i}),n}function s(e,t){var r=_.indexBy(e,function(e){return e.authorizable.id}),n=null;return t.forEach(function(e){var t=r[e],i=t?a(t.permissions):{};n?u(n,i):n=i}),n}function a(e){var t={};return _.each(e,function(e){var r=e.capability,n=c(e),i=l(e);t[r]?(t[r].permission=n,t[r].reason=i):t[r]={permission:n,reason:i}}),t}function c(t){var r=t.value;switch(r){case"allowed":return e.Permission.Allowed;case"denied":return e.Permission.Denied;default:return e.Permission.Unspecified}}function l(t){var r=t.reason;switch(r){case"GROUP_ALLOW":return e.PermissionReason.GroupAllow;case"GROUP_DISALLOW":return e.PermissionReason.GroupDeny;case"GROUP_PROJECT_LEADER":return e.PermissionReason.GroupProjectLeaderAllow;case"GUEST_ALLOWED":return e.PermissionReason.GuestAllow;case"IMPLICIT_DENY":return e.PermissionReason.ImplicitDeny;case"USER_ADMIN":return e.PermissionReason.UserAdminAllow;case"USER_ALLOW":return e.PermissionReason.UserAllow;case"USER_AUTHORIZABLE_OWNER":return e.PermissionReason.UserAuthorizableOwnerAllow;case"USER_DISALLOW":return e.PermissionReason.UserDeny;case"USER_LICENSING":return e.PermissionReason.UserLicensingDeny;case"USER_PROJECT_LEADER":return e.PermissionReason.UserProjectLeaderAllow;case"USER_PROJECT_OWNER":return e.PermissionReason.UserProjectOwnerAllow;default:return e.PermissionReason.Unspecified}}function u(t,r){_.each(_.union(_.keys(t),_.keys(r)),function(n){var i=t[n],o=r[n];i&&o?i.permission!==o.permission?(t[n].permission=e.Permission.Mixed,t[n].reason=e.PermissionReason.Mixed):i.reason!=o.reason&&(t[n].reason=e.PermissionReason.Mixed):i?i.permission!==e.Permission.Unspecified&&(t[n].permission=e.Permission.Mixed,t[n].reason=e.PermissionReason.Mixed):o&&(o.permission!==e.Permission.Unspecified?t[n]={permission:e.Permission.Mixed,reason:e.PermissionReason.Mixed}:t[n]={permission:o.permission,reason:o.reason})})}function d(t){_.each(_.keys(t),function(r){t[r].permission!==e.Permission.Unspecified&&(t[r].permission=e.Permission.Mixed,t[r].reason=e.PermissionReason.Mixed)})}t.makeGranteePermissionsList=r}(t=e.PermissionsMerger||(e.PermissionsMerger={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getEffectivePermissions",t)}return __extends(t,e),t}(e.Request);e.GetEffectivePermissionsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n){this.$q=t,this.server=r,this.usersFetcher=n.getServerResourceFetcher(e.ServerApi.GetUsersRequest,function(e){return e.users})}return t.prototype.getEffectivePermissions=function(t,r){var n=this;return this.usersFetcher.fetchList(t).then(function(t){if(0===t.items.length)return n.$q.when(new e.ListResult([]));var i=_.pluck(t.items,e.ServerApi.UserKeys.id);if(e.FeatureFlags.projectPermissionsTemplatesEnabled)var o=e.PermissionsHelper.effectivePermissionsRequestsForAuthorizables(i,r);else var o=[new e.ServerApi.GetEffectivePermissionsRequest({userIds:i,authorizables:r})];var s=function(t){return{permissions:e.ResultHelper.combine(t,function(e){return e.permissions})}};return n.server.sendRequestsParallel(o,s).then(function(n){var i=e.PermissionsMerger.makeGranteePermissionsList(n.permissions,r.ids,[],t.items);return new e.ListResult(i,t.index,t.total)})})},t.$inject=["$q","ServerService","FetcherFactory"],t}();e.EffectivePermissionsService=t,e.Module.instance().service("EffectivePermissionsService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e,t){this.effectivePermissionsService=e,this.authorizables=t}return e.prototype.setAuthorizables=function(e){this.authorizables=e},e.prototype.fetchList=function(e){return this.effectivePermissionsService.getEffectivePermissions(e,this.authorizables)},e}();e.EffectivePermissionsFetcher=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(){this.currentOpenSection=null}return e.prototype.isEnabled=function(){return!0},e.prototype.toggleSection=function(e){e===this.currentOpenSection?this.currentOpenSection=null:this.currentOpenSection=e},e.prototype.isSectionOpen=function(e){return this.currentOpenSection===e},e}();e.SingleSectionAccordion=t,e.StaticAccordion={isEnabled:function(){return!1},toggleSection:function(){},isSectionOpen:function(){return!0}}}(VizPortal||(VizPortal={}));var VizPortal;!function(e){!function(e){e[e.Locked=0]="Locked",e[e.Unlocked=1]="Unlocked",e[e.Mixed=2]="Mixed"}(e.LockUnlockProjectPermissionsState||(e.LockUnlockProjectPermissionsState={}));var t,r=e.LockUnlockProjectPermissionsState;!function(e){function t(e){var t=e.some(function(t){return e[0]!==t});return t?r.Mixed:e[0]}function n(e){return e.map(function(e){return e.controlledPermissionsEnabled?r.Locked:r.Unlocked})}function i(e){return l[r[e]]}function o(e){return u[r[e]]}function s(e){return d[r[e]]}function a(e){return p[r[e]]}function c(e){return t(n(e))}var l={Locked:"tb-white-icon-permissions-locked",Unlocked:"tb-white-icon-permissions-unlocked",Mixed:"tb-white-icon-permissions-mixed"},u={Locked:"tb-gray-icon-permissions-locked",Unlocked:"tb-gray-icon-permissions-unlocked",Mixed:"tb-gray-icon-permissions-mixed"},d={Locked:"lockProjectPermissions_locked",Unlocked:"lockProjectPermissions_unlocked",Mixed:"lockProjectPermissions_mixed"},p={Locked:"lockProjectPermissions_lockedEllipsis",Unlocked:"lockProjectPermissions_unlockedEllipsis",Mixed:"lockProjectPermissions_mixedEllipsis"};e.getCombinedStatusOfAllItems=t,e.getLockStatusOfAllProjects=n,e.getWhiteLockIconClass=i,e.getGrayLockIconClass=o,e.getSectionHeaderText=s,e.getLockButtonText=a,e.getLockState=c}(t=e.LockStatusHelper||(e.LockStatusHelper={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n){this.authorizables=e,this.authorizableType=t,this.sourceAuthorizables=r,this.$translate=n,this.editable=this.allAuthorizablesMatchSource()}return t.prototype.getEditabilityWithMessages=function(){var e=this.getMessages();return{editable:this.editable,prompt:this.getPrompt(),shortMessage:e[0],longMessage:e[1]}},t.prototype.allAuthorizablesMatchSource=function(){var e=this;return this.authorizables.all(function(t){var r=e.sourceAuthorizables[t.id];return e.authorizableType===r.type&&t.id===r.id})},t.prototype.allAuthorizablesLocked=function(){var e=this;return this.authorizables.all(function(t){var r=e.sourceAuthorizables[t.id];return e.authorizableType!==r.type||t.id!==r.id})},t.prototype.getPromptId=function(){return""},t.prototype.getMessages=function(){return["",""]},t.prototype.getPrompt=function(){return this.$translate.instant(this.getPromptId(),{ITEM_NAME:e.L10n.elideIfLong(this.authorizables.first().name),ITEM_COUNT:this.authorizables.size()},e.L10n.Interpolations.Count)||""},t}();e.PermissionsEditabilityLogicBase=t;var r=function(t){function r(r,n,i){t.call(this,r,e.ProjectContentType.name,n,i)}return __extends(r,t),r.prototype.getPromptId=function(){return this.editable?"editProjectPermissionsDescription":""},r}(t);e.ProjectPermissionsEditabilityLogic=r;var n=function(t){function r(r,n,i){t.call(this,r,e.WorkbookContentType.name,n,i)}return __extends(r,t),r.prototype.getPromptId=function(){return this.editable?"editWorkbookPermissionsDescription":"readonlyWorkbookPermissionsDescription"},r.prototype.getMessages=function(){var t=this,r=this.editable?this.messageIdsForEditable():this.messageIdsForReadOnly();return r.map(function(r){return t.$translate.instant(r,{ITEM_COUNT:t.authorizables.size(),SOURCE_NAME:e.L10n.elideIfLong(t.sourceAuthorizables[t.authorizables.first().id].name)},e.L10n.Interpolations.Count)})},r.prototype.messageIdsForEditable=function(){var e=this.authorizables,t=e.first().displayTabs,r=e.all(function(e){return e.displayTabs===t}),n=1===e.size();if(r)if(t)var i="permissionsShortMessage_workbooksAllWithInheritedViews",o=n?"permissionsLongMessage_workbooksSingleWithInheritedViews":"permissionsLongMessage_workbooksAllWithInheritedViews";else var i="permissionsShortMessage_workbooksAllWithIndependentViews",o=n?"permissionsLongMessage_workbooksSingleWithIndependentViews":"permissionsLongMessage_workbooksAllWithIndependentViews";else var i="permissionsShortMessage_workbooksSomeWithIndependentViews",o="permissionsLongMessage_workbooksSomeWithIndependentViews";return[i,o]},r.prototype.messageIdsForReadOnly=function(){if(1===this.authorizables.size())var e="permissionsShortMessage_locked",t="permissionsLongMessage_workbooksSingleInLockedProject";else if(this.allAuthorizablesLocked())var e="permissionsShortMessage_locked",t="permissionsLongMessage_workbooksAllInLockedProjects";else var e="permissionsShortMessage_workbooksSomeInLockedProjects",t="permissionsLongMessage_workbooksSomeInLockedProjects";return[e,t]},r}(t);e.WorkbookPermissionsEditabilityLogic=n;var i=function(t){function r(r,n,i){t.call(this,r,e.DatasourceContentType.name,n,i)}return __extends(r,t),r.prototype.getPromptId=function(){return this.editable?"editDatasourcePermissionsDescription":"readonlyDatasourcePermissionsDescription"},r.prototype.getMessages=function(){var t=this;if(this.editable)return["",""];if(this.allAuthorizablesLocked())var r="permissionsShortMessage_locked",n="permissionsLongMessage_datasourcesAllInLockedProjects";else var r="permissionsShortMessage_datasourcesSomeInLockedProjects",n="permissionsLongMessage_datasourcesSomeInLockedProjects";var i=[r,n];return i.map(function(r){return t.$translate.instant(r,{ITEM_COUNT:t.authorizables.size()},e.L10n.Interpolations.Count)})},r}(t);e.DatasourcePermissionsEditabilityLogic=i;var o=function(t){function r(r,n,i){t.call(this,r,e.ViewContentType.name,n,i)}return __extends(r,t),r.prototype.getPromptId=function(){return this.editable?"editViewPermissionsDescription":"readonlyViewPermissionsDescription"},r.prototype.getMessages=function(){var t=this;if(this.editable)return["",""];var r=this.authorizables.map(function(r){return t.sourceAuthorizables[r.id].type===e.ProjectContentType.name?1:0}).reduce(function(e,t){return e+t}),n=r>0?this.messageIdsForLockedViews(r):this.messageIdsForUnlockedViews(),i=_.uniq(_.filter(this.sourceAuthorizables,function(t){return t.type===e.WorkbookContentType.name}),function(e){return e.type+e.id});return n.map(function(r){return t.$translate.instant(r,{ITEM_COUNT:t.authorizables.size(),SOURCE_COUNT:i.length,SOURCE_NAME:e.L10n.elideIfLong(_.first(i)&&_.first(i).name)},e.L10n.Interpolations.Count)})},r.prototype.messageIdsForLockedViews=function(e){if(e===this.authorizables.size())var t="permissionsShortMessage_locked",r="permissionsLongMessage_viewsAllInLockedProjects";else var t="permissionsShortMessage_viewsSomeInLockedProjects",r="permissionsLongMessage_viewsSomeInLockedProjects";return[t,r]},r.prototype.messageIdsForUnlockedViews=function(){if(1===this.authorizables.size())var e="permissionsShortMessage_viewsAllInheritedFromWorkbooks",t="permissionsLongMessage_viewsSingleInheritedFromWorkbook";else if(this.allAuthorizablesLocked())var e="permissionsShortMessage_viewsAllInheritedFromWorkbooks",t="permissionsLongMessage_viewsAllInheritedFromWorkbooks";else var e="permissionsShortMessage_viewsSomeInheritedFromWorkbooks",t="permissionsLongMessage_viewsSomeInheritedFromWorkbooks";return[e,t]},r}(t);e.ViewPermissionsEditabilityLogic=o}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e){this.$translate=e}return t.prototype.logicForAuthorizables=function(e,r,n){var i=t.ImplForContentType[r];return new i(e,n,this.$translate)},t.$inject=["$translate"],t.ImplForContentType={project:e.ProjectPermissionsEditabilityLogic,workbook:e.WorkbookPermissionsEditabilityLogic,datasource:e.DatasourcePermissionsEditabilityLogic,view:e.ViewPermissionsEditabilityLogic},t}();e.PermissionsEditabilityLogicFactory=t,e.Module.instance().service("PermissionsEditabilityLogicFactory",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e){this.capabilities=e}return t.prototype.hash=function(t){return _.map(this.capabilities,function(r){switch(t[r]){case e.Permission.Allowed:return"A";case e.Permission.Denied:return"D";case e.Permission.Mixed:return"M";default:return"-"}}).join("")},t}();e.PermissionsHasher=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){e.Capabilities={read:"read",write:"write",deleteItem:"delete",changePermissions:"change_permissions",filter:"filter",addComment:"add_comment",viewComments:"view_comments",exportData:"export_data",vud:"vud",exportImage:"export_image",shareView:"share_view",webAuthoring:"web_authoring",exportXml:"export_xml",changeHierarchy:"change_hierarchy",connect:"connect",projectLeader:"project_leader"};var t=[e.Capabilities.addComment,e.Capabilities.changeHierarchy,e.Capabilities.changePermissions,e.Capabilities.connect,e.Capabilities.deleteItem,e.Capabilities.exportData,e.Capabilities.exportImage,e.Capabilities.exportXml,e.Capabilities.filter,e.Capabilities.projectLeader,e.Capabilities.read,e.Capabilities.shareView,e.Capabilities.viewComments,e.Capabilities.vud,e.Capabilities.webAuthoring,e.Capabilities.write],r=[e.Capabilities.projectLeader,e.Capabilities.read,e.Capabilities.write],n=[e.Capabilities.addComment,e.Capabilities.changeHierarchy,e.Capabilities.changePermissions,e.Capabilities.deleteItem,e.Capabilities.exportData,e.Capabilities.exportImage,e.Capabilities.exportXml,e.Capabilities.filter,e.Capabilities.read,e.Capabilities.shareView,e.Capabilities.viewComments,e.Capabilities.vud,e.Capabilities.webAuthoring,e.Capabilities.write],i=[e.Capabilities.changePermissions,e.Capabilities.connect,e.Capabilities.deleteItem,e.Capabilities.exportXml,e.Capabilities.read,e.Capabilities.write],o=[e.Capabilities.addComment,e.Capabilities.changePermissions,e.Capabilities.deleteItem,e.Capabilities.exportData,e.Capabilities.exportImage,e.Capabilities.filter,e.Capabilities.read,e.Capabilities.shareView,e.Capabilities.viewComments,e.Capabilities.vud,e.Capabilities.webAuthoring];e.CapabilitiesByContentType={project:r,projectWorkbookTemplate:n,projectDatasourceTemplate:i,workbook:n,datasource:i,view:o},e.CapabilitiesByContentTypeDeprecated={project:t,workbook:n,datasource:i,view:o}}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(){}return e.create=function(e,t,r){var n={};return _.each(t,function(e){n[e]=r}),{locKey:e,permissions:n}},e}();e.Role=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){var r=[],n=[e.ServerApi.Capabilities.read,e.ServerApi.Capabilities.viewComments,e.ServerApi.Capabilities.addComment,e.ServerApi.Capabilities.exportData,e.ServerApi.Capabilities.exportImage];t.ProjectViewer=e.Role.create(e.L10n.Keys.viewer,n,e.Permission.Allowed),r.push(t.ProjectViewer);var i=n.concat([e.ServerApi.Capabilities.filter,e.ServerApi.Capabilities.vud,e.ServerApi.Capabilities.shareView,e.ServerApi.Capabilities.webAuthoring]);t.ProjectInteractor=e.Role.create(e.L10n.Keys.interactor,i,e.Permission.Allowed),r.push(t.ProjectInteractor);var o=i.concat([e.ServerApi.Capabilities.write,e.ServerApi.Capabilities.deleteItem,e.ServerApi.Capabilities.exportXml,e.ServerApi.Capabilities.changeHierarchy,e.ServerApi.Capabilities.changePermissions]);t.ProjectEditor=e.Role.create(e.L10n.Keys.editor,o,e.Permission.Allowed),r.push(t.ProjectEditor);var s=[e.ServerApi.Capabilities.read,e.ServerApi.Capabilities.connect];t.DataSourceConnector=e.Role.create(e.L10n.Keys.datasourceConnector,s,e.Permission.Allowed),r.push(t.DataSourceConnector);var a=s.concat([e.ServerApi.Capabilities.write,e.ServerApi.Capabilities.deleteItem,e.ServerApi.Capabilities.exportXml,e.ServerApi.Capabilities.changePermissions]);t.DataSourceEditor=e.Role.create(e.L10n.Keys.datasourceEditor,a,e.Permission.Allowed),r.push(t.DataSourceEditor);var c=i.concat([e.ServerApi.Capabilities.write]);t.ProjectPublisher=e.Role.create(e.L10n.Keys.publisher,c,e.Permission.Allowed),r.push(t.ProjectPublisher);var l=[e.ServerApi.Capabilities.projectLeader];t.ProjectLeader=e.Role.create(e.L10n.Keys.projectLeader,l,e.Permission.Allowed),r.push(t.ProjectLeader);var u=[];u.push(t.DataSourceConnector),u.push(t.DataSourceEditor);var d=[],p=[e.ServerApi.Capabilities.addComment,e.ServerApi.Capabilities.exportData,e.ServerApi.Capabilities.exportImage,e.ServerApi.Capabilities.read,e.ServerApi.Capabilities.viewComments];t.WorkbookViewer=e.Role.create(e.L10n.Keys.viewer,p,e.Permission.Allowed),d.push(t.WorkbookViewer);var h=p.concat([e.ServerApi.Capabilities.filter,e.ServerApi.Capabilities.shareView,e.ServerApi.Capabilities.vud,e.ServerApi.Capabilities.webAuthoring]);t.WorkbookInteractor=e.Role.create(e.L10n.Keys.interactor,h,e.Permission.Allowed),d.push(t.WorkbookInteractor);var f=h.concat([e.ServerApi.Capabilities.changeHierarchy,e.ServerApi.Capabilities.changePermissions,e.ServerApi.Capabilities.deleteItem,e.ServerApi.Capabilities.exportXml,e.ServerApi.Capabilities.write]);t.WorkbookEditor=e.Role.create(e.L10n.Keys.editor,f,e.Permission.Allowed),d.push(t.WorkbookEditor);var m=[],v=[e.ServerApi.Capabilities.addComment,e.ServerApi.Capabilities.exportData,e.ServerApi.Capabilities.exportImage,e.ServerApi.Capabilities.read,e.ServerApi.Capabilities.viewComments];t.ViewViewer=e.Role.create(e.L10n.Keys.viewer,v,e.Permission.Allowed),m.push(t.ViewViewer);var S=v.concat([e.ServerApi.Capabilities.filter,e.ServerApi.Capabilities.shareView,e.ServerApi.Capabilities.vud,e.ServerApi.Capabilities.webAuthoring]);t.ViewInteractor=e.Role.create(e.L10n.Keys.interactor,S,e.Permission.Allowed),m.push(t.ViewInteractor);var g=S.concat([e.ServerApi.Capabilities.changePermissions,e.ServerApi.Capabilities.deleteItem]);t.ViewEditor=e.Role.create(e.L10n.Keys.editor,g,e.Permission.Allowed),m.push(t.ViewEditor),t.explicitRolesByContentType={project:r,workbook:d,datasource:u,view:m}}(t=e.PermissionRoleDefinitions||(e.PermissionRoleDefinitions={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){var r=[],n=[e.ServerApi.Capabilities.read];t.ProjectViewer=e.Role.create(e.L10n.Keys.viewer,n,e.Permission.Allowed),r.push(t.ProjectViewer);var i=n.concat([e.ServerApi.Capabilities.write]);t.ProjectPublisher=e.Role.create(e.L10n.Keys.publisher,i,e.Permission.Allowed),r.push(t.ProjectPublisher);var o=[e.ServerApi.Capabilities.projectLeader];t.ProjectLeader=e.Role.create(e.L10n.Keys.projectLeader,o,e.Permission.Allowed),r.push(t.ProjectLeader);var s=[],a=[e.ServerApi.Capabilities.read,e.ServerApi.Capabilities.connect];t.DataSourceConnector=e.Role.create(e.L10n.Keys.datasourceConnector,a,e.Permission.Allowed),s.push(t.DataSourceConnector);var c=a.concat([e.ServerApi.Capabilities.write,e.ServerApi.Capabilities.deleteItem,e.ServerApi.Capabilities.exportXml,e.ServerApi.Capabilities.changePermissions]);t.DataSourceEditor=e.Role.create(e.L10n.Keys.datasourceEditor,c,e.Permission.Allowed),s.push(t.DataSourceEditor);var l=[],u=[e.ServerApi.Capabilities.addComment,e.ServerApi.Capabilities.exportData,e.ServerApi.Capabilities.exportImage,e.ServerApi.Capabilities.read,e.ServerApi.Capabilities.viewComments];t.WorkbookViewer=e.Role.create(e.L10n.Keys.viewer,u,e.Permission.Allowed),l.push(t.WorkbookViewer);var d=u.concat([e.ServerApi.Capabilities.filter,e.ServerApi.Capabilities.shareView,e.ServerApi.Capabilities.vud,e.ServerApi.Capabilities.webAuthoring]);t.WorkbookInteractor=e.Role.create(e.L10n.Keys.interactor,d,e.Permission.Allowed),l.push(t.WorkbookInteractor);var p=d.concat([e.ServerApi.Capabilities.changeHierarchy,e.ServerApi.Capabilities.changePermissions,e.ServerApi.Capabilities.deleteItem,e.ServerApi.Capabilities.exportXml,e.ServerApi.Capabilities.write]);t.WorkbookEditor=e.Role.create(e.L10n.Keys.editor,p,e.Permission.Allowed),l.push(t.WorkbookEditor);var h=[],f=[e.ServerApi.Capabilities.addComment,e.ServerApi.Capabilities.exportData,e.ServerApi.Capabilities.exportImage,e.ServerApi.Capabilities.read,e.ServerApi.Capabilities.viewComments];t.ViewViewer=e.Role.create(e.L10n.Keys.viewer,f,e.Permission.Allowed),h.push(t.ViewViewer);var m=f.concat([e.ServerApi.Capabilities.filter,e.ServerApi.Capabilities.shareView,e.ServerApi.Capabilities.vud,e.ServerApi.Capabilities.webAuthoring]);t.ViewInteractor=e.Role.create(e.L10n.Keys.interactor,m,e.Permission.Allowed),h.push(t.ViewInteractor);var v=m.concat([e.ServerApi.Capabilities.changePermissions,e.ServerApi.Capabilities.deleteItem]);t.ViewEditor=e.Role.create(e.L10n.Keys.editor,v,e.Permission.Allowed),h.push(t.ViewEditor),t.explicitRolesByContentType={project:r,projectWorkbookTemplate:l,projectDatasourceTemplate:s,workbook:l,datasource:s,view:h}}(t=e.PermissionTemplateRoleDefinitions||(e.PermissionTemplateRoleDefinitions={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r){var n=this;this.permissionsAndRolesByType={},this.capabilitiesByContentType=r;var i=_.uniq(_.flatten(_.values(r)));this.permissionsHasher=new e.PermissionsHasher(i),_.each(t,function(t,i){_.each(t,function(e){n.addRoleForContentType(i,e)});var o={},s={};_.each(r[i],function(t){o[t]=e.Permission.Unspecified,s[t]=e.Permission.Denied}),n.addExplicitRole(i,o,e.L10n.Keys.none),n.addExplicitRole(i,s,e.L10n.Keys.denied),n.addEffectiveRole(i,s,e.L10n.Keys.none)})}return t.prototype.getExplicitRoleForTypeAndPermissions=function(e,t){return this.getRoleForPermissions(this.getExplicitRolesForType(e),t)},t.prototype.getEffectiveRoleForTypeAndPermissions=function(e,t){return this.getRoleForPermissions(this.getEffectiveRolesForType(e),t)},t.prototype.getPermissionsForTypeAndRole=function(e,t){return this.getPermissionsByRoleForType(e)[t]},t.prototype.getAvailableRolesForType=function(e){return _.values(this.getExplicitRolesForType(e));
},t.prototype.getPermissionsAndRolesForType=function(e){var t=this.permissionsAndRolesByType[e];return t||(t={permissionsByRole:{},explicitRolesByPermissionsHash:{},effectiveRolesByPermissionsHash:{}},this.permissionsAndRolesByType[e]=t),t},t.prototype.getPermissionsByRoleForType=function(e){return this.getPermissionsAndRolesForType(e).permissionsByRole},t.prototype.getExplicitRolesForType=function(e){return this.getPermissionsAndRolesForType(e).explicitRolesByPermissionsHash},t.prototype.getEffectiveRolesForType=function(e){return this.getPermissionsAndRolesForType(e).effectiveRolesByPermissionsHash},t.prototype.getRoleForPermissions=function(t,r){return t[this.permissionsHasher.hash(r)]||e.L10n.Keys.custom},t.prototype.setRoleForPermissions=function(e,t,r){e[this.permissionsHasher.hash(t)]=r},t.prototype.addRoleForContentType=function(t,r){var n=this.capabilitiesByContentType[t],i={},o={};_.each(n,function(t){var n=r.permissions[t]||e.Permission.Unspecified;i[t]=n,o[t]=n===e.Permission.Unspecified?e.Permission.Denied:n}),this.addExplicitRole(t,i,r.locKey),this.addEffectiveRole(t,o,r.locKey)},t.prototype.addExplicitRole=function(e,t,r){var n=this.getPermissionsAndRolesForType(e);n.permissionsByRole[r]=t,this.setRoleForPermissions(n.explicitRolesByPermissionsHash,t,r)},t.prototype.addEffectiveRole=function(e,t,r){var n=this.getPermissionsAndRolesForType(e);this.setRoleForPermissions(n.effectiveRolesByPermissionsHash,t,r)},t}();e.PermissionRoles=t,e.Module.instance().factory("PermissionRoles",function(){if(e.FeatureFlags.projectPermissionsTemplatesEnabled)var r=e.PermissionTemplateRoleDefinitions.explicitRolesByContentType,n=e.ServerApi.CapabilitiesByContentType;else var r=e.PermissionRoleDefinitions.explicitRolesByContentType,n=e.ServerApi.CapabilitiesByContentTypeDeprecated;return new t(r,n)})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){function r(e){return e.group?"group":e.user?"user":""}function n(e){return e.group?e.group.userCount>=0?e.group.name+" ("+e.group.userCount+")":e.group.name:e.user?e.user.displayName:""}function i(e,t){if(e&&t){if(e.group&&t.group)return e.group.id===t.group.id;if(e.user&&t.user)return e.user.id===t.user.id}return!1}function o(e,t){return e.group?t.group?e.group.isAllUsersGroup?t.group.isAllUsersGroup?0:-1:t.group.isAllUsersGroup?1:s(e.group.name,t.group.name):-1:t.group?1:s(e.user.displayName,t.user.displayName)}function s(t,r){return t.localeCompare(r,e.L10n.language)}function a(e,t,r){var n=c(e,t);return n?n[r]:void 0}function c(t,r){return t?e.FeatureFlags.projectPermissionsTemplatesEnabled?t.permissionsByContentType&&t.permissionsByContentType[r]:t.permissions:void 0}function l(t,r,n,i){var o=a(t,r,n);if(!o)return i;switch(o.reason){case e.PermissionReason.GroupAllow:return"group_allow";case e.PermissionReason.GroupDeny:return"group_disallow";case e.PermissionReason.GroupProjectLeaderAllow:return"group_project_leader";case e.PermissionReason.GuestAllow:return"guest_allowed";case e.PermissionReason.ImplicitDeny:return"implicit_deny";case e.PermissionReason.Mixed:return"mixed";case e.PermissionReason.Unspecified:return"unspecified";case e.PermissionReason.UserAdminAllow:return"user_admin";case e.PermissionReason.UserAllow:return"user_allow";case e.PermissionReason.UserAuthorizableOwnerAllow:return"user_authorizable_owner";case e.PermissionReason.UserDeny:return"user_disallow";case e.PermissionReason.UserLicensingDeny:return"user_licensing";case e.PermissionReason.UserProjectLeaderAllow:return"user_project_leader";case e.PermissionReason.UserProjectOwnerAllow:return"user_project_owner";default:return i}}function u(t,r,n,i){var o=a(t,r,n);if(!o)return i;switch(o.permission){case e.Permission.Allowed:return"allowed";case e.Permission.Denied:return"denied";case e.Permission.Mixed:return"mixed";default:return i}}function d(t,r,n,i){var o=a(t,r,n);return o&&o.reason!=e.PermissionReason.Mixed&&o.reason!=e.PermissionReason.Unspecified?"permission_reason_"+l(t,r,n,i):"permission_value_"+u(t,r,n,i)}function p(e){var t={};return _.each(e,function(e,r){t[r]=e.permission}),t}function h(e,t,r){var n=c(e,t),i=p(n);return r.getExplicitRoleForTypeAndPermissions(t,i)}function f(e,t,r){var n=c(e,t),i=p(n);return r.getEffectiveRoleForTypeAndPermissions(t,i)}function m(t){var r={};return _.each(t,function(t,n){r[n]={permission:t,reason:e.PermissionReason.Unspecified}}),r}function v(e){var t={};return _.each(e,function(e,r){t[r]=e.permission}),t}function S(e){return R[e]}function g(t){var r=function(r){return new e.ServerApi.GetExplicitPermissionsRequest({authorizables:{type:t.type,ids:r}})};return e.RequestHelper.buildRequests(t.ids,r)}function y(t,r){var n=function(n){return new e.ServerApi.GetEffectivePermissionsRequest({userIds:t,authorizables:{type:r.type,ids:n}})};return e.RequestHelper.buildRequests(r.ids,n)}function A(t,r){var n=function(t){var n=[];return _.each(t,function(e){_.each(r.permissionsByContentType,function(t,i){if(!_.isEqual(t,{})){var o={authorizable:{type:i,id:e},grantee:P(r),permissions:C(t)};n.push(o)}})}),new e.ServerApi.SetExplicitPermissionsRequest({permissions:n})};return e.RequestHelper.buildRequests(t.ids,n)}function P(e){return e.group?{type:"group",id:e.group.id}:e.user?{type:"user",id:e.user.id}:null}function C(e){return _.map(e,function(e,t){var r={capability:t,value:b(e.permission)};return r})}function b(t){switch(t){case e.Permission.Allowed:return"allowed";case e.Permission.Denied:return"denied";case e.Permission.Mixed:return"mixed";case e.Permission.Unspecified:return"unspecified";default:return null}}t.granteeType=r,t.granteeName=n,t.hasSameGrantee=i,t.compareGrantees=o,t.permissionFromIGranteePermission=a,t.permissionsFromIGranteePermission=c,t.capabilityReason=l,t.capabilityValue=u,t.capabilityTitleKey=d,t.pluckPermissionsFromDictionary=p,t.explicitGranteeRole=h,t.effectiveGranteeRole=f,t.IPermissionsFromPermissions=m,t.PermissionsFromIPermissions=v;var R={project:["project","projectWorkbookTemplate","projectDatasourceTemplate"],workbook:["workbook"],datasource:["datasource"],view:["view"]};t.getPermissionsContentTypes=S,t.explicitPermissionsRequestsForAuthorizables=g,t.effectivePermissionsRequestsForAuthorizables=y,t.setExplicitPermissionsRequestsForAuthorizables=A,t.getGrantee=P,t.capabilityValuesFromPermissions=C,t.capabilityValueFromPermission=b}(t=e.PermissionsHelper||(e.PermissionsHelper={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e){this.permissionsPanel=e}return e.prototype.startResize=function(e){this.topPanel=this.permissionsPanel.find(".tb-permissions-top"),this.bottomPanel=this.permissionsPanel.find(".tb-permissions-bottom"),this.startY=e,this.startTopHeight=this.topPanel.height();var t=this.permissionsPanel.find(".tb-explicit-permissions-body"),r=this.permissionsPanel.find(".tb-permissions-panel-divider"),n=t.height(),i=this.bottomPanel.height(),o=r.height();this.minTopHeight=this.startTopHeight-n+o,this.maxTopHeight=this.startTopHeight+i-2*o},e.prototype.continueResize=function(e){var t=e-this.startY,r=t+this.startTopHeight;r=Math.min(Math.max(r,this.minTopHeight),this.maxTopHeight),this.topPanel.css({height:r}),this.bottomPanel.css({top:r})},e}();e.PermissionsPanelResizer=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e,t){this.fetcher=e,this.fetchParams=t}return e.prototype.getSlice=function(e,t){return this.fetchItems({filter:this.fetchParams.filter,order:this.fetchParams.order,page:{startIndex:e,maxItems:t}})},e.prototype.fetchItems=function(e){var t=this;return this.fetcher.fetchList(e).then(function(r){return r&&(t.fetchParams=e),r})},e}();e.PagedList=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getExplicitPermissions",t)}return __extends(t,e),t}(e.Request);e.GetExplicitPermissionsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"setExplicitPermissions",t)}return __extends(t,e),t}(e.Request);e.SetExplicitPermissionsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e){this.server=e}return t.prototype.forAuthorizables=function(t){if(e.FeatureFlags.projectPermissionsTemplatesEnabled)var r=e.PermissionsHelper.explicitPermissionsRequestsForAuthorizables(t);else var r=e.RequestHelper.buildRequests(t.ids,function(r){return new e.ServerApi.GetExplicitPermissionsRequest({authorizables:{type:t.type,ids:r}})});var n=function(t){return{permissions:e.ResultHelper.combine(t,function(e){return e.permissions}),groups:e.ResultHelper.combine(t,function(e){return e.groups}),users:e.ResultHelper.combine(t,function(e){return e.users}),sourceAuthorizableById:e.ResultHelper.combineByKey(t,function(e){return e.sourceAuthorizableById})}};return this.server.sendRequestsParallel(r,n).then(function(r){var n=e.PermissionsMerger.makeGranteePermissionsList(r.permissions,t.ids,r.groups,r.users);return{permissionsList:new e.ListResult(n),sourceAuthorizablesById:r.sourceAuthorizableById}})},t.prototype.setForAuthorizables=function(t,r){if(e.FeatureFlags.projectPermissionsTemplatesEnabled)var n=e.PermissionsHelper.setExplicitPermissionsRequestsForAuthorizables(t,r);else var i=_.map(t.ids,function(n){var i={authorizable:{type:t.type,id:n},grantee:e.PermissionsHelper.getGrantee(r),permissions:e.PermissionsHelper.capabilityValuesFromPermissions(r.permissions)};return i}),n=e.RequestHelper.buildRequests(i,function(t){return new e.ServerApi.SetExplicitPermissionsRequest({permissions:t})});return this.server.sendRequestsParallel(n,e.ResultHelper.combineResults)},t.$inject=["ServerService"],t}();e.ExplicitPermissions=t,e.Module.instance().service("ExplicitPermissions",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e){this.permissionRoles=e}return t.prototype.createForUserWithUnspecifiedPermissions=function(e,t){var r={user:e};return this.addUnspecifiedPermissions(r,t)},t.prototype.createForGroupWithUnspecifiedPermissions=function(e,t){var r={group:e};return this.addUnspecifiedPermissions(r,t)},t.prototype.addUnspecifiedPermissions=function(t,r){var n=this;if(e.FeatureFlags.projectPermissionsTemplatesEnabled){var i=e.PermissionsHelper.getPermissionsContentTypes(r),o=_.reduce(i,function(t,r){return t[r]=e.PermissionsHelper.IPermissionsFromPermissions(n.permissionRoles.getPermissionsForTypeAndRole(r,e.L10n.Keys.none)),t},{});_.defaults(t,{permissionsByContentType:o})}else{var s=e.PermissionsHelper.IPermissionsFromPermissions(this.permissionRoles.getPermissionsForTypeAndRole(r,e.L10n.Keys.none));_.defaults(t,{permissions:s})}return t},t.$inject=["PermissionRoles"],t}();e.GranteePermissionsFactory=t,e.Module.instance().service("GranteePermissionsFactory",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(){this.actionDefinition=[this.editPermissionRuleAction(),this.deletePermissionRuleAction()]}return t.prototype.getActionButtons=function(e){return this.$scope=e,this.actionDefinition},t.prototype.editPermissionRuleAction=function(){var t=this;return{name:"edit",isDisabled:function(e){return!e},execute:function(r){t.showPermissionRuleEditor(e.PermissionRuleEditorCommands.edit)}}},t.prototype.deletePermissionRuleAction=function(){var t=this;return{name:"delete",isDisabled:function(e){return t.isAllUsersGroup(e)},execute:function(r){t.showPermissionRuleEditor(e.PermissionRuleEditorCommands.delete_)}}},t.prototype.isAllUsersGroup=function(e){return e&&e.group&&e.group.isAllUsersGroup},t.prototype.showPermissionRuleEditor=function(e){this.$scope.permissionRuleEditorParams.action=e,this.$scope.permissionRuleEditorParams.show=!0},t}();e.PermissionsPanelActions=t,e.Module.instance().service("PermissionsPanelActions",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(){}return t.forTemplateType=function(t){return e.FeatureFlags.projectPermissionsTemplatesEnabled?t+"PermissionsPanel.html":t+"PermissionsPanelWithoutPermissionsTemplates.html"},t}(),r=function(){function r(r,n,i,o,s,a,c,l,u,d,p,h,f,m){var v=this;this.$scope=r,this.$q=i,this.$timeout=o,this.sliceableFactory=c,this.server=l,this.explicitPermissions=u,this.permissionRoles=p,this.permissionsEditabilityLogicFactory=h,this.granteePermissionsFactory=m,this.hoveredCapabilityValue=null,this.updateCurrentAuthorizables(),this.effectivePermissionsFetcher=new e.EffectivePermissionsFetcher(d,this.$scope.currentAuthorizables),this.$scope.currentExplicitPermission=null,this.hoveredEffectivePermission=null,this.hoveredExplicitPermission=null,this.$scope.isLoadingEffectivePermissions=!1,this.permissionsPanelResizer=new e.PermissionsPanelResizer(n),r.permissionsTemplateUrl=t.forTemplateType(r.templateType),e.FeatureFlags.projectPermissionsTemplatesEnabled&&!e.FeatureFlags.projectControlledPermissionsEnabled&&(r.editability={editable:!r.readOnly(),prompt:"",shortMessage:"",longMessage:""}),r.columnWidths=e.getPermissionsPanelColumnWidths(r.authorizableType),r.resize=function(e){r.$apply(function(){r.columnWidths.resizer.continueResize(e)})},r.granteeType=e.PermissionsHelper.granteeType,r.granteeName=e.PermissionsHelper.granteeName,r.explicitGranteeRole=function(t,r){return e.PermissionsHelper.explicitGranteeRole(t,r,v.permissionRoles)},r.userStatusForRow=function(e,t){return v.userStatusForRow(e,t)},r.capabilityValue=e.PermissionsHelper.capabilityValue,r.capabilityReason=e.PermissionsHelper.capabilityReason,r.capabilityTitleKey=e.PermissionsHelper.capabilityTitleKey,r.explicitPermissionsPanelControls={},r.effectivePermissionsPanelControls={},r.toggleCurrentExplicitPermission=function(e){r.permissionRuleEditorParams.show||(r.currentExplicitPermission===e?v.setCurrentExplicitPermission(null):v.setCurrentExplicitPermission(e))},r.setCurrentExplicitPermission=function(e){return v.setCurrentExplicitPermission(e)},r.haveCurrentExplicitPermission=function(){return!!v.$scope.currentExplicitPermission},r.isCurrentExplicitPermission=function(e){return v.$scope.currentExplicitPermission===e},r.isHoveredExplicitPermission=function(e){return v.hoveredExplicitPermission===e},r.isHoveredEffectivePermission=function(e){return v.hoveredEffectivePermission===e},r.showEditButtonForRow=function(e){return v.hoveredExplicitPermission?v.hoveredExplicitPermission===e:!1},r.showDeleteButtonForRow=function(e){return v.hoveredExplicitPermission&&v.hoveredExplicitPermission.group&&v.hoveredExplicitPermission.group.isAllUsersGroup?!1:v.$scope.showEditButtonForRow(e)},r.isRelevantExplicitPermission=function(e){return v.isRelevantExplicitPermission(e)},r.isNotRelevantExplicitPermission=function(e){return v.isNotRelevantExplicitPermission(e)},r.relevantCapabilityClass=function(e,t,r,n){return v.relevantCapabilityClass(e,t,r,n)},r.isRelevantHeader=function(e){return v.hoveredCapabilityValue===e},r.setHoveredCapabilityValue=function(e){var t=e.attr("data-capability-name");v.hoveredCapabilityValue=t,v.$scope.$digest()},r.clearHoveredCapabilityValue=function(){v.hoveredCapabilityValue=null,v.$scope.$digest()},r.isCurrentEffectivePermission=function(e){return v.hoveredEffectivePermission===e},r.hasCurrentEffectivePermission=function(){return!!v.hoveredEffectivePermission},r.effectiveRowHovered=function(e){v.hoveredEffectivePermission=e,v.$scope.$digest()},r.explicitRowHovered=function(e){v.hoveredExplicitPermission=e,v.$scope.$digest()},r.startResize=function(e){return v.permissionsPanelResizer.startResize(e)},r.continueResize=function(e){return v.permissionsPanelResizer.continueResize(e)},r.effectivePermissionsSliceChanged=function(e){var t=_.map(e.items,function(e){return e.user.id});v.updateGroupMembership(t),v.$timeout(function(){if(v.$scope.effectivePermissionsPanelControls.scrollControls){var e=v.$scope.explicitPermissionsPanelControls.scrollControls.getScrollLeft();v.$scope.effectivePermissionsPanelControls.scrollControls.setScrollLeft(e)}})},r.deletePermissionRule=function(t){v.setCurrentExplicitPermission(t),v.showPermissionRuleEditor(e.PermissionRuleEditorCommands.delete_)},r.editPermissionRule=function(t){v.setCurrentExplicitPermission(t),v.showPermissionRuleEditor(e.PermissionRuleEditorCommands.edit)},r.hideRowMenu=function(){v.hidePermissionRuleEditor()},r.submitSearch=function(e,t){v.$scope.currentExplicitPermission!==v.explicitPermissionsList.items[0]&&v.setCurrentExplicitPermission(v.explicitPermissionsList.items[0]),v.updateEffectivePermissions(e),f.isTouch()&&t&&$(t.target).blur()},r.permissionRuleEditorParams={show:!1,action:null},r.refresh=function(){return v.updateCurrentAuthorizables(),v.updateExplicitPermissions(v.$scope.currentAuthorizables)},r.addUserOrGroupSelector={isShown:!1},r.addNewUserPermission=function(e){e&&v.addNewGranteePermissions(v.granteePermissionsFactory.createForUserWithUnspecifiedPermissions(e,v.$scope.authorizableType))},r.addNewGroupPermission=function(e){e&&v.addNewGranteePermissions(v.granteePermissionsFactory.createForGroupWithUnspecifiedPermissions(e,v.$scope.authorizableType))},r.haveCurrentAuthorizable=function(){return v.$scope.authorizables.size()>0},r.getTooltipText=function(e){return $(e.target).closest(".tb-capability-value-cell").find(".tb-capability-value").attr("data-tooltip")},r.getHeaderTooltipText=function(e){return r.headerTextAccordion.isSectionOpen(0)?null:$(e.target).closest(".tb-permissions-capability-header-icon-cell").find(".tb-permissions-capability-icon").attr("data-tooltip")},r.scrollLeftChanged=function(e){n.find(".tb-explicit-permissions-headers-line").css({left:-e+"px"}),n.find(".tb-data-grid-body-background").css({right:-e+"px"}),v.$scope.explicitPermissionsPanelControls.scrollControls.setScrollLeft(e),v.$scope.effectivePermissionsPanelControls.scrollControls&&v.$scope.effectivePermissionsPanelControls.scrollControls.setScrollLeft(e)},r.sectionGroupAccordion=r.authorizableType===e.ContentTypes.project?new e.SingleSectionAccordion:e.StaticAccordion,r.headerTextAccordion=new e.SingleSectionAccordion,r.shortHeaderText=function(){switch(e.L10n.language){case"de":return!1;case"en":return!0;case"es":return!1;case"fr":return!1;case"ja":return!0;case"ko":return!0;case"pt":return!1;case"zh":return!0}return!1},r.menuActions=a.getActionButtons(r),r.projectControlledPermissionsEnabled=e.FeatureFlags.projectControlledPermissionsEnabled,r.permissionsLockStatusProps={lockState:e.LockStatusHelper.getLockState(this.$scope.authorizables),translate:s.instant},r.refresh()}return r.prototype.setCurrentExplicitPermission=function(e){this.$scope.currentExplicitPermission!==e&&(this.$scope.currentExplicitPermission=e,this.updateEffectivePermissions())},r.prototype.addNewGranteePermissions=function(t){var r=this;this.$scope.addUserOrGroupSelector.isShown=!1;var n=this.explicitPermissionsList.items,i=this.getGranteeIndex(t);if(e.PermissionsHelper.hasSameGrantee(t,n[i]))this.startEditingRule(i,e.PermissionRuleEditorCommands.edit);else{n.splice(i,0,t),this.$scope.explicitPermissions=this.sliceableFactory.fromArray(n);var o=this.$scope.$on(e.ScrollCtrl.ItemsChangeEvent,function(){o(),r.startEditingRule(i,e.PermissionRuleEditorCommands.add)})}},r.prototype.getGranteeIndex=function(t){return _.sortedIndex(this.explicitPermissionsList.items,t,function(r){return e.PermissionsHelper.compareGrantees(r,t)})},r.prototype.startEditingRule=function(e,t){var r=this;this.setCurrentExplicitPermission(this.explicitPermissionsList.items[e]),this.$scope.explicitPermissionsPanelControls.scrollControls.scrollIntoView(e),this.$timeout(function(){r.$scope.permissionRuleEditorParams.action=t,r.$scope.permissionRuleEditorParams.show=!0})},r.prototype.showPermissionRuleEditor=function(e){this.$scope.permissionRuleEditorParams.action=e,this.$scope.permissionRuleEditorParams.show=!0},r.prototype.hidePermissionRuleEditor=function(){this.$scope.permissionRuleEditorParams.show=!1},r.prototype.updateCurrentAuthorizables=function(){this.$scope.currentAuthorizables={type:this.$scope.authorizableType,ids:this.$scope.authorizables.keys()}},r.prototype.updateExplicitPermissions=function(t){var r=this;return this.explicitPermissions.forAuthorizables(t).then(function(n){if(n){if(r.explicitPermissionsList=n.permissionsList,e.FeatureFlags.projectControlledPermissionsEnabled){var i=r.permissionsEditabilityLogicFactory.logicForAuthorizables(r.$scope.authorizables,r.$scope.authorizableType,n.sourceAuthorizablesById);r.$scope.editability=i.getEditabilityWithMessages()}r.explicitPermissionsList.items.sort(e.PermissionsHelper.compareGrantees),r.effectivePermissionsFetcher.setAuthorizables(t),r.updateExplicitPermissionsSlice(),r.updateEffectivePermissions()}})},r.prototype.setMissingCapabilitiesToUnspecified=function(t){var r=_.keys(this.permissionRoles.getPermissionsForTypeAndRole(this.$scope.authorizableType,e.L10n.Keys.none));_.each(t,function(t){_.each(r,function(r){_.has(t.permissions,r)||(t.permissions[r]={permission:e.Permission.Unspecified,reason:e.PermissionReason.Unspecified})})})},r.prototype.setMissingCapabilitiesForSectionsToUnspecified=function(t){var r=this;_.each(e.PermissionsHelper.getPermissionsContentTypes(this.$scope.authorizableType),function(n){var i=_.keys(r.permissionRoles.getPermissionsForTypeAndRole(n,e.L10n.Keys.none));_.each(t,function(t){_.has(t.permissionsByContentType,n)||(t.permissionsByContentType[n]={});var r=t.permissionsByContentType[n];_.each(i,function(t){_.has(r,t)||(r[t]={permission:e.Permission.Unspecified,reason:e.PermissionReason.Unspecified})})})})},r.prototype.updateExplicitPermissionsSlice=function(){var t=this.explicitPermissionsList.items;e.FeatureFlags.projectPermissionsTemplatesEnabled?this.setMissingCapabilitiesForSectionsToUnspecified(t):this.setMissingCapabilitiesToUnspecified(t),this.$scope.explicitPermissions=this.sliceableFactory.fromArray(t);var r=this.$scope.currentExplicitPermission;r&&(this.$scope.currentExplicitPermission=_.find(t,function(t){return e.PermissionsHelper.hasSameGrantee(t,r)}))},r.prototype.updateEffectivePermissions=function(t){this.$scope.isLoadingEffectivePermissions=!0,this.hoveredEffectivePermission=null;var r=this.$scope.currentExplicitPermission;if(r){var n=[];r.group?n.push(e.Filter.stringArrayFieldHas("groupIds",r.group.id)):r.user&&n.push(e.Filter.stringFieldEq("id",r.user.id)),t&&n.push(e.Filter.search(t));var i={filter:e.Filter.and(n),order:[{field:e.ServerApi.UserKeys.displayName,ascending:!0}]};this.$scope.effectivePermissions=new e.PagedList(this.effectivePermissionsFetcher,i)}else this.$scope.effectivePermissions=this.sliceableFactory.fromArray();this.$scope.isLoadingEffectivePermissions=!1},r.prototype.updateGroupMembership=function(t){var r=this;t&&t.length>0?this.server.sendRequest(new e.ServerApi.GetUsersGroupMembershipRequest({userIds:t})).then(function(e){r.groupMembership={},_.each(e.members,function(e){var t=r.groupMembership[e.userId];t||(t={},r.groupMembership[e.userId]=t),t[e.groupId]=!0})}):this.groupMembership={}},r.prototype.isRelevantExplicitPermission=function(e){if(this.hoveredEffectivePermission&&!this.$scope.permissionRuleEditorParams.show){var t=this.hoveredEffectivePermission.user;if(t){if(!e.group)return e.user&&e.user.id===t.id;if(this.groupMembership){var r=this.groupMembership[t.id];return r&&_.has(r,e.group.id)}}}return!1},r.prototype.isNotRelevantExplicitPermission=function(e){return this.hoveredEffectivePermission&&!this.isRelevantExplicitPermission(e)},r.prototype.relevantCapabilityClass=function(t,r,n,i){if(!this.hoveredEffectivePermission||this.$scope.permissionRuleEditorParams.show)return"normal";if(t&&this.isRelevantExplicitPermission(t)){if(!this.hoveredCapabilityValue)return"normal";if(this.hoveredCapabilityValue===i){var o=e.PermissionsHelper.permissionFromIGranteePermission(this.hoveredEffectivePermission,r,n),s=e.PermissionsHelper.permissionFromIGranteePermission(t,r,n);if(o&&s)if(t.group)switch(s.permission){case e.Permission.Allowed:return e.PermissionReason.GroupAllow===o.reason?"relevant":"not";case e.Permission.Denied:return e.PermissionReason.GroupDeny===o.reason?"relevant":"not"}else if(t.user)switch(s.permission){case e.Permission.Allowed:return e.PermissionReason.UserAllow===o.reason?"relevant":"not";case e.Permission.Denied:return e.PermissionReason.UserDeny===o.reason?"relevant":"not"}}}return"not"},r.prototype.userStatusForRow=function(t,r){var n=e.PermissionReason.Unspecified,i=e.PermissionsHelper.permissionsFromIGranteePermission(t,r);switch(_.each(i,function(t){t.reason<e.PermissionReason.Mixed&&(n=Math.max(n,t.reason))}),n){case e.PermissionReason.UserAuthorizableOwnerAllow:return"owner";case e.PermissionReason.GroupProjectLeaderAllow:return"project_leader";case e.PermissionReason.UserProjectLeaderAllow:return"project_leader";case e.PermissionReason.UserProjectOwnerAllow:return"project_owner";case e.PermissionReason.UserAdminAllow:return"admin";default:return e.PermissionsHelper.effectiveGranteeRole(t,r,this.permissionRoles)}},r.$inject=["$scope","$element","$q","$timeout","$translate","PermissionsPanelActions","SliceableFactory","ServerService","ExplicitPermissions","EffectivePermissionsService","PermissionRoles","PermissionsEditabilityLogicFactory","BrowserSupportService","GranteePermissionsFactory"],r}();e.PermissionsPanelCtrl=r}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.PermissionRuleEditorCommands={add:"add",edit:"edit",delete_:"delete"};var t=function(){function t(){}return t.forAuthorizableType=function(t){return e.FeatureFlags.projectPermissionsTemplatesEnabled?t+"PermissionsEditor.html":t+"PermissionsEditorWithoutPermissionsTemplates.html"},t}(),r=function(){function r(r,n,i,o,s){var a=this;this.scope=r,this.explicitPermissions=n,this.permissionRoles=i,this.$translate=o,this.toaster=s,this.scope.explicitGranteeRole=function(t,r){return e.PermissionsHelper.explicitGranteeRole(t,r,a.permissionRoles)},this.scope.granteeType=e.PermissionsHelper.granteeType,this.scope.granteeName=e.PermissionsHelper.granteeName,this.scope.capabilityValue=e.PermissionsHelper.capabilityValue,this.scope.capabilityTitleKey=e.PermissionsHelper.capabilityTitleKey,this.scope.busy=!1,this.updateColumnWidths(),this.authorizableType=r.authorizables.type,this.scope.permissionsEditorTemplates=t.forAuthorizableType(r.authorizables.type),this.scope.data={row:null},this.initializeFromSelectedRow(),this.scope.resize=function(e){r.$apply(function(){r.columnWidths.resizer.continueResize(e)})}}return r.prototype.initializeFromSelectedRow=function(){var t=this;this.scope.data.row=this.deepCopy(this.scope.selectedRow),this.scope.selectedRoleByContentType={},e.FeatureFlags.projectPermissionsTemplatesEnabled?_.each(_.keys(this.scope.data.row.permissionsByContentType),function(r){return t.scope.selectedRoleByContentType[r]=e.PermissionsHelper.explicitGranteeRole(t.scope.data.row,r,t.permissionRoles)}):this.scope.selectedRoleByContentType[this.authorizableType]=e.PermissionsHelper.explicitGranteeRole(this.scope.data.row,this.authorizableType,this.permissionRoles)},r.prototype.getTooltipText=function(e){return $(e.target).closest(".tb-capability-value-cell").find(".tb-capability-value").attr("data-tooltip")},r.prototype.savePermissionRule=function(){var t=this,r=this.scope.data.row;this.scope.busy=!0;var n={},i={},o=_.clone(r);this.scope.action===e.PermissionRuleEditorCommands.delete_?e.FeatureFlags.projectPermissionsTemplatesEnabled?i=this.cloneAllPermissionsToUnspecified(r.permissionsByContentType):_.each(r.permissions,function(t,r){n[r]={permission:e.Permission.Unspecified,reason:e.PermissionReason.Unspecified}}):e.FeatureFlags.projectPermissionsTemplatesEnabled?_.each(r.permissionsByContentType,function(r,n){i[n]={},_.each(r,function(r,o){r.permission!==e.Permission.Mixed&&r.permission!==t.scope.selectedRow.permissionsByContentType[n][o].permission&&(i[n][o]=r)})}):_.each(r.permissions,function(r,i){r.permission!==e.Permission.Mixed&&r.permission!==t.scope.selectedRow.permissions[i].permission&&(n[i]=r)}),o.permissions=n,o.permissionsByContentType=i,this.explicitPermissions.setForAuthorizables(this.scope.authorizables,o).then(function(){return t.scope.updateAuthorizables()}).then(function(){t.scope.hideRowMenu(),t.toaster.pop({type:e.ToastType.Info,text:t.$translate.instant("permissionRuleChangedSuccess",{GRANTEE_NAME:e.L10n.elideIfLong(t.scope.granteeName(r))})})}).fin(function(){return t.scope.busy=!1})},r.prototype.cloneAllPermissionsToUnspecified=function(t){return _.reduce(t,function(t,r,n){return t[n]=_.reduce(r,function(t,r,n){return t[n]={permission:e.Permission.Unspecified,reason:e.PermissionReason.Unspecified},t},{}),t},{})},r.prototype.saveDisabled=function(){return!this.scope.isDeleteActionSelected()&&_.isEqual(this.scope.data.row,this.scope.selectedRow)},r.prototype.getCapabilitiesForRole=function(t){var r=this.permissionRoles.getPermissionsForTypeAndRole(this.authorizableType,t);return e.PermissionsHelper.IPermissionsFromPermissions(r)},r.prototype.getCapabilitiesForTypeAndRole=function(t,r){var n=this.permissionRoles.getPermissionsForTypeAndRole(t,r);return e.PermissionsHelper.IPermissionsFromPermissions(n)},r.prototype.updateColumnWidths=function(){var t=this;e.FeatureFlags.projectPermissionsTemplatesEnabled?this.scope.columnWidths=this.scope.permissionsPanelColumnWidths:this.scope.columnWidths={getActual:function(e){return 0===e?t.scope.permissionsPanelColumnWidths.getActual(0):1===e?t.scope.permissionsPanelColumnWidths.getActual(1)+t.scope.permissionsPanelColumnWidths.getActual(2)+t.scope.permissionsPanelColumnWidths.getActual(3):t.scope.permissionsPanelColumnWidths.getActual(e+2)}}},r.prototype.deepCopy=function(e){return jQuery.extend(!0,{},e)},r.$inject=["$scope","ExplicitPermissions","PermissionRoles","$translate","ToasterService"],r}();e.PermissionRuleEditorCtrl=r}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t){this.$translate=e,this.server=t}return t.prototype.getAll=function(){return this.server.sendRequest(new e.ServerApi.GetLanguagesRequest).then(function(e){return e.languages})},t.prototype.unspecifiedLanguage=function(){return{displayName:this.$translate.instant("unspecified"),language:null,locale:null}},t.$inject=["$translate","ServerService"],t}();e.Languages=t,e.Module.instance().service("Languages",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t){this.$translate=e,this.server=t}return t.prototype.getAll=function(){return this.server.sendRequest(new e.ServerApi.GetLocalesRequest).then(function(e){return e.locales})},t.prototype.unspecifiedLocale=function(){return{displayName:this.$translate.instant("unspecified"),locale:null}},t.$inject=["$translate","ServerService"],t}();e.Locales=t,e.Module.instance().service("Locales",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){void 0===t&&(t={}),e.call(this,"clearSavedPasswords",t)}return __extends(t,e),t}(e.Request);e.ClearSavedPasswordsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){void 0===t&&(t={}),e.call(this,"getLanguages",t)}return __extends(t,e),t}(e.Request);e.GetLanguagesRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){void 0===t&&(t={}),e.call(this,"getLocales",t)}return __extends(t,e),t}(e.Request);e.GetLocalesRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getServerSettings",t)}return __extends(t,e),t}(e.Request);e.GetServerSettingsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getTotalRefreshTokenCount",t);
}return __extends(t,e),t}(e.Request);e.GetTotalRefreshTokenCountRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){void 0===t&&(t={}),e.call(this,"resetServerSettings",t)}return __extends(t,e),t}(e.Request);e.ResetServerSettingsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){void 0===t&&(t={}),e.call(this,"runActiveDirectoryGroupsSyncTask",t)}return __extends(t,e),t}(e.Request);e.RunActiveDirectoryGroupsSyncRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){e.UpdateBooleanServerSettingNames={embeddedCredentialsEnabled:"embeddedCredentialsEnabled",schedulingEnabled:"schedulingEnabled",savedPasswordsEnabled:"savedPasswordsEnabled",savedAccessTokensEnabled:"savedAccessTokensEnabled",guestEnabled:"guestEnabled",scheduledActiveDirectorySyncEnabled:"scheduledActiveDirectorySyncEnabled",refreshTokensEnabled:"refreshTokensEnabled"};var t=function(e){function t(t){e.call(this,"updateBooleanServerSetting",t)}return __extends(t,e),t}(e.Request);e.UpdateBooleanServerSettingRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){e.UpdateScheduleFrequencyServerSettingName="activeDirectorySyncScheduleFrequency";var t=function(e){function t(t){e.call(this,"updateScheduleFrequencyServerSetting",t)}return __extends(t,e),t}(e.Request);e.UpdateScheduleFrequencyServerSettingRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"updateStringServerSetting",t)}return __extends(t,e),t}(e.Request);e.UpdateStringServerSettingRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n,i,o,s,a,c,l,u,d){var p=this;this.scope=t,this.$state=r,this.$q=n,this.$translate=i,this.server=o,this.ServerSettings=s,this.languages=a,this.locales=c,this.toasterService=l,this.confirmActionDialog=u,this.help=d,this.languageOrLocaleChanged=!1,this.scope.serverSettingsPending=!1,this.scope.server=this.server,this.scope.updateDefaultLanguage=function(e){return p.scope.serverSettings.defaultLanguage=e},this.scope.updateDefaultLocale=function(e){return p.scope.serverSettings.defaultLocale=e},this.scope.clearSavedCredentials=function(){return p.clearSavedCredentials()},this.scope.resetSettings=function(){return p.resetSettings()},this.scope.isScheduledADSyncAllowed=this.server.isServerDomainFamilyActiveDirectory(),this.scope.runActiveDirectoryGroupsSync=function(){return p.runActiveDirectoryGroupsSync()},this.scope.viewUpdateHref=r.href("main.server.analysis",{sheetUrlId:"BackgroundTasksforNonExtracts"}),this.scope.learnMoreHref=this.help.getServerHelpUrlByCategory("settings-adsync1"),this.scope.scheduleViewModel=e.CreateOrEditScheduleViewModelMapper.viewModelFromScheduleFrequency(this.scope.serverSettings.activeDirectorySyncScheduleFrequency),this.scope.serverSettingsFormState={save:function(){return p.save()},cancel:function(){p.scope.serverSettings=angular.copy(p.masterSettings),p.scope.scheduleViewModel=angular.copy(p.originalScheduleViewModel)},isBusy:function(){return p.scope.serverSettingsPending},isFormUnchanged:function(){return angular.equals(p.scope.serverSettings,p.masterSettings)&&angular.equals(p.scope.scheduleViewModel,p.originalScheduleViewModel)},resetSettings:function(){return p.scope.resetSettings()},onSave:function(){return p.hardReloadIfNeeded()}},this.masterSettings=angular.copy(this.scope.serverSettings),this.originalScheduleViewModel=angular.copy(this.scope.scheduleViewModel),this.getLanguages(),this.getLocales(),this.getTotalRefreshTokenCount()}return t.prototype.getLanguages=function(){var e=this;this.languages.getAll().then(function(t){e.scope.languages=t,e.scope.languageDisplayNames={},_.each(t,function(t){e.scope.languageDisplayNames[t.language]=t.displayName})})},t.prototype.getLocales=function(){var e=this;this.locales.getAll().then(function(t){e.scope.locales=t,e.scope.localeDisplayNames={},_.each(t,function(t){e.scope.localeDisplayNames[t.locale]=t.displayName})})},t.prototype.resetSettings=function(){var t=this;this.confirmActionDialog.open({title:this.$translate.instant("resetServerSettings"),bodyText:this.$translate.instant("resetServerSettingsConfirmMessage"),actionName:this.$translate.instant("resetServerSettingsConfirmButton"),isDeleteAction:!0,action:function(){return t.server.sendRequest(new e.ServerApi.ResetServerSettingsRequest).then(function(){return t.ServerSettings.fetch()}).then(function(e){t.scope.serverSettings=e,t.languageOrLocaleChanged=t.isLangOrLocaleChanged(),t.masterSettings=angular.copy(t.scope.serverSettings)}).then(function(){return t.hardReloadIfNeeded()})},errorMessage:this.$translate.instant("resetServerSettingsError")}).result.then(function(){return t.toasterService.pop({type:e.ToastType.Info,text:t.$translate.instant("resetServerSettingsSuccess")})})},t.prototype.getTotalRefreshTokenCount=function(){var t=this;this.server.sendRequest(new e.ServerApi.GetTotalRefreshTokenCountRequest({})).then(function(r){t.scope.totalRefreshTokenCount=r.refreshTokenCount,t.scope.refreshTokenUncheckedMessage=t.$translate.instant("serverConnectedDevicesUncheckedWithCount",{TOKEN_COUNT:t.scope.totalRefreshTokenCount},e.L10n.Interpolations.Count)})},t.prototype.clearSavedCredentials=function(){var t=this;this.confirmActionDialog.open({title:this.$translate.instant("clearSavedCredentials"),bodyText:this.$translate.instant("clearServerSavedCredentialsConfirmMessage"),actionName:this.$translate.instant("clearSavedCredentialsConfirmButton"),isDeleteAction:!0,action:function(){return t.server.sendRequest(new e.ServerApi.ClearSavedPasswordsRequest)},errorMessage:this.$translate.instant("clearSavedCredentialsError")}).result.then(function(){return t.toasterService.pop({type:e.ToastType.Info,text:t.$translate.instant("clearSavedCredentialsSuccess")})})},t.prototype.save=function(){var t=this;this.scope.serverSettingsPending=!0;var r=angular.copy(this.scope.serverSettings),n=e.ServerApi.UpdateBooleanServerSettingNames,i=this.ServerSettings.updateBoolean(n.embeddedCredentialsEnabled,r.embeddedCredentialsEnabled).then(function(){return r.embeddedCredentialsEnabled?t.ServerSettings.updateBoolean(n.schedulingEnabled,r.schedulingEnabled):void 0}),o=[i,this.ServerSettings.updateBoolean(n.savedPasswordsEnabled,r.savedPasswordsEnabled),this.ServerSettings.updateBoolean(n.savedAccessTokensEnabled,r.savedAccessTokensEnabled),this.ServerSettings.updateString("defaultLanguage",r.defaultLanguage),this.ServerSettings.updateString("defaultLocale",r.defaultLocale),this.ServerSettings.updateBoolean(n.refreshTokensEnabled,r.refreshTokenEnabled)];return o.push(this.ServerSettings.updateBoolean(n.scheduledActiveDirectorySyncEnabled,r.scheduledActiveDirectorySyncEnabled)),o.push(this.ServerSettings.updateScheduleFrequency(e.ServerApi.UpdateScheduleFrequencyServerSettingName,e.CreateOrEditScheduleViewModelMapper.scheduleFrequencyFromViewModel(this.scope.scheduleViewModel))),void 0!==r.guestEnabled&&o.push(this.ServerSettings.updateBoolean(n.guestEnabled,r.guestEnabled)),this.languageOrLocaleChanged=this.isLangOrLocaleChanged(),this.$q.all(o).then(function(){t.masterSettings=r,t.originalScheduleViewModel=angular.copy(t.scope.scheduleViewModel),r.refreshTokenEnabled||(t.scope.totalRefreshTokenCount=0)}).fail(function(e){return t.$q.reject(e)}).fin(function(){return t.scope.serverSettingsPending=!1})},t.prototype.runActiveDirectoryGroupsSync=function(){var t=this;this.confirmActionDialog.open({title:this.$translate.instant("activeDirectorySyncScheduleConfirmTitle"),bodyText:this.$translate.instant("activeDirectorySyncScheduleConfirmBody"),actionName:this.$translate.instant("activeDirectorySyncScheduleConfirmButton"),action:function(){return t.server.sendRequest(new e.ServerApi.RunActiveDirectoryGroupsSyncRequest)}}).result.then(function(r){e.ResultHelper.hasErrors(r)?t.toasterService.pop({type:e.ToastType.Error,text:t.$translate.instant("activeDirectorySyncScheduleRunNowError")}):t.toasterService.pop({type:e.ToastType.Info,text:t.$translate.instant("activeDirectorySyncScheduleRunNowSuccess")})})},t.prototype.isLangOrLocaleChanged=function(){var e=this.scope.serverSettings.defaultLanguage!==this.masterSettings.defaultLanguage,t=this.scope.serverSettings.defaultLocale!==this.masterSettings.defaultLocale;return e||t},t.prototype.hardReloadIfNeeded=function(){var e,t=this;return this.languageOrLocaleChanged&&(this.languageOrLocaleChanged=!1,e=this.server.refreshSessionInfo().then(function(){return t.$state.hardReload()})),this.$q.when(e)},t.$inject=["$scope","$state","$q","$translate","ServerService","ServerSettings","Languages","Locales","ToasterService","ConfirmActionDialog","HelpService"],t}();e.ServerSettingsFormCtrl=t,e.Module.instance().controller("ServerSettingsFormCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i,o,s,a){var c=this;this.scope=e,this.$location=t,this.$q=r,this.$translate=n,this.$state=i,this.sitesResource=o,this.toaster=s,this.scope.busy=!1,this.scope.clearInvalid=function(e){return c.clearInvalid(e)},this.scope.focusByName=function(e){a(function(){return angular.element('input[name="'+e+'"], textarea[name="'+e+'"]').focus()})},this.scope.siteSettingsForSiteAdminFormState=this.scope.siteSettingsForSiteAdminFormState||{},this.scope.siteSettingsForSiteAdminFormState.save=function(){return c.getSiteSettingsForSiteAdminUpdatePromise()},this.scope.siteSettingsForSiteAdminFormState.cancel=function(){return c.revertSettings()},this.scope.siteSettingsForSiteAdminFormState.isBusy=function(){return c.scope.busy},this.scope.siteSettingsForSiteAdminFormState.isFormUnchanged=function(){return angular.equals(c.master,c.scope.siteSettingsForSiteAdmin)},this.scope.siteSettingsForSiteAdminFormState.isValid=function(){return c.scope.siteSettingsForSiteAdminForm&&c.scope.siteSettingsForSiteAdminForm.$valid},this.master=angular.copy(this.scope.siteSettingsForSiteAdmin)}return t.prototype.clearInvalid=function(e){var t=this.scope.siteSettingsForSiteAdminForm[e];t.$invalid&&(t.$setViewValue(null),t.$render(),t.$setPristine(),_.each(_.keys(t.$error),function(e){return t.$setValidity(e,!0)}))},t.prototype.revertSettings=function(){this.scope.siteSettingsForSiteAdmin=angular.copy(this.master),_.each(this.scope.siteSettingsForSiteAdminForm.$error,function(e,t){e&&e[0].$setValidity(t,!0)})},t.prototype.getSiteSettingsForSiteAdminUpdatePromise=function(){var e=this,t=angular.copy(this.scope.siteSettingsForSiteAdmin);this.scope.busy=!0;var r=[];return this.sitesResource.updateSiteSettingsForSiteAdmin(t.id,t.siteAdminSettings).then(function(n){return n.errors&&n.errors.length?(r=r.concat(n.errors),e.updateFailure(r,t),e.$q.reject()):void e.updateSuccess(t)}).fin(function(){return e.scope.busy=!1})},t.prototype.updateSuccess=function(e){this.$state.includes("**.settings.**")&&(this.master=angular.copy(e))},t.prototype.updateFailure=function(t,r){var n=this;_.each(t,function(t){n.toaster.pop({type:e.ToastType.Error,text:n.sitesResource.errorMessage(t.code,r)})})},t.$inject=["$scope","$location","$q","$translate","$state","Sites","ToasterService","$timeout"],t}();e.SiteSettingsForSiteAdminFormCtrl=t,e.Module.instance().controller("SiteSettingsForSiteAdminFormCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(){}return e.INT={MIN:-2147483648,MAX:2147483647},e.LONG={MIN:-0x7ffffffffffffc00,MAX:0x7ffffffffffffc00},e}();e.NumberInputRange=t,e.Module.instance().directive("tbRangeInputValidator",function(){return{restrict:"A",require:"ngModel",link:function(e,t,r,n){var i=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/;n.$parsers.push(function(e){var t=i.test(e),o=r.min?parseFloat(r.min):-1*Number.MAX_VALUE,s=r.max?parseFloat(r.max):Number.MAX_VALUE;return e=parseFloat(e),n.$setValidity("max",!t||s>=e),n.$setValidity("min",!t||e>=o),t?e:void 0})}}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(){}return e.Chars="A-Za-z0-9-_",e.InvalidFind=new RegExp("[^"+e.Chars+"]","g"),e.InvalidTest=new RegExp("^["+e.Chars+"]+$"),e}();e.SiteIdValidRegExp=t,e.Module.instance().directive("tbSiteIdInputValidator",function(){return{restrict:"A",require:"ngModel",link:function(e,r,n,i){i.$parsers.push(function(e){return i.$setValidity("siteId",t.InvalidTest.test(e)),e})}}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n,i,o,s,a,c,l,u,d){var p=this;this.scope=t,this.$location=r,this.$q=n,this.$translate=i,this.$state=o,this.server=s,this.sitesResource=a,this.toaster=c,this.siteUrlMatcherFactory=l,this.licenses=u,this.scope.active=e.SiteAvailabilityState.ACTIVE,this.scope.suspended=e.SiteAvailabilityState.SUSPENDED,this.scope.defaultSubscriptionsEmail=this.server.defaultSubscriptionsEmail(),u.fetch().then(function(t){if(t){var r=!t.productKeyInfos||!t.productKeyInfos.length;p.scope.userCountMax=t.isCore||r?e.NumberInputRange.INT.MAX:t.totalSeatLicenses,p.scope.isSeatLicensing=t.isCore===!1}}),this.scope.storageQuotaMax=e.NumberInputRange.LONG.MAX/e.ByteSizeConversionFactor.ONE_GB,this.scope.server=this.server,this.scope.busy=!1,this.scope.save=function(){return p.save()},this.scope.cancel=function(){return p.cancel()},this.scope.clearInvalid=function(e){return p.clearInvalid(e)},this.scope.focusByName=function(e){d(function(){return angular.element('input[name="'+e+'"], textarea[name="'+e+'"]').focus()})},this.scope.isVersionHistoryAllowed=e.FeatureFlags.workbookVersionHistoryEnabled,this.scope.siteSettingsForServerAdminFormState=this.scope.siteSettingsForServerAdminFormState||{},this.scope.siteSettingsForServerAdminFormState.save=function(){return p.getSiteSettingsForServerAdminUpdatePromise()},this.scope.siteSettingsForServerAdminFormState.cancel=function(){return p.revertSettings()},this.scope.siteSettingsForServerAdminFormState.isBusy=function(){return p.scope.busy},this.scope.siteSettingsForServerAdminFormState.isFormUnchanged=function(){return angular.equals(p.master,p.scope.siteSettingsForServerAdmin)},this.scope.siteSettingsForServerAdminFormState.isValid=function(){return p.scope.siteSettingsForServerAdminForm&&p.scope.siteSettingsForServerAdminForm.$valid},this.scope.siteSettingsForServerAdmin.settings&&(this.scope.siteSettingsForServerAdmin.settings.userQuotaEnabled||(this.scope.siteSettingsForServerAdmin.settings.userQuota=null),this.scope.siteSettingsForServerAdmin.settings.storageQuotaEnabled||(this.scope.siteSettingsForServerAdmin.settings.storageQuotaBytes=null),this.scope.siteSettingsForServerAdmin.subscriptionSettings&&!this.scope.siteSettingsForServerAdmin.subscriptionSettings.customSubscriptionEmailEnabled&&(this.scope.siteSettingsForServerAdmin.subscriptionSettings.customSubscriptionEmail=angular.copy(this.scope.defaultSubscriptionsEmail))),this.master=angular.copy(this.scope.siteSettingsForServerAdmin),this.scope.siteSettingsForServerAdmin.settings&&""===this.scope.siteSettingsForServerAdmin.settings.urlName&&!this.scope.isDefaultSite&&(this.scope.unbindNameWatcher=this.scope.$watch("siteSettingsForServerAdmin.settings.name",function(t){p.scope.siteSettingsForServerAdmin.settings.urlName=_.isString(t)?t.replace(e.SiteIdValidRegExp.InvalidFind,""):""})),this.scope.$watch("siteSettingsForServerAdmin.settings.urlName",function(e){t.url=p.$location.absUrl().replace(p.$location.url(),"")+p.siteUrlMatcherFactory.compile("").format({siteUrlName:e})})}return t.prototype.clearInvalid=function(e){var t=this.scope.siteSettingsForServerAdminForm[e];t.$invalid&&(t.$setViewValue(null),t.$render(),t.$setPristine(),_.each(_.keys(t.$error),function(e){return t.$setValidity(e,!0)}))},t.prototype.revertSettings=function(){this.scope.siteSettingsForServerAdmin=angular.copy(this.master),_.each(this.scope.siteSettingsForServerAdminForm.$error,function(e,t){e&&e[0].$setValidity(t,!0)})},t.prototype.cancel=function(){this.revertSettings(),this.toaster.pop({type:e.ToastType.Info,text:this.$translate.instant("settingsReverted")})},t.prototype.save=function(){var t=this;this.getSiteSettingsForServerAdminUpdatePromise().then(function(){return t.toaster.pop({type:e.ToastType.Info,text:t.$translate.instant("settingsUpdateSuccess")})}).fail(function(r){return t.toaster.pop({type:e.ToastType.Error,text:t.$translate.instant("settingsUpdateFailure")})})},t.prototype.getSiteSettingsForServerAdminUpdatePromise=function(){var t=this,r=[],n=angular.copy(this.scope.siteSettingsForServerAdmin);return this.scope.busy=!0,r.push(this.sitesResource.updateSiteSettingsForServerAdmin(n.id,n.settings,n.subscriptionSettings)),n.availability!==this.master.availability&&(n.availability===e.SiteAvailabilityState.ACTIVE?r.push(this.sitesResource.activate([n.id])):r.push(this.sitesResource.suspend([n.id]))),this.$q.all(r).then(function(e){var r=[];return angular.forEach(e,function(e){e.errors&&e.errors.length&&(r=r.concat(e.errors))}),r.length?(t.updateFailure(r,n),t.$q.reject()):void t.updateSuccess(n)}).fin(function(){return t.scope.busy=!1})},t.prototype.updateSuccess=function(e){this.$state.includes("**.settings.**")&&(e.settings.name!==this.master.settings.name&&this.server.refreshSessionInfo(),""!==e.settings.urlName&&e.settings.urlName!==this.master.settings.urlName&&this.$state.go("main.site.settings.siteSettings",{siteUrlName:e.settings.urlName}),this.master=angular.copy(e))},t.prototype.updateFailure=function(t,r){var n=this;_.each(t,function(t){n.toaster.pop({type:e.ToastType.Error,text:n.sitesResource.errorMessage(t.code,r)})})},t.$inject=["$scope","$location","$q","$translate","$state","ServerService","Sites","ToasterService","SiteUrlMatcherFactory","LicensesService","$timeout"],t}();e.SiteSettingsForServerAdminFormCtrl=t,e.Module.instance().controller("SiteSettingsForServerAdminFormCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n,i){t.getButtonTitle=function(){return r.instant("siteWithSiteName",{SITE_NAME:e.L10n.elideIfLong(i.sessionSiteName())})},t.getSiteNamesAcrossAllPods=function(e){return n.sites(e)},t.siteSwitcher={chosenSiteName:null},t.isCurrentSiteName=function(e){return i.isCurrentSiteUrlName(e.urlName)},t.submitChangeSite=function(){var e=t.siteSwitcher.chosenSiteName;e&&t.siteSelected({urlName:e.urlName})}}return t.$inject=["$scope","$translate","SearchSuggestionsService","ServerService"],t}();e.SiteSwitcherCtrl=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(){}return e}();e.SiteUserDatasourcesSubplaceCtrl=t,e.Module.instance().controller("SiteUserDatasourcesSubplaceCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(){}return e}();e.SiteUserSubscriptionsSubplaceCtrl=t,e.Module.instance().controller("SiteUserSubscriptionsSubplaceCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(){}return e}();e.SiteUserViewsSubplaceCtrl=t,e.Module.instance().controller("SiteUserViewsSubplaceCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(){}return e}();e.SiteUserWorkbooksSubplaceCtrl=t,e.Module.instance().controller("SiteUserWorkbooksSubplaceCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){void 0===t&&(t={}),e.call(this,"deleteZiplog",t)}return __extends(t,e),t}(e.Request);e.DeleteZiplogRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){void 0===t&&(t={}),e.call(this,"getZiplogInfo",t)}return __extends(t,e),t}(e.Request);e.GetZiplogInfoRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){void 0===t&&(t={}),e.call(this,"getZiplogUri",t)}return __extends(t,e),t}(e.Request);e.GetZiplogUriRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"generateZiplog",t)}return __extends(t,e),t}(e.Request);e.GenerateZiplogRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(){}return e.NONE="none",e.INPROGRESS="inprogress",e.COMPLETE="complete",e}();e.ZiplogState=t;var r=function(){function r(e,t,r,n){this.server=e,this.$q=t,this.windowLocationService=r,this.pollService=n}return r.prototype.generate=function(t){var n=t!==r.ALL_DAYS?t-1:void 0;return this.server.sendRequest(new e.ServerApi.GenerateZiplogRequest({logsUpToDate:n})).then(angular.noop)},r.prototype.getInfo=function(){var r=this;if(this.ziplogInfo)return this.$q.when(this.ziplogInfo);if(this.ziplogPollPromise)return this.ziplogPollPromise;var n=function(e){return e.status===t.COMPLETE},i=this.pollService.poll(new e.ServerApi.GetZiplogInfoRequest({}),n);return this.cancelPoll=function(){return i.cancel()},this.ziplogPollPromise=i.promise.then(function(e){return r.ziplogPollPromise=null,r.ziplogInfoFromResult(e)}),this.ziplogPollPromise},r.prototype.getState=function(){var r=this;return this.server.sendRequest(new e.ServerApi.GetZiplogInfoRequest).then(function(e){return e.status===t.COMPLETE&&(r.ziplogInfo=r.ziplogInfoFromResult(e)),e.status})},r.prototype.remove=function(){var t=this;return this.server.sendRequest(new e.ServerApi.DeleteZiplogRequest).then(function(){t.ziplogInfo=null})},r.prototype.download=function(){var t=this;return this.server.sendRequest(new e.ServerApi.GetZiplogUriRequest).then(function(e){t.windowLocationService.download(e.data)})},r.prototype.stopPolling=function(){this.ziplogPollPromise&&(this.cancelPoll(),this.ziplogPollPromise=null)},r.prototype.ziplogInfoFromResult=function(t){var r={size:t.size,date:e.DateHelpers.fromISOString(t.date)};return r},r.$inject=["ServerService","$q","WindowLocationService","PollService"],r.ALL_DAYS=0,r}();e.ZiplogService=r,e.Module.instance().service("ZiplogService",r)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n,i){var o=this;this.$scope=t,this.$translate=r,this.ziplogService=n,this.ConfirmActionDialog=i,this.state=e.ZiplogState.NONE,n.getState().then(function(t){o.state=t,t!==e.ZiplogState.NONE&&o.getInfo()}),t.generate=function(){return o.confirmGenerateSnapshot()},t.remove=function(){o.state=e.ZiplogState.NONE,t.ziplog=null,n.remove()},t.download=function(){n.download()},t.isNoZiplog=function(){return o.state===e.ZiplogState.NONE},t.isZiplogGenerating=function(){return o.state===e.ZiplogState.INPROGRESS},t.isZiplogAvailable=function(){return o.state===e.ZiplogState.COMPLETE},t.$on("$destroy",function(){return n.stopPolling()})}return t.prototype.getInfo=function(){var t=this;this.ziplogService.getInfo().then(function(r){t.state=e.ZiplogState.COMPLETE,t.$scope.ziplog=r})},t.prototype.confirmGenerateSnapshot=function(){var r=this;this.$scope.confirmGenerateZiplogDialog={daysToGenerate:t.DefaultZiplogDaysToGenerate},this.ConfirmActionDialog.open({scope:this.$scope,title:this.$translate.instant("ziplog_newLogSnapshotDialog_title"),bodyTemplateUrl:"ziplogNewLogSnapshotDialog.html",actionName:this.$translate.instant("ziplog_newLogSnapshotDialog_confirm"),action:function(){r.state=e.ZiplogState.INPROGRESS,r.ziplogService.generate(r.$scope.confirmGenerateZiplogDialog.daysToGenerate).then(function(){return r.getInfo()})}})},t.DefaultZiplogDaysToGenerate=7,t.$inject=["$scope","$translate","ZiplogService","ConfirmActionDialog"],t}();e.ZiplogCtrl=t,e.Module.instance().controller("ZiplogCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=[{attrName:"tbChildClick",eventName:"click",digest:!0},{attrName:"tbChildMousedown",eventName:"mousedown",digest:!0},{attrName:"tbChildMouseenterTouchstart",eventName:"mouseenter touchstart",digest:!1},{attrName:"tbChildMouseleaveTouchmove",eventName:"mouseleave touchmove",digest:!1},{attrName:"tbChildMouseup",eventName:"mouseup",digest:!0},{attrName:"tbChildTouchend",eventName:"touchend",digest:!0}];_.each(t,function(t){e.Module.instance().directive(t.attrName,["$parse",function(e){return{link:function(r,n,i){var o=e(i[t.attrName]),s=i.tbChildSelector,a=(i.tbChildExclusionEvents||"").split(" "),c=_.contains(a,t.eventName)?i.tbChildExclusionSelector:"",l=t.digest,u=function(e){o(r,{child:$(e.target).closest(s),$event:e})};n.on(t.eventName,s,function(e){c&&$(e.target).filter(c).length||(l?r.$apply(function(){u(e)}):u(e))})}}}])})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){_.each(_.filter(e.Keys,_.isString),function(t){e.Module.instance().directive("tb"+t,[function(){return{link:function(r,n,i){n.bind("keydown",function(n){n.which===e.Keys[t]&&r.$apply(function(){r.$eval(i["tb"+t],{$event:n})})})}}}])})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=[{name:"tbBottom",style:"bottom"},{name:"tbHeight",style:"height"},{name:"tbLeft",style:"left"},{name:"tbLineHeight",style:"line-height"},{name:"tbMarginBottom",style:"margin-bottom"},{name:"tbMarginLeft",style:"margin-left"},{name:"tbMarginRight",style:"margin-right"},{name:"tbMarginTop",style:"margin-top"},{name:"tbMaxHeight",style:"max-height"},{name:"tbMinHeight",style:"min-height"},{name:"tbMaxWidth",style:"max-width"},{name:"tbMinWidth",style:"min-width"},{name:"tbRight",style:"right"},{name:"tbTop",style:"top"},{name:"tbWidth",style:"width"}];_.each(t,function(t){e.Module.instance().directive(t.name,function(){return{restrict:"A",link:function(e,r,n){e.$watch(n[t.name],function(e){r.css(t.style,_.isNumber(e)?e+"px":_.isUndefined(e)?null:e)})}}})})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(t){function r(t){var r=_.extend({},{watch:"props"},t);e.Module.instance().directive(r.name,["AngularContextFactory",function(e){return{restrict:"E",replace:!0,template:"<span></span>",scope:{props:"="},link:function(t,n,i){var o=e.create(t),s=function(){var e=_.extend({angularContext:o},t.props);React.render(r.componentFactory(e),n[0])};t.$watch(r.watch,s),t.$on("$destroy",function(){React.unmountComponentAtNode(n[0])})}}}])}t.create=r}(t=e.ReactDirectiveFactory||(e.ReactDirectiveFactory={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbAlertInfo",["$translate","Alerts","ExtractTasks",function(t,r,n){return{restrict:"E",replace:!0,templateUrl:"alertInfo.html",scope:{close:"&",type:"=",id:"="},link:function(i){i.editableFailure=function(t){return t!==e.AlertErrorCode.AlertOverlappingSchedules},i.getFailureType=function(r){switch(r){case e.AlertErrorCode.AlertSignInFailed:case e.AlertErrorCode.AlertRemoteSignInFailed:return t.instant("signInFailedUnknownReason");case e.AlertErrorCode.AlertExpiredPassword:case e.AlertErrorCode.AlertRemoteExpiredPassword:return t.instant("expiredPassword");case e.AlertErrorCode.AlertAccessTokenValidation:return t.instant("accessTokenValidation");case e.AlertErrorCode.AlertAuthConfiguration:return t.instant("authConfiguration");case e.AlertErrorCode.AlertConnectionFailure:case e.AlertErrorCode.AlertRemoteConnectionFailure:return t.instant("connectionFailure");case e.AlertErrorCode.AlertOverlappingSchedules:return t.instant("overlappingSchedules");case e.AlertErrorCode.AlertFullRefreshRequired:return t.instant("fullRefreshRequired");case e.AlertErrorCode.AlertConnectionlessFailure:return t.instant("connectionlessFailure");default:return t.instant("unknownFailure")}},i.tryAgainClick=function(e){e&&n.run([e])},i.isRemoteRefresh=function(t){return _.contains(e.AlertMenuCtrl.REMOTE_REFRESH_STATUS_CODES,t)},i.workbooksAffectedString=function(r){if(r){var n=r.length;if(1===n)return t.instant("outOfDateWithName",{NAME:e.L10n.elideIfLong(r[0].name)});if(n>1)return t.instant("outOfDateWorkbooksWithCount",{LIST_COUNT:n},e.L10n.Interpolations.Count)}return t.instant("outOfDateWorkbookNone")},r.getForType(i.type,i.id).then(function(e){e&&e.alerts&&e.alerts.length>0&&(i.alert=e.alerts[0])})}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbAlertMenu",function(){return{restrict:"E",replace:!0,templateUrl:"alertMenu.html",scope:{},controller:e.AlertMenuCtrl}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbAssignPermissionsToContents",["$translate","AssignPermissionsToContentsService","ConfirmActionDialog",function(t,r,n){return{restrict:"E",replace:!0,templateUrl:"assignPermissionsToContents.html",scope:{authorizableType:"=",authorizables:"="},link:function(i){function o(e){return _.reduce(i.authorizables.pluck(e),function(e,t){return e+t})}function s(r){switch(r){case e.ProjectContentType.name:return t.instant("assignPermissionsToContentsConfirmTitle");case e.WorkbookContentType.name:return t.instant("assignPermissionsToViewsConfirmTitle")}}function a(r,n){var s;return i.authorizableType===e.ProjectContentType.name?s=1===n?t.instant("assignPermissionsToContentsConfirmMessageSingleProject",{PROJECT_NAME:e.L10n.elideIfLong(i.authorizables.first().name),WORKBOOK_COUNT:o(e.OrderKeys.workbookCount),VIEW_COUNT:o(e.OrderKeys.viewCount),DATASOURCE_COUNT:o(e.OrderKeys.datasourceCount)},e.L10n.Interpolations.Count):t.instant("assignPermissionsToContentsConfirmMessageMultiProject",{PROJECT_COUNT:n,WORKBOOK_COUNT:o(e.OrderKeys.workbookCount),VIEW_COUNT:o(e.OrderKeys.viewCount),DATASOURCE_COUNT:o(e.OrderKeys.datasourceCount)},e.L10n.Interpolations.Count):i.authorizableType===e.WorkbookContentType.name&&(s=1===n?t.instant("assignPermissionsToContentsConfirmMessageSingleWorkbook",{WORKBOOK_NAME:e.L10n.elideIfLong(i.authorizables.first().name),VIEW_COUNT:o(e.OrderKeys.numSheets)},e.L10n.Interpolations.Count):t.instant("assignPermissionsToContentsConfirmMessageMultiWorkbook",{WORKBOOK_COUNT:n,VIEW_COUNT:o(e.OrderKeys.numSheets)},e.L10n.Interpolations.Count)),s}i.assignPermissionsToContentsPending=function(){return r.getAssignPermissionsToContentsPending()},i.assignPermissionsToContentsPercent=function(){return r.getAssignPermissionsToContentsPercent()},i.assignPermissionsToContentsButtonText=i.authorizableType===e.WorkbookContentType.name?t.instant("assignPermissionsToViews"):t.instant("assignPermissionsToContents"),i.assignPermissionsToContents=function(){n.open({title:s(i.authorizableType),bodyText:a(i.authorizableType,i.authorizables.keys().length),actionName:t.instant("assignPermissionsToContentsConfirmButton"),action:function(){var e={authorizables:{type:i.authorizableType,ids:i.authorizables.keys()}};r.assignPermissionsToContents(e)},errorMessage:t.instant("assignPermissionsToContentsError")})},i.canAssignPermissionsToContents=function(){return(i.authorizableType===e.ProjectContentType.name||i.authorizableType===e.WorkbookContentType.name)&&!e.FeatureFlags.projectControlledPermissionsEnabled},i.$on("$destroy",function(){return r.cancelPoll()})}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbAutoSelect",["$timeout",function(e){return{restrict:"A",link:function(t,r,n){var i=function(){return e(function(){return r.focus().select()})};n.tbAutoSelect?t.$watch(n.tbAutoSelect,function(e){e&&i()},!0):i()}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbBackgroundImage",function(){return{restrict:"A",link:function(e,t,r){e.$watch(r.tbBackgroundImage,function(e){t.css("background-image","url("+e+")")})}}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbButtonClick",["$parse",function(e){return{restrict:"A",link:function(t,r,n){var i=e(n.tbButtonClick);r.on("click",function(e){r.hasClass("tb-disabled")||t.$apply(function(){i(t,{$event:e})})})}}}])}(VizPortal||(VizPortal={}));
var VizPortal;!function(e){e.Module.instance().directive("tbButtonDown",["$parse",function(e){return{restrict:"A",link:function(t,r,n){var i=e(n.tbButtonDown);r.on("mousedown",function(e){t.$apply(function(){r.hasClass("tb-disabled")||i(t,{$event:e})})})}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbBytesInputConverter",function(){return{restrict:"A",require:"ngModel",link:function(t,r,n,i){i.$parsers.push(function(t){var r=t*e.ByteSizeConversionFactor.ONE_GB;return!isNaN(r)&&r>0&&_.isFinite(r)?(i.$setValidity("bytes",!0),r):(i.$setValidity("bytes",!1),0)}),i.$formatters.push(function(t){return!isNaN(t)&&t>0&&_.isFinite(t)?parseFloat((t/e.ByteSizeConversionFactor.ONE_GB).toFixed(3)):t})}}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbBulkImportResultsSummary",["$translate","UserActionResultCode",function(t,r){return{restrict:"E",replace:!0,scope:{results:"="},templateUrl:"bulkImportResultsSummary.html",link:function(n){function i(){if(n.results){n.usersSkippedMessage=t.instant("userActionBulkOperationNumberSkipped",{COUNT:n.results.skippedLineCount},e.L10n.Interpolations.Count),n.usersProcessedMessage=t.instant("userActionBulkOperationNumberProcessed",{COUNT:n.results.processedLineCount},e.L10n.Interpolations.Count);var r=o(n.results.results);n.successResults=s(r);var i=c(n.results.errors);n.errorResults=a(i)}}function o(e){var t={};return _.each(e,function(e){_.each(e.codes,function(r){t[r]?(t[r].usernames+=", "+e.username,++t[r].count):t[r]={code:r,usernames:e.username,count:1}})}),t}function s(e){return _.map(e,function(e){return _.extend(e,{message:r.toLocalizedResultMessage(e.code,e.count)})})}function a(e){return _.map(e,function(e){return _.extend(e,{message:r.toLocalizedErrorMessage(e.code,e.count)})})}function c(r){var n={};return _.each(r,function(r){r.username||(r.username=t.instant("userActionBulkOperationErrorLineNumber",{LINE_NUMBER:r.line},e.L10n.Interpolations.Count));var i=r.errorCode;n[i]?(n[i].usernames+=", "+r.username,++n[i].count):n[i]={code:i,usernames:r.username,count:1}}),n}n.$watch("results",function(){i()})}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t){this.$translate=e,this.toaster=t}return t.prototype.notify=function(t,r,n){if(t.errors&&t.errors.length>0){var i=this.errorMessageFor(t.errors[0],r);this.toaster.pop({type:e.ToastType.Error,text:i})}else{var o=this.$translate.instant("updateUserDisplayNameSuccess",{USER_NAME:e.L10n.elideIfLong(r),DISPLAY_NAME:e.L10n.elideIfLong(n)});this.toaster.pop({type:e.ToastType.Info,text:o})}},t.prototype.errorMessageFor=function(t,r){switch(t.code){case e.CommonErrorCode.SystemUserNotFound:return this.$translate.instant("errorSystemUserNotFound",{USER_NAME:e.L10n.elideIfLong(r)});default:return this.$translate.instant("errorUnknown")}},t.$inject=["$translate","ToasterService"],t}();e.UpdateUserDisplayNameNotification=t,e.Module.instance().service("UpdateUserDisplayNameNotification",t);var r=function(){function t(e,t){this.$translate=e,this.toaster=t}return t.prototype.notify=function(t,r,n){if(t.errors&&t.errors.length>0){var i=this.errorMessageFor(t.errors[0],r);this.toaster.pop({type:e.ToastType.Error,text:i})}else{var o=this.$translate.instant("updateUserEmailSuccess",{USER_NAME:e.L10n.elideIfLong(r),EMAIL:n});this.toaster.pop({type:e.ToastType.Info,text:o})}},t.prototype.errorMessageFor=function(t,r){switch(t.code){case e.CommonErrorCode.SystemUserNotFound:return this.$translate.instant("errorSystemUserNotFound",{USER_NAME:e.L10n.elideIfLong(r)});default:return this.$translate.instant("errorUnknown")}},t.$inject=["$translate","ToasterService"],t}();e.UpdateUserEmailNotification=r,e.Module.instance().service("UpdateUserEmailNotification",r);var n=function(){function t(e,t){this.$translate=e,this.toaster=t}return t.prototype.notify=function(t,r){if(t.errors&&t.errors.length>0){var n=this.errorMessageFor(t.errors[0],r);this.toaster.pop({type:e.ToastType.Error,text:n})}else{var i=this.$translate.instant("syncUserSuccess",{USER_NAME:e.L10n.elideIfLong(r)});this.toaster.pop({type:e.ToastType.Info,text:i})}},t.prototype.errorMessageFor=function(t,r){switch(t.code){case e.CommonErrorCode.SystemUserNotFound:return this.$translate.instant("errorSystemUserNotFound",{USER_NAME:e.L10n.elideIfLong(r)});default:return this.$translate.instant("errorUnknown")}},t.$inject=["$translate","ToasterService"],t}();e.SyncUserActionNotification=n,e.Module.instance().service("SyncUserActionNotification",n);var i=function(){function t(e,t){this.$translate=e,this.toaster=t}return t.prototype.notify=function(t,r){if(t.errors&&t.errors.length>0){var n=this.errorMessageFor(t.errors[0],r);this.toaster.pop({type:e.ToastType.Error,text:n})}else{var i=this.$translate.instant("changePasswordSuccess",{USER_NAME:e.L10n.elideIfLong(r)});this.toaster.pop({type:e.ToastType.Info,text:i})}},t.prototype.errorMessageFor=function(t,r){switch(t.code){case e.CommonErrorCode.SystemUserNotFound:return this.$translate.instant("errorSystemUserNotFound",{USER_NAME:e.L10n.elideIfLong(r)});case e.UserErrorCode.UserInvalidPassword:return this.$translate.instant("errorUserOldPasswordIncorrect");default:return this.$translate.instant("errorUnknown")}},t.$inject=["$translate","ToasterService"],t}();e.ChangePasswordNotification=i,e.Module.instance().service("ChangePasswordNotification",i);var o=function(){function t(e,t){this.$translate=e,this.toaster=t}return t.prototype.notify=function(t,r){if(t.errors&&t.errors.length>0){var n=this.errorMessageFor(t.errors[0],r);this.toaster.pop({type:e.ToastType.Error,text:n})}else{var i=this.$translate.instant("changeLanguageSuccess",{USER_NAME:e.L10n.elideIfLong(r)});this.toaster.pop({type:e.ToastType.Info,text:i})}},t.prototype.errorMessageFor=function(t,r){switch(t.code){case e.CommonErrorCode.SystemUserNotFound:return this.$translate.instant("errorSystemUserNotFound",{USER_NAME:e.L10n.elideIfLong(r)});default:return this.$translate.instant("errorUnknown")}},t.$inject=["$translate","ToasterService"],t}();e.ChangeLanguageNotification=o,e.Module.instance().service("ChangeLanguageNotification",o);var s=function(){function t(e,t){this.$translate=e,this.toaster=t}return t.prototype.notify=function(t,r){if(t.errors&&t.errors.length>0){var n=this.errorMessageFor(t.errors[0],r);this.toaster.pop({type:e.ToastType.Error,text:n})}else{var i=this.$translate.instant("changeLocaleSuccess",{USER_NAME:e.L10n.elideIfLong(r)});this.toaster.pop({type:e.ToastType.Info,text:i})}},t.prototype.errorMessageFor=function(t,r){switch(t.code){case e.CommonErrorCode.SystemUserNotFound:return this.$translate.instant("errorSystemUserNotFound",{USER_NAME:e.L10n.elideIfLong(r)});default:return this.$translate.instant("errorUnknown")}},t.$inject=["$translate","ToasterService"],t}();e.ChangeLocaleNotification=s,e.Module.instance().service("ChangeLocaleNotification",s)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbChangePassword",["ChangePasswordNotification","ServerService","UserSettings",function(e,t,r){return{restrict:"E",replace:!0,templateUrl:"changePassword.html",scope:{userId:"&",username:"&"},link:function(n){n.busy=!1,n.fields={currentPassword:"",confirmPassword:"",newPassword:""},n.editMode=!1,n.requireCurrentPassword=t.isSessionUserSelf(),n.clearAndCollapseFields=function(){n.fields.currentPassword="",n.fields.newPassword="",n.fields.confirmPassword="",n.editMode=!1},n.clearAndShowFields=function(){n.fields.currentPassword="",n.fields.newPassword="",n.fields.confirmPassword="",n.editMode=!0},n.save=function(){n.busy=!0;var t=n.fields.currentPassword,i=n.fields.newPassword,o=n.userId();return r.changeUserPassword(o,i,t).then(function(t){e.notify(t,n.username()),n.busy=!1,n.clearAndCollapseFields()})},n.disableSaveButton=function(){return n.passwordForm.$invalid||n.busy}}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(){}return e}();e.CheckboxGroupCtrl=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbCheckbox",[function(){return{restrict:"E",replace:!0,require:["?ngModel","^?tbCheckboxGroup"],templateUrl:"checkbox.html",scope:{checked:"&"},link:function(e,t,r,n){var i=n[0],o=n[1];if(i){var s=function(){return t.hasClass("tb-disabled")};e.checked=function(){return i.$viewValue},e.toggle=function(){s()||(i.$setViewValue(!i.$viewValue),i.$render())},o&&(o.toggle=e.toggle,o.disabled=s)}}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbCheckboxGroup",[function(){return{restrict:"E",transclude:!0,replace:!0,template:'<div class="tb-checkbox-group" ng-transclude></div>',controller:e.CheckboxGroupCtrl}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbCheckboxLabel",[function(){return{restrict:"E",transclude:!0,replace:!0,require:"^tbCheckboxGroup",templateUrl:"checkboxLabel.html",link:function(e,t,r,n){e.ctrl=n}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=5e4;e.Module.instance().directive("tbCreateTextarea",[function(){return{restrict:"E",replace:!0,templateUrl:"createTextarea.html",scope:{onBeforeSave:"&",maxCharacterLength:"=?"},link:function(e,r,n){e.busy=!1;r.find("textarea");e.maxCharacterLength||(e.maxCharacterLength=t),e.add=function(){0!==e.text.length&&(e.busy=!0,e.onBeforeSave({newText:e.text}).then(function(){e.text="",e.busy=!1,e.clickedInElement=!1},function(){e.busy=!1}))}}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbDataGrid",function(){return{restrict:"E",replace:!0,templateUrl:"dataGrid.html",scope:{headers:"=",cells:"=",items:"=",currentRowIndex:"=?",currentRowObject:"=?",columnWidths:"=?",alwaysHaveCurrentRow:"=",isRowSelected:"&",headerClicked:"&",rowClicked:"&",rowsClickable:"=",rowHeight:"=?",sliceChanged:"&",emptyTemplate:"=?",emptyTemplateModel:"=?"},controller:e.DataGridCtrl}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n,i){var o=this;this.$scope=t,this.$element=r,this.$timeout=n,t.layout=new e.ListLayout(t.rowHeight),t.keepColumnWidths||this.$element.css("visibility","hidden"),t.handleSliceChanged=function(e){var r=o.slice,n=r&&r.items.length>0;o.slice=e;var i=e&&e.items.length>0;if(t.empty=!i,t.emptyTemplateModel=t.emptyTemplateModel||{},o.ensureCurrentRowIndexInRange(),!t.keepColumnWidths&&!n)if(i)t.columnWidths&&t.columnWidths.resetActual&&(o.$element.css("visibility","hidden"),o.$scope.columnWidths.resetActual()),o.$timeout(function(){var e=_.map(o.$element.find(".tb-data-grid-body-column"),function(e){var t=e.getBoundingClientRect();return Math.ceil(t.right-t.left)});o.$scope.contentWidthsChanged({contentWidths:e,containerWidth:o.getGridWidth()}),o.$element.css("visibility","visible")});else{if(!r){for(var s=o.getGridWidth(),a=s,c=[],l=0,u=t.cells.length;u>l;l++){var d=t.cells[l],p=parseInt(d.attrs.defaultWidth,10);p>=0||(p=a/(u-l)),t.columnWidths&&t.columnWidths.getMin&&(p=Math.max(p,t.columnWidths.getMin(l))),c.push(p),a-=p}o.$scope.contentWidthsChanged({contentWidths:c,containerWidth:s})}o.$element.css("visibility","visible")}o.$scope.sliceChanged&&o.$scope.sliceChanged({newSlice:e}),o.updateCurrentRowObject()},t.colIndex=function(e){return parseInt(e.attr("data-col-index"),10)},t.rowIndex=function(e){return parseInt(e.attr("data-row-index"),10)},t.setHoverRow=function(e,r){o.hoverRow&&o.hoverRow.removeClass("tb-data-grid-hover-row"),o.hoverRow=e,o.hoverRow&&!i.isTouch()&&o.hoverRow.addClass("tb-data-grid-hover-row"),t.rowHovered(r)},t.isCurrentRowIndex=function(e){return t.currentRowIndex===o.slice.index+e},t.setActiveRow=function(e){if(o.clearActiveRow(),e&&t.rowsClickable){var r=t.rowIndex(e);t.currentRowIndex=o.slice.index+r,o.activeRow=o.getBackgroundRow(r).addClass("tb-data-grid-active-row")}},t.setActiveRowIfHoverRow=function(e){o.hoverRow&&t.setActiveRow(e)},t.clearActiveRow=function(){return o.clearActiveRow()},t.setHoverRowIndex=function(e,r){t.setHoverRow(o.getBackgroundRow(e),r)},t.getElementsOfSelectedRows=function(){var e=[];return _.each(o.slice.items,function(t,r){o.$scope.isRowSelected({row:t})&&e.push(r)}),o.getBackgroundRows(e)},t.$watch("currentRowIndex",function(){o.ensureCurrentRowIndexInRange(),t.currentRowIndex>=0&&t.scrollControls&&t.scrollControls.scrollIntoView(t.currentRowIndex),o.updateCurrentRowObject()})}return t.prototype.clearActiveRow=function(){this.activeRow&&(this.activeRow.removeClass("tb-data-grid-active-row"),this.activeRow=null)},t.prototype.ensureCurrentRowIndexInRange=function(){var e=this.$scope.currentRowIndex;this.slice&&_.isFinite(e)?(e=Math.min(Math.max(-1,e),this.slice.total-1),this.$scope.alwaysHaveCurrentRow&&(e=Math.max(0,e))):e=-1,this.$scope.currentRowIndex=e},t.prototype.getGridWidth=function(){var e=this.$element.find(".tb-data-grid-body-background").width(),t=parseInt(this.$element.find(".tb-data-grid-body-columns").css("margin-left"),10)||0;return e-t},t.prototype.getBackgroundRow=function(e){return this.$element.find(".tb-data-grid-row-background").eq(e)},t.prototype.getBackgroundRows=function(e){return this.$element.find(".tb-data-grid-row-background").filter(function(t){return _.indexOf(e,t,!0)>=0})},t.prototype.updateCurrentRowObject=function(){!this.slice||this.$scope.currentRowIndex<0?this.$scope.currentRowObject=null:this.$scope.currentRowObject=this.slice.items[this.$scope.currentRowIndex-this.slice.index]},t.$inject=["$scope","$element","$timeout","BrowserSupportService"],t}();e.DataGridBodyCtrl=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbDataGridBody",function(){return{restrict:"E",replace:!0,templateUrl:"dataGridBody.html",scope:{cells:"=",columnWidths:"=",contentWidthsChanged:"&",isRowSelected:"&",isRowSeparator:"&",rowClicked:"&",rowHovered:"&",rows:"=",rowsClickable:"=",rowHeight:"=?",currentRowIndex:"=?",sliceChanged:"&",getElementsOfSelectedRows:"=?",currentRowObject:"=?",alwaysHaveCurrentRow:"=",scrollControls:"=?",scrollLeftChanged:"&",emptyTemplate:"=?",emptyTemplateModel:"=?",keepColumnWidths:"="},controller:e.DataGridBodyCtrl}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbDataGridEditableRow",function(){return{restrict:"E",replace:!0,templateUrl:"dataGridEditableRow.html",scope:{cells:"=",data:"=",columnWidths:"=",willRowBeDeleted:"="}}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbDataGridHeaders",["$timeout",function(e){return{restrict:"E",replace:!0,templateUrl:"dataGridHeaders.html",scope:{columnWidths:"=",headerClicked:"&",headers:"=",headerWidthsChanged:"&"},link:function(t,r){t.resize=function(e){t.$apply(function(){t.columnWidths.resizer.continueResize(e)})},t.$watch("headers",function(n){n&&n.length>0&&e(function(){var e=_.map(r.find(".tb-data-grid-header"),function(e){var t=e.getBoundingClientRect();return Math.ceil(t.right-t.left)});t.headerWidthsChanged({headerWidths:e})})})}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e){this.otherMonth=!1,this.selected=!1,this.today=!1,this.day=e}return e.prototype.dayNumber=function(){return this.day.getDate()},e}();e.DayCell=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e){this.today=function(){return new Date},this.showMonth(e)}return t.prototype.setToday=function(e){this.today=function(){return e},this.updateDayCells()},t.prototype.showMonth=function(e){this.firstDayOfMonth=t.monthOf(e||this.today()),this.updateDayCells()},t.prototype.updateDayCells=function(){this.weeks=[];for(var t=e.L10n.firstDayOfWeek(),r=new Date(this.firstDayOfMonth.getFullYear(),this.firstDayOfMonth.getMonth(),1+t-this.firstDayOfMonth.getDay()),n=0;6>n;n++){for(var i=[],o=0;7>o;o++){var s=new e.DayCell(r);s.otherMonth=r.getMonth()!==this.firstDayOfMonth.getMonth(),s.selected=this.isSelected(r),s.today=this.isToday(r),i.push(s),r=new Date(r.getFullYear(),r.getMonth(),r.getDate()+1)}this.weeks.push(i)}},t.monthOf=function(e){return new Date(e.getFullYear(),e.getMonth(),1)},t.isSameDay=function(e,t){return e.getDate()===t.getDate()&&e.getMonth()===t.getMonth()&&e.getFullYear()===t.getFullYear()},t.prototype.isToday=function(e){return t.isSameDay(this.today(),e)},t.prototype.isSelected=function(e){return this.selectedDate&&t.isSameDay(this.selectedDate,e)},t.prototype.select=function(e){this.selectedDate=e,this.showMonth(e)},t.prototype.header=function(){return e.L10n.yearAndMonth(this.firstDayOfMonth)},t.prototype.dayNames=function(){return e.L10n.narrowDayNames()},t.prototype.getWeeks=function(){return this.weeks},t.prototype.showNext=function(){this.firstDayOfMonth=new Date(this.firstDayOfMonth.getFullYear(),this.firstDayOfMonth.getMonth()+1,1),this.updateDayCells()},t.prototype.showPrevious=function(){this.firstDayOfMonth=new Date(this.firstDayOfMonth.getFullYear(),this.firstDayOfMonth.getMonth()-1,1),this.updateDayCells()},t}();e.Calendar=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbDatePicker",[function(){return{restrict:"E",replace:!0,templateUrl:"datePicker.html",scope:{selectedDate:"=",showToday:"@",onSelect:"&"},link:function(t){t.calendar=new e.Calendar(t.selectedDate),t.prevMonth=function(){t.calendar.showPrevious()},t.nextMonth=function(){t.calendar.showNext()},t.select=function(e){t.selectedDate=e,t.onSelect&&t.onSelect()},t.$watch("selectedDate",function(e){t.calendar.select(e)})}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbDaysPicker",[function(){return{restrict:"E",replace:!0,templateUrl:"daysPicker.html",require:"ngModel",scope:{},link:function(t,r,n,i){function o(){return s.length>0}t.dayNames=[e.ServerApi.ScheduleDaysOfTheWeek.Sun,e.ServerApi.ScheduleDaysOfTheWeek.Mon,e.ServerApi.ScheduleDaysOfTheWeek.Tue,e.ServerApi.ScheduleDaysOfTheWeek.Wed,e.ServerApi.ScheduleDaysOfTheWeek.Thu,e.ServerApi.ScheduleDaysOfTheWeek.Fri,e.ServerApi.ScheduleDaysOfTheWeek.Sat];var s=[];t.toggleDay=function(e){var t=s.indexOf(e);t>=0?s.splice(t,1):s.push(e),i.$setViewValue(s),i.$render()},t.isSelected=function(e){return s.indexOf(e)>=0},i.$render=function(){s=i.$viewValue||[],i.$setValidity("daysPicker",o())}}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbDisabled",[function(){return{restrict:"A",link:function(e,t,r){var n=t.attr("tabindex"),i="-1"!==n;e.$watch(r.tbDisabled,function(e){var e=!!e;t.toggleClass("tb-disabled",e),t.prop("disabled",e),i&&(e?t.removeAttr("tabindex"):t.attr("tabindex",n))})}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbDisableSelection",[function(){return{restrict:"C",link:function(e,t){navigator.userAgent.match(/msie/i)&&t.on("selectstart dragstart",function(e){var t=$(e.target).closest(".tb-enable-selection, .tb-disable-selection");t.hasClass("tb-enable-selection")||e.preventDefault()})}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbEditableCapabilityValue",function(){return{scope:{tbEditableCapabilityValue:"="},link:function(t,r){function n(){switch(t.tbEditableCapabilityValue.permission){case e.Permission.Unspecified:return e.Permission.Allowed;case e.Permission.Allowed:return e.Permission.Denied;case e.Permission.Denied:return e.Permission.Unspecified;case e.Permission.Mixed:return e.Permission.Allowed}}r.click(function(){t.$apply(function(){t.tbEditableCapabilityValue.permission=n()})})}}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbEditableTags",["$state","$location",function(t,r){return{restrict:"E",replace:!0,templateUrl:"editableTags.html",scope:{onBeforeSave:"&"},require:"ngModel",link:function(n,i,o,s){s.$render=function(){n.tagsWithCounts=_.map(s.$modelValue,function(e){return{name:e}})},o.$observe("readonly",function(e){n.readonly=!!e,i.toggleClass("tb-readonly",n.readonly)}),n.filterByTag=function(n){var i=t.href(o.tagFilterState).slice(1);r.url(i).search("tag",e.TagsHelper.unquote(n))},n.edit=function(){n.editMode=!0,n.busy=!1,n.newTag=""},n.save=function(){n.busy=!0;var t=_.map(n.tagsWithCounts,function(e){return e.name});n.newTag&&(t=_.union(t,[e.TagsHelper.quote(n.newTag)])),n.onBeforeSave({newTags:t}).then(function(){s.$setViewValue(t),s.$render(),n.editMode=!1,n.busy=!1,n.newTag=""},function(){n.busy=!1})},n.cancel=function(){n.editMode=!1,n.busy=!1,n.newTag="",s.$render()},o.buttonContainer&&i.find(".tb-editable-tags-input-buttons").appendTo($(o.buttonContainer)),n.displayTagHtml=e.TagsHelper.displayTagHtml}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbEditableText",["$timeout",function(t){return{restrict:"E",replace:!0,templateUrl:"editableText.html",scope:{onBeforeSave:"&",editButtonText:"@",maxlength:"@"},require:"ngModel",link:function(r,n,i,o){var s=n.find(".tb-edit-text-input");o.$render=function(){r.modelValue=o.$modelValue,r.viewValue=o.$modelValue},i.$observe("readonly",function(e){r.readonly=!!e,n.toggleClass("tb-readonly",r.readonly)}),r.$watch(function(){return r.viewValue},function(e){_.forEach(o.$parsers,function(t){return t(e)}),r.invalid=o.$invalid}),r.editable=!1;var a=function(){r.editMode=!1,r.busy=!1};a(),r.edit=function(){r.readonly||(r.editMode=!0,r.busy=!1)},r.save=function(){var e=r.viewValue;r.busy=!0,r.onBeforeSave({newText:e}).then(function(){o.$setViewValue(e),o.$render(),a()},function(){r.busy=!1,t(function(){return s.focus()})})},r.cancel=function(){o.$render(),r.editMode=!1},s.on("keydown",function(t){switch(t.which){case e.Keys.Enter:r.$apply(function(){return r.save()});break;case e.Keys.Escape:r.$apply(function(){return r.cancel()})}})}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=5e4,r="view",n="edit",i="preview";e.Module.instance().directive("tbEditableTextarea",["$timeout",function(o){return{restrict:"E",replace:!0,templateUrl:"editableTextarea.html",scope:{onBeforeSave:"&",disableEditButton:"=?",maxCharacterLength:"=?",disablePreviewMode:"=?",mode:"=?"},require:"ngModel",link:function(s,a,c,l){if(c.$observe("readonly",function(e){s.readonly=!!e,a.toggleClass("tb-readonly",s.readonly)}),c.buttonContainer){var u=a.find(".tb-editable-textarea-buttons");u.appendTo($(c.buttonContainer))}s.maxCharacterLength||(s.maxCharacterLength=t),s.mode=r;var d=a.find("textarea");s.busy=!1,l.$render=function(){s.text=l.$viewValue},s.edit=function(){s.readonly||(s.mode===r&&(s.text=l.$viewValue),s.mode=n,o(function(){return d.focus()}))},s.preview=function(){s.mode=i},s.save=function(){s.busy=!0;var e=s.text;s.onBeforeSave({newText:s.text}).then(function(){l.$setViewValue(e),s.mode=r,s.busy=!1},function(){s.busy=!1})},s.cancel=function(){s.text=l.$viewValue,s.mode=r},d.on("keydown",function(t){switch(t.which){case e.Keys.Enter:t.ctrlKey&&s.$apply(function(){return s.save()});break;case e.Keys.Escape:s.$apply(function(){return s.cancel()})}})}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbEditDisplayName",["UpdateUserDisplayNameNotification","UserSettings",function(e,t){return{restrict:"E",replace:!0,templateUrl:"editDisplayName.html",scope:{displayName:"@",controls:"=?"},link:function(r){r.busy=!1,r.originalDisplayName=r.displayName,r.controls={submit:function(n,i){r.busy=!0;var o=r.displayName;return t.updateUserDisplayName(n,o).then(function(t){e.notify(t,i,o),r.busy=!1})},isBusy:function(){return r.busy},isDirty:function(){return r.displayName!==r.originalDisplayName},isValid:function(){return!r.displayNameForm.$invalid}}}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbEditEmail",["UpdateUserEmailNotification","UserSettings",function(e,t){return{restrict:"E",replace:!0,templateUrl:"editEmail.html",scope:{email:"@",controls:"=?",delayUpdateEmailRequest:"@"},link:function(r){r.busy=!1,r.originalEmail=r.email,r.controls={submit:function(n,i){r.busy=!0;var o=r.email;return r.delayUpdateEmailRequest?t.updateUserEmailAndDelay(n,o).then(function(t){return e.notify(t,i,o),r.busy=!1,o}):t.updateUserEmail(n,o).then(function(t){return e.notify(t,i,o),r.busy=!1,o})},isBusy:function(){return r.busy},isDirty:function(){return r.email!==r.originalEmail},isValid:function(){return!r.emailForm.$invalid}}}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbEditLanguageAndLocale",["$q","$state","ChangeLanguageNotification","ChangeLocaleNotification","Languages","Locales","UserSettings","ServerService",function(e,t,r,n,i,o,s,a){return{restrict:"E",replace:"true",templateUrl:"editLanguageAndLocale.html",scope:{controls:"=?",serverUser:"=",language:"=?",locale:"=?"},link:function(c){var l=i.unspecifiedLanguage(),u=o.unspecifiedLocale(),d=function(){c.language||(c.language=l.language)},p=function(){c.locale||(c.locale=u.locale)};d(),p(),c.$watch("language",function(){d()}),c.$watch("locale",function(){p()}),c.model={language:c.language,locale:c.locale},i.getAll().then(function(e){e.unshift(l),c.languages=e}),o.getAll().then(function(e){e.unshift(u),c.locales=e});var h=!1,f=function(){return m()||v()},m=function(){return c.model.language!==c.language},v=function(){return c.model.locale!==c.locale},S=function(){return a.sessionUsername()===c.serverUser.username&&a.sessionUserDomainName()===c.serverUser.domainName},g=function(e){e.then(function(e){e&&r.notify(e,c.serverUser.username)})},y=function(e){e.then(function(e){e&&n.notify(e,c.serverUser.username)})};c.controls={save:function(){h=!0;var r=m()?s.updateUserLanguage(c.serverUser.id,c.model.language):e.when(!1),n=v()?s.updateUserLocale(c.serverUser.id,c.model.locale):e.when(!1);e.all([r,n]).then(function(){c.language=c.model.language,c.locale=c.model.locale,h=!1,S()?a.refreshSessionInfo().then(function(){t.hardReload(),g(r),y(n)}):(g(r),y(n))})},canSave:function(){return f()&&!h},isBusy:function(){return h}}}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbEmailInputValidator",["$timeout",function(t){var r,n=350;return{restrict:"A",require:"ngModel",link:function(i,o,s,a){a.$parsers.push(function(i){var o=!i||e.EmailValidationHelper.isValidEmail(i);return o?(t.cancel(r),a.$setValidity("email",!0)):r=t(function(){return a.$setValidity("email",!1)},n),i})}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbEmbeddedPassword",["$timeout",function(t){return{restrict:"E",replace:!0,templateUrl:"embeddedPassword.html",scope:{},require:"ngModel",link:function(r,n,i,o){function s(){o.$setViewValue({isEmbedded:r.password.isEmbedded,newPassword:r.password.isEmbedded&&a?r.password.newPassword:e.PasswordUnchanged})}r.passwordRequired=!_.isUndefined(i.tbEmbeddedPasswordRequired),r.password={isEmbedded:void 0,newPassword:""};var a=void 0;o.$render=function(){r.password.isEmbedded=o.$modelValue.isEmbedded,_.isUndefined(a)&&(a=!r.password.isEmbedded),r.passwordRequired&&(r.password.isEmbedded=!0)},r.inPasswordEditMode=function(){return a},r.editPassword=function(){a=!0,s()},r.focusPasswordBox=function(){t(function(){return n.find(".tb-text-box-input").focus()})},r.$watch("[password.isEmbedded, password.newPassword]",function(){return s()},!0)}}}])}(VizPortal||(VizPortal={}));var VizPortalReact;!function(e){var t;!function(e){function t(e){function t(o){e.getSlice(o,n).then(function(e){i=i.concat(e.items),i.length<e.total?t(o+n):r.resolve(i)})}var r=Q.defer(),n=1e3,i=[];return t(0),r.promise}e.getAll=t}(t=e.StoreHelpers||(e.StoreHelpers={}))}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(){function t(e){this.favorites=e}return t.prototype.getAll=function(){return e.StoreHelpers.getAll(this.favorites.all())},t}();e.FavoritesStore=t}(VizPortalReact||(VizPortalReact={}));var VizPortal;!function(e){e.Module.instance().directive("tbFavoritesMenu",["$translate","Favorites",function(t,r){return e.FeatureFlags.reactFavoritesMenu?{restrict:"E",replace:!0,scope:{},link:function(e){e.props={translate:t.instant,favoritesStore:new VizPortalReact.FavoritesStore(r)}},template:'<span><tb:react-favorites-menu props="props" /></span>'}:{restrict:"E",replace:!0,scope:{},controller:e.FavoritesMenuCtrl,templateUrl:"favoritesMenu.html"}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbFavoriteToggle",[function(){return{restrict:"E",replace:!0,templateUrl:"favoriteToggle.html",scope:{onAdd:"&",onRemove:"&"},require:"ngModel",link:function(e,t,r,n){e.selected=function(){return n.$viewValue},e.toggle=function(t){t.stopPropagation(),n.$viewValue?e.onRemove():e.onAdd(),n.$setViewValue(!n.$viewValue)}}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbIfFeatureFlag",[function(){return{link:function(t,r,n){var i="!"===n.tbIfFeatureFlag.charAt(0),o=e.FeatureFlags[n.tbIfFeatureFlag.replace("!","")]||!1,s=o===i;s&&r.replaceWith("<!-- Element hidden with flag check: "+n.tbIfFeatureFlag+" -->")}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbFileDrop",["$parse","$timeout",function(e,t){var r="tb-file-drop-dragging";return{restrict:"A",link:function(n,i,o){var s,a=e(o.tbFileDrop),c=".tbFileDrop"+n.$id,l=angular.element(document),u=function(e,t){var r=e.originalEvent;r&&r.dataTransfer&&(r.dataTransfer.dropEffect=t)};l.on("dragenter"+c+" dragover"+c,function(e){e.stopPropagation(),e.preventDefault(),$(e.target).closest(i).length?(t.cancel(s),i.addClass(r),u(e,"copy")):u(e,"none")}),i.on("dragleave dragend",function(e){e.stopPropagation(),e.preventDefault(),t.cancel(s),s=t(function(){i.removeClass(r)},20,!1)}),l.on("drop"+c,function(e){e.stopPropagation(),e.preventDefault(),$(e.target).closest(i).length&&(t.cancel(s),i.removeClass(r),n.$apply(function(){var t=e.originalEvent;t&&t.dataTransfer&&t.dataTransfer.files&&t.dataTransfer.files[0]&&a(n,{file:t.dataTransfer.files[0]})}))}),i.on("$destroy",function(){l.off(c)})}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=0;e.Module.instance().directive("tbFileInput",[function(){return{restrict:"E",scope:{name:"@",filenameLocalizationKey:"@"},replace:!0,templateUrl:"fileInput.html",link:function(e,r,n){e.required=!!n.required,e.fileUploadId="file-upload-"+t++;var i=r.find('input[type="file"]');i.change(function(){return e.$evalAsync(function(){e.filename=i.val().split("\\").pop()})})}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t){this.ActiveRowColumnWidth=e.FeatureFlags.useUpdatedFontStyles?20:18,this.IconColumnWidth=26,this.widths=[],t.showActiveRow&&this.widths.push(this.ActiveRowColumnWidth),t.showIcons&&this.widths.push(this.IconColumnWidth),this.withCounts=t.withCounts}return t.prototype.getActual=function(e){return this.widths[e]},t.prototype.setWidths=function(e,t){var r=_.reduce(this.widths,function(e,t){return e+t},0),n=this.withCounts?_.last(e):0;r+=n,this.widths.push(t-r,n)},t}();e.Module.instance().directive("tbFilteringListBox",["$parse","$timeout","$translate",function(r,n,i){return{restrict:"E",templateUrl:"filteringListBox.html",replace:!0,scope:{model:"=",onItemClicked:"&"},link:{pre:function(t,n,o){t.matchPrefixesOnly="true"===o.matchPrefixesOnly,t.showActiveRow="true"===o.indicateActiveRow,t.showIcons=!!o.itemIcon,t.placeholderText=o.placeholderText||i.instant("search"),t.getSliceableSource=r(o.source)(t.$parent),t.isActiveRow=r(o.isActiveRow)(t.$parent),t.isRowSeparator=r(o.isRowSeparator)(t.$parent),t.getItemText=function(e){return""+(o.itemText?e[o.itemText]:e)},t.getItemIcon=function(e){return e[o.itemIcon]},o.tbTestId&&(t.textBoxTestId=o.tbTestId+"-textbox"),t.withCounts="true"===o.withCounts,t.rowHeight=e.FeatureFlags.useTallerRowHeight?28:23},post:function(r,i){r.currentRow={index:0},r.rowClicked=function(e){
r.onItemClicked&&r.onItemClicked({item:e}),n(function(){return i.find("input").focus()})},r.columnWidths=new t(r),r.$watch("currentRow.object",function(e){void 0!==e&&(r.model=e)}),r.$watch("textInput",function(e){r.items=r.getSliceableSource(e||""),e&&-1===r.currentRow.index&&(r.currentRow.index=0)}),r.handleKeyEvent=function(t){switch(t.which){case e.Keys.ArrowDown:t.preventDefault(),r.currentRow.index++;break;case e.Keys.ArrowUp:t.preventDefault(),r.currentRow.index>0&&r.currentRow.index--}}}}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbFocus",["$timeout","BrowserSupportService",function(t,r){return{restrict:"A",link:function(e,n,i,o){r.isTouch()||("tb-focus"===i.tbFocus&&(i.tbFocus="true"),o.hasFocusElement()||o.setFocusElement(n),e.$watch(i.tbFocus,function(e){e&&t(function(){return o.focus()})}))},controller:e.FocusCtrl}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbFormattingHints",function(){return{restrict:"E",replace:!0,scope:{},templateUrl:"formattingHints.html",link:function(e){}}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbHelpMenu",[function(){return{restrict:"E",replace:!0,scope:{},controller:e.HelpMenuCtrl,templateUrl:"helpMenu.html"}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbHidden",[function(){return{restrict:"A",link:function(e,t,r){e.$watch(r.tbHidden,function(e){var e=!!e;t.toggleClass("tb-hidden",e)})}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbIntegerInputValidator",function(){return{restrict:"A",require:"ngModel",link:function(e,t,r,n){var i=/^\-?\d+$/;n.$parsers.push(function(e){return n.$setValidity("integer",i.test(e)),e})}}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbLockUnlockProjectPermissions",["$translate","ConfirmActionDialog","SetProjectControlledPermissionsAction",function(t,r,n){return{restrict:"E",replace:!0,templateUrl:"lockUnlockProjectPermissions.html",scope:{authorizableType:"=",authorizables:"=",editable:"=",editabilityShortMessage:"=",editabilityLongMessage:"=",lockState:"="},link:function(i){function o(t){var r=_.first(t)===e.LockUnlockProjectPermissionsState.Locked;i.authorizables.each(function(e){e.controlledPermissionsEnabled!==r&&(e.controlledPermissionsEnabled=r)})}function s(){return i.authorizables}var a=s();i.canLockProjectPermissions=function(){return i.editable&&i.authorizableType===e.ProjectContentType.name},i.isChangeSourceLocked=function(){return i.lockState!==e.LockUnlockProjectPermissionsState.Locked&&e.LockStatusHelper.getCombinedStatusOfAllItems(i.permissionChangeSource.sources)===e.LockUnlockProjectPermissionsState.Locked},i.getLockIconClass=function(){return e.LockStatusHelper.getWhiteLockIconClass(i.lockState)},i.buttonText=function(){return t.instant(e.LockStatusHelper.getLockButtonText(i.lockState))},i.percentComplete=0,i.permissionState=e.LockUnlockProjectPermissionsState,i.FeatureFlagProjectControlledPermissionsEnabled=e.FeatureFlags.projectControlledPermissionsEnabled,i.permissionsDialogMessage=t.instant("lockProjectPermissions_dialogMessage",{PROJECT_COUNT:a.size(),PROJECT_NAME:e.L10n.elideIfLong(a.first().name)},e.L10n.Interpolations.Count),i.warningMessage=t.instant("lockProjectPermissionsWarningMessage",{PROJECT_COUNT:a.size()},e.L10n.Interpolations.Count),i.showConfirmationDialog=function(){i.permissionChangeSource={sources:e.LockStatusHelper.getLockStatusOfAllProjects(a)},r.open({title:t.instant("lockProjectPermissions_dialogTitle"),bodyTemplateUrl:"lockUnlockProjectPermissionsDialog.html",scope:i,position:{reserveHeight:450},actionName:t.instant("save"),action:function(){n.execute(a,i.permissionChangeSource.sources,i).then(function(t){e.ResultHelper.hasErrors(t)||(o(i.permissionChangeSource.sources),i.lockState=e.LockStatusHelper.getLockState(a))})},confirmDisabled:function(){var t=e.LockStatusHelper.getCombinedStatusOfAllItems(i.permissionChangeSource.sources);return t===e.LockUnlockProjectPermissionsState.Mixed||t===i.lockState},errorMessage:t.instant("lockProjectPermissionsError")})}}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbSigningIn",["$interval",function(e){return{restrict:"E",replace:!0,scope:{},templateUrl:"signingIn.html",link:function(t,r,n){t.showSigningIn=!1,e(function(){return t.showSigningIn=!0},1e3,1)}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbMatchingInputsValidator",function(){return{restrict:"A",require:"ngModel",scope:{match:"="},link:function(e,t,r,n){e.$watch(function(){return r.matchData===n.$modelValue},function(e){n.$setValidity("match",e)})}}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbModeSwitcher",["$location",function(e){return{restrict:"E",replace:!0,templateUrl:"modeSwitcher.html",scope:{displayMode:"="}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbMouseCapture",["$parse",function(e){return{link:function(t,r,n){var i=".tbMouseCapture",o=e(n.tbMouseCapture),s=e(n.tbMouseCaptureDown),a=e(n.tbMouseCaptureUp),c=angular.element(document);r.on("mousedown"+i,function(e){var r=angular.element("<div>").addClass("tb-fill").appendTo(document.body);t.$apply(function(){s(t,{$event:e})}),c.on("mousemove"+i,function(e){o(t,{$event:e})}),c.on("mouseup"+i,function(e){r.remove(),c.off(i),t.$apply(function(){a(t,{$event:e})})})})}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbMousedownOutside",["$parse",function(e){return{link:function(t,r,n){var i=".tbMousedownOutside"+t.$id,o=e(n.tbMousedownOutside),s=angular.element(document),a="mousedown"+i+" touchstart"+i;s.on(a,function(e){var n=$(e.target);0===n.closest(r).length&&t.$apply(function(){o(t,{$event:e})})}),r.on("$destroy",function(){s.off(i)})}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbMouseTrack",["$parse",function(e){return{link:function(t,r,n){var i=".tbMouseTrack",o=e(n.tbMouseTrack),s=e(n.tbMouseTrackEnter),a=e(n.tbMouseTrackLeave);r.on("mouseenter"+i,function(e){s(t,{$event:e}),r.on("mousemove"+i,function(e){o(t,{$event:e})})}),r.on("mouseleave"+i,function(e){r.off("mousemove"+i),a(t,{$event:e})})}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(r,n,i,o,s,a,c,l,u,d,p){var h=this;this.$scope=r,this.$state=n,this.$location=i,this.$translate=o,this.$window=s,this.server=a,this.datasources=c,this.projects=l,this.users=u,this.views=d,this.workbooks=p,this.startIndexForType={};var f=_.debounce(function(){h.$scope.$evalAsync(function(){h.updateResults()})},200);this.$scope.$watch("searchText",function(){f()}),this.$scope.close=function(e){e&&$(e.target).attr("name")===t.TextBoxName||(h.$scope.clearSearch(),h.updateResults())},this.$scope.keydown=function(t){switch(t.which){case e.Keys.ArrowUp:h.selectedIndex>0?h.selectedIndex--:h.selectedIndex=h.maxSelectedIndex;break;case e.Keys.ArrowDown:h.selectedIndex<h.maxSelectedIndex?h.selectedIndex++:h.selectedIndex=Math.min(0,h.maxSelectedIndex);break;case e.Keys.Enter:if(h.selectedIndex>=0){var r=$(".tb-omnibox-results").find(".tb-omnibox-menu-item.tb-selected").attr("href");"#"===r.charAt(0)&&(r=r.slice(1)),h.$location.url(r),h.$scope.close()}break;case e.Keys.Escape:h.$scope.close()}},this.$scope.isItemSelected=function(e,t){return h.startIndexForType[e]+t===h.selectedIndex},this.$scope.selectItem=function(e,t){e&&_.isNumber(t)&&(h.selectedIndex=h.startIndexForType[e]+t)},this.$scope.itemHref=function(e,t){return h.$state.href(e,t)},this.$scope.seeAllHref=function(e){return h.$state.href(e)+"?search="+encodeURIComponent(h.$scope.searchText)},this.$scope.showSeeAll=function(e,r){return e.total>t.MaxResultsPerType&&!("users"===r&&!a.isSessionSiteOrServerAdmin())},this.$scope.tooltipForDataSource=function(e){return h.$translate.instant("itemWithProject",{ITEM:e.name,PROJECT:e.project.name})},this.$scope.tooltipForView=function(e){return h.$translate.instant("viewWithWorkbook",{VIEW:e.name,WORKBOOK:e.workbook.name})},this.$scope.tooltipForWorkbook=function(e){return h.$translate.instant("itemWithProject",{ITEM:e.name,PROJECT:e.project.name})},this.$scope.maxResultsPerType=t.MaxResultsPerType;var m=$(this.$window);this.$scope.popupMaxHeight=function(){return m.height()-t.SpaceLeftWhenMaxHeight},this.$scope.clearSearch=function(){return h.$scope.searchText=""},this.$scope.textBoxName=t.TextBoxName}return t.prototype.updateResults=function(){var t=this;if(this.$scope.searchText){var r={pendingRequests:5,totalResults:0};this.currentRequestProgress=r;var n=function(e){t.currentRequestProgress===r&&(r.totalResults+=e.total,r.pendingRequests--,0===r.pendingRequests&&(t.currentRequestProgress=null,t.$scope.showResults=r.totalResults>0,t.$scope.showNoResults=!t.$scope.showResults,t.updateStartIndexes(),t.selectedIndex=-1,t.maxSelectedIndex=r.totalResults>0?t.startIndexForType.users+t.itemsForType(t.$scope.users)-1:-1))};this.updateType(this.datasources.published(),e.OrderKeys.name,e.Order.asc,function(e){t.$scope.datasources=e,n(e)}),this.updateType(this.projects.all(),e.OrderKeys.name,e.Order.asc,function(e){t.$scope.projects=e,n(e)}),this.updateType(this.users.all(),e.OrderKeys.displayName,e.Order.asc,function(e){t.$scope.users=e,n(e)}),e.FeatureFlags.contentAnalyticsEnabled?(this.updateType(this.views.all(),e.OrderKeys.relevancy,e.Order.desc,function(e){t.$scope.views=e,n(e)}),this.updateType(this.workbooks.all(),e.OrderKeys.relevancy,e.Order.desc,function(e){t.$scope.workbooks=e,n(e)})):(this.updateType(this.views.all(),e.OrderKeys.name,e.Order.asc,function(e){t.$scope.views=e,n(e)}),this.updateType(this.workbooks.all(),e.OrderKeys.name,e.Order.asc,function(e){t.$scope.workbooks=e,n(e)}))}else this.$scope.datasources=e.ListResult.empty(),this.$scope.projects=e.ListResult.empty(),this.$scope.users=e.ListResult.empty(),this.$scope.views=e.ListResult.empty(),this.$scope.workbooks=e.ListResult.empty(),this.$scope.showResults=!1,this.$scope.showNoResults=!1,this.updateStartIndexes(),this.selectedIndex=-1,this.maxSelectedIndex=-1},t.prototype.updateType=function(r,n,i,o){r.addFilter(e.Filter.search(this.$scope.searchText)).withOrder([i(n)]).getSlice(0,t.MaxResultsPerType).then(function(e){o(e)})},t.prototype.updateStartIndexes=function(){this.startIndexForType.views=0,this.startIndexForType.workbooks=this.startIndexForType.views+this.itemsForType(this.$scope.views),this.startIndexForType.datasources=this.startIndexForType.workbooks+this.itemsForType(this.$scope.workbooks),this.startIndexForType.projects=this.startIndexForType.datasources+this.itemsForType(this.$scope.datasources),this.startIndexForType.users=this.startIndexForType.projects+this.itemsForType(this.$scope.projects)},t.prototype.itemsForType=function(r){return e.FeatureFlags.contentAnalyticsEnabled?r.total>t.MaxResultsPerType?t.MaxResultsPerType:r.items.length:r.total>t.MaxResultsPerType?t.MaxResultsPerType+1:r.items.length},t.MaxResultsPerType=5,t.SpaceLeftWhenMaxHeight=100,t.TextBoxName="omniboxTextBox",t.$inject=["$scope","$state","$location","$translate","$window","ServerService","DataSources","Projects","Users","Views","Workbooks"],t}();e.OmniboxCtrl=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbOmnibox",function(){var t=e.FeatureFlags.contentAnalyticsEnabled?"omniboxContentAnalytics.html":"omnibox.html";return{restrict:"E",replace:!0,templateUrl:t,scope:{},controller:e.OmniboxCtrl}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbPermissionsPanel",function(){return e.FeatureFlags.projectControlledPermissionsEnabled?{restrict:"E",replace:!0,templateUrl:"permissionsPanel.html",scope:{authorizableType:"=",authorizables:"=",templateType:"=",showPrompt:"="},controller:e.PermissionsPanelCtrl}:{restrict:"E",replace:!0,templateUrl:"permissionsPanelWithoutPCP.html",scope:{authorizableType:"=",authorizables:"=",permissionsInfoMessage:"=",readOnly:"&",templateType:"="},controller:e.PermissionsPanelCtrl}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbPermissionRuleEditor",["$compile","$q","PermissionRoles",function(t,r,n){return{restrict:"E",controller:e.PermissionRuleEditorCtrl,require:"tbPermissionRuleEditor",scope:{action:"=",updateAuthorizables:"&",hideRowMenu:"&",permissionsPanelColumnWidths:"=columnWidths",authorizables:"=",getPositionElement:"=",selectedRow:"=row",accordion:"="},link:function(i,o,s,a){function c(){var e=i.getPositionElement(),t=e.position(),r={height:e.height(),width:e.width()};m.css({top:t.top,left:t.left,height:r.height,width:r.width})}var l=i.authorizables.type,u=i.getPositionElement();i.$watch("selectedRow",function(){a.initializeFromSelectedRow(),c()});var d=u.parents(".tb-scroll-content-area"),p=o.parents(".tb-permissions-container").find(".tb-effective-permissions-container .tb-scroll-content-area"),h=$("<div>").addClass("tb-backdrop-white").appendTo(d),f=$("<div>").addClass("tb-backdrop-white").appendTo(p),m=$("<div>").addClass("tb-permission-rule-editor").append($("<div>").attr({"ng-include":'"permissionRuleEditor.html"'})).appendTo(d);t(m)(i),i.$on("$destroy",function(){m.remove(),h.remove(),f.remove()}),i.roleOptions=function(e){return n.getAvailableRolesForType(e)},i.templates={cells:null},i.isDeleteActionSelected=function(){return i.action===e.L10n.Keys.delete_||_.every(_.values(i.selectedRoleByContentType),function(t){return t===e.L10n.Keys.none})},i.getSavePermissionRuleTranslationID=function(){return i.isDeleteActionSelected()?e.L10n.Keys.delete_:e.L10n.Keys.save},i.savePermissionRule=function(){a.savePermissionRule()},i.getTooltipText=function(e){return a.getTooltipText(e)},i.saveDisabled=function(){return a.saveDisabled()},i.cancel=function(){var t=r.when();i.action===e.PermissionRuleEditorCommands.add&&(t=i.updateAuthorizables()),t.then(function(){return i.hideRowMenu()})},_.each(_.keys(i.selectedRoleByContentType),function(t){i.$watch('selectedRoleByContentType["'+t+'"]',function(r){r&&r!==e.L10n.Keys.custom&&(e.FeatureFlags.projectPermissionsTemplatesEnabled?i.data.row.permissionsByContentType[t]=a.getCapabilitiesForTypeAndRole(t,r):i.data.row.permissions=a.getCapabilitiesForRole(r))}),e.FeatureFlags.projectPermissionsTemplatesEnabled&&i.$watch('data.row.permissionsByContentType["'+t+'"]',function(r){var o=e.PermissionsHelper.PermissionsFromIPermissions(r);i.selectedRoleByContentType[t]=n.getExplicitRoleForTypeAndPermissions(t,o)},!0)}),e.FeatureFlags.projectPermissionsTemplatesEnabled||i.$watch("data.row.permissions",function(){var t=e.PermissionsHelper.PermissionsFromIPermissions(i.data.row.permissions);i.selectedRoleByContentType[l]=n.getExplicitRoleForTypeAndPermissions(l,t)},!0)}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbPlaceDescription",["$state",function(e){return{restrict:"E",replace:!0,templateUrl:"placeDescription.html",scope:{type:"@",id:"=",description:"="},link:function(t,r){var n=r.find(".tb-place-description-text-holder");t.showReadMore=function(){return n.get(0).scrollWidth>n.width()&&!e.includes("**.details")}}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){!function(e){e[e.TopLeft=0]="TopLeft",e[e.TopRight=1]="TopRight",e[e.BottomLeft=2]="BottomLeft",e[e.BottomRight=3]="BottomRight"}(e.Corner||(e.Corner={}));var t=e.Corner,r=function(){function e(e,t,r,n){var i=this;this.positionCorner=e,this.positionElement=t,this.contentCorner=r,this.contentElement=n,this.rendered=!1,this.updatePositionListener=function(){i.scope?i.scope.$evalAsync(function(){return i.updateContentElementPosition()}):i.updateContentElementPosition()},this.positionElement.parents().on("scroll",this.updatePositionListener),$(window).on("resize",this.updatePositionListener),this.updateContentElementPosition()}return e.prototype.setScope=function(e){this.scope=e},e.prototype.destroy=function(){this.positionElement.parents().off("scroll",this.updatePositionListener),$(window).off("resize",this.updatePositionListener)},e.prototype.getPositionX=function(e,r,n){switch(e){case t.TopLeft:case t.BottomLeft:return r.left;case t.TopRight:case t.BottomRight:return r.left+n.width}},e.prototype.getPositionY=function(e,r,n){switch(e){case t.TopLeft:case t.TopRight:return r.top;case t.BottomLeft:case t.BottomRight:return r.top+n.height}},e.prototype.getContentLeft=function(e,r,n){switch(e){case t.TopLeft:case t.BottomLeft:return r;case t.TopRight:case t.BottomRight:return r-n.width}},e.prototype.getContentTop=function(e,r,n){switch(e){case t.TopLeft:case t.TopRight:return r;case t.BottomLeft:case t.BottomRight:return r-n.height}},e.prototype.flipVertical=function(e){switch(e){case t.TopLeft:return t.BottomLeft;case t.TopRight:return t.BottomRight;case t.BottomLeft:return t.TopLeft;case t.BottomRight:return t.TopRight}},e.prototype.flipHorizontal=function(e){switch(e){case t.TopLeft:return t.TopRight;case t.TopRight:return t.TopLeft;case t.BottomLeft:return t.BottomRight;case t.BottomRight:return t.BottomLeft}},e.prototype.contentWidth=function(){var e=this.contentElement.outerWidth();return this.rendered=e>0,e},e.prototype.contentHeight=function(){var e=this.contentElement.outerHeight();return this.rendered=e>0,e},e.prototype.calculateDisplayPosition=function(e,t,r,n,i){var o=this.getPositionX(e,r,t),s=this.getPositionY(e,r,t),a=this.getContentLeft(n,o,i),c=this.getContentTop(n,s,i);return{left:a,top:c}},e.prototype.invalidHorizontalPosition=function(e,t,r){return e.left<0||e.left>r-t||e.right<0||e.right>r-t},e.prototype.invalidVerticalPosition=function(e,t,r){return e.top<0||e.top>r-t||e.bottom<0||e.bottom>r-t},e.prototype.getContentSize=function(){var e={height:this.contentElement.outerHeight(),width:this.contentElement.outerWidth()};return this.rendered=e.height>0&&e.width>0,e},e.prototype.getPositionSize=function(){return{height:this.positionElement.outerHeight(),width:this.positionElement.outerWidth()}},e.prototype.getWindowSize=function(){return{height:$(window).height(),width:$(window).width()}},e.prototype.updateContentElementPosition=function(){var e=this,t=this.positionCorner,r=this.getPositionSize(),n=this.positionElement.offset(),i=this.contentCorner,o=this.getContentSize(),s=this.getWindowSize(),a=function(){return e.calculateDisplayPosition(t,r,n,i,o)},c=function(){t=e.flipHorizontal(t),i=e.flipHorizontal(i),u=a()},l=function(){t=e.flipVertical(t),i=e.flipVertical(i),u=a()},u=a();return this.invalidHorizontalPosition(u,o.width,s.width)&&(c(),this.invalidHorizontalPosition(u,o.width,s.width)&&c()),this.invalidVerticalPosition(u,o.height,s.height)&&(l(),this.invalidVerticalPosition(u,o.height,s.height)&&l()),this.cornerPosition=u,u},e.prototype.getContentElementPosition=function(){return this.rendered||this.updateContentElementPosition(),this.cornerPosition},e}();e.StackedElement=r;var n=function(){function e(){this.stackedElements=[]}return e.prototype.createStackedElement=function(e,t,n,i){return this.addStackedElement(new r(e,t,n,i))},e.prototype.addStackedElement=function(e){return this.stackedElements.push(e),e},e.prototype.removeStackedElement=function(e){var t=_.indexOf(this.stackedElements,e);-1!==t&&this.stackedElements.splice(t,1)},e.$inject=[],e}();e.StackedElementsService=n,e.Module.instance().service("StackedElementsService",n)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e,t,r){this.getPositionElement=e,this.getContentElement=t,this.stackedElementsService=r}return e.prototype.show=function(e,t){this.stackedElement=this.stackedElementsService.createStackedElement(e,this.getPositionElement(),t,this.getContentElement())},e.prototype.hide=function(){this.stackedElementsService.removeStackedElement(this.stackedElement)},e}();e.Popup=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(t,r,n,i){this.scope=t;var o=function(){return _.isFunction(t.getPositionElement)?t.getPositionElement():r};this.popup=new e.Popup(o,function(){return n(function(e){return e})},i)}return t.prototype.hidePopup=function(){this.scope.show=!1},t.$inject=["$scope","$element","$transclude","StackedElementsService"],t}();e.PopupCtrl=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbPopup",[function(){return{restrict:"E",transclude:!0,replace:!0,template:'<div class="tb-popup"></div>',scope:{show:"=",positionCorner:"@",contentCorner:"@",getPositionElement:"=?"},controller:e.PopupCtrl,link:function(t,r,n,i){function o(t){switch(t){case"tl":return e.Corner.TopLeft;case"tr":return e.Corner.TopRight;case"bl":return e.Corner.BottomLeft;case"br":return e.Corner.BottomRight}}var s=i.popup;t.$watch("show",function(e){s&&(e?s.show(o(t.positionCorner),o(t.contentCorner)):s.hide())}),r.on("$destroy",function(){s&&s.hide()})}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t){this.$element=e,this.contentMatchButtonWidth=!1,this._open=!1,this.scope=t,this.scope.popupMenu=this}return t.prototype.setButton=function(e){this.button=e},t.prototype.getButtonWidth=function(){return this.button.outerWidth()},t.prototype.setContent=function(e){this.content=e},t.prototype.getContent=function(){return this.content},t.prototype.getContentScope=function(){var e=this;return{popupMenu:{button:this.button,close:function(){return e.close()}}}},t.prototype.isUp=function(){switch(this.scope.direction){case"dr":case"dl":default:return!1;case"ur":case"ul":return!0}},t.prototype.positionCorner=function(){switch(this.scope.direction){case"dr":default:return"bl";case"dl":return"br";case"ur":return"tl";case"ul":return"tr"}},t.prototype.contentCorner=function(){switch(this.scope.direction){case"dr":default:return"tl";case"dl":return"tr";case"ur":return"bl";case"ul":return"br"}},t.prototype.isDisabled=function(){return this.scope.disabled===!0},t.prototype.isOpen=function(){return this._open},t.prototype.keydown=function(t){if(!this.isDisabled())switch(t.which){case e.Keys.Enter:this.toggle(),t.stopPropagation();break;case e.Keys.Space:this._open||this.open()}},t.prototype.toggle=function(){this.isDisabled()||(this._open?this.close():this.open())},t.prototype.open=function(){this._open=!0,this.contentWidth=this.contentMatchButtonWidth?this.getButtonWidth():null,this.scope.opened({closeFn:angular.bind(this,this.close)})},t.prototype.close=function(e){void 0===e&&(e=this.$element),this._open=!1,this.scope.closed(),e.focus()},t.prototype.mousedownOutside=function(e){var t=$(e.target);0===t.closest(this.button).length&&this.close(t)},t.$inject=["$element","$scope"],t}();e.PopupMenuCtrl=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbPopupMenu",[function(){return{restrict:"E",replace:!0,require:"?tbDisabled",transclude:!0,templateUrl:"popupMenu.html",scope:{direction:"@",disabled:"=tbDisabled",opened:"&",closed:"&"},controller:e.PopupMenuCtrl}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=[{name:"tbPopupMenuButton",templateUrl:"popupMenuButton.html"},{name:"tbPopupMenuCustomButton",templateUrl:"popupMenuCustomButton.html"},{name:"tbPopupMenuSignatureButton",templateUrl:"popupMenuSignatureButton.html"},{name:"tbPopupMenuTextButton",templateUrl:"popupMenuTextButton.html"}];_.each(t,function(t){e.Module.instance().directive(t.name,function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:t.templateUrl,scope:{},require:"^tbPopupMenu",link:function(e,t,r,n){n.setButton(t),e.popupMenu=n}}})})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbPopupMenuContent",function(){return{restrict:"E",transclude:!0,require:"^tbPopupMenu",link:function(e,t,r,n,i){n.setContent(i),n.contentMatchButtonWidth="true"===r.matchButtonWidth}}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=65535;e.Module.instance().directive("tbPortInputValidator",function(){return{restrict:"A",require:"ngModel",link:function(e,r,n,i){var o=function(e){return/^\d*$/.exec(e)&&parseInt(e,10)<=t};i.$parsers.push(function(e){return i.$setValidity("port",!e||o(e)),e})}}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbPreventInput",["$parse",function(t){return{require:"?ngModel",link:function(r,n,i,o){if(o){var s=t(i.tbPreventInput);o.$parsers.push(function(e){var t=o.$modelValue;return e&&s(r,{value:e})?(o.$setViewValue(t),o.$render()):t=e,t}),n.bind("keypress",function(t){t.keyCode===e.Keys.Space&&s(r,{value:n.val()+" "})&&t.preventDefault()})}}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbProgressBar",["$translate",function(e){return{restrict:"E",replace:!0,templateUrl:"progressBar.html",scope:{percentComplete:"="}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbRadioButton",[function(){var e="tb-selected",t="tb-mixed",r="";return{restrict:"E",replace:!0,require:["?ngModel","^?tbRadioButtonGroup"],templateUrl:"radioButton.html",scope:{selected:"&",value:"&tbValue"},link:function(n,i,o,s){var a=s[0],c=s[1];if(!a)return void(n.classForState=function(){return n.selected()?e:r});var l=function(){return i.hasClass("tb-disabled")};n.classForState=function(){if(!_.isArray(a.$viewValue))return a.$viewValue===n.value()?e:r;for(var i=a.$viewValue,o=0,s=0;s<i.length;s++)i[s]===n.value()&&o++;return o===i.length?e:0===o?r:t},n.select=function(){l()||(_.isArray(a.$viewValue)?a.$setViewValue(_.map(a.$viewValue,function(){return n.value()})):a.$setViewValue(n.value()),a.$render())},c&&(c.select=n.select,c.disabled=l)}}}]);var t=function(){function e(){}return e}();e.Module.instance().directive("tbRadioButtonGroup",[function(){return{restrict:"E",transclude:!0,replace:!0,template:'<div class="tb-radio-button-group" ng-transclude></div>',controller:t}}]),e.Module.instance().directive("tbRadioButtonLabel",[function(){return{restrict:"E",transclude:!0,replace:!0,require:"^tbRadioButtonGroup",templateUrl:"radioButtonLabel.html",link:function(e,t,r,n){e.ctrl=n}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbResetStartPage",["$translate","ConfirmActionDialog","ServerService","ToasterService","UserSettingsActions",function(e,t,r,n,i){return{restrict:"E",replace:!0,templateUrl:"resetStartPage.html",scope:{userSettings:"=",serverUser:"="},link:function(r){r.resetStartPage=function(){t.open({title:e.instant("resetStartPageConfirmTitle"),bodyText:e.instant("resetStartPageConfirmMessage"),actionName:e.instant("resetStartPageConfirmButton"),action:function(t){var n=r.serverUser;return i.resetStartPage(n).then(function(r){(!r||r.errors)&&t.showErrorMessage(e.instant("resetStartPageError"))})}})},r.userPageOverridden=function(){return!!r.userSettings.startPage}}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbScroll",function(){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"scrolling.html",scope:{items:"=",layout:"=",sliceChanged:"&",scrollControls:"=?",scrollLeftChanged:"&"},controller:e.ScrollCtrl}}),e.Module.instance().directive("tbScrollContentArea",function(){return{require:"^tbScroll",link:function(e,t,r,n){n.contentArea=t}}}),e.Module.instance().directive("tbScrollContent",function(){return{require:"^tbScroll",link:function(e,t,r,n){n.content=t}}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(){this.options=[]}return e.prototype.currentOptionTranscludeFn=function(){return this.selectedOption?this.selectedOption.transclude:this.noneOptionTransclude},e.prototype.select=function(e){this.value=e,this.selectedOption=_.findWhere(this.options,{value:e})},e.prototype.selectOption=function(e){this.selectedOption=e,this.value=this.selectedOption.value},e.prototype.selectPrevious=function(){for(var e=_.indexOf(this.options,this.selectedOption),t=e-1;t>=0&&this.options[t].disabled;)t--;t>=0&&this.selectOption(this.options[t])},e.prototype.selectNext=function(){for(var e=_.indexOf(this.options,this.selectedOption),t=e+1;t<this.options.length&&this.options[t].disabled;)t++;t<this.options.length&&this.selectOption(this.options[t])},e.prototype.addOption=function(e){this.options.push(e),this.isOptionForValue(e,this.value)&&(this.selectedOption=e)},e.prototype.setNoneOptionTransclude=function(e){this.noneOptionTransclude=e},e.prototype.removeOption=function(e){this.options=_(this.options).without(e),this.selectedOption===e&&(this.selectedOption=null)},e.prototype.verifySelection=function(){this.select(this.value)},e.prototype.isOptionForValue=function(e,t){return _.isEqual(e.value,t)},e}();e.Module.instance().directive("tbSelect",[function(){return{restrict:"E",replace:!0,require:["tbSelect","?ngModel"],controllerAs:"selectCtrl",transclude:!0,templateUrl:"select.html",scope:{contentClass:"@tbSelectContentClass",disabled:"=tbDisabled",matchButtonWidth:"@"},controller:t,link:function(t,r,n,i){var o=i[0],s=i[1];t.maxCountDigits=0,t.$watch(function(){return o.options},function(){o.options&&(t.maxCountDigits=_.max(_.map(o.options,function(e){return _.isNumber(e.count)?(""+e.count).length:0})))}),s&&(s.$render=function(){return o.select(s.$viewValue)}),t.$watch(function(){return o.selectedOption},function(e){e&&s&&s.$setViewValue(e.value),r.trigger("change")},!0),t.$watch("selectCtrl.selectedOption.value",function(e){return o.verifySelection()}),t.optionClicked=function(e){o.selectOption(e),r.focus()};var a=function(){return r.find(".tb-popup").scope().popupMenu};t.keydown=function(r){switch(r.which){case e.Keys.ArrowUp:o.selectPrevious();break;case e.Keys.ArrowDown:o.selectNext();break;case e.Keys.Tab:case e.Keys.Escape:!t.disabled&&a().isOpen()&&(a().close(),r.preventDefault(),r.stopPropagation());break;default:a().keydown(r)}}}}}]),e.Module.instance().directive("tbSelectOption",[function(){return{restrict:"E",replace:!0,transclude:!0,require:"^tbSelect",scope:{value:"=",count:"=",disabled:"=tbDisabled"},link:function(e,t,r,n,i){var o={value:e.value,disabled:e.disabled,transclude:i,count:e.count};e.$watch(function(){return e.value},function(){o.value=e.value}),t.on("$destroy",function(){return n.removeOption(o)}),n.addOption(o)}}}]),e.Module.instance().directive("tbSelectNone",["$parse",function(e){return{restrict:"E",replace:!0,transclude:!0,require:"^tbSelect",scope:{},link:function(e,t,r,n,i){n.setNoneOptionTransclude(i)}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbSelected",[function(){return{restrict:"A",link:function(e,t,r){e.$watch(r.tbSelected,function(e){t.toggleClass("tb-selected",e)})}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbServerSettingsForm",function(){return{restrict:"E",replace:!0,require:"^tbSettingsCoordinator",templateUrl:"serverSettingsForm.html",link:function(e,t,r,n){n.registerFormState(e.serverSettingsFormState)},controller:e.ServerSettingsFormCtrl}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbSignedInUserMenu",["$state","$translate","ServerService","StartPageService","UserSettingsActions","ConfirmActionDialog","ToasterService",function(t,r,n,i,o,s,a){return{restrict:"E",replace:!0,templateUrl:"signedInUserMenu.html",scope:{},link:function(r){r.server=n,r.inServerArea=function(){return n.isSessionMultiSite()&&t.includes("main.server")},r.changeDefaultStartPage=function(){return o.confirmChangeDefaultStartPage()},r.changeUserStartPage=function(){return o.confirmChangeUserStartPage()},r.signOutKey=function(){var t=n.authenticationType();return t===e.ServerApi.AuthenticationType.Sspi||t===e.ServerApi.AuthenticationType.Kerberos?"switchUser":"signOut"}}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){
e.Module.instance().directive("tbSignInLogo",["LogoService",function(e){return{restrict:"E",replace:!0,templateUrl:"signInLogo.html",link:function(t,r,n){t.signInLogo=e.getSignInLogo()}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbSiteRolePermissionsTable",[function(){return{restrict:"E",replace:!0,templateUrl:"siteRolePermissionsTable.html",scope:{siteRoles:"="},link:function(e){e.rows=t.permissionsForRoles(e.siteRoles)}}}]);var t;!function(t){function r(t){return[{role:e.ServerApi.SiteRoles.ServerAdministrator,webAccess:!0,interact:!0,publish:!0,manage:!0},{role:e.ServerApi.SiteRoles.SiteAdministrator,webAccess:!0,interact:!0,publish:!0,manage:!0},{role:e.ServerApi.SiteRoles.Publisher,webAccess:!0,interact:!0,publish:!0},{role:e.ServerApi.SiteRoles.Interactor,webAccess:!0,interact:!0},{role:e.ServerApi.SiteRoles.Viewer,webAccess:!0},{role:e.ServerApi.SiteRoles.Unlicensed},{divider:!0,role:e.ServerApi.SiteRoles.ViewerWithPublish,webAccess:!0,publish:!0},{role:e.ServerApi.SiteRoles.UnlicensedWithPublish,publish:!0}]}t.permissionsForRoles=r}(t=e.SiteRolePermissionsTable||(e.SiteRolePermissionsTable={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbSiteRolesPicker",[function(){return{restrict:"E",replace:!0,templateUrl:"siteRolesPicker.html",controller:e.SiteRolesPickerCtrl,scope:{usersWithSiteRoles:"=?",changes:"=",busy:"=?"}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbSiteSettingsForServerAdminForm",function(){return{restrict:"E",replace:!0,require:"^?tbSettingsCoordinator",templateUrl:"siteSettingsForServerAdminForm.html",link:function(e,t,r,n){n&&n.registerFormState(e.siteSettingsForServerAdminFormState)},controller:e.SiteSettingsForServerAdminFormCtrl}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbSiteSettingsForSiteAdminForm",function(){return{restrict:"E",replace:!0,require:"^?tbSettingsCoordinator",templateUrl:"siteSettingsForSiteAdminForm.html",link:function(e,t,r,n){n&&n.registerFormState(e.siteSettingsForSiteAdminFormState)},controller:e.SiteSettingsForSiteAdminFormCtrl}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbSiteSwitcher",function(){return{restrict:"E",replace:!0,templateUrl:"siteSwitcher.html",scope:{siteSelected:"&"},controller:e.SiteSwitcherCtrl}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(r,n,i){var o=this;this.items=[],this.itemIndex={};var s;r.menuOpened=function(e){s=e},r.items=this.items,r.currentSort=function(){var e=r.sortKey+":"+(r.sortAscending?t.Ascending:t.Descending);return o.itemIndex[e]||t.INVALID_ITEM},r.sortBy=function(r){var n=r.split(":");i.search("order",e.Order.serialize([{field:n[0],ascending:n[1]===t.Ascending}])),s&&(s(),s=null)}}return t.prototype.add=function(e){this.items.push(e),this.itemIndex[e.key]=e},t.Ascending="asc",t.Descending="desc",t.$inject=["$scope","$element","$location"],t.INVALID_ITEM={key:"",label:""},t}();e.SortToolCtrl=t,e.Module.instance().directive("tbSortTool",function(){return{restrict:"E",templateUrl:"sortTool.html",replace:!0,transclude:!0,scope:{sortKey:"=",sortAscending:"="},controller:t}}).directive("tbSortToolItem",function(){return{require:"^tbSortTool",restrict:"E",link:function(e,t,r,n){n.add({key:r.key,label:t.text()})}}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbStackedElement",[function(){return{restrict:"E",replace:!0,templateUrl:"inline_stackedElement.html",scope:{stackedElement:"="},link:function(e,t){var r=e.stackedElement;t.html("").append(r.contentElement),r.setScope&&r.setScope(e),e.$watch(function(){return r.getContentElementPosition()},function(t){e.left=t.left,e.top=t.top,e.right=t.right,e.bottom=t.bottom,e.visible=!0},!0),t.on("$destroy",function(){return r.destroy&&r.destroy()})}}}]),e.Module.instance().directive("tbStackedElements",["StackedElementsService",function(e){return{restrict:"E",replace:!0,template:'<tb:stacked-element ng-repeat="stackedElement in stackedElements" stacked-element="stackedElement"></tb:stacked-element>',link:function(t,r){t.stackedElements=e.stackedElements}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){function t(e,t){var r=_.map(t,function(e,t){return encodeURIComponent(t)+"="+encodeURIComponent(e)});if(r.length>0){var n=e.indexOf("?")>=0?"&":"?",i=r.join("&");return e+n+i}return e}e.Module.instance().directive("tbStateHref",["$location","$state",function(e,r){return{restrict:"A",link:function(n,i,o){var s,a=n.$eval(o.tbStateHrefConfig||"")||{},c=n.$eval(o.tbStateHrefParams||"")||null,l=n.$eval(o.tbStateHrefOpts||"")||null,u=a.keepSearch,d=a.omitParams||[],p=function(){if(_.isString(s)){var n=r.href(s,c,l);u&&(n=t(n,_.omit(e.search(),d))),o.$set("href",n)}};o.$observe("tbStateHref",function(e){s=e,p()}),u&&n.$on("$locationChangeSuccess",p)}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbTagsInput",["SearchSuggestionsService",function(t){return{restrict:"E",require:["ngModel","?tbFocus"],templateUrl:"tagsInput.html",replace:!0,scope:{newTag:"=?textInputModel"},link:function(r,n,i,o){var s=o[0],a=o[1];r.selectedTagIndex=-1,r.currentRow={index:0,object:null};var c=function(){r.selectedTagIndex=-1};r.addTag=function(t){if(t){var n=e.TagsHelper.quote(t);r.removeTag(n),s.$setViewValue(s.$modelValue.concat([{name:n,added:!0}])),c(),r.newTag=""}},r.removeTag=function(t){s.$setViewValue(_.reject(s.$modelValue,function(r){return r.name===t||r.name===e.TagsHelper.unquote(t)})),r.selectedTagIndex--},r.selectTag=function(e){r.selectedTagIndex=_.indexOf(r.currentTags,_.findWhere(r.currentTags,{name:e}))},r.displayTag=e.TagsHelper.unquote,r.displayTagHtml=e.TagsHelper.displayTagHtml;var l=function(){return r.newTag&&r.currentRow.object?r.currentRow.object.name:""};r.handleKeyEvent=function(t){var i=r.currentTags[r.selectedTagIndex];switch(t.which){case e.Keys.Tab:i||r.addTag(l());break;case e.Keys.Enter:i||r.addTag(l()),t.preventDefault();break;case e.Keys.Backspace:i?(r.removeTag(i.name),t.preventDefault()):0===u.caret()&&(r.selectedTagIndex=r.currentTags.length-1);break;case e.Keys.Delete:i.name&&(r.removeTag(i.name),r.selectedTagIndex++,t.preventDefault());break;case e.Keys.ArrowRight:i?(r.selectedTagIndex++,t.preventDefault()):c();break;case e.Keys.ArrowLeft:i?(r.selectedTagIndex>0&&r.selectedTagIndex--,t.preventDefault()):0===u.caret()&&(r.selectedTagIndex=r.currentTags.length-1,t.preventDefault());break;case e.Keys.ArrowDown:r.currentRow.index++,t.preventDefault();break;case e.Keys.ArrowUp:r.currentRow.index=Math.max(r.currentRow.index-1,0),t.preventDefault();break;default:c()}t.isDefaultPrevented()||n.trigger(t.type,t)},r.$watch(function(){return r.newTag},function(i){var o=!1,s=!0;if(r.tagSource={getSlice:function(e,n){return t.tags(i).getSlice(e,n).then(function(e){return s&&(r.currentRow.index=0,s=!1),0!==e.index||0!==e.items.length&&e.items[0].name===r.newTag||(e.items.unshift({name:r.newTag}),o=!0),o&&(0!==e.index&&e.index++,e.total++),e})}},i&&2!==i.split('"').length){var a=e.TagsHelper.parseTagString(i);a.length>1&&_.forEach(a.slice(0,-1),r.addTag),r.newTag=_.last(a)||"",r.dropdownWidth=n.width()}}),r.$watch(function(){return s.$modelValue},function(e){r.currentTags=_.isArray(e)?e:[],r.selectedTagIndex>=r.currentTags.length&&c()});var u=n.find(".tb-tag-input");a&&a.setFocusElement(u),u.on("blur",function(){return r.$apply(c)}),n.click(function(e){a?a.focus():u.focus(),0===$(e.target).closest(".tb-tag-container").length&&r.$apply(c)})}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(){this.templates=[]}return e}();e.Module.instance().directive("tbTemplateList",function(){return{require:"tbTemplateList",restrict:"E",controller:t,scope:{templates:"=?"},link:function(e,t,r,n){e.templates=n.templates,t.remove()}}}),e.Module.instance().directive("tbTemplate",function(){return{require:"^tbTemplateList",restrict:"E",transclude:!0,link:function(e,t,r,n,i){var o=r.templateIf;(void 0===o||e.$eval(o))&&n.templates.push({attrs:r,linkFn:i})}}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.TextBoxMixedValues="â€”â€”â€”";var t=[{name:"tbTextBox",template:"textBox.html"},{name:"tbPasswordBox",template:"passwordBox.html"},{name:"tbNumberBox",template:"numberBox.html"}];_.each(t,function(t){e.Module.instance().directive(t.name,["$timeout","$compile",function(r,n){return{restrict:"E",replace:!0,templateUrl:t.template,scope:{disabled:"=tbTextBoxDisabled",required:"=tbTextBoxRequired",model:"=tbTextBoxModel",maxLength:"@tbTextBoxMaxLength",options:"@tbTextBoxModelOptions",onEnter:"&tbTextBoxEnter",focus:"=tbTextBoxFocus",clearable:"=tbTextBoxClearable",onClear:"&tbTextBoxClear",onPaste:"&tbTextBoxPaste",autoSelect:"=tbTextBoxAutoSelect",keydown:"&tbTextBoxKeydown",validation:"@tbTextBoxValidation",min:"=tbTextBoxValidationMin",max:"=tbTextBoxValidationMax",match:"=tbMatchData",placeholder:"=tbTextBoxPlaceholder",clearValue:"=?tbTextBoxClearValue",tabIndex:"@tbTextBoxTabindex"},link:function(t,i,o){_.isUndefined(t.model)&&(t.model="");var s=i.find(".tb-text-box-input");if(o.tbTextBoxName&&s.prop("name",o.tbTextBoxName),t.validation){var a=s.clone();_.each(t.validation.split(" "),function(e){a.attr(e,"")}),s.replaceWith(a),n(a)(t),s=a}t.clearValue=function(){return t.textValue=""},t.$watch("model",function(){t.textValue=t.model,t.model===e.TextBoxMixedValues?d():p()}),o.tbTestId&&(t.inputTestId=o.tbTestId+"-input"),void 0!==t.maxLength&&s.attr("maxlength",t.maxLength);var c=function(){return r(function(){return s.focus()})};t.clearAndFocus=function(){t.textValue="",t.onClear&&t.onClear(),s.trigger("clear"),c()},t.triggerEnter=function(){s.trigger("enter")};var l=t.$eval(o.tbTextBoxModelOptions),u=function(){return t.model=t.textValue};l&&l.updateOn?s.on(l.updateOn,function(){t.$evalAsync(u)}):t.$watch("textValue",u),s.on("focus",function(){i.addClass("tb-focus")}),s.on("blur",function(){i.removeClass("tb-focus")});var d=_.once(function(){s.addClass("tb-text-box-mixed"),s.on("focus.mixed",function(){s.select()}),s.on("keydown.mixed",function(t){switch(t.which){case e.Keys.ArrowDown:case e.Keys.ArrowUp:case e.Keys.ArrowLeft:case e.Keys.ArrowRight:case e.Keys.Home:case e.Keys.End:t.preventDefault()}}),s.on("mouseup.mixed",function(e){e.preventDefault()})}),p=function(){s.removeClass("tb-text-box-mixed"),s.off(".mixed")}}}}])})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbTextDropdown",["$timeout","$translate","SliceableFactory",function(t,r,n){return{restrict:"E",templateUrl:"textDropdown.html",replace:!0,scope:{model:"=ngModel",optionList:"=",preventInput:"&tbPreventInput"},link:function(i,o,s){i.items=n.fromArray(i.optionList);var a=function(e){return e?e.value:i.textValue};e.DropdownHelper.setupDropdownScope(i,t,o.find("input"),a),i.itemText=function(e){var t=_.findWhere(i.optionList,{value:e});return t?r.instant(t.translate):e},i.$watch("editMode",function(e){e&&(i.width=o.width())}),i.$watch("textValue",function(){return i.currentRow.index=-1})}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(){}return e.prototype.makeHtml=function(e){return textile(e)},e}();e.Module.instance().service("TextileConverter",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbTextile",["$sanitize","TextileConverter",function(e,t){return{restrict:"A",link:function(r,n,i){n.addClass("tb-textile tb-enable-selection"),r.$watch(i.tbTextile,function(r){var i=r?e(t.makeHtml(r)):"";n.html(i),n.find("a").not("[target]").attr("target","_blank")})}}}]),e.Module.instance().directive("tbTextilePlaintext",["$sanitize","TextileConverter",function(e,t){return{restrict:"A",link:function(r,n,i){r.$watch(i.tbTextilePlaintext,function(r){var i=r?e(t.makeHtml(r)):"",o=$(i).text();n.text(o)})}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbTimePicker",[function(){return{restrict:"E",replace:!0,templateUrl:"timePicker.html",require:"?ngModel",scope:{},link:function(t,r,n,i){function o(){var e=t.time.minute,r=t.time.hour;return s?e+=60*r:(12!==r&&(e+=60*r),"PM"===t.time.meridiem&&(e+=720)),e}if(i){var s=e.L10n.is24HourTimeCycle();t.use24HourTimeCycle=s,t.precisionIncludesMinutes="hours"!==n.precision,t.hours=s?_.range(0,24):_.range(1,13),t.minutes=_.range(0,60,15),t.$watch(o,function(e){i.$setViewValue(e)}),i.$render=function(){var e=i.$viewValue;if(e>=0&&1440>=e||(e=0,i.$setViewValue(0)),s)t.time={hour:Math.floor(e/60),minute:e%60};else{var r=Math.floor(e/60)%12;t.time={hour:r>0?r:12,minute:e%60,meridiem:e>=720?"PM":"AM"}}}}}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbTypeaheadFilter",["$translate",function(t){return e.FeatureFlags.reactTypeaheadFilter?{restrict:"E",replace:!0,link:function(e){e.props={filter:e.filter,getFieldValueQuery:function(){return e.getFieldValueQuery(e.filter.definition.field)},translate:t.instant}},template:'<span><tb:react-typeahead-filter props="props" /></span>'}:{restrict:"E",replace:!0,templateUrl:"typeaheadFilter.html"}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=100,r=3e3,n="linear",i="easeOutCubic";e.Module.instance().directive("tbToast",["ToasterService","$interval",function(o,s){return{restrict:"E",replace:!0,templateUrl:"inline_toast.html",scope:{toast:"=tbToast"},link:function(a,c,l){function u(){c.css("opacity",0),c.animate({opacity:1},t,n,function(){a.toast.timeoutDelay!==e.ToasterService.NoTimeout&&(a.toast.timeout=s(function(){return d()},a.toast.timeoutDelay,1))})}function d(){a.isFadingOut=!0,c.animate({opacity:0},r,i,function(){a.close(a.toast.id),a.$apply()})}a.close=function(){return o.close(a.toast.id)},a.stopTimer=function(){a.toast.timeout&&(s.cancel(a.toast.timeout),a.toast.timeout=null),a.isFadingOut&&(c.stop(),c.css("opacity",1))},a.restartTimer=function(){a.stopTimer(),a.toast.timeoutDelay!==e.ToasterService.NoTimeout&&(a.isFadingOut?d():a.toast.timeout=s(function(){return d()},a.toast.timeoutDelay,1))},u()}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbToaster",["ToasterService",function(e){return{restrict:"E",replace:!0,templateUrl:"inline_toaster.html",link:function(t){t.toasts=e.toasts}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbTooltipArea",["$parse",function(e){return{link:function(t,r,n){var i,o,s=10,a=e(n.tbTooltipArea),c=".tbTooltipArea",l=function(e){var n=a(t,{$event:e});if(n){o.text(n);var c=e.pageX-i.left+s,l=e.pageY-i.top+s;o.css({display:"block",left:c,top:l});var u=o.outerWidth(),d=o.outerHeight(),p=r.width(),h=r.height(),f=p-u,m=h-d;c>f&&(c=f,o.css("left",c)),l>m&&(l-=d+2*s,o.css("top",l))}else o.css("display","none")};r.on("mouseenter"+c,function(e){i=r.offset(),o&&o.remove(),o=$("<div>").addClass("tb-tooltip").appendTo(r),l(e),r.on("mousemove"+c,function(e){l(e)})}),r.on("mouseleave"+c,function(e){r.off("mousemove"+c),o.remove(),o=null}),t.$on("$destroy",function(){o&&(o.remove(),o=null),r.off(c)})}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbTopBar",function(){return{restrict:"E",replace:!0,templateUrl:"topBar.html",controller:e.TopBarCtrl,scope:{settings:"="}}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbTranscludeFn",function(){return{restrict:"A",link:function(e,t,r){var n=$();e.$watch(r.tbTranscludeFn,function(i){if(n.remove(),i){var o=e.$eval(r.tbTranscludeScope);i(function(e,r){angular.extend(r,o),n=e,t.append(n)})}})}}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbTypeaheadFormat",["$interpolate",function(e){function t(e){return _.escape(e).replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}function r(e,r,n){var i=(n?"\\b":"")+"("+_.compact(t(e).split(" ")).join("|")+")";return _.escape(r).replace(new RegExp(i,"gi"),"<strong>$&</strong>")}return{restrict:"A",link:function(t,n,i){var o=t.$eval(i.tbTypeaheadFormat),s=t.$eval(i.tbMatchPrefixesOnly),a=e(n.text())(t);o&&n.empty().append(r(o,a,s))}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbUpdateSiteLogoForm",[function(){return{templateUrl:"updateSiteLogoForm.html",replace:!0,restrict:"E",scope:{},require:"^?tbSettingsCoordinator",controller:t,link:function(e,t,r,n){if(e.form=t,e.fileInput=t.find('input[type="file"]'),e.previewImgWrapper=t.find(".tb-update-site-logo-preview-img-wrapper"),e.fileInput.on("change",function(){return e.$evalAsync(e.onFileInputChange)}),n){var i={save:function(){return e.submitSiteLogoForm()},cancel:function(){return e.init()},isBusy:function(){return!1},isFormUnchanged:function(){return!e.formIsDirty},isValid:function(){return e.formIsValid}};n.registerFormState(i)}e.init()}}}]);var t=function(){function t(r,n,i,o,s,a,c,l,u){r.endpoint=a+"updateSiteLogo",r.xsrfToken=n[e.CookieKeys.XsrfToken],r.usingCustomLogo=function(){return l.isUsingCustomSiteLogo()},r.dragAndDropEnabled=u.supportsDragAndDropEvents()&&u.supportsFormData()&&!u.isTouch(),r.previewEnabled=u.supportsFileReader(),r.init=function(){return r.fileInput.val(null),r.formIsDirty=!1,r.resetToDefault=!1,r.formIsValid=!0,r.errorMessage=void 0,r.file=void 0,r.filename=void 0,r.previewUrl=void 0,i.when({})},r.onFileAddedOrChanged=function(e,n){if(r.formIsDirty=!0,r.resetToDefault=!1,n&&!_.contains(t.SupportedImageTypes,n.type))r.formIsValid=!1,r.errorMessage=s.instant("uploadSiteLogoErrorFileTypeNotSupported");else if(n&&n.size&&n.size>t.MaxImageSize)r.formIsValid=!1,r.errorMessage=s.instant("uploadSiteLogoErrorFileLargerThan2Megabytes");else if(r.file=n,r.filename=e,r.formIsValid=!0,r.errorMessage=void 0,r.previewEnabled){var i=new FileReader;i.onload=function(){return r.$apply(function(){return r.previewUrl=i.result})},i.onerror=function(){return r.errorMessage=s.instant("uploadSiteLogoErrorFileReadError")},i.onloadstart=function(){return r.previewImgWrapper.addClass("tb-without-img")},i.onloadend=function(){return o(function(){return r.previewImgWrapper.removeClass("tb-without-img")},50)},i.readAsDataURL(r.file)}},r.onFileDrop=function(e){r.dragAndDropEnabled&&(r.fileInput.val(null),r.onFileAddedOrChanged(e.name,e))},r.onFileInputChange=function(){var e=r.fileInput;if(e.val()){var t=e.val().split("\\").pop(),n=e[0],i=n.files&&n.files[0];r.onFileAddedOrChanged(t,i)}else r.resetToDefault||r.init()},r.handleResetToDefaultClick=function(){r.fileInput.val(null),r.formIsDirty=!0,r.resetToDefault=!0,r.formIsValid=!0,r.errorMessage=void 0,r.file=void 0,r.filename=void 0,r.previewUrl=l.getServerTopBarLogo().image},r.getPreviewUrl=function(){return r.previewUrl?r.previewUrl:l.getTopBarLogo().image},r.submitSiteLogoForm=function(){if(r.formIsDirty){if(r.dragAndDropEnabled){var e;return e=r.resetToDefault?l.resetSiteLogoToDefault():l.uploadSiteLogo(r.file),e.then(function(e){return r.handleFormSubmitResult(e)})}return r.form.submit(),i.when({})}},r.handleFormSubmitResult=function(t){if(t.errors&&t.errors.length){switch(t.errors[0].code){case e.CommonErrorCode.FileSizeTooLarge:r.errorMessage=s.instant("uploadSiteLogoErrorFileLargerThan2Megabytes");break;case e.OnlineErrorCode.SiteCustomizationUnavailable:r.errorMessage=s.instant("actionNotAvailable");break;case e.OnlineErrorCode.InvalidImage:case e.OnlineErrorCode.ImageProcessingError:case e.OnlineErrorCode.StorageException:default:r.errorMessage=s.instant("uploadSiteLogoErrorSaveError")}return i.reject()}return c.refreshSessionInfo().then(function(){return r.init()})}}return t.SupportedImageTypes=["image/png","image/jpeg","image/gif"],t.MaxImageSize=2*e.ByteSizeConversionFactor.ONE_MB,t.$inject=["$scope","$cookies","$q","$timeout","$translate","RestApiPrefix","ServerService","LogoService","BrowserSupportService"],t}();e.UpdateSiteLogoCtrl=t,e.Module.instance().controller("UpdateSiteLogoCtrl",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=0;e.Module.instance().directive("tbUploadIframe",[function(){return{scope:{handleResult:"&",iframeId:"=?"},restrict:"E",replace:!0,link:function(e,r,n){e.iframeId="upload-iframe-"+t++;var i=angular.element('<iframe name="'+e.iframeId+'" border="0" width="0" height="0" style="width:0px;height:0px;border:none;display:none">');r.after(i),i.on("load",function(){var t=i.prop("contentWindow").result;t&&e.handleResult(t)})}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbUsernameInputValidator",function(){return{restrict:"A",require:"ngModel",link:function(e,t,r,n){var i=new RegExp("[;,]");n.$parsers.push(function(e){return n.$setValidity("username",!i.test(e)),e})}}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbUserOrGroupSelector",["SearchSuggestionsService",function(e){return{restrict:"E",templateUrl:"userOrGroupSelector.html",replace:!0,scope:{autoEdit:"=",userSelected:"&",groupSelected:"&"},link:function(t){t.selected={granteeType:"group"},t.userSearchSuggestions=function(t){return e.users(t)},t.groupSearchSuggestions=function(t){return e.groups(t)},t.$watch("selected.user",function(e){e&&(t.selected.user=null,t.userSelected({user:e}))}),t.$watch("selected.group",function(e){e&&(t.selected.group=null,t.groupSelected({group:e}))})}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbVisible",function(){return{restrict:"A",link:function(e,t,r){e.$watch(r.tbVisible,function(e){t.css({visibility:e?"visible":"hidden"})})}}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbWindowResize",["$parse",function(e){return{link:function(t,r,n){var i=e(n.tbWindowResize),o=angular.element(window),s=".tbWindowResize"+t.$id,a=_.debounce(function(){t.$apply(i(t))},50);o.on("resize"+s,function(){a()}),r.on("$destroy",function(){o.off(s)})}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbWorkerProcessStatus",["$interval","$translate","ServerService","HelpService",function(t,r,n,i){var o=6e4;return{scope:{process:"=",isPreferred:"&"},restrict:"E",replace:!0,templateUrl:"workerProcessStatus.html",link:function(s){var a,c=!1,l=function(){n.sendRequest(new e.ServerApi.GetWorkerProcessStatus({process:s.process})).then(function(e){c||(s.status=e.status,s.pending=e.pendingTransfers,s.syncTimestamp=e.syncTimestamp,a=t(l,o,1,!1))})};l(),s.showStatusText=function(){var t=s.status;switch(s.process.type){case e.ServerApi.WorkerProcessType.clusterController:return t===e.ServerApi.WorkerStatusType.down;case e.ServerApi.WorkerProcessType.fileStore:return _.contains([e.ServerApi.WorkerStatusType.activeSyncing,e.ServerApi.WorkerStatusType.down,e.ServerApi.WorkerStatusType.decommissioningReadOnly,e.ServerApi.WorkerStatusType.decommissionFailedReadOnly,e.ServerApi.WorkerStatusType.readyForRemoval],t);case e.ServerApi.WorkerProcessType.repository:return t===e.ServerApi.WorkerStatusType.statusNotAvailableSyncing;default:return!1}},s.statusText=function(){return r.instant(s.process.type+"_"+s.status+"_status")},s.statusTooltip=function(){return s.pending>0||s.status===e.ServerApi.WorkerStatusType.activeSyncing?r.instant("filestore_activesyncing_tooltip",{PENDING_COUNT:s.pending},e.L10n.Interpolations.Count):r.instant(s.process.type+"_"+s.status+"_tooltip")},s.statusIconType=function(){switch(s.status){case e.ServerApi.WorkerStatusType.active:case e.ServerApi.WorkerStatusType.decommissionFailedReadOnly:case e.ServerApi.WorkerStatusType.readyForRemoval:return e.ServerApi.WorkerStatusType.active;case e.ServerApi.WorkerStatusType.passive:case e.ServerApi.WorkerStatusType.readOnly:return e.ServerApi.WorkerStatusType.passive;case e.ServerApi.WorkerStatusType.busy:case e.ServerApi.WorkerStatusType.activeSyncing:case e.ServerApi.WorkerStatusType.decommissioningReadOnly:case e.ServerApi.WorkerStatusType.statusNotAvailableSyncing:return e.ServerApi.WorkerStatusType.busy;case e.ServerApi.WorkerStatusType.unlicensed:case e.ServerApi.WorkerStatusType.down:case e.ServerApi.WorkerStatusType.statusNotAvailable:return s.status}},s.serverStatusHelpUrl=i.getServerHelpUrlByCategory("status1"),s.$on(e.ServerStatusCtrl.refreshProcessStatusEvent,function(){t.cancel(a),s.status=void 0,l()}),s.$on("$destroy",function(){t.cancel(a),c=!0})}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().filter("credentialType",["$translate",function(t){return function(r){switch(r){case e.ServerApi.OAuthCredentialTypes.Salesforce:return t.instant("salesforce");case e.ServerApi.OAuthCredentialTypes.BigQuery:return t.instant("googleBigQuery");case e.ServerApi.OAuthCredentialTypes.GoogleAnalytics:return t.instant("googleAnalytics")}return""}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().filter("cronExpression",["$translate","$filter",function(t,r){return function(t){var n=r("cronExpression.dayOfWeekField")(e.CronExpressionHelper.getDayOfWeekField(t));return r("cronExpression.minutesOfHourField")(e.CronExpressionHelper.getMinutesField(t))+r("cronExpression.hoursOfDayField")(e.CronExpressionHelper.getHoursField(t))+(n?" "+n:"")}}]),e.Module.instance().filter("cronExpression.minutesOfHourField",["$translate","$filter",function(t,r){return function(n){var i=e.CronExpressionHelper.getTimeFieldSubsetParts(n);return _.isNumber(i.increment)?r("sentenceAsFragment")(t.instant("remoteRefreshScheduleExpressionStatementFragmentMinuteIncrement",{MINUTE_COUNT:i.increment},e.L10n.Interpolations.Count)):""}}]),e.Module.instance().filter("cronExpression.hoursOfDayField",["$translate","$filter",function(t,r){return function(n){var i="",o="",s=e.CronExpressionHelper.getTimeFieldSubsetParts(n);if(_.isNumber(s.increment)&&(o=t.instant("remoteRefreshScheduleExpressionStatementFragmentHourIncrement",{HOUR_COUNT:s.increment},e.L10n.Interpolations.Count),i=r("sentenceAsFragment")(o)),_.isNumber(s.from)&&_.isNumber(s.to)){var a=new Date;a.setHours(s.from,0,0,0);var c=new Date;c.setHours(s.to,0,0,0),o=t.instant("remoteRefreshScheduleExpressionStatementFragmentRange",{FROM_DATETIME:e.L10n.localizedShortTime(a),TO_DATETIME:e.L10n.localizedShortTime(c)}),i=i+" "+r("sentenceAsFragment")(o)}if(_.isNumber(s.specific)){var l=new Date;l.setHours(s.specific,0,0,0),o=t.instant("remoteRefreshScheduleExpressionStatementFragmentSpecific",{DATETIME:e.L10n.localizedShortTime(l)}),i=r("sentenceAsFragment")(o)}return i}}]),e.Module.instance().filter("cronExpression.dayOfWeekField",["$translate","$filter",function(t,r){return function(n){var i="",o="",s=function(e){return""!==e?e+" ":e};return _.each(n.split(","),function(a){var c=e.CronExpressionHelper.getTypeFromFieldSubset(a);if(c===e.CronExpressionFieldSubsetTypes.Range){i=s(i);var l=a.indexOf("-"),u=parseInt(a.substring(0,l),10),d=parseInt(a.substring(l+1),10);o=t.instant("remoteRefreshScheduleExpressionStatementFragmentRange",{FROM_DATETIME:r("cronExpression.specificDayOfWeek")(u),TO_DATETIME:r("cronExpression.specificDayOfWeek")(d)}),i+=r("sentenceAsFragment")(o)}else if(c===e.CronExpressionFieldSubsetTypes.Specific)i=s(i),o=r("cronExpression.specificDayOfWeek")(parseInt(a[0],10)),i+=r("sentenceAsFragment")(o);else if(c!==e.CronExpressionFieldSubsetTypes.All)throw"Cron day of week expression could not be parsed: "+n}),i}}]),e.Module.instance().filter("cronExpression.specificDayOfWeek",[function(){return function(t){var r=e.L10n.wideDayNames(),n=e.L10n.firstDayOfWeek();return r[(parseInt(t,10)+6-n)%7]}}]),e.Module.instance().filter("sentenceAsFragment",["$translate",function(e){return function(t){return e.instant("remoteRefreshScheduleExpressionStatementSentence",{FRAGMENT:t})}}]),e.Module.instance().filter("minutesOrHours",["$translate",function(e){return function(t){return 60>t?e.instant("minutes",{MINUTES:t}):e.instant("hours",{HOURS:Math.floor(t/60)})}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().filter("localizedLastSignedInDateTime",["$translate",function(t){return function(r){return r?e.L10n.localizedDateTime(r):t.instant("never")}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().filter("list",["$translate",function(e){function t(r){return 2===r.length?e.instant("listEnd",{START_ITEMS:r[0],LAST_ITEM:r[1]}):e.instant("listMiddle",{FIRST_ITEMS:r[0],LAST_ITEMS:t(r.slice(1))})}return function(r){switch(r.length){case 0:return"";case 1:return r[0];case 2:return e.instant("listTwo",{ITEM1:r[0],ITEM2:r[1]});default:return e.instant("listStart",{FIRST_ITEM:r[0],REMAINING_ITEMS:t(r.slice(1))})}}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().filter("localizedCount",function(){return e.L10n.localizedCount})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().filter("localizedDate",function(){return e.L10n.localizedDate}),e.Module.instance().filter("localizedDateTime",function(){return e.L10n.localizedDateTime}),e.Module.instance().filter("localizedTime",function(){return e.L10n.localizedTime})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().filter("localizedPercent",function(){return e.L10n.localizedPercent})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().filter("pad",function(){return function(e,t){return(1e4+e+"").slice(-t)}})}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().filter("remoteRefreshScheduleTypeName",["$translate",function(e){return function(t){return e.instant("remoteRefreshScheduleTypeName"+t)}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().filter("scheduleActionName",["$translate",function(t){return function(r){switch(r){case e.ServerApi.ScheduleActions.Extract:return t.instant("extractRefresh");case e.ServerApi.ScheduleActions.Subscription:return t.instant("subscription")}return""}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().filter("scheduleFrequencyDescription",["$translate","$filter",function(t,r){function n(t){var r=new Date;return r.setHours(t/60),r.setMinutes(t%60),e.L10n.localizedTime(r)}function i(e){var r=e.scheduleDetails,i=r.recurrenceMinutes<60?t.instant("minutes",{MINUTES:r.recurrenceMinutes}):t.instant("hours",{HOURS:r.recurrenceMinutes/60});return t.instant("scheduleHourlyDescription",{FREQUENCY:i,START:n(r.startTime),END:n(r.endTime)})}function o(e){var r=e.scheduleDetails;return t.instant("scheduleDailyDescription",{START:n(r.startTime)})}function s(e){var i=e.scheduleDetails,o=_.map(i.recurrenceDaysOfWeek,a);return t.instant("scheduleWeeklyDescription",{START:n(i.startTime),DAYS:r("list")(o)})}function a(e){return t.instant("dayName"+e)}function c(r){var i=r.scheduleDetails,o=i.recurrenceDayOfMonth===e.ServerApi.ScheduleLastDayOfMonth?t.instant("last"):t.instant("dayOfMonth",{DAY:parseInt(i.recurrenceDayOfMonth,10)});return t.instant("scheduleMonthlyDescription",{START:n(i.startTime),DAYOFMONTH:o})}return function(t){switch(t.scheduleType){case e.ServerApi.ScheduleTypes.Hourly:return i(t);case e.ServerApi.ScheduleTypes.Daily:return o(t);case e.ServerApi.ScheduleTypes.Weekly:return s(t);case e.ServerApi.ScheduleTypes.Monthly:return c(t)}throw"Unknown schedule type: "+t.scheduleType}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().filter("scheduleTypeName",["$translate",function(e){return function(t){return e.instant(t.toLowerCase())}}])}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().filter("siteRole",["$translate",function(e){return function(t){return t?e.instant("siteRole_"+t):""}}])}(VizPortal||(VizPortal={}));var VizPortalReact;!function(e){var t=function(){function e(){}return e.prototype.setUrl=function(e){window.location.href=e},e.prototype.search=function(){return window.location.search;
},e.instance=new e,e}();e.Location=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(){t.apply(this,arguments)}return __extends(r,t),r.prototype.render=function(){var t=_.extend({},{placeholder:this.props.translate?this.props.translate("search"):"",className:"tb-placeholder"},this.props);return t.style=_.extend({},{fontSize:e.CommonStyles.Sizes.SmallFontSize,fontFamily:e.CommonStyles.Fonts.BodyFont,paddingTop:e.CommonStyles.Sizes.TextBoxPadding,paddingBottom:e.CommonStyles.Sizes.TextBoxPadding,paddingLeft:e.CommonStyles.Sizes.TextBoxPadding+e.CommonStyles.Sizes.SmallIconSize,borderWidth:e.CommonStyles.Sizes.TextBoxBorderSize,borderColor:e.CommonStyles.Colors.BorderColor,borderStyle:"solid",boxSizing:"border-box",background:"url(img/magnifying_glass_small_normal.png) 0 center no-repeat",outline:"none"},this.props.style),React.DOM.input(t)},r.displayName="SearchBox",r.element=React.createFactory(r),r}(React.Component);e.SearchBox=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(){t.apply(this,arguments),this.state={data:[],selectedIndex:-1,searchTerm:"",searchBoxHeight:0,measuredRowHeight:0,indexOfFirstVisibleSection:0,indexOfLastVisibleSection:0,anyIcons:!1,maxCountDigits:0}}return __extends(r,t),r.prototype.render=function(){var t=this,r=React.DOM.div({style:{height:this.state.data.length*this.state.measuredRowHeight,overflow:"hidden"}},this.renderSections());return React.DOM.div({style:this.props.style},e.SearchBox.element({ref:"searchBox",placeholder:this.props.searchBoxPlaceholder,onChange:function(e){return t.searchTermChanged(e)},onKeyDown:function(e){return t.handleKeyDown(e)},style:{width:"100%"}}),React.DOM.div({ref:"listbox",style:{position:"absolute",left:0,right:0,top:this.state.searchBoxHeight+e.CommonStyles.Sizes.SmallSpace,bottom:0,overflowX:"hidden",overflowY:"auto"},onScroll:function(e){return t.onScroll(e)}},r))},r.prototype.renderSections=function(){for(var e=this,t=this.matchPrefixesOnly(),n=r.sectionSize*this.state.measuredRowHeight,i=[],o=this.state.indexOfFirstVisibleSection;o<=this.state.indexOfLastVisibleSection;o++){for(var s=o*r.sectionSize,a=Math.min(s+r.sectionSize-1,this.state.data.length-1),c=[],l=s;a>=l;l++){var u=this.state.data[l];c.push(r.Row.element({key:l,ref:r.ItemRefPrefix+l,item:u,searchTerm:this.state.searchTerm,matchPrefixesOnly:t,selected:l===this.state.selectedIndex,showIcon:this.state.anyIcons,maxCountDigits:this.state.maxCountDigits,onClick:function(){e.props.itemSelected&&e.props.itemSelected(u)}}))}var d=o===this.state.indexOfFirstVisibleSection?o*n:0;i.push(React.DOM.div({key:o,style:{marginTop:d,height:n,overflow:"hidden"}},c))}return i},r.prototype.matchPrefixesOnly=function(){return _.isBoolean(this.props.matchPrefixesOnly)?this.props.matchPrefixesOnly:!0},r.prototype.searchTermChanged=function(e){var t=this,r=e.target.value.toLowerCase(),n=0===r.length?-1:0;this.resetScrollPosition(),this.setState({searchTerm:r,selectedIndex:n},function(){return t.fetch()})},r.prototype.resetScrollPosition=function(){var e=$(React.findDOMNode(this.refs.listbox));e.scrollTop(0)},r.prototype.handleKeyDown=function(t){var r=this;switch(t.keyCode){case VizPortal.Keys.ArrowUp:this.setState({selectedIndex:Math.max(this.state.selectedIndex-1,0)},function(){return r.scrollItemIntoView()}),t.preventDefault(),t.stopPropagation();break;case VizPortal.Keys.ArrowDown:this.setState({selectedIndex:Math.min(this.state.selectedIndex+1,this.state.data.length-1)},function(){return r.scrollItemIntoView()}),t.preventDefault(),t.stopPropagation();break;case VizPortal.Keys.Enter:if(this.state.selectedIndex>=0&&this.state.selectedIndex<this.state.data.length){var n=this.state.data[this.state.selectedIndex];if(n.url){var i=this.props.locationService||e.Location.instance;i.setUrl(n.url)}this.props.itemSelected&&this.props.itemSelected(n),t.preventDefault(),t.stopPropagation()}}},r.prototype.scrollItemIntoView=function(){var e=$(React.findDOMNode(this.refs.listbox)),t=e.scrollTop(),r=e.height(),n=this.state.selectedIndex*this.state.measuredRowHeight,i=n+this.state.measuredRowHeight;t>n?e.scrollTop(n):i>t+r&&e.scrollTop(i-r),this.updateVisibleSectionIndexes()},r.prototype.componentDidMount=function(){var e=$(React.findDOMNode(this.refs.searchBox));setTimeout(function(){return e.focus()},0),this.setState({searchBoxHeight:e.outerHeight()}),this.fetch()},r.prototype.updateMaxCountDigitsAndIcons=function(){var e=this.state.anyIcons||_.any(this.state.data,function(e){return _.isString(e.icon)}),t=_.max(_.map(this.state.data,function(e){return e.count||0})),r=(""+t).length;this.setState({anyIcons:e,maxCountDigits:r})},r.prototype.measureRowHeight=function(){var e=_.find(_.keys(this.refs),function(e){return e.substr(0,r.ItemRefPrefix.length)===r.ItemRefPrefix}),t=$(React.findDOMNode(this.refs[e]));t.length>0&&this.setState({measuredRowHeight:t.outerHeight()})},r.prototype.onScroll=function(e){this.updateVisibleSectionIndexes()},r.prototype.updateVisibleSectionIndexes=function(){var e=this,t=this.calculateVisibleSectionIndexes();(t.indexOfFirstVisibleSection!==this.state.indexOfFirstVisibleSection||t.indexOfLastVisibleSection!==this.state.indexOfLastVisibleSection)&&this.setState(t,function(){return e.fetch()})},r.prototype.calculateVisibleSectionIndexes=function(){var e=this.state.measuredRowHeight||100,t=r.sectionSize*e,n=$(React.findDOMNode(this.refs.listbox)),i=n.scrollTop(),o=i+n.height(),s=Math.floor(i/t),a=Math.ceil(o/t);return{indexOfFirstVisibleSection:s,indexOfLastVisibleSection:a}},r.prototype.fetch=function(){var e=this,t=this.state.indexOfFirstVisibleSection*r.sectionSize,n=(this.state.indexOfLastVisibleSection+1)*r.sectionSize-1;this.props.itemStore.getItems(this.state.searchTerm,t,n).then(function(t){e.setState({data:t},function(){e.updateMaxCountDigitsAndIcons(),0===e.state.measuredRowHeight&&setTimeout(function(){return e.measureRowHeight()},0)})})},r.displayName="FilteringListBox",r.sectionSize=10,r.ItemRefPrefix="item",r.element=React.createFactory(r),r}(React.Component);e.FilteringListBox=t;var t;!function(t){var r=function(t){function r(){t.apply(this,arguments),this.state={hovered:!1}}return __extends(r,t),r.prototype.handleMouseOver=function(){this.setState({hovered:!0})},r.prototype.handleMouseOut=function(){this.setState({hovered:!1})},r.prototype.render=function(){var t=this,r=this.props.item,n=e.CommonStyles.Sizes.DefaultSpace+e.CommonStyles.Sizes.LineWidth,i=null;this.state.hovered&&(i=e.CommonStyles.Colors.Grey245),this.props.selected&&(i=e.CommonStyles.Colors.BlueHighlight);var o={display:"block",paddingLeft:e.CommonStyles.Sizes.DefaultSpace+(this.props.showIcon?e.CommonStyles.Sizes.SmallIconSize:0),paddingRight:0,paddingTop:n,paddingBottom:n,backgroundImage:r&&r.icon?"url("+r.icon+")":null,backgroundPosition:"1px center",backgroundRepeat:"no-repeat",backgroundColor:i,textDecoration:"none",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",color:e.CommonStyles.Colors.NormalTextColor};r.isDivider&&(o.paddingBottom--,o.borderBottom="1px solid "+e.CommonStyles.Colors.Grey224);var s=r&&_.isNumber(r.count)?React.DOM.span({style:{"float":"right",textAlign:"right",width:7*this.props.maxCountDigits,paddingLeft:e.CommonStyles.Sizes.DefaultSpace,paddingRight:e.CommonStyles.Sizes.SmallSpace}},r.count):null,a=this.itemLabel();return React.DOM.a({href:r&&r.url,style:o,onClick:function(){t.props.onClick()},onMouseOver:function(){return t.handleMouseOver()},onMouseOut:function(){return t.handleMouseOut()}},s,a)},r.prototype.itemLabel=function(){var e=this.props.item;if(!e)return React.DOM.span({className:"tb-icon-spinner"});var t=this.props.searchTerm?n.formatMatch(this.props.searchTerm,e.label,this.props.matchPrefixesOnly):_.escape(e.label);return""===t&&(t="&nbsp;"),React.DOM.span({dangerouslySetInnerHTML:{__html:t}})},r.displayName="FilteringListBoxRow",r.element=React.createFactory(r),r}(React.Component);t.Row=r;var n;!function(e){function t(e,t,n){if(0===t.length)return{fetchedRows:_.compact(e),estimatedTotalRowCount:e.length};var o=_.compact(e),s=o.length,a=r(t,n),c=_.compact(_.map(o,function(e){return a.test(e.label)?_.extend({},e,{labelHTML:i(t,e.label,n)}):null})),l=e.length-s,u=c.length;return l>0&&(u=s>0?Math.max(c.length+1,Math.ceil(e.length*c.length/s)):e.length),{fetchedRows:c,estimatedTotalRowCount:u}}function r(e,t){var r=_.compact(n(e).split(" ")),i=["^"];return _.each(r,function(e){i.push("(?=.*"+(t?"\\b":"")+e+")")}),new RegExp(i.join(""),"gi")}function n(e){return _.escape(e).replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}function i(e,t,r){var i=(r?"\\b":"")+"("+_.compact(n(e).split(" ")).join("|")+")";return _.escape(t).replace(new RegExp(i,"gi"),'<strong style="text-decoration: underline">$&</strong>')}e.filterDataBySearchTerm=t,e.formatMatch=i}(n=t.Filter||(t.Filter={}))}(t=e.FilteringListBox||(e.FilteringListBox={}))}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(e){function t(){e.apply(this,arguments),this.state={open:!1,hovered:!1}}return __extends(t,e),t.prototype.componentDidMount=function(){this.id=""+t.nextId++,this.closeMenuOnMouseDownOutside()},t.prototype.closeMenuOnMouseDownOutside=function(){var e=this,t=$(React.findDOMNode(this)),r=this.getEventNamespace(),n="mousedown"+r+" touchstart"+r;$(document).on(n,function(r){var n=$(r.target);0===n.closest(t).length&&e.setState({open:!1})})},t.prototype.componentWillUnmount=function(){$(document).off(this.getEventNamespace())},t.prototype.getEventNamespace=function(){return".mousedownOutside"+this.id},t.prototype.render=function(){var e=this,r=t.ButtonWrapper.element({onClick:function(){return e.toggleMenu()},menuButtonFactory:this.props.menuButtonFactory,menuOpen:this.state.open}),n=this.state.open?t.PanelWrapper.element({style:this.props.menuPanelStyle},this.props.menuPanelFactory({})):null,i=_.extend({},{position:"relative",display:"inline-block"},this.props.style);return React.DOM.span({"data-tb-test-id":this.props.tbTestId,style:i,onKeyDown:function(t){return e.onKeyDown(t)}},r,n)},t.prototype.onKeyDown=function(e){e.keyCode===VizPortal.Keys.Escape&&this.closeMenu()},t.prototype.toggleMenu=function(){this.isMenuOpen()?this.closeMenu():this.openMenu()},t.prototype.isMenuOpen=function(){return this.state.open},t.prototype.openMenu=function(){var e=this;this.props.onBeforeMenuOpen?this.props.onBeforeMenuOpen().then(function(){return e.setState({open:!0})}):this.setState({open:!0})},t.prototype.closeMenu=function(){this.setState({open:!1})},t.displayName="Menu",t.nextId=1,t.element=React.createFactory(t),t}(React.Component);e.Menu=t;var t;!function(e){var t=function(e){function t(){e.apply(this,arguments),this.state={hovered:!1}}return __extends(t,e),t.prototype.render=function(){var e=this;return React.DOM.span({onClick:function(){return e.props.onClick()},onMouseOver:function(){return e.handleMouseOver()},onMouseOut:function(){return e.handleMouseOut()},style:{cursor:"pointer"}},this.props.menuButtonFactory({hovered:this.state.hovered,menuOpen:this.props.menuOpen}))},t.prototype.handleMouseOver=function(){this.setState({hovered:!0})},t.prototype.handleMouseOut=function(){this.setState({hovered:!1})},t.displayName="MenuButtonWrapper",t.element=React.createFactory(t),t}(React.Component);e.ButtonWrapper=t;var r=function(e){function t(){e.apply(this,arguments),this.state={alignRight:!1}}return __extends(t,e),t.prototype.componentDidMount=function(){var e=$(React.findDOMNode(this)),t=e.offset().left+e.outerWidth(),r=$(window).width();t>=r&&this.setState({alignRight:!0})},t.prototype.render=function(){var e=_.extend({position:"absolute",left:this.state.alignRight?null:0,right:this.state.alignRight?0:null,zIndex:1,textAlign:"left"},this.props.style);return React.DOM.div({style:e},this.props.children)},t.displayName="MenuPanelWrapper",t.element=React.createFactory(t),t}(React.Component);e.PanelWrapper=r}(t=e.Menu||(e.Menu={}))}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(){t.apply(this,arguments),this.state={filteredData:this.props.data}}return __extends(r,t),r.prototype.render=function(){var t=this;return React.DOM.div({style:e.HeaderStyles.MenuPanelStyle},e.FilteringListBox.element({itemStore:{getItems:function(r,n,i){return Q.when(e.FilteringListBox.Filter.filterDataBySearchTerm(t.props.data,r,!0).fetchedRows)}},searchBoxPlaceholder:this.props.translate("searchFavorites"),itemSelected:function(){return t.props.itemSelected()},style:e.CommonStyles.Helpers.Edges(e.CommonStyles.Sizes.SmallSpace)}))},r.displayName="FavoritesMenuPanel",r.element=React.createFactory(r),r}(React.Component);e.FavoritesMenuPanel=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(){t.apply(this,arguments)}return __extends(r,t),r.prototype.render=function(){var t=this.props.hovered||this.props.menuOpen,r={display:"block",height:e.CommonStyles.Sizes.NormalIconSize,lineHeight:e.CommonStyles.Sizes.NormalIconSize+"px",fontFamily:e.CommonStyles.Fonts.HeaderFont,fontSize:e.CommonStyles.Sizes.HeaderFontSize,letterSpacing:e.HeaderStyles.LetterSpacing,color:e.CommonStyles.Colors.White,opacity:t?e.HeaderStyles.HoverOpacity:e.HeaderStyles.RestOpacity};return this.props.iconUrl&&_.extend(r,{paddingLeft:e.CommonStyles.Sizes.NormalIconSize+e.CommonStyles.Sizes.SmallSpace,backgroundImage:this.props.iconUrl,backgroundPosition:"left center",backgroundRepeat:"no-repeat"}),_.extend(r,this.props.style),React.DOM.span({style:r},this.props.label)},r.displayName="HeaderMenuButton",r.element=React.createFactory(r),r}(React.Component);e.HeaderMenuButton=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(){t.apply(this,arguments),this.state={data:[]}}return __extends(r,t),r.prototype.render=function(){var t=this;return e.Menu.element({ref:"menu",tbTestId:"favorites-menu",style:this.props.style,menuButtonFactory:function(t){return t.iconUrl="url(img/star_header_icon.png)",e.HeaderMenuButton.element(t)},menuPanelFactory:function(r){return r.translate=t.props.translate,r.data=t.state.data,r.itemSelected=function(){t.refs.menu.closeMenu()},e.FavoritesMenuPanel.element(r)},onBeforeMenuOpen:function(){return t.loadFavorites()}})},r.prototype.loadFavorites=function(){var t=this;return this.props.favoritesStore.getAll().then(function(r){var n=_.map(r,function(r){return{label:r.objectName,icon:r.objectType===VizPortal.FavoriteObjectType.VIEW?e.CommonStyles.IconUrls.View:e.CommonStyles.IconUrls.Workbook,url:r.objectType===VizPortal.FavoriteObjectType.VIEW?t.props.siteUrls.favoriteView(r.objectId):t.props.siteUrls.favoriteWorkbook(r.objectId)}});t.setState({data:n})})},r.displayName="FavoritesMenu",r.element=React.createFactory(r),r}(React.Component);e.FavoritesMenu=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(){function t(e){this.siteNames=e}return t.prototype.getAll=function(){return e.StoreHelpers.getAll(this.siteNames.all())},t}();e.SiteStore=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(){t.apply(this,arguments)}return __extends(r,t),r.prototype.render=function(){var t=this.props.hovered||this.props.menuOpen,r=e.CommonStyles.Sizes.NormalIconSize+e.CommonStyles.Sizes.SmallSpace;return React.DOM.span({style:{display:"inline-block",width:150+r,overflow:"hidden",textOverflow:"ellipsis",textAlign:"right",verticalAlign:"middle",fontFamily:e.CommonStyles.Fonts.HeaderFont,fontSize:e.CommonStyles.Sizes.HeaderFontSize,letterSpacing:"0.08em",color:t?e.HeaderStyles.SiteSwitcherHoverColor:e.HeaderStyles.SiteSwitcherRestColor,opacity:t?e.HeaderStyles.SiteSwitcherHoverOpacity:e.HeaderStyles.SiteSwitcherRestOpacity,paddingRight:r,backgroundImage:"url(img/"+(t?e.HeaderStyles.SiteSwitcherDropdownHoverImage:e.HeaderStyles.SiteSwitcherDropdownRestImage)+")",backgroundPosition:"right center",backgroundRepeat:"no-repeat"},"data-tb-test-id":"site-switcher-button"},this.props.buttonTitle)},r.displayName="SiteSwitcherMenuButton",r.element=React.createFactory(r),r}(React.Component);e.SiteSwitcherMenuButton=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(){t.apply(this,arguments)}return __extends(r,t),r.prototype.render=function(){var t=this,r=_.extend({},e.HeaderStyles.MenuPanelStyle,{width:210,height:300});return React.DOM.div({style:r,"data-tb-test-id":"site-switcher-dropdown"},e.FilteringListBox.element({itemStore:{getItems:function(r,n,i){var o=e.FilteringListBox.Filter.filterDataBySearchTerm(t.props.sites,r,!0).fetchedRows;return""===r&&o.splice(0,0,{label:t.props.translate("siteSwitcher_manageAllSites"),url:t.props.serverUrls.status(),icon:t.props.onServerPage?"img/bullet.png":null,isDivider:!0}),Q.when(o)}},searchBoxPlaceholder:this.props.translate("search"),itemSelected:function(){return t.props.itemSelected()},style:e.CommonStyles.Helpers.Edges(e.CommonStyles.Sizes.SmallSpace)}))},r.displayName="SiteSwitcherMenuPanel",r.element=React.createFactory(r),r}(React.Component);e.SiteSwitcherMenuPanel=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(){t.apply(this,arguments),this.state={sites:[]}}return __extends(r,t),r.prototype.render=function(){var t=this;return e.Menu.element({ref:"menu",tbTestId:"site-switcher",menuButtonFactory:function(r){return r.buttonTitle=t.onServerPage()?t.props.translate("siteSwitcher_allSites"):t.props.currentSite&&t.props.currentSite.name||"",e.SiteSwitcherMenuButton.element(r)},menuPanelFactory:function(r){return r.translate=t.props.translate,r.sites=t.state.sites,r.itemSelected=function(){t.refs.menu.closeMenu()},r.serverUrls=t.props.serverUrls,r.onServerPage=t.onServerPage(),e.SiteSwitcherMenuPanel.element(r)},onBeforeMenuOpen:function(){return t.loadSites()}})},r.prototype.loadSites=function(){var e=this;return this.props.siteStore.getAll().then(function(t){var r=_.map(t,function(t){var r=!e.onServerPage()&&e.props.currentSite.urlName===t.urlName;return{label:t.name,icon:r?"img/bullet.png":null,url:e.siteUrl(t)}});e.setState({sites:r})})},r.prototype.onServerPage=function(){return e.Navigation.isServerLocation(this.props.navLocation)},r.prototype.siteUrl=function(t){var r=t.urlName?"#/site/"+t.urlName+"/projects":"#/projects",n=(this.props.location||e.Location.instance).search();return"/"+n+r},r.displayName="SiteSwitcher",r.element=React.createFactory(r),r}(React.Component);e.SiteSwitcher=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){function t(r){r.getCount().then(function(r){var n={actionType:t.Type,count:r};e.Dispatcher.instance.dispatch(n)})}function r(t){t.getList().then(function(t){var n={actionType:r.Type,alerts:t};e.Dispatcher.instance.dispatch(n)})}function n(t){e.Dispatcher.instance.dispatch({actionType:n.Type,alertId:t})}var i=function(){function e(e,t,r,n){this.alerts=e,this.extractTasks=t,this.datasources=r,this.workbooks=n}return e.prototype.getAlertCount=function(){t(this.alerts)},e.prototype.getAlerts=function(){r(this.alerts)},e.prototype.tryAgain=function(e){var t=this,r=e.taskId,i=e.alertType;if(r)this.extractTasks.run([r]).then(function(){return t.getAlerts()});else if(i){var o=e.datasource&&e.datasource.id,s=e.workbooks&&e.workbooks[0]&&e.workbooks[0].id;o?this.datasources.refreshExtracts([o],i).then(function(){return function(){return t.getAlerts()}}):s&&this.workbooks.refreshExtracts([s],i).then(function(){return function(){return t.getAlerts()}})}n(e.id)},e}();e.AlertActions=i,e.GetAlertCountAction=t;var t;!function(e){e.Type="get-alert-count"}(t=e.GetAlertCountAction||(e.GetAlertCountAction={})),e.GetAlertsAction=r;var r;!function(e){e.Type="get-alerts"}(r=e.GetAlertsAction||(e.GetAlertsAction={})),e.AlertTryAgainAction=n;var n;!function(e){e.Type="alert-try-again"}(n=e.AlertTryAgainAction||(e.AlertTryAgainAction={}))}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(){var n=this;t.call(this),this.alertList=r.AlertsPending,e.Dispatcher.instance.register(function(t){switch(t.actionType){case e.GetAlertCountAction.Type:n.count=t.count,n.broadcast();break;case e.GetAlertsAction.Type:n.alertList=t.alerts,n.count=n.alertList.total,n.broadcast();break;case e.AlertTryAgainAction.Type:var r=t.alertId,i=_.filter(n.alertList.alerts,function(e){return e.id!==r});n.alertList={alerts:i,total:i.length},n.count=i.length,n.broadcast()}})}return __extends(r,t),r.prototype.getCount=function(){return this.count},r.prototype.getAlerts=function(){return this.alertList},r.AlertsPending={total:0,alerts:[]},r}(e.Store);e.AlertsStore=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.componentDidMount=function(){this.props.alertActions.getAlerts()},n.prototype.render=function(){return React.DOM.div({style:n.alertsMenuContainerStyle},this.alertItems())},n.prototype.alertItems=function(){var t=this,n=this.props.alertsStore.getAlerts();return n===e.AlertsStore.AlertsPending?null:0===n.alerts.length?React.DOM.div({style:{padding:e.CommonStyles.Sizes.DefaultSpace,fontStyle:"italic"}},this.props.translate("noAlerts")):React.DOM.div({},_.map(n.alerts,function(e){return r.element({key:e.id,translate:t.props.translate,siteUrls:t.props.siteUrls,alertActions:t.props.alertActions,alert:e,itemSelected:t.props.itemSelected})}))},n.displayName="AlertsMenuPanel",n.element=React.createFactory(n),n.alertsMenuContainerStyle=_.extend({},e.HeaderStyles.MenuPanelStyle,{width:350,height:"inherit",maxHeight:600,overflow:"auto",padding:e.CommonStyles.Sizes.SmallSpace}),n}(React.Component);e.AlertsMenuPanel=t;var r=function(t){function r(){t.apply(this,arguments)}return __extends(r,t),r.prototype.render=function(){var e=this,t=this.props.alert;return React.DOM.div({className:"tb-alert-item",style:{whiteSpace:"normal"}},React.DOM.span({style:{fontWeight:"bold"}},this.title()),React.DOM.table({cellSpacing:"0",cellPadding:"0"},React.DOM.tr({},this.labelCell(this.props.translate("tableDatasource")),React.DOM.td({},t.datasource?React.DOM.a({href:this.props.siteUrls.datasourceDetailsUrl(t.datasource.id),onClick:function(){return e.props.itemSelected()}},t.datasource.name):this.props.translate("embedded"))),React.DOM.tr({},this.labelCell(this.props.translate("tableFailureType")),React.DOM.td({},this.failureType(t.statusCode))),React.DOM.tr({},this.labelCell(this.props.translate("tableRefreshFailed")),React.DOM.td({},this.dateTimeOrNever(t.mostRecentFailureAt))),React.DOM.tr({},this.labelCell(this.props.translate("tableLastRefresh")),React.DOM.td({},this.dateTimeOrNever(t.lastSuccessAt))),this.tryAgainLink(),this.connectionDetailsLink()))},r.prototype.labelCell=function(e){return React.DOM.td({style:r.labelStyle},e)},r.prototype.title=function(){var e=this.props.alert.workbooks;return e&&0!==e.length?1===e.length?this.props.translate("outOfDateWithName",{NAME:VizPortal.L10n.elideIfLong(e[0].name)}):this.props.translate("outOfDateWorkbooksWithCount",{LIST_COUNT:e.length},VizPortal.L10n.Interpolations.Count):this.props.translate("outOfDateWorkbookNone")},r.prototype.failureType=function(e){switch(e){case VizPortal.AlertErrorCode.AlertSignInFailed:case VizPortal.AlertErrorCode.AlertRemoteSignInFailed:return this.props.translate("signInFailedUnknownReason");case VizPortal.AlertErrorCode.AlertExpiredPassword:case VizPortal.AlertErrorCode.AlertRemoteExpiredPassword:return this.props.translate("expiredPassword");case VizPortal.AlertErrorCode.AlertAccessTokenValidation:return this.props.translate("accessTokenValidation");case VizPortal.AlertErrorCode.AlertAuthConfiguration:return this.props.translate("authConfiguration");case VizPortal.AlertErrorCode.AlertConnectionFailure:case VizPortal.AlertErrorCode.AlertRemoteConnectionFailure:return this.props.translate("connectionFailure");case VizPortal.AlertErrorCode.AlertOverlappingSchedules:return this.props.translate("overlappingSchedules");case VizPortal.AlertErrorCode.AlertFullRefreshRequired:return this.props.translate("fullRefreshRequired");case VizPortal.AlertErrorCode.AlertConnectionlessFailure:return this.props.translate("connectionlessFailure");default:return this.props.translate("unknownFailure")}},r.prototype.dateTimeOrNever=function(e){return e?VizPortal.L10n.localizedDateTime(e):this.props.translate("never")},r.prototype.tryAgainLink=function(){var e=this;return this.isRemoteRefresh()?null:React.DOM.tr({},React.DOM.td({colSpan:2},React.DOM.a({onClick:function(){e.props.alertActions.tryAgain(e.props.alert),e.props.itemSelected()}},this.props.translate("tryAgain"))))},r.prototype.connectionDetailsLink=function(){var t=this;return this.isEditableFailure()&&(this.props.alert.datasource||0!==this.props.alert.workbooks.length)?React.DOM.tr({},React.DOM.td({colSpan:2},React.DOM.a({href:this.props.alert.datasource?this.props.siteUrls.datasourceDataConnectionUrl(this.props.alert.datasource.id):this.props.siteUrls.workbookDatasourcesUrl(this.props.alert.workbooks[0].id),style:{"float":"right",marginRight:e.CommonStyles.Sizes.DefaultSpace,color:e.CommonStyles.Colors.ActionOrange},onClick:function(){return t.props.itemSelected()}},this.props.translate("connectionDetails")))):null},r.prototype.isEditableFailure=function(){return this.props.alert.statusCode!==VizPortal.AlertErrorCode.AlertOverlappingSchedules},r.prototype.isRemoteRefresh=function(){return _.contains(r.remoteRefreshStatusCodes,this.props.alert.statusCode)},r.displayName="AlertsMenuItem",r.element=React.createFactory(r),r.remoteRefreshStatusCodes=[VizPortal.AlertErrorCode.AlertRemoteUnknownFailure,VizPortal.AlertErrorCode.AlertRemoteSignInFailed,VizPortal.AlertErrorCode.AlertRemoteExpiredPassword,VizPortal.AlertErrorCode.AlertRemoteConnectionFailure],r.labelStyle={whiteSpace:"nowrap",paddingTop:e.CommonStyles.Sizes.SmallSpace,paddingBottom:e.CommonStyles.Sizes.SmallSpace,paddingRight:e.CommonStyles.Sizes.DefaultSpace},r}(React.Component);e.AlertsMenuItem=r}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(e){t.call(this,e),this.state={alertCount:void 0},this.boundOnAlertsStoreChange=this.onAlertsStoreChange.bind(this)}return __extends(r,t),r.prototype.componentDidMount=function(){this.props.alertsStore.addChangeListener(this.boundOnAlertsStoreChange),this.getAlertCount()},r.prototype.componentWillUnmount=function(){this.props.alertsStore.removeChangeListener(this.boundOnAlertsStoreChange)},r.prototype.onAlertsStoreChange=function(){this.setState({alertCount:this.props.alertsStore.getCount()})},r.prototype.getAlertCount=function(){this.props.alertActions.getAlertCount()},r.prototype.render=function(){var t=this;return e.Menu.element({ref:"menu",tbTestId:"alerts-menu",style:this.props.style,menuButtonFactory:function(r){var n=t.state.alertCount;return r.iconUrl="url(img/alert_header_icon.png)",r.label=_.isNumber(n)&&n>0?n.toString():"",r.style={fontSize:e.HeaderStyles.AlertsCountFontSize},e.HeaderMenuButton.element(r)},menuPanelFactory:function(r){return r.translate=t.props.translate,r.itemSelected=function(){t.refs.menu.closeMenu()},r.alertActions=t.props.alertActions,r.alertsStore=t.props.alertsStore,r.siteUrls=t.props.siteUrls,e.AlertsMenuPanel.element(r)}})},r.displayName="AlertsMenu",r.element=React.createFactory(r),r}(React.Component);e.AlertsMenu=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(e){var r=this;t.call(this,e),this.boundItemSelected=function(){return r.props.itemSelected()},this.boundShowAbout=function(){r.props.helpActions.showAbout(),r.props.itemSelected()},this.boundShowGettingStarted=function(){r.props.helpActions.showGettingStarted(),r.props.itemSelected()}}return __extends(r,t),r.prototype.render=function(){return React.DOM.div({style:r.helpMenuContainerStyle},this.renderSearchBox(),this.renderMenuItems())},r.prototype.renderSearchBox=function(){var t=this;return React.DOM.input({ref:"searchBox",style:{width:"100%",boxSizing:"border-box",height:e.CommonStyles.Sizes.RowHeight,fontFamily:e.CommonStyles.Fonts.BodyFont,fontSize:e.CommonStyles.Sizes.SmallFontSize,border:"1px solid "+e.CommonStyles.Colors.Grey178,color:e.CommonStyles.Colors.GreyTextColor,backgroundImage:"url(img/magnifying_glass_small_normal.png)",backgroundPosition:"left center",backgroundRepeat:"no-repeat",paddingLeft:23,outline:"none"},placeholder:this.props.translate("searchHelp"),onKeyDown:function(e){if(e.keyCode===VizPortal.Keys.Enter){var r=$(React.findDOMNode(t.refs.searchBox)),n=r.val();r.val(""),t.props.itemSelected(),t.props.helpActions.searchHelp(n)}}})},r.prototype.renderMenuItems=function(){var t=[e.HeaderMenuItem.element({key:"help",label:this.props.serverHelpLabel,url:this.props.serverHelpUrl,target:"_blank",onClick:this.boundItemSelected})];return this.props.isOfflineHelpEnabled||t.push(e.HeaderMenuItem.element({key:"support",label:this.props.translate("support"),url:this.props.supportUrl,target:"_blank",onClick:this.boundItemSelected})),this.props.showGettingStartedLink&&t.push(e.HeaderMenuItem.element({key:"welcomeScreen",label:this.props.translate("welcomeScreen"),onClick:this.boundShowGettingStarted})),t.push(e.HeaderMenuItem.element({key:"aboutServer",label:this.props.translate("aboutServer",{SERVER_NAME:this.props.serverName}),onClick:this.boundShowAbout})),t},r.displayName="HelpMenuPanel",r.element=React.createFactory(r),r.helpMenuContainerStyle=_.extend({},e.HeaderStyles.MenuPanelStyle,{height:"auto",padding:e.CommonStyles.Sizes.SmallSpace}),r}(React.Component);e.HelpMenuPanel=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(){t.apply(this,arguments)}return __extends(r,t),r.prototype.render=function(){var t=this;return e.Menu.element({ref:"menu",tbTestId:"help-menu",style:this.props.style,menuButtonFactory:function(t){return t.iconUrl="url(img/help_header_icon.png)",e.HeaderMenuButton.element(t)},menuPanelFactory:function(r){return r.itemSelected=function(){t.refs.menu.closeMenu()},_.extend(r,t.props),e.HelpMenuPanel.element(r)}})},r.displayName="HelpMenu",r.element=React.createFactory(r),r}(React.Component);e.HelpMenu=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(){var e=this;t.apply(this,arguments),this.state={hovered:!1,open:!1},this.boundBlur=function(){return e.handleBlur()},this.boundClick=function(){return e.handleClick()},this.boundMouseEnter=function(){return e.setState({hovered:!0})},this.boundMouseLeave=function(){return e.setState({hovered:!1})}}return __extends(r,t),r.prototype.handleClick=function(){this.setState({open:!0},function(){setTimeout(function(){$('input[name="omniboxTextBox"]').focus()},0)})},r.prototype.handleBlur=function(){this.setState({hovered:!1,open:!1})},r.prototype.render=function(){return React.DOM.div({onMouseEnter:this.boundMouseEnter,onMouseLeave:this.boundMouseLeave},this.contents())},r.prototype.contents=function(){if(this.state.open){var t=e.AngularDirective.element({angularContext:this.props.angularContext,template:"<tb:omnibox ng-show='showSiteControls()'></tb:omnibox>"});return React.DOM.div({ref:"omniboxSearchOpen",style:{paddingRight:"12px",width:"350px"},onBlur:this.boundBlur},t)}return React.DOM.span({ref:"omniboxSearchClosed",style:{backgroundImage:"url(img/magnifying_glass_large_white_normal.png)",backgroundPosition:"left center",backgroundRepeat:"no-repeat",cursor:"pointer",opacity:this.state.hovered?e.HeaderStyles.HoverOpacity:e.HeaderStyles.RestOpacity,padding:"12px 24px 12px 12px"},onClick:this.boundClick})},r.displayName="HeaderSearchBox",r.element=React.createFactory(r),r}(React.Component);e.HeaderSearchBox=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(e){function t(){e.apply(this,arguments);
}return __extends(t,e),t.prototype.render=function(){var e=this.props.logo;return React.DOM.a({href:e.href||this.props.siteUrls.projectsUrl(),"data-tb-test-id":"top-bar-logo-link",tabIndex:-1,style:{width:e.width,height:e.height,backgroundImage:"url("+e.image+")",display:"inline-block",marginLeft:18,marginRight:35,marginTop:9,marginBottom:9,whiteSpace:"pre"},title:e.title}," ")},t.displayName="Logo",t.element=React.createFactory(t),t}(React.Component);e.Logo=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(e){var r=this;t.call(this,e),this.state={hovered:!1},this.boundMouseEnter=function(){return r.setState({hovered:!0})},this.boundMouseLeave=function(){return r.setState({hovered:!1})}}return __extends(r,t),r.prototype.render=function(){var t=_.extend({},r.linkStyle,{color:this.props.isDisabled?e.CommonStyles.Colors.Grey224:e.CommonStyles.Colors.Grey102,backgroundColor:this.state.hovered&&!this.props.isDisabled?e.CommonStyles.Colors.Grey245:"inherit"});return React.DOM.a({href:this.props.url,title:this.props.title,target:this.props.target,style:t,onClick:this.props.onClick,onMouseEnter:this.boundMouseEnter,onMouseLeave:this.boundMouseLeave},this.props.label)},r.displayName="HeaderMenuItem",r.element=React.createFactory(r),r.linkStyle={display:"block",padding:e.CommonStyles.Sizes.DefaultSpace,textDecoration:"none",color:e.CommonStyles.Colors.Grey102},r}(React.Component);e.HeaderMenuItem=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(e){var r=this;t.call(this,e),this.boundItemSelected=function(){return r.props.itemSelected()},this.boundSignout=function(){r.props.userActions.signout(),r.props.itemSelected()},this.boundChangeUserStartPage=function(){r.props.userActions.changeUserStartPage(),r.props.itemSelected()},this.boundChangeDefaultStartPage=function(){r.props.userActions.changeDefaultStartPage(),r.props.itemSelected()}}return __extends(r,t),r.prototype.render=function(){var t=[],n=this.props.isSessionMultiSite&&e.Navigation.isServerLocation(this.props.location);if(n?(t.push(e.HeaderMenuItem.element({key:"myContentSiteOnly",label:this.props.translate("myContentSiteOnly"),isDisabled:!0})),t.push(e.HeaderMenuItem.element({key:"myAccountSettingsServer",label:this.props.translate("myAccountSettingsServer"),url:this.props.serverUrls.userSettingsUrl(this.props.user),onClick:this.boundItemSelected}))):(t.push(e.HeaderMenuItem.element({key:"myContent",label:this.props.translate("myContent"),url:this.props.siteUrls.userContentUrl(this.props.user),onClick:this.boundItemSelected})),t.push(e.HeaderMenuItem.element({key:"myAccountSettings",label:this.props.translate("myAccountSettings"),url:this.props.siteUrls.userSettingsUrl(this.props.user),onClick:this.boundItemSelected}))),t.push(e.HeaderMenuItem.element({key:"userStartPageChange",label:this.props.translate("userStartPageChange"),onClick:this.boundChangeUserStartPage})),this.props.isSessionServerAdmin){var i=this.props.location===e.Navigation.Location.SiteContent;t.push(e.HeaderMenuItem.element({key:"defaultStartPageChange",isDisabled:!i,title:i?"":this.props.translate("defaultStartPageRestriction"),label:this.props.translate("defaultStartPageChange"),onClick:this.boundChangeDefaultStartPage}))}if(this.props.isLogoutEnabled){var o=this.props.authenticationType===VizPortal.ServerApi.AuthenticationType.Sspi||this.props.authenticationType===VizPortal.ServerApi.AuthenticationType.Kerberos;t.push(e.HeaderMenuItem.element({key:"signOut",label:o?this.props.translate("switchUser"):this.props.translate("signOut"),onClick:this.boundSignout}))}return React.DOM.div({style:r.userMenuContainerStyle},t)},r.displayName="UserMenuPanel",r.element=React.createFactory(r),r.userMenuContainerStyle=_.extend({},e.HeaderStyles.MenuPanelStyle,{height:"auto",padding:e.CommonStyles.Sizes.SmallSpace}),r}(React.Component);e.UserMenuPanel=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(){t.apply(this,arguments)}return __extends(r,t),r.prototype.render=function(){var t=this;return e.Menu.element({ref:"menu",tbTestId:"user-menu",style:this.props.style,menuButtonFactory:function(r){return r.label=t.props.user.displayName,r.iconUrl="url(img/dropdown_arrow_header_icon.png)",r.style={paddingLeft:0,paddingRight:e.CommonStyles.Sizes.NormalIconSize,backgroundPosition:"right center"},e.HeaderMenuButton.element(r)},menuPanelFactory:function(r){return r.translate=t.props.translate,r.itemSelected=function(){t.refs.menu.closeMenu()},r.siteUrls=t.props.siteUrls,r.serverUrls=t.props.serverUrls,r.user=t.props.user,r.userActions=t.props.userActions,r.location=t.props.location,r.isLogoutEnabled=t.props.isLogoutEnabled,r.isSessionMultiSite=t.props.isSessionMultiSite,r.isSessionServerAdmin=t.props.isSessionServerAdmin,r.authenticationType=t.props.authenticationType,e.UserMenuPanel.element(r)}})},r.displayName="UserMenu",r.element=React.createFactory(r),r}(React.Component);e.UserMenu=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(){function e(e,t){this.serverService=e,this.userSettingsActions=t}return e.prototype.signout=function(){this.serverService.signOut()},e.prototype.changeUserStartPage=function(){this.userSettingsActions.confirmChangeUserStartPage()},e.prototype.changeDefaultStartPage=function(){this.userSettingsActions.confirmChangeDefaultStartPage()},e}();e.UserActions=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(){t.apply(this,arguments),this.state={}}return __extends(r,t),r.prototype.render=function(){return VizPortal.FeatureFlags.reactTopBar?React.DOM.div({style:{backgroundColor:e.HeaderStyles.HeaderBackgroundColor}},this.logo(),React.DOM.div({style:{position:"absolute",top:0,left:this.props.logo.width+48,right:0}},React.DOM.div({style:{display:"table",width:"100%",whiteSpace:"nowrap",fontSize:e.CommonStyles.Sizes.HeaderFontSize}},React.DOM.div({style:{display:"table-row"}},this.siteSwitcher(),this.navigation(),this.onServerPage()?null:this.searchBox(),this.menus())))):React.DOM.div({})},r.prototype.onServerPage=function(){return e.Navigation.isServerLocation(this.props.navLocation)},r.prototype.logo=function(){return e.Logo.element({siteUrls:this.props.siteUrls,logo:this.props.logo})},r.prototype.tableCell=function(e,t,r){return r=_.extend({display:"table-cell",verticalAlign:"middle"},r),React.DOM.div({key:e,style:r},t)},r.prototype.siteSwitcher=function(){return this.tableCell("siteSwitcher",e.SiteSwitcher.element({siteStore:this.props.siteStore,translate:this.props.translate,location:this.props.location,navLocation:this.props.navLocation,currentSite:this.props.currentSite,serverUrls:this.props.serverUrls}))},r.prototype.searchBox=function(){return this.tableCell("searchBox",e.HeaderSearchBox.element({angularContext:this.props.angularContext}))},r.prototype.menus=function(){var e=[];return this.onServerPage()||(e.push(this.alertsMenu()),e.push(this.favoritesMenu())),e.push(this.helpMenu()),e.push(this.userMenu()),this.tableCell("menus",React.DOM.div({},e),{width:"100%",textAlign:"right"})},r.prototype.alertsMenu=function(){return e.AlertsMenu.element({key:"alerts",style:r.menuButtonStyle,angularContext:this.props.angularContext,translate:this.props.translate,alertsStore:this.props.alertsStore,alertActions:this.props.alertActions,siteUrls:this.props.siteUrls})},r.prototype.favoritesMenu=function(){return e.FavoritesMenu.element({key:"favorites",style:r.menuButtonStyle,angularContext:this.props.angularContext,favoritesStore:this.props.favoritesStore,translate:this.props.translate,siteUrls:this.props.siteUrls})},r.prototype.helpMenu=function(){return e.HelpMenu.element({key:"help",style:r.menuButtonStyle,angularContext:this.props.angularContext,translate:this.props.translate,helpActions:this.props.helpActions,isOfflineHelpEnabled:this.props.isOfflineHelpEnabled,showGettingStartedLink:this.props.showGettingStartedLink,serverHelpLabel:this.props.serverHelpLabel,serverHelpUrl:this.props.serverHelpUrl,supportUrl:this.props.supportUrl,serverName:this.props.serverName})},r.prototype.userMenu=function(){return e.UserMenu.element({key:"user",style:r.menuButtonStyle,angularContext:this.props.angularContext,translate:this.props.translate,user:this.props.user,siteUrls:this.props.siteUrls,serverUrls:this.props.serverUrls,userActions:this.props.userActions,location:this.props.navLocation,isLogoutEnabled:this.props.isLogoutEnabled,isSessionMultiSite:this.props.isSessionMultiSite,isSessionServerAdmin:this.props.isSessionServerAdmin,authenticationType:this.props.authenticationType})},r.prototype.navigation=function(){return this.tableCell("navigation",e.Navigation.element({translate:this.props.translate,siteUrls:this.props.siteUrls,serverUrls:this.props.serverUrls,currentLocation:this.props.navLocation,hideRightDivider:this.onServerPage()}))},r.displayName="TopBar",r.element=React.createFactory(r),r.menuButtonStyle={marginRight:16,verticalAlign:"top"},r}(React.Component);e.TopBar=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(){t.apply(this,arguments)}return __extends(r,t),r.prototype.render=function(){var t=(this.props.hovered||this.props.menuOpen,React.DOM.span({style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"block",height:e.CommonStyles.Sizes.LineHeight,paddingTop:e.CommonStyles.Sizes.TextBoxPadding,paddingLeft:e.CommonStyles.Sizes.TextBoxPadding}},this.props.buttonTitle));return React.DOM.span({style:{display:"inline-block",width:"100%",height:e.CommonStyles.Sizes.RowHeight,backgroundColor:e.CommonStyles.Colors.White,boxSizing:"border-box",borderWidth:e.CommonStyles.Sizes.TextBoxBorderSize,borderColor:e.CommonStyles.Colors.BorderColor,borderStyle:"solid"}},React.DOM.span({style:{"float":"right",display:"block",width:e.CommonStyles.Sizes.NormalIconSize-e.CommonStyles.Sizes.TextBoxBorderSize,height:"100%",background:"url(img/dropdown_arrow_normal.png) center center no-repeat",borderLeftWidth:e.CommonStyles.Sizes.TextBoxBorderSize,borderLeftColor:e.CommonStyles.Colors.BorderColor,borderLeftStyle:"solid"}}),t)},r.displayName="TypeaheadFilterButton",r.element=React.createFactory(r),r}(React.Component);e.TypeaheadFilterButton=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(){t.apply(this,arguments)}return __extends(r,t),r.prototype.render=function(){var t=this,r={boxSizing:"border-box",height:308,backgroundColor:e.CommonStyles.Colors.White,borderWidth:e.CommonStyles.Sizes.LineWidth,borderColor:e.CommonStyles.Colors.BorderColor,borderStyle:"solid"};return React.DOM.div({style:r},e.FilteringListBox.element({itemStore:this.props.itemStore,searchBoxPlaceholder:this.props.translate("search"),matchPrefixesOnly:this.props.matchPrefixesOnly,itemSelected:function(){return t.props.itemSelected()},style:e.CommonStyles.Helpers.Edges(e.CommonStyles.Sizes.SmallSpace)}))},r.displayName="TypeaheadFilterPanel",r.element=React.createFactory(r),r}(React.Component);e.TypeaheadFilterPanel=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(){t.apply(this,arguments),this.lastFilter=null,this.state={fieldValues:[]}}return __extends(r,t),r.prototype.render=function(){var t=this;return e.Menu.element({ref:"menu",tbTestId:["typeahead-filter",this.props.filter.definition.name].join("-"),style:{width:"100%"},menuPanelStyle:{width:"100%",marginTop:-e.CommonStyles.Sizes.TextBoxBorderSize},menuButtonFactory:function(r){return r.buttonTitle=t.props.filter.value?t.props.filter.value.label:"",e.TypeaheadFilterButton.element(r)},menuPanelFactory:function(r){return r.itemStore={getItems:function(e,r,n){return e!==t.lastFilter&&t.initializeCachedFieldValues(e),t.cachedFieldValues.getItems(r,n)}},r.translate=t.props.translate,r.matchPrefixesOnly=t.props.filter.definition.matchPrefixesOnly,r.itemSelected=function(){t.refs.menu.closeMenu()},e.TypeaheadFilterPanel.element(r)},onBeforeMenuOpen:function(){return t.resetCachedFieldValues(),Q.when()}})},r.prototype.resetCachedFieldValues=function(){this.initializeCachedFieldValues("")},r.prototype.initializeCachedFieldValues=function(t){var r=this,n=window.location.href;this.cachedFieldValues=new e.SparseCachedList(this.props.getFieldValueQuery().withMatchText(t),function(e){return{label:e.label,count:e.count,url:r.addParameter(n,r.props.filter.definition.name,e.value)}}),this.lastFilter=t},r.prototype.addParameter=function(e,t,r){var n=new RegExp("(\\?|\\&)"+t+"=.*?(?=(&|$))"),i=e.toString().split("#"),o=i[0],s=i[1],a=/\?.+$/;return n.test(s)?o+"#"+s.replace(n,"$1"+t+"="+r):a.test(s)?e+"&"+t+"="+r:e+"?"+t+"="+r},r.displayName="TypeaheadFilter",r.element=React.createFactory(r),r}(React.Component);e.TypeaheadFilter=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.render=function(){var e="tb-lock-icon "+VizPortal.LockStatusHelper.getGrayLockIconClass(this.props.lockState);return React.DOM.div({className:"tb-section-header-lock-status"},React.DOM.span({className:e}),React.DOM.span({className:"tb-section-header-lock-text"},this.props.translate(VizPortal.LockStatusHelper.getSectionHeaderText(this.props.lockState))))},t.displayName="PermissionLockStatus",t.element=React.createFactory(t),t}(React.Component);e.PermissionLockStatus=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(){function e(e,t,r){this.width=t,this.height=r,this.n=e.length-1,this.max=_.max(e)}return e.prototype.y=function(e){return 0===this.max?this.height:(this.max-e)*this.height/this.max},e.prototype.x=function(e){return 0===this.n?this.width:e*this.width/this.n},e}(),r=function(){function e(e){this.normalize=e}return e.prototype.buildMovement=function(e,t,r){return e+t+","+r},e.prototype.buildPath=function(e){var t=this;return e.reduce(function(e,r,n){var i=0===n?"M":"L",o=t.normalize.x(n),s=t.normalize.y(r);return e+t.buildMovement(i,o,s)},"")},e}(),n=function(){function e(e){this.boundRect=e.getBoundingClientRect()}return e.prototype.correctHorizontalOffset=function(e){var t=e.getBoundingClientRect(),r=t.right-(this.boundRect.right-i.TextBuffer),n=this.boundRect.left+i.TextBuffer-t.left,o=0,s=0;return r>0&&(s-=r,o++),n>0&&(s+=n,o++),0===o?0:s/o},e}();e.OffsetCorrector=n;var i=function(i){function o(e){i.call(this,e),this.state=this.defaultState(e)}return __extends(o,i),o.prototype.measureTextAndSetOffsets=function(){var e=this,t=new n(React.findDOMNode(this.refs.svg)),r=this.state.dataPointsToLabel.map(function(r){var n=React.findDOMNode(e.refs[r.key+"Label"]),i=_.clone(r);return i.xOffset=t.correctHorizontalOffset(n),i});this.setState({dataPointsToLabel:r,readyForFullRender:!0})},o.prototype.defaultState=function(e){return{readyForFullRender:!1,dataPointsToLabel:this.getPointsToLabel(this.props.dataPoints)}},o.prototype.componentWillReceiveProps=function(e){this.setState(this.defaultState(e))},o.prototype.componentDidMount=function(){this.measureTextAndSetOffsets()},o.prototype.componentDidUpdate=function(){this.state.readyForFullRender||this.measureTextAndSetOffsets()},o.prototype.render=function(){var e=this,r=this.state.readyForFullRender,n=this.props.width-o.DefaultPadding.paddingLeft-o.DefaultPadding.paddingRight,i=this.props.height-o.DefaultPadding.paddingTop-o.DefaultPadding.paddingBottom,s=_.extend({display:"block",backgroundColor:o.BackgroundColor},o.DefaultPadding),a={ref:"svg",height:i,width:n,style:r?s:_.extend(s,{visibility:"hidden"}),"data-tb-test-id":"sparkline"};this.normalize=new t(this.props.dataPoints,n,i);var c=[];return r&&c.push(this.path()),this.state.dataPointsToLabel.forEach(function(t){c.push(e.labelAtDataPoint(t)),r&&c.push(e.circleAtDataPoint(t))}),(l=React.DOM).svg.apply(l,[a].concat(c));var l},o.prototype.path=function(){var e=new r(this.normalize);return React.DOM.path({key:"path",stroke:o.LineColor,strokeWidth:o.LineWidth,fill:"none",d:e.buildPath(this.props.dataPoints)})},o.prototype.circleAtDataPoint=function(e){var t=e.key+"Circle";return React.DOM.circle(_.extend({key:t,"data-tb-test-id":t,cx:this.normalize.x(e.index),cy:this.normalize.y(this.props.dataPoints[e.index])},e.circleStyle))},o.prototype.labelAtDataPoint=function(e){var t=this.props.dataPoints[e.index],r=e.key+"Label",n=e.circleStyle.r+e.circleStyle.strokeWidth+o.TextBuffer,i=e.above?-n:n+o.LabelStyle.fontSize-1.5;return React.DOM.text({ref:r,key:r,"data-tb-test-id":r,style:o.LabelStyle,x:this.normalize.x(e.index),y:this.normalize.y(t),dy:i,dx:e.xOffset,textAnchor:"middle"},t)},o.prototype.getPointsToLabel=function(e){var t=_.indexOf(e,_.min(e)),r=_.indexOf(e,_.max(e)),n=e.length-1,i=e[n]>=e[n-1],s=[];return s.push({key:"end",index:n,circleStyle:o.CircleStyleEnd,above:i}),n!==r&&s.push({key:"max",index:r,circleStyle:o.CircleStyleMax,above:!0}),n!==t&&r!==t&&s.push({key:"min",index:t,circleStyle:o.CircleStyleMin,above:!1}),s},o.displayName="Sparkline",o.element=React.createFactory(o),o.LineWidth=2,o.LineColor=e.CommonStyles.Colors.Grey153,o.BackgroundColor=e.CommonStyles.Colors.Grey245,o.TextBuffer=3,o.DefaultPadding={paddingTop:18,paddingRight:12,paddingBottom:18,paddingLeft:12},o.CircleStyleEnd={r:3.5,strokeWidth:0,fill:e.CommonStyles.Colors.Grey102},o.CircleStyleMax={r:2.5,strokeWidth:1,fill:e.CommonStyles.Colors.White,stroke:e.CommonStyles.Colors.Grey102},o.CircleStyleMin={r:2.5,strokeWidth:0,fill:e.CommonStyles.Colors.Grey136},o.LabelStyle={fontFamily:e.CommonStyles.Fonts.BodyFont,fontSize:e.CommonStyles.Sizes.SmallFontSize,fill:e.CommonStyles.Colors.GreyTextColor},o}(React.Component);e.Sparkline=i;var o=function(t){function r(){t.apply(this,arguments)}return __extends(r,t),r.prototype.render=function(){var e=[i.element(this.props.sparklineProps)];if(this.props.title){var t=React.DOM.div({style:r.TitleStyle},this.props.title);e.unshift(t)}if(this.props.caption){var n=React.DOM.div({style:r.CaptionStyle},this.props.caption);e.push(n)}return(o=React.DOM).div.apply(o,[{}].concat(e));var o},r.displayName="SparklineWithTitle",r.element=React.createFactory(r),r.TitleStyle={fontFamily:e.CommonStyles.Fonts.BodyFont,fontSize:e.CommonStyles.Sizes.NormalFontSize,color:e.CommonStyles.Colors.NormalTextColor,marginBottom:5,textAlign:"left"},r.CaptionStyle={fontFamily:e.CommonStyles.Fonts.BodyFont,fontSize:e.CommonStyles.Sizes.SmallFontSize,color:e.CommonStyles.Colors.GreyTextColor,marginTop:6,textAlign:"center"},r}(React.Component);e.SparklineWithTitle=o}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(){t.call(this),this.stackedComponents=[]}return __extends(r,t),r.instance=function(){return r._instance||(r._instance=new r,e.Dispatcher.instance.register(r._instance.handleAction.bind(r._instance))),r._instance},r.prototype.handleAction=function(t){switch(t.actionType){case e.AddStackedComponentAction.Type:this.addStackedComponent(t.stackedComponent);break;case e.RemoveStackedComponentAction.Type:this.removeStackedComponent(t.stackedComponent)}},r.prototype.getAll=function(){return this.stackedComponents},r.prototype.addStackedComponent=function(e){this.stackedComponents=React.addons.update(this.stackedComponents,{$push:[e]}),this.broadcast(r.ChangeEvent)},r.prototype.removeStackedComponent=function(e){this.stackedComponents=_.without(this.stackedComponents,e),this.broadcast(r.ChangeEvent)},r.ChangeEvent="stacked-components-changed",r}(e.Store);e.StackedComponentStore=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(){t.call(this,{},{}),this.state=r.getStackedComponentsState()}return __extends(r,t),r.getStackedComponentsState=function(){return{allStackedComponents:e.StackedComponentStore.instance().getAll()}},r.prototype.render=function(){return React.DOM.div({},this.state.allStackedComponents)},r.prototype.componentDidMount=function(){var t=this;e.StackedComponentStore.instance().addChangeListener(function(){return t.refresh()})},r.prototype.componentWillUnmount=function(){var t=this;e.StackedComponentStore.instance().removeChangeListener(function(){return t.refresh()})},r.prototype.refresh=function(){this.setState(r.getStackedComponentsState())},r.displayName="ComponentStacker",r.element=React.createFactory(r),r}(React.Component);e.ComponentStacker=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype.render=function(){return React.DOM.div({className:this.props.className,style:_.extend({backgroundImage:"url("+encodeURI(this.props.url)+")",backgroundSize:"cover",backgroundPosition:"top",backgroundRepeat:"no-repeat"},this.props.style),"data-tb-test-id":this.props.tbTestId})},t.displayName="ThumbnailImage",t.element=React.createFactory(t),t}(React.Component);e.ThumbnailImage=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(e){function t(){e.call(this,{},{})}return __extends(t,e),t.prototype.render=function(){return React.DOM.span({className:"tb-action-icon"})},t.displayName="ActionMenuButton",t.element=React.createFactory(t),t}(React.Component);e.ActionMenuButton=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(e){function t(t){e.call(this,t,{})}return __extends(t,e),t.prototype.render=function(){var e=this,t=this.props.actionButton.isDisabled&&this.props.actionButton.isDisabled(this.props.selectedItems,this.props.detailedItem,this.props.allowedActions),r=React.addons.classSet({"tb-popup-menu-item":!0,"tb-disabled":t}),n=React.DOM.div({className:r,disabled:t,onClick:function(){t||e.props.actionButton.execute(e.props.selectedItems,{scope:e.props.contentSubplaceScope},e.props.detailedItem)}},this.props.actionButton.translate||this.props.actionButton.name);return n},t.displayName="ActionMenuItem",t.element=React.createFactory(t),t}(React.Component);e.ActionMenuItem=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){function t(r){var n={actionType:t.Type,stackedComponent:r};e.Dispatcher.instance.dispatch(n)}e.AddStackedComponentAction=t;var t;!function(e){e.Type="add-stacked-component"}(t=e.AddStackedComponentAction||(e.AddStackedComponentAction={}))}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){function t(r){var n={actionType:t.Type,stackedComponent:r};e.Dispatcher.instance.dispatch(n)}e.RemoveStackedComponentAction=t;var t;!function(e){e.Type="remove-stacked-component"}(t=e.RemoveStackedComponentAction||(e.RemoveStackedComponentAction={}))}(VizPortalReact||(VizPortalReact={}));var VizPortal;!function(e){var t;!function(e){function t(e,t,r){var n=$(document),i=".MousedownOutsideDetector"+t(e),o="mousedown"+i+" touchstart"+i;return n.on(o,function(t){var n=$(t.target);0===n.closest(e).length&&r(t)}),function(){return n.off(i)}}e.attach=t}(t=e.MousedownOutsideDetector||(e.MousedownOutsideDetector={}))}(VizPortal||(VizPortal={}));var VizPortalReact;!function(e){var t=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.render=function(){var e=["tb-popup-menu-content","tb-padded-small"];return React.DOM.div({style:this.props.width?{width:this.props.width+"px"}:{}},React.DOM.div({className:e.join(" "),onClick:this.props.closePopupMenu},this.props.popupContentDescriptor))},t.prototype.componentDidMount=function(){var e=""+t.nextId++;this.detachMousedownOutsideDetector=VizPortal.MousedownOutsideDetector.attach($(React.findDOMNode(this)),function(t){return e},this.props.mouseDownOutsideFunc)},t.prototype.componentWillUnmount=function(){this.detachMousedownOutsideDetector()},t.displayName="Popup",t.element=React.createFactory(t),t.nextId=1,t}(React.Component);e.Popup=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(e,r){void 0===r&&(r={}),t.call(this,e,r),this.state={open:!1},this.popupComponent=null}return __extends(r,t),r.prototype.render=function(){var e=this,t=["tb-popup-menu"];this.state.open&&t.push("tb-selected");var r=React.DOM.div({className:t.join(" "),tabIndex:0,onClick:function(){return e.props.buttonClickHandler()},onKeyDown:function(t){return e.onKeyDown(t)},ref:"popupMenu"},React.DOM.div({ref:"menuButton",onClick:function(){return e.toggle()}},this.props.children));return r},r.prototype.onKeyDown=function(e){if(!this.isDisabled())switch(e.which){case VizPortal.Keys.Enter:this.toggle(),e.stopPropagation();break;case VizPortal.Keys.Space:this.state.open||this.open()}},r.prototype.toggle=function(){this.isDisabled()||(this.state.open?this.close():this.open())},r.prototype.open=function(){var t=this,r=$(React.findDOMNode(this.refs.menuButton)),n=r.outerWidth(),i={popupContentDescriptor:this.props.popupContentDescriptor,positionCorner:this.positionCorner(),contentCorner:this.contentCorner(),width:this.props.contentMatchButtonWidth?n:null,mouseDownOutsideFunc:function(e){var n=$(e.target);0===n.closest(r).length&&t.close()},closePopupMenu:function(){t.close()}};this.popupComponent=e.Popup.element(i),e.AddStackedComponentAction(this.popupComponent),this.props.onPopupOpened&&this.props.onPopupOpened({closeFn:function(){t.close()}}),this.setState({open:!0})},r.prototype.close=function(){e.RemoveStackedComponentAction(this.popupComponent),this.props.onPopupClosed&&this.props.onPopupClosed(),$(React.findDOMNode(this.refs.popupMenu)).focus(),this.setState({open:!1})},r.prototype.isDisabled=function(){return this.props.isDisabled},r.prototype.positionCorner=function(){switch(this.props.direction){case"dr":default:return"bl";case"dl":return"br";case"ur":return"tl";case"ul":return"tr"}},r.prototype.contentCorner=function(){switch(this.props.direction){case"dr":default:return"tl";case"dl":return"tr";case"ur":return"bl";case"ul":return"br"}},r.displayName="PopupMenu",r.element=React.createFactory(r),r}(React.Component);e.PopupMenu=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(e){t.call(this,e,{})}return __extends(r,t),r.prototype.render=function(){var t=this;return React.DOM.div({},this.props.menuActions.map(function(r){return e.ActionMenuItem.element({actionButton:r,selectedItems:t.props.selectedItems,actionMenuContext:t.props.actionMenuContext,detailedItem:t.props.detailedItem,allowedActions:t.props.allowedActions,contentSubplaceScope:t.props.contentSubplaceScope})}))},r.displayName="ActionsMenu",r.element=React.createFactory(r),r}(React.Component);e.ActionsMenu=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(e){function t(){e.apply(this,arguments),this.state={favorite:this.props.item.favorite}}return __extends(t,e),t.prototype.toggle=function(){var e=this.props;e.item;this.state.favorite?e.removeFavorite(this.props.item):e.addFavorite(this.props.item),this.setState({favorite:!this.state.favorite})},t.prototype.selected=function(){return!!this.state.favorite},t.prototype.show=function(){return!!this.state.favorite||!!this.props.hover||!!this.props.isTouch},t.prototype.render=function(){var e=["tb-favorite-button","tb-thumbnail-favorite"];return this.state.favorite&&e.push("tb-selected"),this.show()||e.push("ng-hide"),React.DOM.span({className:e.join(" "),onClick:this.toggle,tabIndex:0})},t.prototype.shouldComponentUpdate=function(e,t){return React.addons.PureRenderMixin.shouldComponentUpdate.call(this,e,t)},t.displayName="FavoriteToggle",t.element=React.createFactory(t),t}(React.Component);e.FavoriteToggle=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(e){function t(t,r){e.call(this,t,r)}return __extends(t,e),t.prototype.componentDidMount=function(){this.updateFromProps()},t.prototype.componentDidUpdate=function(e){this.updateFromProps(e)},t.prototype.render=function(){return this.props.children||React.DOM.span({})},t.prototype.componentWillUnmount=function(){var e=$(React.findDOMNode(this));e.remove()},t.prototype.updateFromProps=function(e){void 0===e&&(e={});var t=!1,r=this.props,n=$(React.findDOMNode(this)),i=r.attributes||{};_.each(i,function(r,i){e.attributes&&e.attributes[i]||(t=!0),n.attr(i,r)});var o=_.difference(_.keys(e.attributes),_.keys(r.attributes));o.map(function(e){n.removeAttr(e)}),r.template&&r.template!==e.template?(t=!0,n.empty(),n.append(r.template)):e.template&&!r.template&&n.empty(),t?this.compileElement():this.digest()},t.prototype.compileElement=function(){var e=this.props.angularContext,t=$(React.findDOMNode(this));e.compileElement(t,this.props.setupScope)},t.prototype.digest=function(){var e=this.props.angularContext;e.enqueueDigest()},t.element=React.createFactory(t),t}(React.Component);e.AngularDirective=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(){t.apply(this,arguments)}return __extends(r,t),r.prototype.render=function(){var t=this;return e.AngularDirective.element({attributes:{"tb-popover":"'"+this.props.popoverTemplateUrl+"'","tb-popover-class":"tb-content-item-popover"},setupScope:function(e){return t.scope=e.$new(),t.scope.item=t.props.item,t.scope.getItemDetails=t.props.getItemDetails,t.scope},angularContext:this.props.angularContext},this.props.children)},r.prototype.componentWillUnmount=function(){this.scope&&this.scope.$destroy()},r.element=React.createFactory(r),r}(React.Component);e.PopoverTrigger=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(e){t.call(this,e,{}),this.state={hover:!1},this.angularContext=this.props.angularContext}return __extends(r,t),r.prototype.mouseEnter=function(){this.setState({hover:!0})},r.prototype.mouseLeave=function(){this.setState({hover:!1})},r.prototype.isSelected=function(){return this.props.selectedItems.contains(this.props.item)},r.prototype.toggleSelected=function(){var e=this;this.angularContext.evalAsync(function(){e.props.selectedItems.toggle(e.props.item),e.forceUpdate()})},r.prototype.render=function(){var t=this,r=this.props.item,n=this.props.detailsUrl,i=React.addons.classSet({"tb-thumbnail":!0,"tb-hover":this.state.hover,"tb-selected":this.isSelected()}),o=e.PopoverTrigger.element(_.extend({item:r,angularContext:this.props.angularContext,popoverTemplateUrl:this.props.popoverTemplateUrl},this.props.popoverTriggerProps),React.DOM.span({className:i,onMouseEnter:function(){return t.mouseEnter()},onMouseLeave:function(){return t.mouseLeave()}},React.DOM.a({className:"tb-thumbnail-slide",href:n},React.DOM.img({className:"tb-thumbnail-slide-image",src:r.thumbnailUrl})),React.DOM.a({className:"tb-thumbnail-checkbox-background"}),React.DOM.div({className:"tb-thumbnail-checkbox-target",onClick:function(){return t.toggleSelected()}}),React.DOM.a({className:"tb-thumbnail-action-menu-background tb-thumbnail-slide-action-menu-background",href:n}),React.DOM.div({className:"tb-thumbnail-action-menu"},e.PopupMenu.element({buttonClickHandler:function(){t.angularContext.evalAsync(function(){t.props.selectedItems.clear(),t.props.selectedItems.add(r),t.forceUpdate()})},popupContentDescriptor:e.ActionsMenu.element(this.props.actionsMenuProps)},e.ActionMenuButton.element({}))),React.DOM.div({className:"tb-thumbnail-caption"},React.DOM.a({className:"tb-thumbnail-caption-link",href:n},r.name),e.FavoriteToggle.element(_.extend({},this.props.favoriteProps,{item:r,hover:this.state.hover})))));return o},r.displayName="Thumbnail",r.element=React.createFactory(r),r}(React.Component);e.Thumbnail=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(t){function r(e){t.call(this,e,{})}return __extends(r,t),r.prototype.render=function(){var t=this,r=this.props.items||[],n=this.props.selectedItems,i=this.props.favoriteProps,o=this.props.getDetailsUrl,s=this.props.actionsMenuProps,a=this.props.contentType,c=a===VizPortal.ViewContentType.name?"viewPopover.html":"workbookPopover.html";
return React.DOM.span({},r.map(function(r,a){return e.Thumbnail.element({key:a,item:r,detailsUrl:o(r),getItemDetails:t.props.getItemDetails,selected:n.contains(r),selectedItems:n,favoriteProps:i,actionsMenuProps:s,popoverTriggerProps:t.props.popoverTriggerProps,popoverTemplateUrl:c,angularContext:t.props.angularContext})}))},r.displayName="Thumbnails",r.element=React.createFactory(r),r}(React.Component);e.Thumbnails=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){var t=function(e){function t(t){e.call(this,t),this.isFading=!1,this.state={fadeOpacity:0},this.boundHover=this.hover.bind(this),this.boundFadeOut=this.fadeOut.bind(this),this.boundClose=this.close.bind(this),this.boundMouseOut=this.mouseOut.bind(this)}return __extends(t,e),t.prototype.close=function(){clearTimeout(this.fadeOutTimeoutId),clearTimeout(this.closeTimeoutId),this.props.close()},t.prototype.componentDidMount=function(){var e=this;setTimeout(function(){e.setState({fadeOpacity:1,fadeTransitionTime:t.FadeInTime})},0),this.props.timeoutDelay!==VizPortal.ToasterService.NoTimeout&&(this.fadeOutTimeoutId=setTimeout(this.boundFadeOut,this.props.timeoutDelay))},t.prototype.mouseOut=function(){this.props.timeoutDelay!==VizPortal.ToasterService.NoTimeout&&(this.isFading?this.boundFadeOut():this.fadeOutTimeoutId=setTimeout(this.boundFadeOut,this.props.timeoutDelay))},t.prototype.hover=function(){this.props.timeoutDelay!==VizPortal.ToasterService.NoTimeout&&(this.setState({fadeOpacity:1,fadeTransitionTime:t.HoverRestoreTime}),clearTimeout(this.fadeOutTimeoutId),clearTimeout(this.closeTimeoutId))},t.prototype.fadeOut=function(){this.setState({fadeOpacity:0,fadeTransitionTime:t.FadeOutTime}),this.closeTimeoutId=setTimeout(this.boundClose,t.FadeOutTime),this.isFading=!0},t.prototype.render=function(){var e="tb-toast tb-toast-"+this.props.toastType,r={transitionDuration:this.state.fadeTransitionTime+"ms",opacity:this.state.fadeOpacity,transitionTimingFunction:0===this.state.fadeOpacity?t.FadeOutEasing:t.FadeInEasing},n=this.props.lines?_.map(this.props.lines,function(e,t){return React.DOM.div({key:t},e)}):this.props.toastContent,i=React.DOM.div({key:"toastContent",className:"tb-toast-text"},n),o=React.DOM.span({key:"closeButton",className:"tb-clear-button tb-disable-selection",onClick:this.boundClose},"Ã—"),s=React.DOM.div({style:r,onMouseOver:this.boundHover,onMouseOut:this.boundMouseOut,key:"toast",className:e},i,o);return s},t.displayName="Toast",t.element=React.createFactory(t),t.FadeOutTime=3e3,t.FadeInTime=100,t.HoverRestoreTime=30,t.FadeOutEasing="ease-out",t.FadeInEasing="linear",t}(React.Component);e.Toast=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){e.ToastType={Info:"info",Error:"error",External:"external"};var t=function(t){function r(e){t.call(this,e,{}),this.state={toasts:[]},this.boundListenerFn=this.toastsUpdated.bind(this),this.angularContext=this.props.angularContext,this.toasterService=this.angularContext.getService("ToasterService")}return __extends(r,t),r.prototype.componentDidMount=function(){this.listenerId=this.toasterService.addListener({toastsUpdated:this.boundListenerFn})},r.prototype.componentWillUnmount=function(){this.toasterService.removeListener(this.listenerId)},r.prototype.close=function(e){this.toasterService.close(e)},r.prototype.toastsUpdated=function(t){var r=this,n=[];_.each(t,function(t){var i=e.Toast.element({key:t.id,close:function(){r.close(t.id)},toastType:t.type,timeoutDelay:t.timeoutDelay,toastContent:t.content,lines:t.lines});n.push(i)}),this.setState({toasts:n})},r.prototype.render=function(){return React.DOM.div({className:"tb-toaster tb-enable-selection"},this.state.toasts)},r.displayName="Toaster",r.element=React.createFactory(r),r}(React.Component);e.Toaster=t}(VizPortalReact||(VizPortalReact={}));var VizPortalReact;!function(e){VizPortal.ReactDirectiveFactory.create({name:"tbComponentStacker",componentFactory:e.ComponentStacker.element}),VizPortal.ReactDirectiveFactory.create({name:"tbThumbnails",componentFactory:e.Thumbnails.element}),VizPortal.ReactDirectiveFactory.create({name:"tbReactFavoritesMenu",componentFactory:e.FavoritesMenu.element}),VizPortal.ReactDirectiveFactory.create({name:"tbReactDataGrid",componentFactory:e.DataGrid.element,watch:"props.update"}),VizPortal.ReactDirectiveFactory.create({name:"tbReactTypeaheadFilter",componentFactory:e.TypeaheadFilter.element,watch:"props.filter.value"}),VizPortal.ReactDirectiveFactory.create({name:"tbReactToaster",componentFactory:e.Toaster.element}),VizPortal.ReactDirectiveFactory.create({name:"tbReactTopBar",componentFactory:e.TopBar.element}),VizPortal.ReactDirectiveFactory.create({name:"tbPermissionLockStatus",componentFactory:e.PermissionLockStatus.element,watch:"props.lockState"}),VizPortal.ReactDirectiveFactory.create({name:"tbSparklineWithTitle",componentFactory:e.SparklineWithTitle.element}),VizPortal.ReactDirectiveFactory.create({name:"tbThumbnailImage",componentFactory:e.ThumbnailImage.element})}(VizPortalReact||(VizPortalReact={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"updateConnectionsOAuth",t)}return __extends(t,e),t}(e.Request);e.UpdateConnectionsOAuthRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r){this.$q=e,this.ErrorNotifyingServer=t,this.LongRunningActionService=r,this.server=t.getServerService()}return t.prototype.checkExistingConnection=function(t){var r=new e.ServerApi.CheckConnectionRequest({id:t});return this.ErrorNotifyingServer.sendRequest(r)},t.prototype.checkConnection=function(t,r){var n=this,i={id:t,server:r.server,port:r.port,username:r.username};return this.setPasswordParams(i,r.passwordUpdate).then(function(){return n.ErrorNotifyingServer.sendRequest(new e.ServerApi.CheckConnectionRequest(i))})},t.prototype.updateConnections=function(t,r){var n=this,i={ids:t,server:r.server,port:r.port,username:r.username};return this.setPasswordParams(i,r.passwordUpdate).then(function(){return n.ErrorNotifyingServer.sendRequest(new e.ServerApi.UpdateConnectionsRequest(i))}).then(this.LongRunningActionService.startProgressTrackingForResponse()).then(this.LongRunningActionService.delayResultForSolr())},t.prototype.updateConnectionsOAuth=function(t,r){return this.ErrorNotifyingServer.sendRequest(new e.ServerApi.UpdateConnectionsOAuthRequest({ids:t,keychainEntryId:r})).then(this.LongRunningActionService.startProgressTrackingForResponse()).then(this.LongRunningActionService.delayResultForSolr())},t.prototype.setPasswordParams=function(t,r){return r&&(t.embedPassword=r.isEmbedded,_.isString(r.newPassword))?this.server.sendRequest(new e.ServerApi.GeneratePublicKeyRequest).then(function(e){t.encryptedPassword=rsa.encrypt(r.newPassword,e.key),t.encryptedPasswordKeyId=e.keyId}):this.$q.when({})},t.$inject=["$q","ErrorNotifyingServer","LongRunningActionService"],t}();e.DataConnections=t,e.Module.instance().service("DataConnections",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getDataConnectionTypes",t)}return __extends(t,e),t}(e.Request);e.GetDataConnectionTypesRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(t){function r(r,n){t.call(this,n.getServerResourceFetcher(e.ServerApi.GetDataConnectionTypesRequest,function(e){return e.dataConnectionTypes})),this.fieldValuesFetcher=n.getServerResourceFetcher(e.ServerApi.GetFieldValuesRequest,e.ServerApiMapper.fieldValues)}return __extends(r,t),r.prototype.getByDataConnectionType=function(t){return this.all().withFilters([e.Filter.stringFieldEq(e.ServerApi.FilterFieldNames.connectionType,t)]).getFirst()},r.prototype.valuesForField=function(t){return new e.FieldValuesQuery(this.fieldValuesFetcher,t,e.ServerApi.FieldValueResourceType.dataConnection)},r.$inject=["ServerService","FetcherFactory"],r}(e.Resource);e.DataConnectionTypes=t,e.Module.instance().service("DataConnectionTypes",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getProjectNames",t)}return __extends(t,e),t}(e.Request);e.GetProjectNamesRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(t){function r(r){t.call(this,r.getServerResourceFetcher(e.ServerApi.GetProjectNamesRequest,function(e){return e.projects}))}return __extends(r,t),r.$inject=["FetcherFactory"],r}(e.Resource);e.ProjectNames=t,e.Module.instance().service("ProjectNames",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getTags",t)}return __extends(t,e),t}(e.Request);e.GetTagsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(t){function r(r){t.call(this,r.getServerResourceFetcher(e.ServerApi.GetTagsRequest,function(e){return e.tags}))}return __extends(r,t),r.$inject=["FetcherFactory"],r}(e.Resource);e.Tags=t,e.Module.instance().service("Tags",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getUserNames",t)}return __extends(t,e),t}(e.Request);e.GetUserNamesRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(t){function r(r){t.call(this,r.getServerResourceFetcher(e.ServerApi.GetUserNamesRequest,function(e){return e.users}))}return __extends(r,t),r.$inject=["FetcherFactory"],r}(e.Resource);e.UserNames=t,e.Module.instance().service("UserNames",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e){this.modal=e}return t.prototype.showAddUsersToGroupDialog=function(t){var r=this.modal.open({templateUrl:"addUsersToGroupDialog.html",size:e.ModalSize.medium,controller:e.AddUsersToGroupDialogCtrl,resolve:{group:function(){return t}}});return r.result},t.$inject=["ModalService"],t}();e.AddUsersToGroupAction=t,e.Module.instance().service("AddUsersToGroupAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"assignPermissionsToContents",t)}return __extends(t,e),t}(e.Request);e.AssignPermissionsToContentsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n){this.$translate=e,this.server=t,this.lrActionService=r,this.toasterService=n,this.assignPermissionsToContentsPercent=0,this.assignPermissionsToContentsPending=!1}return t.prototype.handleCurrentJob=function(){var t=this;return this.lrActionService.getLastByType(e.LongRunningActionType.AssignPermissionsToContents).then(function(e){return t.handleAssignPermissionsToContentsStatus(e)})},t.prototype.getAssignPermissionsToContentsPercent=function(){return this.assignPermissionsToContentsPercent},t.prototype.getAssignPermissionsToContentsPending=function(){return this.assignPermissionsToContentsPending},t.prototype.assignPermissionsToContents=function(t){var r=this;return this.assignPermissionsToContentsPercent=0,this.server.sendRequest(new e.ServerApi.AssignPermissionsToContentsRequest(t)).then(function(e){var t=!e.actionId;t?r.getAssignPermissionsToContentsStatus():r.trackAssignPermissionsToContentsProgress(e.actionId)})},t.prototype.cancelPoll=function(){this.assignPermissionsToContentsPoller&&this.assignPermissionsToContentsPoller.cancel(),this.assignPermissionsToContentsPercent=0,this.assignPermissionsToContentsPending=!1},t.prototype.trackAssignPermissionsToContentsProgress=function(t){var r=this,n=function(t){t&&t.succeeded===!1?o(t&&t.response&&t.response.errors):(r.assignPermissionsToContentsPercent=100,r.toasterService.pop({type:e.ToastType.Info,text:r.$translate.instant("assignPermissionsToContentsSuccess")}))},i=function(e){r.assignPermissionsToContentsPercent=e.percentComplete},o=function(t){t!==e.ErrorReason.Canceled&&r.toasterService.pop({type:e.ToastType.Info,text:r.$translate.instant("assignPermissionsToContentsError")})};t?(this.assignPermissionsToContentsPending=!0,this.assignPermissionsToContentsPoller=this.lrActionService.trackProgress(t),this.assignPermissionsToContentsPoller.promise.then(n,o,i).fin(function(){return r.assignPermissionsToContentsPending=!1})):o(e.ErrorReason.Unknown)},t.prototype.getAssignPermissionsToContentsStatus=function(){var t=this;this.lrActionService.getLastByType(e.LongRunningActionType.AssignPermissionsToContents).then(function(e){return t.handleAssignPermissionsToContentsStatus(e)})},t.prototype.handleAssignPermissionsToContentsStatus=function(t){t&&t.state!==e.LongRunningActionState.Complete&&(this.assignPermissionsToContentsPercent=t.percentComplete,this.trackAssignPermissionsToContentsProgress(t.id))},t.$inject=["$translate","ServerService","LongRunningActionService","ToasterService"],t}();e.AssignPermissionsToContentsService=t,e.Module.instance().service("AssignPermissionsToContentsService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e){this.StackedElementsService=e}return e.prototype.add=function(){var e=this,t=function(){return{left:0,top:0,right:0,bottom:0}},r=angular.element("<div>").addClass("tb-backdrop"),n=this.StackedElementsService.addStackedElement({contentElement:r,getContentElementPosition:t}),i={remove:function(){e.StackedElementsService.removeStackedElement(n)}};return i},e.$inject=["StackedElementsService"],e}();e.BackdropService=t,e.Module.instance().service("BackdropService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e){this.modal=e}return t.prototype.showBulkImportSiteUsersDialog=function(t){return this.showBulkImportUsersDialog(t,e.BulkImportUsersDialogCtrl.Method.ImportUsersFromCsv)},t.prototype.showBulkImportServerUsersDialog=function(t){return this.showBulkImportUsersDialog(t,e.BulkImportUsersDialogCtrl.Method.ImportServerUsersFromCsv)},t.prototype.showBulkImportUsersDialog=function(t,r){var n=this.modal.open({scope:t,templateUrl:"bulkImportUsersDialog.html",size:e.ModalSize.fitToContent,controller:e.BulkImportUsersDialogCtrl,resolve:{method:function(){return r}}});return n.result},t.$inject=["ModalService"],t}();e.BulkImportUsersAction=t,e.Module.instance().service("BulkImportUsersAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n){this.$translate=e,this.$q=t,this.toaster=r,this.DataSources=n}return t.prototype.execute=function(t,r,n,i,o,s){var a=this;return r===n?this.$q.when({}):this.DataSources.setRefreshMode(t.id,n).then(function(r){return!s&&r.errors&&r.errors.length&&a.toaster.pop({type:e.ToastType.Error,text:a.errorMessageFor(r.errors[0],t)}),o||r.errors&&r.errors.length||(n===e.ServerApi.RefreshModeTypes.Remote?a.toaster.pop({type:e.ToastType.Info,text:a.$translate.instant("editRemoteRefreshPropertiesAgentSuccess",{AGENT_NAME:e.L10n.elideIfLong(i)})}):a.toaster.pop({type:e.ToastType.Info,text:a.$translate.instant("editRemoteRefreshPropertiesServerSuccess")})),r})},t.prototype.errorMessageFor=function(t,r){switch(t.code){case e.CommonErrorCode.DatasourceNotFound:return this.$translate.instant("errorDatasourceNotFound",{DATASOURCE_NAME:e.L10n.elideIfLong(r.name)});default:return this.$translate.instant("errorUnknown")}},t.$inject=["$translate","$q","ToasterService","DataSources"],t}();e.ChangeDatasourceRefreshModeAction=t,e.Module.instance().service("ChangeDatasourceRefreshModeAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n){this.$translate=e,this.$q=t,this.ToasterService=r,this.DataSources=n}return t.prototype.execute=function(t,r,n,i,o,s){var a=this;return r===n||i!==e.ServerApi.RefreshModeTypes.Remote?this.$q.when({}):this.DataSources.setRemoteAgent(t.id,n).then(function(r){return!s&&r.errors&&r.errors.length&&a.ToasterService.pop({type:e.ToastType.Error,text:a.errorMessageFor(r.errors[0],t)}),o||r.errors&&r.errors.length||(i===e.ServerApi.RefreshModeTypes.Remote?a.ToasterService.pop({type:e.ToastType.Info,text:a.$translate.instant("editRemoteRefreshPropertiesAgentSuccess",{AGENT_NAME:e.L10n.elideIfLong(n)})}):a.ToasterService.pop({type:e.ToastType.Info,text:a.$translate.instant("editRemoteRefreshPropertiesServerSuccess")})),r})},t.prototype.errorMessageFor=function(e,t){switch(e.code){default:return this.$translate.instant("errorUnknown")}},t.$inject=["$translate","$q","ToasterService","DataSources"],t}();e.ChangeDatasourceRemoteAgentAction=t,e.Module.instance().service("ChangeDatasourceRemoteAgentAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r){this.$state=e,this.$translate=t,this.contentActionNotification=r}return t.prototype.notify=function(t,r){var n=this,i=e.MultipleResultNotificationOptions.create(new e.MultipleItemResult(r,t),{describeSuccessSummary:function(t){return n.$translate.instant("deleteGroupsSuccess",{ITEM_COUNT:t,ITEM_NAME:e.L10n.elideIfLong(r.first().name)},e.L10n.Interpolations.Count)},describeErrorSummary:function(t){return n.$translate.instant("deleteGroupsError",{ERROR_COUNT:t,ITEM_NAME:e.L10n.elideIfLong(r.first().name)},e.L10n.Interpolations.Count)},describeErrorDetail:function(e){return{itemName:e.item.name,itemUrl:n.$state.href("main.site.group",{id:e.item.id}),errorMessage:n.errorMessageFor(e.error,e.item.name)}}});this.contentActionNotification.notify(i)},t.prototype.errorMessageFor=function(t,r){switch(t.code){case e.CommonErrorCode.GroupNotFound:return this.$translate.instant("errorGroupNotFound",{ITEM_NAME:e.L10n.elideIfLong(r)});case e.GroupErrorCode.GroupCannotBeDeleted:return this.$translate.instant("errorUnableToDeleteAllUsersGroup",{GROUP_NAME:e.L10n.elideIfLong(r)});default:return this.$translate.instant("errorUnknown")}},t.$inject=["$state","$translate","ContentActionNotification"],t}();e.DeleteGroupsActionNotification=t,e.Module.instance().service("DeleteGroupsActionNotification",t);var r=function(){function t(e,t){this.$translate=e,this.toaster=t}return t.prototype.notify=function(t,r,n,i){if(r.errors&&r.errors.length>0){var o=this.errorMessageFor(r.errors[0],n,i);t(o)}else{var s=this.$translate.instant("updateGroupNameSuccessMsg",{NEW_ITEM_NAME:e.L10n.elideIfLong(n),ITEM_NAME:e.L10n.elideIfLong(i)});this.toaster.pop({type:e.ToastType.Info,text:s})}},t.prototype.errorMessageFor=function(t,r,n){switch(t.code){case e.UserErrorCode.UserGroupInvalidName:return this.$translate.instant("errorUserGroupInvalidName",{NEW_ITEM_NAME:e.L10n.elideIfLong(r)});case e.UserErrorCode.UserGroupWithNameAlreadyExists:return this.$translate.instant("errorUserGroupWithNameAlreadyExists",{NEW_ITEM_NAME:e.L10n.elideIfLong(r)});case e.UserErrorCode.UserAllUsersGroupAlreadyExists:return this.$translate.instant("errorUserAllUsersGroupAlreadyExists",{NEW_ITEM_NAME:e.L10n.elideIfLong(r)});case e.CommonErrorCode.GroupNotFound:return this.$translate.instant("errorGroupNotFound",{ITEM_NAME:e.L10n.elideIfLong(n)});default:return this.$translate.instant("errorUnknown")}},t.$inject=["$translate","ToasterService"],t}();e.RenameGroupActionNotification=r,e.Module.instance().service("RenameGroupActionNotification",r);var n=function(){function t(e,t){this.$translate=e,this.toaster=t}return t.prototype.notify=function(t,r,n){if(r.errors&&r.errors.length>0){var i=this.errorMessageFor(r.errors[0],n);t(i)}else{var o=this.$translate.instant("createGroupSuccessMsg",{NEW_ITEM_NAME:e.L10n.elideIfLong(n)});this.toaster.pop({type:e.ToastType.Info,text:o})}},t.prototype.errorMessageFor=function(t,r){switch(t.code){case e.UserErrorCode.UserGroupInvalidName:return this.$translate.instant("errorUserGroupInvalidName",{NEW_ITEM_NAME:e.L10n.elideIfLong(r)});case e.UserErrorCode.UserGroupWithNameAlreadyExists:return this.$translate.instant("errorUserGroupWithNameAlreadyExists",{NEW_ITEM_NAME:e.L10n.elideIfLong(r)});case e.UserErrorCode.UserAllUsersGroupAlreadyExists:return this.$translate.instant("errorUserAllUsersGroupAlreadyExists",{NEW_ITEM_NAME:e.L10n.elideIfLong(r)});default:return this.$translate.instant("errorUnknown")}},t.$inject=["$translate","ToasterService"],t}();e.CreateGroupActionNotification=n,e.Module.instance().service("CreateGroupActionNotification",n)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e,t,r,n,i){this.$translate=e,this.ConfirmActionDialog=t,this.createGroupActionNotification=r,this.Groups=n,this.ServerService=i}return e.prototype.showCreateGroupDialog=function(e){var t=this,r=e.$new();r.description=this.$translate.instant("createGroupDesc"),r.input={text:"",maxLength:255};var n=this.ServerService.isServerDomainFamilyActiveDirectory(),i=this.ConfirmActionDialog.open({title:this.$translate.instant(n?"createLocalGroupTitle":"createGroupTitle"),bodyTemplateUrl:"confirmActionDialogInput.html",scope:r,position:{reserveHeight:250},confirmDisabled:function(){return _.isEmpty(r.input.text)},actionName:this.$translate.instant("createGroupDialogSubmit"),action:function(e){return t.Groups.createGroup(r.input.text).then(function(n){t.createGroupActionNotification.notify(function(t){e.showErrorMessage(t)},n,r.input.text)})}});return i.result.fin(function(){return r.$destroy()}),i.result},e.$inject=["$translate","ConfirmActionDialog","CreateGroupActionNotification","Groups","ServerService"],e}();e.CreateGroupDialogAction=t,e.Module.instance().service("CreateGroupDialogAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t){this.ContentUrl=e,this.$translate=t}return t.prototype.errorDetailsFor=function(t){return{itemName:t.item.name,itemUrl:t.error.code===e.CommonErrorCode.DatasourceNotFound||t.error.code===e.CommonErrorCode.DataConnectionNotFound?null:this.ContentUrl.forItem(t.item,e.DatasourceContentType),errorMessage:this.errorMessageForItem(t)}},t.prototype.errorMessageForItem=function(e){return this.errorMessageFor(e.error,e.item.name)},t.prototype.errorMessageFor=function(t,r){switch(void 0===r&&(r=""),t.code){case e.CommonErrorCode.DatasourceNotFound:case e.CommonErrorCode.DataConnectionNotFound:return this.$translate.instant("errorDatasourceNotFound",{DATASOURCE_NAME:e.L10n.elideIfLong(r)});case e.DatasourceErrorCode.DatasourceChangeOwnerDisabled:return this.$translate.instant("errorDatasourceChangeOwnerDisabled");case e.DatasourceErrorCode.DatasourceMoveInsufficientPermissionsOnDatasource:case e.DatasourceErrorCode.DatasourceMoveInsufficientPermissionsOnDestinationProject:case e.DatasourceErrorCode.DatasourceMoveInsufficientPermissionsOnSourceProject:return this.$translate.instant("errorDatasourceMoveInsufficientPermissions");case e.DatasourceErrorCode.DatasourceWithSameNameInDestinationProject:return this.$translate.instant("errorDatasourceWithSameNameInDestinationProject");case e.CommonErrorCode.CallingUserInsufficientPermissions:return this.$translate.instant("errorDatasourceInsufficientPermissions");default:return this.$translate.instant("errorUnknown")}},t.$inject=["ContentUrl","$translate"],t}();e.DataSourceErrors=t,e.Module.instance().service("DataSourceErrors",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i){this.$translate=e,this.ConfirmActionDialog=t,this.deleteGroupsActionNotification=r,this.Groups=n,this.toaster=i}return t.prototype.showDeleteGroupDialog=function(t,r){var n,i,o=this;if(1===t.size()){var s=t.first();n=this.$translate.instant("confirmDeleteGroup",{GROUP_NAME:e.L10n.elideIfLong(s.name)}),i=this.$translate.instant("groupDeleted",{GROUP_NAME:e.L10n.elideIfLong(s.name)})}else n=this.$translate.instant("confirmDeleteGroups",{GROUP_COUNT:t.size()},e.L10n.Interpolations.Count),i=this.$translate.instant("groupsDeleted",{GROUP_COUNT:t.size()},e.L10n.Interpolations.Count);var a=this.ConfirmActionDialog.open({scope:r,title:this.$translate.instant("delete"),bodyText:n,actionName:this.$translate.instant("confirmDeleteButton",{ITEM_COUNT:t.size()},e.L10n.Interpolations.Count),isDeleteAction:!0,action:function(){return o.Groups.deleteGroups(t.keys())}});return a.result.then(function(e){o.deleteGroupsActionNotification.notify(e,t)}),a.result},t.$inject=["$translate","ConfirmActionDialog","DeleteGroupsActionNotification","Groups","ToasterService"],t}();e.DeleteGroupAction=t,e.Module.instance().service("DeleteGroupAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"deleteServerUsers",t)}return __extends(t,e),t}(e.Request);e.DeleteServerUsersRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i,o){this.$state=e,this.$translate=t,this.ConfirmActionDialog=r,this.userActionNotification=n,this.ServerUsers=i,this.toaster=o}return t.prototype.showDeleteUsersFromServerDialog=function(t,r){var n=this,i=this.$translate.instant("confirmDeleteUsers",{USER_NAME:e.L10n.elideIfLong(t.first().displayName),USER_COUNT:t.size()},e.L10n.Interpolations.Count),o=this.ConfirmActionDialog.open({scope:r.scope,title:this.$translate.instant("delete"),bodyText:i,actionName:this.$translate.instant("confirmDeleteButton",{ITEM_COUNT:t.size()},e.L10n.Interpolations.Count),isDeleteAction:!0,action:function(){return n.ServerUsers.deleteUsers(t.keys())}});return o.result.then(function(e){var r={users:t,results:e.results,errors:e.errors,successCode:"11"};n.userActionNotification.notify(r)}),o.result},t.$inject=["$state","$translate","ConfirmActionDialog","UserActionNotification","ServerUsers","ToasterService"],t}();e.DeleteUsersFromServerAction=t,e.Module.instance().service("DeleteUsersFromServerAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function e(e,t,r,n){this.$q=e,this.$timeout=t,this.windowLocationService=n,this.initHiddenIFrame(r)}return e.prototype.initHiddenIFrame=function(e){this.hiddenIFrame=e.document.createElement("iframe"),this.hiddenIFrame.className="ng-hide",e.document.body.appendChild(this.hiddenIFrame)},e.prototype.launchDesktop=function(t){t.focus();var r=this.$q.defer();t.one("blur",function(){r.resolve()}),this.$timeout(function(){return r.reject()},e.DesktopLaunchTimeoutMillis);try{this.windowLocationService.navigateIFrameTo(this.hiddenIFrame,e.URIScheme)}catch(n){return this.$q.reject()}return r.promise},e.DesktopLaunchTimeoutMillis=4e3,e.URIScheme="tableau:",e.$inject=["$q","$timeout","$window","WindowLocationService"],e}();e.DesktopLaunchService=t,e.Module.instance().service("DesktopLaunchService",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t,r){e.call(this,t,{id:r})}return __extends(t,e),t}(e.Request);e.GetDetailRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n){this.server=e,this.$q=t,this.requestMethod=r,this.resultMapper=n}return t.prototype.fetchById=function(t){var r=this;return this.server.sendRequest(new e.ServerApi.GetDetailRequest(this.requestMethod,t)).then(e.ResultHelper.rejectResultOnError(this.$q)).then(function(e){return r.$q.when(r.resultMapper(e))},function(e){return r.$q.reject(e.errors&&e.errors[0]&&e.errors[0].code)})},t}();e.ServerDetailFetcher=t}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t){this.$q=e,this.server=t}return t.prototype.getServerDetailFetcher=function(t,r){return new e.ServerDetailFetcher(this.server,this.$q,t,r)},t.prototype.getServerResourceFetcher=function(t,r){return new e.ServerResourceFetcher(this.server,t,r)},t.$inject=["$q","ServerService"],t}();e.FetcherFactory=t,e.Module.instance().service("FetcherFactory",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t;!function(e){var t=function(e){function t(t){e.call(this,"getActionableObjects",t)}return __extends(t,e),t}(e.Request);e.GetActionableObjectsRequest=t}(t=e.ServerApi||(e.ServerApi={}))}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e){this.server=e}return t.prototype.editPermissions=function(r){return this.server.sendRequests(e.RequestHelper.buildRequests(r.ids,function(t){return new e.ServerApi.GetActionableObjectsRequest({authorizables:{type:r.type,ids:t}})}),t.combineResults)},t.combineResults=function(t){return{ids:e.ResultHelper.combineIds(t),errors:e.ResultHelper.combineErrors(t)}},t.$inject=["ServerService"],t}();e.GetActionableObjectsForAction=t,e.Module.instance().service("GetActionableObjectsForAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t){this.$state=e,this.$translate=t}return t.prototype.errorDetailsFor=function(t){return{itemName:t.item.name,itemUrl:t.error.code===e.CommonErrorCode.ProjectNotFound?null:this.projectUrl(t.item),errorMessage:this.errorMessageFor(t)}},t.prototype.projectUrl=function(e){return this.$state.href("main.site.content.project.details",{id:e.id})},t.prototype.errorMessageFor=function(t){var r=t.item;switch(t.error.code){case e.ProjectErrorCode.ProjectChangeOwnerDisabled:return this.$translate.instant("errorProjectChangeOwnerDisabled");case e.ProjectErrorCode.ProjectDescriptionGreaterThanMaxLength:return this.$translate.instant("errorProjectDescriptionTooLong");case e.ProjectErrorCode.ProjectNameAlreadyExists:return this.$translate.instant("errorProjectNameAlreadyExists");case e.CommonErrorCode.ProjectNotFound:return this.$translate.instant("errorProjectNotFound",{PROJECT_NAME:e.L10n.elideIfLong(r.name)});case e.CommonErrorCode.CallingUserInsufficientPermissions:return this.$translate.instant("errorProjectInsufficientPermissions");default:return this.$translate.instant("errorUnknown")}},t.$inject=["$state","$translate"],t}();e.ProjectErrors=t,e.Module.instance().service("ProjectErrors",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n){this.$translate=e,this.ConfirmActionDialog=t,this.SiteUsers=r,this.groupMembershipUpdateActionNotification=n}return t.prototype.showRemoveUsersFromGroupDialog=function(t,r){var n=this,i=this.$translate.instant("confirmRemoveUsersFromGroup",{USER_NAME:e.L10n.elideIfLong(t.first().displayName),USER_COUNT:t.size(),GROUP_NAME:e.L10n.elideIfLong(r.name)},e.L10n.Interpolations.Count),o=this.ConfirmActionDialog.open({title:this.$translate.instant("remove"),bodyText:i,actionName:this.$translate.instant("confirmRemoveButton",{ITEM_COUNT:t.size()},e.L10n.Interpolations.Count),isDeleteAction:!0,action:function(){return n.SiteUsers.removeFromGroups(t.keys(),[r.id])}});return o.result.then(function(e){n.groupMembershipUpdateActionNotification.notify(e,t,0,null,1,r.name)}),o.result},t.$inject=["$translate","ConfirmActionDialog","SiteUsers","GroupMembershipUpdateActionNotification"],t}();e.RemoveUsersFromGroupAction=t,e.Module.instance().service("RemoveUsersFromGroupAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i){this.$translate=e,this.toaster=t,this.Projects=r,this.longRunningActionService=n,this.scope=i}return t.prototype.execute=function(t,r,n){return this.scope=n,_.first(r)===e.LockUnlockProjectPermissionsState.Locked?this.lockProjectPermissions(t):this.unlockProjectPermissions(t)},t.prototype.lockProjectPermissions=function(t){var r=this,n=t.pluck("id");return this.Projects.setProjectControlledPermissions(n).then(function(n){var i;if(n.errors&&n.errors.length)i={type:e.ToastType.Error,text:r.errorMessageFor(n.errors[0],t.first())};else{var o=r.$translate.instant("lockProjectPermissionsChangeSuccess_locked",{PROJECT_COUNT:t.size()});i={type:e.ToastType.Info,text:r.$translate.instant("lockProjectPermissionsChangeSuccess",{PROJECT_COUNT:t.size(),PROJECT_NAME:e.L10n.elideIfLong(t.first().name),PERMISSION_SOURCE:o},e.L10n.Interpolations.Count)}}return r.toaster.pop(i),n})},t.prototype.unlockProjectPermissions=function(t){var r=this,n=t.pluck("id"),i=function(n){
if(n&&n.succeeded===!1)o(e.ErrorReason.Unknown);else{r.scope.percentComplete=n.percentComplete;var i=r.$translate.instant("lockProjectPermissionsChangeSuccess_unlocked",{PROJECT_COUNT:t.size()}),s={type:e.ToastType.Info,text:r.$translate.instant("lockProjectPermissionsChangeSuccess",{PROJECT_COUNT:t.size(),PROJECT_NAME:e.L10n.elideIfLong(t.first().name),PERMISSION_SOURCE:i},e.L10n.Interpolations.Count)};r.toaster.pop(s),r.scope.busyUnlocking=!1}return n.response},o=function(t){r.scope.busyUnlocking=!1;var n={type:e.ToastType.Error,text:r.$translate.instant("errorUnknown")};r.toaster.pop(n)},s=function(e){r.scope.busyUnlocking=!0,r.scope.percentComplete=e.percentComplete};return this.Projects.setContentControlledPermissions(n).then(function(e){var t=r.longRunningActionService.trackProgress(e.actionId);return t.promise.then(i,o,s)})},t.prototype.errorMessageFor=function(t,r){switch(t.code){case e.CommonErrorCode.ProjectNotFound:return this.$translate.instant("errorProjectNotFound",{PROJECT_NAME:e.L10n.elideIfLong(r.name)});default:return this.$translate.instant("errorUnknown")}},t.$inject=["$translate","ToasterService","Projects","LongRunningActionService"],t}();e.SetProjectControlledPermissionsAction=t,e.Module.instance().service("SetProjectControlledPermissionsAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e,t,r,n,i,o){this.$translate=e,this.$q=t,this.ConfirmActionDialog=r,this.Groups=n,this.renameGroupActionNotification=i,this.toaster=o}return t.prototype.showUpdateGroupNameDialog=function(t,r){var n=this,i=r.$new();i.description=this.$translate.instant("updateGroupNameDesc",{GROUP_NAME:e.L10n.elideIfLong(t.name)}),i.input={text:t.name,maxLength:255};var o=this.ConfirmActionDialog.open({title:this.$translate.instant("updateGroupNameTitle"),bodyTemplateUrl:"confirmActionDialogInput.html",scope:i,position:{reserveHeight:250},confirmDisabled:function(){return _.isEmpty(i.input.text)},actionName:this.$translate.instant("updateGroupNameTitle"),action:function(e){return n.Groups.updateGroupName(t.id,i.input.text).then(function(r){return n.renameGroupActionNotification.notify(function(t){e.showErrorMessage(t)},r,i.input.text,t.name),r})}});return o.result.fin(function(){return i.$destroy()}),o.result},t.prototype.updateGroupNameInPlace=function(t,r){var n=this;return this.rejectOnError(this.Groups.updateGroupName(t.id,r).then(function(i){var o="";return i.errors&&i.errors.length?(o=n.$translate.instant("updateGroupNameErrorMsg",{ITEM_NAME:e.L10n.elideIfLong(t.name),NEW_ITEM_NAME:e.L10n.elideIfLong(r)}),n.toaster.pop({type:e.ToastType.Error,text:o})):(o=n.$translate.instant("updateGroupNameSuccessMsg",{ITEM_NAME:e.L10n.elideIfLong(t.name),NEW_ITEM_NAME:e.L10n.elideIfLong(r)}),n.toaster.pop({type:e.ToastType.Info,text:o}),t.name=r),i}))},t.prototype.rejectOnError=function(e){var t=this;return e.then(function(e){return e.errors&&e.errors.length?t.$q.reject(e):void 0})},t.$inject=["$translate","$q","ConfirmActionDialog","Groups","RenameGroupActionNotification","ToasterService"],t}();e.UpdateGroupNameAction=t,e.Module.instance().service("UpdateGroupNameAction",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e){this.$translate=e,t.validUserActionCodes={};var r=[1].concat(_.range(10,16)).concat(_.range(20,22)).concat(_.range(30,33)).concat(_.range(40,43)).concat(_.range(50,58));_.each(r,function(e){return t.validUserActionCodes[e]=!0})}return t.prototype.toLocalizedResultMessage=function(t,r){return void 0===r&&(r=1),t=this.normalizeUserActionCode(t),this.isValidUserActionCode(t)?this.$translate.instant(["userActionBulkOperationResult_",t].join(""),{COUNT:r},e.L10n.Interpolations.Count):(console.log("unknown code "+t),"")},t.prototype.toLocalizedErrorMessage=function(t,r){return void 0===r&&(r=1),t=this.normalizeUserActionCode(t),this.isValidUserActionErrorCode(t)?this.$translate.instant(["userActionBulkOperationErrorResult_",t].join(""),{COUNT:r},e.L10n.Interpolations.Count):(console.log("unknown code "+t),"")},t.prototype.normalizeUserActionCode=function(e){return"string"==typeof e&&(e=parseInt(e.toString(),10)||0),e},t.prototype.isValidUserActionCode=function(e){return!!t.validUserActionCodes[e]},t.prototype.isValidUserActionErrorCode=function(t){return!!e.UserErrorCode[t]||!!e.CommonErrorCode[t]},t.$inject=["$translate"],t}();e.UserActionResultCode=t,e.Module.instance().service("UserActionResultCode",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){var t=function(){function t(e){this.$translate=e}return t.prototype.errorDetailsFor=function(e){return{itemName:e.item.name,itemUrl:null,errorMessage:this.errorMessageFor(e)}},t.prototype.errorMessageFor=function(t){var r=t.item;switch(t.error.code){case e.CommonErrorCode.ViewNotFound:return this.$translate.instant("errorViewNotFound",{VIEW_NAME:e.L10n.elideIfLong(r.name)});case e.CommonErrorCode.CallingUserInsufficientPermissions:return this.$translate.instant("errorViewInsufficientPermissions");default:return this.$translate.instant("errorUnknown")}},t.$inject=["$translate"],t}();e.ViewErrors=t,e.Module.instance().service("ViewErrors",t)}(VizPortal||(VizPortal={}));var VizPortal;!function(e){e.Module.instance().directive("tbWindowMaxWidth",["$window",function(e){return{restrict:"A",link:function(t,r,n){var i=function(){return r.css("maxWidth",$(e).width())};i(),$(e).on("resize",i),r.on("$destroy",function(){$(e).off("resize",i)})}}}])}(VizPortal||(VizPortal={}));
//# sourceMappingURL=vizportal.min.js.map
{"version":3,"sources":["vizportal.js"],"names":["Helpers","dictFromArray","array","key","_","object","pluck","toBoolean","val","swapDict","map","values","keys","BooleanQueryParamRegex","BooleanQueryParamRegexFalse","FeatureFlagsHelper","getOverridesFromQueryString","queryString","params","slice","split","overrides","forEach","param","override","parseQueryParameter","isOverrideValid","push","flagName","value","keyAndValue","decodeURIComponent","valueString","test","overwriteFeatureFlagsFromQueryString","featureFlagsObj","isFlagDefined","featureFlagsOverwrittenFromQueryString","overwriteFeatureFlagsFromServerFeatureFlags","serverFeatureFlags","each","flag","undefined","VizPortal","FeatureFlags","contentAnalyticsEnabled","dataSyncEnabled","homePlaceEnabled","oAuthWDCServerRefresh","projectControlledPermissionsEnabled","projectPermissionsTemplatesEnabled","toggleSelectableRow","reactDataGridInGroupsPlace","reactDatasourceGrid","reactExtractTasksGrid","reactGroupUsersGrid","reactProjectGrid","reactRemoteSchedulesGrid","reactSchedulesGrid","reactServerUsersGrid","reactSitesGrid","reactSubscriptionsGrid","reactViewGrid","reactWorkbookGrid","reactDataGridInSiteUsersPlace","reactDataGridLoadingIndicator","reactFavoritesMenu","reactThumbnailsInWorkbooksAndViews","reactTypeaheadFilter","reactToasts","reactTopBar","reactTopBarDark","connectedClientsTableEnabled","useTallerRowHeight","useUpdatedFontStyles","webDataConnectorsEnabled","workbookVersionHistoryEnabled","window","location","search","ContentFiltersKeys","connectionType","createdBefore","createdAfter","databaseUsername","domain","forWorkbook","hasDatasource","hasAlert","hasExtracts","hasPassword","inGroup","lastRefreshedBefore","lastRefreshedAfter","maxSiteRole","groupsMinimumSiteRole","modifiedBefore","modifiedAfter","owner","project","schedule","serverName","serverPort","showEmbedded","siteId","siteRole","tag","workbook","datasource","favorite","recent","group","BuildId","Module","instance","_instance","angular","module","registerEagerService","serviceName","eagerServices","initializeEagerServices","injector","service","get","ServerApi","Request","method","this","prototype","send","server","sendRequest","__extends","d","b","__","constructor","p","hasOwnProperty","UpdateDisplayModeRequest","_super","call","UserKeys","id","authId","displayName","AuthenticationType","AD","ClientCertificate","ClientCertificateWithFallback","Kerberos","Local","OpenId","Saml","Sspi","DomainFamily","ActiveDirectory","External","NamedItemKeys","name","DisplayModes","list","thumbnail","ViewportContent","deviceWidth","fixedWidth","BrowserSupportService","$window","msieMatch","MSIE_REGEX","exec","navigator","userAgent","touchTest","TOUCH_REGEX","chromeIOSTest","CHROME_IOS_REGEX","chromeAndroidTest","CHROME_REGEX","ANDROID_REGEX","isIE7orLess","isIE8orLess","isIE9orLess","parseInt","isTouch","isAndroidChrome","supportsFormData","supportsFileReader","supportsDragAndDropEvents","div","document","createElement","setViewport","content","viewportEl","$","newViewportEl","attr","length","replaceWith","head","prepend","$inject","L10n","MissingTranslationHandlerName","factory","console","error","language","loadLocaleJson","data","Globalize","load","getGlobalizeLocale","userLocale","cldr","Cldr","locale","mediumShortDateTimePattern","dateTimeFormat","main","formatMessage","useLocale","countFormatter","numberFormatter","maximumFractionDigits","floatFormatter","minimumFractionDigits","percentFormatter","style","dateFormatter","date","dateTimeFormatter","pattern","timeFormatter","time","yearAndMonthFormatter","shortTimeFormatter","hourParser","dateParser","firstDayOfWeekNumber","supplemental","weekData","firstDay","narrowDayNamesArray","wideDayNamesArray","shift","preferredTimeCycle","timeData","preferred","localizedCount","localizedFloat","localizedPercent","formatAsDate","formatter","isDate","isString","Date","parse24Hour","localizedDate","localizedDateTime","localizedShortTime","localizedTime","firstDayOfWeek","firstDayOfWeekIsMonday","is24HourTimeCycle","narrowDayNames","wideDayNames","yearAndMonth","elideIfLong","s","substr","Keys","allOwners","allProjects","allTags","connector","custom","datasourceConnector","datasourceEditor","delete_","denied","edit","editor","interactor","projectLeader","none","permissions","publisher","save","sizeInBytes","sizeInGB","sizeInKB","sizeInMB","title","viewer","SanitizingTranslateInterpolationWrapper","wrappedInterpolation","sanitizeStrategy","setLocale","getInterpolationIdentifier","useSanitizeValueStrategy","savedSanitizeStrategy","interpolate","input","result","NumberLocalizingTranslateInterpolationWrapper","localize","_this","newParams","locKey","has","Interpolations","Escaped","Count","CountEscaped","Float","FloatEscaped","Percent","PercentEscaped","EscapedTranslateInterpolationName","$translateMessageFormatInterpolation","LocalizedCountTranslateInterpolationName","LocalizedCountEscapedTranslateInterpolationName","LocalizedFloatTranslateInterpolationName","LocalizedFloatEscapedTranslateInterpolationName","LocalizedPercentTranslateInterpolationName","LocalizedPercentEscapedTranslateInterpolationName","config","$translateProvider","translationNotFoundIndicatorLeft","translationNotFoundIndicatorRight","useMissingTranslationHandler","useStaticFilesLoader","prefix","suffix","useMessageFormatInterpolation","addInterpolation","ClientCertificateLoginRequest","GeneratePublicKeyRequest","GetServerSettingsUnauthenticatedRequest","GetSessionInfoRequest","InitializeServerWithActiveDirectoryUserRequest","InitializeServerWithExternalUserRequest","InitializeServerWithLocalUserRequest","KerberosLoginRequest","LoginRequest","LogoutRequest","SspiLoginRequest","SwitchSiteRequest","SiteRoles","ServerAdministrator","SiteAdministrator","Publisher","Interactor","Viewer","Unlicensed","ViewerWithPublish","UnlicensedWithPublish","Guest","ToastType","ToasterService","$interval","listeners","nextToastId","nextListenerId","toasts","pop","toastOptions","toast","type","toLowerCase","isClosed","lines","text","templateUrl","timeoutDelay","isNumber","defaultTimeoutForType","notifyListeners","toastType","Info","DefaultTimeOutForInfo","DefaultTimeOutForError","l","toastsUpdated","close","filter","t","find","index","splice","cancel","timeout","addListener","listener","listenerId","removeListener","NoTimeout","constant","SessionState","ErrorReason","AuthLevel","MaxRequestArrayLength","ServerService","$http","$location","$q","$state","$stateParams","$translate","$cookies","apiPrefix","restApiPrefix","toaster","windowLocation","stateWrapperService","sessionState","Unknown","numSessionInfoRequests","sessionInfoPromise","caseInsensitiveSiteUrlNames","Set","siteUrlName","getSessionInfoPromise","when","request","then","requestPost","sendRequests","requests","combineResults","sendNextRequest","results","nextIndex","sendRequestsParallel","all","login","username","password","sessionInfoRequest","generatePublicKeyResult","loginParams","encryptedPassword","rsa","encrypt","keyId","loginRequest","loginResult","errors","reject","setSessionInfo","autoLogin","authType","authenticationType","requestGet","sessionInfo","code","reason","clearSessionInfo","Unauthorized","LoginErrorCodes","SspiFailed","KerberosFailed","ClientCertificateNotFound","initialize","initializeRequest","isServerDomainFamilyActiveDirectory","isServerDomainFamilyLocal","isServerDomainFamilyExternal","Error","initializeResult","refreshSessionInfo","NoSession","fail","refreshServerSettings","serverSettings","overrideAuthenticationType","authenticationTypeOverride","bootstrapSession","sessionInfoNoSessionReason","updateLanguageAndLocale","switchSiteIfNeeded","urlName","podRedirectPath","isCurrentSiteUrlName","SiteSwitchErrorCodes","AttemptedToSwitchSiteToCurrentSite","add","CommonErrorCode","RedirectToOtherPod","redirectToOtherPod","defer","promise","destinationPodPath","destinationPodUrl","getDestinationPodFromError","dest","navigateToWithoutAddingToHistory","contains","sessionSiteUrlName","isUserAuthorized","role","Anonymous","Authenticated","inSession","SiteAdmin","isSessionSiteOrServerAdmin","SelfOrAdmin","isSessionUserSelf","SelfOrServerAdmin","isSessionServerAdmin","ServerAdmin","signOut","logoutResult","navigateTo","redirectUrl","sessionStateString","sessionUserInfo","user","isSessionRestrictedTrustedTicket","isRestrictedTrustedTicketSession","sessionUserDisplayName","sessionUserId","sessionAuthUserId","sessionSiteLuid","site","luid","sessionUsername","sessionUserDomainName","domainName","isSessionUserEqualTo","serverAdmin","isSessionSiteAdmin","sessionSiteId","sessionServerId","logicalServerInstanceId","sessionSite","sessionSiteName","sessionServerVersion","version","thirdPartyAuthState","allowed","enabled","serverEnabled","hasThirdPartyAuthenticatedUsers","isThirdPartyAuthAllowed","isThirdPartyAuthConfiguredForServer","isThirdPartyAuthEnabled","isThirdPartyAuthEditable","sessionSupportHost","supportHost","sessionSupportPath","supportPath","isSessionStateUnknown","isSessionMultiSite","numberOfSites","isLogoutEnabled","logoutEnabled","isLiveDBAvailable","liveDBAvailable","siteLogo","customization","isSiteCustomizationEnabled","siteCustomizationEnabled","isTabAdminServiceEnabled","tabAdminServiceEnabled","isSiteAdminSettingsEnabled","siteAdminSettingsEnabled","waitForSession","sessionLanguage","sessionLocale","updateDisplayNameAllowed","defaultSubscriptionsEmail","featureFlags","changePasswordUrl","datasourceHelpUrl","offlineHelpEnabled","helpEdition","oauthGoogleEnabled","oauthSalesforceEnabled","rebuildingSearchIndex","canSessionUserManageUsers","canManageUsers","domainFamily","getStartPage","startPage","sessionUserDisplayMode","displayMode","isAlertFailureCountEnabled","alertFailureCountEnabled","licenseExpirationDateIfWithinWarningPeriod","licenseExpirationDate","serverCustomization","instant","serverLanguage","defaultLanguage","serverLocale","defaultLocale","isGuestEnabled","guestEnabled","preloginCustomization","makeRequest","fin","getFirstErrorFromResponse","response","getCodeFromError","podRedirectionError","requestConfig","successResponse","maybeHandleSearchServerDown","maybeHandleRedirectionToOtherPod","isUndefined","errorResponse","status","handle401","queryParams","requestParamsAsQueryParams","url","requestPostFormDataToRestApi","formData","transformRequest","headers","Content-Type","current","authLevel","isAuthenticationAutoLogin","isAuthenticationExternal","reload","href","redirect","InvalidSession","replace","errorCode","SolrErrorCode","SolrCommunicationError","SolrDisabled","is","go","detailsLocKey","redirectState","redirectLocKey","isWindowsCredentialsAutoLogin","isAuthenticationSaml","isAuthenticationOpenId","getSessionIdleLimitSeconds","sessionIdleLimitSeconds","newSessionInfo","Exists","showOrHideRebuildingSearchIndexToast","rebuildingSearchIndexToast","oldLanguage","oldLocale","newLanguage","newLocale","languagePromise","localePromise","use","getSupplementalLocaleJson","getLocaleJson","supplementalLocaleJsonPromise","fileName","updateSiteLogo","file","resetToDefaultLogo","FormData","append","CookieKeys","XsrfToken","DisplaySettingsService","displayModeUpdatedFromSession","displayModeUpdatedFromUrl","DefaultDisplayMode","topBar","collapsed","height","showFilterPanel","saveDisplayMode","mode","maybeUpdateDisplayModeFromSession","updateDisplayModeFromUrl","getDisplayModeFromUrl","currentDisplayMode","urlParams","updateShowFilterPanel","UrlParamKeys","SiteUrlName","IsFromSaml","ClosePopupWhenDone","BrowserTitleService","setTitle","placeKey","getTitle","place","OBJECT","PLACE","SERVER_NAME","setVizTitle","viewName","workbookName","VIEW","WORKBOOK","AlertErrorCode","DataConnectionErrorCode","DatasourceErrorCode","UnifiedDatasourceErrorCode","ProjectErrorCode","TagErrorCode","WorkbookErrorCode","SiteSettingsErrorCode","WebClientErrorCode","SchedulingErrorCode","UninitializedServerErrorCode","RestApiErrorCode","UserErrorCode","GroupErrorCode","LdapErrorCode","OnlineErrorCode","SiteKeys","CreateSiteAction","ConfirmActionDialog","Sites","execute","parentScope","getPlaceholderSiteSettings","siteSettingsForServerAdmin","dialogScope","$new","siteSettingsForSiteAdmin","siteAdminSettings","liveDBConnectionsWhitelistEnabled","refreshTokenEnabled","isDefaultSite","hideNameAndId","hideAvailability","autoSelectSiteName","siteSettingsForServerAdminFormState","open","scope","bodyTemplateUrl","actionName","confirmDisabled","isEmpty","isValid","action","createSite","settings","subscriptionSettings","SITE_NAME","errorMessages","size","ModalSize","fitToContent","$destroy","isServerLevelSubscriptionsEnabled","getCurrentSiteSettingsForServerAdmin","errorMessage","isEnabled","placeholderSiteSettings","userCount","licensedUserCount","adminCount","availability","SiteAvailabilityState","ACTIVE","currentLoggedInUserCount","storageQuotaPercentUsed","storageUsedBytes","createdAt","storageQuotaEnabled","storageQuotaBytes","ByteSizeConversionFactor","ONE_GB","siteAdminsCanAddUsers","userQuotaEnabled","userQuota","metricsEnabled","authoringEnabled","sheetImageEnabled","subscriptionsEnabled","customSubscriptionEmailEnabled","customSubscriptionEmail","customSubscriptionFooterEnabled","customSubscriptionFooter","AddSiteCtrl","createSiteAction","VizService","WindowLocationService","reloadOnLocationChange","$scope","reloadOnSearch","$on","currentStateUrlMatcher","$current","newStateParams","path","transitionTo","updatePath","stateParams","extend","newLocationPath","dontReloadNextLocationChange","updateInstanceId","instanceId","InstanceIdKey","updateExplicitOriginalViz","explicitOriginalViz","ExplicitOriginalVizParamKey","getIsExplicitOriginalViz","getExplicitLocationSearchValue","getInstanceId","getVizParams","omit","getIsExplicitOriginalVizFromUrl","match","getPath","uri","getUri","viz","pathList","getOrigin","isAdminViz","concat","join","isEmbedParamOn","EmbedParamKey","pathHasExportableFileType","VizExportFileTypeRegex","getEmbeddedVizqlUrl","options","isFromGuest","IsGuestRedirectFromVizPortalParamKey","getVizqlUrl","removeEventListener","AdminVizViewerCtrl","vizService","workbookUrlId","sheetUrlId","$watch","newPath","isServerAnalysis","includes","ViewNameLocKeyDict","ActionsbyAllUsers","ActionsbySpecificUser","ActionsbyRecentUsers","BackgroundTasksforExtracts","BackgroundTasksforNonExtracts","StatsforLoadTimes","StatsforSpaceUsage","TraffictoDataSources","TraffictoViews","controller","ConnectionAuthService","authenticate","X-Requested-With","download","formatWindowOpenSpecs","specs","windowName","navigateIFrameTo","iframe","contentWindow","protocol","host","getPathQueryFragment","getPathQuery","hash","setPathQueryFragment","pathQueryFragment","WindowPopupService","safelyCallFunction","func","e","maybeNotifyAndClose","closePopupWhenDone","openerPage","opener","tableauPopupComplete","tab","LogOnView","fireLogOnComplete","AuthenticateConnectionCtrl","connectionAuthService","windowLocationService","authInfo","windowPopupService","authVM","defaultUsername","focusOnPassword","doneWithWindow","rememberPasswordsForever","authModeFriendlyName","allowedAuthenticationModes","modeFriendlyName","authModeOptions","selectedAuthMode","authenticationMode","connectionProperties","cp","translate","connectionTypeDisplayName","tbTestId","databaseServer","databaseName","databaseSchema","databaseFilename","attemptAuth","busy","actionPath","getAuthenticateDatabaseParams","isAuthoringSession","errorMessageKey","isPreview","authParams","authentication","crypted","n","modulus","exponent","connection","oauthrequest","rememberPassword","reuse_forever","reuse","Order","clauseFromInput","parts","field","ascending","isValidOrderField","possibleOrderKeys","fromInput","clauses","clauseString","clause","MaxLength","startsWithField","withFirstClauseToggled","newClauses","clone","withClausePrepended","newClause","unshift","asc","desc","withoutField","order","orderClause","findOrderClauseForField","findWhere","serialize","serializeOrderClause","OrderKeys","datasourceCount","definition","favoritesTotal","groupCount","hitsTotal","hitsLastDayTotal","hitsLastMonthTotal","hitsLastTwoWeeksTotal","lastRefreshedAt","lastRunAt","lastSentAt","lastSignIn","minimumSiteRole","numSheets","ownerName","parentName","priority","projectName","refreshType","relevancy","runNextAt","scheduleName","siteCount","siteName","subject","targetName","updatedAt","userName","versionNumber","viewCount","workbookCount","ProjectContentType","filterKeys","orderKeys","defaultOrder","WorkbookContentType","extraQueryParams","statFields","WorkbookRevisionContentType","ViewContentType","ViewInWorkbookContentType","DatasourceContentType","SitesContentType","GroupContentType","SiteUserContentType","ScheduleContentType","ExtractTaskContentType","RemoteRefreshScheduleContentType","SubscriptionContentType","ServerUserContentType","GroupUserContentType","ContentTypes","view","ListResult","items","total","empty","FilterOps","and","eq","lte","gte","inArray","matches","FilterFieldNames","datasourceId","domainId","groupId","groupIds","hasEmbeddedPassword","isDefaultPort","isFavorite","isPublished","isRecent","ownerId","parentId","parentType","projectId","scheduledAction","scheduleId","tags","workbookId","Filter","operator","fieldEq","stringFieldEq","numberFieldEq","stringFieldGte","stringFieldLte","stringFieldMatches","stringArrayFieldHas","stringFieldInArray","findFieldFilterClause","fieldClause","ResourceQuery","fetcher","filterClauses","extraParams","formatFilterClauses","getPage","start","startIndex","maxItems","getSlice","fetchList","page","getFirst","getCount","getFilters","getOrder","withFiltersAndOrder","setFilterClauses","setOrder","withExtraParams","setExtraParams","withFilters","addFilter","filterClause","withOrder","FieldValueResourceType","dataConnection","FieldValuesQuery","resourceType","labelMatchText","matchText","resourceCountFilter","withMatchText","setMatchText","ServerFilterClauses","create","filterValues","filterValue","filterKey","serverFilterClauses","compact","portDefault","Place","subplaceMap","subplaceList","subplace","subplaces","addSubplace","Subplace","resourceQueryFn","filterValuesQueryFn","resource","defaultFilters","excludeFilters","difference","query","filterValuesQuery","emptyResource","urlParamsFn","getFilterClauses","defaults","pick","valuesForField","fieldFilter","NamedItemInfoKeys","BreadcrumbsService","forgetWorkbook","workbookUrl","forgetProject","projectUrl","rememberSiteUrl","siteUrl","rememberProjectUrl","rememberWorkbookUrl","workbookChanged","projectChanged","rememberGroupsUrl","groupsUrl","DistanceFromHostElement","ArrowWidth","medium","ModalService","$compile","$rootScope","$controller","$injector","$templateCache","StackedElementsService","modalInstances","modalInstance","_id","anchoredTo","element","hostElement","keyboard","resolve","backdrop","closeX","modalStackedElement","backdropStackedElement","deferredResult","modalScope","dismiss","toString","_scope","promises","getResolvePromises","cache","resolvedValues","modalElement","classes","addClass","createBackdrop","ctrlLocals","resolveIter","fillWindow","left","top","right","bottom","addStackedElement","contentElement","getContentElementPosition","lastPosition","newPosition","position","isEqual","$broadcast","attachKeydownHandler","alert","backdropElement","BackdropClass","backdropScope","backdropClasses","backdropClick","on","$event","which","Escape","$apply","detachKeydownHandler","off","getWindowSize","width","minimumSpace","MinimumSpaceBetweenDialogAndViewport","reserveHeight","Math","max","outerHeight","positionRelativeToHostElement","_showArrow","outerWidth","parents","hostElementOffset","offset","min","spaceAboveHostElement","resolves","promisesArr","isFunction","isArray","invoke","removeStackedElement","remove","dismissAll","toArray","directive","restrict","link","showArrow","arrowUp","arrowLeft","modalOffsetTop","Tab","tabbables","first","last","target","shiftKey","preventDefault","focus","event","modalPosition","hostElementPosition","midpointOfHostElement","css","ActionContext","fromEvent","targetElement","currentTarget","MultipleResultNotificationOptions","translator","anySucceeded","successSummary","tryTranslate","describeSuccessSummary","successCount","anyFailed","errorSummary","describeErrorSummary","errorCount","errorDetails","errorItems","errorItem","describeErrorDetail","fn","ex","ContentActionNotification","modal","SliceableFactory","notifyResult","translations","translationParams","notificationLines","successId","ITEM_COUNT","errorId","ERROR_COUNT","notify","openModal","anchor","newScope","contentComponent","React","createClass","showDetails","props","findDOMNode","render","detailsLink","DOM","a","onClick","detailsLinkText","span","errorDetailsSliceable","fromArray","notifySuccess","successMessage","notifyFailure","failureMessage","AbstractContentAction","executeFromEvent","contentItems","actionContext","dialogConfig","defaultDialogConfig","configureDialog","dialogInstance","notificationTranslationIds","notificationTranslationValues","noop","ActivateSitesAction","sites","dialog","bodyText","activate","SliceableHelper","fetchAll","sliceable","itemsReceived","totalList","getBlock","blockStartIndex","BlockSize","RequestHelper","makeBlocks","blockSize","blocks","numBlocks","ceil","i","buildRequests","buildRequest","DefaultBlockSize","buildRequests2","items1","items2","blocks1","blocks2","i1","l1","i2","l2","buildRequests3","items3","blocks3","i3","l3","keyForItem","fromKeyArray","set","item","addItems","fromIdItemArray","singleton","keyFor","containsKey","itemId","update","updateItems","removeItems","removeItemsIn","removeItemsNotIn","toggle","toggleItems","clear","iterator","context","propertyName","reduce","memo","sum","any","filterFunction","filteredSet","getByIndex","ResultHelper","combine","getProperty","flatten","combineByKey","allProperties","apply","combineErrors","combineIds","ids","combineUsers","users","combineCodes","combineUserResults","combineImportUserResults","hasErrors","rejectResultOnError","getErrorIds","excludeCode","getErrorIdsWithCode","ScheduleTypes","Hourly","Daily","Weekly","Monthly","ScheduleActions","Extract","Subscription","ScheduleDaysOfTheWeek","Sun","Mon","Tue","Wed","Thu","Fri","Sat","ScheduleLastDayOfMonth","CreateScheduleRequest","DeleteSchedulesRequest","GetSchedulesRequest","RunServerSchedulesRequest","RunSchedulesRequest","SetEnabledStatusForSchedulesRequest","SetScheduleNameRequest","Resource","allQuery","getById","additionalFilterClauses","Schedules","ErrorNotifyingServer","FetcherFactory","getServerResourceFetcher","schedules","filterByActionType","scheduledActionType","getByIdForSite","setEnabledStatus","idsBlock","disable","enable","del","runServer","run","UpdateScheduleRequest","rename","newName","CreateExtractTasksMode","DialogMode","RefreshNow","ScheduleRefresh","CreateExtractTasksAction","ContentUrl","Workbooks","Datasources","SearchSuggestionsService","ActionHelpers","createDialogScope","schedulePrompt","allowedMode","extractTask","ExtractTaskType","RefreshExtract","scheduleSource","schedulesSource","allowIncremental","hasIncrementalExtract","extractTaskTypeOptions","labelTranslateKey","IncrementExtract","AllowSchedule","showModeSelector","AllowBoth","scheduleRefreshAction","refreshNowPrompt","refreshNowAction","errorDetailFn","buttons","label","disabled","dialogTitle","notifyStandardError","AllowRefreshNow","createExtractErrorMessageFor","SchedulingScheduleNotFound","SCHEDULE","workbookSet","wb","forWorkbooks","workbooks","WORKBOOK_NAME","COUNT","WORKBOOK_COUNT","createExtractTask","refreshExtracts","workbookErrorDetailFactory","itemName","itemUrl","forItem","workbookErrorMessageFor","TaskTypeRefreshExtractNotAllowed","TaskTypeIncrementExtractNotAllowed","SchedulingExtractTaskExistsForTarget","CallingUserInsufficientPermissions","forDatasource","datasourceSet","ds","forDatasources","datasources","anyRefreshableDatasources","showCannotRefreshErrorAlert","DATASOURCE_NAME","DATASOURCE_COUNT","datasourceErrorDetailFactory","isRefreshableDatasource","isObject","allEmbedded","anyEmbedded","messageId","titleId","datasourceErrorMessageFor","OperationOnlySupportedForPublishedDatasource","ChangeDatasourceOwnerAction","DataSourceErrors","DataSources","suggestions","confirmChangeOwner","ownerPicker","prompt","NAME","ownerQuery","usersWithoutGuest","targetOwner","newDialogScope","currentOwnerId","setOwner","errorDetailsFor","TagsHelper","tagsListFromTaggedItemSet","taggedSet","tagCounts","taggedItem","tagName","tagList","count","tagWithCount","sortBy","tagSetFromTagsList","tagSet","getTagsChange","previousTagSet","newTagsList","changeTags","addTags","removeTags","keepTag","added","previousTag","unquote","previousTagName","parseTagString","tagString","quotedTag","splitTags","commaSplitTag","union","quote","displayTagHtml","escape","ChangeTagsActionHelperService","createExecuteFn","itemSet","configureScope","getDescription","model","editTags","changeTagsAction","notificationIds","description","errorMessageFor","TagNameTooLong","ChangeDatasourcesTagsAction","ChangeTagsActionHelper","changeTagsErrorDetail","showChangeTagsDialog","ChangeProjectOwnerAction","ProjectErrors","Projects","projects","adminUsers","ChangeViewTagsAction","Views","views","ChangeWorkbookOwnerAction","WorkbookErrors","ChangeWorkbooksTagsAction","CreateProjectAction","showErrorMessage","PROJECT_NAME","ProjectNameAlreadyExists","DeleteDatasourcesAction","confirmDeleteDatasource","confirmDeleteDatasources","dialogBody","isDeleteAction","serverResult","DeleteProjectsAction","confirmDeleteProjects","PROJECT_COUNT","DeleteSitesAction","SiteSwitchService","ITEM_NAME","confirmActionDialogInstance","isAttemptingToDeleteCurrentSite","switchIfNeededNoFeedback","deleteSites","actionResult","onComplete","onFail","onNotify","succeeded","setProgress","attemptedToDeleteDefaultSiteError","AttemptedToDeleteDefaultSite","percentComplete","DeleteWorkbooksAction","confirmDeleteWorkbooks","w","VIEW_COUNT","DownloadActions","downloadItem","downloadUrl","downloadWorkbook","success","downloadDatasource","downloadWorkbookRevision","revision","EditSiteAction","$timeout","siteSettingsForSiteAdminFormState","copy","isFormUnchanged","ResponseDelay","MultipleItemResult","firstSuccessfulItem","once","errorIds","successIds","standardErrorDetails","urlFn","errorMessageFn","itemNameFn","DefaultItemNameFn","standardErrorNotification","firstErrorItem","firstErrorItemName","itemResult","errorNotificationOptions","deselectNotFound","selectedItems","notFoundCode","deselectAllExceptErrors","MoveToProjectAction","moveWorkbooks","move","promptId","moveToProject","moveDatasources","itemType","moveFn","projectPicker","projectsQuery","targetProject","notification","RenameProjectAction","maxLength","getErrorMessage","executeInPlace","workbookErrorItem","WorkbookNotFound","WorkbookDescriptionTooLong","WorkbookDisabled","WorkbookNameAlreadyExistsInDestinationProject","WorkbookDestinationProjectNotFound","WorkbookMoveInsufficientPermissionsOnDestinationProject","WorkbookMoveInsufficientPermissionsOnSourceProject","WorkbookMoveInsufficientPermissionsOnWorkbook","SetDisplayTabsAction","setDisplayTabs","displayTabs","setDisplayTabsAction","confirmSetDisplayTabs","workbookArray","anyTabsEnabled","anyTabsDisabled","testId","SuspendSitesAction","suspend","AttemptedToSuspendDefaultSite","ContentActions","contentActionNotification","deleteProject","projectDetail","projectInfo","deleteProjects","deleteWorkbook","workbookDetail","workbookInfo","deleteWorkbooks","moveWorkbooksToProject","moveDatasourcesToProject","createProject","renameProjectPopup","renameProject","changeOwnerOnDatasources","changeOwnerOnProjects","changeOwnerOnWorkbooks","suspendSite","activateSite","editSite","authoring","authoringUrl","editWorkbook","editUrl","editView","newWorkbook","newWorkbookUrl","handleSingleItemResponse","setTagsOnViews","setTagsOnView","tagsToAdd","tagsToRemove","setTagsOnWorkbook","setTagsOnWorkbooks","setTagsOnDatasource","setTagsOnDatasources","ChangeDatasourceDescriptionAction","newDescription","setDescription","DatasourceDescriptionGreaterThanMaxLength","DatasourceNotFound","ChangeProjectDescriptionAction","ProjectDescriptionGreaterThanMaxLength","ProjectNotFound","ChangeWorkbookDescriptionAction","RevisionHistoryAction","showRevisionHistory","revisionHistoryAction","revertWorkbook","SitePlaceCtrl","breadcrumbs","contentActions","SubplaceCountsHelper","keepSubplaceCountsUpdated","SubplaceTabsHelper","refreshWhenCurrentTabClicked","ProjectPlaceCtrl","projectActions","objectName","projectSet","allowedAction","changeDescription","changeOwner","hardReload","contentBreadcrumbUrl","WorkbookPlaceCtrl","Favorites","workbookActions","setWorkbook","permissionsInfoMessage","markRecentlyViewed","newVal","oldVal","refreshNow","addFavorite","addWorkbook","removeFavorite","removeWorkbook","projectBreadcrumbUrl","isWorkbookRevisionHistoryEnabled","DatasourcePlaceCtrl","datasourceActions","setDatasource","newDatasource","refreshModeIsRemote","remoteRefreshesEnabled","refreshMode","RefreshModeTypes","Remote","refreshModeIsServer","ContentFilterService","getFilter","explicitFilterKeys","implicitFilters","explicitFilters","SiteRoleFilterHelper","siteRoleOptions","roles","userCountsByRole","AnyRole","FilterCategories","general","PasswordStatus","DatasourceType","FilterPanelService","createFilterDefinitions","filterDefinitions","indexBy","category","valueFromParams","fromSingleParam","paramValue","valueToParams","toSingleParam","fieldValue","matchPrefixesOnly","siteRoleFilterDefinition","groupsMinimumSiteRoleDefinition","maxSiteRoleDefinition","afterDateFilterDefinition","beforeDateFilterDefinition","booleanFilterDefinition","selectFilterDefinition","Published","true","All","only","Embedded","dataConnectionType","textFilterDefinition","textDropdownFilterDefinition","Any","false","NotEmbedded","siteRoleSelectFilterDefinition","WithoutGuest","WithoutGuestOrServerAdmin","paramToValueMap","valueToParamMap","dateFromISOString","DateHelpers","toISOString","endOfDay","midnight","fromISOString","paramName","valueFn","paramValueFn","getFilterDefinitions","filterNames","defns","filterName","defn","FilterPanelCtrl","filters","ready","isGeneral","isDatasource","isCheckbox","anyGeneralFilters","some","anyDatasourceFilters","generalFilter","generalCheckbox","datasourceFilter","datasourceCheckbox","filterControls","clearAllFilters","filterControl","submitSearch","searchText","blur","updateModelFromURL","anyFiltersActive","SelectionEvent","SelectionStarted","SelectionEnded","selection","cancelSelectAll","selectAll","$emit","selecting","DropdownHelper","setupDropdownScope","focusElement","rowToModel","reset","editMode","textValue","currentRow","select","mousedownOutside","closest","handleKeyEvent","ArrowDown","ArrowUp","Enter","TypeaheadColumnWidths","widths","getActual","setWidths","totalWidth","firstCellWidth","$parse","autoEdit","typeaheadItemText","pre","attributes","placeholder","typeaheadPlaceholder","$parent","typeaheadMatchPrefixesOnly","withCounts","typeaheadWithCounts","typeaheadSource","post","itemText","row","columnWidths","ONE_KB","ONE_MB","roundToPrecision","f","precision","multiplier","pow","wholeNumber","floor","round","isFinite","SIZE","ListLayout","rowHeight","DefaultRowHeight","metrics","dimensions","numberOfRows","numberOfCols","heightOfRowInPx","CheckConnectionRequest","UpdateConnectionsRequest","AddNewOAuthCredentialOptionId","PasswordUnchanged","CredentialOptions","oauth","MixedCredentialOptions","DialogReserveHeight","EditConnectionAction","DataConnections","OAuthCredentials","AddOAuthCredentialAction","confirmEditConnections","dataSources","datasourceArray","haveSameConnectionType","areEditable","connectionOAuth","confirmEditOAuthConnections","confirmEditDatabaseConnections","uniqueConnectionTypes","uniq","connectionTypeEditable","makePrompt","editModel","uniqueValueOrMixed","connectionDetails","isEmbedded","uniqueValueOrUndefined","newPassword","showTestConnection","testConnection","testConnectionResult","checkEditedConnection","applyConnectionEdits","configureEditOAuthScope","allowOAuthWithPassword","SalesforceConnectionType","promptEmbedCredential","promptNoCredential","describeEmbedCredential","describeNoCredential","oauthEditModel","createOAuthEditModel","refreshCredentials","credentialsListResult","credentials","canAddForConnectionType","addNewOAuthCredentialOptionValue","credentialId","credential","credentialOption","usernamePassword","checkOAuthConnection","testConnectionDisabled","isPending","withAuthenticationSubHeader","updateOAuthConnections","credentialNoValueOptionText","commonCredentialForDatasources","numAuthenticationTypes","hasManagedKeychain","hasOAuthCredential","hasNone","commonUsername","oauthCredentialId","updateRequest","updateConnections","updateConnectionsOAuth","TextBoxMixedValues","editModelToConnectionUpdate","port","passwordUpdate","DataConnectionNotFound","UpdateConnectionsInvalidPort","checkConnection","updateTestConnectionResult","checkExistingConnection","serverResponse","messages","handleTestResult","ColumnWidths","resizer","ColumnWidthsResizer","actualWidths","getTotal","totalActualWidth","updateTotal","setActual","resetActual","getMin","minWidths","setMinWidths","maybeExpand","hasMinWidths","getPreferred","preferredWidths","getPreferredWithMax","maxPreferred","setPreferredWidths","containerWidth","hasPreferredWidths","setContainerWidth","hasContainerWidth","expandToFill","availableWidth","numColumns","times","MaxStartWidth","extraWidth","actualWidth","preferredWidth","usedWidth","startResize","x","startX","startWidth","minWidth","continueResize","dx","VizPortalReact","CommonStyles","Colors","White","Black","Grey40","Grey68","Grey89","Grey102","Grey136","Grey153","Grey178","Grey218","Grey224","Grey230","Grey245","Grey250","BlueHighlight","BorderColor","GreyTextColor","NormalTextColor","DisabledTextColor","ActionOrange","ActionOrangeDark","Sizes","MinSupportedAppWidth","TextBoxPadding","TextBoxBorderSize","LineWidth","SmallSpace","DefaultSpace","LineHeight","LargeSpace","RowHeight","XLargeSpace","SmallFontSize","NormalFontSize","HeaderFontSize","SmallIconSize","NormalIconSize","DataGridHeaderHeight","DropdownOffset","Fonts","BodyFont","HeaderFont","IconUrls","Workbook","View","Edges","distanceToEdge","getPermissionsPanelColumnWidths","contentType","PermissionsPanelColumnWidthsImpl","PermissionsPanelLayoutValues","MinColumnWidthsByField","DefaultColumnWidthsByField","ColumnIndicesByContentType","CapabilityColumnWidth","MinDialogWidth","PermissionsPanelColumnWidthsDeprecated","num","granteeName","permissionRole","ProjectColumnIndices","NonProjectColumnIndices","orderedWidthsFromFieldNames","widthsByField","columnIndices","fieldName","measuredWidths","preferredColumnWidths","getPreferredColumnWidths","preferredWidthsByField","columnIndicesByField","indices","measuredWidthValues","getPermissionsDialogWidth","viewportWidth","widthsByContentType","calculatePermissionsDialogWidths","padding","effectiveViewportWidth","capabilitySectionSpacing","scrollBarWidth","fixedColumnsTotalWidth","MinColumnWidths","editRuleButton","deleteRuleButton","getMinColumnWidths","dateString","year","month","day","hours","minutes","seconds","milliseconds","UTC","pad","number","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","getUTCMilliseconds","toFixed","getFullYear","getMonth","getDate","MapperHelper","toNumber","isNull","toDate","arrayToMap","sortTags","AlertListMapper","alerts","statusCode","M","taskId","mostRecentFailureAt","lastSuccessAt","affectedWorkbookIds","alertType","suspended","consecutiveFailureCount","CommentMapper","comments","comment","DatasourceMapper","serverApiDatasources","favoriteDatasources","remoteAgentName","remoteRunNextAt","mapConnectionDetails","mapDetail","UserMapper","mapOne","ProjectMapper","mapName","dsInfo","WorkbookMapper","serverConnectionDetails","ConnectionDetailType","File","fileConnectionDetails","filePathToBasename","BASENAME_REGEXP","basenameMatch","ExtractTaskMapper","dcs","et","targetWorkbook","targetType","ExtractTaskTargetType","targetId","targetDatasource","Datasource","serverApiProjects","controlledPermissionsEnabled","mapNames","RemoteRefreshAgentMapper","mapToResource","agents","agent","RemoteRefreshScheduleMapper","mapToApi","mapSingleToApi","SubscriptionTargetTypes","SubscriptionMapper","subscriptions","sub","targetPath","userId","serverApiUsers","u","readOnly","ViewMapper","serverApiViews","favoriteViews","v","thumbnailUrl","mapParent","serverApiWorkbooks","workbooksStatisticsMax","favoriteWorkbooks","defaultViewId","sheetCount","repositoryUrl","maxStatValues","hitsTimeSeries","mapParents","GetCommentsRequest","DataConnectionTypeKeys","Database","TableauServer","ProjectKeys","GetDatasourcesRequest","GetProjectsRequest","GetUsersRequest","GetViewsRequest","GetWorkbooksRequest","Server","ServerApiMapper","projectResult","dataSourcesResult","favorites","workbooksResult","stats","viewResult","alertList","totalCount","commentResult","extractTasks","extractTaskResult","tasks","remoteRefreshSchedules","remoteRefreshSchedulesResult","remoteRefreshAgents","remoteRefreshAgentsResult","subscriptionResult","fieldValues","fieldValueResult","identity","AddTagsToWorkbooksRequest","CreateExtractTasksRequest","DeleteWorkbooksRequest","GetWorkbookActionsRequest","RecentlyViewedObjectType","MarkRecentlyViewedRequest","MoveWorkbooksToProjectRequest","RemoveTagsFromWorkbooksRequest","tagsList","RevertWorkbookRequest","RunExtractRefreshesOnWorkbooksRequest","SetDisplayTabsRequest","SetWorkbookDescriptionRequest","SetWorkbooksOwnerRequest","getServerService","listFetcher","detailFetcher","getServerDetailFetcher","fieldValuesFetcher","GetFieldValuesRequest","fetchById","actions","sendRequestsAndDelay","targetProjectId","workbookIds","tagsBlock","versionNum","extractType","targetIds","objectId","objectType","EditPermissionsAction","modalService","getActionableObjectsForAction","showEditPermissionsDialog","areAnyEmbeddedDatasourcesSelected","alertCantShowPermissions","translatedMessage","editPermissions","unactionableItems","actionableItems","getCannotViewAllSelectedMessage","authorizables","authorizableType","templateType","widthLayout","permissionsContainerWidth","permissionsPanelHeight","calculatePermissionsPanelHeight","determineInfoMessageFromAuthorizables","tabbedWorkbookSet","headerWidth","setupDescriptionOnScope","calculatePermissionsPanelHeightWithoutPCP","openPermissionsDialog","tabbedCount","untabbedCount","setupPermissionsInfoMessageForTabbedViewsOnScope","setupPermissionsInfoMessageForWorkbooksOnScope","message","assignPermissionsToContentsWidth","hasInfoMessage","modalDialog","modalDialogTitle","modalDialogDescription","availableHeight","stringId","itemCount","descriptionStringIdMap","editPermissionsDescription","numWorkbooks","cannotViewAllSelectedMessageIdMap","HideViewsAction","ViewErrors","confirmDeleteViews","workbooksToDelete","workbooksWithNoViews","deleteViewsConfirmation","VIEW_NAME","deleteWorkbooksConfirmation","hide","workbookViewCount","ActionPanelService","contentActionDefinitions","permissionsAction","renameAction","bind","changeOwnerAction","deleteProjectsAction","newWorkbookAction","downloadDatasourceAction","setTagsOnDatasourcesAction","datasourcePermissionsAction","moveDatasourcesToProjectAction","changeOwnerOnDatasourcesAction","createExtractRefreshForDatasourcesAction","editConnectionAction","deleteDatasourcesAction","editAction","downloadWorkbookAction","moveWorkbooksToProjectAction","createExtractRefreshForWorkbooksAction","viewWorkbookRevisionHistoryAction","deleteWorkbooksAction","ViewNotFound","deleteViewsAction","activateSiteAction","suspendSiteAction","editSiteSettingsAction","deleteSitesAction","anySelected","oneSelected","oneSelectedEmbeddedDatasource","oneSelectedUnrefreshableItem","isAdminOrOwner","oneSelectedUnrefreshableDatasource","getUpdateSiteAvailabilityDisabledFn","toAvailabilityStateName","LOCKED","isAvailable","isDisabled","detailedItem","allowedActions","setProject","refreshContent","allViewsSelected","subplaceCounts","setName","setPermissions","siteUserScope","SUSPENDED","SiteNotFound","editSiteAction","launchWebAuthoring","isConnectionEditable","detail","getContentActionButtons","ActionButtonsHelper","setupActionButtons","actionButtons","menuActions","showActionMenu","availableAction","actionButtonContext","actionMenuContext","menuButton","SubplaceEvents","Refresh","RefreshCounts","subplaceTabClicked","currentTab","updateCountsFromSubplace","subplaceFilters","refreshCounts","force","newFilters","FlowLayout","itemWidth","itemHeight","HelpService","encodeURIComponent","offlineHelpRoute","supportUrlPrefix","getServerHelpUrlByCategory","ONLINE_TOKEN_OFFLINE_PAGE_DICT","lang","helpUrlLanguage","edition","externalVersion","tableauUrl","getGeneralSupportUrl","uid","serverSiteUserId","serverSiteId","serverInstanceId","getDatasourceHelpUrl","queryConnector","indexOf","getHelpLinkLocKey","intRegExp","major","minor","adminusers2","status1","settings-adsync1","Dispatcher","Flux","SetOrderAction","payload","actionType","Type","dispatch","Store","changeListeners","addChangeListener","cb","removeChangeListener","without","broadcast","args","_i","arguments","OrderStore","register","getOrderClauses","SorterFactory","Sorter","orderStore","setPrimary","direction","updateOrder","removeFieldFromOrder","isSortAscending","selectedColumnKey","isSortAscendingBy","isSortDescendingBy","getOrderStore","SiteUrls","siteUrlFragment","forSiteUrlName","home","projectViewsUrl","projectsUrl","workbookViewsUrl","workbookDatasourcesUrl","favoriteWorkbook","viewUrl","viewPath","favoriteView","viewId","usersUrl","userContentUrl","userSettingsUrl","datasourceUrl","datasourceDetailsUrl","datasourceDataConnectionUrl","schedulesUrl","settingsUrl","statusUrl","tasksUrl","AngularContext","compileElement","setupScope","getService","enqueueDigest","$evalAsync","evalAsync","DataGridFavoriteToggle","shouldComponentUpdate","nextProps","nextState","addons","PureRenderMixin","className","handleClick","data-tb-test-id","onSetFavorite","stopPropagation","createFactory","Component","DataGridCells","CheckboxCell","onCheckboxClicked","isSelected","checkboxCellTestId","FavoriteCell","onAddFavorite","onRemoveFavorite","favoriteCellTestId","ActionsCell","contentFormatter","menuDisabled","ActionsMenuColumnCell","getActionTarget","SiteRoleCell","siteRoleName","translationId","UserDisplayNameCell","nameElement","Link","linkFn","linkElement","iconClassName","iconTitle","FixedValue","PlainTextCell","PlainTextCellWithTransform","transform","DateTimeCell","nullDateTimeLabel","dateTime","SizeCell","sizeFilter","Checkmark","propertyNameParts","part","AngularActionsCell","angularContext","AngularDirective","template","LocalizedCount","LocalizedCountWithBar","dataKey","maxStatsObject","normalizedValue","barVerticalMargin","marginTop","DataGrid","BodyRow","InnerHeight","backgroundColor","lineHeight","paddingLeft","verticalAlign","AlertCell","Menu","menuButtonFactory","menuPanelFactory","ScheduleDescriptionCell","scheduleUrlFn","scheduleFrequencyDescriptionFilter","dangerouslySetInnerHTML","__html","CommonDataGridColumns","withActions","originalColumn","actionOptions","cellFormatter","cellStyle","paddingRight","overflow","selected","toggleSelection","resizable","sortable","dataGridProps","siteUrls","getOwnerFn","tooltip","headerStyle","backgroundImage","backgroundRepeat","backgroundPosition","state","measuredHeaderWidths","measuredColumnWidths","colWidths","scrollLeft","rows","isShowingLoadingIndicator","componentDidMount","rect","getBoundingClientRect","gridWidth","fetchInitialData","componentWillReceiveProps","setState","fetchUsingProps","fetch","end","rowStore","getItems","updated","onColumnResize","column","newColumnWidth","$merge","col","onCellClick","handleMeasureHeaderWidths","maybeUpdateColumnWidths","handleMeasureColumnWidths","cols","columnKey","MaxInitialColumnWidth","extraAvailable","ScrollbarWidth","growToFitCols","extraRequested","extraAllocated","growToFit","children","HeaderRow","getProvisionalColumnWidths","sortKey","sortAscending","onHeaderClicked","measureColumnWidths","Body","reportScrollLeftFn","bodyScrollLeft","selectedKeys","EmptyBody","emptyChild","tabIndex","outline","numberOfResizableColumns","provisionalColumnWidths","extraPerHeader","MinimumColumnWidth","measureWidth","componentOrElement","domNode","BodyCell","reportWidthFn","attrs","display","boxSizing","defaultPrevented","color","SelectedColor","isHovered","HoverColor","cells","handleReportCellWidth","borderBottom","whiteSpace","onMouseEnter","handleMouseEnter","onMouseLeave","handleMouseLeave","rowStyle","OuterHeight","BodySection","hoverRow","componentWillMount","rowElements","indexOfFirstVisibleSection","indexOfLastVisibleSection","sections","renderSections","topSpacer","SectionHeight","sectionsWrapper","paddingTop","onScroll","sectionRows","SectionRows","addEventListener","attachEvent","updateSections","componentWillUnmount","detachEvent","node","viewportTop","scrollTop","viewportBottom","HeaderColumn","hovered","boundMouseEnter","boundMouseLeave","resizeMouseX","clientX","initialWidth","delta","isSortable","isResizable","sorted","headerFormatter","onMouseDown","handleReportHeaderWidth","hcols","marginLeft","DatasourceGrid","columns","anyActionsAllowed","inProjectPlace","inWorkbookPlace","nameColumn","connectsToCellFormatter","embeddedName","publishedName","ProjectGrid","textAlign","SiteGrid","showLiveDatabaseConnectionsColumn","userQuotaFormatter","storageUsedFormatter","storageQuotaFormatter","serverLimitElement","ViewGrid","borderRight","SelectableSortKeyDataGridColumn","columnSpec","keyToTextMap","sorterActions","cellFormatterForKey","getOrderDirectionAndTextFromStore","orderClauses","getInitialState","menuHovered","menuButtonTop","menu","ref","fontFamily","fontSize","headerColProps","currentKey","menuItems","menuItemContent","visibility","selectKey","refs","closeMenu","menuPanelStyle","textDecoration","marginRight","textOverflow","onMouseOver","onMouseOut","setPrimaryOrder","WorkbookGrid","showProjectColumn","viewsColKeys","defaultKey","defaultText","ContentSubplaceCtrl","AngularToReactDataGridBridge","queryService","filterPanelService","actionPanelService","AngularContextFactory","detailsUrl","shouldFetchDetails","sorter","useReactDataGrid","isReactDataGridEnabled","configureForReactDataGrid","filterFieldValues","filterField","getFieldValueQuery","listActions","availableListAction","listAction","gridLayout","getItemDetails","detailsResource","getActions","actionResource","pendingDetailId","refresh","createQueryUpdaterFromSubplace","updateReactDataGridRowStore","sliceChanged","newSlice","showModeSwitcher","shouldShowReadMore","card","parent","descriptionContainerHeight","descriptionTextHeight","addView","removeView","emptyTemplateModel","createEmptyTemplateModel","reactDataGridColumnsFor","attachReactDataGridToScope","isDataSourcePlace","helpUrl","help","links","localizedValueKey","ErrorCtrl","redirectSiteUrlName","StateParamKeys","DetailsLocKey","RedirectState","RedirectLocKey","RedirectSiteUrlName","ExtractTasksGrid","isServerPage","serverUrls","showWorkbookOrDatasourceColumn","showScheduleColumn","showSiteColumn","targetLinkFormatter","subscription","siteUrlsForRow","RemoteRefreshScheduleGrid","remoteRefreshScheduleTypeNameFilter","cronExpressionFilter","refreshTypeColumn","locLinkifier","emptyTemplateElementFor","onlySelectedRow","isActionMenu","body","paragraph","statements","statement","SparseCachedList","getRowStyle","LocalSorter","comparableValueTransforms","addTransformForValueComparison","transformFunc","memoize","sortByClauses","unsortedItems","itemsToSort","sort","compareByClauses","clauseIndex","valA","valB","RefreshPropertyHelper","getAvailableRefreshTypes","types","RemoteRefreshTypes","Full","Incremental","canBeRefreshedRemotely","getCurrentRefreshLocation","refreshed","redirectByDatasourceRefreshMode","ChangeDatasourceRemoteRefreshPropertiesAction","RemoteRefreshAgents","ChangeDatasourceRefreshModeAction","ChangeDatasourceRemoteAgentAction","CreateRemoteRefreshScheduleAction","AddNewAgentOption","openCreateRefreshScheduleOnSave","existingRefreshSchedulesCount","remoteRefreshModeOptions","remoteAgentOptions","remoteAgentOptionsEnabled","remoteRefreshDescription","localizedStatementKey","existingRefreshSchedules","warnRefreshesToBeDeleted","warnEmbeddedPassword","remoteAgentSelectClicked","refreshAvailableRemoteAgents","newRemoteAgent","oldRemoteAgent","LinkTargetAttributes","Blank","supressSuccessToast","AGENT_NAME","remoteAgentNames","CronExpressionDefaultValues","dayOfMonth","dayOfWeek","expression","CronExpressionFieldValues","CronExpressionFieldSubsetTypes","Specific","SpecificIncrement","Range","RangeIncrement","Invalid","RemoteRefreshScheduleEditorViewModel","hoursOfDay","defaultHoursOfDay","defaultDayOfWeek","editorModeIsDaily","defaultEditorModeIsDaily","getCronExpression","buildMinutesExpression","buildHoursExpression","buildDayOfWeekExpression","CronExpressionHelper","buildFromFields","setFromCronExpression","minutesField","getMinutesField","hoursField","getHoursField","dayOfWeekField","getDayOfWeekField","days","minutesParts","getTimeFieldSubsetParts","hoursParts","increment","from","to","specific","subset","getTypeFromFieldSubset","getFromPartFromSubset","getToPartFromSubset","range","dayNumber","getSpecificPartFromSubset","sunday","monday","tuesday","wednesday","thursday","friday","saturday","intervalIsValid","dayOfWeekNotEmpty","objThis","objThat","that","emptyDayOfWeek","minutesIncrement","hoursIncrement","indexOfStart","indexOfEnd","minuteIncrementOptions","fields","buildFromExpression","slash","substring","getIncrementPartFromSubset","getSecondsField","getDayOfMonthField","getMonthField","getYearField","setSecondsField","setMinutesField","setHoursField","setDayOfMonthField","setMonthField","setDayOfWeekField","setYearField","ServerResourceFetcher","requestType","resultMapper","CreateRemoteRefreshScheduleRequest","DeleteRemoteRefreshSchedulesRequest","GetRemoteRefreshSchedulesRequest","UpdateRemoteRefreshScheduleRequest","notifyOnFail","addDelay","sendRequestAndDelay","RemoteRefreshSchedules","initialSchedule","finalSchedule","initial","final","schedulesBlock","$filter","availableTypes","availableTypeOptions","startOnMonday","editorViewModel","scheduleInfo","REFRESH_TYPE_NAME","DeleteRemoteRefreshSchedulesAction","EditRemoteRefreshScheduleAction","initialViewModel","QueryService","refreshFn","QueryUpdater","createQueryUpdater","newLoc","oldLoc","refreshIfOrderOrFilterChanged","orderAndFilters","getCurrentOrderAndFilters","rememberOrderAndFilter","resourceQuery","createResourceQuery","didOrderOrFilterChanged","newOrder","SelectionService","rowClicked","colIndex","RemoteRefreshSchedulesCtrl","serverService","selectionService","sorterFactory","keyForSchedule","createActions","redirectByExtractsAndRefreshMode","refreshRemoteRefreshSchedules","refreshPropertiesAreEditable","currentRefreshLocation","headerClicked","header","waitForCountOfSchedules","changeRemoteRefreshProperties","countOfSchedules","LocallySortingScheduleInfoSliceable","remoteRefreshSchedule","SchedulingTaskNotFound","wrappedQuery","localSorter","listResult","CreateOrEditScheduleViewModelMapper","defaultSchedule","parallel","defaultScheduleFrequency","scheduleType","hourly","startTime","endTime","recurrenceMinutes","daily","weekly","recurrenceDaysOfWeek","monthly","recurrenceDayOfMonth","viewModelFromSchedule","viewModel","viewModelFromScheduleFrequency","scheduleDetails","createScheduleParamsFromViewModel","scheduleDetailsFromViewModel","updateScheduleParamsFromViewModel","scheduleFrequencyFromViewModel","CreateOrEditScheduleCtrl","scheduleActions","hourlyFrequencies","daysOfMonth","MINUTES","HOURS","DAY","ScheduleDialogMode","CreateScheduleAction","ScheduleErrors","createSchedule","showDialog","Create","editSchedule","Edit","scheduleViewModel","submitScheduleCreate","originalName","submitScheduleUpdate","SCHEDULE_NAME","originalScheduleName","DeleteSchedulesAction","deleteSchedules","scheduleCount","extractTaskCount","countExtractTasks","subscriptionScheduleCount","countSubscriptionSchedules","EXTRACT_COUNT","SCHEDULE_COUNT","SUBSCRIPTION_COUNT","taskCount","RenameScheduleAction","confirmRename","handleResult","renameInPlace","successMsg","NEW_ITEM_NAME","RunSchedulesAction","RunServerSchedulesAction","SchedulePermissions","canEditSchedule","canRunSchedule","SchedulesConfig","scheduleErrorItem","scheduleUrl","errorMessageForItem","siteUrlFor","serverUrlFor","SchedulingNameAlreadyExists","SchedulingNameTooLong","SetScheduleStatusAction","enableSchedule","enableSchedules","disableSchedule","disableSchedules","confirmEnableSchedules","confirmAction","EnableTranslationIds","confirmDisableSchedules","DisableTranslationIds","translationIds","ScheduleCtrl","canRunNow","isSubscription","beginEdit","cancelEdit","scheduleStatus","scheduleSet","runNow","ChangeExtractTaskPriorityAction","ExtractTasks","task","PARENT_NAME","numberDescription","MIN_PRIORITY","MAX_PRIORITY","isInteger","setPriority","ChangeScheduleAction","Subscriptions","descriptionTranslateKey","descriptionTranslateValues","filterList","displayField","getSchedule","setScheduleErrorMessageFor","forSubscriptions","TARGET_NAME","setSchedule","subscriptionErrorDetailFactory","subscriptionErrorMessageFor","SubscriptionNotFound","SUBSCRIPTION_SUBJECT","forExtractTasks","extractTaskErrorDetailFactory","namedItem","extractTaskErrorMessageFor","DeleteExtractTasksAction","executeWithContext","urlFor","DeleteExtractTasksRequest","GetExtractTasksRequest","RunExtractTasksRequest","SetExtractTasksPriorityRequest","SetExtractTasksScheduleRequest","RunExtractTasksAction","DeleteSubscriptionsRequest","GetSubscriptionsRequest","SetSubscriptionsScheduleRequest","SetSubscriptionSubjectRequest","changeSubject","TaskPlace","excludeFilterKeys","ExcludeFilterKeys","TasksCtrl","ExtractTasksCtrl","extractTasksContext","refreshExtractTasks","createExtractTaskFn","modifyExtractTasksPermission","extractTypeTranslationKey","showRefreshProperties","scheduleScope","ServerUrls","CreateGroupRequest","DeleteGroupsRequest","LocalGroupDomainName","GroupKeys","GetGroupsRequest","UpdateGroupNameRequest","UpdateGroupsMinimumSiteRoleRequest","Groups","groups","isActiveDirectory","createGroup","groupName","deleteGroups","updateGroupName","getGroupDetails","GetGroupDetailsRequest","updateGroupsMinimumSiteRole","optionsForCurrentUser","rolesToRemoveFromList","Mixed","SearchActiveDirectoryGroupNameRequest","SyncActiveDirectoryGroupRequest","SyncActiveDirectoryGroupsRequest","basicGroupInfoToAdGroup","ActiveDirectoryGroups","searchActiveDirectoryGroupName","searchInputText","syncAdGroup","groupDomainName","syncAdGroups","adGroups","SyncGroupEvent","groupSynced","ActiveDirectoryGroupAction","longRunningActionService","showSyncAdGroupDialog","GROUP_NAME","startProgressTrackingForResponse","delayResultForSolr","handleSyncCompleteFor","Mode","sync","handleSyncErrorResultFor","showSyncAdGroupsDialog","selectedGroups","GROUP_COUNT","responsePromise","showAddAdGroupDialog","errorStringArgs","DOMAIN_NAME","AdGroupNotFound","completeMessageStringArgs","successLines","NUM_ADDED","usersAddedToGroup","NUM_REMOVED","usersRemovedFromGroup","usersAddedToSite","usersSiteRoleUpdated","NUM_UPDATED","errorLines","usersWithInsufficientLicenses","usersSkipped","UpdateGroupsMinimumSiteRoleAction","confirmActionDialog","groupSet","handleSuccessResult","handleErrorResult","showUpdateGroupsMinimumSiteRoleDialog","groupsToSet","groupsOnlyAD","setSiteRole","setGroupsSiteRoles","SITE_ROLE","CheckboxState","checkboxState","checked","mixed","ImportExternalSiteUsersRequest","ImportThirdPartySiteUsersRequest","AddUsersToSiteRequest","usernames","CreateLocalUserRequest","DeleteUsersRequest","GetRemainingUserQuotaRequest","SiteUserAuthSetting","Default","GetSiteUsersRequest","ImportSiteUsersFromActiveDirectoryRequest","ImportServerUsersFromActiveDirectoryRequest","UpdateUsersAdminStatusRequest","UpdateUsersGroupMembershipRequest","UpdateUsersSiteRoleRequest","SiteUsers","getUserByUsernameAndDomain","removeFromGroups","userIds","userIdsBlock","groupIdsBlock","addToGroupIds","removeFromGroupIds","getUserCountsBySiteRole","baseQuery","filtersWithoutSiteRole","modifiedQuery","counts","addToGroups","updateUsersGroupMembership","addToGroupIdsBlock","removeFromGroupIdsBlock","createLocalUser","email","admin","createLocalUserRequest","addUsersToSite","usernamesBlock","deleteUsers","importUsersFromActiveDirectory","requestBuilder","importExternalUsers","emails","emailsBlock","emailAddresses","importThirdPartyUsers","updateUsersSiteRole","updateServerAdminStatusAndDelay","updateServerAdminStatusNoDelay","getRemainingUserQuota","usersRemaining","GetUsersGroupMembershipRequest","searchArray","searchFilterFn","listPromise","filteredSliceable","createFilteredSliceable","filteredList","newList","UserActionNotification","notifyErrors","errorsByUserId","groupBy","usersMappedByResults","getUsersByResultMap","successCode","usersForResult","resultCode","unique","msg","multiResultMessageFor","resultMessageFor","nameFor","nameForMsg","showErrorMsgFunc","ldapErrorMessage","UserAlreadyExists","UserNotSupportedGuestOperation","UserNotSupportedSelfOperation","UserInsufficientSiteQuota","USER_NAME","ADUserNotFound","UnexpectedErrorOccurred","LdapServerDown","LdapInvalidCredentials","resultSet","resultsForThisUser","resultCodesForThisUser","codes","resultToNotifyFor","isErrorResult","AddUserToSiteActionNotification","siteRoleEnum","errorMsg","translatedSiteRole","SystemUserNotFound","SiteRolesUpdateActionNotification","successfulName","getSuccessfulName","failingName","getFailingName","SUCCESS_COUNT","getUrlForUser","UserInsufficientLicenses","UserNotSupportedAdminOperation","SiteMembershipUpdateActionNotification","addedUser","addedToSiteCount","addedToSiteName","removedFromSiteCount","removedFromSiteName","messageArgs","ADD_COUNT","ADD_NAME","REMOVE_COUNT","REMOVE_NAME","USER_COUNT","ServerAdminUpdateActionNotification","newAdminState","translatedRole","GroupMembershipUpdateActionNotification","addedToGroupCount","addedToGroupName","removedFromGroupCount","removedFromGroupName","GroupNotFound","InvalidGroupMembershipUpdate","SiteUserNotFound","DISPLAY_NAME","successfulItem","getSuccessfulItem","failingItem","getFailingItem","matchingError","GroupMembershipEvent","MembershipChanged","GroupMembershipDialogFilters","AllGroups","AssignedGroups","SearchResults","GroupMembershipDialogCtrl","groupMembershipUpdateActionNotification","sliceableFactory","serverState","groupIdToGroup","clientChanges","needsAssignedGroupsRefresh","ListOrder","getColumnWidths","uncheckedAssignedGroups","groupFilter","lastGroupFilter","updateGroupFilters","searchInput","editGroupMembershipDescription","isDirty","applyCancelButtons","applyString","cancelString","disableApply","disableCancel","isBusy","isGroupDirty","checkboxClicked","isAllUsersGroup","clientState","isClientAndServerStateEqualFor","refreshAssignedGroups","getAssignedGroupsList","newFilter","getServerState","calcMemberCountWidth","groupFilters","groupsList","groupA","groupB","localeCompare","groupMembershipCounts","countBy","members","selectedUsersCount","memberCount","stringForGroupState","clientGroupState","isValidParamsForUpdate","EditGroupMembershipAction","showEditGroupMembershipDialog","RemoveUsersFromSiteAction","userActionNotification","showRemoveUsersFromSiteDialog","siteUsersToRemove","SetSiteUsersSiteRoleAction","serverAdminUpdateActionNotification","siteRolesUpdateActionNotification","siteRoles","siteUsers","showSetSiteUsersSiteRoleDialog","siteUsersToSet","setSiteUsersSiteRoles","selectedUsers","makeUsersServerAdmins","showToastForPromotedAdmins","showToastForDemotedAdmins","serverAdmins","demoteServerAdminsNoDelay","showToastForUpdatedUsersSiteRoles","UpdateUserAuthSettingsRequest","authSetting","UpdateUserAuthenticationAction","showUpdateUserAuthenticationDialog","siteUsersToUpdate","UpdateUserAuthenticationCtrl","defaultDisabled","samlDisabled","confirm","confirmDefault","confirmSAML","SiteUsersActions","siteUsersActionDefinition","editUsersGroupMembershipAction","setSiteUsersSiteRoleAction","updateUserAuthenticationAction","removeUsersFromSiteAction","getSiteUsersActionsButtons","refreshItems","canRemove","canEditAuthenticationSetting","canChangeRole","isSingleSelectAndGuest","areAllSelectedUsersServerAdmins","every","GroupUsersEvent","usersRemoved","usersAdded","GroupActions","AddUsersToGroupAction","CreateGroupDialogAction","DeleteGroupAction","RemoveUsersFromGroupAction","UpdateGroupNameAction","groupsActionDefinition","syncGroupsAction","updateGroupNameAction","setGroupSiteRoleAction","deleteGroupAction","groupUsersActionDefinition","removeUsersFromGroupAction","allUsersGroupUsersActionDefinition","getGroupsActionButtons","getGroupUsersActionButtons","showCreateGroupDialog","deleteGroup","showDeleteGroupDialog","addUsersToGroup","showAddUsersToGroupDialog","renameGroup","showUpdateGroupNameDialog","showRemoveUsersFromGroupDialog","isActiveDirectoryGroup","isDeletable","isRenamable","isSyncable","GroupDetailsCtrl","groupDetails","groupActions","updateGroupsMinimumSiteRoleAction","groupDetailsModel","isLocalGroup","allowMinimumSiteRole","isEditingMinimumSiteRole","editSiteRole","isSavingMinimumSiteRole","resetEditSiteRole","saveSiteRole","savingMinimumSiteRole","cancelSiteRole","GroupPlaceCtrl","groupsResource","refreshGroup","groupsBreadcrumbUrl","canRename","canSynchronize","synchronize","AddGroupsOptionsAction","showAddGroupsOptionsDialog","AddGroupsOptionsDialogCtrl","createGroupDialogAction","activeDirectoryGroupAction","addLocalGroup","importAdGroup","MenuButton","actionTarget","highlight","menuOpen","cachedData","fetching","Q","fetches","firstBlockToFetch","lastBlockToFetch","blockIndex","fetchBlock","newCachedData","GroupsPlaceCtrl","addGroupsOptionsAction","showMinimumSiteRole","itemsCount","queryUpdater","placeTitleClicked","getDomainString","isAD","dataGridColumns","groupNameColumn","groupNameCellFormatter","GroupUsersGrid","siteRoleFilter","disabledStyle","pointerEvents","GroupUsersSubplaceCtrl","AddFavoriteRequest","GetFavoritesRequest","RemoveFavoriteRequest","FavoriteObjectType","removeViewById","removeWorkbookById","AddTagsToViewsRequest","GetViewActionsRequest","GetViewByPathRequest","HideViewsRequest","RemoveTagsFromViewsRequest","getByPath","viewDetail","HomeCtrl","ItemsPerSection","recentViews","recentWorkbooks","updatedWorkbooks","recentViewsUrl","recentWorkbooksUrl","favoriteViewsUrl","favoriteWorkbooksUrl","updatedWorkbooksUrl","addViewFavorite","removeViewFavorite","addWorkbookFavorite","removeWorkbookFavorite","section","sectionElement","scrollRight","showScrollControls","canScrollLeft","canScrollRight","InitializationCtrl","confirmPassword","isLocal","passwordFieldsAreNonEmpty","maybeInitialize","initializationForm","$valid","GetLicensingInfoRequest","LicensesService","isCore","totalLicensedCores","coreLicensingInfos","info","numLicensedCores","totalCoreLicensesAvailable","totalCoreLicenses","totalSeatLicenses","seatLicensingInfo","numRemainingSeats","numLicensedUsers","LicensesCtrl","licensingInfo","productKeyInfos","formatExpirationDate","TrialRegExp","PermanentRegExp","ErrorMessageHandler","getSignInErrorMessages","isClientCertWithFallback","errorMessageKeys","UserOpenIdUserNotFound","UserOpenIdConflictingUserAccount","UserUnlicensedForSite","SiteLocked","SiteSuspended","ClientCertificateUserNotFoundInCertificate","ClientCertificateUserNotFoundOnServer","BadCredentials","UnlicensedServer","UserOpenIdIdpNotReachable","UserOpenIdBadConfig","OpenIdFailed","ExternalAuthService","getLoginUrl","SamlLoginUrl","OpenIdLoginUrl","externalRedirect","buildQueryParams","sendPodInfo","redirectKey","siteUrlNameKey","StartPageService","getStartPageForSite","startPageUrl","startPageState","getStartPageState","isStartPageInASite","getDefaultStartPageForSite","getCurrentUserStartPageForSite","getCurrentUserStartPageForCurrentSite","getCurrentUrlAsStartPage","SiteUrlNameCapturingRegex","savedStartPageUrl","getMatchingState","isDescendantOf","startState","LoginCtrl","externalAuthService","startPageService","errorMessageHandler","authenticatedRedirect","isSigninToSpecificSite","handleLoginErrorCode","autoLoginDidFail","maybeLogin","loginForm","$error","required","shouldDisplayWindowsCredentialsLink","isUsernameAndPasswordEnabled","initialized","windowsCredentialsDisplayName","LICENSE_EXPIRATION_DATE","allowAutoSignin","disableAutoSignin","GetSiteNamesRequest","SiteNameSansIds","GetSiteNamesAcrossAllPodsRequest","siteNames","stateWrapper","toState","previousServerUrl","previousSiteUrl","serverUrl","switchToSite","inServerState","switchIfNeeded","absolute","errorLocKey","getSwitchSiteErrorLocKey","UserNotMemberOfSiteOrSiteNotExist","LoginSitePickerCtrl","siteSwitchService","siteSearchValue","newValue","sliceableSiteNames","newSiteName","GetWorkbookVersionsRequest","DeleteWorkbookVersionsRequest","WorkbookRevisions","versions","PreviewWorkbookRevisionAction","openPreview","DeleteWorkbookRevisionAction","toasterService","showDialogForAction","RevisionActions","workbookRevisionsActionDefinition","previewWorkbookRevisionAction","deleteWorkbookRevisionAction","downloadWorkbookRevisionAction","getWorkbookRevisionActionButtons","log","RevisionHistoryDialogCtrl","revisionActions","deleted","revisionNameCellFormatter","revisionActionsCellFormatter","str","REVISION_NUMBER","SignInErrorCtrl","redirectPath","tryAgain","ScheduleGrid","scheduleTypeNameFilter","scheduleActionNameFilter","defaultChildState","SchedulesCtrl","refreshSchedules","isScheduleEnabled","WorkerProcessType","clusterController","gateway","vizportal","vizqlServer","cacheServer","searchServer","backgrounder","dataServer","dataEngine","wgServer","fileStore","repository","WorkerStatusType","active","activeSyncing","decommissionFailedReadOnly","decommissioningReadOnly","down","passive","readyForRemoval","statusNotAvailable","statusNotAvailableSyncing","unlicensed","GetWorkerProcessStatus","buttonActor","lastError","confirmActionDialogScope","setActor","button","isActor","progress","percent","initialFocus","modalOptions","actionPromise","bodyTemplateContent","RebuildSearchIndexRequest","RebuildSearchIndexService","lrActionService","rebuildSearchIndexPercent","rebuildSearchIndexPending","handleCurrentJob","getLastByType","LongRunningActionType","RebuildSearchIndex","handleRebuildSearchIndexStatus","getRebuildSearchIndexPercent","getRebuildSearchIndexPending","rebuildSearchIndex","existingRebuild","actionId","getRebuildSearchIndexStatus","trackRebuildSearchIndexProgress","cancelPoll","rebuildSearchIndexPoller","completeFn","failFn","notifyFn","Canceled","trackProgress","LongRunningActionState","Complete","GetServerInfoRequest","ServerInfoService","makeHosts","groupedByHosts","processes","workerHosts","hostName","ServerStatusCtrl","rebuildSearchIndexService","serverInfo","hosts","showZiplog","isSingleHost","components","getComponents","legendStatuses","isPreferred","component","ha2Enabled","refreshStatuses","refreshButtonBusy","refreshProcessStatusEvent","WorkerProcessTypes","ha2FilestoreEnabled","GetUserSettingsRequest","ServerUserPlaceCtrl","serverUser","userSettings","ServerUsersGrid","showDomainNameColumn","CreateLocalServerUserRequest","GetServerUsersRequest","GetUserRefreshTokenCountRequest","GetUserConnectedDevicesRequest","GetUsersSiteRolesRequest","DeleteUserConnectedDevicesRequest","UpdateServerUsersAdminStatusRequest","UpdateServerUsersSiteMembershipRequest","ServerUsers","getByUserIds","usersFilter","getUserCountsByMaxSiteRole","filtersWithoutMaxSiteRole","getUserSettings","getUserRefreshTokenCount","refreshTokenCount","getUserConnectedDevices","devices","deleteUserConnectedDevices","deviceIds","getSiteRoles","updateServerUsersSiteMembership","addToSiteRoles","removeFromSiteIds","addToSiteRolesBlock","removeFromSiteIdsBlock","updateServerAdminStatus","DeleteServerUsersRequest","createLocalServerUser","createLocalServerUserRequest","UsernameHelpers","splitUsernames","usernamesText","chain","trim","AddActiveDirectorySiteUsersDialogCtrl","availableQuota","addActiveDirectoryUsers","userTextInput","importUsers","isSiteRoleOptionDisabled","isQuotaEnabledForSite","usersToAdd","UserAddedEvent","SiteNameWithIds","SiteRolesPickerClientService","serverUsers","siteRoleChangesToParams","changes","change","updateServerAdmin","SiteMembershipDialogFilters","AllSites","AssignedSites","SiteRolesPickerCtrl","siteNamesResource","uncheckedAssignedSites","siteFilter","userCountsAndRolesBySiteId","needsAssignedSitesRefresh","adminCheckboxClicked","newState","adminCheckboxState","getAssignedSitesList","updateAdminState","refreshAssignedSites","originalAdminState","checkboxStateWithoutAdmin","siteInfo","numSelectedSiteMembers","numSelectedUsers","selectCtrl","roleSelectColumnIndex","modifySiteRolesDisabled","siteRoleChange","getOriginalCheckboxStateForSite","updateModel","updateSiteFilters","lastSiteFilter","isRowDirty","adminStateFromUsers","totalUsersCount","resizeableColumnIndex","siteFilters","assignedList","usersWithSiteRoles","updateSelectedUserCounts","calculateUserCountsAndRolesBySite","userRoles","numSelectedServerAdmins","userRole","siteUserInfo","AddActiveDirectoryServerUsersDialogCtrl","siteMembershipUpdateActionNotification","rolesPickerClient","siteRoleChanges","setRoles","updateSiteMembership","AddActiveDirectoryUsersAction","showAddActiveDirectoryUsersToSiteDialog","showAddActiveDirectoryUsersToServerDialog","EmailValidationHelper","EMAIL_REGEXP","isValidEmail","getInvalidEmails","splitEmails","emailText","AddExternalUsersAction","Toaster","showAddExternalUsersToSiteDialog","addUserScope","invalidEmails","thirdPartyUsers","siteRoleSelect","handleImportResult","showAuthenticationSelector","quota","userQuotaMessage","NUM_USERS","newUsers","require","click","elm","ctrl","hasClass","$setViewValue","$viewValue","$render","SiteRolesEvent","SiteRolesChanged","SiteMembershipDialogCtrl","editSiteMembershipDescription","haveSelectedUsers","getSiteRolesForSelectedUsers","getServerAdminCount","serverAdminChanged","siteRolesChanged","getServerAdmins","filteredServerUsers","usersList","SetOfUsers","usernameSelector","CheckUserNamesRequest","Users","checkUserNames","AdminsOnlyFilter","WithoutGuestFilter","AddLocalUserFormState","Initial","NewUser","OtherSite","NotAvailable","AddLocalUserDialogCtrl","addUserToSiteActionNotification","isServerMode","isSiteMode","formModel","formState","errorText","newUserFlowModel","usernameInfo","otherSiteFlowModel","warningText","proceedClicked","notAvailableFlowModel","proceed","getOtherSiteFlowModel","isConfirmDisabled","checkDoesUsernameExists","existsOnSite","setupFormForNotAvailable","existsOnServer","setupFormForAddUserToSite","setupFormForAvailable","errorStringId","getNotAvailableFlowModel","getNewUserFlowModel","getFormState","createLocalSiteUser","addUserToSite","addLocalUserForm","$invalid","siteRoleToGiveNewUser","makeServerAdmin","showNotificationForCreateUser","reenableButtons","onServerUserCreateSuccess","authUserId","userDisplayName","updateSiteRole","userSet","selectedSiteRole","promoteToServerAdmin","showNotificationForAddUserToSite","promoteAdminPromise","promoteAdminResult","isNewUserFlow","isOtherSiteFlow","AddLocalUserAction","showAddLocalUserDialogForSite","showAddLocalUserDialogForServer","AddUsersOptionsAction","showAddSiteUsersOptionsDialog","createDialogInstance","AddSiteUsersOptionsDialogCtrl","showAddServerUsersOptionsDialog","AddServerUsersOptionsDialogCtrl","addLocalUserAction","addActiveDirectoryUsersAction","addExternalUsersAction","bulkImportUsersAction","addLocalUser","importAdUser","importExternalUser","importFromBulk","showBulkImportSiteUsersDialog","showBulkImportServerUsersDialog","EditSiteMembershipAction","showEditSiteMembershipDialog","ServerUsersActions","DeleteUsersFromServerAction","serverUsersActionDefinition","editSiteMembershipAction","deleteUsersFromServerAction","getServerUsersActionsButtons","canEditSiteMembership","canDelete","showDeleteUsersFromServerDialog","ServerUsersPlaceCtrl","addUsersOptionsAction","serverUsersActions","maxSiteRoleFilterDefinition","updateMaxSiteRoleCounts","ServerSettings","GetServerSettingsRequest","updateBoolean","setting","UpdateBooleanServerSettingRequest","updateString","UpdateStringServerSettingRequest","updateScheduleFrequency","UpdateScheduleFrequencyServerSettingRequest","ClearConnectedDevicesRequest","ClearConnectedDevicesAction","showConfirmationDialog","userRefreshTokenCount","TOKEN_COUNT","ClearConnectedDevicesParams","ChangeUserPasswordRequest","UpdateUserEmailRequest","UpdateUserDisplayNameRequest","UpdateUserLanguageRequest","UpdateUserLocaleRequest","UpdateUserStartPageRequest","UserSettings","updateUserDisplayName","updateUserEmail","updateUserEmailAndDelay","updateUserLanguage","updateUserLocale","updateUserStartPage","SameUserId","updateCurrentUsersStartPage","resetUserStartPage","ResetStartPage","changeUserPassword","oldPassword","oldEncryptedPassword","newEncryptedPassword","changePasswordRequest","UserSettingsActions","updateStartPage","userInfo","fetchUserSettings","confirmChangeUserStartPage","confirmChangeDefaultStartPage","fetchCurrentUsersUserSettings","resetStartPage","FetchUserSettingsActionType","UserSettingsStore","handleAction","maybeRefreshSessionInfo","ChangeEvent","UserSettingsCtrlCommon","clearConnectedDevicesAction","userSettingsStore","initScope","isViewerSelf","siteUser","setupUserSettingsChangeListener","isDomainFamilyAD","isDomainFamilyExternal","isDomainFamilyLocal","isViewerServerAdmin","controls","editDisplayNameControls","editEmailControls","disableNameAndEmailSaveButton","displayCtrl","emailCtrl","saveChangesToEmailAndDisplayName","userNameIsSameAsEmail","displayPromise","submit","emailPromise","serverDefaultStartPage","defaultStartPage","currentSiteUrlName","startPageText","startPageHref","clearConnectedDevices","updateUserSettingsOnScope","isSameUser","userSettingsChange","onUserSettingsChanged","changeEvent","ServerUserSettingsSubplaceCtrl","userSettingsCtrlCommon","setBrowserTitleCtrl","SignedOutCtrl","tryAgainLink","Self","Parent","Top","buildInterpolationValuesFn","prop","linkifyFn","localizedStatement","localizedValue","GetSiteSAMLConfigurationRequest","SetSiteSAMLEnabledRequest","RemoveIdentityProviderRequest","SetSiteAttributeMappingRequest","mapping","UpdateSiteSettingsForSiteAdminRequest","SiteAuthenticationCtrl","configuration","setEnabled","isIdentityProviderConfigured","identityProviderEntityId","evt","downloadLogUrl","downloadLogEndpoint","openAddExternalUsersDialog","testLogin","testLoginUrl","entityIdFormUrl","returnUrl","removeIdentityProvider","setSiteAttributeMapping","siteSAMLAttributeMapping","endpoint","handleFormSubmitResult","InsecureSAMLEndpoint","xsrfToken","customerSupportLink","contactCustomerSupport","SitesPlaceCtrl","SiteUsersPlaceCtrl","siteUsersActions","angularContextFactory","multisite","thirdPartyAuthEditable","updateSiteRoleCounts","LastSignInCell","SubscriptionGrid","showUserNameColumn","showHasSubscriptionColumn","showWorkbookViewColumn","DeleteSubscriptionsAction","deleteSubscriptions","SUBSCRIPTION_NAME","ChangeSubscriptionSubjectAction","SUBJECT","SubscriptionsCtrl","changeScheduleAction","refreshSubscriptions","isCreatorOrAdminOnly","sitesUrl","HeaderStyles","bluePalette","LetterSpacing","MenuPanelStyle","borderWidth","borderColor","borderStyle","AlertsCountFontSize","HeaderDividerImage","SiteSwitcherDropdownRestImage","SiteSwitcherDropdownHoverImage","HeaderBackgroundColor","HeaderLinkSelectedColor","HeaderLinkSelectedBackgroundColor","HeaderLinkHoverBackgroundColor","SiteSwitcherRestColor","SiteSwitcherHoverColor","HoverOpacity","RestOpacity","SiteSwitcherHoverOpacity","SiteSwitcherRestOpacity","HeaderLink","opacity","linkStyle","letterSpacing","Navigation","navLinks","isServerLocation","currentLocation","serverLinks","siteLinks","linksWrapper","background","hideRightDivider","containerStyle","Location","SiteHome","SiteContent","SiteGroups","SiteSchedules","SiteTasks","SiteStatus","SiteSettings","ServerSites","ServerSchedules","ServerTasks","ServerStatus","linkPadding","AlertTarget","GetAlertRequest","GetUserAlertListRequest","Alerts","GetUserAlertCountRequest","getList","getForDatasource","getForType","getForWorkbook","GetGettingStartedNotificationsRequest","SetSuppressGettingStartedNotification","GettingStartedNotifications","$sce","notificationsShown","notificationsEnabled","enableNotifications","forceShowNotifications","showNotifications","checkUserPrefs","showNotificationsIfEnabled","shouldShowGettingStartedLink","fetchNotificationsUrl","eventNamespace","$id","getHostName","__displayName","notificationsUrl","trustAsResourceUrl","showNotificationsOnLogIn","bodyTemplate","originalEvt","originalEvent","originHost","origin","CloseModalMessage","updateUserPreference","urlParsingNode","setAttribute","hostname","contentUrl","suppressGettingStartedNotifications","LogoService","siteCustomization","resetSiteLogoToDefault","uploadSiteLogo","isUsingCustomSiteLogo","useCustomLogo","getTopBarLogo","getSiteCustomLogo","getServerTopBarLogo","getServerCustomLogo","image","DefaultTopBarLogoImage","DefaultTopBarLogoWidth","DefaultTopBarLogoHeight","getStartPageHref","getSignInLogo","DefaultSignInLogoImage","DefaultSignInLogoWidth","DefaultSignInLogoHeight","customLogoPath","customLogoWidth","MaximumLogoWidth","customLogoHeight","MaximumLogoHeight","customLogoLink","TopBarEvents","HeightChanged","TopBarCtrl","userSettingsActions","gettingStartedNotifications","logoService","logo","inServerArea","showServerSiteButtons","showSiteSwitcher","showSiteControls","showNav","updateHeight","newHeight","logoHeight","MinTopBarHeight","VerticalPadding","NavHeight","siteSelected","toggleCollapsed","configureReactTopBar","topBarProps","siteStore","SiteStore","favoritesStore","FavoritesStore","alertsStore","AlertsStore","alertActions","AlertActions","userActions","UserActions","navLocation","topBarLocationFromState","helpActions","HelpActions","isOfflineHelpEnabled","serverHelpLabel","serverHelpUrl","supportUrl","showGettingStartedLink","currentSite","shouldShowLink","updateSite","matchingStateName","stateNameToNavigationLocationMap","stateName","main.error","main.site.content","main.site.home","main.site.group","main.site.groups","main.site.schedule","main.site.schedules","main.site.settings","main.site.status","main.site.tasks","main.site.user","main.site.users","main.site.viz","main.server.analysis","main.server.schedule","main.server.schedules","main.server.settings","main.server.sites","main.server.status","main.server.tasks","main.server.user","main.server.users","hasMaxCssValue","maxCssValue","hasMinCssValue","minCssValue","onVizSized","vizCreateOptions","toolbarPosition","tableau","ToolbarPosition","TOP","instanceIdToClone","onFirstVizSizeKnown","vizSize","getVizSize","sheetSize","minSize","chromeHeight","maxSize","onFirstInteractive","Viz","refreshSize","dispose","urlChangeEvents","TableauEventName","CUSTOM_VIEW_LOAD","CUSTOM_VIEW_SAVE","TAB_SWITCH","eventName","getCurrentUrlAsync","isExplicitOriginalViz","UpdateCommentRequest","DeleteCommentRequest","CreateCommentRequest","Comments","commentFetcher","createComment","getSliceableCommentsForViz","editComment","commentId","commentText","deleteComment","DeleteCommentActions","commentToDelete","showDeleteCommentDialog","VizViewerCtrl","deleteCommentActions","getByPathError","vizErrorState","vizInitialized","vizProps","commentsAndTagsInitialized","workbookBreadcrumbUrl","hasError","viewInfo","loadNewViewInfo","newInstanceId","increaseCommentList","loadNewCommentInfo","COMMENT_PAGE_SIZE","deletingCommentId","newText","canCurrentUserModifyComment","isCurrentUserId","shouldShowWhoHasSeenThisView","numberOfAdditionalCommentToRequest","canSetTags","SettingsCoordinatorCtrl","forms","savePromises","form","onSavePromises","onSave","resetSettings","showResetSettingsBtn","registerFormState","transclude","ConfigHelper","addExtractTasksState","$stateProvider","resolveExtractTasksContext","defaultResolveExtractTasksContext","addSubscriptionsState","addTaskSubstates","CreateSiteRequest","DeleteSitesRequest","GetSitesRequest","UpdateSiteAvailabilityRequest","UpdateSiteSettingsForServerAdminRequest","GetActionInfoRequest","LongRunningActionService","pollService","StringToStateDict","queued","Queued","inProgress","InProgress","completed","StringToTypeDict","DeleteSites","TypeToStringDict","stringType","toLongRunningAction","isComplete","actionInfoPoller","poll","lrActionPromise","ResourceNotFound","lrActionPoller","startProgressTrackingForResult","getPoller","poller","longRunningAction","getLongRunningActionResult","typedAction","actionInfo","errorNotifyingServer","getSiteSettingsForServerAdminById","GetDetailRequest","getSiteSettingsForSiteAdminById","getCurrentSiteSettingsForSiteAdmin","updateSiteAvailability","updateSiteSettingsForServerAdmin","updateSiteSettingsForSiteAdmin","SiteNameIsEmptyOrNull","SiteAdminCannotAddUsersButUserQuotaIsSet","InvalidUserQuotaOrStorageQuota","UserQuotaGreaterThanServerLicenseLimit","InvalidCustomEmailAddress","SiteNameOrUrlNameAlreadyExists","SiteSubscriptionsSetWithDisabledServerSubscriptions","AttemptedToUpdateDefaultSiteUrlName","SiteNameTooLong","SiteUrlNameTooLong","StorageQuotaLessThanStorageUsed","STORAGE_USED","SitesPlace","GetMastheadNotificationsRequest","MastheadNotifications","src","frameborder","scrolling","GetPostLoginNotificationsRequest","PostLoginNotifications","SiteUrlMatcher","matcher","searchParams","parameters","format","SiteUrlMatcherFactory","$urlMatcherFactory","compile","$get","provider","GetDataConnectionAuthInfoRequest","GetLastActiveDirectoryGroupsSyncTimeRequest","$httpProvider","$sceProvider","$urlRouterProvider","siteUrlMatcherFactory","ApiPrefix","decorator","self","$$state","interceptors","apiRequestRegex","RegExp","isGet","isInline","isApi","isHtml","separator","documentMode","siteUrlRedirect","$match","otherwise","processAndRemoveSamlQueryParam","abstract","onEnter","displaySettings","oldValue","rebuildSearchIndexCurrentJob","lastActiveDirectoryGroupsSyncTime","licenses","contentSubplaceResolve","userDoesNotExist","usersErrorState","groupDoesNotExist","serverStateProperties","siteStateProperties","scheduleStates","extraStateProperties","scheduleListState","scheduleState","taskState","allowTransition","DatasourceDataConnectionCtrl","isEditing","isOAuth","canEditConnection","dataConnectionIsReading","dataConnectionIsEditing","requestRefreshNowIsDisabled","currentRefreshModeIsRemote","editOAuth","isSaving","savePromise","oauthInitialEditModel","requestTestConnectionIsDisabled","currentUserAllowedToEdit","hasRemoteRefreshProperties","SiteUserPlaceCtrl","hasUserSettings","AssociateOAuthCredentialRequest","DeleteOAuthCredentialsRequest","DisassociateOAuthCredentialRequest","GetCommonUserOAuthCredentialRequest","OAuthCredentialTypes","Salesforce","BigQuery","GoogleAnalytics","GetOAuthCredentialAssociatedWithResourceRequest","GetOAuthCredentialsRequest","TestOAuthCredentialRequest","associateWithDatasource","resourceId","disassociateFromDatasource","credentialForDatasource","datasourceIds","deferred","handleResponse","jqEvent","source","openWindow","removeOpenWindow","errorCodeMatch","notifyError","newCredentialIdMatch","getPopupSpecs","popupOptions","toolbar","screenLeft","screenX","innerWidth","screenTop","screenY","innerHeight","OAuthPath","data_class","cancelPendingAuthAttempt","WindowName","GetRemoteRefreshAgentsRequest","DeleteRemoteRefreshAgentsRequest","withContent","getWithContent","agentNames","agentNamesBlock","DeleteRemoteRefreshAgentsAction","DeleteMySavedPasswordsAndCredentialsRequest","DeleteMyCredentialsAction","DeleteOAuthCredentialsAction","oauthCredentials","USERNAME","TRANSLATED_TYPE","CREDENTIAL_COUNT","DeleteConnectedDeviceAction","device","SiteUserSettingsSubplaceCtrl","oAuthCredentials","addOAuthCredentialAction","deleteOAuthCredentialsAction","deleteMyCredentialsAction","deleteRemoteRefreshAgentsAction","deleteConnectedDeviceAction","canManageCredentials","isSAMLUser","remoteAgentManagerEnabled","refreshAgents","deleteRemoteRefreshAgent","oneByOneConnectedDeviceManagement","refreshConnectedDevices","connectedDevices","deleteConnectedDevice","credentialsLists","createOAuthCredentialLists","deleteAllCredentials","addCredentialHref","addCredential","deleteCredential","oauthCredential","testCredential","oauthEnabledForCredentialType","convertToCredentialViewModel","credentialVMGroupsMap","OAuthListOrder","oauthCredentialsList","addEnabled","DatasourcePlace","AddTagsToDatasourcesRequest","DeleteDatasourcesRequest","GetDatasourceActionsRequest","MoveDatasourcesToProjectRequest","RemoveTagsFromDatasourcesRequest","RunExtractRefreshesOnDatasourcesRequest","SetDatasourceDescriptionRequest","SetDatasourceRefreshModeRequest","SetDatasourceRemoteAgentRequest","SetDatasourcesOwnerRequest","published","setRefreshMode","setRemoteAgent","ProjectPlace","SiteUserPlace","CreateProjectRequest","DeleteProjectsRequest","GetProjectActionsRequest","SetProjectNameRequest","SetProjectControlledPermissionsRequest","SetContentControlledPermissionsRequest","SetProjectDescriptionRequest","SetProjectsOwnerRequest","setProjectControlledPermissions","setContentControlledPermissions","SitePlace","WorkbookPlace","DataSourceExcludeFilterKeys","itemDetailsStateNames","itemSubplaceStateNames","subplaceName","subplaceStateName","subplaceState","customResolve","ResourceNames","rootSiteUrlRedirect","noSiteInUrl","errorState","$provide","$delegate","decoratedThen","decoratePromise","originalThen","decoratedCatch","originalCatch","decoratedFinally","originalFinally","decoratedWhen","originalWhen","decoratedReject","originalReject","decoratedAll","originalAll","decoratedDefer","originalDefer","inherit","ImagePreloadService","preloadDynamicIconImages","DynamicIconImages","Image","StateWrapperService","internalState","getStateParams","getSiteUrlNameIfLoginState","descendant","ancestorName","$document","$urlRouter","redirectToLogin","shouldRedirectToLogin","isNextStateAnonymous","shouldAutoLogin","shouldRedirectToEmbeddedViz","shouldRedirectToGuestViz","shouldRedirectToVizExport","maybeVizRedirect","shouldRedirectToSitePicker","isSuccessfulSamlLogin","isRootUrl","initializeSessionPing","throttle","trailing","fiveMinutesInMilliseconds","halfSessionIdleLimitInMilliseconds","sessionPingPeriodWhileUserIsInteracting","listenForInteractionAfterSessionPingPeriod","one","showClient","show","overrideAuthenticationTypeBasedOnUrl","toUpperCase","bootstrapCheckInitialAdmin","UntrustedMachine","ReadyToInitialize","bootstrapCheckAutoLogin","bootstrapCheckRedirects","removeImagePreloadListener","toStateParams","fromState","fromStateParams","AddActiveDirectoryGroupDialogCtrl","activeDirectoryGroups","groupSearchValue","isSearchStringEmpty","debouncedUpdate","debounce","onSearchTextChanged","newSearchText","resetSelection","hasResults","statusMessage","disabledItems","groupsToImport","onRowClicked","isRowSelected","locals","prepareSearchTextInput","hasMoreItems","exactSearchTermRegexp","wildSearchTermRegexp","AddUsersToGroupDialogCtrl","isGroupMembershipPrecomputed","userSearchValue","usersToBeAdded","tryPrecomputeGroupMembership","usersSliceChanged","onUsersSliceChanged","addUsersToGroupDescription","confirmLabel","ADD_USER_COUNT","onConfirmAdd","res","countResult","usersByIdMap","member","PollService","customPollPeriod","pollFulfilledFn","pollPeriod","PollPeriodMultiplier","MaxPollPeriodMS","timeoutPromise","pollRejectedFn","InitialPollPeriodMS","AlertMenuCtrl","totalAlerts","pollFunction","POLL_DURATION","getAlertList","showRemainingAlerts","ITEM","workbooksAffectedString","workbookList","LIST_COUNT","tryAgainClick","getFailureType","translated","AlertSignInFailed","AlertRemoteSignInFailed","AlertExpiredPassword","AlertRemoteExpiredPassword","AlertAccessTokenValidation","AlertAuthConfiguration","AlertConnectionFailure","AlertRemoteConnectionFailure","AlertOverlappingSchedules","AlertFullRefreshRequired","AlertConnectionlessFailure","editableFailure","isRemoteRefresh","REMOTE_REFRESH_STATUS_CODES","hasSuspended","AlertRemoteUnknownFailure","uploadCsvAction","importFile","validateFile","formControls","requestInProgress","authenticationSelector","visible","selectionValue","canSubmitForm","bulkImportForm","submitFormForAction","progressTracker","importComplete","importFailed","notifyProgress","BulkImportUsersDialogState","BulkImportUsersDialogCtrl","currentState","SelectFile","dialogState","ImportInProgress","closeButtonText","ImportComplete","csvHelpHref","importResults","Method","ImportUsersFromCsv","ImportServerUsersFromCsv","ContentGridCtrl","removePopover","scrollElement","popoverStackedElement","popover","popoverScope","displayPopoverTimeout","removePopoverTimeout","DisplayPopoverDelay","RemovePopoverDelay","PreferOpenLeft","buildPopoverStackedElement","popoverWidth","windowWidth","elementWidth","elementOffset","openLeftLeft","openRightLeft","openRightRight","openLeft","arrow","popoverArrow","removeClass","ContentItemPopoverCtrl","visibleWatch","itemDetails","sparklineWithTitleProps","caption","sparklineProps","dataPoints","DataGridCtrl","$element","scrollLeftChanged","margin-left","DateFilterCtrl","ErrorDetailsToastCtrl","ProjectNames","UserNames","Tags","DataConnectionTypes","SiteNamesAcrossAllPods","getByDataConnectionType","dataConnectionTypes","searchPart","scheduleResourceQuery","scheduleListPromise","schedulesList","FavoritesMenuCtrl","searchSuggestions","filteringList","chosenFavorite","getFavorites","goToFavorite","handleGoToDeletedFavorite","FocusCtrl","setFocusElement","hasFocusElement","showAbout","aboutScope","showGettingStarted","searchHelp","searchTerm","HelpMenuCtrl","launchGettingStarted","searchForm","helpLocKey","showLink","ScrollCtrl","$transclude","viewport","currentPage","currentItemsPerPage","currentTotal","scroller","transcludeFn","scrollControls","scrollIntoView","itemIndex","firstVisibleIndex","lastVisibleIndex","numberOfVisibleItems","setScrollLeft","getScrollLeft","currentScrollLeft","updateScrollLeft","newScrollLeft","fetchItems","newItems","oldItems","onItemsChanged","getViewportDimensions","resize","pageHeight","pageHeightInPx","itemsPerPage","isInProgress","updateLayoutMetrics","ItemsChangeEvent","getLayoutMetrics","contentAreaHeight","totalNumberOfRows","contentTop","mostRecentInProgressRequest","contentArea","layout","Permission","PermissionReason","PermissionsMerger","makeGranteePermissionsList","agps","authorizableIds","groupDict","userDict","agpListByGrantee","agp","grantee","permissionsList","granteeAgpList","createGranteePermissions","allUsersGroup","allUsersGroupGP","gp","permissionsByContentType","granteePermissions","mergePermissionListByContentType","mergePermissionList","agpList","agpByAuthorizable","authorizable","authorizableId","inputPermissions","permissionsFromCapabilityValues","mergePermissions","mergePermissionsWithUnspecified","agpsByContentType","aggregatePermissionsForAuthorizables","agpsForAuthorizable","aggregatedPermissions","capabilityValues","capabilityValue","capability","permission","permissionFromCapabilityValue","reasonFromCapabilityValue","Allowed","Denied","Unspecified","capabilityReason","GroupAllow","GroupDeny","GroupProjectLeaderAllow","GuestAllow","ImplicitDeny","UserAdminAllow","UserAllow","UserAuthorizableOwnerAllow","UserDeny","UserLicensingDeny","UserProjectLeaderAllow","UserProjectOwnerAllow","curr","inpt","GetEffectivePermissionsRequest","EffectivePermissionsService","usersFetcher","getEffectivePermissions","usersParams","PermissionsHelper","effectivePermissionsRequestsForAuthorizables","combineResultsFn","EffectivePermissionsFetcher","effectivePermissionsService","setAuthorizables","SingleSectionAccordion","currentOpenSection","toggleSection","isSectionOpen","StaticAccordion","LockUnlockProjectPermissionsState","LockStatusHelper","getCombinedStatusOfAllItems","projectStates","mixedProjectLockedState","getLockStatusOfAllProjects","proj","Locked","Unlocked","getWhiteLockIconClass","lockState","whiteLockIconClasses","getGrayLockIconClass","grayLockIconClasses","getSectionHeaderText","sectionHeaderText","getLockButtonText","lockButtonText","getLockState","PermissionsEditabilityLogicBase","sourceAuthorizables","editable","allAuthorizablesMatchSource","getEditabilityWithMessages","getMessages","getPrompt","shortMessage","longMessage","allAuthorizablesLocked","getPromptId","ProjectPermissionsEditabilityLogic","WorkbookPermissionsEditabilityLogic","stringIds","messageIdsForEditable","messageIdsForReadOnly","SOURCE_NAME","allTheSame","singleWorkbook","DatasourcePermissionsEditabilityLogic","ViewPermissionsEditabilityLogic","numSourcedFromProject","next","messageIdsForLockedViews","messageIdsForUnlockedViews","sourceWorkbooks","SOURCE_COUNT","PermissionsEditabilityLogicFactory","logicForAuthorizables","impl","ImplForContentType","PermissionsHasher","capabilities","Capabilities","read","write","deleteItem","changePermissions","addComment","viewComments","exportData","vud","exportImage","shareView","webAuthoring","exportXml","changeHierarchy","connect","ProjectCapabilitiesDeprecated","ProjectCapabilities","WorkbookCapabilities","DatasourceCapabilities","ViewCapabilities","CapabilitiesByContentType","projectWorkbookTemplate","projectDatasourceTemplate","CapabilitiesByContentTypeDeprecated","Role","PermissionRoleDefinitions","projectRoles","ProjectViewerAllowedCapabilities","ProjectViewer","ProjectInteractorAllowedCapabilities","ProjectInteractor","ProjectEditorAllowedCapabilities","ProjectEditor","DataSourceConnectorAllowedCapabilities","DataSourceConnector","DataSourceEditorAllowedCapabilities","DataSourceEditor","ProjectPublisherAllowedCapabilities","ProjectPublisher","ProjectLeaderAllowedCapabilities","ProjectLeader","datasourceRoles","workbookRoles","WorkbookViewerAllowedCapabilities","WorkbookViewer","WorkbookInteractorAllowedCapabilities","WorkbookInteractor","WorkbookEditorAllowedCapabilities","WorkbookEditor","viewRoles","ViewViewerAllowedCapabilities","ViewViewer","ViewInteractorAllowedCapabilities","ViewInteractor","ViewEditorAllowedCapabilities","ViewEditor","explicitRolesByContentType","PermissionTemplateRoleDefinitions","PermissionRoles","capabilitiesByContentType","permissionsAndRolesByType","allCapabilities","permissionsHasher","addRoleForContentType","unspecifiedRole","deniedRole","addExplicitRole","addEffectiveRole","getExplicitRoleForTypeAndPermissions","getRoleForPermissions","getExplicitRolesForType","getEffectiveRoleForTypeAndPermissions","getEffectiveRolesForType","getPermissionsForTypeAndRole","getPermissionsByRoleForType","getAvailableRolesForType","getPermissionsAndRolesForType","permissionsAndRoles","permissionsByRole","explicitRolesByPermissionsHash","effectiveRolesByPermissionsHash","setRoleForPermissions","explicitPermissions","effectivePermissions","permissionRoles","rolesByContentType","granteeType","hasSameGrantee","compareGrantees","compareStrings","permissionFromIGranteePermission","igp","permissionsFromIGranteePermission","defaultValue","capabilityTitleKey","pluckPermissionsFromDictionary","explicitGranteeRole","permissionValues","effectiveGranteeRole","IPermissionsFromPermissions","permissionsWithUnspecifiedReasons","PermissionsFromIPermissions","ipermissions","getPermissionsContentTypes","contentTypesForAuthorizableType","explicitPermissionsRequestsForAuthorizables","buildRequestFn","GetExplicitPermissionsRequest","setExplicitPermissionsRequestsForAuthorizables","getGrantee","capabilityValuesFromPermissions","SetExplicitPermissionsRequest","capabilityValueFromPermission","PermissionsPanelResizer","permissionsPanel","yPos","topPanel","bottomPanel","startY","startTopHeight","explicitPermissionsBody","divider","explicitPermissionsBodyHeight","startBottomHeight","dividerHeight","minTopHeight","maxTopHeight","dy","newTopHeight","PagedList","fetchParams","ExplicitPermissions","forAuthorizables","sourceAuthorizableById","sourceAuthorizablesById","setForAuthorizables","agpsBlock","GranteePermissionsFactory","createForUserWithUnspecifiedPermissions","addUnspecifiedPermissions","createForGroupWithUnspecifiedPermissions","contentTypes","pct","PermissionsPanelActions","actionDefinition","editPermissionRuleAction","deletePermissionRuleAction","getActionButtons","rule","showPermissionRuleEditor","PermissionRuleEditorCommands","permissionRuleEditorParams","PermissionsTemplateUrl","forTemplateType","PermissionsPanelCtrl","permissionsPanelActions","permissionsEditabilityLogicFactory","granteePermissionsFactory","hoveredCapabilityValue","updateCurrentAuthorizables","effectivePermissionsFetcher","currentAuthorizables","currentExplicitPermission","hoveredEffectivePermission","hoveredExplicitPermission","isLoadingEffectivePermissions","permissionsPanelResizer","permissionsTemplateUrl","editability","xPos","userStatusForRow","explicitPermissionsPanelControls","effectivePermissionsPanelControls","toggleCurrentExplicitPermission","explicitPermission","setCurrentExplicitPermission","haveCurrentExplicitPermission","isCurrentExplicitPermission","isHoveredExplicitPermission","isHoveredEffectivePermission","effectivePermission","showEditButtonForRow","showDeleteButtonForRow","isRelevantExplicitPermission","isNotRelevantExplicitPermission","relevantCapabilityClass","capabilityName","isRelevantHeader","setHoveredCapabilityValue","capabilityCell","$digest","clearHoveredCapabilityValue","isCurrentEffectivePermission","hasCurrentEffectivePermission","effectiveRowHovered","explicitRowHovered","effectivePermissionsSliceChanged","updateGroupMembership","deletePermissionRule","editPermissionRule","hideRowMenu","hidePermissionRuleEditor","explicitPermissionsList","updateEffectivePermissions","updateExplicitPermissions","addUserOrGroupSelector","isShown","addNewUserPermission","addNewGranteePermissions","addNewGroupPermission","haveCurrentAuthorizable","getTooltipText","getHeaderTooltipText","headerTextAccordion","sectionGroupAccordion","shortHeaderText","permissionsLockStatusProps","newGranteePermissions","getGranteeIndex","startEditingRule","stopListening","sortedIndex","editabilityLogic","updateExplicitPermissionsSlice","setMissingCapabilitiesToUnspecified","setMissingCapabilitiesForSectionsToUnspecified","permissionsForContentType","effectivePermissionsFetchParams","groupMembership","userGroups","currentUser","currEffectivePermission","currExplicitPermission","maxReason","PermissionEditorTemplateUrl","forAuthorizableType","PermissionRuleEditorCtrl","updateColumnWidths","permissionsEditorTemplates","initializeFromSelectedRow","deepCopy","selectedRow","selectedRoleByContentType","savePermissionRule","newPermissions","newPermissionsByContentType","cloneAllPermissionsToUnspecified","updateAuthorizables","GRANTEE_NAME","saveDisabled","isDeleteActionSelected","getCapabilitiesForRole","getCapabilitiesForTypeAndRole","permissionsPanelColumnWidths","jQuery","Languages","getAll","GetLanguagesRequest","languages","unspecifiedLanguage","Locales","GetLocalesRequest","locales","unspecifiedLocale","ClearSavedPasswordsRequest","GetTotalRefreshTokenCountRequest","ResetServerSettingsRequest","RunActiveDirectoryGroupsSyncRequest","UpdateBooleanServerSettingNames","embeddedCredentialsEnabled","schedulingEnabled","savedPasswordsEnabled","savedAccessTokensEnabled","scheduledActiveDirectorySyncEnabled","refreshTokensEnabled","UpdateScheduleFrequencyServerSettingName","ServerSettingsFormCtrl","languageOrLocaleChanged","serverSettingsPending","updateDefaultLanguage","updateDefaultLocale","clearSavedCredentials","isScheduledADSyncAllowed","runActiveDirectoryGroupsSync","viewUpdateHref","learnMoreHref","activeDirectorySyncScheduleFrequency","serverSettingsFormState","masterSettings","originalScheduleViewModel","equals","hardReloadIfNeeded","getLanguages","getLocales","getTotalRefreshTokenCount","languageDisplayNames","localeDisplayNames","isLangOrLocaleChanged","totalRefreshTokenCount","refreshTokenUncheckedMessage","booleanNames","embeddedCredentialsAndSchedulingPromise","langChanged","localeChanged","hardReloadPromise","SiteSettingsForSiteAdminFormCtrl","sitesResource","clearInvalid","focusByName","getSiteSettingsForSiteAdminUpdatePromise","revertSettings","master","siteSettingsForSiteAdminForm","inputName","ngModelCtrl","$setPristine","$setValidity","updateFailure","updateSuccess","NumberInputRange","INT","MIN","MAX","LONG","NUMBER_REGEXP","$parsers","inputVal","parseFloat","Number","MAX_VALUE","SiteIdValidRegExp","Chars","InvalidFind","InvalidTest","inputId","SiteSettingsForServerAdminFormCtrl","noLicenses","userCountMax","isSeatLicensing","storageQuotaMax","isVersionHistoryAllowed","getSiteSettingsForServerAdminUpdatePromise","siteSettingsForServerAdminForm","unbindNameWatcher","absUrl","updatePromises","SiteSwitcherCtrl","getButtonTitle","getSiteNamesAcrossAllPods","siteSwitcher","chosenSiteName","isCurrentSiteName","submitChangeSite","SiteUserDatasourcesSubplaceCtrl","SiteUserSubscriptionsSubplaceCtrl","SiteUserViewsSubplaceCtrl","SiteUserWorkbooksSubplaceCtrl","DeleteZiplogRequest","GetZiplogInfoRequest","GetZiplogUriRequest","GenerateZiplogRequest","ZiplogState","NONE","INPROGRESS","COMPLETE","ZiplogService","generate","daysToGenerate","logsUpToDate","ALL_DAYS","getInfo","ziplogInfo","ziplogPollPromise","ziplogPoller","ziplogInfoFromResult","getState","stopPolling","ziplog","ZiplogCtrl","ziplogService","confirmGenerateSnapshot","isNoZiplog","isZiplogGenerating","isZiplogAvailable","confirmGenerateZiplogDialog","DefaultZiplogDaysToGenerate","directives","attrName","digest","selector","tbChildSelector","exclusionEvents","tbChildExclusionEvents","exclusionSelector","tbChildExclusionSelector","callFn","child","$eval","ReactDirectiveFactory","directiveSpec","spec","watch","componentFactory","unmountComponentAtNode","alertListInfo","assignPermissionsToContentsService","pluckAndReduceToSum","k","el","getDialogTitleFor","getDialogBodyTextFor","authorizableCount","dialogBodyText","assignPermissionsToContentsPending","getAssignPermissionsToContentsPending","assignPermissionsToContentsPercent","getAssignPermissionsToContentsPercent","assignPermissionsToContentsButtonText","assignPermissionsToContents","canAssignPermissionsToContents","tbAutoSelect","clickFn","downFn","sizeInGigabytes","isNaN","$formatters","userActionResultCode","parseResults","usersSkippedMessage","skippedLineCount","usersProcessedMessage","processedLineCount","successResultsByCode","aggregateByResultCode","successResults","addLocalizedResultMessage","errorResultsByCode","aggregateByErrorCode","errorResults","addLocalizedErrorMessage","aggregatedResults","toLocalizedResultMessage","toLocalizedErrorMessage","LINE_NUMBER","line","UpdateUserDisplayNameNotification","UpdateUserEmailNotification","EMAIL","SyncUserActionNotification","ChangePasswordNotification","UserInvalidPassword","ChangeLanguageNotification","ChangeLocaleNotification","changePasswordNotification","currentPassword","requireCurrentPassword","clearAndCollapseFields","clearAndShowFields","disableSaveButton","passwordForm","CheckboxGroupCtrl","ctrls","checkboxGroupCtrl","MAX_CHARACTER_LENGTH_DEFAULT","onBeforeSave","maxCharacterLength","clickedInElement","currentRowIndex","currentRowObject","alwaysHaveCurrentRow","rowsClickable","emptyTemplate","DataGridBodyCtrl","keepColumnWidths","handleSliceChanged","prevSlice","hadItems","haveItems","ensureCurrentRowIndexInRange","contentWidths","contentWidthsChanged","getGridWidth","remainingSpace","cell","contentWidth","updateCurrentRowObject","rowIndex","setHoverRow","rowElement","rowHovered","isCurrentRowIndex","setActiveRow","clearActiveRow","activeRow","getBackgroundRow","setActiveRowIfHoverRow","setHoverRowIndex","getElementsOfSelectedRows","selectedIndices","getBackgroundRows","idx","backgroundWidth","marginWidth","rowIndices","isRowSeparator","willRowBeDeleted","headerWidthsChanged","headerWidths","DayCell","otherMonth","today","Calendar","showMonth","setToday","updateDayCells","firstDayOfMonth","monthOf","weeks","getDay","weekNumber","dayCell","isToday","isSameDay","day1","day2","selectedDate","dayNames","getWeeks","showNext","showPrevious","showToday","onSelect","calendar","prevMonth","nextMonth","selectedDays","toggleDay","tabindex","isTabindexSet","toggleClass","removeAttr","selectionParent","tbEditableCapabilityValue","getNextCapabilityValue","tagsWithCounts","$modelValue","$observe","attrReadonly","readonly","filterByTag","newUrl","tagFilterState","newTag","newTags","buttonContainer","appendTo","editButtonText","maxlength","modelValue","viewValue","newViewValue","invalid","ViewMode","EditMode","PreviewMode","disableEditButton","disablePreviewMode","textarea","preview","ctrlKey","updateUserDisplayNameNotification","originalDisplayName","displayNameForm","updateUserEmailNotification","delayUpdateEmailRequest","originalEmail","emailForm","changeLanguageNotification","changeLocaleNotification","applyUnspecifiedLanguageIfNecessary","applyUnspecifiedLocaleIfNecessary","langs","locs","isLanguageDirty","isLocaleDirty","userIsViewingTheirOwnSettings","maybeShowChangeLanguageNotification","maybeUpdatedLanguagePromise","maybeShowChangeLocaleNotification","maybeUpdatedLocalePromise","maybeUpdateLanguage","maybeUpdateLocale","canSave","keystrokeTimeout","DEBOUNCE_MS","inputEmail","newValidity","inEditMode","passwordRequired","inPasswordEditMode","editPassword","focusPasswordBox","StoreHelpers","allItems","onAdd","onRemove","negated","tbIfFeatureFlag","charAt","flagEnabled","hideElement","DRAGGING_CLASS","dragLeaveTimeout","onDropFn","doc","setDropEffect","effect","dataTransfer","dropEffect","files","filenameLocalizationKey","fileUploadId","fileInput","filename","FilteringListBoxColumnWidths","ActiveRowColumnWidth","IconColumnWidth","showActiveRow","showIcons","currentWidths","optionalColumnWidths","countWidth","onItemClicked","indicateActiveRow","itemIcon","placeholderText","getSliceableSource","isActiveRow","getItemText","getItemIcon","textBoxTestId","tbFocus","hidden","INTEGER_REGEXP","SetProjectControlledPermissionsAction","editabilityShortMessage","editabilityLongMessage","updateControlledPermissionsEnabled","updatedPermissionSource","updatedControlledPermissions","getProjects","canLockProjectPermissions","isChangeSourceLocked","permissionChangeSource","sources","getLockIconClass","buttonText","permissionState","FeatureFlagProjectControlledPermissionsEnabled","permissionsDialogMessage","warningMessage","enumState","showSigningIn","currentValue","upFn","downEvent","fillDiv","moveEvent","upEvent","downOutsideFn","mousedownEvents","enterFn","leaveFn","enterEvent","leaveEvent","OmniboxCtrl","startIndexForType","updateResults","TextBoxName","clearSearch","keydown","selectedIndex","maxSelectedIndex","isItemSelected","selectItem","itemHref","seeAllHref","showSeeAll","MaxResultsPerType","tooltipForDataSource","PROJECT","tooltipForView","tooltipForWorkbook","maxResultsPerType","windowElement","popupMaxHeight","SpaceLeftWhenMaxHeight","textBoxName","requestProgress","pendingRequests","totalResults","currentRequestProgress","updateProgress","showResults","showNoResults","updateStartIndexes","itemsForType","updateType","sortField","updateFn","showPrompt","getPositionElement","accordion","positionEditor","positionElement","permissionRuleEditor","explicitPermissionsScrollContent","effectivePermissionsScrollContent","explicitPermissionsBackdrop","effectivePermissionsBackdrop","ng-include","roleOptions","templates","getSavePermissionRuleTranslationID","maybeUpdateAuthorizables","holderElement","showReadMore","scrollWidth","Corner","StackedElement","positionCorner","contentCorner","rendered","updatePositionListener","updateContentElementPosition","setScope","destroy","getPositionX","positionOffset","positionSize","TopLeft","BottomLeft","TopRight","BottomRight","getPositionY","getContentLeft","positionX","contentSize","getContentTop","positionY","flipVertical","corner","flipHorizontal","contentHeight","calculateDisplayPosition","contentLeft","invalidHorizontalPosition","invalidVerticalPosition","windowHeight","getContentSize","getPositionSize","windowSize","calculatePosition","cornerPosition","stackedElements","createStackedElement","Popup","getContentElement","stackedElementsService","stackedElement","PopupCtrl","stackedElementService","popup","hidePopup","cornerFromString","cornerString","PopupMenuCtrl","contentMatchButtonWidth","_open","popupMenu","setButton","getButtonWidth","setContent","getContent","getContentScope","isUp","isOpen","Space","opened","closeFn","closed","popupMenuCtrl","matchButtonWidth","MAX_PORT","isValidPort","preventFn","tbPreventInput","lastValidValue","keyCode","SELECTED_CLASS","MIXED_CLASS","EMPTY_CLASS","groupCtrl","classForState","RadioButtonGroupCtrl","userPageOverridden","scrollCtrl","SelectController","currentOptionTranscludeFn","selectedOption","noneOptionTransclude","selectOption","option","selectPrevious","currentIndex","previousEnabledIndex","selectNext","nextEnabledIndex","addOption","isOptionForValue","setNoneOptionTransclude","removeOption","verifySelection","controllerAs","contentClass","modelCtrl","maxCountDigits","trigger","optionClicked","settingsCoordinatorCtrl","changeDefaultStartPage","changeUserStartPage","signOutKey","signInLogo","SiteRolePermissionsTable","permissionsForRoles","webAccess","interact","publish","manage","SortToolCtrl","menuOpened","cf","currentSort","Ascending","Descending","INVALID_ITEM","sortToolController","html","urlWithParams","pairs","paramsString","tbStateHrefConfig","tbStateHrefParams","opts","tbStateHrefOpts","keepSearch","omitParams","updateHref","$set","searchSuggestionsService","controllersArr","ctrlFocus","selectedTagIndex","deselectTags","addTag","quotedNewTag","removeTag","selectTag","currentTags","displayTag","getNewTagName","selectedTag","Backspace","caret","Delete","ArrowRight","ArrowLeft","isDefaultPrevented","newTagAddedToList","firstSlice","tagSource","dropdownWidth","TemplateListCtrl","templateListCtrl","ifExpression","clearable","onClear","onPaste","autoSelect","validation","clearValue","inputElement","inputElementClone","validatorName","addMixedValueHandlers","removeMixedValueHandlers","inputTestId","clearAndFocus","triggerEnter","syncModelToText","updateOn","Home","End","optionList","preventInput","TextileJsConverter","makeHtml","textile","$sanitize","textileConverter","not","ngModel","modelValueFromView","minutesAfterMidnight","minute","hour","use24HourTimeCycle","meridiem","precisionIncludesMinutes","FadeInTime","FadeOutTime","FadeInEasing","FadeOutEasing","fadeIn","animate","fadeOut","isFadingOut","stopTimer","stop","restartTimer","textFn","updateTooltip","mouseEvent","tooltipText","pageX","pageY","tooltipWidth","tooltipHeight","containerHeight","maxLeft","maxTop","currentClone","tbTranscludeFn","extraProperties","tbTranscludeScope","$interpolate","escapeRegexp","queryToEscape","formatMatch","prefixesOnly","regex","tbTypeaheadFormat","tbMatchPrefixesOnly","UpdateSiteLogoCtrl","previewImgWrapper","onFileInputChange","settingsFormState","submitSiteLogoForm","init","formIsDirty","formIsValid","RestApiPrefix","usingCustomLogo","dragAndDropEnabled","previewEnabled","resetToDefault","previewUrl","onFileAddedOrChanged","SupportedImageTypes","MaxImageSize","reader","FileReader","onload","onerror","onloadstart","onloadend","readAsDataURL","onFileDrop","fileInputElement","handleResetToDefaultClick","getPreviewUrl","updatePromise","FileSizeTooLarge","SiteCustomizationUnavailable","InvalidImage","ImageProcessingError","StorageException","iframeId","after","USERNAME_REGEXP","userSelected","groupSelected","userSearchSuggestions","groupSearchSuggestions","resizeFn","win","lazyResizeFn","PollMS","process","refreshStatusInterval","scopeDestroyed","refreshStatus","pending","pendingTransfers","syncTimestamp","showStatusText","statusText","statusTooltip","PENDING_COUNT","statusIconType","serverStatusHelpUrl","credentialType","cronExpression","minutesOfHourField","MINUTE_COUNT","hourOfDayField","translation","fragment","HOUR_COUNT","hoursFromDate","setHours","hoursToDate","FROM_DATETIME","TO_DATETIME","hoursSpecificDate","DATETIME","addSentenceSeparator","sentence","dash","FRAGMENT","formatListMiddleAndEnd","START_ITEMS","LAST_ITEM","FIRST_ITEMS","LAST_ITEMS","ITEM1","ITEM2","FIRST_ITEM","REMAINING_ITEMS","numberToPad","remoteRefreshType","scheduleAction","formatTime","setMinutes","formatHourly","frequency","FREQUENCY","START","END","formatDaily","formatWeekly","dayName","DAYS","dayCode","formatMonthly","DAYOFMONTH","setUrl","SearchBox","inputProps","paddingBottom","FilteringListBox","searchBoxHeight","measuredRowHeight","anyIcons","searchBoxPlaceholder","onChange","searchTermChanged","onKeyDown","handleKeyDown","overflowX","overflowY","sectionHeight","sectionSize","firstRowIndex","lastRowIndex","Row","ItemRefPrefix","showIcon","itemSelected","isBoolean","resetScrollPosition","viewPortNode","scrollItemIntoView","selectedItem","locationService","viewPortBottom","itemTop","itemBottom","updateVisibleSectionIndexes","searchBox","setTimeout","updateMaxCountDigitsAndIcons","icon","maxCount","measureRowHeight","firstRowKey","firstRowNode","visibleSections","calculateVisibleSectionIndexes","endIndex","itemStore","handleMouseOver","handleMouseOut","topBottomItemPadding","isDivider","float","itemLabel","labelHTML","filterDataBySearchTerm","fetchedRows","estimatedTotalRowCount","fetchedData","fetchedCount","regexForSearchTerm","filteredData","unfetchedCount","searchTermTokens","regexParts","token","nextId","closeMenuOnMouseDownOutside","getEventNamespace","mouseDownEvents","menuButtonWrapper","ButtonWrapper","toggleMenu","menuPanelWrapper","PanelWrapper","menuStyle","isMenuOpen","openMenu","onBeforeMenuOpen","cursor","alignRight","rightEdge","zIndex","FavoritesMenuPanel","HeaderMenuButton","menuButtonStyle","iconUrl","FavoritesMenu","loadFavorites","SiteSwitcherMenuButton","buttonTitle","SiteSwitcherMenuPanel","filteredRows","onServerPage","SiteSwitcher","loadSites","isCurrentSite","locationSearch","GetAlertCountAction","GetAlertsAction","AlertTryAgainAction","alertId","getAlertCount","getAlerts","AlertsPending","remainingAlerts","AlertsMenuPanel","alertsMenuContainerStyle","alertItems","fontStyle","AlertsMenuItem","maxHeight","fontWeight","table","cellSpacing","cellPadding","tr","labelCell","td","failureType","dateTimeOrNever","connectionDetailsLink","labelStyle","colSpan","isEditableFailure","remoteRefreshStatusCodes","AlertsMenu","alertCount","boundOnAlertsStoreChange","onAlertsStoreChange","HelpMenuPanel","boundItemSelected","boundShowAbout","boundShowGettingStarted","helpMenuContainerStyle","renderSearchBox","renderMenuItems","border","HeaderMenuItem","HelpMenu","helpMenuPanelProps","HeaderSearchBox","boundBlur","handleBlur","boundClick","contents","onBlur","Logo","marginBottom","UserMenuPanel","boundSignout","signout","boundChangeUserStartPage","boundChangeDefaultStartPage","isContentPage","switchUser","userMenuContainerStyle","UserMenu","TopBar","navigation","menus","tableCell","alertsMenu","favoritesMenu","helpMenu","userMenu","TypeaheadFilterButton","valueSpan","borderLeftWidth","borderLeftColor","borderLeftStyle","TypeaheadFilterPanel","TypeaheadFilter","lastFilter","initializeCachedFieldValues","cachedFieldValues","resetCachedFieldValues","addParameter","originalUrl","qstring","PermissionLockStatus","iconClass","Normalizer","y","PathBuilder","normalize","buildMovement","buildPath","movements","moveType","OffsetCorrector","boundRect","correctHorizontalOffset","elementRect","rightOverreach","Sparkline","TextBuffer","leftOverreach","totalCorrection","defaultState","measureTextAndSetOffsets","offsetCorrector","labels","dataPointsToLabel","textElement","newLabel","xOffset","readyForFullRender","getPointsToLabel","componentDidUpdate","fullRender","DefaultPadding","svgStyle","BackgroundColor","svgAttrs","subcomponents","labelAtDataPoint","circleAtDataPoint","_a","svg","pathBuilder","stroke","LineColor","strokeWidth","fill","fullName","circle","cx","cy","circleStyle","labelValue","textBuffer","r","yOffset","above","LabelStyle","textAnchor","minIndex","maxIndex","endPointHigher","labelPoints","CircleStyleEnd","CircleStyleMax","CircleStyleMin","SparklineWithTitle","elements","TitleStyle","CaptionStyle","StackedComponentStore","stackedComponents","AddStackedComponentAction","addStackedComponent","stackedComponent","RemoveStackedComponentAction","removeStackedComponent","$push","ComponentStacker","getStackedComponentsState","allStackedComponents","ThumbnailImage","encodeURI","backgroundSize","ActionMenuButton","ActionMenuItem","actionButton","classSet","tb-popup-menu-item","tb-disabled","contentSubplaceScope","MousedownOutsideDetector","attach","getIdFn","events","closePopupMenu","popupContentDescriptor","detachMousedownOutsideDetector","mouseDownOutsideFunc","PopupMenu","popupComponent","buttonClickHandler","buttonWidth","popupProps","mouseDownEvent","onPopupOpened","onPopupClosed","ActionsMenu","FavoriteToggle","hover","updateFromProps","prevProps","shouldCompile","currentProps","attributesToRemove","PopoverTrigger","tb-popover","popoverTemplateUrl","tb-popover-class","Thumbnail","mouseEnter","mouseLeave","toggleSelected","forceUpdate","tb-thumbnail","tb-hover","tb-selected","popoverTriggerProps","img","actionsMenuProps","favoriteProps","Thumbnails","getDetailsUrl","Toast","isFading","fadeOpacity","boundHover","boundFadeOut","boundClose","boundMouseOut","mouseOut","clearTimeout","fadeOutTimeoutId","closeTimeoutId","fadeTransitionTime","HoverRestoreTime","fadeStyle","transitionDuration","transitionTimingFunction","toastContent","lineWrapper","clearButton","mainDiv","boundListenerFn","toastOptionsArray","newToasts","UpdateConnectionsOAuthRequest","dataSourceId","connectionUpdate","requestParams","setPasswordParams","dataSourceIds","keychainEntryId","embedPassword","encryptedPasswordKeyId","GetDataConnectionTypesRequest","GetProjectNamesRequest","GetTagsRequest","GetUserNamesRequest","AssignPermissionsToContentsRequest","AssignPermissionsToContentsService","AssignPermissionsToContents","handleAssignPermissionsToContentsStatus","existingAssignment","getAssignPermissionsToContentsStatus","trackAssignPermissionsToContentsProgress","assignPermissionsToContentsPoller","BackdropService","backdropInstance","BulkImportUsersAction","showBulkImportUsersDialog","currentRefreshMode","newRefreshMode","currentRemoteAgentName","suppressSuccessToast","suppressErrorToast","newRemoteAgentName","DeleteGroupsActionNotification","GroupCannotBeDeleted","RenameGroupActionNotification","newGroupName","oldGroupName","UserGroupInvalidName","UserGroupWithNameAlreadyExists","UserAllUsersGroupAlreadyExists","CreateGroupActionNotification","createGroupActionNotification","activeDirectoryEnabled","datasourceErrorItem","datasourceName","DatasourceChangeOwnerDisabled","DatasourceMoveInsufficientPermissionsOnDatasource","DatasourceMoveInsufficientPermissionsOnDestinationProject","DatasourceMoveInsufficientPermissionsOnSourceProject","DatasourceWithSameNameInDestinationProject","deleteGroupsActionNotification","DesktopLaunchService","initHiddenIFrame","hiddenIFrame","appendChild","launchDesktop","focusElm","blurDeferred","DesktopLaunchTimeoutMillis","URIScheme","ServerDetailFetcher","requestMethod","GetActionableObjectsRequest","GetActionableObjectsForAction","projectErrorItem","ProjectChangeOwnerDisabled","groupUsers","lockProjectPermissions","unlockProjectPermissions","projIds","permission_source","PERMISSION_SOURCE","permissionChangeSuccess","permissionsChangeFail","busyUnlocking","renameGroupActionNotification","updateGroupNameInPlace","rejectOnError","UserActionResultCode","validUserActionCodes","userActionCode","normalizeUserActionCode","isValidUserActionCode","isValidUserActionErrorCode","viewErrorItem","syncToWindowWidth"],"mappings":"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","file":"vizportal.min.js","sourcesContent":["/// <reference path=\"../../lib/angular/angular.d.ts\" />\r\n/// <reference path=\"../../lib/angular/angular-cookies.d.ts\" />\r\n/// <reference path=\"../../lib/angular/angular-sanitize.d.ts\" />\r\n/// <reference path=\"../../lib/angular/angular-translate.d.ts\" />\r\n/// <reference path=\"../../lib/angular/angular-ui-router.d.ts\" />\r\n/// <reference path=\"../../lib/cldr/cldr.d.ts\" />\r\n/// <reference path=\"../../lib/flux/flux.d.ts\" />\r\n/// <reference path=\"../../lib/globalize/globalize.d.ts\" />\r\n/// <reference path=\"../../lib/jquery/jquery.d.ts\" />\r\n/// <reference path=\"../../lib/jquery/jquery.caret-1.5.2.d.ts\" />\r\n/// <reference path=\"../../lib/q/Q.d.ts\" />\r\n/// <reference path=\"../../lib/react/react-addons-global.d.ts\" />\r\n/// <reference path=\"../../lib/rsa/rsa.d.ts\" />\r\n/// <reference path=\"../../lib/tableau/tableau-js-api.d.ts\" />\r\n/// <reference path=\"../../lib/textile-js/textile.d.ts\" />\r\n/// <reference path=\"../../lib/underscore/underscore.d.ts\" /> \r\n/// <reference path=\"../libs.ts\" />\r\nvar Helpers;\r\n(function (Helpers) {\r\n    // Taken from httpd.conf (.*(?:\\:|\\%3A)embed=(y|yes|t|true|1).*)\r\n    Helpers.BooleanQueryParamRegex = /^[yt1]/i;\r\n    Helpers.BooleanQueryParamRegexFalse = /^[nf0]/i;\r\n    function dictFromArray(array, key) {\r\n        return _.object(_.pluck(array, key), array);\r\n    }\r\n    Helpers.dictFromArray = dictFromArray;\r\n    function toBoolean(val) {\r\n        return val === 'true';\r\n    }\r\n    Helpers.toBoolean = toBoolean;\r\n    function swapDict(map) {\r\n        return _.object(_.values(map), _.keys(map));\r\n    }\r\n    Helpers.swapDict = swapDict;\r\n})(Helpers || (Helpers = {}));\r\n/// <reference path=\"libs.ts\" />\r\n/// <reference path=\"helpers/Helpers.ts\" />\r\n/**\r\n * Takes any feature flags specified in the URL, and parses them into an array of objects that can\r\n * be used to override the default values. Feature flag overrides must be specified in the query\r\n * string (between ? and #) portion of the URL.\r\n *\r\n * Overrides work as follows:\r\n *  - If a flag is not given, it will not be overridden\r\n *  - If a flag is assigned the value \"true\" or \"false\" (case-insensitive), it will be overridden\r\n *    to true or false, respectively\r\n *  - If a flag is given any other value, it will not be overridden\r\n */\r\nvar FeatureFlagsHelper;\r\n(function (FeatureFlagsHelper) {\r\n    /**\r\n     * Returns an array of objects that represent the overridden feature flags\r\n     */\r\n    function getOverridesFromQueryString(queryString) {\r\n        var params = queryString.slice(1).split(\"&\");\r\n        var overrides = [];\r\n        params.forEach(function (param) {\r\n            var override = parseQueryParameter(param);\r\n            if (isOverrideValid(override)) {\r\n                overrides.push(override);\r\n            }\r\n        });\r\n        return overrides;\r\n    }\r\n    FeatureFlagsHelper.getOverridesFromQueryString = getOverridesFromQueryString;\r\n    function isOverrideValid(override) {\r\n        return override && override.flagName\r\n            && (override.value === true || override.value === false);\r\n    }\r\n    function parseQueryParameter(param) {\r\n        var keyAndValue = param.split(\"=\");\r\n        var key = decodeURIComponent(keyAndValue[0]);\r\n        var valueString = decodeURIComponent(keyAndValue[1]);\r\n        var value = null;\r\n        if (Helpers.BooleanQueryParamRegex.test(valueString)) {\r\n            value = true;\r\n        }\r\n        else if (Helpers.BooleanQueryParamRegexFalse.test(valueString)) {\r\n            value = false;\r\n        }\r\n        return { flagName: key, value: value };\r\n    }\r\n    // TODO: It would be more logical to refactor the FeatureFlags module into a class\r\n    //       and can keep this state and some of these helper methods there.\r\n    var featureFlagsOverwrittenFromQueryString = {};\r\n    /**\r\n     * Takes in a query string and overwrites the feature flags in the VizPortal module according\r\n     * to the overrides specified in the query string.\r\n     */\r\n    function overwriteFeatureFlagsFromQueryString(queryString, featureFlagsObj) {\r\n        var overrides = getOverridesFromQueryString(queryString);\r\n        overrides.forEach(function (override) {\r\n            // Don't add flags that we haven't defined\r\n            if (isFlagDefined(override.flagName, featureFlagsObj)) {\r\n                featureFlagsObj[override.flagName] = override.value;\r\n                featureFlagsOverwrittenFromQueryString[override.flagName] = override.flagName;\r\n            }\r\n        });\r\n    }\r\n    FeatureFlagsHelper.overwriteFeatureFlagsFromQueryString = overwriteFeatureFlagsFromQueryString;\r\n    /**\r\n     * Takes the server feature flags and updates the corresponding client feature flags to match.\r\n     * Values specified in the query string take precedence over values from the server.\r\n     */\r\n    function overwriteFeatureFlagsFromServerFeatureFlags(serverFeatureFlags, featureFlagsObj) {\r\n        _.each(serverFeatureFlags, function (value, flagName) {\r\n            // Don't add flags that we haven't defined and query string overrides take priority over flag values from the server\r\n            if (isFlagDefined(flagName, featureFlagsObj) && !featureFlagsOverwrittenFromQueryString[flagName]) {\r\n                featureFlagsObj[flagName] = value;\r\n            }\r\n        });\r\n    }\r\n    FeatureFlagsHelper.overwriteFeatureFlagsFromServerFeatureFlags = overwriteFeatureFlagsFromServerFeatureFlags;\r\n    function isFlagDefined(flag, featureFlagsObj) {\r\n        return featureFlagsObj[flag] !== undefined;\r\n    }\r\n})(FeatureFlagsHelper || (FeatureFlagsHelper = {}));\r\n/// <reference path=\"libs.ts\" />\r\n/// <reference path=\"FeatureFlagsHelper.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    /**\r\n     * The FeatureFlags module is a global object that is as low-level in the app as possible,\r\n     * so we can theoretically put any parameter of the application behind a flag. They are specified\r\n     * here, but can be overridden at runtime via URL query parameters.\r\n     */\r\n    var FeatureFlags;\r\n    (function (FeatureFlags) {\r\n        /**\r\n         * Enables the feature where users can see search results ordered by various relevant metrics\r\n         */\r\n        FeatureFlags.contentAnalyticsEnabled = false;\r\n        /**\r\n         * Online Sync Client features. (set by server)\r\n         */\r\n        FeatureFlags.dataSyncEnabled = false;\r\n        /**\r\n         * Enables the \"Home\" place and makes it the default start page.\r\n         */\r\n        FeatureFlags.homePlaceEnabled = false;\r\n        /**\r\n        *  Enables the feature where user can use their OAuth credential to refresh WDC data souces.\r\n        */\r\n        FeatureFlags.oAuthWDCServerRefresh = false;\r\n        /**\r\n         * Enables the feature that allows project owners to \"lock\" a project, and thus cause the\r\n         * permissions for all the workbooks in that project to assume the permissions specified on the\r\n         * project level.\r\n         */\r\n        FeatureFlags.projectControlledPermissionsEnabled = false;\r\n        /**\r\n         * Splits up the project permissions into project/workbook/datasource areas, where the\r\n         * workbook/datasource areas are the template \"defaults\" for new items created under that\r\n         * project.\r\n         */\r\n        FeatureFlags.projectPermissionsTemplatesEnabled = false;\r\n        // Clicking a selectable table row toggles its selection status\r\n        FeatureFlags.toggleSelectableRow = false;\r\n        FeatureFlags.reactDataGridInGroupsPlace = true;\r\n        FeatureFlags.reactDatasourceGrid = true;\r\n        FeatureFlags.reactExtractTasksGrid = false;\r\n        FeatureFlags.reactGroupUsersGrid = false;\r\n        FeatureFlags.reactProjectGrid = true;\r\n        FeatureFlags.reactRemoteSchedulesGrid = false;\r\n        FeatureFlags.reactSchedulesGrid = false;\r\n        FeatureFlags.reactServerUsersGrid = false;\r\n        FeatureFlags.reactSitesGrid = false;\r\n        FeatureFlags.reactSubscriptionsGrid = false;\r\n        FeatureFlags.reactViewGrid = true;\r\n        FeatureFlags.reactWorkbookGrid = true;\r\n        FeatureFlags.reactDataGridInSiteUsersPlace = false;\r\n        FeatureFlags.reactDataGridLoadingIndicator = false;\r\n        FeatureFlags.reactFavoritesMenu = false;\r\n        FeatureFlags.reactThumbnailsInWorkbooksAndViews = false;\r\n        FeatureFlags.reactTypeaheadFilter = false;\r\n        FeatureFlags.reactToasts = true;\r\n        FeatureFlags.reactTopBar = false;\r\n        FeatureFlags.reactTopBarDark = false;\r\n        /*\r\n         * Enables viewing and deletion of connected devices in site user settings.\r\n         * To be deleted after the new UX has been tested (TFS 419851)\r\n         */\r\n        FeatureFlags.connectedClientsTableEnabled = true;\r\n        /*\r\n         * These should generally be enabled together:\r\n         * Use updated font styles, including BentonSans.\r\n         * Use a taller row height for data grids and other lists.\r\n         * NOTE: These should be kept in sync with the same-named flags in includes/flags.styl.\r\n         */\r\n        FeatureFlags.useTallerRowHeight = false;\r\n        FeatureFlags.useUpdatedFontStyles = false;\r\n        /*\r\n         * Enables the feature that allows data sources to be created using web data connectors.\r\n         */\r\n        FeatureFlags.webDataConnectorsEnabled = false;\r\n        /*\r\n         * Enables the feature that allows viewing/restoration of previous workbook revisions.\r\n         */\r\n        FeatureFlags.workbookVersionHistoryEnabled = false;\r\n    })(FeatureFlags = VizPortal.FeatureFlags || (VizPortal.FeatureFlags = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n// Override the feature flags as soon as possible after the page loads and the feature flag defaults\r\n// are set, before the application is initialized. The helper must be invoked after declaration of\r\n// the feature flags, otherwise there will not be existing values to overwrite\r\nif (window.location.search) {\r\n    FeatureFlagsHelper.overwriteFeatureFlagsFromQueryString(window.location.search, VizPortal.FeatureFlags);\r\n}\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.ContentFiltersKeys = {\r\n        connectionType: 'connectionType',\r\n        createdBefore: 'createdBefore',\r\n        createdAfter: 'createdAfter',\r\n        databaseUsername: 'databaseUsername',\r\n        domain: 'domain',\r\n        forWorkbook: 'forWorkbook',\r\n        hasDatasource: 'hasDatasource',\r\n        hasAlert: 'hasAlert',\r\n        hasExtracts: 'hasExtracts',\r\n        hasPassword: 'hasPassword',\r\n        inGroup: 'inGroup',\r\n        lastRefreshedBefore: 'lastRefreshedBefore',\r\n        lastRefreshedAfter: 'lastRefreshedAfter',\r\n        maxSiteRole: 'maxSiteRole',\r\n        groupsMinimumSiteRole: 'groupsMinimumSiteRole',\r\n        modifiedBefore: 'modifiedBefore',\r\n        modifiedAfter: 'modifiedAfter',\r\n        owner: 'owner',\r\n        project: 'project',\r\n        schedule: 'schedule',\r\n        search: 'search',\r\n        serverName: 'serverName',\r\n        serverPort: 'serverPort',\r\n        showEmbedded: 'showEmbedded',\r\n        siteId: 'siteId',\r\n        siteRole: 'siteRole',\r\n        tag: 'tag',\r\n        workbook: 'workbook',\r\n        datasource: 'datasource',\r\n        favorite: 'favorite',\r\n        recent: 'recent',\r\n        group: 'group'\r\n    };\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.BuildId;\r\n    var Module;\r\n    (function (Module) {\r\n        var _instance;\r\n        var eagerServices = [];\r\n        function instance() {\r\n            if (!_instance) {\r\n                _instance = angular.module('VizPortal', [\r\n                    'ngCookies', 'ngSanitize', 'ui.router', 'pascalprecht.translate', 'placeholderShim']);\r\n            }\r\n            return _instance;\r\n        }\r\n        Module.instance = instance;\r\n        /**\r\n         * Register a service for eager instantiation. Note that this call does _not_ in itself\r\n         * eagerly instantiate the registered service. A call to {@link #initializeEagerServices} is required.\r\n         */\r\n        function registerEagerService(serviceName) {\r\n            eagerServices.push(serviceName);\r\n        }\r\n        Module.registerEagerService = registerEagerService;\r\n        /**\r\n         * Instantiate services which were registered using {@link #registerEagerService}. This method should\r\n         * be called after the initial bootstrapping of Angular is finished, for example, in a run-block.\r\n         */\r\n        function initializeEagerServices(injector) {\r\n            angular.forEach(eagerServices, function (service) {\r\n                injector.get(service);\r\n            });\r\n        }\r\n        Module.initializeEagerServices = initializeEagerServices;\r\n    })(Module = VizPortal.Module || (VizPortal.Module = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"IError.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"IRequest.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"IServer.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/IRequest.ts\" />\r\n/// <reference path=\"../types/IServer.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var Request = (function () {\r\n            function Request(method, params) {\r\n                this.method = method;\r\n                this.params = params;\r\n            }\r\n            // This is not used anywhere. It's only purpose is to use TResult so that Result doesn't lose type safety\r\n            // Later versions of TypeScript might not need this. \r\n            Request.prototype.send = function (server) {\r\n                return server.sendRequest(this);\r\n            };\r\n            return Request;\r\n        })();\r\n        ServerApi.Request = Request;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar __extends = (this && this.__extends) || function (d, b) {\r\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\r\n    function __() { this.constructor = d; }\r\n    __.prototype = b.prototype;\r\n    d.prototype = new __();\r\n};\r\n/// <reference path=\"../types/IResponse.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var UpdateDisplayModeRequest = (function (_super) {\r\n            __extends(UpdateDisplayModeRequest, _super);\r\n            function UpdateDisplayModeRequest(params) {\r\n                _super.call(this, 'updateDisplayMode', params);\r\n            }\r\n            return UpdateDisplayModeRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.UpdateDisplayModeRequest = UpdateDisplayModeRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        ServerApi.UserKeys = {\r\n            id: 'id',\r\n            authId: 'authId',\r\n            displayName: 'displayName'\r\n        };\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        ServerApi.AuthenticationType = {\r\n            AD: 'AD',\r\n            ClientCertificate: 'CLIENT_CERTIFICATE',\r\n            // when fallback is enabled, users can authenticate with username/password\r\n            ClientCertificateWithFallback: 'CLIENT_CERTIFICATE_WITH_FALLBACK',\r\n            Kerberos: 'KERBEROS',\r\n            Local: 'LOCAL',\r\n            OpenId: 'OPENID',\r\n            Saml: 'SAML',\r\n            Sspi: 'SSPI'\r\n        };\r\n        ServerApi.DomainFamily = {\r\n            ActiveDirectory: 'activedirectory',\r\n            Local: 'local',\r\n            External: 'external' // used by Tableau Online\r\n        };\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n// This file holds interfaces that are extended by other ServerApi interfaces\r\n// The interfaces in this file should not be stand-alone interfaces\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        // Key Objects\r\n        //TODO Figure out a way to remove the dependency on these Key variables and then remove it\r\n        ServerApi.NamedItemKeys = {\r\n            id: 'id',\r\n            name: 'name'\r\n        };\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"resourceParts.ts\" />\r\n/// <reference path=\"ISiteNameSansId.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"IServerSettingsUnauthenticated.ts\" />\r\n/// <reference path=\"ISiteNameWithId.ts\" />\r\n/// <reference path=\"ISiteThirdPartyAuthState.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"IUser.ts\" />\r\n/// <reference path=\"IFeatureFlags.ts\" />\r\n/// <reference path=\"ISiteNameWithRole.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        ServerApi.DisplayModes = {\r\n            list: 'list',\r\n            thumbnail: 'thumbnail'\r\n        };\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n//NOTE: Feature detection is the perfered way to handle browser differences.\r\n//      Browser detection (using isIE7orLess() or isIE8orLess() methods) should\r\n//      only be used if a feature detection is not possible.\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.ViewportContent = {\r\n        deviceWidth: 'width=device-width, maximum-scale=1.3',\r\n        fixedWidth: 'width=1024, maximum-scale=1.3'\r\n    };\r\n    var BrowserSupportService = (function () {\r\n        function BrowserSupportService($window) {\r\n            this.msieMatch = BrowserSupportService.MSIE_REGEX.exec($window.navigator.userAgent);\r\n            this.touchTest = BrowserSupportService.TOUCH_REGEX.test($window.navigator.userAgent);\r\n            this.chromeIOSTest = BrowserSupportService.CHROME_IOS_REGEX.test($window.navigator.userAgent);\r\n            this.chromeAndroidTest = BrowserSupportService.CHROME_REGEX.test($window.navigator.userAgent)\r\n                && BrowserSupportService.ANDROID_REGEX.test($window.navigator.userAgent);\r\n        }\r\n        BrowserSupportService.prototype.isIE7orLess = function () {\r\n            return !!this.msieMatch && this.msieMatch[1] < '8';\r\n        };\r\n        BrowserSupportService.prototype.isIE8orLess = function () {\r\n            return !!this.msieMatch && this.msieMatch[1] < '9';\r\n        };\r\n        BrowserSupportService.prototype.isIE9orLess = function () {\r\n            // this.msieMatch[1] evaluates to '9.0', this will not compare as expected to '10'\r\n            // Therefore, parseInt and compare as numbers instead.\r\n            return !!this.msieMatch && parseInt(this.msieMatch[1], 10) < 10;\r\n        };\r\n        BrowserSupportService.prototype.isTouch = function () {\r\n            return this.touchTest;\r\n        };\r\n        BrowserSupportService.prototype.isAndroidChrome = function () {\r\n            return !!this.chromeAndroidTest;\r\n        };\r\n        BrowserSupportService.prototype.supportsFormData = function () {\r\n            return window['FormData'] !== undefined;\r\n        };\r\n        BrowserSupportService.prototype.supportsFileReader = function () {\r\n            return window['FileReader'] !== undefined;\r\n        };\r\n        BrowserSupportService.prototype.supportsDragAndDropEvents = function () {\r\n            var div = document.createElement('div');\r\n            return ('ondragstart' in div && 'ondrop' in div);\r\n        };\r\n        BrowserSupportService.prototype.setViewport = function (content) {\r\n            var viewportEl = $('meta[name=\"viewport\"]');\r\n            var newViewportEl = $('<meta>').attr('name', 'viewport').attr('content', content);\r\n            if (viewportEl.length) {\r\n                viewportEl.replaceWith(newViewportEl);\r\n            }\r\n            else {\r\n                $(document.head).prepend(newViewportEl);\r\n            }\r\n        };\r\n        BrowserSupportService.MSIE_REGEX = /msie ([\\w.]+)/i; //This check only works for versions of IE < 11\r\n        // Keep minimum touch check in sync with workgroup\\vqlweb\\scriptsharp\\src\\Core\\Utility\\BrowserSupport.cs\r\n        BrowserSupportService.TOUCH_REGEX = /iphone|ipad|ipod|android|blackberry|webos|iemobile|palm/i;\r\n        BrowserSupportService.CHROME_IOS_REGEX = /CriOS\\//; // https://developer.chrome.com/multidevice/user-agent\r\n        BrowserSupportService.ANDROID_REGEX = /android/i;\r\n        BrowserSupportService.CHROME_REGEX = /Chrome\\/[.0-9]*/; // https://developer.chrome.com/multidevice/user-agent\r\n        BrowserSupportService.$inject = ['$window'];\r\n        return BrowserSupportService;\r\n    })();\r\n    VizPortal.BrowserSupportService = BrowserSupportService;\r\n    VizPortal.Module.instance().service('BrowserSupportService', BrowserSupportService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/BrowserSupportService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var L10n;\r\n    (function (L10n) {\r\n        L10n.MissingTranslationHandlerName = \"missingTranslation\";\r\n        VizPortal.Module.instance().factory(L10n.MissingTranslationHandlerName, [\r\n            'BrowserSupportService',\r\n            function (BrowserSupportService) {\r\n                // IE9 (real, not emulated) gets very sad when you even test for console.error\r\n                // without the Dev Tools open.  So, we log nothing for missing translations on IE8.\r\n                if (BrowserSupportService.isIE9orLess()) {\r\n                    return function (key) { };\r\n                }\r\n                else {\r\n                    return function (key) {\r\n                        if (console && console.error) {\r\n                            console.error('missing \\'' + L10n.language + '\\' translation for key: ' + key);\r\n                        }\r\n                    };\r\n                }\r\n            }\r\n        ]);\r\n    })(L10n = VizPortal.L10n || (VizPortal.L10n = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/MissingTranslationService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var L10n;\r\n    (function (L10n) {\r\n        var Keys;\r\n        (function (Keys) {\r\n            Keys.allOwners = \"allOwners\";\r\n            Keys.allProjects = \"allProjects\";\r\n            Keys.allTags = \"allTags\";\r\n            Keys.connector = \"connector\";\r\n            Keys.custom = \"custom\";\r\n            Keys.datasourceConnector = \"datasourceConnector\";\r\n            Keys.datasourceEditor = \"datasourceEditor\";\r\n            Keys.delete_ = \"delete\"; // Old versions of IE don't allow 'delete' as a property name\r\n            Keys.denied = \"denied\";\r\n            Keys.edit = \"edit\";\r\n            Keys.editor = \"editor\";\r\n            Keys.interactor = \"interactor\";\r\n            Keys.projectLeader = \"project_leader\";\r\n            Keys.none = \"none\";\r\n            Keys.permissions = \"permissions\";\r\n            Keys.publisher = \"publisher\";\r\n            Keys.save = \"save\";\r\n            Keys.sizeInBytes = \"sizeInBytes\";\r\n            Keys.sizeInGB = \"sizeInGB\";\r\n            Keys.sizeInKB = \"sizeInKB\";\r\n            Keys.sizeInMB = \"sizeInMB\";\r\n            Keys.title = \"title\";\r\n            Keys.viewer = \"viewer\";\r\n        })(Keys = L10n.Keys || (L10n.Keys = {}));\r\n        L10n.language;\r\n        L10n.locale;\r\n        function loadLocaleJson(data) {\r\n            Globalize.load(data);\r\n        }\r\n        L10n.loadLocaleJson = loadLocaleJson;\r\n        // This maps several nonstandard locales into CLDR locales.\r\n        // This logic is duplicated in the get-cldr-data.js tool.\r\n        function getGlobalizeLocale(userLocale) {\r\n            var cldr = new Cldr(userLocale);\r\n            switch (cldr.locale) {\r\n                case 'zh-HK': return 'zh-Hans-HK';\r\n                case 'zh-SG': return 'zh-Hans-SG';\r\n                case 'zh-TW': return 'zh-Hant-TW';\r\n                case 'no': return 'nb';\r\n                case 'sr-BA': return 'sr-Cyrl-BA';\r\n                case 'sr-ME': return 'sr-Cyrl-ME';\r\n                case 'sr-CS': return 'sr-Cyrl';\r\n                default: return cldr.locale;\r\n            }\r\n        }\r\n        var cldr;\r\n        var countFormatter;\r\n        var floatFormatter;\r\n        var percentFormatter;\r\n        var dateFormatter;\r\n        var dateTimeFormatter;\r\n        var timeFormatter;\r\n        var shortTimeFormatter;\r\n        var hourParser;\r\n        var firstDayOfWeekNumber;\r\n        var narrowDayNamesArray;\r\n        var wideDayNamesArray;\r\n        var yearAndMonthFormatter;\r\n        var preferredTimeCycle;\r\n        // Create reference to internal Globalize method.\r\n        // This is used to replace placeholders in CLDR format strings such as \"{0} {1}\".\r\n        // It's internal, but unlikely to change, as it is core functionality.\r\n        var formatMessage = (Globalize['_formatMessage']);\r\n        // Construct a datetime format pattern that is just like the 'medium' datetime pattern,\r\n        // but uses the 'short' time (which omits the seconds).\r\n        // This code is patterned after the Globalize method \"dateExpandPattern\" in date.js.\r\n        function mediumShortDateTimePattern(cldr) {\r\n            var dateTimeFormat = cldr.main([\r\n                'dates/calendars/gregorian/dateTimeFormats',\r\n                'medium'\r\n            ]);\r\n            return formatMessage(dateTimeFormat, [\r\n                cldr.main([\r\n                    'dates/calendars/gregorian/timeFormats',\r\n                    'short'\r\n                ]),\r\n                cldr.main([\r\n                    'dates/calendars/gregorian/dateFormats',\r\n                    'medium'\r\n                ])\r\n            ]);\r\n        }\r\n        function useLocale(locale) {\r\n            cldr = Globalize.locale(getGlobalizeLocale(locale));\r\n            countFormatter = Globalize.numberFormatter({ maximumFractionDigits: 0 });\r\n            floatFormatter = Globalize.numberFormatter({ minimumFractionDigits: 1, maximumFractionDigits: 1 });\r\n            percentFormatter = Globalize.numberFormatter({ style: 'percent' });\r\n            dateFormatter = Globalize.dateFormatter({ date: 'medium' });\r\n            dateTimeFormatter = Globalize.dateFormatter({ pattern: mediumShortDateTimePattern(cldr) });\r\n            timeFormatter = Globalize.dateFormatter({ time: 'short' });\r\n            yearAndMonthFormatter = Globalize.dateFormatter('yMMM');\r\n            shortTimeFormatter = Globalize.dateFormatter({ time: 'short' });\r\n            hourParser = Globalize.dateParser({ pattern: 'H' });\r\n            firstDayOfWeekNumber = cldr.supplemental.weekData.firstDay() === 'mon' ? 1 : 0;\r\n            narrowDayNamesArray = _.values(cldr.main('dates/calendars/gregorian/days/format/narrow'));\r\n            wideDayNamesArray = _.values(cldr.main('dates/calendars/gregorian/days/format/wide'));\r\n            if (firstDayOfWeekNumber === 1) {\r\n                narrowDayNamesArray.push(narrowDayNamesArray.shift());\r\n                wideDayNamesArray.push(wideDayNamesArray.shift());\r\n            }\r\n            preferredTimeCycle = cldr.supplemental.timeData.preferred();\r\n        }\r\n        L10n.useLocale = useLocale;\r\n        function localizedCount(value) {\r\n            if (!countFormatter)\r\n                return value;\r\n            if (value === +value) {\r\n                if (value === (value | 0)) {\r\n                    return countFormatter(value);\r\n                }\r\n            }\r\n            return value;\r\n        }\r\n        L10n.localizedCount = localizedCount;\r\n        function localizedFloat(value) {\r\n            if (!floatFormatter)\r\n                return value;\r\n            if (value === +value) {\r\n                return floatFormatter(value);\r\n            }\r\n            return value;\r\n        }\r\n        L10n.localizedFloat = localizedFloat;\r\n        function localizedPercent(value) {\r\n            if (!percentFormatter)\r\n                return value;\r\n            if (value === +value) {\r\n                return percentFormatter(value / 100);\r\n            }\r\n            return value;\r\n        }\r\n        L10n.localizedPercent = localizedPercent;\r\n        function formatAsDate(value, formatter) {\r\n            if (!formatter)\r\n                return '';\r\n            if (_.isDate(value)) {\r\n                return formatter(value);\r\n            }\r\n            else if (_.isString(value)) {\r\n                return formatter(new Date(value));\r\n            }\r\n            return '';\r\n        }\r\n        function parse24Hour(value) {\r\n            return hourParser(value);\r\n        }\r\n        L10n.parse24Hour = parse24Hour;\r\n        function localizedDate(value) {\r\n            return formatAsDate(value, dateFormatter);\r\n        }\r\n        L10n.localizedDate = localizedDate;\r\n        function localizedDateTime(value) {\r\n            return formatAsDate(value, dateTimeFormatter);\r\n        }\r\n        L10n.localizedDateTime = localizedDateTime;\r\n        function localizedShortTime(value) {\r\n            return formatAsDate(value, shortTimeFormatter);\r\n        }\r\n        L10n.localizedShortTime = localizedShortTime;\r\n        function localizedTime(value) {\r\n            return formatAsDate(value, timeFormatter);\r\n        }\r\n        L10n.localizedTime = localizedTime;\r\n        // returns 0 for Sunday, 1 for Monday\r\n        function firstDayOfWeek() {\r\n            return firstDayOfWeekNumber || 0;\r\n        }\r\n        L10n.firstDayOfWeek = firstDayOfWeek;\r\n        // True if Monday, false if Sunday. Callers shouldn't need to know the int values.\r\n        function firstDayOfWeekIsMonday() {\r\n            return firstDayOfWeek() === 1;\r\n        }\r\n        L10n.firstDayOfWeekIsMonday = firstDayOfWeekIsMonday;\r\n        function is24HourTimeCycle() {\r\n            return preferredTimeCycle === 'H';\r\n        }\r\n        L10n.is24HourTimeCycle = is24HourTimeCycle;\r\n        function narrowDayNames() {\r\n            return narrowDayNamesArray || [];\r\n        }\r\n        L10n.narrowDayNames = narrowDayNames;\r\n        function wideDayNames() {\r\n            return wideDayNamesArray || [];\r\n        }\r\n        L10n.wideDayNames = wideDayNames;\r\n        function yearAndMonth(date) {\r\n            return yearAndMonthFormatter ? yearAndMonthFormatter(date) : '';\r\n        }\r\n        L10n.yearAndMonth = yearAndMonth;\r\n        function elideIfLong(s) {\r\n            return s && s.length > 100\r\n                ? s.substr(0, 100) + '\\u2026' // HORIZONTAL ELLIPSIS\r\n                : s;\r\n        }\r\n        L10n.elideIfLong = elideIfLong;\r\n        var SanitizingTranslateInterpolationWrapper = (function () {\r\n            function SanitizingTranslateInterpolationWrapper(wrappedInterpolation, id, sanitizeStrategy) {\r\n                if (id === void 0) { id = ''; }\r\n                if (sanitizeStrategy === void 0) { sanitizeStrategy = 'escaped'; }\r\n                this.wrappedInterpolation = wrappedInterpolation;\r\n                this.id = id;\r\n                this.sanitizeStrategy = sanitizeStrategy;\r\n            }\r\n            SanitizingTranslateInterpolationWrapper.prototype.setLocale = function (locale) {\r\n                this.wrappedInterpolation.setLocale(locale);\r\n            };\r\n            SanitizingTranslateInterpolationWrapper.prototype.getInterpolationIdentifier = function () {\r\n                return this.id;\r\n            };\r\n            SanitizingTranslateInterpolationWrapper.prototype.useSanitizeValueStrategy = function (value) {\r\n                this.savedSanitizeStrategy = value;\r\n                this.wrappedInterpolation.useSanitizeValueStrategy(value);\r\n                return this;\r\n            };\r\n            SanitizingTranslateInterpolationWrapper.prototype.interpolate = function (input, params) {\r\n                this.wrappedInterpolation.useSanitizeValueStrategy(this.sanitizeStrategy);\r\n                var result = this.wrappedInterpolation.interpolate(input, params);\r\n                this.wrappedInterpolation.useSanitizeValueStrategy(this.savedSanitizeStrategy);\r\n                return result;\r\n            };\r\n            return SanitizingTranslateInterpolationWrapper;\r\n        })();\r\n        var NumberLocalizingTranslateInterpolationWrapper = (function () {\r\n            function NumberLocalizingTranslateInterpolationWrapper(wrappedInterpolation, id, localize, sanitizeStrategy) {\r\n                if (sanitizeStrategy === void 0) { sanitizeStrategy = null; }\r\n                this.wrappedInterpolation = wrappedInterpolation;\r\n                this.id = id;\r\n                this.localize = localize;\r\n                this.sanitizeStrategy = sanitizeStrategy;\r\n            }\r\n            NumberLocalizingTranslateInterpolationWrapper.prototype.setLocale = function (locale) {\r\n                this.wrappedInterpolation.setLocale(locale);\r\n            };\r\n            NumberLocalizingTranslateInterpolationWrapper.prototype.getInterpolationIdentifier = function () {\r\n                return this.id;\r\n            };\r\n            NumberLocalizingTranslateInterpolationWrapper.prototype.useSanitizeValueStrategy = function (value) {\r\n                this.savedSanitizeStrategy = value;\r\n                this.wrappedInterpolation.useSanitizeValueStrategy(value);\r\n                return this;\r\n            };\r\n            NumberLocalizingTranslateInterpolationWrapper.prototype.interpolate = function (input, params) {\r\n                var _this = this;\r\n                var newParams = {};\r\n                _.each(params, function (value, key) {\r\n                    newParams[key] = value;\r\n                    var locKey = key + '_LOC';\r\n                    if (!_.has(params, locKey) && value === +value) {\r\n                        newParams[locKey] = _this.localize(value);\r\n                    }\r\n                });\r\n                this.wrappedInterpolation.useSanitizeValueStrategy(this.sanitizeStrategy);\r\n                var result = this.wrappedInterpolation.interpolate(input, newParams);\r\n                this.wrappedInterpolation.useSanitizeValueStrategy(this.savedSanitizeStrategy);\r\n                return result;\r\n            };\r\n            return NumberLocalizingTranslateInterpolationWrapper;\r\n        })();\r\n        /**\r\n         * When to use escaped vs non:\r\n         *   If you are using the translate directive in jade, use the escaped version\r\n         *   If you are binding to a string that was localized with the $translate service, use the non-escaped version.\r\n         *\r\n         * Details:\r\n         *   Angular will escape the results of expressions before rendering them in the DOM (https://docs.angularjs.org/api/ng/service/$sce)\r\n         *   The translate directive does not escape strings. This is fine for static strings, but we need to use the escaped versions\r\n         *   of the interpolators to ensure that any dynamic data gets santized.\r\n         */\r\n        L10n.Interpolations = {\r\n            Escaped: 'escaped',\r\n            Count: 'localizedCount',\r\n            CountEscaped: 'localizedCountEscaped',\r\n            Float: 'localizedFloat',\r\n            FloatEscaped: 'localizedFloatEscaped',\r\n            Percent: 'localizedPercent',\r\n            PercentEscaped: 'localizedPercentEscaped'\r\n        };\r\n        var EscapedTranslateInterpolationName = 'EscapedTranslateInterpolation';\r\n        angular.module('pascalprecht.translate').factory(EscapedTranslateInterpolationName, [\r\n            '$translateMessageFormatInterpolation',\r\n            function ($translateMessageFormatInterpolation) {\r\n                return new SanitizingTranslateInterpolationWrapper($translateMessageFormatInterpolation, L10n.Interpolations.Escaped);\r\n            }\r\n        ]);\r\n        var LocalizedCountTranslateInterpolationName = 'LocalizedCountTranslateInterpolation';\r\n        angular.module('pascalprecht.translate').factory(LocalizedCountTranslateInterpolationName, [\r\n            '$translateMessageFormatInterpolation',\r\n            function ($translateMessageFormatInterpolation) {\r\n                return new NumberLocalizingTranslateInterpolationWrapper($translateMessageFormatInterpolation, L10n.Interpolations.Count, localizedCount);\r\n            }\r\n        ]);\r\n        var LocalizedCountEscapedTranslateInterpolationName = 'LocalizedCountEscapedTranslateInterpolation';\r\n        angular.module('pascalprecht.translate').factory(LocalizedCountEscapedTranslateInterpolationName, [\r\n            '$translateMessageFormatInterpolation',\r\n            function ($translateMessageFormatInterpolation) {\r\n                return new NumberLocalizingTranslateInterpolationWrapper($translateMessageFormatInterpolation, L10n.Interpolations.CountEscaped, localizedCount, 'escaped');\r\n            }\r\n        ]);\r\n        var LocalizedFloatTranslateInterpolationName = 'LocalizedFloatTranslateInterpolation';\r\n        angular.module('pascalprecht.translate').factory(LocalizedFloatTranslateInterpolationName, [\r\n            '$translateMessageFormatInterpolation',\r\n            function ($translateMessageFormatInterpolation) {\r\n                return new NumberLocalizingTranslateInterpolationWrapper($translateMessageFormatInterpolation, L10n.Interpolations.Float, localizedFloat);\r\n            }\r\n        ]);\r\n        var LocalizedFloatEscapedTranslateInterpolationName = 'LocalizedFloatEscapedTranslateInterpolation';\r\n        angular.module('pascalprecht.translate').factory(LocalizedFloatEscapedTranslateInterpolationName, [\r\n            '$translateMessageFormatInterpolation',\r\n            function ($translateMessageFormatInterpolation) {\r\n                return new NumberLocalizingTranslateInterpolationWrapper($translateMessageFormatInterpolation, L10n.Interpolations.FloatEscaped, localizedFloat, 'escaped');\r\n            }\r\n        ]);\r\n        var LocalizedPercentTranslateInterpolationName = 'LocalizedPercentTranslateInterpolation';\r\n        angular.module('pascalprecht.translate').factory(LocalizedPercentTranslateInterpolationName, [\r\n            '$translateMessageFormatInterpolation',\r\n            function ($translateMessageFormatInterpolation) {\r\n                return new NumberLocalizingTranslateInterpolationWrapper($translateMessageFormatInterpolation, L10n.Interpolations.Percent, localizedPercent);\r\n            }\r\n        ]);\r\n        var LocalizedPercentEscapedTranslateInterpolationName = 'LocalizedPercentEscapedTranslateInterpolation';\r\n        angular.module('pascalprecht.translate').factory(LocalizedPercentEscapedTranslateInterpolationName, [\r\n            '$translateMessageFormatInterpolation',\r\n            function ($translateMessageFormatInterpolation) {\r\n                return new NumberLocalizingTranslateInterpolationWrapper($translateMessageFormatInterpolation, L10n.Interpolations.PercentEscaped, localizedPercent, 'escaped');\r\n            }\r\n        ]);\r\n        VizPortal.Module.instance().config(['$translateProvider', function ($translateProvider) {\r\n                $translateProvider\r\n                    .translationNotFoundIndicatorLeft('[')\r\n                    .translationNotFoundIndicatorRight(']')\r\n                    .useMissingTranslationHandler(L10n.MissingTranslationHandlerName)\r\n                    .useStaticFilesLoader({\r\n                    prefix: 'loc/',\r\n                    suffix: '.json'\r\n                })\r\n                    .useMessageFormatInterpolation() // (see https://github.com/SlexAxton/messageformat.js)\r\n                    .addInterpolation(EscapedTranslateInterpolationName)\r\n                    .addInterpolation(LocalizedCountTranslateInterpolationName)\r\n                    .addInterpolation(LocalizedCountEscapedTranslateInterpolationName)\r\n                    .addInterpolation(LocalizedFloatTranslateInterpolationName)\r\n                    .addInterpolation(LocalizedFloatEscapedTranslateInterpolationName)\r\n                    .addInterpolation(LocalizedPercentTranslateInterpolationName)\r\n                    .addInterpolation(LocalizedPercentEscapedTranslateInterpolationName);\r\n            }]);\r\n    })(L10n = VizPortal.L10n || (VizPortal.L10n = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/ISiteLoginParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var ClientCertificateLoginRequest = (function (_super) {\r\n            __extends(ClientCertificateLoginRequest, _super);\r\n            function ClientCertificateLoginRequest(params) {\r\n                _super.call(this, 'auth/clientCertificateLogin', params);\r\n            }\r\n            return ClientCertificateLoginRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.ClientCertificateLoginRequest = ClientCertificateLoginRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GeneratePublicKeyRequest = (function (_super) {\r\n            __extends(GeneratePublicKeyRequest, _super);\r\n            function GeneratePublicKeyRequest(params) {\r\n                if (params === void 0) { params = {}; }\r\n                _super.call(this, 'generatePublicKey', params);\r\n            }\r\n            return GeneratePublicKeyRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GeneratePublicKeyRequest = GeneratePublicKeyRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/IServerSettingsUnauthenticated.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetServerSettingsUnauthenticatedRequest = (function (_super) {\r\n            __extends(GetServerSettingsUnauthenticatedRequest, _super);\r\n            function GetServerSettingsUnauthenticatedRequest(params) {\r\n                if (params === void 0) { params = {}; }\r\n                _super.call(this, 'getServerSettingsUnauthenticated', params);\r\n            }\r\n            return GetServerSettingsUnauthenticatedRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetServerSettingsUnauthenticatedRequest = GetServerSettingsUnauthenticatedRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/ISessionInfo.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetSessionInfoRequest = (function (_super) {\r\n            __extends(GetSessionInfoRequest, _super);\r\n            function GetSessionInfoRequest() {\r\n                _super.call(this, 'getSessionInfo', {});\r\n            }\r\n            return GetSessionInfoRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetSessionInfoRequest = GetSessionInfoRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"ISiteLoginParams.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/ILoginParams.ts\" />\r\n/// <reference path=\"../types/ISessionInfo.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var InitializeServerWithActiveDirectoryUserRequest = (function (_super) {\r\n            __extends(InitializeServerWithActiveDirectoryUserRequest, _super);\r\n            function InitializeServerWithActiveDirectoryUserRequest(params) {\r\n                _super.call(this, 'initializeServerWithActiveDirectoryUser', params);\r\n            }\r\n            return InitializeServerWithActiveDirectoryUserRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.InitializeServerWithActiveDirectoryUserRequest = InitializeServerWithActiveDirectoryUserRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/ILoginParams.ts\" />\r\n/// <reference path=\"../types/ISessionInfo.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var InitializeServerWithExternalUserRequest = (function (_super) {\r\n            __extends(InitializeServerWithExternalUserRequest, _super);\r\n            function InitializeServerWithExternalUserRequest(params) {\r\n                _super.call(this, 'initializeServerWithExternalUser', params);\r\n            }\r\n            return InitializeServerWithExternalUserRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.InitializeServerWithExternalUserRequest = InitializeServerWithExternalUserRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/ILoginParams.ts\" />\r\n/// <reference path=\"../types/ISessionInfo.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var InitializeServerWithLocalUserRequest = (function (_super) {\r\n            __extends(InitializeServerWithLocalUserRequest, _super);\r\n            function InitializeServerWithLocalUserRequest(params) {\r\n                _super.call(this, 'initializeServerWithLocalUser', params);\r\n            }\r\n            return InitializeServerWithLocalUserRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.InitializeServerWithLocalUserRequest = InitializeServerWithLocalUserRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/ISiteLoginParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var KerberosLoginRequest = (function (_super) {\r\n            __extends(KerberosLoginRequest, _super);\r\n            function KerberosLoginRequest(params) {\r\n                _super.call(this, 'auth/kerberosLogin', params);\r\n            }\r\n            return KerberosLoginRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.KerberosLoginRequest = KerberosLoginRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/ILoginParams.ts\" />\r\n/// <reference path=\"../types/ISessionInfo.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var LoginRequest = (function (_super) {\r\n            __extends(LoginRequest, _super);\r\n            function LoginRequest(params) {\r\n                _super.call(this, 'login', params);\r\n            }\r\n            return LoginRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.LoginRequest = LoginRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var LogoutRequest = (function (_super) {\r\n            __extends(LogoutRequest, _super);\r\n            function LogoutRequest() {\r\n                _super.call(this, 'logout', {});\r\n            }\r\n            return LogoutRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.LogoutRequest = LogoutRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/ISiteLoginParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var SspiLoginRequest = (function (_super) {\r\n            __extends(SspiLoginRequest, _super);\r\n            function SspiLoginRequest(params) {\r\n                _super.call(this, 'auth/sspiLogin', params);\r\n            }\r\n            return SspiLoginRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.SspiLoginRequest = SspiLoginRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var SwitchSiteRequest = (function (_super) {\r\n            __extends(SwitchSiteRequest, _super);\r\n            function SwitchSiteRequest(params) {\r\n                _super.call(this, 'switchSite', params);\r\n            }\r\n            return SwitchSiteRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.SwitchSiteRequest = SwitchSiteRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        // More info here: http://mytableau/display/devft/Site+Role\r\n        // And at: http://mytableau/display/devft/getSiteUsers\r\n        ServerApi.SiteRoles = {\r\n            ServerAdministrator: 'ServerAdministrator',\r\n            SiteAdministrator: 'SiteAdministrator',\r\n            Publisher: 'Publisher',\r\n            Interactor: 'Interactor',\r\n            Viewer: 'Viewer',\r\n            Unlicensed: 'Unlicensed',\r\n            ViewerWithPublish: 'ViewerWithPublish',\r\n            UnlicensedWithPublish: 'UnlicensedWithPublish',\r\n            Guest: 'Guest'\r\n        };\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../../ts/FeatureFlags.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    (function (ToastType) {\r\n        ToastType[ToastType[\"Info\"] = 0] = \"Info\";\r\n        ToastType[ToastType[\"Error\"] = 1] = \"Error\";\r\n        ToastType[ToastType[\"External\"] = 2] = \"External\";\r\n    })(VizPortal.ToastType || (VizPortal.ToastType = {}));\r\n    var ToastType = VizPortal.ToastType;\r\n    var ToasterService = (function () {\r\n        function ToasterService($interval) {\r\n            this.listeners = [];\r\n            this.nextToastId = 0;\r\n            this.nextListenerId = 0;\r\n            this.$interval = $interval;\r\n            this.toasts = [];\r\n        }\r\n        ToasterService.prototype.pop = function (toastOptions) {\r\n            var id = this.nextToastId++;\r\n            var toast = {\r\n                id: id,\r\n                type: ToastType[toastOptions.type].toLowerCase(),\r\n                isClosed: false,\r\n                lines: toastOptions.text ? toastOptions.text.split('\\n') : undefined,\r\n                templateUrl: toastOptions.templateUrl,\r\n                data: toastOptions.data,\r\n                timeoutDelay: toastOptions.timeoutDelay,\r\n                content: toastOptions.content\r\n            };\r\n            toast.timeoutDelay = _.isNumber(toastOptions.timeoutDelay)\r\n                ? toastOptions.timeoutDelay\r\n                : this.defaultTimeoutForType(toastOptions.type);\r\n            this.toasts.push(toast);\r\n            if (VizPortal.FeatureFlags.reactToasts) {\r\n                this.notifyListeners();\r\n            }\r\n            return toast.id;\r\n        };\r\n        ToasterService.prototype.defaultTimeoutForType = function (toastType) {\r\n            return toastType === ToastType.Info ? ToasterService.DefaultTimeOutForInfo : ToasterService.DefaultTimeOutForError;\r\n        };\r\n        ToasterService.prototype.notifyListeners = function () {\r\n            var _this = this;\r\n            _.each(this.listeners, function (l) { return l.toastsUpdated(_this.toasts); });\r\n        };\r\n        ToasterService.prototype.close = function (id) {\r\n            var _this = this;\r\n            if (VizPortal.FeatureFlags.reactToasts) {\r\n                this.toasts = _.filter(this.toasts, function (t) { return t.id !== id; });\r\n                this.notifyListeners();\r\n            }\r\n            else {\r\n                _.find(this.toasts, function (toast, index) {\r\n                    if (toast.id === id) {\r\n                        _this.toasts.splice(index, 1);\r\n                        _this.$interval.cancel(toast.timeout);\r\n                        toast.isClosed = true;\r\n                        return true;\r\n                    }\r\n                    return false;\r\n                });\r\n            }\r\n        };\r\n        ToasterService.prototype.isClosed = function (id) {\r\n            _.each(this.toasts, function (t) {\r\n                if (t.id === id) {\r\n                    return false;\r\n                }\r\n            });\r\n            return true;\r\n        };\r\n        ToasterService.prototype.addListener = function (listener) {\r\n            var listenerId = this.nextListenerId++;\r\n            listener.id = listenerId;\r\n            this.listeners.push(listener);\r\n            return listenerId;\r\n        };\r\n        ToasterService.prototype.removeListener = function (id) {\r\n            this.listeners = _.filter(this.listeners, function (listener) { return listener.id !== id; });\r\n        };\r\n        ToasterService.NoTimeout = 0;\r\n        ToasterService.DefaultTimeOutForInfo = 10 * 1000; // 10 seconds\r\n        ToasterService.DefaultTimeOutForError = ToasterService.NoTimeout;\r\n        ToasterService.$inject = ['$interval'];\r\n        return ToasterService;\r\n    })();\r\n    VizPortal.ToasterService = ToasterService;\r\n    VizPortal.Module.instance().service('ToasterService', ToasterService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/ClientCertificateLoginRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GeneratePublicKeyRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetServerSettingsUnauthenticatedRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetSessionInfoRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/InitializeServerWithActiveDirectoryUserRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/InitializeServerWithExternalUserRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/InitializeServerWithLocalUserRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/kerberosLoginRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/LoginRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/LogoutRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/SspiLoginRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/SwitchSiteRequest.ts\" />\r\n/// <reference path=\"../ServerApi/types/IRequest.ts\" />\r\n/// <reference path=\"../ServerApi/types/IResponse.ts\" />\r\n/// <reference path=\"../ServerApi/types/IPodRedirectionError.ts\" />\r\n/// <reference path=\"../ServerApi/types/IServer.ts\" />\r\n/// <reference path=\"../ServerApi/types/ISiteRole.ts\" />\r\n/// <reference path=\"../services/ToasterService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().constant('ApiPrefix', 'vizportal/api/web/v1/');\r\n    VizPortal.Module.instance().constant('RestApiPrefix', 'vizportal/api/rest/v1/');\r\n    var SessionState;\r\n    (function (SessionState) {\r\n        SessionState[SessionState[\"Exists\"] = 0] = \"Exists\";\r\n        SessionState[SessionState[\"NoSession\"] = 1] = \"NoSession\";\r\n        SessionState[SessionState[\"Unknown\"] = 2] = \"Unknown\";\r\n    })(SessionState || (SessionState = {}));\r\n    // Start at 7-digit numbers so these don't collide with server error codes\r\n    (function (ErrorReason) {\r\n        ErrorReason[ErrorReason[\"Canceled\"] = 1000001] = \"Canceled\";\r\n        ErrorReason[ErrorReason[\"ResourceNotFound\"] = 1000002] = \"ResourceNotFound\";\r\n        ErrorReason[ErrorReason[\"Unauthorized\"] = 1000003] = \"Unauthorized\";\r\n        ErrorReason[ErrorReason[\"Unknown\"] = 1000004] = \"Unknown\";\r\n    })(VizPortal.ErrorReason || (VizPortal.ErrorReason = {}));\r\n    var ErrorReason = VizPortal.ErrorReason;\r\n    (function (AuthLevel) {\r\n        AuthLevel[AuthLevel[\"Anonymous\"] = 0] = \"Anonymous\";\r\n        AuthLevel[AuthLevel[\"Authenticated\"] = 1] = \"Authenticated\";\r\n        AuthLevel[AuthLevel[\"SiteAdmin\"] = 2] = \"SiteAdmin\";\r\n        AuthLevel[AuthLevel[\"SelfOrAdmin\"] = 3] = \"SelfOrAdmin\";\r\n        AuthLevel[AuthLevel[\"SelfOrServerAdmin\"] = 4] = \"SelfOrServerAdmin\";\r\n        AuthLevel[AuthLevel[\"ServerAdmin\"] = 5] = \"ServerAdmin\";\r\n    })(VizPortal.AuthLevel || (VizPortal.AuthLevel = {}));\r\n    var AuthLevel = VizPortal.AuthLevel;\r\n    VizPortal.MaxRequestArrayLength = 1000;\r\n    var ServerService = (function () {\r\n        function ServerService($http, $location, $q, $state, $stateParams, $translate, $cookies, apiPrefix, restApiPrefix, toaster, windowLocation, stateWrapperService) {\r\n            this.$http = $http;\r\n            this.$location = $location;\r\n            this.$q = $q;\r\n            this.$state = $state;\r\n            this.$stateParams = $stateParams;\r\n            this.$translate = $translate;\r\n            this.$cookies = $cookies;\r\n            this.apiPrefix = apiPrefix;\r\n            this.restApiPrefix = restApiPrefix;\r\n            this.toaster = toaster;\r\n            this.windowLocation = windowLocation;\r\n            this.stateWrapperService = stateWrapperService;\r\n            this.sessionState = SessionState.Unknown;\r\n            this.numSessionInfoRequests = 0;\r\n            this.sessionInfoPromise = null;\r\n            this.caseInsensitiveSiteUrlNames = new VizPortal.Set(function (siteUrlName) { return siteUrlName.toLowerCase(); });\r\n        }\r\n        ServerService.prototype.getSessionInfoPromise = function () {\r\n            return this.sessionInfoPromise ? this.sessionInfoPromise : this.$q.when();\r\n        };\r\n        /**\r\n         * Make a server request. If there is a request pending that might change the session,\r\n         * wait until that request is finished before sending this one.\r\n         */\r\n        ServerService.prototype.sendRequest = function (request) {\r\n            var _this = this;\r\n            // Wait until any pending session info request is resolved before attempting the request\r\n            if (this.numSessionInfoRequests > 0) {\r\n                return this.sessionInfoPromise.then(function () { return _this.requestPost(request); });\r\n            }\r\n            return this.requestPost(request);\r\n        };\r\n        /**\r\n         * Send a series of requests of the same type.\r\n         * The results are combined using the given function.\r\n         * If any request results in a broken promise,\r\n         * then this method returns that broken promise.\r\n         */\r\n        ServerService.prototype.sendRequests = function (requests, combineResults) {\r\n            var _this = this;\r\n            var sendNextRequest = function (index, results) {\r\n                return _this.sendRequest(requests[index]).then(function (result) {\r\n                    results[index] = result;\r\n                    var nextIndex = index + 1;\r\n                    if (nextIndex < requests.length) {\r\n                        return sendNextRequest(nextIndex, results);\r\n                    }\r\n                    else {\r\n                        return combineResults(results);\r\n                    }\r\n                });\r\n            };\r\n            return sendNextRequest(0, []);\r\n        };\r\n        /**\r\n         * Like sendRequests, but sends the requests in parallel.\r\n         */\r\n        ServerService.prototype.sendRequestsParallel = function (requests, combineResults) {\r\n            var _this = this;\r\n            var results = requests.map(function (request) {\r\n                return _this.sendRequest(request);\r\n            });\r\n            return this.$q.all(results).then(function (results) {\r\n                return combineResults(results);\r\n            });\r\n        };\r\n        ServerService.prototype.login = function (username, password, siteUrlName) {\r\n            var _this = this;\r\n            return this.sessionInfoRequest(function () {\r\n                return _this.requestPost(new VizPortal.ServerApi.GeneratePublicKeyRequest())\r\n                    .then(function (generatePublicKeyResult) {\r\n                    var loginParams = {\r\n                        username: username,\r\n                        encryptedPassword: rsa.encrypt(password, generatePublicKeyResult.key),\r\n                        keyId: generatePublicKeyResult.keyId\r\n                    };\r\n                    if (_.isString(siteUrlName)) {\r\n                        loginParams.siteUrlName = siteUrlName;\r\n                    }\r\n                    var loginRequest = new VizPortal.ServerApi.LoginRequest(loginParams);\r\n                    return _this.requestPost(loginRequest)\r\n                        .then(function (loginResult) {\r\n                        if (loginResult.errors) {\r\n                            return _this.$q.reject(loginResult.errors[0]);\r\n                        }\r\n                        return _this.setSessionInfo(loginResult);\r\n                    });\r\n                });\r\n            });\r\n        };\r\n        ServerService.prototype.autoLogin = function (siteUrlName) {\r\n            var _this = this;\r\n            return this.sessionInfoRequest(function () {\r\n                var loginParams = {};\r\n                if (_.isString(siteUrlName)) {\r\n                    loginParams.siteUrlName = siteUrlName;\r\n                }\r\n                var authType = _this.authenticationType();\r\n                var loginRequest;\r\n                switch (authType) {\r\n                    case VizPortal.ServerApi.AuthenticationType.Sspi:\r\n                        loginRequest = new VizPortal.ServerApi.SspiLoginRequest(loginParams);\r\n                        break;\r\n                    case VizPortal.ServerApi.AuthenticationType.Kerberos:\r\n                        loginRequest = new VizPortal.ServerApi.KerberosLoginRequest(loginParams);\r\n                        break;\r\n                    case VizPortal.ServerApi.AuthenticationType.ClientCertificate:\r\n                    case VizPortal.ServerApi.AuthenticationType.ClientCertificateWithFallback:\r\n                        loginRequest = new VizPortal.ServerApi.ClientCertificateLoginRequest(loginParams);\r\n                        break;\r\n                }\r\n                // This must be GET to get around an IE \"feature\". See B144390\r\n                return _this.requestGet(loginRequest)\r\n                    .then(function (sessionInfo) {\r\n                    if (sessionInfo.errors) {\r\n                        return _this.$q.reject(sessionInfo.errors[0] && sessionInfo.errors[0].code);\r\n                    }\r\n                    return _this.setSessionInfo(sessionInfo);\r\n                }, function (reason) {\r\n                    _this.clearSessionInfo();\r\n                    if (reason === ErrorReason.Unauthorized || reason === ErrorReason.Unknown) {\r\n                        switch (authType) {\r\n                            case VizPortal.ServerApi.AuthenticationType.Sspi:\r\n                                reason = VizPortal.LoginErrorCodes.SspiFailed;\r\n                                break;\r\n                            case VizPortal.ServerApi.AuthenticationType.Kerberos:\r\n                                reason = VizPortal.LoginErrorCodes.KerberosFailed;\r\n                                break;\r\n                            case VizPortal.ServerApi.AuthenticationType.ClientCertificate:\r\n                            case VizPortal.ServerApi.AuthenticationType.ClientCertificateWithFallback:\r\n                                reason = VizPortal.LoginErrorCodes.ClientCertificateNotFound;\r\n                                break;\r\n                        }\r\n                    }\r\n                    return _this.$q.reject(reason);\r\n                });\r\n            });\r\n        };\r\n        ServerService.prototype.initialize = function (username, password, displayName) {\r\n            var _this = this;\r\n            return this.sessionInfoRequest(function () {\r\n                return _this.requestPost(new VizPortal.ServerApi.GeneratePublicKeyRequest())\r\n                    .then(function (generatePublicKeyResult) {\r\n                    var encryptedPassword = rsa.encrypt(password, generatePublicKeyResult.key);\r\n                    var initializeRequest;\r\n                    if (_this.isServerDomainFamilyActiveDirectory()) {\r\n                        initializeRequest = new VizPortal.ServerApi.InitializeServerWithActiveDirectoryUserRequest({\r\n                            username: username,\r\n                            encryptedPassword: encryptedPassword,\r\n                            keyId: generatePublicKeyResult.keyId\r\n                        });\r\n                    }\r\n                    else if (_this.isServerDomainFamilyLocal()) {\r\n                        initializeRequest = new VizPortal.ServerApi.InitializeServerWithLocalUserRequest({\r\n                            username: username,\r\n                            encryptedPassword: encryptedPassword,\r\n                            keyId: generatePublicKeyResult.keyId,\r\n                            displayName: displayName\r\n                        });\r\n                    }\r\n                    else if (_this.isServerDomainFamilyExternal()) {\r\n                        initializeRequest = new VizPortal.ServerApi.InitializeServerWithExternalUserRequest({\r\n                            username: username,\r\n                            encryptedPassword: encryptedPassword,\r\n                            keyId: generatePublicKeyResult.keyId\r\n                        });\r\n                    }\r\n                    else {\r\n                        throw new Error('Unknown domain family type. Current implementation only supports: AD, local, and external.');\r\n                    }\r\n                    return _this.requestPost(initializeRequest)\r\n                        .then(function (initializeResult) {\r\n                        if (initializeResult.errors) {\r\n                            return _this.$q.reject(initializeResult.errors[0] && initializeResult.errors[0].code);\r\n                        }\r\n                        return _this.setSessionInfo(initializeResult);\r\n                    });\r\n                });\r\n            });\r\n        };\r\n        /**\r\n         * Returned promise will be fulfilled. All rejections are handled.\r\n         * If there is an error, the code will be returned in the fulfilled handler.\r\n         */\r\n        ServerService.prototype.refreshSessionInfo = function () {\r\n            var _this = this;\r\n            return this.sessionInfoRequest(function () {\r\n                return _this.requestPost(new VizPortal.ServerApi.GetSessionInfoRequest())\r\n                    .then(function (result) {\r\n                    if (result.errors) {\r\n                        _this.sessionState = SessionState.NoSession;\r\n                        return result.errors[0] && result.errors[0].code;\r\n                    }\r\n                    else {\r\n                        return _this.setSessionInfo(result);\r\n                    }\r\n                })\r\n                    .fail(function (reason) {\r\n                    _this.clearSessionInfo();\r\n                    return reason;\r\n                });\r\n            });\r\n        };\r\n        ServerService.prototype.refreshServerSettings = function () {\r\n            var _this = this;\r\n            return this.requestPost(new VizPortal.ServerApi.GetServerSettingsUnauthenticatedRequest())\r\n                .then(function (result) {\r\n                _this.serverSettings = result;\r\n            });\r\n        };\r\n        ServerService.prototype.overrideAuthenticationType = function (authType) {\r\n            this.authenticationTypeOverride = authType;\r\n        };\r\n        /**\r\n         * Loads all state needed to render the app\r\n         * Returns a promise that fulfills with a code indicating bootstrap state\r\n         */\r\n        ServerService.prototype.bootstrapSession = function () {\r\n            var _this = this;\r\n            var sessionInfoNoSessionReason = null;\r\n            return this.$q.all([\r\n                this.refreshServerSettings(),\r\n                this.refreshSessionInfo()\r\n            ]).then(function (results) {\r\n                sessionInfoNoSessionReason = results[1];\r\n                // Now that we have server settings and session info we can determine the language to display\r\n                return _this.updateLanguageAndLocale();\r\n            }).then(function () {\r\n                return _this.$q.when(sessionInfoNoSessionReason);\r\n            });\r\n        };\r\n        /**\r\n         * This won't handle errors. Use SiteSwitchService.switchIfNeeded\r\n         * to get the proper error feedback\r\n         */\r\n        ServerService.prototype.switchSiteIfNeeded = function (urlName, podRedirectPath) {\r\n            var _this = this;\r\n            return this.sessionInfoRequest(function () {\r\n                // falsy values should be empty string for default site\r\n                urlName = urlName || '';\r\n                if (!_this.isCurrentSiteUrlName(urlName)) {\r\n                    return _this.requestPost(new VizPortal.ServerApi.SwitchSiteRequest({ urlName: urlName }))\r\n                        .then(function (sessionInfo) {\r\n                        if (sessionInfo && sessionInfo.errors) {\r\n                            var error = sessionInfo.errors[0];\r\n                            if (error && error.code === VizPortal.SiteSwitchErrorCodes.AttemptedToSwitchSiteToCurrentSite) {\r\n                                // No-op, do nothing\r\n                                // Remember that this particular site url name is case insensitive\r\n                                _this.caseInsensitiveSiteUrlNames.add(urlName);\r\n                                return;\r\n                            }\r\n                            return _this.$q.reject(error);\r\n                        }\r\n                        _this.setSessionInfo(sessionInfo);\r\n                    }, function (error) {\r\n                        if (error && error.code === VizPortal.CommonErrorCode.RedirectToOtherPod) {\r\n                            _this.redirectToOtherPod(error, podRedirectPath);\r\n                            // If redirected, defer indefinitely, to prevent further execution here\r\n                            return _this.$q.defer().promise;\r\n                        }\r\n                    });\r\n                }\r\n                return _this.$q.when(null);\r\n            });\r\n        };\r\n        ServerService.prototype.redirectToOtherPod = function (error, destinationPodPath) {\r\n            var destinationPodUrl = this.getDestinationPodFromError(error);\r\n            var dest = destinationPodUrl + destinationPodPath;\r\n            this.windowLocation.navigateToWithoutAddingToHistory(dest);\r\n        };\r\n        ServerService.prototype.isCurrentSiteUrlName = function (urlName) {\r\n            if (this.caseInsensitiveSiteUrlNames.contains(urlName)) {\r\n                return this.sessionSiteUrlName().toLowerCase() === urlName.toLowerCase();\r\n            }\r\n            return this.sessionSiteUrlName() === urlName;\r\n        };\r\n        ServerService.prototype.isUserAuthorized = function (role) {\r\n            switch (role) {\r\n                case AuthLevel.Anonymous:\r\n                default:\r\n                    return true;\r\n                case AuthLevel.Authenticated:\r\n                    return this.inSession();\r\n                case AuthLevel.SiteAdmin:\r\n                    return this.isSessionSiteOrServerAdmin();\r\n                case AuthLevel.SelfOrAdmin:\r\n                    // for the user place page, return true if an admin or the URL contains the\r\n                    // username and domainName of the session user\r\n                    return this.isSessionSiteOrServerAdmin() || this.isSessionUserSelf();\r\n                case AuthLevel.SelfOrServerAdmin:\r\n                    // for the user place page, return true if a server admin or the URL contains the\r\n                    // username and domainName of the session user\r\n                    return this.isSessionServerAdmin() || this.isSessionUserSelf();\r\n                case AuthLevel.ServerAdmin:\r\n                    return this.isSessionServerAdmin();\r\n            }\r\n        };\r\n        ServerService.prototype.signOut = function () {\r\n            var _this = this;\r\n            this.requestPost(new VizPortal.ServerApi.LogoutRequest())\r\n                .then(function (logoutResult) {\r\n                // This causes all scripts to reload, so all client side app state will be cleared.\r\n                _this.windowLocation.navigateTo(logoutResult.redirectUrl || '/');\r\n            });\r\n        };\r\n        ServerService.prototype.sessionStateString = function () {\r\n            return SessionState[this.sessionState];\r\n        };\r\n        ServerService.prototype.sessionUserInfo = function () {\r\n            return this.sessionInfo && this.sessionInfo.user;\r\n        };\r\n        ServerService.prototype.isSessionRestrictedTrustedTicket = function () {\r\n            return this.sessionInfo && this.sessionInfo.isRestrictedTrustedTicketSession;\r\n        };\r\n        ServerService.prototype.sessionUserDisplayName = function () {\r\n            return this.sessionInfo && this.sessionInfo.user && this.sessionInfo.user.displayName || '';\r\n        };\r\n        ServerService.prototype.sessionUserId = function () {\r\n            return this.sessionInfo && this.sessionInfo.user && this.sessionInfo.user.id;\r\n        };\r\n        ServerService.prototype.sessionAuthUserId = function () {\r\n            return this.sessionInfo && this.sessionInfo.user && this.sessionInfo.user.authId;\r\n        };\r\n        ServerService.prototype.sessionSiteLuid = function () {\r\n            return this.sessionInfo && this.sessionInfo.site && this.sessionInfo.site.luid;\r\n        };\r\n        ServerService.prototype.sessionUsername = function () {\r\n            return this.sessionInfo && this.sessionInfo.user && this.sessionInfo.user.username;\r\n        };\r\n        ServerService.prototype.sessionUserDomainName = function () {\r\n            return this.sessionInfo && this.sessionInfo.user && this.sessionInfo.user.domainName;\r\n        };\r\n        ServerService.prototype.inSession = function () {\r\n            return !!this.sessionInfo;\r\n        };\r\n        // for the user place page, retu\r\n        ServerService.prototype.isSessionUserEqualTo = function (username, domainName) {\r\n            return this.sessionInfo && this.sessionInfo.user\r\n                && this.sessionInfo.user.username === username\r\n                && this.sessionInfo.user.domainName === domainName;\r\n        };\r\n        ServerService.prototype.isSessionUserSelf = function () {\r\n            return this.isSessionUserEqualTo(this.$stateParams['username'], this.$stateParams['domainName']);\r\n        };\r\n        ServerService.prototype.isSessionServerAdmin = function () {\r\n            return this.sessionInfo && this.sessionInfo.user && this.sessionInfo.user.serverAdmin;\r\n        };\r\n        ServerService.prototype.isSessionSiteAdmin = function () {\r\n            return this.sessionInfo && this.sessionInfo.site.role === VizPortal.ServerApi.SiteRoles.SiteAdministrator;\r\n        };\r\n        ServerService.prototype.isSessionSiteOrServerAdmin = function () {\r\n            return this.isSessionServerAdmin() || this.isSessionSiteAdmin();\r\n        };\r\n        ServerService.prototype.sessionSiteId = function () {\r\n            return this.sessionInfo ? this.sessionInfo.site.id : '';\r\n        };\r\n        ServerService.prototype.sessionServerId = function () {\r\n            return this.sessionInfo ? this.sessionInfo.server.logicalServerInstanceId : '';\r\n        };\r\n        ServerService.prototype.sessionSite = function () {\r\n            return this.sessionInfo && this.sessionInfo.site;\r\n        };\r\n        ServerService.prototype.sessionSiteUrlName = function () {\r\n            return (this.sessionInfo && this.sessionInfo.site.urlName) || '';\r\n        };\r\n        ServerService.prototype.sessionSiteName = function () {\r\n            return this.sessionInfo ? this.sessionInfo.site.name : '';\r\n        };\r\n        ServerService.prototype.sessionServerVersion = function () {\r\n            return this.sessionInfo ? this.sessionInfo.server.version : null;\r\n        };\r\n        ServerService.prototype.thirdPartyAuthState = function () {\r\n            return (this.sessionInfo && this.sessionInfo.site.thirdPartyAuthState)\r\n                || { allowed: false, enabled: false, serverEnabled: false, hasThirdPartyAuthenticatedUsers: false };\r\n        };\r\n        ServerService.prototype.isThirdPartyAuthAllowed = function () {\r\n            return this.thirdPartyAuthState().allowed;\r\n        };\r\n        ServerService.prototype.isThirdPartyAuthConfiguredForServer = function () {\r\n            return this.thirdPartyAuthState().serverEnabled;\r\n        };\r\n        ServerService.prototype.isThirdPartyAuthEnabled = function () {\r\n            return this.thirdPartyAuthState().enabled;\r\n        };\r\n        ServerService.prototype.isThirdPartyAuthEditable = function () {\r\n            // third party auth settings are editable when\r\n            // * 3rd party auth is enabled\r\n            // * or any user on the site is set to use 3rd party auth\r\n            return this.thirdPartyAuthState().enabled || this.thirdPartyAuthState().hasThirdPartyAuthenticatedUsers;\r\n        };\r\n        ServerService.prototype.sessionSupportHost = function () {\r\n            return this.sessionInfo && this.sessionInfo.server.supportHost;\r\n        };\r\n        ServerService.prototype.sessionSupportPath = function () {\r\n            return this.sessionInfo && this.sessionInfo.server.supportPath;\r\n        };\r\n        ServerService.prototype.isSessionStateUnknown = function () {\r\n            return this.sessionState === SessionState.Unknown;\r\n        };\r\n        ServerService.prototype.isSessionMultiSite = function () {\r\n            return this.sessionInfo && this.sessionInfo.user && this.sessionInfo.user.numberOfSites > 1;\r\n        };\r\n        ServerService.prototype.isLogoutEnabled = function () {\r\n            return this.sessionInfo && this.sessionInfo.site && this.sessionInfo.site.logoutEnabled;\r\n        };\r\n        ServerService.prototype.isLiveDBAvailable = function () {\r\n            return this.sessionInfo && this.sessionInfo.site && this.sessionInfo.site.liveDBAvailable;\r\n        };\r\n        ServerService.prototype.siteLogo = function () {\r\n            return this.sessionInfo && this.sessionInfo.site && this.sessionInfo.site.customization;\r\n        };\r\n        ServerService.prototype.isSiteCustomizationEnabled = function () {\r\n            return this.sessionInfo && this.sessionInfo.server && this.sessionInfo.server.siteCustomizationEnabled;\r\n        };\r\n        ServerService.prototype.isTabAdminServiceEnabled = function () {\r\n            return this.sessionInfo && this.sessionInfo.server && this.sessionInfo.server.tabAdminServiceEnabled;\r\n        };\r\n        ServerService.prototype.isSiteAdminSettingsEnabled = function () {\r\n            return this.sessionInfo && this.sessionInfo.server && this.sessionInfo.server.siteAdminSettingsEnabled;\r\n        };\r\n        ServerService.prototype.waitForSession = function () {\r\n            return (this.numSessionInfoRequests > 0) ? this.sessionInfoPromise : this.$q.when();\r\n        };\r\n        ServerService.prototype.sessionLanguage = function () {\r\n            return this.sessionInfo && this.sessionInfo.user && this.sessionInfo.user.language;\r\n        };\r\n        ServerService.prototype.sessionLocale = function () {\r\n            return this.sessionInfo && this.sessionInfo.user && this.sessionInfo.user.locale;\r\n        };\r\n        ServerService.prototype.updateDisplayNameAllowed = function () {\r\n            return this.sessionInfo && this.sessionInfo.server && this.sessionInfo.server.updateDisplayNameAllowed;\r\n        };\r\n        ServerService.prototype.defaultSubscriptionsEmail = function () {\r\n            return this.sessionInfo && this.sessionInfo.server && this.sessionInfo.server.defaultSubscriptionsEmail;\r\n        };\r\n        ServerService.prototype.featureFlags = function () {\r\n            return this.sessionInfo && this.sessionInfo.server && this.sessionInfo.server.featureFlags;\r\n        };\r\n        ServerService.prototype.changePasswordUrl = function () {\r\n            return this.sessionInfo && this.sessionInfo.server && this.sessionInfo.server.changePasswordUrl;\r\n        };\r\n        ServerService.prototype.datasourceHelpUrl = function () {\r\n            return this.sessionInfo && this.sessionInfo.server && this.sessionInfo.server.datasourceHelpUrl;\r\n        };\r\n        ServerService.prototype.offlineHelpEnabled = function () {\r\n            return this.sessionInfo && this.sessionInfo.server && this.sessionInfo.server.offlineHelpEnabled;\r\n        };\r\n        ServerService.prototype.helpEdition = function () {\r\n            return this.sessionInfo && this.sessionInfo.server && this.sessionInfo.server.helpEdition;\r\n        };\r\n        ServerService.prototype.oauthGoogleEnabled = function () {\r\n            return this.sessionInfo && this.sessionInfo.server && this.sessionInfo.server.oauthGoogleEnabled;\r\n        };\r\n        ServerService.prototype.oauthSalesforceEnabled = function () {\r\n            return this.sessionInfo && this.sessionInfo.server && this.sessionInfo.server.oauthSalesforceEnabled;\r\n        };\r\n        ServerService.prototype.rebuildingSearchIndex = function () {\r\n            return this.sessionInfo && this.sessionInfo.server && this.sessionInfo.server.rebuildingSearchIndex;\r\n        };\r\n        ServerService.prototype.canSessionUserManageUsers = function () {\r\n            return this.sessionInfo && this.sessionInfo.user && this.sessionInfo.user.canManageUsers;\r\n        };\r\n        ServerService.prototype.domainFamily = function () {\r\n            return this.serverSettings && this.serverSettings.domainFamily;\r\n        };\r\n        ServerService.prototype.isServerDomainFamilyActiveDirectory = function () {\r\n            return this.serverSettings && this.serverSettings.domainFamily === VizPortal.ServerApi.DomainFamily.ActiveDirectory;\r\n        };\r\n        ServerService.prototype.isServerDomainFamilyLocal = function () {\r\n            return this.serverSettings && this.serverSettings.domainFamily === VizPortal.ServerApi.DomainFamily.Local;\r\n        };\r\n        ServerService.prototype.isServerDomainFamilyExternal = function () {\r\n            return this.serverSettings && this.serverSettings.domainFamily === VizPortal.ServerApi.DomainFamily.External;\r\n        };\r\n        ServerService.prototype.getStartPage = function () {\r\n            return this.sessionInfo && this.sessionInfo.user && this.sessionInfo.user.startPage || '/';\r\n        };\r\n        ServerService.prototype.sessionUserDisplayMode = function () {\r\n            return this.sessionInfo && this.sessionInfo.user && this.sessionInfo.user.displayMode;\r\n        };\r\n        ServerService.prototype.isAlertFailureCountEnabled = function () {\r\n            return this.sessionInfo.server.alertFailureCountEnabled;\r\n        };\r\n        // Server Settings\r\n        ServerService.prototype.authenticationType = function () {\r\n            return this.authenticationTypeOverride || this.serverSettings && this.serverSettings.authenticationType && this.serverSettings.authenticationType.type;\r\n        };\r\n        ServerService.prototype.licenseExpirationDateIfWithinWarningPeriod = function () {\r\n            return this.serverSettings && this.serverSettings.licenseExpirationDate;\r\n        };\r\n        ServerService.prototype.serverCustomization = function () {\r\n            return this.serverSettings && this.serverSettings.customization;\r\n        };\r\n        ServerService.prototype.serverName = function () {\r\n            var customization = this.serverCustomization();\r\n            return customization && customization.serverName || this.$translate.instant(VizPortal.L10n.Keys.title);\r\n        };\r\n        ServerService.prototype.serverLanguage = function () {\r\n            return this.serverSettings && this.serverSettings.defaultLanguage;\r\n        };\r\n        ServerService.prototype.serverLocale = function () {\r\n            return this.serverSettings && this.serverSettings.defaultLocale;\r\n        };\r\n        ServerService.prototype.isGuestEnabled = function () {\r\n            return this.serverSettings && this.serverSettings.guestEnabled;\r\n        };\r\n        ServerService.prototype.preloginCustomization = function () {\r\n            return this.serverSettings && this.serverSettings.preloginCustomization;\r\n        };\r\n        /**\r\n         * Requests that could change the session must make the request through this method\r\n         */\r\n        ServerService.prototype.sessionInfoRequest = function (makeRequest) {\r\n            var _this = this;\r\n            if (this.numSessionInfoRequests > 0) {\r\n                // If existing session info request, make this request once it is completed.\r\n                this.sessionInfoPromise = this.sessionInfoPromise.then(makeRequest);\r\n            }\r\n            else {\r\n                this.sessionInfoPromise = makeRequest();\r\n            }\r\n            this.numSessionInfoRequests++;\r\n            this.sessionInfoPromise.fin(function () {\r\n                _this.numSessionInfoRequests--;\r\n            });\r\n            return this.sessionInfoPromise;\r\n        };\r\n        ServerService.prototype.getFirstErrorFromResponse = function (response) {\r\n            return response && response.data && response.data.result &&\r\n                response.data.result.errors && response.data.result.errors[0];\r\n        };\r\n        ServerService.prototype.getCodeFromError = function (error) {\r\n            return error && error.code;\r\n        };\r\n        ServerService.prototype.getDestinationPodFromError = function (error) {\r\n            var podRedirectionError = error;\r\n            return podRedirectionError && podRedirectionError.destinationPodUrl;\r\n        };\r\n        ServerService.prototype.request = function (requestConfig) {\r\n            var _this = this;\r\n            return this.$http(requestConfig)\r\n                .then(function (successResponse) {\r\n                var error = _this.getFirstErrorFromResponse(successResponse);\r\n                var code = _this.getCodeFromError(error);\r\n                if (_this.maybeHandleSearchServerDown(code)) {\r\n                    return _this.$q.reject(code);\r\n                }\r\n                var location = _this.getDestinationPodFromError(error);\r\n                if (_this.maybeHandleRedirectionToOtherPod(code, location)) {\r\n                    return _this.$q.reject(error);\r\n                }\r\n                return successResponse.data && !_.isUndefined(successResponse.data.result)\r\n                    ? successResponse.data.result\r\n                    : null;\r\n            }, function (errorResponse) {\r\n                var reason = _this.getCodeFromError(_this.getFirstErrorFromResponse(errorResponse));\r\n                if (errorResponse.status === 401) {\r\n                    _this.handle401(reason);\r\n                }\r\n                return _this.$q.reject(reason || ErrorReason.Unknown);\r\n            });\r\n        };\r\n        ServerService.prototype.requestGet = function (request) {\r\n            var queryParams = '';\r\n            if (request.params) {\r\n                var requestParamsAsQueryParams = $.param(request.params);\r\n                if (requestParamsAsQueryParams) {\r\n                    queryParams = '?' + requestParamsAsQueryParams;\r\n                }\r\n            }\r\n            return this.request({\r\n                method: 'GET',\r\n                url: this.apiPrefix + request.method + queryParams\r\n            });\r\n        };\r\n        ServerService.prototype.requestPost = function (request) {\r\n            return this.request({\r\n                method: 'POST',\r\n                url: this.apiPrefix + request.method,\r\n                data: request\r\n            });\r\n        };\r\n        ServerService.prototype.requestPostFormDataToRestApi = function (formData, method) {\r\n            return this.request({\r\n                method: 'POST',\r\n                // Do not serialize into JSON (which is Angular's default) so we can send binary data\r\n                transformRequest: function (data) { return data; },\r\n                // Allow browser to choose Content-Type to get boundry needed for binary data\r\n                // see: https://groups.google.com/d/msg/angular/MBf8qvBpuVE/krmd75giKJUJ\r\n                headers: { 'Content-Type': undefined },\r\n                url: this.restApiPrefix + method,\r\n                data: formData\r\n            });\r\n        };\r\n        ServerService.prototype.handle401 = function (reason) {\r\n            // If we are not in a state (i.e. app has not bootstrapped) or if we are in an anonymous state\r\n            if (!this.$state.current.name || this.$state.current.data.authLevel === AuthLevel.Anonymous) {\r\n                return;\r\n            }\r\n            if (this.isAuthenticationAutoLogin() || this.isAuthenticationExternal()) {\r\n                // For these auth types we can't give an error message that the user's session expired\r\n                // so just refresh the page and let vizportal re-bootstrap and re-authenticate\r\n                this.windowLocation.reload();\r\n            }\r\n            else {\r\n                // For other auth types we can give a \"session expired\" error message, so do that\r\n                var href = this.$state.href('login.authenticate', {\r\n                    redirect: this.$location.url() || null,\r\n                    error: reason || VizPortal.CommonErrorCode.InvalidSession\r\n                });\r\n                // We must remove the hash so the browser does a full page load. The /signin route is a special\r\n                // route that apache will rewrite to /#/signin with query params intact\r\n                this.windowLocation.navigateTo(href.replace(/^#/, ''));\r\n            }\r\n        };\r\n        ServerService.prototype.maybeHandleSearchServerDown = function (errorCode) {\r\n            if (errorCode && errorCode === VizPortal.SolrErrorCode.SolrCommunicationError || errorCode === VizPortal.SolrErrorCode.SolrDisabled) {\r\n                if (!this.isUserAuthorized(AuthLevel.ServerAdmin)) {\r\n                    this.$state.go('login.error.errorCode', { errorCode: errorCode });\r\n                }\r\n                else if (!this.$state.is('main.server.status')) {\r\n                    this.$state.go('main.error', {\r\n                        detailsLocKey: 'searchServerDown',\r\n                        redirectState: 'main.server.status',\r\n                        redirectLocKey: 'goToServerStatus'\r\n                    });\r\n                }\r\n                return true;\r\n            }\r\n            else {\r\n                return false;\r\n            }\r\n        };\r\n        ServerService.prototype.maybeHandleRedirectionToOtherPod = function (errorCode, destinationPodUrl) {\r\n            return errorCode && (errorCode === VizPortal.CommonErrorCode.RedirectToOtherPod) && (destinationPodUrl !== null);\r\n        };\r\n        ServerService.prototype.isAuthenticationAutoLogin = function () {\r\n            return this.isWindowsCredentialsAutoLogin() ||\r\n                this.authenticationType() === VizPortal.ServerApi.AuthenticationType.ClientCertificate ||\r\n                this.authenticationType() === VizPortal.ServerApi.AuthenticationType.ClientCertificateWithFallback;\r\n        };\r\n        ServerService.prototype.isWindowsCredentialsAutoLogin = function () {\r\n            return this.authenticationType() === VizPortal.ServerApi.AuthenticationType.Sspi ||\r\n                this.authenticationType() === VizPortal.ServerApi.AuthenticationType.Kerberos;\r\n        };\r\n        ServerService.prototype.isAuthenticationSaml = function () {\r\n            return this.authenticationType() === VizPortal.ServerApi.AuthenticationType.Saml;\r\n        };\r\n        ServerService.prototype.isAuthenticationOpenId = function () {\r\n            return this.authenticationType() === VizPortal.ServerApi.AuthenticationType.OpenId;\r\n        };\r\n        ServerService.prototype.isAuthenticationExternal = function () {\r\n            return this.isAuthenticationSaml() || this.isAuthenticationOpenId();\r\n        };\r\n        ServerService.prototype.getSessionIdleLimitSeconds = function () {\r\n            // TODO: remove the 5 minute default when the backend implements this. B144748\r\n            return this.sessionInfo && this.sessionInfo.server && this.sessionInfo.server.sessionIdleLimitSeconds || 5 * 60;\r\n        };\r\n        ServerService.prototype.setSessionInfo = function (newSessionInfo) {\r\n            var _this = this;\r\n            this.sessionInfo = newSessionInfo;\r\n            this.sessionState = SessionState.Exists;\r\n            FeatureFlagsHelper.overwriteFeatureFlagsFromServerFeatureFlags(newSessionInfo.server.featureFlags, VizPortal.FeatureFlags);\r\n            return this.updateLanguageAndLocale().then(function () {\r\n                _this.showOrHideRebuildingSearchIndexToast();\r\n            });\r\n        };\r\n        ServerService.prototype.clearSessionInfo = function () {\r\n            this.sessionState = SessionState.NoSession;\r\n            this.sessionInfo = null;\r\n        };\r\n        ServerService.prototype.showOrHideRebuildingSearchIndexToast = function () {\r\n            if (this.inSession() && VizPortal.L10n.language && this.rebuildingSearchIndex()) {\r\n                if (!this.rebuildingSearchIndexToast || this.rebuildingSearchIndexToast.isClosed) {\r\n                    this.toaster.pop({\r\n                        type: VizPortal.ToastType.Error,\r\n                        text: this.$translate.instant('rebuildingSearchIndexMessage')\r\n                    });\r\n                    this.rebuildingSearchIndexToast = this.toaster.toasts[this.toaster.toasts.length - 1];\r\n                }\r\n            }\r\n            else {\r\n                if (this.rebuildingSearchIndexToast) {\r\n                    this.toaster.close(this.rebuildingSearchIndexToast.id);\r\n                }\r\n            }\r\n        };\r\n        ServerService.prototype.updateLanguageAndLocale = function () {\r\n            var _this = this;\r\n            var oldLanguage = VizPortal.L10n.language;\r\n            var oldLocale = VizPortal.L10n.locale;\r\n            var newLanguage = this.sessionLanguage() || this.serverLanguage() || 'en';\r\n            var newLocale = this.sessionLocale() || this.serverLocale() || 'en_US';\r\n            var languagePromise = this.$q.when();\r\n            var localePromise = this.$q.when();\r\n            if (newLanguage !== oldLanguage) {\r\n                VizPortal.L10n.language = newLanguage;\r\n                languagePromise = this.$translate.use(newLanguage).then(function () {\r\n                    // If we update the language again before this request completes, ignore the result.\r\n                    if (VizPortal.L10n.language === newLanguage) {\r\n                        document.title = _this.serverName();\r\n                    }\r\n                });\r\n            }\r\n            if (newLocale !== oldLocale) {\r\n                VizPortal.L10n.locale = newLocale;\r\n                localePromise = this.$q.all([\r\n                    this.getSupplementalLocaleJson(),\r\n                    this.getLocaleJson(newLocale)\r\n                ]).then(function (results) {\r\n                    // If we update the locale again before this request completes, ignore the result.\r\n                    if (VizPortal.L10n.locale === newLocale) {\r\n                        VizPortal.L10n.loadLocaleJson(results[1]); // result of the second promise (locale-specific json)\r\n                        VizPortal.L10n.useLocale(newLocale);\r\n                    }\r\n                });\r\n            }\r\n            return this.$q.all([languagePromise, localePromise]);\r\n        };\r\n        ServerService.prototype.getSupplementalLocaleJson = function () {\r\n            if (!this.supplementalLocaleJsonPromise) {\r\n                this.supplementalLocaleJsonPromise = this.getLocaleJson('supplemental').then(function (data) {\r\n                    VizPortal.L10n.loadLocaleJson(data);\r\n                });\r\n            }\r\n            return this.supplementalLocaleJsonPromise;\r\n        };\r\n        ServerService.prototype.getLocaleJson = function (fileName) {\r\n            return this.$http.get('locales/' + fileName + '.json')\r\n                .then(function (response) {\r\n                return response.data;\r\n            });\r\n        };\r\n        ServerService.prototype.updateSiteLogo = function (file, resetToDefaultLogo) {\r\n            var formData = new FormData();\r\n            formData.append('updateSiteCustomLogoInput', file);\r\n            formData.append(VizPortal.CookieKeys.XsrfToken, this.$cookies[VizPortal.CookieKeys.XsrfToken]);\r\n            formData.append('useCustomLogo', !resetToDefaultLogo);\r\n            formData.append('useIframeResponse', false);\r\n            return this.requestPostFormDataToRestApi(formData, 'updateSiteLogo');\r\n        };\r\n        ServerService.$inject = [\r\n            '$http',\r\n            '$location',\r\n            '$q',\r\n            '$state',\r\n            '$stateParams',\r\n            '$translate',\r\n            '$cookies',\r\n            'ApiPrefix',\r\n            'RestApiPrefix',\r\n            'ToasterService',\r\n            'WindowLocationService',\r\n            'StateWrapperService'\r\n        ];\r\n        return ServerService;\r\n    })();\r\n    VizPortal.ServerService = ServerService;\r\n    VizPortal.Module.instance().service('ServerService', ServerService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/ContentFilters.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/UpdateDisplayModeRequest.ts\" />\r\n/// <reference path=\"../ServerApi/types/ISessionInfo.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DisplaySettingsService = (function () {\r\n        function DisplaySettingsService($location, ServerService, BrowserSupportService) {\r\n            this.$location = $location;\r\n            this.ServerService = ServerService;\r\n            this.BrowserSupportService = BrowserSupportService;\r\n            this.displayModeUpdatedFromSession = false;\r\n            this.displayModeUpdatedFromUrl = false;\r\n            this.displayMode = DisplaySettingsService.DefaultDisplayMode;\r\n            this.topBar = {\r\n                collapsed: false,\r\n                height: null\r\n            };\r\n            this.showFilterPanel = !BrowserSupportService.isTouch();\r\n        }\r\n        DisplaySettingsService.prototype.saveDisplayMode = function () {\r\n            this.ServerService.sendRequest(new VizPortal.ServerApi.UpdateDisplayModeRequest({ displayMode: this.displayMode }));\r\n            if (this.$location.search().mode) {\r\n                this.$location.search('mode', this.displayMode);\r\n            }\r\n        };\r\n        DisplaySettingsService.prototype.maybeUpdateDisplayModeFromSession = function () {\r\n            if (!this.displayModeUpdatedFromSession && !this.displayModeUpdatedFromUrl) {\r\n                this.displayModeUpdatedFromSession = true;\r\n                var displayMode = this.ServerService.sessionUserDisplayMode();\r\n                if (displayMode) {\r\n                    this.displayMode = displayMode;\r\n                }\r\n            }\r\n        };\r\n        DisplaySettingsService.prototype.updateDisplayModeFromUrl = function () {\r\n            this.displayMode = this.getDisplayModeFromUrl(this.displayMode);\r\n        };\r\n        DisplaySettingsService.prototype.getDisplayModeFromUrl = function (currentDisplayMode) {\r\n            var urlParams = this.$location.search();\r\n            var displayMode = urlParams.mode;\r\n            switch (displayMode) {\r\n                case VizPortal.ServerApi.DisplayModes.list:\r\n                case VizPortal.ServerApi.DisplayModes.thumbnail:\r\n                    this.displayModeUpdatedFromUrl = true;\r\n                    return displayMode;\r\n                default:\r\n                    this.displayModeUpdatedFromUrl = false;\r\n                    return currentDisplayMode;\r\n            }\r\n        };\r\n        DisplaySettingsService.prototype.updateShowFilterPanel = function () {\r\n            var _this = this;\r\n            // show filter panel if any filters are active\r\n            _.each(_.keys(this.$location.search()), function (key) {\r\n                if (_.has(VizPortal.ContentFiltersKeys, key)) {\r\n                    _this.showFilterPanel = true;\r\n                }\r\n            });\r\n        };\r\n        DisplaySettingsService.DefaultDisplayMode = VizPortal.ServerApi.DisplayModes.thumbnail;\r\n        DisplaySettingsService.$inject = [\r\n            '$location',\r\n            'ServerService',\r\n            'BrowserSupportService'\r\n        ];\r\n        return DisplaySettingsService;\r\n    })();\r\n    VizPortal.DisplaySettingsService = DisplaySettingsService;\r\n    VizPortal.Module.instance().service('DisplaySettingsService', DisplaySettingsService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../ts/libs.ts\" />\r\n/// <reference path=\"../ts/services/DisplaySettingsService.ts\" />\r\n/// <reference path=\"../ts/libs.ts\" />\r\n/// <reference path=\"../ts/libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.UrlParamKeys = {\r\n        SiteUrlName: 'siteUrlName',\r\n        IsFromSaml: ':isFromSaml',\r\n        ClosePopupWhenDone: 'closePopupWhenDone',\r\n        AuthenticationType: 'auth'\r\n    };\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var BrowserTitleService = (function () {\r\n        function BrowserTitleService($translate, ServerService) {\r\n            this.$translate = $translate;\r\n            this.ServerService = ServerService;\r\n        }\r\n        BrowserTitleService.prototype.setTitle = function (placeKey, object) {\r\n            document.title = this.getTitle(placeKey, object);\r\n        };\r\n        BrowserTitleService.prototype.getTitle = function (placeKey, object) {\r\n            var serverName = this.ServerService.serverName();\r\n            if (placeKey) {\r\n                var place = this.$translate.instant(placeKey);\r\n                if (object) {\r\n                    return this.$translate.instant('browserTitle_objectPlace', { OBJECT: object, PLACE: place, SERVER_NAME: serverName });\r\n                }\r\n                else {\r\n                    return this.$translate.instant('browserTitle_place', { PLACE: place, SERVER_NAME: serverName });\r\n                }\r\n            }\r\n            else {\r\n                return serverName;\r\n            }\r\n        };\r\n        BrowserTitleService.prototype.setVizTitle = function (viewName, workbookName) {\r\n            var serverName = this.ServerService.serverName();\r\n            document.title = this.$translate.instant('browserTitle_viz', { VIEW: viewName, WORKBOOK: workbookName, SERVER_NAME: serverName });\r\n        };\r\n        BrowserTitleService.$inject = [\r\n            '$translate',\r\n            'ServerService'\r\n        ];\r\n        return BrowserTitleService;\r\n    })();\r\n    VizPortal.BrowserTitleService = BrowserTitleService;\r\n    VizPortal.Module.instance().service('BrowserTitleService', BrowserTitleService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    // From workgroup\\java\\tab-model-workgroup\\src\\com\\tableausoftware\\domain\\content\\exceptions\\errorcodes\r\n    // CONSIDER: code-gen this file from the Java sources?\r\n    (function (CommonErrorCode) {\r\n        CommonErrorCode[CommonErrorCode[\"None\"] = 0] = \"None\";\r\n        CommonErrorCode[CommonErrorCode[\"CallingUserInsufficientPermissions\"] = 1] = \"CallingUserInsufficientPermissions\";\r\n        CommonErrorCode[CommonErrorCode[\"SiteUserNotFound\"] = 4] = \"SiteUserNotFound\";\r\n        CommonErrorCode[CommonErrorCode[\"SystemUserNotFound\"] = 5] = \"SystemUserNotFound\";\r\n        CommonErrorCode[CommonErrorCode[\"GroupNotFound\"] = 6] = \"GroupNotFound\";\r\n        CommonErrorCode[CommonErrorCode[\"WorkbookNotFound\"] = 7] = \"WorkbookNotFound\";\r\n        CommonErrorCode[CommonErrorCode[\"ViewNotFound\"] = 8] = \"ViewNotFound\";\r\n        CommonErrorCode[CommonErrorCode[\"ProjectNotFound\"] = 9] = \"ProjectNotFound\";\r\n        CommonErrorCode[CommonErrorCode[\"DataConnectionNotFound\"] = 10] = \"DataConnectionNotFound\";\r\n        CommonErrorCode[CommonErrorCode[\"DatasourceNotFound\"] = 11] = \"DatasourceNotFound\";\r\n        CommonErrorCode[CommonErrorCode[\"SiteNotFound\"] = 12] = \"SiteNotFound\";\r\n        CommonErrorCode[CommonErrorCode[\"EncryptionTokenNotFound\"] = 13] = \"EncryptionTokenNotFound\";\r\n        CommonErrorCode[CommonErrorCode[\"FileUploadNotFound\"] = 14] = \"FileUploadNotFound\";\r\n        CommonErrorCode[CommonErrorCode[\"AdGroupNotFound\"] = 15] = \"AdGroupNotFound\";\r\n        CommonErrorCode[CommonErrorCode[\"UnexpectedErrorOccurred\"] = 17] = \"UnexpectedErrorOccurred\";\r\n        CommonErrorCode[CommonErrorCode[\"InvalidNumberOrderClauses\"] = 18] = \"InvalidNumberOrderClauses\";\r\n        CommonErrorCode[CommonErrorCode[\"InvalidPageSize\"] = 19] = \"InvalidPageSize\";\r\n        CommonErrorCode[CommonErrorCode[\"InvalidStartIndex\"] = 20] = \"InvalidStartIndex\";\r\n        CommonErrorCode[CommonErrorCode[\"InvalidNumberFilterClauses\"] = 21] = \"InvalidNumberFilterClauses\";\r\n        CommonErrorCode[CommonErrorCode[\"InvalidSortClauseFieldName\"] = 22] = \"InvalidSortClauseFieldName\";\r\n        CommonErrorCode[CommonErrorCode[\"InProgress\"] = 23] = \"InProgress\";\r\n        CommonErrorCode[CommonErrorCode[\"UnexpectedNullOrEmptyParameter\"] = 24] = \"UnexpectedNullOrEmptyParameter\";\r\n        CommonErrorCode[CommonErrorCode[\"UnexpectedParameterValue\"] = 25] = \"UnexpectedParameterValue\";\r\n        CommonErrorCode[CommonErrorCode[\"DomainNotFound\"] = 26] = \"DomainNotFound\";\r\n        CommonErrorCode[CommonErrorCode[\"CommentNotFound\"] = 27] = \"CommentNotFound\";\r\n        CommonErrorCode[CommonErrorCode[\"AsyncJobNotFound\"] = 28] = \"AsyncJobNotFound\";\r\n        CommonErrorCode[CommonErrorCode[\"SubscriptionNotFound\"] = 29] = \"SubscriptionNotFound\";\r\n        CommonErrorCode[CommonErrorCode[\"ADUserNotFound\"] = 30] = \"ADUserNotFound\";\r\n        CommonErrorCode[CommonErrorCode[\"InvalidSession\"] = 46] = \"InvalidSession\";\r\n        CommonErrorCode[CommonErrorCode[\"UnlicensedServer\"] = 50] = \"UnlicensedServer\";\r\n        CommonErrorCode[CommonErrorCode[\"InsecureSAMLEndpoint\"] = 53] = \"InsecureSAMLEndpoint\";\r\n        CommonErrorCode[CommonErrorCode[\"RedirectToOtherPod\"] = 55] = \"RedirectToOtherPod\";\r\n        CommonErrorCode[CommonErrorCode[\"SiteSAMLUserCannotAddTableauIDUser\"] = 64] = \"SiteSAMLUserCannotAddTableauIDUser\";\r\n        CommonErrorCode[CommonErrorCode[\"FeatureNotEnabled\"] = 67] = \"FeatureNotEnabled\";\r\n        CommonErrorCode[CommonErrorCode[\"FileSizeTooLarge\"] = 68] = \"FileSizeTooLarge\";\r\n    })(VizPortal.CommonErrorCode || (VizPortal.CommonErrorCode = {}));\r\n    var CommonErrorCode = VizPortal.CommonErrorCode;\r\n    (function (AlertErrorCode) {\r\n        AlertErrorCode[AlertErrorCode[\"AlertUnknownFailure\"] = 1000] = \"AlertUnknownFailure\";\r\n        AlertErrorCode[AlertErrorCode[\"AlertRemoteUnknownFailure\"] = 1001] = \"AlertRemoteUnknownFailure\";\r\n        AlertErrorCode[AlertErrorCode[\"AlertSignInFailed\"] = 2000] = \"AlertSignInFailed\";\r\n        AlertErrorCode[AlertErrorCode[\"AlertRemoteSignInFailed\"] = 2001] = \"AlertRemoteSignInFailed\";\r\n        AlertErrorCode[AlertErrorCode[\"AlertExpiredPassword\"] = 2100] = \"AlertExpiredPassword\";\r\n        AlertErrorCode[AlertErrorCode[\"AlertRemoteExpiredPassword\"] = 2101] = \"AlertRemoteExpiredPassword\";\r\n        AlertErrorCode[AlertErrorCode[\"AlertAccessTokenValidation\"] = 2200] = \"AlertAccessTokenValidation\";\r\n        AlertErrorCode[AlertErrorCode[\"AlertAuthConfiguration\"] = 2300] = \"AlertAuthConfiguration\";\r\n        AlertErrorCode[AlertErrorCode[\"AlertConnectionFailure\"] = 3000] = \"AlertConnectionFailure\";\r\n        AlertErrorCode[AlertErrorCode[\"AlertRemoteConnectionFailure\"] = 3001] = \"AlertRemoteConnectionFailure\";\r\n        AlertErrorCode[AlertErrorCode[\"AlertOverlappingSchedules\"] = 4000] = \"AlertOverlappingSchedules\";\r\n        AlertErrorCode[AlertErrorCode[\"AlertFullRefreshRequired\"] = 5000] = \"AlertFullRefreshRequired\";\r\n        AlertErrorCode[AlertErrorCode[\"AlertConnectionlessFailure\"] = 10000] = \"AlertConnectionlessFailure\";\r\n    })(VizPortal.AlertErrorCode || (VizPortal.AlertErrorCode = {}));\r\n    var AlertErrorCode = VizPortal.AlertErrorCode;\r\n    (function (DataConnectionErrorCode) {\r\n        DataConnectionErrorCode[DataConnectionErrorCode[\"DataConnectionNullOrEmptyDataConnectionIds\"] = 60000] = \"DataConnectionNullOrEmptyDataConnectionIds\";\r\n        DataConnectionErrorCode[DataConnectionErrorCode[\"UpdateConnectionsInvalidPort\"] = 60005] = \"UpdateConnectionsInvalidPort\";\r\n    })(VizPortal.DataConnectionErrorCode || (VizPortal.DataConnectionErrorCode = {}));\r\n    var DataConnectionErrorCode = VizPortal.DataConnectionErrorCode;\r\n    (function (DatasourceErrorCode) {\r\n        DatasourceErrorCode[DatasourceErrorCode[\"DatasourceDescriptionGreaterThanMaxLength\"] = 50000] = \"DatasourceDescriptionGreaterThanMaxLength\";\r\n        DatasourceErrorCode[DatasourceErrorCode[\"DatasourceMoveInsufficientPermissionsOnDestinationProject\"] = 50001] = \"DatasourceMoveInsufficientPermissionsOnDestinationProject\";\r\n        DatasourceErrorCode[DatasourceErrorCode[\"DatasourceMoveInsufficientPermissionsOnSourceProject\"] = 50002] = \"DatasourceMoveInsufficientPermissionsOnSourceProject\";\r\n        DatasourceErrorCode[DatasourceErrorCode[\"DatasourceMoveInsufficientPermissionsOnDatasource\"] = 50003] = \"DatasourceMoveInsufficientPermissionsOnDatasource\";\r\n        DatasourceErrorCode[DatasourceErrorCode[\"DatasourceWithSameNameInDestinationProject\"] = 50004] = \"DatasourceWithSameNameInDestinationProject\";\r\n        DatasourceErrorCode[DatasourceErrorCode[\"DatasourceNullOrEmptyProjectIds\"] = 50005] = \"DatasourceNullOrEmptyProjectIds\";\r\n        DatasourceErrorCode[DatasourceErrorCode[\"DatasourceNullOrEmptyUserIds\"] = 50006] = \"DatasourceNullOrEmptyUserIds\";\r\n        DatasourceErrorCode[DatasourceErrorCode[\"DatasourceNullOrEmptyDatasourceIds\"] = 50007] = \"DatasourceNullOrEmptyDatasourceIds\";\r\n        DatasourceErrorCode[DatasourceErrorCode[\"DatasourceNullOrEmptyWorkbookIds\"] = 50008] = \"DatasourceNullOrEmptyWorkbookIds\";\r\n        DatasourceErrorCode[DatasourceErrorCode[\"DatasourceChangeOwnerDisabled\"] = 50009] = \"DatasourceChangeOwnerDisabled\";\r\n        DatasourceErrorCode[DatasourceErrorCode[\"DatasourceChangeOwnerToGuest\"] = 50010] = \"DatasourceChangeOwnerToGuest\";\r\n    })(VizPortal.DatasourceErrorCode || (VizPortal.DatasourceErrorCode = {}));\r\n    var DatasourceErrorCode = VizPortal.DatasourceErrorCode;\r\n    (function (UnifiedDatasourceErrorCode) {\r\n        UnifiedDatasourceErrorCode[UnifiedDatasourceErrorCode[\"UnifiedDatasourceNullOrEmptyDatasourceIds\"] = 160000] = \"UnifiedDatasourceNullOrEmptyDatasourceIds\";\r\n        UnifiedDatasourceErrorCode[UnifiedDatasourceErrorCode[\"OperationOnlySupportedForPublishedDatasource\"] = 160001] = \"OperationOnlySupportedForPublishedDatasource\";\r\n    })(VizPortal.UnifiedDatasourceErrorCode || (VizPortal.UnifiedDatasourceErrorCode = {}));\r\n    var UnifiedDatasourceErrorCode = VizPortal.UnifiedDatasourceErrorCode;\r\n    (function (LoginErrorCodes) {\r\n        LoginErrorCodes[LoginErrorCodes[\"BadCredentials\"] = 16] = \"BadCredentials\";\r\n        LoginErrorCodes[LoginErrorCodes[\"SspiFailed\"] = 42] = \"SspiFailed\";\r\n        LoginErrorCodes[LoginErrorCodes[\"KerberosFailed\"] = 43] = \"KerberosFailed\";\r\n        LoginErrorCodes[LoginErrorCodes[\"ClientCertificateNotFound\"] = 59] = \"ClientCertificateNotFound\";\r\n        LoginErrorCodes[LoginErrorCodes[\"ClientCertificateUserNotFoundInCertificate\"] = 60] = \"ClientCertificateUserNotFoundInCertificate\";\r\n        LoginErrorCodes[LoginErrorCodes[\"ClientCertificateUserNotFoundOnServer\"] = 61] = \"ClientCertificateUserNotFoundOnServer\";\r\n        LoginErrorCodes[LoginErrorCodes[\"OpenIdFailed\"] = 69] = \"OpenIdFailed\";\r\n    })(VizPortal.LoginErrorCodes || (VizPortal.LoginErrorCodes = {}));\r\n    var LoginErrorCodes = VizPortal.LoginErrorCodes;\r\n    (function (ProjectErrorCode) {\r\n        ProjectErrorCode[ProjectErrorCode[\"ProjectNullOrEmptyProjectIds\"] = 30000] = \"ProjectNullOrEmptyProjectIds\";\r\n        ProjectErrorCode[ProjectErrorCode[\"ProjectNullOrEmptyUserIds\"] = 30001] = \"ProjectNullOrEmptyUserIds\";\r\n        ProjectErrorCode[ProjectErrorCode[\"ProjectNameAlreadyExists\"] = 30002] = \"ProjectNameAlreadyExists\";\r\n        ProjectErrorCode[ProjectErrorCode[\"ProjectNameTooLong\"] = 30003] = \"ProjectNameTooLong\";\r\n        ProjectErrorCode[ProjectErrorCode[\"ProjectDescriptionGreaterThanMaxLength\"] = 30004] = \"ProjectDescriptionGreaterThanMaxLength\";\r\n        ProjectErrorCode[ProjectErrorCode[\"ProjectChangeOwnerDisabled\"] = 30005] = \"ProjectChangeOwnerDisabled\";\r\n        ProjectErrorCode[ProjectErrorCode[\"ProjectDefaultAlreadyExists\"] = 30006] = \"ProjectDefaultAlreadyExists\";\r\n        ProjectErrorCode[ProjectErrorCode[\"ProjectNameEmpty\"] = 30007] = \"ProjectNameEmpty\";\r\n        ProjectErrorCode[ProjectErrorCode[\"DeletingDefaultProject\"] = 30010] = \"DeletingDefaultProject\";\r\n        ProjectErrorCode[ProjectErrorCode[\"DefaultProjectCannotBeRenamed\"] = 30011] = \"DefaultProjectCannotBeRenamed\";\r\n        ProjectErrorCode[ProjectErrorCode[\"TargetUserInsufficientPermissions\"] = 30012] = \"TargetUserInsufficientPermissions\";\r\n    })(VizPortal.ProjectErrorCode || (VizPortal.ProjectErrorCode = {}));\r\n    var ProjectErrorCode = VizPortal.ProjectErrorCode;\r\n    (function (TagErrorCode) {\r\n        TagErrorCode[TagErrorCode[\"TagNameTooLong\"] = 110000] = \"TagNameTooLong\";\r\n    })(VizPortal.TagErrorCode || (VizPortal.TagErrorCode = {}));\r\n    var TagErrorCode = VizPortal.TagErrorCode;\r\n    (function (WorkbookErrorCode) {\r\n        WorkbookErrorCode[WorkbookErrorCode[\"WorkbookDisabled\"] = 40000] = \"WorkbookDisabled\";\r\n        WorkbookErrorCode[WorkbookErrorCode[\"WorkbookDestinationProjectNotFound\"] = 40001] = \"WorkbookDestinationProjectNotFound\";\r\n        WorkbookErrorCode[WorkbookErrorCode[\"WorkbookMoveInsufficientPermissionsOnDestinationProject\"] = 40002] = \"WorkbookMoveInsufficientPermissionsOnDestinationProject\";\r\n        WorkbookErrorCode[WorkbookErrorCode[\"WorkbookMoveInsufficientPermissionsOnSourceProject\"] = 40003] = \"WorkbookMoveInsufficientPermissionsOnSourceProject\";\r\n        WorkbookErrorCode[WorkbookErrorCode[\"WorkbookMoveInsufficientPermissionsOnWorkbook\"] = 40004] = \"WorkbookMoveInsufficientPermissionsOnWorkbook\";\r\n        WorkbookErrorCode[WorkbookErrorCode[\"WorkbookNameAlreadyExistsInDestinationProject\"] = 40005] = \"WorkbookNameAlreadyExistsInDestinationProject\";\r\n        WorkbookErrorCode[WorkbookErrorCode[\"WorkbookDescriptionTooLong\"] = 40006] = \"WorkbookDescriptionTooLong\";\r\n        WorkbookErrorCode[WorkbookErrorCode[\"WorkbookInvalidViewPath\"] = 40007] = \"WorkbookInvalidViewPath\";\r\n        WorkbookErrorCode[WorkbookErrorCode[\"WorkbookNullOrEmptyWorkbookIds\"] = 40008] = \"WorkbookNullOrEmptyWorkbookIds\";\r\n        WorkbookErrorCode[WorkbookErrorCode[\"WorkbookNullOrEmptyViewIds\"] = 40009] = \"WorkbookNullOrEmptyViewIds\";\r\n        WorkbookErrorCode[WorkbookErrorCode[\"WorkbookNullOrEmptyUserIds\"] = 40010] = \"WorkbookNullOrEmptyUserIds\";\r\n    })(VizPortal.WorkbookErrorCode || (VizPortal.WorkbookErrorCode = {}));\r\n    var WorkbookErrorCode = VizPortal.WorkbookErrorCode;\r\n    (function (SiteSwitchErrorCodes) {\r\n        SiteSwitchErrorCodes[SiteSwitchErrorCodes[\"UserNotMemberOfSiteOrSiteNotExist\"] = 16] = \"UserNotMemberOfSiteOrSiteNotExist\";\r\n        SiteSwitchErrorCodes[SiteSwitchErrorCodes[\"UserUnlicensedForSite\"] = 10028] = \"UserUnlicensedForSite\";\r\n        SiteSwitchErrorCodes[SiteSwitchErrorCodes[\"SiteSuspended\"] = 10029] = \"SiteSuspended\";\r\n        SiteSwitchErrorCodes[SiteSwitchErrorCodes[\"SiteLocked\"] = 10030] = \"SiteLocked\";\r\n        SiteSwitchErrorCodes[SiteSwitchErrorCodes[\"AttemptedToSwitchSiteToCurrentSite\"] = 10056] = \"AttemptedToSwitchSiteToCurrentSite\";\r\n    })(VizPortal.SiteSwitchErrorCodes || (VizPortal.SiteSwitchErrorCodes = {}));\r\n    var SiteSwitchErrorCodes = VizPortal.SiteSwitchErrorCodes;\r\n    (function (SiteSettingsErrorCode) {\r\n        SiteSettingsErrorCode[SiteSettingsErrorCode[\"SiteNotFound\"] = 12] = \"SiteNotFound\";\r\n        SiteSettingsErrorCode[SiteSettingsErrorCode[\"SiteNameIsEmptyOrNull\"] = 70000] = \"SiteNameIsEmptyOrNull\";\r\n        SiteSettingsErrorCode[SiteSettingsErrorCode[\"SiteAdminCannotAddUsersButUserQuotaIsSet\"] = 70001] = \"SiteAdminCannotAddUsersButUserQuotaIsSet\";\r\n        SiteSettingsErrorCode[SiteSettingsErrorCode[\"InvalidUserQuotaOrStorageQuota\"] = 70002] = \"InvalidUserQuotaOrStorageQuota\";\r\n        SiteSettingsErrorCode[SiteSettingsErrorCode[\"UserQuotaGreaterThanServerLicenseLimit\"] = 70003] = \"UserQuotaGreaterThanServerLicenseLimit\";\r\n        SiteSettingsErrorCode[SiteSettingsErrorCode[\"InvalidCustomEmailAddress\"] = 70004] = \"InvalidCustomEmailAddress\";\r\n        SiteSettingsErrorCode[SiteSettingsErrorCode[\"SiteNameOrUrlNameAlreadyExists\"] = 70005] = \"SiteNameOrUrlNameAlreadyExists\";\r\n        SiteSettingsErrorCode[SiteSettingsErrorCode[\"SiteIdsAreNullOrEmpty\"] = 70006] = \"SiteIdsAreNullOrEmpty\";\r\n        SiteSettingsErrorCode[SiteSettingsErrorCode[\"SiteSubscriptionsSetWithDisabledServerSubscriptions\"] = 70007] = \"SiteSubscriptionsSetWithDisabledServerSubscriptions\";\r\n        SiteSettingsErrorCode[SiteSettingsErrorCode[\"AttemptedToUpdateDefaultSiteUrlName\"] = 70008] = \"AttemptedToUpdateDefaultSiteUrlName\";\r\n        SiteSettingsErrorCode[SiteSettingsErrorCode[\"AttemptedToSuspendDefaultSite\"] = 70009] = \"AttemptedToSuspendDefaultSite\";\r\n        SiteSettingsErrorCode[SiteSettingsErrorCode[\"SiteNameTooLong\"] = 70010] = \"SiteNameTooLong\";\r\n        SiteSettingsErrorCode[SiteSettingsErrorCode[\"SiteUrlNameTooLong\"] = 70011] = \"SiteUrlNameTooLong\";\r\n        SiteSettingsErrorCode[SiteSettingsErrorCode[\"AttemptedToDeleteDefaultSite\"] = 70012] = \"AttemptedToDeleteDefaultSite\";\r\n        SiteSettingsErrorCode[SiteSettingsErrorCode[\"StorageQuotaLessThanStorageUsed\"] = 70013] = \"StorageQuotaLessThanStorageUsed\";\r\n    })(VizPortal.SiteSettingsErrorCode || (VizPortal.SiteSettingsErrorCode = {}));\r\n    var SiteSettingsErrorCode = VizPortal.SiteSettingsErrorCode;\r\n    (function (WebClientErrorCode) {\r\n        WebClientErrorCode[WebClientErrorCode[\"NotAnInteger\"] = 80000] = \"NotAnInteger\";\r\n        WebClientErrorCode[WebClientErrorCode[\"NotASiterole\"] = 80001] = \"NotASiterole\";\r\n        WebClientErrorCode[WebClientErrorCode[\"InvalidStartIndex\"] = 80002] = \"InvalidStartIndex\";\r\n        WebClientErrorCode[WebClientErrorCode[\"InvalidMaxItems\"] = 80003] = \"InvalidMaxItems\";\r\n        WebClientErrorCode[WebClientErrorCode[\"MutuallyExclusiveParametersPresent\"] = 80004] = \"MutuallyExclusiveParametersPresent\";\r\n        WebClientErrorCode[WebClientErrorCode[\"SiteSubscriptionSettingsMissing\"] = 80005] = \"SiteSubscriptionSettingsMissing\";\r\n        WebClientErrorCode[WebClientErrorCode[\"NotAScheduledAction\"] = 80006] = \"NotAScheduledAction\";\r\n        WebClientErrorCode[WebClientErrorCode[\"NotAScheduleType\"] = 80007] = \"NotAScheduleType\";\r\n        WebClientErrorCode[WebClientErrorCode[\"NotADayOfMonth\"] = 80008] = \"NotADayOfMonth\";\r\n        WebClientErrorCode[WebClientErrorCode[\"NotADayOfWeek\"] = 80009] = \"NotADayOfWeek\";\r\n        WebClientErrorCode[WebClientErrorCode[\"NotATaskType\"] = 80010] = \"NotATaskType\";\r\n        WebClientErrorCode[WebClientErrorCode[\"NotATargetType\"] = 80011] = \"NotATargetType\";\r\n        WebClientErrorCode[WebClientErrorCode[\"TaskTypeIncrementExtractNotAllowed\"] = 80012] = \"TaskTypeIncrementExtractNotAllowed\";\r\n        WebClientErrorCode[WebClientErrorCode[\"TaskTypeRefreshExtractNotAllowed\"] = 80013] = \"TaskTypeRefreshExtractNotAllowed\";\r\n        WebClientErrorCode[WebClientErrorCode[\"UnableToDeleteUserWhoOwnsContent\"] = 80014] = \"UnableToDeleteUserWhoOwnsContent\";\r\n    })(VizPortal.WebClientErrorCode || (VizPortal.WebClientErrorCode = {}));\r\n    var WebClientErrorCode = VizPortal.WebClientErrorCode;\r\n    (function (SchedulingErrorCode) {\r\n        SchedulingErrorCode[SchedulingErrorCode[\"SchedulingNullOrEmptyScheduleIds\"] = 120000] = \"SchedulingNullOrEmptyScheduleIds\";\r\n        SchedulingErrorCode[SchedulingErrorCode[\"SchedulingScheduleNotFound\"] = 120001] = \"SchedulingScheduleNotFound\";\r\n        SchedulingErrorCode[SchedulingErrorCode[\"SchedulingTaskNotFound\"] = 120002] = \"SchedulingTaskNotFound\";\r\n        SchedulingErrorCode[SchedulingErrorCode[\"SchedulingNameEmpty\"] = 120003] = \"SchedulingNameEmpty\";\r\n        SchedulingErrorCode[SchedulingErrorCode[\"SchedulingNameTooLong\"] = 120004] = \"SchedulingNameTooLong\";\r\n        SchedulingErrorCode[SchedulingErrorCode[\"SchedulingNameAlreadyExists\"] = 120005] = \"SchedulingNameAlreadyExists\";\r\n        SchedulingErrorCode[SchedulingErrorCode[\"SchedulingStartTimeValueInvalid\"] = 120006] = \"SchedulingStartTimeValueInvalid\";\r\n        SchedulingErrorCode[SchedulingErrorCode[\"SchedulingEndTimeValueInvalid\"] = 120007] = \"SchedulingEndTimeValueInvalid\";\r\n        SchedulingErrorCode[SchedulingErrorCode[\"SchedulingRecurrenceMinutesValueInvalid\"] = 120008] = \"SchedulingRecurrenceMinutesValueInvalid\";\r\n        SchedulingErrorCode[SchedulingErrorCode[\"SchedulingRecurrenceDaysOfWeekValueMissing\"] = 120009] = \"SchedulingRecurrenceDaysOfWeekValueMissing\";\r\n        SchedulingErrorCode[SchedulingErrorCode[\"SchedulingRecurrenceDayOfMonthValueMissing\"] = 120010] = \"SchedulingRecurrenceDayOfMonthValueMissing\";\r\n        SchedulingErrorCode[SchedulingErrorCode[\"SchedulingPriorityValueInvalid\"] = 120011] = \"SchedulingPriorityValueInvalid\";\r\n        SchedulingErrorCode[SchedulingErrorCode[\"SchedulingExtractTaskExistsForTarget\"] = 120012] = \"SchedulingExtractTaskExistsForTarget\";\r\n    })(VizPortal.SchedulingErrorCode || (VizPortal.SchedulingErrorCode = {}));\r\n    var SchedulingErrorCode = VizPortal.SchedulingErrorCode;\r\n    (function (UninitializedServerErrorCode) {\r\n        UninitializedServerErrorCode[UninitializedServerErrorCode[\"UntrustedMachine\"] = 80015] = \"UntrustedMachine\";\r\n        UninitializedServerErrorCode[UninitializedServerErrorCode[\"ReadyToInitialize\"] = 80018] = \"ReadyToInitialize\";\r\n    })(VizPortal.UninitializedServerErrorCode || (VizPortal.UninitializedServerErrorCode = {}));\r\n    var UninitializedServerErrorCode = VizPortal.UninitializedServerErrorCode;\r\n    // From '../java/tab-model-workgroup/src/com/tableausoftware/api/rest/util/RestApiErrorCode.java'\r\n    (function (RestApiErrorCode) {\r\n        RestApiErrorCode[RestApiErrorCode[\"UserNotSupportedAdminOperation\"] = 90000] = \"UserNotSupportedAdminOperation\";\r\n        RestApiErrorCode[RestApiErrorCode[\"UserInvalidSiteRole\"] = 90001] = \"UserInvalidSiteRole\";\r\n        RestApiErrorCode[RestApiErrorCode[\"ADNotConfigured\"] = 90002] = \"ADNotConfigured\";\r\n        RestApiErrorCode[RestApiErrorCode[\"ADDomainInvalid\"] = 90003] = \"ADDomainInvalid\";\r\n        RestApiErrorCode[RestApiErrorCode[\"InvalidPageNumber\"] = 90004] = \"InvalidPageNumber\";\r\n        RestApiErrorCode[RestApiErrorCode[\"InvalidRequestPayload\"] = 90005] = \"InvalidRequestPayload\";\r\n        RestApiErrorCode[RestApiErrorCode[\"AmbiguousWorkbookPublishSource\"] = 90006] = \"AmbiguousWorkbookPublishSource\";\r\n        RestApiErrorCode[RestApiErrorCode[\"InvalidWorkbookFile\"] = 90007] = \"InvalidWorkbookFile\";\r\n        RestApiErrorCode[RestApiErrorCode[\"InvalidOverwriteParameter\"] = 90008] = \"InvalidOverwriteParameter\";\r\n        RestApiErrorCode[RestApiErrorCode[\"InvalidPageSize\"] = 90009] = \"InvalidPageSize\";\r\n        RestApiErrorCode[RestApiErrorCode[\"GroupUserExists\"] = 90010] = \"GroupUserExists\";\r\n        RestApiErrorCode[RestApiErrorCode[\"GroupUserNotFound\"] = 90011] = \"GroupUserNotFound\";\r\n        RestApiErrorCode[RestApiErrorCode[\"CannotModifyADGroupName\"] = 90012] = \"CannotModifyADGroupName\";\r\n        RestApiErrorCode[RestApiErrorCode[\"GroupAlreadyExists\"] = 90013] = \"GroupAlreadyExists\";\r\n        RestApiErrorCode[RestApiErrorCode[\"InvalidEmbedParameter\"] = 90014] = \"InvalidEmbedParameter\";\r\n        RestApiErrorCode[RestApiErrorCode[\"InvalidDatasourceFile\"] = 90015] = \"InvalidDatasourceFile\";\r\n        RestApiErrorCode[RestApiErrorCode[\"MismatchADGroupDomainNameOnSync\"] = 90016] = \"MismatchADGroupDomainNameOnSync\";\r\n        RestApiErrorCode[RestApiErrorCode[\"InsufficientProject_permissions\"] = 90017] = \"InsufficientProject_permissions\";\r\n        RestApiErrorCode[RestApiErrorCode[\"InvalidShowTabsParameter\"] = 90018] = \"InvalidShowTabsParameter\";\r\n        RestApiErrorCode[RestApiErrorCode[\"WorkbookChangeOwnerInsufficientPermissions\"] = 90019] = \"WorkbookChangeOwnerInsufficientPermissions\";\r\n        RestApiErrorCode[RestApiErrorCode[\"WorkbookChangeDisplayTabsInsufficientPermissions\"] = 90020] = \"WorkbookChangeDisplayTabsInsufficientPermissions\";\r\n        RestApiErrorCode[RestApiErrorCode[\"InvalidOAuthParameter\"] = 90021] = \"InvalidOAuthParameter\"; //  The \"oAuth\" parameter was provided with a non-boolean string\r\n    })(VizPortal.RestApiErrorCode || (VizPortal.RestApiErrorCode = {}));\r\n    var RestApiErrorCode = VizPortal.RestApiErrorCode;\r\n    // From '../java/tab-domain-user/src/com/tableausoftware/domain/user/exceptions/errorcodes/UserErrorCode'\r\n    (function (UserErrorCode) {\r\n        UserErrorCode[UserErrorCode[\"UserGroupInvalidName\"] = 10001] = \"UserGroupInvalidName\";\r\n        UserErrorCode[UserErrorCode[\"UserDomainInvalidName\"] = 10002] = \"UserDomainInvalidName\";\r\n        UserErrorCode[UserErrorCode[\"UserGroupWithNameAlreadyExists\"] = 10003] = \"UserGroupWithNameAlreadyExists\";\r\n        UserErrorCode[UserErrorCode[\"UserCsvParamNotText\"] = 10004] = \"UserCsvParamNotText\";\r\n        UserErrorCode[UserErrorCode[\"UserCsvParamerterTooLong\"] = 10005] = \"UserCsvParamerterTooLong\";\r\n        UserErrorCode[UserErrorCode[\"UserCannotSetAdminStatusForSystemAdmin\"] = 10006] = \"UserCannotSetAdminStatusForSystemAdmin\";\r\n        UserErrorCode[UserErrorCode[\"UserCannotRenameSystemGroup\"] = 10007] = \"UserCannotRenameSystemGroup\";\r\n        UserErrorCode[UserErrorCode[\"UserCannotRenameNonLocalGroup\"] = 10008] = \"UserCannotRenameNonLocalGroup\";\r\n        UserErrorCode[UserErrorCode[\"UserInsufficientLicenses\"] = 10009] = \"UserInsufficientLicenses\";\r\n        UserErrorCode[UserErrorCode[\"UserCannotUnlicenseAdmin\"] = 10010] = \"UserCannotUnlicenseAdmin\";\r\n        UserErrorCode[UserErrorCode[\"UserInvalidEmailAddress\"] = 10011] = \"UserInvalidEmailAddress\";\r\n        UserErrorCode[UserErrorCode[\"UserSystemUserWithEmailAddressAlreadyExists\"] = 10012] = \"UserSystemUserWithEmailAddressAlreadyExists\";\r\n        UserErrorCode[UserErrorCode[\"UserOverlappedGroupidInUpdate\"] = 10013] = \"UserOverlappedGroupidInUpdate\";\r\n        UserErrorCode[UserErrorCode[\"UserAllUsersGroupAlreadyExists\"] = 10014] = \"UserAllUsersGroupAlreadyExists\";\r\n        UserErrorCode[UserErrorCode[\"UserGuestAlreadyExists\"] = 10015] = \"UserGuestAlreadyExists\";\r\n        UserErrorCode[UserErrorCode[\"UserCannotAutocreateUser\"] = 10016] = \"UserCannotAutocreateUser\";\r\n        UserErrorCode[UserErrorCode[\"UserInvalidPassword\"] = 10017] = \"UserInvalidPassword\";\r\n        UserErrorCode[UserErrorCode[\"UserCannotUpdatePassword\"] = 10018] = \"UserCannotUpdatePassword\";\r\n        UserErrorCode[UserErrorCode[\"UserCannotUpdateFriendlyName\"] = 10019] = \"UserCannotUpdateFriendlyName\";\r\n        UserErrorCode[UserErrorCode[\"UserInvalidUserName\"] = 10020] = \"UserInvalidUserName\";\r\n        UserErrorCode[UserErrorCode[\"UserAlreadyExists\"] = 10021] = \"UserAlreadyExists\";\r\n        UserErrorCode[UserErrorCode[\"UserOverlappedSiteidInUpdate\"] = 10022] = \"UserOverlappedSiteidInUpdate\";\r\n        UserErrorCode[UserErrorCode[\"UserNotSupportedGuestOperation\"] = 10023] = \"UserNotSupportedGuestOperation\";\r\n        UserErrorCode[UserErrorCode[\"UserNotSupportedAdminOperation\"] = 10024] = \"UserNotSupportedAdminOperation\";\r\n        UserErrorCode[UserErrorCode[\"UserNotSupportedSelfOperation\"] = 10025] = \"UserNotSupportedSelfOperation\";\r\n        UserErrorCode[UserErrorCode[\"UserInvalidFriendlyName\"] = 10026] = \"UserInvalidFriendlyName\";\r\n        UserErrorCode[UserErrorCode[\"UserInvalidSiteRole\"] = 10027] = \"UserInvalidSiteRole\";\r\n        UserErrorCode[UserErrorCode[\"UserLoginFailedUnlicensedOnSite\"] = 10028] = \"UserLoginFailedUnlicensedOnSite\";\r\n        UserErrorCode[UserErrorCode[\"UserLoginFailedSuspendedSite\"] = 10029] = \"UserLoginFailedSuspendedSite\";\r\n        UserErrorCode[UserErrorCode[\"UserLoginFailedLockedSite\"] = 10030] = \"UserLoginFailedLockedSite\";\r\n        UserErrorCode[UserErrorCode[\"UserGuestLoginFailed\"] = 10031] = \"UserGuestLoginFailed\";\r\n        UserErrorCode[UserErrorCode[\"UserMissingPasswordParameters\"] = 10032] = \"UserMissingPasswordParameters\";\r\n        UserErrorCode[UserErrorCode[\"UserCannotFavoriteType\"] = 10033] = \"UserCannotFavoriteType\";\r\n        UserErrorCode[UserErrorCode[\"UserCannotDeleteSystemUserWithAssociatedUsers\"] = 10040] = \"UserCannotDeleteSystemUserWithAssociatedUsers\";\r\n        UserErrorCode[UserErrorCode[\"UserCsvMissingUsername\"] = 10050] = \"UserCsvMissingUsername\";\r\n        UserErrorCode[UserErrorCode[\"UserCsvInvalidAdminLevel\"] = 10051] = \"UserCsvInvalidAdminLevel\";\r\n        UserErrorCode[UserErrorCode[\"UserCsvInvalidLicense\"] = 10052] = \"UserCsvInvalidLicense\";\r\n        UserErrorCode[UserErrorCode[\"UserCsvInvalidPublisher\"] = 10053] = \"UserCsvInvalidPublisher\";\r\n        UserErrorCode[UserErrorCode[\"UserCsvMissingPassword\"] = 10054] = \"UserCsvMissingPassword\";\r\n        UserErrorCode[UserErrorCode[\"UserCsvPasswordMismatch\"] = 10055] = \"UserCsvPasswordMismatch\";\r\n        UserErrorCode[UserErrorCode[\"UserTriedSwitchSiteToCurrentSite\"] = 10056] = \"UserTriedSwitchSiteToCurrentSite\";\r\n        UserErrorCode[UserErrorCode[\"UserInsufficientSiteQuota\"] = 10057] = \"UserInsufficientSiteQuota\";\r\n        UserErrorCode[UserErrorCode[\"UserCannotUpdateMinimumSiteRoleNonAdGroup\"] = 10058] = \"UserCannotUpdateMinimumSiteRoleNonAdGroup\";\r\n        UserErrorCode[UserErrorCode[\"UserOpenIdBadConfig\"] = 10059] = \"UserOpenIdBadConfig\";\r\n        UserErrorCode[UserErrorCode[\"UserOpenIdIdpNotReachable\"] = 10060] = \"UserOpenIdIdpNotReachable\";\r\n        UserErrorCode[UserErrorCode[\"UserOpenIdUserNotFound\"] = 10061] = \"UserOpenIdUserNotFound\";\r\n        UserErrorCode[UserErrorCode[\"UserOpenIdConflictingUserAccount\"] = 10062] = \"UserOpenIdConflictingUserAccount\";\r\n    })(VizPortal.UserErrorCode || (VizPortal.UserErrorCode = {}));\r\n    var UserErrorCode = VizPortal.UserErrorCode;\r\n    (function (GroupErrorCode) {\r\n        GroupErrorCode[GroupErrorCode[\"GroupNullOrEmptyName\"] = 20000] = \"GroupNullOrEmptyName\";\r\n        GroupErrorCode[GroupErrorCode[\"GroupAmbiguousNameSearch\"] = 20001] = \"GroupAmbiguousNameSearch\";\r\n        GroupErrorCode[GroupErrorCode[\"GroupCannotBeDeleted\"] = 20002] = \"GroupCannotBeDeleted\";\r\n        GroupErrorCode[GroupErrorCode[\"InvalidGroupMembershipUpdate\"] = 20003] = \"InvalidGroupMembershipUpdate\";\r\n    })(VizPortal.GroupErrorCode || (VizPortal.GroupErrorCode = {}));\r\n    var GroupErrorCode = VizPortal.GroupErrorCode;\r\n    // From '../java/tab-domain-interfaces/src/com/tableausoftware/domain/ldap/LdapErrorCode.java'\r\n    (function (LdapErrorCode) {\r\n        LdapErrorCode[LdapErrorCode[\"LdapOperationsError\"] = 100001] = \"LdapOperationsError\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapProtocolError\"] = 100002] = \"LdapProtocolError\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapTimelimitExceeded\"] = 100003] = \"LdapTimelimitExceeded\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapSizelimitExceeded\"] = 100004] = \"LdapSizelimitExceeded\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapCompareFalse\"] = 100005] = \"LdapCompareFalse\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapCompareTrue\"] = 100006] = \"LdapCompareTrue\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapAuthMethodNotSupported\"] = 100007] = \"LdapAuthMethodNotSupported\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapStrongAuthRequired\"] = 100008] = \"LdapStrongAuthRequired\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapPartialResults\"] = 100009] = \"LdapPartialResults\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapReferral\"] = 100010] = \"LdapReferral\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapAdminLimitExceeded\"] = 100011] = \"LdapAdminLimitExceeded\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapUnavailableCritExtension\"] = 100012] = \"LdapUnavailableCritExtension\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapConfidentialityRequired\"] = 100013] = \"LdapConfidentialityRequired\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapSaslBindInProgress\"] = 100014] = \"LdapSaslBindInProgress\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapReferralV2\"] = 100015] = \"LdapReferralV2\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapNoSuchAttribute\"] = 100016] = \"LdapNoSuchAttribute\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapUndefinedType\"] = 100017] = \"LdapUndefinedType\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapInappropriateMatching\"] = 100018] = \"LdapInappropriateMatching\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapConstraintViolation\"] = 100019] = \"LdapConstraintViolation\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapAttributeOrValueExists\"] = 100020] = \"LdapAttributeOrValueExists\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapInvalidSyntax\"] = 100021] = \"LdapInvalidSyntax\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapNoSuchObject\"] = 100032] = \"LdapNoSuchObject\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapAliasProblem\"] = 100033] = \"LdapAliasProblem\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapInvalidDnSyntax\"] = 100034] = \"LdapInvalidDnSyntax\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapIsLeaf\"] = 100035] = \"LdapIsLeaf\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapAliasDerefProblem\"] = 100036] = \"LdapAliasDerefProblem\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapInappropriateAuth\"] = 100048] = \"LdapInappropriateAuth\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapInvalidCredentials\"] = 100049] = \"LdapInvalidCredentials\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapInsufficientRights\"] = 100050] = \"LdapInsufficientRights\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapBusy\"] = 100051] = \"LdapBusy\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapUnavailable\"] = 100052] = \"LdapUnavailable\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapUnwillingToPerform\"] = 100053] = \"LdapUnwillingToPerform\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapLoopDetect\"] = 100054] = \"LdapLoopDetect\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapSortControlMissing\"] = 100060] = \"LdapSortControlMissing\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapOffsetRangeError\"] = 100061] = \"LdapOffsetRangeError\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapNamingViolation\"] = 100064] = \"LdapNamingViolation\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapObjectClassViolation\"] = 100065] = \"LdapObjectClassViolation\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapNotAllowedOnNonleaf\"] = 100066] = \"LdapNotAllowedOnNonleaf\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapNotAllowedOnRdn\"] = 100067] = \"LdapNotAllowedOnRdn\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapAlreadyExists\"] = 100068] = \"LdapAlreadyExists\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapNoObjectClassMods\"] = 100069] = \"LdapNoObjectClassMods\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapResultsTooLarge\"] = 100070] = \"LdapResultsTooLarge\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapAffectsMultipleDsas\"] = 100071] = \"LdapAffectsMultipleDsas\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapVirtualListViewError\"] = 100076] = \"LdapVirtualListViewError\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapOther\"] = 100080] = \"LdapOther\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapServerDown\"] = 100081] = \"LdapServerDown\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapLocalError\"] = 100082] = \"LdapLocalError\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapEncodingError\"] = 100083] = \"LdapEncodingError\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapDecodingError\"] = 100084] = \"LdapDecodingError\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapTimeout\"] = 100085] = \"LdapTimeout\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapAuthUnknown\"] = 100086] = \"LdapAuthUnknown\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapFilterError\"] = 100087] = \"LdapFilterError\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapUserCancelled\"] = 100088] = \"LdapUserCancelled\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapParamError\"] = 100089] = \"LdapParamError\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapNoMemory\"] = 100090] = \"LdapNoMemory\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapConnectError\"] = 100091] = \"LdapConnectError\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapNotSupported\"] = 100092] = \"LdapNotSupported\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapNoResultsReturned\"] = 100094] = \"LdapNoResultsReturned\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapControlNotFound\"] = 100093] = \"LdapControlNotFound\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapMoreResultsToReturn\"] = 100095] = \"LdapMoreResultsToReturn\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapClientLoop\"] = 100096] = \"LdapClientLoop\";\r\n        LdapErrorCode[LdapErrorCode[\"LdapReferralLimitExceeded\"] = 100097] = \"LdapReferralLimitExceeded\";\r\n        LdapErrorCode[LdapErrorCode[\"NotUniqueUserSearch\"] = 101000] = \"NotUniqueUserSearch\";\r\n        LdapErrorCode[LdapErrorCode[\"NotUniqueGroupSearch\"] = 101001] = \"NotUniqueGroupSearch\";\r\n        LdapErrorCode[LdapErrorCode[\"UserNotFound\"] = 101002] = \"UserNotFound\";\r\n        LdapErrorCode[LdapErrorCode[\"GroupNotFound\"] = 101003] = \"GroupNotFound\";\r\n        LdapErrorCode[LdapErrorCode[\"NullOrEmptySearch\"] = 101004] = \"NullOrEmptySearch\";\r\n        LdapErrorCode[LdapErrorCode[\"UnknownObject\"] = 101005] = \"UnknownObject\";\r\n        LdapErrorCode[LdapErrorCode[\"UnknownSidType\"] = 101006] = \"UnknownSidType\";\r\n        LdapErrorCode[LdapErrorCode[\"UnknownNativeError\"] = 101007] = \"UnknownNativeError\";\r\n    })(VizPortal.LdapErrorCode || (VizPortal.LdapErrorCode = {}));\r\n    var LdapErrorCode = VizPortal.LdapErrorCode;\r\n    (function (SolrErrorCode) {\r\n        SolrErrorCode[SolrErrorCode[\"SolrCommunicationError\"] = 200000] = \"SolrCommunicationError\";\r\n        SolrErrorCode[SolrErrorCode[\"SolrDisabled\"] = 200001] = \"SolrDisabled\";\r\n        SolrErrorCode[SolrErrorCode[\"SolrIndexingFailed\"] = 200002] = \"SolrIndexingFailed\";\r\n    })(VizPortal.SolrErrorCode || (VizPortal.SolrErrorCode = {}));\r\n    var SolrErrorCode = VizPortal.SolrErrorCode;\r\n    // From '../java/tab-domain-online/src/com/tableausoftware/domain/online/exceptions/errorcodes/OnlineErrorCode.java'\r\n    (function (OnlineErrorCode) {\r\n        OnlineErrorCode[OnlineErrorCode[\"InvalidImage\"] = 250000] = \"InvalidImage\";\r\n        OnlineErrorCode[OnlineErrorCode[\"ImageProcessingError\"] = 250001] = \"ImageProcessingError\";\r\n        OnlineErrorCode[OnlineErrorCode[\"StorageException\"] = 250010] = \"StorageException\";\r\n        OnlineErrorCode[OnlineErrorCode[\"SiteCustomizationUnavailable\"] = 250011] = \"SiteCustomizationUnavailable\"; // Site customization not available.\r\n    })(VizPortal.OnlineErrorCode || (VizPortal.OnlineErrorCode = {}));\r\n    var OnlineErrorCode = VizPortal.OnlineErrorCode;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"resourceParts.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"resourceParts.ts\" />\r\n/// <reference path=\"ISiteSettingsForSiteAdmin.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        ServerApi.SiteKeys = {\r\n            id: 'id'\r\n        };\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\n/// <reference path=\"../ServerApi/types/ISite.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var CreateSiteAction = (function () {\r\n        function CreateSiteAction(ConfirmActionDialog, $translate, toaster, server, Sites, $q) {\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.$translate = $translate;\r\n            this.toaster = toaster;\r\n            this.server = server;\r\n            this.Sites = Sites;\r\n            this.$q = $q;\r\n        }\r\n        CreateSiteAction.prototype.execute = function (parentScope) {\r\n            var _this = this;\r\n            return this.getPlaceholderSiteSettings().then(function (siteSettingsForServerAdmin) {\r\n                var dialogScope = parentScope.$new(true);\r\n                var siteSettingsForSiteAdmin = {\r\n                    id: undefined,\r\n                    siteAdminSettings: {\r\n                        liveDBConnectionsWhitelistEnabled: false,\r\n                        refreshTokenEnabled: true\r\n                    }\r\n                };\r\n                dialogScope.siteSettingsForServerAdmin = siteSettingsForServerAdmin;\r\n                dialogScope.siteSettingsForSiteAdmin = siteSettingsForSiteAdmin;\r\n                dialogScope.isDefaultSite = false;\r\n                dialogScope.hideNameAndId = false;\r\n                dialogScope.hideAvailability = true;\r\n                dialogScope.autoSelectSiteName = true;\r\n                dialogScope.liveDBAvailable = _this.server.isLiveDBAvailable();\r\n                dialogScope.siteSettingsForServerAdminFormState = {};\r\n                return _this.ConfirmActionDialog.open({\r\n                    scope: dialogScope,\r\n                    title: _this.$translate.instant('newSiteDialogTitle'),\r\n                    bodyTemplateUrl: 'siteDialog.html',\r\n                    actionName: _this.$translate.instant('newSiteDialogSubmit'),\r\n                    confirmDisabled: function () { return _.isEmpty(dialogScope.siteSettingsForServerAdminFormState) || !dialogScope.siteSettingsForServerAdminFormState.isValid(); },\r\n                    action: function () {\r\n                        return _this.Sites.createSite(dialogScope.siteSettingsForServerAdmin.settings, dialogScope.siteSettingsForSiteAdmin.siteAdminSettings, dialogScope.siteSettingsForServerAdmin.subscriptionSettings)\r\n                            .then(function () {\r\n                            _this.toaster.pop({\r\n                                type: VizPortal.ToastType.Info,\r\n                                text: _this.$translate.instant('siteCreateSuccess', {\r\n                                    SITE_NAME: VizPortal.L10n.elideIfLong(dialogScope.siteSettingsForServerAdmin.settings.name)\r\n                                })\r\n                            });\r\n                            _this.server.refreshSessionInfo(); // Refresh top bar\r\n                        }, function (errors) {\r\n                            _this.errorMessages(errors, dialogScope.siteSettingsForServerAdmin);\r\n                            return _this.$q.reject();\r\n                        });\r\n                    },\r\n                    size: VizPortal.ModalSize.fitToContent\r\n                }).result.fin(function () { return dialogScope.$destroy(); });\r\n            });\r\n        };\r\n        CreateSiteAction.prototype.isServerLevelSubscriptionsEnabled = function () {\r\n            return this.Sites.getCurrentSiteSettingsForServerAdmin()\r\n                .then(function (siteSettingsForServerAdmin) { return !_.isUndefined(siteSettingsForServerAdmin.subscriptionSettings); });\r\n        };\r\n        CreateSiteAction.prototype.errorMessages = function (errors, site) {\r\n            var _this = this;\r\n            _.each(errors, function (error) {\r\n                _this.toaster.pop({ type: VizPortal.ToastType.Error, text: _this.Sites.errorMessage(error.code, site) });\r\n            });\r\n        };\r\n        CreateSiteAction.prototype.getPlaceholderSiteSettings = function () {\r\n            return this.isServerLevelSubscriptionsEnabled().then(function (isEnabled) {\r\n                var placeholderSiteSettings = {\r\n                    id: undefined,\r\n                    userCount: 1,\r\n                    licensedUserCount: 1,\r\n                    adminCount: undefined,\r\n                    availability: VizPortal.SiteAvailabilityState.ACTIVE,\r\n                    currentLoggedInUserCount: undefined,\r\n                    storageQuotaPercentUsed: undefined,\r\n                    storageUsedBytes: undefined,\r\n                    createdAt: undefined,\r\n                    settings: {\r\n                        urlName: '',\r\n                        name: '',\r\n                        storageQuotaEnabled: false,\r\n                        storageQuotaBytes: VizPortal.ByteSizeConversionFactor.ONE_GB,\r\n                        siteAdminsCanAddUsers: true,\r\n                        userQuotaEnabled: false,\r\n                        userQuota: 1,\r\n                        metricsEnabled: false,\r\n                        authoringEnabled: true,\r\n                        sheetImageEnabled: true\r\n                    }\r\n                };\r\n                if (isEnabled) {\r\n                    placeholderSiteSettings.subscriptionSettings = {\r\n                        subscriptionsEnabled: true,\r\n                        customSubscriptionEmailEnabled: false,\r\n                        customSubscriptionEmail: 'no-reply@tableau.com',\r\n                        customSubscriptionFooterEnabled: false,\r\n                        customSubscriptionFooter: ''\r\n                    };\r\n                }\r\n                return placeholderSiteSettings;\r\n            });\r\n        };\r\n        CreateSiteAction.$inject = [\r\n            'ConfirmActionDialog',\r\n            '$translate',\r\n            'ToasterService',\r\n            'ServerService',\r\n            'Sites',\r\n            '$q'\r\n        ];\r\n        return CreateSiteAction;\r\n    })();\r\n    VizPortal.CreateSiteAction = CreateSiteAction;\r\n    VizPortal.Module.instance().service('CreateSiteAction', CreateSiteAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../services/BrowserTitleService.ts\" />\r\n/// <reference path=\"../services/CreateSiteAction.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var AddSiteCtrl = (function () {\r\n        function AddSiteCtrl(scope, $state, BrowserTitleService, createSiteAction) {\r\n            BrowserTitleService.setTitle('serverSettings_addSite');\r\n            scope.createSite = function () { return createSiteAction.execute(scope)\r\n                .then(function () { return $state.go('main.server.sites.sites'); }); };\r\n        }\r\n        AddSiteCtrl.$inject = [\r\n            '$scope',\r\n            '$state',\r\n            'BrowserTitleService',\r\n            'CreateSiteAction'\r\n        ];\r\n        return AddSiteCtrl;\r\n    })();\r\n    VizPortal.AddSiteCtrl = AddSiteCtrl;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/Viz.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/BrowserSupportService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var VizService = (function () {\r\n        function VizService($state, $location, WindowLocationService, server, BrowserSupportService) {\r\n            this.$state = $state;\r\n            this.$location = $location;\r\n            this.WindowLocationService = WindowLocationService;\r\n            this.server = server;\r\n            this.BrowserSupportService = BrowserSupportService;\r\n        }\r\n        /**\r\n         * Reload the current state when the location changes. This is needed for two reasons\r\n         * 1. The query string parameters are not registered as $stateParams, so ui-router won't reload the state\r\n         *    if they change. We need to make it reload in this case.\r\n         * 2. If the $location changes but the $stateParams are identical to the $stateParams we originally entered\r\n         *    the $state with, then ui-router will not reload the $state. This can happen if a user types in url to\r\n         *    viz with vizPath `workbook/view1`, switches tabs by clicking on view2 so the url updates, then uses\r\n         *    the url to switch back to `workbook/view1`. Because `workbook/view1` is the $stateParam when we entered\r\n         *    the $state, ui-router will assume that nothing is changed and it won't reload. We force it to.\r\n         */\r\n        VizService.prototype.reloadOnLocationChange = function ($scope) {\r\n            var _this = this;\r\n            // reloadOnSearch must be true otherwise ui-router will not reload the state. Ever. No matter what you do.\r\n            this.$state.current.reloadOnSearch = true;\r\n            $scope.$on('$locationChangeSuccess', function () {\r\n                if (_this.$state.current.reloadOnSearch) {\r\n                    // We need to get the new state params. $state.$current gives us access to the internal state of ui-router.\r\n                    // It's partially documented in ui-router's documentation.\r\n                    var currentStateUrlMatcher = _this.$state.$current.url;\r\n                    var newStateParams = currentStateUrlMatcher.exec(_this.$location.path(), _this.$location.search());\r\n                    if (newStateParams) {\r\n                        // This transitionTo is a very particular hardReload.\r\n                        // location: false - tell ui-router to not update the location. Well, that's what you'd expect. ui-router\r\n                        //                   will still update the url if the original state's stateParams are different from\r\n                        //                   what's in the current url, but at least ui-router won't obliterate the query string\r\n                        //                   with `location: false`. This is good enough for our purposes.\r\n                        // reload: true - force ui-router to reload the view and controller\r\n                        _this.$state.transitionTo(_this.$state.current.name, newStateParams, { location: false, reload: true });\r\n                    }\r\n                }\r\n            });\r\n        };\r\n        /**\r\n         * Change $location due to a change in a url parameter\r\n         */\r\n        VizService.prototype.updatePath = function ($scope, params) {\r\n            var stateParams = _.extend(params, { siteUrlName: this.server.sessionSiteUrlName() });\r\n            var newLocationPath = this.$state.href(this.$state.current, stateParams);\r\n            // Remove the hash that ui-router puts on the front of the url\r\n            newLocationPath = newLocationPath.replace(/^#/, '');\r\n            // Decode because ui-router encodes the slashes in the url. This is safe to decode because\r\n            // the vizPath cannot contain characters that need to be url encoded\r\n            newLocationPath = decodeURIComponent(newLocationPath);\r\n            // Don't change location if path is unchanged\r\n            if (newLocationPath === this.$location.path()) {\r\n                return;\r\n            }\r\n            this.dontReloadNextLocationChange($scope);\r\n            this.$location.replace().path(newLocationPath);\r\n        };\r\n        VizService.prototype.updateInstanceId = function ($scope, instanceId) {\r\n            this.dontReloadNextLocationChange($scope);\r\n            this.$location.replace().search(VizService.InstanceIdKey, instanceId);\r\n        };\r\n        VizService.prototype.updateExplicitOriginalViz = function ($scope, explicitOriginalViz) {\r\n            this.dontReloadNextLocationChange($scope);\r\n            this.$location.replace().search(VizService.ExplicitOriginalVizParamKey, explicitOriginalViz ? 'y' : null);\r\n        };\r\n        VizService.prototype.getIsExplicitOriginalViz = function () {\r\n            return Helpers.BooleanQueryParamRegex.test(this.getExplicitLocationSearchValue(VizService.ExplicitOriginalVizParamKey));\r\n        };\r\n        VizService.prototype.getInstanceId = function () {\r\n            return this.getExplicitLocationSearchValue(VizService.InstanceIdKey);\r\n        };\r\n        // Returns query parameter value, or null if there is no explicit value.\r\n        // e.g. \"?:embed\" returns null, \":embed=blah\" returns \"blah\"\r\n        // Using $location.search() directly will give boolean true for keys that\r\n        // are present with no value.\r\n        VizService.prototype.getExplicitLocationSearchValue = function (key) {\r\n            var value = this.$location.search()[key];\r\n            return _.isString(value) ? value : null;\r\n        };\r\n        VizService.prototype.getVizParams = function () {\r\n            // Remove the instance id param, as it is only used on the frontend\r\n            return _.omit(this.$location.search(), VizService.InstanceIdKey);\r\n        };\r\n        VizService.prototype.getIsExplicitOriginalVizFromUrl = function (url) {\r\n            // TODO: we should parse a viz object from a url instead of having several of these\r\n            // one-off functions to get individual parts of the url. Can copy angular's url parsing code\r\n            var match = decodeURIComponent(url).match(/[&\\?]:original_view=([^&#$]+)/);\r\n            return !!(match && match[1] && Helpers.BooleanQueryParamRegex.test(match[1]));\r\n        };\r\n        /**\r\n         * Gets the viz path from a full url. For example, url:\r\n         *\r\n         * uri:     http://localhost/vizportal/#/views/sizetabs/auto/workgroupadmin@tsi.lan/noiceland?blah\r\n         * returns: sizetabs/auto/workgroupadmin@tsi.lan/noiceland\r\n         */\r\n        VizService.prototype.getPath = function (uri) {\r\n            var match = uri.match(/[^/]\\/views\\/([^?#]*)/);\r\n            return match && match[1] || null;\r\n        };\r\n        /**\r\n         * Build a JS-API-ready uri from a viz object\r\n         */\r\n        VizService.prototype.getUri = function (viz) {\r\n            var pathList = [this.WindowLocationService.getOrigin()];\r\n            if (viz.isAdminViz) {\r\n                pathList = pathList.concat(['vizql', 'showadminview']);\r\n            }\r\n            else {\r\n                if (viz.siteUrlName) {\r\n                    pathList = pathList.concat(['t', viz.siteUrlName]);\r\n                }\r\n                pathList.push('views');\r\n            }\r\n            pathList.push(viz.path);\r\n            return pathList.join('/');\r\n        };\r\n        /**\r\n         * returns true if embed search param is on in url\r\n         * Example: ?:embed=yes\r\n         */\r\n        VizService.prototype.isEmbedParamOn = function () {\r\n            return Helpers.BooleanQueryParamRegex.test(this.getExplicitLocationSearchValue(VizService.EmbedParamKey));\r\n        };\r\n        /**\r\n         * returns true if the end of the location path has a viz export file type.\r\n         * Example: /workbook/view.png\r\n         */\r\n        VizService.prototype.pathHasExportableFileType = function () {\r\n            return VizService.VizExportFileTypeRegex.test(this.$location.path());\r\n        };\r\n        /**\r\n         * Go to embedded version of the current url\r\n         */\r\n        VizService.prototype.getEmbeddedVizqlUrl = function (options) {\r\n            if (options === void 0) { options = {}; }\r\n            if (options.isFromGuest) {\r\n                this.$location.search(VizService.IsGuestRedirectFromVizPortalParamKey, 'y');\r\n            }\r\n            if (!this.isEmbedParamOn()) {\r\n                this.$location.search(VizService.EmbedParamKey, 'y');\r\n            }\r\n            return this.getVizqlUrl();\r\n        };\r\n        VizService.prototype.getVizqlUrl = function () {\r\n            return this.$location.url().replace(/^\\/site/, '/t');\r\n        };\r\n        VizService.prototype.dontReloadNextLocationChange = function ($scope) {\r\n            var _this = this;\r\n            // (myork 2014-10-7) We want to change the $location, but we don't want ui-router to reload\r\n            // the state. To do this we set this $state to `reloadOnSearch: false` until after the\r\n            // location change is successful. This is disgusting for three reasons:\r\n            //  1. It changes state configuration at runtime.\r\n            //  2. It relies on `reloadOnSearch: false` not reloading the state when path parameters change.\r\n            //     This is a bug in ui-router and we are relying on it. Once ui-router's dynamic parameters\r\n            //     feature is implemented, we should be able to use that:\r\n            //     https://github.com/angular-ui/ui-router/issues/1079\r\n            //  3. We rely on this $locationChangeSuccess firing after ui-router's own $locationChangeSuccess\r\n            //     listener. If this $locationChangeSuccess fired before ui-router's then we'd set\r\n            //     `reloadOnSearch: true` before the $stateChangeStart, so we wouldn't get the no-reload\r\n            //     behavior we're shooting for. I did not find a guarantee of this ordering in the docs,\r\n            //     but in the code the events fire in the order they are registered:\r\n            //     $on: https://github.com/angular/angular.js/blob/v1.2.x/src/ng/rootScope.js#L965\r\n            //     $broadcast: https://github.com/angular/angular.js/blob/v1.2.x/src/ng/rootScope.js#L1077\r\n            var removeEventListener = $scope.$on('$locationChangeSuccess', function () {\r\n                _this.$state.current.reloadOnSearch = true;\r\n                removeEventListener();\r\n            });\r\n            this.$state.current.reloadOnSearch = false;\r\n        };\r\n        VizService.$inject = [\r\n            '$state',\r\n            '$location',\r\n            'WindowLocationService',\r\n            'ServerService',\r\n            'BrowserSupportService'\r\n        ];\r\n        VizService.ExplicitOriginalVizParamKey = ':original_view';\r\n        VizService.EmbedParamKey = ':embed';\r\n        VizService.InstanceIdKey = ':iid';\r\n        VizService.IsGuestRedirectFromVizPortalParamKey = ':isGuestRedirectFromVizportal';\r\n        VizService.VizExportFileTypeRegex = /\\.(pdf|csv|png)$/;\r\n        return VizService;\r\n    })();\r\n    VizPortal.VizService = VizService;\r\n    VizPortal.Module.instance().service('VizService', VizService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/Viz.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/BrowserTitleService.ts\" />\r\n/// <reference path=\"../services/VizService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var AdminVizViewerCtrl = (function () {\r\n        function AdminVizViewerCtrl($scope, $stateParams, $location, $state, $translate, BrowserTitleService, vizService, workbookUrlId) {\r\n            var _this = this;\r\n            this.sheetUrlId = $stateParams.sheetUrlId;\r\n            $scope.viz = {\r\n                path: workbookUrlId + '/' + this.sheetUrlId,\r\n                isAdminViz: true,\r\n                params: $location.search()\r\n            };\r\n            vizService.reloadOnLocationChange($scope);\r\n            $scope.$watch('viz.path', function (newPath) {\r\n                _this.sheetUrlId = newPath.split('/')[1];\r\n                vizService.updatePath($scope, { sheetUrlId: _this.sheetUrlId });\r\n                BrowserTitleService.setVizTitle($scope.viewName(), $translate.instant($scope.isServerAnalysis() ? 'serverStatus' : 'siteStatus'));\r\n            });\r\n            $scope.isServerAnalysis = function () { return $state.includes('**.server.**'); };\r\n            $scope.viewName = function () { return $translate.instant(AdminVizViewerCtrl.ViewNameLocKeyDict[_this.sheetUrlId]); };\r\n        }\r\n        // We can't get admin view names from the Views service, so we use hardcoded loc strings\r\n        AdminVizViewerCtrl.ViewNameLocKeyDict = {\r\n            'ActionsbyAllUsers': 'actionsByAllUsersTitle',\r\n            'ActionsbySpecificUser': 'actionsByASpecificUserTitle',\r\n            'ActionsbyRecentUsers': 'actionsByRecentlySignedInUsersTitle',\r\n            'BackgroundTasksforExtracts': 'backgroundTasksExtractsTitle',\r\n            'BackgroundTasksforNonExtracts': 'backgroundTasksNonExtractsTitle',\r\n            'StatsforLoadTimes': 'statsLoadTimesTitle',\r\n            'StatsforSpaceUsage': 'statsSpaceUsageTitle',\r\n            'TraffictoDataSources': 'trafficToDataSourcesTitle',\r\n            'TraffictoViews': 'trafficToViewsTitle'\r\n        };\r\n        AdminVizViewerCtrl.$inject = [\r\n            '$scope',\r\n            '$stateParams',\r\n            '$location',\r\n            '$state',\r\n            '$translate',\r\n            'BrowserTitleService',\r\n            'VizService',\r\n            'workbookUrlId'\r\n        ];\r\n        return AdminVizViewerCtrl;\r\n    })();\r\n    VizPortal.AdminVizViewerCtrl = AdminVizViewerCtrl;\r\n    VizPortal.Module.instance().controller('AdminVizViewerCtrl', AdminVizViewerCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ConnectionAuthService = (function () {\r\n        function ConnectionAuthService($http) {\r\n            this.$http = $http;\r\n        }\r\n        ConnectionAuthService.prototype.authenticate = function (path, data) {\r\n            return this.$http({\r\n                method: 'POST',\r\n                url: path,\r\n                headers: {\r\n                    'Content-Type': 'application/x-www-form-urlencoded',\r\n                    'X-Requested-With': 'XMLHttpRequest'\r\n                },\r\n                data: $.param(data)\r\n            });\r\n        };\r\n        ConnectionAuthService.$inject = [\r\n            '$http',\r\n            '$window',\r\n            'WindowLocationService'\r\n        ];\r\n        return ConnectionAuthService;\r\n    })();\r\n    VizPortal.ConnectionAuthService = ConnectionAuthService;\r\n    VizPortal.Module.instance().service('ConnectionAuthService', ConnectionAuthService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    /**\r\n     * Contains window.location behavior not covered by angular's $location service.\r\n     *\r\n     * Why? The browser's window.location cannot be mocked. This adds one level of\r\n     * indirection between app code and window.location so we can mock for testing.\r\n     */\r\n    var WindowLocationService = (function () {\r\n        function WindowLocationService($window) {\r\n            this.$window = $window;\r\n        }\r\n        // Download the file at the uri\r\n        WindowLocationService.prototype.download = function (uri) {\r\n            this.navigateTo(uri);\r\n        };\r\n        WindowLocationService.prototype.formatWindowOpenSpecs = function (specs) {\r\n            return _.map(specs, function (val, key) { return (key + '=' + val); }).join(',');\r\n        };\r\n        // Open the given uri in a new window\r\n        WindowLocationService.prototype.open = function (uri, windowName, specs) {\r\n            if (windowName === void 0) { windowName = '_blank'; }\r\n            return this.$window.open(uri, windowName, this.formatWindowOpenSpecs(specs));\r\n        };\r\n        /**\r\n         * Sets the location to the given uri\r\n         */\r\n        WindowLocationService.prototype.navigateTo = function (uri) {\r\n            this.$window.location.href = uri;\r\n        };\r\n        /**\r\n         * Set the location of the given iframe\r\n         */\r\n        WindowLocationService.prototype.navigateIFrameTo = function (iframe, uri) {\r\n            iframe.contentWindow.location.href = uri;\r\n        };\r\n        WindowLocationService.prototype.navigateToWithoutAddingToHistory = function (uri) {\r\n            this.$window.location.replace(uri);\r\n        };\r\n        /**\r\n         * Cross-browser method for getting window.location.origin. Example:\r\n         * window.location.href : 'scheme://domain:port/path?query_string#fragment_id'\r\n         * return value         : 'scheme://domain:port'\r\n         */\r\n        WindowLocationService.prototype.getOrigin = function () {\r\n            return this.$window.location.protocol + '//' + this.$window.location.host;\r\n        };\r\n        /**\r\n         * Get everything after the host in a url.  Example:\r\n         *\r\n         *    window.location.href : 'scheme://domain:port/path?query_string#fragment_id'\r\n         *    return value         : '/path?query_string#fragment_id'\r\n         */\r\n        WindowLocationService.prototype.getPathQueryFragment = function () {\r\n            return this.$window.location.href.split(this.$window.location.host)[1];\r\n        };\r\n        /**\r\n         * Get path and query components of url.  Example:\r\n         *\r\n         *    window.location.href : 'scheme://domain:port/path?query_string#fragment_id'\r\n         *    return value         : '/path?query_string'\r\n         */\r\n        WindowLocationService.prototype.getPathQuery = function () {\r\n            return this.getPathQueryFragment().replace(this.$window.location.hash, '');\r\n        };\r\n        /**\r\n         * Set everything after the host in a url. Example:\r\n         *\r\n         *    pathQueryFragment    : '/path?query_string#fragment_id'\r\n         *    window.location.href : 'scheme://domain:port/path?query_string#fragment_id'\r\n         */\r\n        WindowLocationService.prototype.setPathQueryFragment = function (pathQueryFragment) {\r\n            this.$window.location.href = this.getOrigin() + (/^\\//.test(pathQueryFragment) ? '' : '/') + pathQueryFragment;\r\n        };\r\n        WindowLocationService.prototype.reload = function () {\r\n            this.$window.location.reload();\r\n        };\r\n        WindowLocationService.$inject = ['$window'];\r\n        return WindowLocationService;\r\n    })();\r\n    VizPortal.WindowLocationService = WindowLocationService;\r\n    VizPortal.Module.instance().service('WindowLocationService', WindowLocationService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var WindowPopupService = (function () {\r\n        function WindowPopupService($location, $stateParams, $window) {\r\n            this.$location = $location;\r\n            this.$stateParams = $stateParams;\r\n            this.$window = $window;\r\n        }\r\n        WindowPopupService.prototype.safelyCallFunction = function (func) {\r\n            try {\r\n                func();\r\n            }\r\n            catch (e) {\r\n                console.error(e);\r\n            }\r\n        };\r\n        WindowPopupService.prototype.maybeNotifyAndClose = function () {\r\n            var closePopupWhenDone = Helpers.BooleanQueryParamRegex.test(this.$location.search()[VizPortal.UrlParamKeys.ClosePopupWhenDone]);\r\n            var openerPage = this.$window.opener;\r\n            if (openerPage && closePopupWhenDone) {\r\n                if (openerPage.tableauPopupComplete) {\r\n                    this.safelyCallFunction(function () { return openerPage.tableauPopupComplete(); });\r\n                }\r\n                if (openerPage.tab && openerPage.tab.LogOnView) {\r\n                    this.safelyCallFunction(function () { return openerPage.tab.LogOnView.fireLogOnComplete(); });\r\n                }\r\n                this.$window.close();\r\n                return true;\r\n            }\r\n        };\r\n        WindowPopupService.$inject = [\r\n            '$location',\r\n            '$stateParams',\r\n            '$window'\r\n        ];\r\n        return WindowPopupService;\r\n    })();\r\n    VizPortal.WindowPopupService = WindowPopupService;\r\n    VizPortal.Module.instance().service('WindowPopupService', WindowPopupService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/ConnectionAuthService.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\n/// <reference path=\"../services/WindowLocationService.ts\" />\r\n/// <reference path=\"../services/WindowPopupService.ts\" />\r\n/// <reference path=\"../ServerApi/types/IDataConnectionAuthInfo.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var AuthenticateConnectionCtrl = (function () {\r\n        function AuthenticateConnectionCtrl($scope, $stateParams, connectionAuthService, windowLocationService, authInfo, windowPopupService) {\r\n            var _this = this;\r\n            this.$scope = $scope;\r\n            this.$stateParams = $stateParams;\r\n            this.connectionAuthService = connectionAuthService;\r\n            this.windowLocationService = windowLocationService;\r\n            this.authInfo = authInfo;\r\n            this.windowPopupService = windowPopupService;\r\n            $scope.authVM = {};\r\n            $scope.authVM.username = authInfo.defaultUsername;\r\n            $scope.focusOnPassword = !!authInfo.defaultUsername;\r\n            $scope.doneWithWindow = false;\r\n            $scope.rememberPasswordsForever = authInfo.rememberPasswordsForever;\r\n            // If there is 1 allowedAuthenticationMode, then try to get the friendly name if it exists.\r\n            // If there are 2 or more allowedAuthenticationModes then list the options for the user.\r\n            var authModeFriendlyName; // Localized authentication mode for the current authentication mode\r\n            if (authInfo.allowedAuthenticationModes) {\r\n                if (authInfo.allowedAuthenticationModes.length === 1) {\r\n                    authModeFriendlyName = authInfo.allowedAuthenticationModes[0].modeFriendlyName;\r\n                }\r\n                else if (authInfo.allowedAuthenticationModes.length >= 2) {\r\n                    $scope.authModeOptions = authInfo.allowedAuthenticationModes;\r\n                }\r\n            }\r\n            $scope.authVM.selectedAuthMode = authInfo.authenticationMode;\r\n            $scope.connectionProperties = [];\r\n            var cp = $scope.connectionProperties; // Alias for readability\r\n            if (authInfo.connectionType)\r\n                cp.push({ translate: 'authConnectionConnectionType', value: authInfo.connectionTypeDisplayName });\r\n            if (authModeFriendlyName)\r\n                cp.push({ translate: 'authConnectionAuthentication', value: authModeFriendlyName, tbTestId: 'auth-connection-fixed-auth-mode' });\r\n            if (authInfo.databaseServer)\r\n                cp.push({ translate: 'authConnectionServer', value: authInfo.databaseServer });\r\n            if (authInfo.databaseName)\r\n                cp.push({ translate: 'authConnectionDatabase', value: authInfo.databaseName });\r\n            if (authInfo.databaseSchema)\r\n                cp.push({ translate: 'authConnectionSchema', value: authInfo.databaseSchema });\r\n            if (authInfo.databaseFilename)\r\n                cp.push({ translate: 'authConnectionFilename', value: authInfo.databaseFilename });\r\n            $scope.attemptAuth = function () {\r\n                $scope.busy = true;\r\n                // TODO Figure out the correct response from the authenticate method\r\n                connectionAuthService.authenticate(authInfo.actionPath, _this.getAuthenticateDatabaseParams())\r\n                    .then(function () {\r\n                    // Authoring sessions are not opened in a popup window and need to remain open after authenticating\r\n                    if (authInfo.isAuthoringSession || !windowPopupService.maybeNotifyAndClose()) {\r\n                        windowLocationService.navigateTo($stateParams.path);\r\n                    }\r\n                    // toggle a state that shows a 'close me' message (tfsid 389619)\r\n                    $scope.doneWithWindow = true;\r\n                    $scope.busy = false;\r\n                }, function () {\r\n                    // TODO: better error reporting once we figure out what kind of errors to expect\r\n                    $scope.errorMessageKey = 'errorUnknown';\r\n                    $scope.busy = false;\r\n                });\r\n            };\r\n            $scope.isPreview = Helpers.BooleanQueryParamRegex.test($stateParams.isPreview);\r\n        }\r\n        AuthenticateConnectionCtrl.prototype.getAuthenticateDatabaseParams = function () {\r\n            var authParams = {\r\n                authentication: this.$scope.authVM.selectedAuthMode,\r\n                username: this.$scope.authVM.username,\r\n                crypted: rsa.encrypt(this.$scope.authVM.password, { n: this.authInfo.modulus, e: this.authInfo.exponent }),\r\n                connection: this.authInfo.connection,\r\n                path: this.$stateParams.path,\r\n                oauthrequest: false // BUGZID: 408070 Set oauthrequest to false for all non-OAuth scenarios\r\n            };\r\n            if (this.$scope.authVM.rememberPassword) {\r\n                if (this.authInfo.rememberPasswordsForever)\r\n                    authParams.reuse_forever = true;\r\n                if (!this.authInfo.rememberPasswordsForever)\r\n                    authParams.reuse = true;\r\n            }\r\n            return authParams;\r\n        };\r\n        AuthenticateConnectionCtrl.$inject = [\r\n            '$scope',\r\n            '$stateParams',\r\n            'ConnectionAuthService',\r\n            'WindowLocationService',\r\n            'authInfo',\r\n            'WindowPopupService'\r\n        ];\r\n        return AuthenticateConnectionCtrl;\r\n    })();\r\n    VizPortal.AuthenticateConnectionCtrl = AuthenticateConnectionCtrl;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../ServerApi/types/IOrderClause.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var Order;\r\n    (function (Order) {\r\n        Order.MaxLength = 3;\r\n        function clauseFromInput(input) {\r\n            var parts = input.split(':');\r\n            if (parts.length === 2) {\r\n                return {\r\n                    field: parts[0],\r\n                    ascending: parts[1] === 'asc'\r\n                };\r\n            }\r\n            else {\r\n                return null;\r\n            }\r\n        }\r\n        // If possibleOrderKeys does not exist then allow all keys\r\n        function isValidOrderField(field, possibleOrderKeys) {\r\n            return _.isUndefined(possibleOrderKeys) ? true : _(possibleOrderKeys).contains(field);\r\n        }\r\n        function fromInput(input, possibleOrderKeys) {\r\n            var clauses = [];\r\n            if (_.isString(input)) {\r\n                _.each(input.split(','), function (clauseString) {\r\n                    var clause = clauseFromInput(clauseString);\r\n                    if (clause && isValidOrderField(clause.field, possibleOrderKeys) && clauses.length < Order.MaxLength) {\r\n                        clauses.push(clause);\r\n                    }\r\n                });\r\n            }\r\n            return _.isEmpty(clauses) ? null : clauses;\r\n        }\r\n        Order.fromInput = fromInput;\r\n        function startsWithField(clauses, field) {\r\n            return clauses.length > 0 && clauses[0].field === field;\r\n        }\r\n        Order.startsWithField = startsWithField;\r\n        function withFirstClauseToggled(clauses) {\r\n            var newClauses = _.map(clauses, _.clone);\r\n            if (newClauses.length > 0) {\r\n                newClauses[0].ascending = !newClauses[0].ascending;\r\n            }\r\n            return newClauses;\r\n        }\r\n        Order.withFirstClauseToggled = withFirstClauseToggled;\r\n        function withClausePrepended(clauses, newClause) {\r\n            var newClauses;\r\n            if (newClause) {\r\n                // remove any existing clauses for the given field (note that reject returns a copy)\r\n                newClauses = _.reject(clauses, function (clause) { return clause.field === newClause.field; });\r\n                // prepend the given clause\r\n                newClauses.unshift(newClause);\r\n                // enforce the maximum length\r\n                if (newClauses.length > Order.MaxLength) {\r\n                    newClauses.length = Order.MaxLength;\r\n                }\r\n            }\r\n            else {\r\n                newClauses = _.clone(clauses);\r\n            }\r\n            return newClauses;\r\n        }\r\n        Order.withClausePrepended = withClausePrepended;\r\n        function asc(field) {\r\n            return { field: field, ascending: true };\r\n        }\r\n        Order.asc = asc;\r\n        function desc(field) {\r\n            return { field: field, ascending: false };\r\n        }\r\n        Order.desc = desc;\r\n        function withoutField(order, field) {\r\n            if (!field)\r\n                return order;\r\n            return _.reject(order, function (orderClause) { return orderClause.field === field; });\r\n        }\r\n        Order.withoutField = withoutField;\r\n        /**\r\n         * Finds the order clause for the field in the order. Returns undefined if no clause is found.\r\n         */\r\n        function findOrderClauseForField(order, field) {\r\n            return _.findWhere(order, { field: field });\r\n        }\r\n        Order.findOrderClauseForField = findOrderClauseForField;\r\n        function serialize(order) {\r\n            return _.map(order, serializeOrderClause).join(',');\r\n        }\r\n        Order.serialize = serialize;\r\n        function serializeOrderClause(clause) {\r\n            return clause.field + ':' + (clause.ascending ? 'asc' : 'desc');\r\n        }\r\n    })(Order = VizPortal.Order || (VizPortal.Order = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.OrderKeys = {\r\n        adminCount: 'adminCount',\r\n        authoringEnabled: 'authoringEnabled',\r\n        availability: 'availability',\r\n        connectionTypeDisplayName: 'connectionTypeDisplayName',\r\n        currentLoggedInUserCount: 'currentLoggedInUserCount',\r\n        createdAt: 'createdAt',\r\n        datasourceCount: 'datasourceCount',\r\n        definition: 'definition',\r\n        displayName: 'displayName',\r\n        domainName: 'domainName',\r\n        favoritesTotal: 'favoritesTotal',\r\n        groupCount: 'groupCount',\r\n        hasAlert: 'hasAlert',\r\n        hasExtracts: 'hasExtracts',\r\n        hitsTotal: 'hitsTotal',\r\n        hitsLastDayTotal: 'hitsLastDayTotal',\r\n        hitsLastMonthTotal: 'hitsLastMonthTotal',\r\n        hitsLastTwoWeeksTotal: 'hitsLastTwoWeeksTotal',\r\n        index: 'index',\r\n        lastRefreshedAt: 'lastRefreshedAt',\r\n        lastRunAt: 'lastRunAt',\r\n        lastSentAt: 'lastSentAt',\r\n        lastSignIn: 'lastSignIn',\r\n        liveDBConnectionsWhitelistEnabled: 'liveDBConnectionsWhitelistEnabled',\r\n        maxSiteRole: \"maxSiteRole\",\r\n        metricsEnabled: 'metricsEnabled',\r\n        minimumSiteRole: 'minimumSiteRole',\r\n        name: 'name',\r\n        numSheets: 'numSheets',\r\n        ownerName: 'ownerName',\r\n        parentName: 'parentName',\r\n        priority: 'priority',\r\n        projectName: 'projectName',\r\n        refreshType: 'refreshType',\r\n        relevancy: 'relevancy',\r\n        runNextAt: 'runNextAt',\r\n        scheduleName: 'scheduleName',\r\n        siteAdminsCanAddUsers: 'siteAdminsCanAddUsers',\r\n        siteCount: 'siteCount',\r\n        siteName: 'siteName',\r\n        siteRole: 'siteRole',\r\n        size: 'size',\r\n        sheetImageEnabled: 'sheetImageEnabled',\r\n        storageQuotaBytes: 'storageQuotaBytes',\r\n        storageQuotaPercentUsed: 'storageQuotaPercentUsed',\r\n        storageUsedBytes: 'storageUsedBytes',\r\n        subject: 'subject',\r\n        targetName: 'targetName',\r\n        type: 'type',\r\n        updatedAt: 'updatedAt',\r\n        urlName: 'urlName',\r\n        userCount: 'userCount',\r\n        userName: 'userName',\r\n        username: 'username',\r\n        userQuota: 'userQuota',\r\n        versionNumber: 'versionNumber',\r\n        viewCount: 'viewCount',\r\n        workbookCount: 'workbookCount',\r\n        workbookName: 'workbookName'\r\n    };\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/Order.ts\" />\r\n/// <reference path=\"../models/ContentFilters.ts\" />\r\n/// <reference path=\"../models/OrderKeys.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.ProjectContentType = {\r\n        name: 'project',\r\n        filterKeys: [\r\n            VizPortal.ContentFiltersKeys.search,\r\n            VizPortal.ContentFiltersKeys.owner,\r\n            VizPortal.ContentFiltersKeys.createdAfter,\r\n            VizPortal.ContentFiltersKeys.createdBefore\r\n        ],\r\n        orderKeys: [\r\n            VizPortal.OrderKeys.createdAt,\r\n            VizPortal.OrderKeys.datasourceCount,\r\n            VizPortal.OrderKeys.name,\r\n            VizPortal.OrderKeys.ownerName,\r\n            VizPortal.OrderKeys.viewCount,\r\n            VizPortal.OrderKeys.workbookCount\r\n        ],\r\n        defaultOrder: [VizPortal.Order.asc(VizPortal.OrderKeys.name)]\r\n    };\r\n    VizPortal.WorkbookContentType = {\r\n        name: 'workbook',\r\n        filterKeys: [\r\n            VizPortal.ContentFiltersKeys.search,\r\n            VizPortal.ContentFiltersKeys.favorite,\r\n            VizPortal.ContentFiltersKeys.recent,\r\n            VizPortal.ContentFiltersKeys.hasAlert,\r\n            VizPortal.ContentFiltersKeys.project,\r\n            VizPortal.ContentFiltersKeys.owner,\r\n            VizPortal.ContentFiltersKeys.tag,\r\n            VizPortal.ContentFiltersKeys.modifiedAfter,\r\n            VizPortal.ContentFiltersKeys.modifiedBefore\r\n        ],\r\n        orderKeys: [\r\n            VizPortal.OrderKeys.name,\r\n            VizPortal.OrderKeys.favoritesTotal,\r\n            VizPortal.OrderKeys.hitsTotal,\r\n            VizPortal.OrderKeys.hitsLastDayTotal,\r\n            VizPortal.OrderKeys.hitsLastMonthTotal,\r\n            VizPortal.OrderKeys.hitsLastTwoWeeksTotal,\r\n            VizPortal.OrderKeys.numSheets,\r\n            VizPortal.OrderKeys.ownerName,\r\n            VizPortal.OrderKeys.projectName,\r\n            VizPortal.OrderKeys.size,\r\n            VizPortal.OrderKeys.updatedAt,\r\n            VizPortal.OrderKeys.hasAlert\r\n        ],\r\n        extraQueryParams: {\r\n            statFields: [VizPortal.OrderKeys.hitsTotal, VizPortal.OrderKeys.favoritesTotal, VizPortal.OrderKeys.hitsLastTwoWeeksTotal]\r\n        },\r\n        defaultOrder: [VizPortal.Order.asc(VizPortal.OrderKeys.name)]\r\n    };\r\n    VizPortal.WorkbookRevisionContentType = {\r\n        name: 'workbookRevision',\r\n        filterKeys: [],\r\n        orderKeys: [\r\n            VizPortal.OrderKeys.versionNumber\r\n        ],\r\n        defaultOrder: [VizPortal.Order.desc(VizPortal.OrderKeys.versionNumber)]\r\n    };\r\n    VizPortal.ViewContentType = {\r\n        name: 'view',\r\n        filterKeys: [\r\n            VizPortal.ContentFiltersKeys.search,\r\n            VizPortal.ContentFiltersKeys.favorite,\r\n            VizPortal.ContentFiltersKeys.recent,\r\n            VizPortal.ContentFiltersKeys.project,\r\n            VizPortal.ContentFiltersKeys.owner,\r\n            VizPortal.ContentFiltersKeys.tag,\r\n            VizPortal.ContentFiltersKeys.modifiedAfter,\r\n            VizPortal.ContentFiltersKeys.modifiedBefore\r\n        ],\r\n        orderKeys: [\r\n            VizPortal.OrderKeys.index,\r\n            VizPortal.OrderKeys.name,\r\n            VizPortal.OrderKeys.ownerName,\r\n            VizPortal.OrderKeys.projectName,\r\n            VizPortal.OrderKeys.updatedAt,\r\n            VizPortal.OrderKeys.workbookName\r\n        ],\r\n        defaultOrder: [VizPortal.Order.asc(VizPortal.OrderKeys.name)]\r\n    };\r\n    VizPortal.ViewInWorkbookContentType = _.extend({}, VizPortal.ViewContentType, {\r\n        defaultOrder: [VizPortal.Order.asc(VizPortal.OrderKeys.index)]\r\n    });\r\n    VizPortal.DatasourceContentType = {\r\n        name: 'datasource',\r\n        filterKeys: [\r\n            VizPortal.ContentFiltersKeys.search,\r\n            VizPortal.ContentFiltersKeys.hasAlert,\r\n            VizPortal.ContentFiltersKeys.project,\r\n            VizPortal.ContentFiltersKeys.owner,\r\n            VizPortal.ContentFiltersKeys.tag,\r\n            VizPortal.ContentFiltersKeys.modifiedAfter,\r\n            VizPortal.ContentFiltersKeys.modifiedBefore,\r\n            VizPortal.ContentFiltersKeys.hasExtracts,\r\n            VizPortal.ContentFiltersKeys.showEmbedded,\r\n            VizPortal.ContentFiltersKeys.connectionType,\r\n            VizPortal.ContentFiltersKeys.serverName,\r\n            VizPortal.ContentFiltersKeys.serverPort,\r\n            VizPortal.ContentFiltersKeys.databaseUsername,\r\n            VizPortal.ContentFiltersKeys.hasPassword\r\n        ],\r\n        orderKeys: [\r\n            VizPortal.OrderKeys.connectionTypeDisplayName,\r\n            VizPortal.OrderKeys.hasExtracts,\r\n            VizPortal.OrderKeys.hasAlert,\r\n            VizPortal.OrderKeys.lastRefreshedAt,\r\n            VizPortal.OrderKeys.name,\r\n            VizPortal.OrderKeys.ownerName,\r\n            VizPortal.OrderKeys.projectName,\r\n            VizPortal.OrderKeys.updatedAt\r\n        ],\r\n        defaultOrder: [VizPortal.Order.asc(VizPortal.OrderKeys.name)]\r\n    };\r\n    VizPortal.SitesContentType = {\r\n        name: 'sites',\r\n        filterKeys: [\r\n            VizPortal.ContentFiltersKeys.search\r\n        ],\r\n        orderKeys: [\r\n            VizPortal.OrderKeys.adminCount,\r\n            VizPortal.OrderKeys.authoringEnabled,\r\n            VizPortal.OrderKeys.availability,\r\n            VizPortal.OrderKeys.createdAt,\r\n            VizPortal.OrderKeys.currentLoggedInUserCount,\r\n            VizPortal.OrderKeys.liveDBConnectionsWhitelistEnabled,\r\n            VizPortal.OrderKeys.metricsEnabled,\r\n            VizPortal.OrderKeys.name,\r\n            VizPortal.OrderKeys.sheetImageEnabled,\r\n            VizPortal.OrderKeys.siteAdminsCanAddUsers,\r\n            VizPortal.OrderKeys.storageUsedBytes,\r\n            VizPortal.OrderKeys.storageQuotaBytes,\r\n            VizPortal.OrderKeys.storageQuotaPercentUsed,\r\n            VizPortal.OrderKeys.urlName,\r\n            VizPortal.OrderKeys.userCount,\r\n            VizPortal.OrderKeys.userQuota\r\n        ],\r\n        defaultOrder: [VizPortal.Order.asc(VizPortal.OrderKeys.name)]\r\n    };\r\n    VizPortal.GroupContentType = {\r\n        name: 'group',\r\n        filterKeys: [\r\n            VizPortal.ContentFiltersKeys.search,\r\n            VizPortal.ContentFiltersKeys.domain,\r\n            VizPortal.ContentFiltersKeys.groupsMinimumSiteRole\r\n        ],\r\n        orderKeys: [\r\n            VizPortal.OrderKeys.name,\r\n            VizPortal.OrderKeys.domainName,\r\n            VizPortal.OrderKeys.userCount,\r\n            VizPortal.OrderKeys.minimumSiteRole\r\n        ],\r\n        defaultOrder: [VizPortal.Order.asc(VizPortal.OrderKeys.name)]\r\n    };\r\n    VizPortal.SiteUserContentType = {\r\n        name: 'siteUser',\r\n        filterKeys: [\r\n            VizPortal.ContentFiltersKeys.search,\r\n            VizPortal.ContentFiltersKeys.siteRole\r\n        ],\r\n        orderKeys: [\r\n            VizPortal.OrderKeys.displayName,\r\n            VizPortal.OrderKeys.domainName,\r\n            VizPortal.OrderKeys.groupCount,\r\n            VizPortal.OrderKeys.lastSignIn,\r\n            VizPortal.OrderKeys.siteRole,\r\n            VizPortal.OrderKeys.username\r\n        ],\r\n        defaultOrder: [VizPortal.Order.asc(VizPortal.OrderKeys.displayName)]\r\n    };\r\n    VizPortal.ScheduleContentType = {\r\n        name: 'schedule',\r\n        filterKeys: [],\r\n        orderKeys: [\r\n            VizPortal.OrderKeys.name,\r\n            'scheduleType',\r\n            'scheduledAction',\r\n            'taskCount',\r\n            'parallel',\r\n            'runNextAt'\r\n        ],\r\n        defaultOrder: [VizPortal.Order.asc(VizPortal.OrderKeys.name)]\r\n    };\r\n    VizPortal.ExtractTaskContentType = {\r\n        name: 'extractTask',\r\n        filterKeys: [],\r\n        orderKeys: [\r\n            VizPortal.OrderKeys.type,\r\n            VizPortal.OrderKeys.targetName,\r\n            VizPortal.OrderKeys.scheduleName,\r\n            VizPortal.OrderKeys.priority,\r\n            VizPortal.OrderKeys.lastRunAt,\r\n            VizPortal.OrderKeys.runNextAt,\r\n            VizPortal.OrderKeys.siteName\r\n        ],\r\n        defaultOrder: [VizPortal.Order.asc(VizPortal.OrderKeys.targetName)]\r\n    };\r\n    VizPortal.RemoteRefreshScheduleContentType = {\r\n        name: 'remoteRefreshSchedule',\r\n        filterKeys: [],\r\n        orderKeys: [\r\n            VizPortal.OrderKeys.refreshType,\r\n            VizPortal.OrderKeys.definition,\r\n            VizPortal.OrderKeys.lastRunAt,\r\n            VizPortal.OrderKeys.runNextAt\r\n        ],\r\n        defaultOrder: [VizPortal.Order.asc(VizPortal.OrderKeys.runNextAt)]\r\n    };\r\n    VizPortal.SubscriptionContentType = {\r\n        name: 'subscription',\r\n        filterKeys: [],\r\n        orderKeys: [\r\n            VizPortal.OrderKeys.userName,\r\n            VizPortal.OrderKeys.subject,\r\n            VizPortal.OrderKeys.scheduleName,\r\n            VizPortal.OrderKeys.lastSentAt,\r\n            VizPortal.OrderKeys.runNextAt,\r\n            VizPortal.OrderKeys.siteName\r\n        ],\r\n        defaultOrder: [VizPortal.Order.asc(VizPortal.OrderKeys.subject)]\r\n    };\r\n    VizPortal.ServerUserContentType = {\r\n        name: 'serverUser',\r\n        filterKeys: [\r\n            VizPortal.ContentFiltersKeys.search,\r\n            VizPortal.ContentFiltersKeys.maxSiteRole\r\n        ],\r\n        orderKeys: [\r\n            VizPortal.OrderKeys.displayName,\r\n            VizPortal.OrderKeys.domainName,\r\n            VizPortal.OrderKeys.siteCount,\r\n            VizPortal.OrderKeys.lastSignIn,\r\n            VizPortal.OrderKeys.maxSiteRole,\r\n            VizPortal.OrderKeys.username\r\n        ],\r\n        defaultOrder: [VizPortal.Order.asc(VizPortal.OrderKeys.displayName)]\r\n    };\r\n    VizPortal.GroupUserContentType = {\r\n        name: 'groupUser',\r\n        filterKeys: [],\r\n        orderKeys: [\r\n            VizPortal.OrderKeys.displayName,\r\n            VizPortal.OrderKeys.siteCount,\r\n            VizPortal.OrderKeys.lastSignIn,\r\n            VizPortal.OrderKeys.siteRole,\r\n            VizPortal.OrderKeys.username\r\n        ],\r\n        defaultOrder: [VizPortal.Order.asc(VizPortal.OrderKeys.displayName)]\r\n    };\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/ContentTypes.ts\" />\r\n/// <reference path=\"../ServerApi/types/IOrderClause.ts\" />\r\n/// <reference path=\"../ServerApi/types/resourceParts.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    // TODO: these should be removed.\r\n    VizPortal.ContentTypes = {\r\n        project: VizPortal.ProjectContentType.name,\r\n        datasource: VizPortal.DatasourceContentType.name,\r\n        workbook: VizPortal.WorkbookContentType.name,\r\n        view: VizPortal.ViewContentType.name\r\n    };\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ListResult = (function () {\r\n        function ListResult(items, index, total) {\r\n            this.items = items;\r\n            this.index = index || 0;\r\n            this.total = total || (items ? items.length : 0);\r\n        }\r\n        ListResult.empty = function () {\r\n            return new ListResult([], 0, 0);\r\n        };\r\n        return ListResult;\r\n    })();\r\n    VizPortal.ListResult = ListResult;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        ServerApi.FilterOps = {\r\n            and: 'and',\r\n            eq: 'eq',\r\n            lte: 'lte',\r\n            gte: 'gte',\r\n            has: 'has',\r\n            inArray: 'in',\r\n            matches: 'matches'\r\n        };\r\n        ServerApi.FilterFieldNames = {\r\n            connectionType: 'connectionType',\r\n            createdAt: 'createdAt',\r\n            databaseUsername: 'databaseUsername',\r\n            datasourceId: 'datasourceId',\r\n            domainId: 'domainId',\r\n            groupId: 'groupId',\r\n            groupIds: 'groupIds',\r\n            hasAlert: 'hasAlert',\r\n            hasExtracts: 'hasExtracts',\r\n            hasEmbeddedPassword: 'hasEmbeddedPassword',\r\n            isDefaultPort: 'isDefaultPort',\r\n            isFavorite: 'isFavorite',\r\n            isPublished: 'isPublished',\r\n            isRecent: 'isRecent',\r\n            lastRefreshedAt: 'lastRefreshedAt',\r\n            maxSiteRole: 'maxSiteRole',\r\n            minimumSiteRole: 'minimumSiteRole',\r\n            ownerId: 'ownerId',\r\n            parentId: 'parentId',\r\n            parentType: 'parentType',\r\n            projectId: 'projectId',\r\n            scheduledAction: 'scheduledAction',\r\n            scheduleId: 'scheduleId',\r\n            serverName: 'serverName',\r\n            serverPort: 'serverPort',\r\n            siteId: 'siteId',\r\n            siteRole: 'siteRole',\r\n            tags: 'tags',\r\n            updatedAt: 'updatedAt',\r\n            workbookId: 'workbookId'\r\n        };\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"IFilterClause.ts\" />\r\n/// <reference path=\"IOrderClause.ts\" />\r\n/// <reference path=\"IPage.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"ListResult.ts\" />\r\n/// <reference path=\"../ServerApi/types/IGetItemsParams.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../ServerApi/types/IFilterClause.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var Filter;\r\n    (function (Filter) {\r\n        function and(clauses) {\r\n            return {\r\n                operator: VizPortal.ServerApi.FilterOps.and,\r\n                clauses: clauses\r\n            };\r\n        }\r\n        Filter.and = and;\r\n        function search(search) {\r\n            return {\r\n                operator: VizPortal.ServerApi.FilterOps.matches,\r\n                value: search\r\n            };\r\n        }\r\n        Filter.search = search;\r\n        function fieldEq(field, value) {\r\n            return {\r\n                operator: VizPortal.ServerApi.FilterOps.eq,\r\n                field: field,\r\n                value: value\r\n            };\r\n        }\r\n        Filter.fieldEq = fieldEq;\r\n        function stringFieldEq(field, value) {\r\n            return fieldEq(field, value);\r\n        }\r\n        Filter.stringFieldEq = stringFieldEq;\r\n        function numberFieldEq(field, value) {\r\n            return fieldEq(field, value);\r\n        }\r\n        Filter.numberFieldEq = numberFieldEq;\r\n        function stringFieldGte(field, value) {\r\n            return {\r\n                operator: VizPortal.ServerApi.FilterOps.gte,\r\n                field: field,\r\n                value: value\r\n            };\r\n        }\r\n        Filter.stringFieldGte = stringFieldGte;\r\n        function stringFieldLte(field, value) {\r\n            return {\r\n                operator: VizPortal.ServerApi.FilterOps.lte,\r\n                field: field,\r\n                value: value\r\n            };\r\n        }\r\n        Filter.stringFieldLte = stringFieldLte;\r\n        function stringFieldMatches(field, value) {\r\n            return {\r\n                operator: VizPortal.ServerApi.FilterOps.matches,\r\n                field: field,\r\n                value: value\r\n            };\r\n        }\r\n        Filter.stringFieldMatches = stringFieldMatches;\r\n        function stringArrayFieldHas(field, value) {\r\n            return {\r\n                operator: VizPortal.ServerApi.FilterOps.has,\r\n                field: field,\r\n                value: value\r\n            };\r\n        }\r\n        Filter.stringArrayFieldHas = stringArrayFieldHas;\r\n        function stringFieldInArray(field, values) {\r\n            return {\r\n                operator: VizPortal.ServerApi.FilterOps.inArray,\r\n                field: field,\r\n                values: values\r\n            };\r\n        }\r\n        Filter.stringFieldInArray = stringFieldInArray;\r\n        function findFieldFilterClause(field, operator, filter) {\r\n            if (filter && filter.clauses) {\r\n                return _.find(filter.clauses, function (clause) {\r\n                    var fieldClause = clause;\r\n                    return fieldClause.field === field && fieldClause.operator === operator;\r\n                });\r\n            }\r\n            return null;\r\n        }\r\n        Filter.findFieldFilterClause = findFieldFilterClause;\r\n    })(Filter = VizPortal.Filter || (VizPortal.Filter = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../fetchers/ListResult.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../fetchers/IListFetcher.ts\" />\r\n/// <reference path=\"../helpers/Filter.ts\" />\r\n/// <reference path=\"../models/ISliceable.ts\" />\r\n/// <reference path=\"../ServerApi/types/IOrderClause.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ResourceQuery = (function () {\r\n        function ResourceQuery(fetcher) {\r\n            this.fetcher = fetcher;\r\n            this.filterClauses = [];\r\n            this.order = [];\r\n            this.extraParams = {};\r\n        }\r\n        ResourceQuery.formatFilterClauses = function (filterClauses) {\r\n            return (filterClauses && filterClauses.length > 0) ? VizPortal.Filter.and(filterClauses) : undefined;\r\n        };\r\n        ResourceQuery.getPage = function (start, length) {\r\n            return { startIndex: start, maxItems: length };\r\n        };\r\n        ResourceQuery.prototype.getSlice = function (start, size) {\r\n            return this.fetcher.fetchList(_.extend({\r\n                filter: ResourceQuery.formatFilterClauses(this.filterClauses),\r\n                order: this.order.length > 0 ? this.order : undefined,\r\n                page: ResourceQuery.getPage(start, size)\r\n            }, this.extraParams));\r\n        };\r\n        ResourceQuery.prototype.getFirst = function () {\r\n            return this.getSlice(0, 1).then(function (result) {\r\n                if (result.items && result.items.length > 0) {\r\n                    return result.items[0];\r\n                }\r\n                else {\r\n                    return null;\r\n                }\r\n            });\r\n        };\r\n        ResourceQuery.prototype.getCount = function () {\r\n            return this.getSlice(0, 0).then(function (slice) { return slice.total; });\r\n        };\r\n        // caller should not alter the returned array\r\n        ResourceQuery.prototype.getFilters = function () {\r\n            return this.filterClauses;\r\n        };\r\n        // caller should not alter the returned array\r\n        ResourceQuery.prototype.getOrder = function () {\r\n            return this.order;\r\n        };\r\n        ResourceQuery.prototype.withFiltersAndOrder = function (filterClauses, order) {\r\n            return this.clone().setFilterClauses(filterClauses).setOrder(order);\r\n        };\r\n        ResourceQuery.prototype.withExtraParams = function (extraParams) {\r\n            return extraParams ? this.clone().setExtraParams(extraParams) : this;\r\n        };\r\n        ResourceQuery.prototype.withFilters = function (filterClauses) {\r\n            return this.clone().setFilterClauses(filterClauses);\r\n        };\r\n        ResourceQuery.prototype.addFilter = function (filterClause) {\r\n            return this.withFilters((this.filterClauses || []).concat([filterClause]));\r\n        };\r\n        ResourceQuery.prototype.withOrder = function (order) {\r\n            return this.clone().setOrder(order);\r\n        };\r\n        ResourceQuery.prototype.clone = function () {\r\n            return new ResourceQuery(this.fetcher)\r\n                .setFilterClauses(this.filterClauses)\r\n                .setOrder(this.order);\r\n        };\r\n        ResourceQuery.prototype.setFilterClauses = function (filterClauses) {\r\n            this.filterClauses = filterClauses;\r\n            return this;\r\n        };\r\n        ResourceQuery.prototype.setOrder = function (order) {\r\n            this.order = order;\r\n            return this;\r\n        };\r\n        ResourceQuery.prototype.setExtraParams = function (extraParams) {\r\n            this.extraParams = extraParams;\r\n            return this;\r\n        };\r\n        return ResourceQuery;\r\n    })();\r\n    VizPortal.ResourceQuery = ResourceQuery;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"IFilterClause.ts\" />\r\n/// <reference path=\"IPage.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        ServerApi.FieldValueResourceType = {\r\n            dataConnection: 'dataConnection',\r\n            datasource: 'datasource',\r\n            project: 'project',\r\n            view: 'view',\r\n            workbook: 'workbook'\r\n        };\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../fetchers/IListFetcher.ts\" />\r\n/// <reference path=\"../helpers/Filter.ts\" />\r\n/// <reference path=\"../models/ISliceable.ts\" />\r\n/// <reference path=\"../ServerApi/types/IFieldValue.ts\" />\r\n/// <reference path=\"../ServerApi/types/IFieldValuesParams.ts\" />\r\n/// <reference path=\"Query.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var FieldValuesQuery = (function () {\r\n        function FieldValuesQuery(fetcher, field, resourceType) {\r\n            this.fetcher = fetcher;\r\n            this.field = field;\r\n            this.resourceType = resourceType;\r\n        }\r\n        // Getters\r\n        FieldValuesQuery.prototype.getSlice = function (start, size) {\r\n            var params = {\r\n                field: this.field,\r\n                labelMatchText: this.matchText,\r\n                page: VizPortal.ResourceQuery.getPage(start, size),\r\n                resourceType: this.resourceType,\r\n                resourceCountFilter: VizPortal.ResourceQuery.formatFilterClauses(this.filterClauses)\r\n            };\r\n            return this.fetcher.fetchList(params);\r\n        };\r\n        FieldValuesQuery.prototype.getFilters = function () {\r\n            return this.filterClauses;\r\n        };\r\n        // Public Clone and Setters\r\n        FieldValuesQuery.prototype.withMatchText = function (matchText) {\r\n            return this.clone().setMatchText(matchText);\r\n        };\r\n        FieldValuesQuery.prototype.withFilters = function (filterClauses) {\r\n            return this.clone().setFilterClauses(filterClauses);\r\n        };\r\n        // Private methods\r\n        FieldValuesQuery.prototype.clone = function () {\r\n            return new FieldValuesQuery(this.fetcher, this.field, this.resourceType)\r\n                .setFilterClauses(this.filterClauses)\r\n                .setMatchText(this.matchText);\r\n        };\r\n        FieldValuesQuery.prototype.setFilterClauses = function (filterClauses) {\r\n            this.filterClauses = filterClauses;\r\n            return this;\r\n        };\r\n        FieldValuesQuery.prototype.setMatchText = function (matchText) {\r\n            this.matchText = matchText;\r\n            return this;\r\n        };\r\n        return FieldValuesQuery;\r\n    })();\r\n    VizPortal.FieldValuesQuery = FieldValuesQuery;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n///<reference path=\"../resources/Query.ts\" />\r\n///<reference path=\"../resources/FieldValueQuery.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/ContentFilters.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    // Converts filters from our model representation (currently a dictionary of filter-keys and values) to\r\n    // the server API representation (an array of filter clauses).\r\n    var ServerFilterClauses;\r\n    (function (ServerFilterClauses) {\r\n        // TODO This value should be defined in a content specific config file,\r\n        // For now, keep in sync with FilterPanelService.ts\r\n        var portDefault = 'default';\r\n        var serverFilterClauses = {\r\n            connectionType: function (connectionType) { return VizPortal.Filter.stringFieldEq(VizPortal.ServerApi.FilterFieldNames.connectionType, connectionType); },\r\n            createdBefore: function (createdBefore) { return VizPortal.Filter.stringFieldLte(VizPortal.ServerApi.FilterFieldNames.createdAt, createdBefore); },\r\n            createdAfter: function (createdAfter) { return VizPortal.Filter.stringFieldGte(VizPortal.ServerApi.FilterFieldNames.createdAt, createdAfter); },\r\n            databaseUsername: function (databaseUsername) { return VizPortal.Filter.stringFieldMatches(VizPortal.ServerApi.FilterFieldNames.databaseUsername, databaseUsername); },\r\n            domain: function (domainId) { return VizPortal.Filter.stringFieldEq(VizPortal.ServerApi.FilterFieldNames.domainId, domainId); },\r\n            forWorkbook: function (workbookId) { return VizPortal.Filter.stringFieldEq(VizPortal.ServerApi.FilterFieldNames.workbookId, workbookId); },\r\n            group: function (groupId) { return VizPortal.Filter.stringFieldEq(VizPortal.ServerApi.FilterFieldNames.groupId, groupId); },\r\n            inGroup: function (groupId) { return VizPortal.Filter.stringArrayFieldHas(VizPortal.ServerApi.FilterFieldNames.groupIds, groupId); },\r\n            hasDatasource: function (datasourceId) { return VizPortal.Filter.stringArrayFieldHas(VizPortal.ServerApi.FilterFieldNames.datasourceId, datasourceId); },\r\n            hasAlert: function (hasAlert) { return VizPortal.Filter.fieldEq(VizPortal.ServerApi.FilterFieldNames.hasAlert, Helpers.toBoolean(hasAlert)); },\r\n            hasExtracts: function (hasExtracts) { return VizPortal.Filter.fieldEq(VizPortal.ServerApi.FilterFieldNames.hasExtracts, Helpers.toBoolean(hasExtracts)); },\r\n            hasPassword: function (hasPassword) { return VizPortal.Filter.fieldEq(VizPortal.ServerApi.FilterFieldNames.hasEmbeddedPassword, Helpers.toBoolean(hasPassword)); },\r\n            lastRefreshedBefore: function (lastRefreshedBefore) { return VizPortal.Filter.stringFieldLte(VizPortal.ServerApi.FilterFieldNames.lastRefreshedAt, lastRefreshedBefore); },\r\n            lastRefreshedAfter: function (lastRefreshedAfter) { return VizPortal.Filter.stringFieldGte(VizPortal.ServerApi.FilterFieldNames.lastRefreshedAt, lastRefreshedAfter); },\r\n            maxSiteRole: function (maxSiteRole) { return VizPortal.Filter.stringFieldEq(VizPortal.ServerApi.FilterFieldNames.maxSiteRole, maxSiteRole); },\r\n            groupsMinimumSiteRole: function (groupsMinimumSiteRole) { return VizPortal.Filter.stringFieldEq(VizPortal.ServerApi.FilterFieldNames.minimumSiteRole, groupsMinimumSiteRole); },\r\n            modifiedBefore: function (modifiedBefore) { return VizPortal.Filter.stringFieldLte(VizPortal.ServerApi.FilterFieldNames.updatedAt, modifiedBefore); },\r\n            modifiedAfter: function (modifiedAfter) { return VizPortal.Filter.stringFieldGte(VizPortal.ServerApi.FilterFieldNames.updatedAt, modifiedAfter); },\r\n            owner: function (ownerId) { return VizPortal.Filter.stringFieldEq(VizPortal.ServerApi.FilterFieldNames.ownerId, ownerId); },\r\n            project: function (projectId) { return VizPortal.Filter.stringFieldEq(VizPortal.ServerApi.FilterFieldNames.projectId, projectId); },\r\n            schedule: function (scheduleId) { return VizPortal.Filter.stringFieldEq(VizPortal.ServerApi.FilterFieldNames.scheduleId, scheduleId); },\r\n            search: function (search) { return VizPortal.Filter.search(search); },\r\n            serverName: function (serverName) { return VizPortal.Filter.stringFieldMatches(VizPortal.ServerApi.FilterFieldNames.serverName, serverName); },\r\n            serverPort: function (serverPort) { return (serverPort === portDefault)\r\n                ? VizPortal.Filter.fieldEq(VizPortal.ServerApi.FilterFieldNames.isDefaultPort, true)\r\n                : VizPortal.Filter.stringFieldEq(VizPortal.ServerApi.FilterFieldNames.serverPort, serverPort); },\r\n            showEmbedded: function (showEmbedded) { return ((showEmbedded + '') === 'true')\r\n                ? null\r\n                : ((showEmbedded + '') === 'only')\r\n                    ? VizPortal.Filter.fieldEq(VizPortal.ServerApi.FilterFieldNames.isPublished, false)\r\n                    : VizPortal.Filter.fieldEq(VizPortal.ServerApi.FilterFieldNames.isPublished, true); },\r\n            siteId: function (siteId) { return VizPortal.Filter.fieldEq(VizPortal.ServerApi.FilterFieldNames.siteId, siteId); },\r\n            siteRole: function (siteRole) { return VizPortal.Filter.stringFieldEq(VizPortal.ServerApi.FilterFieldNames.siteRole, siteRole); },\r\n            tag: function (tag) { return VizPortal.Filter.stringArrayFieldHas(VizPortal.ServerApi.FilterFieldNames.tags, tag); },\r\n            workbook: function (workbookId) { return VizPortal.Filter.stringFieldEq(VizPortal.ServerApi.FilterFieldNames.workbookId, workbookId); },\r\n            datasource: function (datasourceId) { return VizPortal.Filter.stringFieldEq(VizPortal.ServerApi.FilterFieldNames.datasourceId, datasourceId); },\r\n            favorite: function (favorite) { return VizPortal.Filter.fieldEq(VizPortal.ServerApi.FilterFieldNames.isFavorite, Helpers.toBoolean(favorite)); },\r\n            recent: function (recent) { return VizPortal.Filter.fieldEq(VizPortal.ServerApi.FilterFieldNames.isRecent, Helpers.toBoolean(recent)); }\r\n        };\r\n        function create(filterValues) {\r\n            var filterClauses = [];\r\n            _.forEach(filterValues, function (filterValue, filterKey) {\r\n                if (filterValue) {\r\n                    filterClauses.push(serverFilterClauses[filterKey](filterValue));\r\n                }\r\n            });\r\n            return _.compact(filterClauses);\r\n        }\r\n        ServerFilterClauses.create = create;\r\n    })(ServerFilterClauses = VizPortal.ServerFilterClauses || (VizPortal.ServerFilterClauses = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/Order.ts\" />\r\n/// <reference path=\"../helpers/ResourceHelper.ts\" />\r\n/// <reference path=\"../helpers/ServerFilterClauses.ts\" />\r\n/// <reference path=\"../resources/Query.ts\" />\r\n/// <reference path=\"../ServerApi/types/IOrderClause.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var Place = (function () {\r\n        function Place() {\r\n            this.subplaceMap = {};\r\n            this.subplaceList = [];\r\n        }\r\n        Place.prototype.subplace = function (name) {\r\n            return this.subplaceMap[name];\r\n        };\r\n        Place.prototype.subplaces = function () {\r\n            return this.subplaceList;\r\n        };\r\n        Place.prototype.addSubplace = function (subplace) {\r\n            this.subplaceMap[subplace.name] = subplace;\r\n            this.subplaceList.push(subplace);\r\n        };\r\n        return Place;\r\n    })();\r\n    VizPortal.Place = Place;\r\n    var Subplace = (function () {\r\n        function Subplace(name, type, resourceQueryFn, filterValuesQueryFn, resource, defaultFilters, excludeFilters) {\r\n            if (excludeFilters === void 0) { excludeFilters = []; }\r\n            this.name = name;\r\n            this.type = type;\r\n            this.resourceQueryFn = resourceQueryFn;\r\n            this.filterValuesQueryFn = filterValuesQueryFn;\r\n            this.resource = resource;\r\n            this.defaultFilters = defaultFilters;\r\n            this.excludeFilters = excludeFilters;\r\n        }\r\n        Subplace.prototype.filterKeys = function () {\r\n            return _.difference(this.type.filterKeys, this.excludeFilters);\r\n        };\r\n        Subplace.prototype.query = function () {\r\n            return this.resourceQueryFn();\r\n        };\r\n        Subplace.prototype.filterValuesQuery = function (field) {\r\n            return this.filterValuesQueryFn ? this.filterValuesQueryFn(field) : undefined;\r\n        };\r\n        // creates an empty place that never has any content.\r\n        // this is only used on the site users place when we a showing a place for a server admin\r\n        // who is not a site member.\r\n        Subplace.empty = function (name, type, $q) {\r\n            var emptyResource = new VizPortal.ResourceQuery({\r\n                fetchList: function (params) {\r\n                    return $q.when({\r\n                        items: [],\r\n                        index: 0,\r\n                        total: 0\r\n                    });\r\n                }\r\n            });\r\n            return new Subplace(name, type, function () {\r\n                return emptyResource;\r\n            }, undefined, {\r\n                all: function () { return emptyResource; }\r\n            }, {});\r\n        };\r\n        // TODO: refactor this method to use QueryService\r\n        Subplace.create = function (name, type, resource, urlParamsFn, defaultFilters, excludeFilters) {\r\n            if (defaultFilters === void 0) { defaultFilters = {}; }\r\n            if (excludeFilters === void 0) { excludeFilters = []; }\r\n            var getFilterClauses = function (urlParams) {\r\n                return VizPortal.ServerFilterClauses.create(_.defaults(_(urlParams).pick(type.filterKeys), defaultFilters || {}));\r\n            };\r\n            return new Subplace(name, type, function () {\r\n                var urlParams = urlParamsFn();\r\n                var filterClauses = getFilterClauses(urlParams);\r\n                var order = VizPortal.Order.fromInput(urlParams['order'], type.orderKeys) || type.defaultOrder;\r\n                return resource.all().withFiltersAndOrder(filterClauses, order);\r\n            }, (!resource.valuesForField) ? undefined : function (field) {\r\n                // Remove the filter for the field that we're changing so that we don't filter for both values\r\n                var filterClauses = _.reject(getFilterClauses(urlParamsFn()), function (filter) {\r\n                    var fieldFilter = filter;\r\n                    return field && fieldFilter.field === field;\r\n                });\r\n                return resource.valuesForField(field).withFilters(filterClauses);\r\n            }, resource, defaultFilters, excludeFilters);\r\n        };\r\n        return Subplace;\r\n    })();\r\n    VizPortal.Subplace = Subplace;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    // Key Objects\r\n    //TODO Figure out a way to remove the dependency on these Key variables and then remove it\r\n    VizPortal.NamedItemInfoKeys = {\r\n        id: 'id',\r\n        name: 'name'\r\n    };\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/resourceInfoParts.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/resourceInfoParts.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/IProjectInfo.ts\" />\r\n/// <reference path=\"../models/IWorkbookInfo.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var BreadcrumbsService = (function () {\r\n        function BreadcrumbsService() {\r\n        }\r\n        BreadcrumbsService.prototype.forgetWorkbook = function () {\r\n            this.workbook = null;\r\n            this.workbookUrl = null;\r\n        };\r\n        BreadcrumbsService.prototype.forgetProject = function () {\r\n            this.project = null;\r\n            this.projectUrl = null;\r\n        };\r\n        BreadcrumbsService.prototype.rememberSiteUrl = function (url) {\r\n            this.forgetWorkbook();\r\n            this.forgetProject();\r\n            this.siteUrl = url;\r\n        };\r\n        BreadcrumbsService.prototype.rememberProjectUrl = function (project, url) {\r\n            this.forgetWorkbook();\r\n            this.project = project;\r\n            this.projectUrl = url;\r\n        };\r\n        BreadcrumbsService.prototype.rememberWorkbookUrl = function (workbook, url) {\r\n            this.workbook = workbook;\r\n            this.workbookUrl = url;\r\n            if (this.project && (!workbook || !workbook.project || this.project.id !== workbook.project.id)) {\r\n                this.forgetProject();\r\n            }\r\n        };\r\n        BreadcrumbsService.prototype.workbookChanged = function (workbook) {\r\n            if (this.workbook && (!workbook || this.workbook.id !== workbook.id)) {\r\n                this.forgetWorkbook();\r\n            }\r\n            if (this.project && (!workbook || !workbook.project || this.project.id !== workbook.project.id)) {\r\n                this.forgetProject();\r\n            }\r\n        };\r\n        BreadcrumbsService.prototype.projectChanged = function (project) {\r\n            if (this.project && (!project || this.project.id !== project.id)) {\r\n                this.forgetProject();\r\n            }\r\n        };\r\n        BreadcrumbsService.prototype.rememberGroupsUrl = function (url) {\r\n            this.groupsUrl = url;\r\n        };\r\n        return BreadcrumbsService;\r\n    })();\r\n    VizPortal.BreadcrumbsService = BreadcrumbsService;\r\n    VizPortal.Module.instance().service('BreadcrumbsService', BreadcrumbsService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    /*\r\n      ModalService is modelled on Bootstrap's $modal service: http://angular-ui.github.io/bootstrap/\r\n  \r\n      It has a single method: open(options). The options are:\r\n  \r\n        templateUrl (required) - a path to a template representing the modal's content\r\n        scope - a scope instance to be used for the modal's content. Defaults to $rootScope.\r\n        controller - a controller for a modal instance - it can initialize scope used by modal.\r\n        resolve - members that will be resolved and passed to the controller as locals; it is equivalent\r\n                 of the resolve property for AngularJS routes.\r\n  \r\n      The open method returns a modal instance, an object with the following properties:\r\n  \r\n        close(result) - a method that can be used to close a modal, passing a result\r\n        dismiss(reason) - a method that can be used to dismiss a modal, passing a reason\r\n        result - a promise that is resolved when a modal is closed and rejected when a modal is dismissed\r\n  \r\n      In addition the scope associated with modal's content is augmented with 2 methods:\r\n  \r\n        close(result)\r\n        dismiss(reason)\r\n  \r\n      These methods make it easy to close a modal window without the need to create a dedicated controller.\r\n  \r\n      Example:\r\n  \r\n        var modalInstance = modalService.open({\r\n          templateUrl: 'myModalContent.html',\r\n          controller: ModalInstanceCtrl,\r\n          resolve: {\r\n            items: function () {\r\n              return [ 'item1', 'item2' ];\r\n            }\r\n          }\r\n        });\r\n  \r\n        modalInstance.result.then(\r\n          (closeResult: any) => {\r\n            $log.info('Modal closed with result: ' + closeResult);\r\n          },\r\n          (dismissResult: any) => {\r\n            $log.info('Modal dismissed with result: ' + dismissResult);\r\n          });\r\n  \r\n    */\r\n    // Constants\r\n    var DistanceFromHostElement = 15; // Distance between host element and modal border\r\n    var ArrowWidth = 29; // Width of the base of the modal arrow\r\n    VizPortal.ModalSize = {\r\n        // Add other sizes as required\r\n        medium: '400px',\r\n        fitToContent: 'auto'\r\n    };\r\n    var ModalService = (function () {\r\n        function ModalService($window, $compile, $rootScope, $q, $controller, $injector, $templateCache, $http, StackedElementsService) {\r\n            this.$window = $window;\r\n            this.$compile = $compile;\r\n            this.$rootScope = $rootScope;\r\n            this.$q = $q;\r\n            this.$controller = $controller;\r\n            this.$injector = $injector;\r\n            this.$templateCache = $templateCache;\r\n            this.$http = $http;\r\n            this.StackedElementsService = StackedElementsService;\r\n            this.id = 0;\r\n            this.modalInstances = new VizPortal.Set(function (modalInstance) { return modalInstance._id; });\r\n        }\r\n        /**\r\n         * Creates an instance of IModalPositionOptions that will instruct the modal service to anchor\r\n         * the dialog to the element.\r\n         * @param element\r\n         */\r\n        ModalService.anchoredTo = function (element) {\r\n            return { hostElement: element };\r\n        };\r\n        ModalService.prototype.open = function (options) {\r\n            var _this = this;\r\n            // Verify options\r\n            if (!options.templateUrl) {\r\n                throw new Error('templateUrl option is required.');\r\n            }\r\n            // Default values\r\n            _.defaults(options, {\r\n                size: VizPortal.ModalSize.medium,\r\n                keyboard: true,\r\n                resolve: {},\r\n                scope: this.$rootScope,\r\n                backdrop: true,\r\n                closeX: true,\r\n                tbTestId: 'modal'\r\n            });\r\n            var deferredResult = this.$q.defer();\r\n            var modalStackedElement;\r\n            var backdropStackedElement;\r\n            // Create modal scope\r\n            var modalScope = options.scope.$new();\r\n            var backdrop;\r\n            // TODO: create a service called ModalStack and move open/close logic into there.\r\n            //       see https://github.com/angular-ui/bootstrap/blob/master/src/modal/modal.js\r\n            var modalInstance = {\r\n                result: deferredResult.promise,\r\n                close: function (result) {\r\n                    _this.close(modalInstance, modalStackedElement, backdropStackedElement, backdrop.scope);\r\n                    deferredResult.resolve(result);\r\n                },\r\n                dismiss: function (reason) {\r\n                    _this.close(modalInstance, modalStackedElement, backdropStackedElement, backdrop.scope);\r\n                    deferredResult.reject(reason);\r\n                },\r\n                _id: (this.id++).toString(),\r\n                _scope: modalScope\r\n            };\r\n            this.modalInstances.add(modalInstance);\r\n            var promises = this.getResolvePromises(options.resolve);\r\n            // Pre-load the modal template to avoid flickering/re-layout\r\n            promises.push(this.$http.get(options.templateUrl, { cache: this.$templateCache }));\r\n            this.$q.all(promises).then(function (resolvedValues) {\r\n                var modalElement = $('<tb:modal />');\r\n                if (options.classes) {\r\n                    modalElement.addClass(options.classes);\r\n                }\r\n                backdrop = _this.createBackdrop(modalInstance, options);\r\n                modalScope.options = options;\r\n                // Add close() and dismiss() convenience methods to the scope.\r\n                modalScope.close = modalInstance.close;\r\n                modalScope.dismiss = modalInstance.dismiss;\r\n                // Controller\r\n                if (options.controller) {\r\n                    var ctrlLocals = {\r\n                        $scope: modalScope,\r\n                        modalInstance: modalInstance\r\n                    };\r\n                    var resolveIter = 0;\r\n                    angular.forEach(options.resolve, function (value, key) {\r\n                        ctrlLocals[key] = resolvedValues[resolveIter++];\r\n                    });\r\n                    _this.$controller(options.controller, ctrlLocals);\r\n                }\r\n                _this.$compile(modalElement)(modalScope);\r\n                var fillWindow = function () { return { left: 0, top: 0, right: 0, bottom: 0 }; };\r\n                backdropStackedElement = _this.StackedElementsService.addStackedElement({\r\n                    contentElement: backdrop.element,\r\n                    getContentElementPosition: fillWindow\r\n                });\r\n                // Broadcast changes in modal position\r\n                var lastPosition = undefined;\r\n                modalStackedElement = _this.StackedElementsService.addStackedElement({\r\n                    contentElement: modalElement,\r\n                    getContentElementPosition: function () {\r\n                        var newPosition = _this.position(modalElement, options);\r\n                        if (!_.isEqual(newPosition, lastPosition)) {\r\n                            modalScope.$broadcast('positionChanged', newPosition);\r\n                            lastPosition = newPosition;\r\n                        }\r\n                        return newPosition;\r\n                    }\r\n                });\r\n                _this.attachKeydownHandler(modalInstance, options);\r\n            });\r\n            return modalInstance;\r\n        };\r\n        ModalService.prototype.alert = function (options) {\r\n            var scope = this.$rootScope.$new();\r\n            var modalInstance = this.open({\r\n                scope: angular.extend(scope, options),\r\n                templateUrl: 'alert.html'\r\n            });\r\n            modalInstance.result.fin(function () { return scope.$destroy(); });\r\n            return modalInstance;\r\n        };\r\n        ModalService.prototype.createBackdrop = function (modalInstance, options) {\r\n            var backdropElement = $('<div ng-click=\"backdropClick()\" ng-if=\"options.backdrop\" />').addClass(ModalService.BackdropClass);\r\n            var backdropScope = this.$rootScope.$new();\r\n            // put the entire options object on the scope so we don't have to setup a binding for options.backdrop changing\r\n            backdropScope.options = options;\r\n            if (backdropScope.options.backdropClasses) {\r\n                backdropElement.addClass(backdropScope.options.backdropClasses);\r\n            }\r\n            backdropScope.backdropClick = function () {\r\n                if (options.backdrop && options.backdrop !== 'static') {\r\n                    modalInstance.dismiss();\r\n                }\r\n            };\r\n            this.$compile(backdropElement)(backdropScope);\r\n            return {\r\n                element: backdropElement,\r\n                scope: backdropScope\r\n            };\r\n        };\r\n        ModalService.prototype.attachKeydownHandler = function (modalInstance, options) {\r\n            var _this = this;\r\n            $(this.$window.document).on('keydown.modal' + modalInstance._id, function ($event) {\r\n                if ($event.which === VizPortal.Keys.Escape && options.keyboard) {\r\n                    _this.$rootScope.$apply(function () { return modalInstance.dismiss(); });\r\n                }\r\n            });\r\n        };\r\n        ModalService.prototype.detachKeydownHandler = function (modalInstance) {\r\n            $(this.$window.document).off('.modal' + modalInstance._id);\r\n        };\r\n        ModalService.prototype.getWindowSize = function () {\r\n            var window = $(this.$window);\r\n            return {\r\n                width: window.width(),\r\n                height: window.height()\r\n            };\r\n        };\r\n        ModalService.prototype.position = function (modalElement, options) {\r\n            var minimumSpace = ModalService.MinimumSpaceBetweenDialogAndViewport;\r\n            var reserveHeight = Math.max(modalElement.outerHeight(), (options.position && options.position.reserveHeight) || 0);\r\n            var position = this.positionRelativeToHostElement(modalElement, options, reserveHeight);\r\n            if (!position) {\r\n                // if relative positioning failed, fall back to using centered positioning.\r\n                var window = this.getWindowSize();\r\n                options._showArrow = false;\r\n                position = {\r\n                    left: window.width / 2 - modalElement.outerWidth() / 2,\r\n                    // keep the top of the modal from being positioned above the viewport\r\n                    top: Math.max(window.height / 2 - reserveHeight / 2, minimumSpace)\r\n                };\r\n            }\r\n            return position;\r\n        };\r\n        /**\r\n        * Attempts to position the modal element relative to the host element.\r\n        * First it will attempt to place the modal below the host element.\r\n        * Next it will attempt to place the modal above the host element.\r\n        * If both of these attempts fail, it will return null to signal that positioning failed.\r\n        */\r\n        ModalService.prototype.positionRelativeToHostElement = function (modalElement, options, reserveHeight) {\r\n            // Make sure we have a host element and it is in the DOM\r\n            if (!options.position || !options.position.hostElement || options.position.hostElement.parents('body').length === 0) {\r\n                return null;\r\n            }\r\n            var minimumSpace = ModalService.MinimumSpaceBetweenDialogAndViewport;\r\n            var window = this.getWindowSize();\r\n            var hostElement = options.position.hostElement;\r\n            var hostElementOffset = hostElement.offset();\r\n            // By default, align the dialog's center with the host element's center, and place the dialog beneath\r\n            // the host element.\r\n            var left = hostElementOffset.left + hostElement.outerWidth() / 2 - modalElement.outerWidth() / 2;\r\n            var top = hostElementOffset.top + hostElement.outerHeight() + DistanceFromHostElement;\r\n            // Keep the dialog inside the window: horizontally\r\n            left = Math.min(left, window.width - minimumSpace - modalElement.outerWidth());\r\n            left = Math.max(left, minimumSpace);\r\n            // Keep the dialog inside the window: vertically\r\n            if (top + reserveHeight > window.height - minimumSpace) {\r\n                var spaceAboveHostElement = hostElementOffset.top - DistanceFromHostElement - reserveHeight;\r\n                if (spaceAboveHostElement >= minimumSpace) {\r\n                    // Use actual height instead of reserve height when positioning above the host element.\r\n                    // Otherwise, the element will be positioned too far above the position element since we are assuming that it\r\n                    // is larger than it actually is.\r\n                    top = hostElementOffset.top - modalElement.outerHeight() - DistanceFromHostElement;\r\n                }\r\n                else {\r\n                    // the dialog is too tall to fit above or below the position element.\r\n                    return null;\r\n                }\r\n            }\r\n            options._showArrow = true;\r\n            return {\r\n                left: left,\r\n                top: top\r\n            };\r\n        };\r\n        ModalService.prototype.getResolvePromises = function (resolves) {\r\n            var _this = this;\r\n            var promisesArr = [];\r\n            angular.forEach(resolves, function (value) {\r\n                if (angular.isFunction(value) || angular.isArray(value)) {\r\n                    promisesArr.push(_this.$q.when(_this.$injector.invoke(value)));\r\n                }\r\n            });\r\n            return promisesArr;\r\n        };\r\n        ModalService.prototype.close = function (modalInstance, modalStackedElement, backdropStackedElement, backdropScope) {\r\n            this.detachKeydownHandler(modalInstance);\r\n            modalInstance._scope.$destroy();\r\n            this.StackedElementsService.removeStackedElement(modalStackedElement);\r\n            backdropScope.$destroy();\r\n            this.StackedElementsService.removeStackedElement(backdropStackedElement);\r\n            this.modalInstances.remove(modalInstance);\r\n        };\r\n        ModalService.prototype.dismissAll = function () {\r\n            var _this = this;\r\n            _.each(this.modalInstances.toArray(), function (modalInstance) {\r\n                modalInstance.dismiss();\r\n                _this.modalInstances.remove(modalInstance);\r\n            });\r\n        };\r\n        ModalService.$inject = ['$window', '$compile', '$rootScope', '$q',\r\n            '$controller', '$injector', '$templateCache', '$http', 'StackedElementsService'];\r\n        ModalService.BackdropClass = 'tb-backdrop';\r\n        ModalService.MinimumSpaceBetweenDialogAndViewport = 18;\r\n        return ModalService;\r\n    })();\r\n    VizPortal.ModalService = ModalService;\r\n    VizPortal.Module.instance().service('ModalService', ModalService);\r\n    VizPortal.Module.instance().directive('tbModal', [\r\n        '$window',\r\n        function ($window) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'modal.html',\r\n                link: function (scope, element) {\r\n                    var window = $($window);\r\n                    scope.showArrow = function () { return !!scope.options._showArrow; };\r\n                    scope.arrowUp = true;\r\n                    scope.arrowLeft = 0;\r\n                    var contentElement = element.find('.tb-modal-content')[0];\r\n                    var modalOffsetTop = 0;\r\n                    // Keep focus inside the dialog\r\n                    // Adapted from code at https://github.com/fnagel/jQuery-Accessible-RIA/issues/30\r\n                    element.on('keydown', function ($event) {\r\n                        if ($event.which !== VizPortal.Keys.Tab) {\r\n                            return;\r\n                        }\r\n                        var tabbables = element.find(':tabbable'), first = tabbables.filter(':first'), last = tabbables.filter(':last');\r\n                        if ($event.target === last[0] && !$event.shiftKey) {\r\n                            $event.preventDefault();\r\n                            first.focus();\r\n                        }\r\n                        else if ($event.target === first[0] && $event.shiftKey) {\r\n                            $event.preventDefault();\r\n                            last.focus();\r\n                        }\r\n                    });\r\n                    scope.$on('positionChanged', function (event, modalPosition) {\r\n                        if (scope.options.position) {\r\n                            var position = scope.options.position;\r\n                            var hostElement = position.hostElement;\r\n                            if (modalPosition && hostElement) {\r\n                                var hostElementPosition = hostElement.offset();\r\n                                scope.arrowUp = modalPosition.top > hostElementPosition.top;\r\n                                modalOffsetTop = modalPosition.top;\r\n                                var midpointOfHostElement = hostElementPosition.left + hostElement.outerWidth() / 2;\r\n                                scope.arrowLeft = midpointOfHostElement - (ArrowWidth / 2) - modalPosition.left;\r\n                            }\r\n                        }\r\n                    });\r\n                    element.css('width', scope.options.size);\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../services/ModalService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ActionContext;\r\n    (function (ActionContext) {\r\n        /**\r\n         * Creates an ActionContext from a JQuery event, for example, from a button with a click\r\n         * listener. The returned target element is that on which the event was defined, and the\r\n         * returned scope is that of the target element.\r\n         */\r\n        function fromEvent($event) {\r\n            // Using $event.currentTarget rather than $event.target causes the ActionContext to be\r\n            // attached to the element on which the listener is defined, rather than the element that was\r\n            // clicked (which is likely a child of the element with the listener).\r\n            var targetElement = angular.element($event.currentTarget);\r\n            return {\r\n                scope: targetElement.scope(),\r\n                targetElement: targetElement\r\n            };\r\n        }\r\n        ActionContext.fromEvent = fromEvent;\r\n    })(ActionContext = VizPortal.ActionContext || (VizPortal.ActionContext = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../FeatureFlags.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var MultipleResultNotificationOptions;\r\n    (function (MultipleResultNotificationOptions) {\r\n        function create(result, translator) {\r\n            var options = {};\r\n            if (result.anySucceeded()) {\r\n                options.successSummary = tryTranslate(function () { return translator.describeSuccessSummary(result.successCount); });\r\n            }\r\n            if (result.anyFailed()) {\r\n                options.errorSummary = tryTranslate(function () { return translator.describeErrorSummary(result.errorCount); });\r\n                options.errorDetails = _.compact(_.map(result.errorItems(), function (errorItem) { return tryTranslate(function () { return translator.describeErrorDetail(errorItem); }); }));\r\n            }\r\n            return options;\r\n        }\r\n        MultipleResultNotificationOptions.create = create;\r\n        function tryTranslate(fn) {\r\n            try {\r\n                return fn();\r\n            }\r\n            catch (ex) {\r\n                console.error(\"Error translation failed\", ex);\r\n                return undefined;\r\n            }\r\n        }\r\n    })(MultipleResultNotificationOptions = VizPortal.MultipleResultNotificationOptions || (VizPortal.MultipleResultNotificationOptions = {}));\r\n    var ContentActionNotification = (function () {\r\n        function ContentActionNotification($translate, scope, toaster, modal, SliceableFactory) {\r\n            this.$translate = $translate;\r\n            this.scope = scope;\r\n            this.toaster = toaster;\r\n            this.modal = modal;\r\n            this.SliceableFactory = SliceableFactory;\r\n        }\r\n        ContentActionNotification.prototype.notifyResult = function (items, errors, translations, translationParams) {\r\n            var errorCount = errors ? errors.length : 0;\r\n            var successCount = items.size() - errorCount;\r\n            var notificationLines = [];\r\n            if (successCount) {\r\n                notificationLines.push(this.$translate.instant(translations.successId, angular.extend({ ITEM_COUNT: successCount }, translationParams), VizPortal.L10n.Interpolations.Count));\r\n            }\r\n            if (errorCount) {\r\n                notificationLines.push(this.$translate.instant(translations.errorId, angular.extend({ ERROR_COUNT: errorCount }, translationParams), VizPortal.L10n.Interpolations.Count));\r\n            }\r\n            this.toaster.pop({ type: errorCount ? VizPortal.ToastType.Error : VizPortal.ToastType.Info, text: notificationLines.join('\\n') });\r\n        };\r\n        ContentActionNotification.prototype.notify = function (options) {\r\n            if (options.successSummary) {\r\n                this.toaster.pop({ type: VizPortal.ToastType.Info, text: options.successSummary });\r\n            }\r\n            if (options.errorSummary) {\r\n                if (VizPortal.FeatureFlags.reactToasts) {\r\n                    var contentComponent = React.createClass({\r\n                        showDetails: function () {\r\n                            this.props.openModal($(React.findDOMNode(this)));\r\n                        },\r\n                        render: function () {\r\n                            var detailsLink = options.errorDetails.length > 0 ? React.DOM.a({ onClick: this.showDetails }, this.props.detailsLinkText) : null;\r\n                            return React.DOM.div({}, React.DOM.span({}, options.errorSummary + '\\u00a0'), detailsLink);\r\n                        }\r\n                    });\r\n                    //create new scope for the error modal dialog\r\n                    var newScope = this.scope.$new();\r\n                    newScope.errorDetailsSliceable = this.SliceableFactory.fromArray(options.errorDetails);\r\n                    //react element passes itself in as an anchor\r\n                    var modal = this.modal;\r\n                    function openModal(anchor) {\r\n                        modal.open({\r\n                            scope: newScope,\r\n                            templateUrl: 'errorDetailsDialog.html',\r\n                            size: VizPortal.ModalSize.fitToContent,\r\n                            position: VizPortal.ModalService.anchoredTo(anchor)\r\n                        }).result.fin(function () { return newScope.$destroy(); });\r\n                        ;\r\n                    }\r\n                    this.toaster.pop({\r\n                        type: VizPortal.ToastType.Error,\r\n                        content: React.createElement(contentComponent, {\r\n                            detailsLinkText: this.$translate.instant('details'),\r\n                            openModal: openModal\r\n                        })\r\n                    });\r\n                }\r\n                else {\r\n                    this.toaster.pop({\r\n                        type: VizPortal.ToastType.Error,\r\n                        templateUrl: 'errorDetailsToast.html',\r\n                        data: options\r\n                    });\r\n                }\r\n            }\r\n        };\r\n        ContentActionNotification.prototype.notifySuccess = function (successMessage) {\r\n            this.toaster.pop({ type: VizPortal.ToastType.Info, text: successMessage });\r\n        };\r\n        ContentActionNotification.prototype.notifyFailure = function (failureMessage) {\r\n            this.toaster.pop({ type: VizPortal.ToastType.Error, text: failureMessage });\r\n        };\r\n        ContentActionNotification.$inject = [\r\n            '$translate',\r\n            '$rootScope',\r\n            'ToasterService',\r\n            'ModalService',\r\n            'SliceableFactory'\r\n        ];\r\n        return ContentActionNotification;\r\n    })();\r\n    VizPortal.ContentActionNotification = ContentActionNotification;\r\n    VizPortal.Module.instance().service('ContentActionNotification', ContentActionNotification);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/ActionContext.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\n/// <reference path=\"ContentActionNotification.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var AbstractContentAction = (function () {\r\n        function AbstractContentAction(ConfirmActionDialog, ContentActionNotification) {\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.ContentActionNotification = ContentActionNotification;\r\n        }\r\n        AbstractContentAction.prototype.executeFromEvent = function (contentItems, $event) {\r\n            return this.execute(contentItems, VizPortal.ActionContext.fromEvent($event));\r\n        };\r\n        AbstractContentAction.prototype.execute = function (contentItems, actionContext) {\r\n            var _this = this;\r\n            var dialogConfig = this.defaultDialogConfig(actionContext);\r\n            this.configureDialog(dialogConfig, contentItems);\r\n            var dialogInstance = this.ConfirmActionDialog.open(dialogConfig);\r\n            dialogInstance.result.then(function (result) {\r\n                return _this.ContentActionNotification.notifyResult(contentItems, result.errors, _this.notificationTranslationIds(), _this.notificationTranslationValues(dialogConfig.scope));\r\n            });\r\n            dialogInstance.result.fin(function () { return dialogConfig.scope.$destroy(); });\r\n            return dialogInstance.result;\r\n        };\r\n        AbstractContentAction.prototype.defaultDialogConfig = function (actionContext) {\r\n            return {\r\n                scope: actionContext.scope.$new(),\r\n                title: '',\r\n                actionName: \"OK\",\r\n                action: angular.noop\r\n            };\r\n        };\r\n        // Override in action implementations\r\n        AbstractContentAction.prototype.configureDialog = function (dialogConfig, contentItems) { };\r\n        AbstractContentAction.prototype.notificationTranslationIds = function () {\r\n            throw \"notificationTranslationIds() must be implemented in a subclass\";\r\n        };\r\n        AbstractContentAction.prototype.notificationTranslationValues = function (dialogScope) {\r\n            return {};\r\n        };\r\n        return AbstractContentAction;\r\n    })();\r\n    VizPortal.AbstractContentAction = AbstractContentAction;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"AbstractContentAction.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ActivateSitesAction = (function (_super) {\r\n        __extends(ActivateSitesAction, _super);\r\n        function ActivateSitesAction(ConfirmActionDialog, ContentActionNotification, $translate, Sites) {\r\n            _super.call(this, ConfirmActionDialog, ContentActionNotification);\r\n            this.$translate = $translate;\r\n            this.Sites = Sites;\r\n        }\r\n        ActivateSitesAction.prototype.configureDialog = function (dialogConfig, sites) {\r\n            var _this = this;\r\n            var scope = dialogConfig.scope;\r\n            scope.dialog = {\r\n                siteName: sites.first().settings.name\r\n            };\r\n            dialogConfig.bodyText = this.$translate.instant('confirmActivateSites', {\r\n                SITE_NAME: VizPortal.L10n.elideIfLong(scope.dialog.siteName),\r\n                ITEM_COUNT: sites.size()\r\n            }, VizPortal.L10n.Interpolations.Count);\r\n            dialogConfig.title = this.$translate.instant('activateSites');\r\n            dialogConfig.actionName = this.$translate.instant('activateButtonConfirm', {\r\n                ITEM_COUNT: sites.size()\r\n            }, VizPortal.L10n.Interpolations.Count);\r\n            dialogConfig.action = function () { return _this.Sites.activate(sites.keys()); };\r\n        };\r\n        ActivateSitesAction.prototype.notificationTranslationIds = function () {\r\n            return {\r\n                successId: 'sitesActivateSuccess',\r\n                errorId: 'sitesActivateFailed'\r\n            };\r\n        };\r\n        ActivateSitesAction.prototype.notificationTranslationValues = function (scope) {\r\n            return {\r\n                SITE_NAME: VizPortal.L10n.elideIfLong(scope.dialog.siteName)\r\n            };\r\n        };\r\n        ActivateSitesAction.$inject = ['ConfirmActionDialog', 'ContentActionNotification', '$translate', 'Sites'];\r\n        return ActivateSitesAction;\r\n    })(VizPortal.AbstractContentAction);\r\n    VizPortal.ActivateSitesAction = ActivateSitesAction;\r\n    VizPortal.Module.instance().service('ActivateSitesAction', ActivateSitesAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../fetchers/ListResult.ts\" />\r\n/// <reference path=\"../models/ISliceable.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SliceableHelper;\r\n    (function (SliceableHelper) {\r\n        SliceableHelper.BlockSize = VizPortal.MaxRequestArrayLength;\r\n        // Return true from itemsReceived to cancel.\r\n        function fetchAll(sliceable, itemsReceived) {\r\n            var totalList = [];\r\n            var getBlock = function (blockStartIndex) {\r\n                if (blockStartIndex === void 0) { blockStartIndex = 0; }\r\n                return sliceable.getSlice(blockStartIndex, SliceableHelper.BlockSize).then(function (result) {\r\n                    var cancel = false;\r\n                    if (itemsReceived) {\r\n                        cancel = !!itemsReceived(result.items);\r\n                    }\r\n                    totalList = totalList.concat(result.items);\r\n                    if (!cancel && result.total > totalList.length) {\r\n                        return getBlock(totalList.length);\r\n                    }\r\n                    return new VizPortal.ListResult(totalList);\r\n                });\r\n            };\r\n            return getBlock();\r\n        }\r\n        SliceableHelper.fetchAll = fetchAll;\r\n    })(SliceableHelper = VizPortal.SliceableHelper || (VizPortal.SliceableHelper = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../ServerApi/types/IRequest.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var RequestHelper;\r\n    (function (RequestHelper) {\r\n        RequestHelper.DefaultBlockSize = VizPortal.MaxRequestArrayLength;\r\n        function makeBlocks(items, blockSize) {\r\n            if (items.length <= blockSize)\r\n                return [items]; // optimize for common case\r\n            var blocks = [];\r\n            var numBlocks = Math.ceil(items.length / blockSize);\r\n            for (var i = 0; i < numBlocks; i++) {\r\n                blocks[i] = items.slice(i * blockSize, (i + 1) * blockSize);\r\n            }\r\n            return blocks;\r\n        }\r\n        RequestHelper.makeBlocks = makeBlocks;\r\n        function buildRequests(items, buildRequest, blockSize) {\r\n            if (blockSize === void 0) { blockSize = RequestHelper.DefaultBlockSize; }\r\n            var requests = [];\r\n            var blocks = makeBlocks(items, blockSize);\r\n            for (var i = 0, l = blocks.length; i < l; i++) {\r\n                var request = buildRequest(blocks[i]);\r\n                if (!!request)\r\n                    requests.push(request);\r\n            }\r\n            return requests;\r\n        }\r\n        RequestHelper.buildRequests = buildRequests;\r\n        function buildRequests2(items1, items2, buildRequest, blockSize) {\r\n            if (blockSize === void 0) { blockSize = RequestHelper.DefaultBlockSize; }\r\n            var requests = [];\r\n            var blocks1 = makeBlocks(items1, blockSize);\r\n            var blocks2 = makeBlocks(items2, blockSize);\r\n            for (var i1 = 0, l1 = blocks1.length; i1 < l1; i1++) {\r\n                for (var i2 = 0, l2 = blocks2.length; i2 < l2; i2++) {\r\n                    var request = buildRequest(blocks1[i1], blocks2[i2]);\r\n                    if (!!request)\r\n                        requests.push(request);\r\n                }\r\n            }\r\n            return requests;\r\n        }\r\n        RequestHelper.buildRequests2 = buildRequests2;\r\n        function buildRequests3(items1, items2, items3, buildRequest, blockSize) {\r\n            if (blockSize === void 0) { blockSize = RequestHelper.DefaultBlockSize; }\r\n            var requests = [];\r\n            var blocks1 = makeBlocks(items1, blockSize);\r\n            var blocks2 = makeBlocks(items2, blockSize);\r\n            var blocks3 = makeBlocks(items3, blockSize);\r\n            for (var i1 = 0, l1 = blocks1.length; i1 < l1; i1++) {\r\n                for (var i2 = 0, l2 = blocks2.length; i2 < l2; i2++) {\r\n                    for (var i3 = 0, l3 = blocks3.length; i3 < l3; i3++) {\r\n                        var request = buildRequest(blocks1[i1], blocks2[i2], blocks3[i3]);\r\n                        if (!!request)\r\n                            requests.push(request);\r\n                    }\r\n                }\r\n            }\r\n            return requests;\r\n        }\r\n        RequestHelper.buildRequests3 = buildRequests3;\r\n    })(RequestHelper = VizPortal.RequestHelper || (VizPortal.RequestHelper = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var Set = (function () {\r\n        function Set(keyForItem) {\r\n            this.items = {};\r\n            this.keyForItem = keyForItem;\r\n        }\r\n        Set.fromKeyArray = function (keys) {\r\n            var set = new Set(function (item) { return item; });\r\n            set.addItems(keys);\r\n            return set;\r\n        };\r\n        Set.fromIdItemArray = function (items) {\r\n            var set = new Set(function (item) { return item.id; });\r\n            set.addItems(items);\r\n            return set;\r\n        };\r\n        Set.singleton = function (item, keyForItem) {\r\n            var set = new Set(keyForItem);\r\n            set.add(item);\r\n            return set;\r\n        };\r\n        Set.prototype.keyFor = function (item) {\r\n            return this.keyForItem(item);\r\n        };\r\n        Set.prototype.containsKey = function (key) {\r\n            return _.has(this.items, key);\r\n        };\r\n        Set.prototype.contains = function (item) {\r\n            return this.containsKey(this.keyForItem(item));\r\n        };\r\n        Set.prototype.size = function () {\r\n            return _.size(this.items);\r\n        };\r\n        Set.prototype.isEmpty = function () {\r\n            return _.isEmpty(this.items);\r\n        };\r\n        Set.prototype.keys = function () {\r\n            return _.keys(this.items);\r\n        };\r\n        Set.prototype.get = function (itemId) {\r\n            return this.items[itemId];\r\n        };\r\n        Set.prototype.add = function (item) {\r\n            this.items[this.keyForItem(item)] = item;\r\n        };\r\n        Set.prototype.addItems = function (items) {\r\n            var _this = this;\r\n            _.each(items, function (item) {\r\n                _this.add(item);\r\n            });\r\n        };\r\n        // Updates the value of the given item if it is already in the set.\r\n        // This is useful if the value corresponding to some key may have changed.\r\n        Set.prototype.update = function (item) {\r\n            if (this.contains(item)) {\r\n                this.add(item);\r\n            }\r\n        };\r\n        Set.prototype.updateItems = function (items) {\r\n            var _this = this;\r\n            _.each(items, function (item) {\r\n                _this.update(item);\r\n            });\r\n        };\r\n        Set.prototype.remove = function (item) {\r\n            delete this.items[this.keyForItem(item)];\r\n        };\r\n        Set.prototype.removeItems = function (items) {\r\n            var _this = this;\r\n            _.each(items, function (item) {\r\n                _this.remove(item);\r\n            });\r\n        };\r\n        Set.prototype.removeItemsIn = function (set) {\r\n            var _this = this;\r\n            _.each(this.items, function (item, key) {\r\n                if (set.containsKey(key)) {\r\n                    _this.remove(item);\r\n                }\r\n            });\r\n        };\r\n        Set.prototype.removeItemsNotIn = function (set) {\r\n            var _this = this;\r\n            _.each(this.items, function (item, key) {\r\n                if (!set.containsKey(key)) {\r\n                    _this.remove(item);\r\n                }\r\n            });\r\n        };\r\n        Set.prototype.toggle = function (item) {\r\n            if (this.contains(item)) {\r\n                this.remove(item);\r\n                return false;\r\n            }\r\n            else {\r\n                this.add(item);\r\n                return true;\r\n            }\r\n        };\r\n        Set.prototype.toggleItems = function (items) {\r\n            var _this = this;\r\n            _.each(items, function (item) {\r\n                _this.toggle(item);\r\n            });\r\n        };\r\n        Set.prototype.clear = function () {\r\n            this.items = {};\r\n        };\r\n        Set.prototype.toArray = function () {\r\n            return _.values(this.items);\r\n        };\r\n        Set.prototype.each = function (iterator, context) {\r\n            _.each(this.items, iterator, context);\r\n        };\r\n        Set.prototype.find = function (iterator, context) {\r\n            return _.find(this.items, iterator, context);\r\n        };\r\n        Set.prototype.pluck = function (propertyName) {\r\n            return _.pluck(this.toArray(), propertyName);\r\n        };\r\n        Set.prototype.map = function (iterator, context) {\r\n            return _.map(this.items, iterator, context);\r\n        };\r\n        Set.prototype.reduce = function (iterator, memo, context) {\r\n            return _.reduce(this.items, iterator, memo, context);\r\n        };\r\n        Set.prototype.sum = function (iterator) {\r\n            return this.reduce(function (sum, item) { return sum + iterator(item); }, 0);\r\n        };\r\n        Set.prototype.all = function (iterator) {\r\n            return _.all(this.items, iterator);\r\n        };\r\n        Set.prototype.any = function (iterator) {\r\n            return _.any(this.items, iterator);\r\n        };\r\n        Set.prototype.filter = function (filterFunction) {\r\n            var filteredSet = new Set(this.keyForItem);\r\n            this.each(function (item) {\r\n                if (filterFunction(item)) {\r\n                    filteredSet.add(item);\r\n                }\r\n            });\r\n            return filteredSet;\r\n        };\r\n        Set.prototype.clone = function () {\r\n            var clone = new Set(this.keyForItem);\r\n            clone.addItems(this.toArray());\r\n            return clone;\r\n        };\r\n        Set.prototype.first = function () {\r\n            return this.get(this.keys()[0]);\r\n        };\r\n        Set.prototype.getByIndex = function (index) {\r\n            return this.get(this.keys()[index]);\r\n        };\r\n        return Set;\r\n    })();\r\n    VizPortal.Set = Set;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/Set.ts\" />\r\n/// <reference path=\"../ServerApi/types/IResponse.ts\" />\r\n/// <reference path=\"../ServerApi/types/IUser.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ResultHelper;\r\n    (function (ResultHelper) {\r\n        /**\r\n         * Merges lists of properties from a list of result objects (typically from an action that was\r\n         * split into multiple requests) into a single list of properties.\r\n         * @param results An array of result objects from the server\r\n         * @param getProperty A function that extracts the relevant property from each result item\r\n         * @returns {T[]}\r\n         */\r\n        function combine(results, getProperty) {\r\n            return _.compact(_.flatten(_.map(_.compact(results), getProperty)));\r\n        }\r\n        ResultHelper.combine = combine;\r\n        /**\r\n         * Merge objects from a list of result objects (typically from an action that was split into\r\n         * multiple requests) by combining all the keys into a single object. If the same key appears\r\n         * more than once in the source objects, the later one will take precedence.\r\n         * @param results An array of result objects from the server\r\n         * @param getProperty A function that extracts the relevant property from each result item\r\n         * @returns {any}\r\n         */\r\n        function combineByKey(results, getProperty) {\r\n            var allProperties = _.compact(_.map(_.compact(results), getProperty));\r\n            allProperties.unshift({}); // Create the args array for _.extend\r\n            return _.extend.apply(null, allProperties);\r\n        }\r\n        ResultHelper.combineByKey = combineByKey;\r\n        function combineErrors(results) {\r\n            return combine(results, function (result) { return result.errors; });\r\n        }\r\n        ResultHelper.combineErrors = combineErrors;\r\n        function combineIds(results) {\r\n            return combine(results, function (result) { return result.ids; });\r\n        }\r\n        ResultHelper.combineIds = combineIds;\r\n        function combineUsers(results) {\r\n            return combine(results, function (result) { return result.users; });\r\n        }\r\n        ResultHelper.combineUsers = combineUsers;\r\n        function combineResults(results) {\r\n            return {\r\n                errors: combineErrors(results)\r\n            };\r\n        }\r\n        ResultHelper.combineResults = combineResults;\r\n        function combineCodes(results) {\r\n            return combine(results, function (result) { return result.results; });\r\n        }\r\n        ResultHelper.combineCodes = combineCodes;\r\n        function combineUserResults(results) {\r\n            return {\r\n                errors: combineErrors(results),\r\n                users: combineUsers(results),\r\n                results: combineCodes(results)\r\n            };\r\n        }\r\n        ResultHelper.combineUserResults = combineUserResults;\r\n        function combineImportUserResults(results) {\r\n            return {\r\n                errors: combineErrors(results),\r\n                users: combineUsers(results)\r\n            };\r\n        }\r\n        ResultHelper.combineImportUserResults = combineImportUserResults;\r\n        function hasErrors(result) {\r\n            return !!(result && result.errors) && result.errors.length > 0;\r\n        }\r\n        ResultHelper.hasErrors = hasErrors;\r\n        // Reject a promise if the result returned from the server contains any errors.\r\n        function rejectResultOnError($q) {\r\n            return function (result) {\r\n                return hasErrors(result)\r\n                    ? $q.reject(result)\r\n                    : $q.when(result);\r\n            };\r\n        }\r\n        ResultHelper.rejectResultOnError = rejectResultOnError;\r\n        function getErrorIds(result, options) {\r\n            if (options === void 0) { options = {}; }\r\n            return VizPortal.Set.fromKeyArray(_.compact(_.map(result && result.errors || [], function (error) { return error.code === options.excludeCode ? null : error.id; })));\r\n        }\r\n        ResultHelper.getErrorIds = getErrorIds;\r\n        function getErrorIdsWithCode(result, code) {\r\n            return VizPortal.Set.fromKeyArray(_.compact(_.map(result && result.errors || [], function (error) { return error.code === code ? error.id : null; })));\r\n        }\r\n        ResultHelper.getErrorIdsWithCode = getErrorIdsWithCode;\r\n    })(ResultHelper = VizPortal.ResultHelper || (VizPortal.ResultHelper = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        ServerApi.ScheduleTypes = {\r\n            Hourly: 'Hourly',\r\n            Daily: 'Daily',\r\n            Weekly: 'Weekly',\r\n            Monthly: 'Monthly'\r\n        };\r\n        ServerApi.ScheduleActions = {\r\n            Extract: 'Extract',\r\n            Subscription: 'Subscription'\r\n        };\r\n        ServerApi.ScheduleDaysOfTheWeek = {\r\n            Sun: 'Sun',\r\n            Mon: 'Mon',\r\n            Tue: 'Tue',\r\n            Wed: 'Wed',\r\n            Thu: 'Thu',\r\n            Fri: 'Fri',\r\n            Sat: 'Sat'\r\n        };\r\n        ServerApi.ScheduleLastDayOfMonth = 'Last';\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/ISchedule.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var CreateScheduleRequest = (function (_super) {\r\n            __extends(CreateScheduleRequest, _super);\r\n            function CreateScheduleRequest(params) {\r\n                _super.call(this, 'createSchedule', params);\r\n            }\r\n            return CreateScheduleRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.CreateScheduleRequest = CreateScheduleRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var DeleteSchedulesRequest = (function (_super) {\r\n            __extends(DeleteSchedulesRequest, _super);\r\n            function DeleteSchedulesRequest(ids) {\r\n                _super.call(this, 'deleteSchedules', { ids: ids });\r\n            }\r\n            return DeleteSchedulesRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.DeleteSchedulesRequest = DeleteSchedulesRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"IPage.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/IGetItemsParams.ts\" />\r\n/// <reference path=\"../types/IGetItemsResult.ts\" />\r\n/// <reference path=\"../types/ISchedule.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetSchedulesRequest = (function (_super) {\r\n            __extends(GetSchedulesRequest, _super);\r\n            function GetSchedulesRequest(params) {\r\n                _super.call(this, 'getSchedules', params);\r\n            }\r\n            return GetSchedulesRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetSchedulesRequest = GetSchedulesRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var RunServerSchedulesRequest = (function (_super) {\r\n            __extends(RunServerSchedulesRequest, _super);\r\n            function RunServerSchedulesRequest(ids) {\r\n                _super.call(this, 'runServerSchedules', {\r\n                    ids: ids\r\n                });\r\n            }\r\n            return RunServerSchedulesRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.RunServerSchedulesRequest = RunServerSchedulesRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var RunSchedulesRequest = (function (_super) {\r\n            __extends(RunSchedulesRequest, _super);\r\n            function RunSchedulesRequest(ids) {\r\n                _super.call(this, 'runSchedules', {\r\n                    ids: ids\r\n                });\r\n            }\r\n            return RunSchedulesRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.RunSchedulesRequest = RunSchedulesRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var SetEnabledStatusForSchedulesRequest = (function (_super) {\r\n            __extends(SetEnabledStatusForSchedulesRequest, _super);\r\n            function SetEnabledStatusForSchedulesRequest(ids, enabled) {\r\n                _super.call(this, 'setEnabledStatusForSchedules', { ids: ids, enabled: enabled });\r\n            }\r\n            return SetEnabledStatusForSchedulesRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.SetEnabledStatusForSchedulesRequest = SetEnabledStatusForSchedulesRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\n/// <reference path=\"../types/IResponse.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var SetScheduleNameRequest = (function (_super) {\r\n            __extends(SetScheduleNameRequest, _super);\r\n            function SetScheduleNameRequest(id, name) {\r\n                _super.call(this, 'setScheduleName', {\r\n                    id: id,\r\n                    name: name\r\n                });\r\n            }\r\n            return SetScheduleNameRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.SetScheduleNameRequest = SetScheduleNameRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../fetchers/IListFetcher.ts\" />\r\n/// <reference path=\"../helpers/ResourceHelper.ts\" />\r\n/// <reference path=\"../resources/Query.ts\" />\r\n/// <reference path=\"../ServerApi/types/resourceParts.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var Resource = (function () {\r\n        function Resource(fetcher) {\r\n            this.fetcher = fetcher;\r\n            this.allQuery = new VizPortal.ResourceQuery(this.fetcher);\r\n        }\r\n        Resource.prototype.all = function () {\r\n            return this.allQuery;\r\n        };\r\n        Resource.prototype.getById = function (id, additionalFilterClauses) {\r\n            var query = this.all();\r\n            if (additionalFilterClauses)\r\n                query = query.withFilters(additionalFilterClauses);\r\n            return query.addFilter(VizPortal.Filter.stringFieldEq(VizPortal.ServerApi.NamedItemKeys.id, id))\r\n                .getFirst();\r\n        };\r\n        return Resource;\r\n    })();\r\n    VizPortal.Resource = Resource;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/RequestHelper.ts\" />\r\n/// <reference path=\"../helpers/ResultHelper.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/CreateScheduleRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/DeleteSchedulesRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetSchedulesRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/RunServerSchedulesRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/RunSchedulesRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/SetEnabledStatusForSchedulesRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/SetScheduleNameRequest.ts\" />\r\n/// <reference path=\"../ServerApi/types/ISchedule.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\n/// <reference path=\"Resource.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var Schedules = (function (_super) {\r\n        __extends(Schedules, _super);\r\n        function Schedules(ErrorNotifyingServer, FetcherFactory) {\r\n            _super.call(this, FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetSchedulesRequest, function (result) { return result.schedules; }));\r\n            this.ErrorNotifyingServer = ErrorNotifyingServer;\r\n        }\r\n        Schedules.filterByActionType = function (scheduledActionType) {\r\n            return VizPortal.Filter.fieldEq(VizPortal.ServerApi.FilterFieldNames.scheduledAction, scheduledActionType);\r\n        };\r\n        Schedules.prototype.getByIdForSite = function (id, siteId) {\r\n            return this.getById(id, _(siteId).isString() ? [VizPortal.Filter.fieldEq(VizPortal.ServerApi.FilterFieldNames.siteId, siteId)] : []);\r\n        };\r\n        Schedules.prototype.setEnabledStatus = function (ids, status) {\r\n            return this.ErrorNotifyingServer.sendRequests(VizPortal.RequestHelper.buildRequests(ids, function (idsBlock) { return new VizPortal.ServerApi.SetEnabledStatusForSchedulesRequest(idsBlock, status); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        Schedules.prototype.disable = function (ids) {\r\n            return this.setEnabledStatus(ids, false);\r\n        };\r\n        Schedules.prototype.enable = function (ids) {\r\n            return this.setEnabledStatus(ids, true);\r\n        };\r\n        Schedules.prototype.del = function (ids) {\r\n            return this.ErrorNotifyingServer.sendRequests(VizPortal.RequestHelper.buildRequests(ids, function (idsBlock) { return new VizPortal.ServerApi.DeleteSchedulesRequest(idsBlock); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        Schedules.prototype.runServer = function (ids) {\r\n            return this.ErrorNotifyingServer.sendRequests(VizPortal.RequestHelper.buildRequests(ids, function (idsBlock) { return new VizPortal.ServerApi.RunServerSchedulesRequest(idsBlock); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        Schedules.prototype.run = function (ids) {\r\n            return this.ErrorNotifyingServer.sendRequests(VizPortal.RequestHelper.buildRequests(ids, function (idsBlock) { return new VizPortal.ServerApi.RunSchedulesRequest(idsBlock); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        Schedules.prototype.create = function (schedule) {\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.CreateScheduleRequest(schedule));\r\n        };\r\n        Schedules.prototype.update = function (schedule) {\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.UpdateScheduleRequest(schedule));\r\n        };\r\n        Schedules.prototype.rename = function (id, newName) {\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.SetScheduleNameRequest(id, newName));\r\n        };\r\n        Schedules.$inject = ['ErrorNotifyingServer', 'FetcherFactory'];\r\n        return Schedules;\r\n    })(VizPortal.Resource);\r\n    VizPortal.Schedules = Schedules;\r\n    VizPortal.Module.instance().service('Schedules', Schedules);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\n/// <reference path=\"../helpers/SliceableHelper.ts\" />\r\n/// <reference path=\"../resources/Schedules.ts\" />\r\n/// <reference path=\"ContentActionNotification.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    (function (CreateExtractTasksMode) {\r\n        CreateExtractTasksMode[CreateExtractTasksMode[\"AllowRefreshNow\"] = 0] = \"AllowRefreshNow\";\r\n        CreateExtractTasksMode[CreateExtractTasksMode[\"AllowSchedule\"] = 1] = \"AllowSchedule\";\r\n        CreateExtractTasksMode[CreateExtractTasksMode[\"AllowBoth\"] = 2] = \"AllowBoth\";\r\n    })(VizPortal.CreateExtractTasksMode || (VizPortal.CreateExtractTasksMode = {}));\r\n    var CreateExtractTasksMode = VizPortal.CreateExtractTasksMode;\r\n    ;\r\n    var DialogMode = {\r\n        RefreshNow: 'RefreshNow',\r\n        ScheduleRefresh: 'ScheduleRefresh'\r\n    };\r\n    var CreateExtractTasksAction = (function () {\r\n        function CreateExtractTasksAction(ConfirmActionDialog, ContentUrl, $translate, Workbooks, Datasources, SearchSuggestionsService, ActionHelpers, ModalService) {\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.ContentUrl = ContentUrl;\r\n            this.$translate = $translate;\r\n            this.Workbooks = Workbooks;\r\n            this.Datasources = Datasources;\r\n            this.SearchSuggestionsService = SearchSuggestionsService;\r\n            this.ActionHelpers = ActionHelpers;\r\n            this.ModalService = ModalService;\r\n            this.notificationTranslationIds = {\r\n                successId: 'extractTasksCreateSuccess',\r\n                errorId: 'extractTasksCreateError'\r\n            };\r\n        }\r\n        // Generic logic\r\n        CreateExtractTasksAction.prototype.createDialogScope = function (parentScope, items, schedulePrompt, allowedMode) {\r\n            var scope = parentScope.$new();\r\n            scope.extractTask = {\r\n                type: VizPortal.ServerApi.ExtractTaskType.RefreshExtract\r\n            };\r\n            scope.schedulePrompt = schedulePrompt;\r\n            scope.scheduleSource = this.SearchSuggestionsService.schedulesSource(VizPortal.ServerApi.ScheduleActions.Extract);\r\n            scope.allowIncremental = _.any(items.toArray(), function (item) { return item.hasIncrementalExtract; });\r\n            if (scope.allowIncremental) {\r\n                scope.extractTaskTypeOptions = [\r\n                    { value: VizPortal.ServerApi.ExtractTaskType.RefreshExtract,\r\n                        labelTranslateKey: 'extractTasksTypeRefreshExtract',\r\n                        tbTestId: 'create-extract-refresh-type-full'\r\n                    },\r\n                    { value: VizPortal.ServerApi.ExtractTaskType.IncrementExtract,\r\n                        labelTranslateKey: 'extractTasksTypeIncrementExtract',\r\n                        tbTestId: 'create-extract-refresh-type-incremental'\r\n                    }\r\n                ];\r\n            }\r\n            scope.dialog = {\r\n                mode: allowedMode === CreateExtractTasksMode.AllowSchedule ? DialogMode.ScheduleRefresh : DialogMode.RefreshNow,\r\n                showModeSelector: allowedMode === CreateExtractTasksMode.AllowBoth\r\n            };\r\n            return scope;\r\n        };\r\n        CreateExtractTasksAction.prototype.execute = function (items, context, schedulePrompt, scheduleRefreshAction, refreshNowPrompt, refreshNowAction, errorDetailFn, allowedMode) {\r\n            var _this = this;\r\n            var scope = this.createDialogScope(context.scope, items, schedulePrompt, allowedMode);\r\n            scope.refreshNowPrompt = refreshNowPrompt;\r\n            // Change the available buttons based on the dialog mode\r\n            var buttons = [];\r\n            scope.$watch(function () { return scope.dialog.mode; }, function () {\r\n                buttons.length = 0;\r\n                if (scope.dialog.mode === DialogMode.ScheduleRefresh) {\r\n                    buttons.push({\r\n                        label: _this.$translate.instant('extractTasksCreateConfirm'),\r\n                        action: function () { return scheduleRefreshAction(items.keys(), scope.extractTask.schedule.id, scope.extractTask.type); },\r\n                        disabled: function () { return !scope.extractTask.schedule || !scope.extractTask.type; }\r\n                    });\r\n                }\r\n                else {\r\n                    buttons.push({\r\n                        label: _this.$translate.instant('fullRefresh'),\r\n                        action: function () { return refreshNowAction(items.keys(), VizPortal.ServerApi.ExtractTaskType.RefreshExtract); }\r\n                    });\r\n                    if (scope.allowIncremental) {\r\n                        buttons.push({\r\n                            label: _this.$translate.instant('incrementalRefresh'),\r\n                            action: function () { return refreshNowAction(items.keys(), VizPortal.ServerApi.ExtractTaskType.IncrementExtract); }\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n            var dialogInstance = this.ConfirmActionDialog.open({\r\n                scope: scope,\r\n                position: { reserveHeight: 550 },\r\n                bodyTemplateUrl: 'confirmActionDialogExtractRefresh.html',\r\n                title: this.dialogTitle(allowedMode),\r\n                buttons: buttons,\r\n                size: '600px' // custom size to fit extra buttons\r\n            });\r\n            dialogInstance.result\r\n                .then(this.ActionHelpers.notifyStandardError(items, this.notificationTranslationIds, function (errorItem) { return errorDetailFn(scope.extractTask.schedule)(errorItem); }))\r\n                .fin(function () { return scope.$destroy(); });\r\n            return dialogInstance.result;\r\n        };\r\n        CreateExtractTasksAction.prototype.dialogTitle = function (allowedMode) {\r\n            switch (allowedMode) {\r\n                case CreateExtractTasksMode.AllowBoth:\r\n                    return this.$translate.instant('extractTasksDialogTitle_AllowBoth');\r\n                case CreateExtractTasksMode.AllowRefreshNow:\r\n                    return this.$translate.instant('extractTasksDialogTitle_AllowRefreshNow');\r\n                case CreateExtractTasksMode.AllowSchedule:\r\n                    return this.$translate.instant('extractTasksDialogTitle_AllowSchedule');\r\n                default:\r\n                    throw \"Unknown allowed mode: \" + allowedMode;\r\n            }\r\n        };\r\n        CreateExtractTasksAction.prototype.createExtractErrorMessageFor = function (errorItem, schedule) {\r\n            switch (errorItem.error.code) {\r\n                case VizPortal.SchedulingErrorCode.SchedulingScheduleNotFound:\r\n                    return this.$translate.instant('scheduleNotFound', { SCHEDULE: schedule.name });\r\n            }\r\n            return this.$translate.instant('errorUnknown');\r\n        };\r\n        // Workbook specific logic\r\n        CreateExtractTasksAction.prototype.forWorkbook = function (workbook, context, allowedMode) {\r\n            var workbookSet = VizPortal.Set.singleton(workbook, function (wb) { return wb.id; });\r\n            return this.forWorkbooks(workbookSet, context, allowedMode);\r\n        };\r\n        CreateExtractTasksAction.prototype.forWorkbooks = function (workbooks, context, allowedMode) {\r\n            var _this = this;\r\n            var schedulePrompt = (workbooks.size() === 1)\r\n                ? this.$translate.instant('schedulesLabelPromptWorkbook', { WORKBOOK_NAME: VizPortal.L10n.elideIfLong(workbooks.first().name) })\r\n                : this.$translate.instant('schedulesLabelPromptWorkbooks', { COUNT: workbooks.size() }, VizPortal.L10n.Interpolations.Count);\r\n            var refreshNowPrompt = this.$translate.instant('extractTasksRefreshNowOnWorkbooksPrompt', {\r\n                WORKBOOK_COUNT: workbooks.size(),\r\n                WORKBOOK_NAME: VizPortal.L10n.elideIfLong(workbooks.first().name)\r\n            }, VizPortal.L10n.Interpolations.Count);\r\n            return this.execute(workbooks, context, schedulePrompt, function (ids, scheduleId, type) { return _this.Workbooks.createExtractTask(ids, scheduleId, type); }, refreshNowPrompt, function (ids, type) { return _this.Workbooks.refreshExtracts(ids, type); }, function (schedule) { return _this.workbookErrorDetailFactory(schedule); }, allowedMode);\r\n        };\r\n        CreateExtractTasksAction.prototype.workbookErrorDetailFactory = function (schedule) {\r\n            var _this = this;\r\n            return function (errorItem) {\r\n                return {\r\n                    itemName: errorItem.item.name,\r\n                    itemUrl: _this.ContentUrl.forItem(errorItem.item, VizPortal.WorkbookContentType),\r\n                    errorMessage: _this.workbookErrorMessageFor(errorItem, schedule)\r\n                };\r\n            };\r\n        };\r\n        CreateExtractTasksAction.prototype.workbookErrorMessageFor = function (errorItem, schedule) {\r\n            switch (errorItem.error.code) {\r\n                case VizPortal.WebClientErrorCode.TaskTypeRefreshExtractNotAllowed:\r\n                    return this.$translate.instant('extractTasksWorkbookNoExtract');\r\n                case VizPortal.WebClientErrorCode.TaskTypeIncrementExtractNotAllowed:\r\n                    return this.$translate.instant('extractTasksWorkbookNoIncrementalExtract');\r\n                case VizPortal.SchedulingErrorCode.SchedulingExtractTaskExistsForTarget:\r\n                    return this.$translate.instant('extractTasksRefreshAlreadyExistsForWorkbook', {\r\n                        SCHEDULE: schedule.name\r\n                    });\r\n                case VizPortal.CommonErrorCode.CallingUserInsufficientPermissions:\r\n                    return this.$translate.instant('extractTasksWorkbookErrorInsufficientPermissions');\r\n            }\r\n            return this.createExtractErrorMessageFor(errorItem, schedule);\r\n        };\r\n        // Datasource specific logic\r\n        CreateExtractTasksAction.prototype.forDatasource = function (datasource, context, allowedMode) {\r\n            var datasourceSet = VizPortal.Set.singleton(datasource, function (ds) { return ds.id; });\r\n            return this.forDatasources(datasourceSet, context, allowedMode);\r\n        };\r\n        CreateExtractTasksAction.prototype.forDatasources = function (datasources, context, allowedMode) {\r\n            var _this = this;\r\n            if (!this.anyRefreshableDatasources(datasources)) {\r\n                return this.showCannotRefreshErrorAlert(datasources);\r\n            }\r\n            var schedulePrompt = (datasources.size() === 1)\r\n                ? this.$translate.instant('schedulesLabelPromptDatasource', { DATASOURCE_NAME: VizPortal.L10n.elideIfLong(datasources.first().name) })\r\n                : this.$translate.instant('schedulesLabelPromptDatasources', { COUNT: datasources.size() }, VizPortal.L10n.Interpolations.Count);\r\n            var refreshNowPrompt = this.$translate.instant('extractTasksRefreshNowOnDatasourcesPrompt', {\r\n                DATASOURCE_COUNT: datasources.size(),\r\n                DATASOURCE_NAME: VizPortal.L10n.elideIfLong(datasources.first().name)\r\n            }, VizPortal.L10n.Interpolations.Count);\r\n            return this.execute(datasources, context, schedulePrompt, function (ids, scheduleId, type) { return _this.Datasources.createExtractTask(ids, scheduleId, type); }, refreshNowPrompt, function (ids, type) { return _this.Datasources.refreshExtracts(ids, type); }, function (schedule) { return _this.datasourceErrorDetailFactory(schedule); }, allowedMode);\r\n        };\r\n        CreateExtractTasksAction.prototype.anyRefreshableDatasources = function (datasources) {\r\n            var _this = this;\r\n            return _.any(datasources.toArray(), function (ds) { return _this.isRefreshableDatasource(ds); });\r\n        };\r\n        CreateExtractTasksAction.prototype.isRefreshableDatasource = function (datasource) {\r\n            // To be refreshable, a datasource must be:\r\n            //   1. Not embedded in a workbook\r\n            //   2. Have an extract\r\n            // Embedded datasources are not refreshable\r\n            if (_.isObject(datasource.workbook)) {\r\n                return false;\r\n            }\r\n            // Live datasources are not refreshable\r\n            if (!datasource.hasExtracts) {\r\n                return false;\r\n            }\r\n            return true;\r\n        };\r\n        CreateExtractTasksAction.prototype.showCannotRefreshErrorAlert = function (datasources) {\r\n            // Determine which message to display\r\n            var allEmbedded = datasources.all(function (ds) { return _.isObject(ds.workbook); });\r\n            var anyEmbedded = datasources.any(function (ds) { return _.isObject(ds.workbook); });\r\n            var messageId = 'refreshExtracts_cannotRefreshAlertMessage_allLive';\r\n            if (allEmbedded) {\r\n                messageId = 'refreshExtracts_cannotRefreshAlertMessage_allEmbedded';\r\n            }\r\n            else if (anyEmbedded) {\r\n                messageId = 'refreshExtracts_cannotRefreshAlertMessage_mixedEmbeddedAndLive';\r\n            }\r\n            // Show alert\r\n            return this.ModalService.alert({\r\n                titleId: 'refreshExtracts_cannotRefreshAlertTitle',\r\n                messageId: messageId\r\n            }).result;\r\n        };\r\n        CreateExtractTasksAction.prototype.datasourceErrorDetailFactory = function (schedule) {\r\n            var _this = this;\r\n            return function (errorItem) {\r\n                return {\r\n                    itemName: errorItem.item.name,\r\n                    itemUrl: _this.ContentUrl.forItem(errorItem.item, VizPortal.DatasourceContentType),\r\n                    errorMessage: _this.datasourceErrorMessageFor(errorItem, schedule)\r\n                };\r\n            };\r\n        };\r\n        CreateExtractTasksAction.prototype.datasourceErrorMessageFor = function (errorItem, schedule) {\r\n            switch (errorItem.error.code) {\r\n                case VizPortal.WebClientErrorCode.TaskTypeRefreshExtractNotAllowed:\r\n                    return this.$translate.instant('extractTasksDatasourceNoExtract');\r\n                case VizPortal.WebClientErrorCode.TaskTypeIncrementExtractNotAllowed:\r\n                    return this.$translate.instant('extractTasksDatasourceNoIncrementalExtract');\r\n                case VizPortal.SchedulingErrorCode.SchedulingExtractTaskExistsForTarget:\r\n                    return this.$translate.instant('extractTasksRefreshAlreadyExistsForDatasource', {\r\n                        SCHEDULE: schedule.name\r\n                    });\r\n                case VizPortal.CommonErrorCode.CallingUserInsufficientPermissions:\r\n                    return this.$translate.instant('extractTasksDatasourceErrorInsufficientPermissions');\r\n                case VizPortal.UnifiedDatasourceErrorCode.OperationOnlySupportedForPublishedDatasource:\r\n                    return this.$translate.instant('errorOperationOnlySupportedForPublishedDatasource');\r\n            }\r\n            return this.createExtractErrorMessageFor(errorItem, schedule);\r\n        };\r\n        CreateExtractTasksAction.$inject = [\r\n            'ConfirmActionDialog',\r\n            'ContentUrl',\r\n            '$translate',\r\n            'Workbooks',\r\n            'DataSources',\r\n            'SearchSuggestionsService',\r\n            'ActionHelpers',\r\n            'ModalService'\r\n        ];\r\n        return CreateExtractTasksAction;\r\n    })();\r\n    VizPortal.CreateExtractTasksAction = CreateExtractTasksAction;\r\n    VizPortal.Module.instance().service('CreateExtractTasksAction', CreateExtractTasksAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"AbstractContentAction.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ChangeDatasourceOwnerAction = (function () {\r\n        function ChangeDatasourceOwnerAction(DataSourceErrors, ActionHelpers, ConfirmActionDialog, $translate, DataSources, suggestions, ModalService) {\r\n            this.DataSourceErrors = DataSourceErrors;\r\n            this.ActionHelpers = ActionHelpers;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.$translate = $translate;\r\n            this.DataSources = DataSources;\r\n            this.suggestions = suggestions;\r\n            this.ModalService = ModalService;\r\n        }\r\n        ChangeDatasourceOwnerAction.prototype.confirmChangeOwner = function (datasources, context) {\r\n            var _this = this;\r\n            // Disallow change owner if all selected datasources are embedded.\r\n            if (datasources.all(function (ds) { return _.isObject(ds.workbook); })) {\r\n                return this.ModalService.alert({\r\n                    titleId: 'changeOwnerDatasources_cannotChangeOwnerAlertTitle',\r\n                    messageId: 'changeOwnerDatasources_cannotChangeOwnerAlertMessage'\r\n                }).result;\r\n            }\r\n            var ownerPicker = {\r\n                prompt: datasources.size() === 1\r\n                    ? this.$translate.instant('changeOwnerDatasourcePrompt', { NAME: VizPortal.L10n.elideIfLong(datasources.first().name) })\r\n                    : this.$translate.instant('changeOwnerDatasourcesPrompt', { COUNT: datasources.size() }, VizPortal.L10n.Interpolations.Count),\r\n                ownerQuery: function (matchText) { return _this.suggestions.usersWithoutGuest(matchText); },\r\n                targetOwner: null\r\n            };\r\n            var newDialogScope = context.scope.$new();\r\n            newDialogScope.ownerPicker = ownerPicker;\r\n            var currentOwnerId = datasources.first().owner.id;\r\n            if (_.any(datasources.toArray(), function (ds) { return (ds.owner.id !== currentOwnerId); })) {\r\n                currentOwnerId = null;\r\n            }\r\n            return this.ConfirmActionDialog.open({\r\n                scope: newDialogScope,\r\n                title: this.$translate.instant('changeOwner'),\r\n                bodyTemplateUrl: 'changeOwnerDialog.html',\r\n                actionName: this.$translate.instant('changeOwnerConfirm', { COUNT: datasources.size() }, VizPortal.L10n.Interpolations.Count),\r\n                action: function (dialogInstance) {\r\n                    return _this.DataSources.setOwner(datasources.keys(), ownerPicker.targetOwner.id)\r\n                        .then(function (result) { return _this.notifyResult(datasources, result); });\r\n                },\r\n                confirmDisabled: function () { return !ownerPicker.targetOwner || ownerPicker.targetOwner.id === currentOwnerId; }\r\n            }).result.fin(function () { return newDialogScope.$destroy(); });\r\n        };\r\n        ChangeDatasourceOwnerAction.prototype.notifyResult = function (datasources, result) {\r\n            var _this = this;\r\n            this.ActionHelpers.notifyStandardError(datasources, {\r\n                successId: 'changeOwnerDatasourcesSuccess',\r\n                errorId: 'changeOwnerDatasourcesError'\r\n            }, function (errorItem) { return _this.DataSourceErrors.errorDetailsFor(errorItem); })(result);\r\n        };\r\n        ChangeDatasourceOwnerAction.$inject = ['DataSourceErrors', 'ActionHelpers', 'ConfirmActionDialog', '$translate', 'DataSources', 'SearchSuggestionsService', 'ModalService'];\r\n        return ChangeDatasourceOwnerAction;\r\n    })();\r\n    VizPortal.ChangeDatasourceOwnerAction = ChangeDatasourceOwnerAction;\r\n    VizPortal.Module.instance().service('ChangeDatasourceOwnerAction', ChangeDatasourceOwnerAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var TagsHelper;\r\n    (function (TagsHelper) {\r\n        function tagsListFromTaggedItemSet(taggedSet) {\r\n            var tagCounts = {};\r\n            taggedSet.each(function (taggedItem) {\r\n                _.forEach(taggedItem.tags, function (tagName) {\r\n                    tagCounts[tagName] = (tagCounts[tagName] || 0) + 1;\r\n                });\r\n            });\r\n            var tagList = _.map(tagCounts, function (count, tagName) {\r\n                var tagWithCount = {\r\n                    name: tagName\r\n                };\r\n                if (taggedSet.size() > count)\r\n                    tagWithCount.count = count;\r\n                return tagWithCount;\r\n            });\r\n            return _(tagList).sortBy(function (tag) { return tag.name.toLowerCase(); });\r\n        }\r\n        TagsHelper.tagsListFromTaggedItemSet = tagsListFromTaggedItemSet;\r\n        function tagSetFromTagsList(tagList) {\r\n            var tagSet = new VizPortal.Set(function (tag) { return tag.name; });\r\n            tagSet.addItems(tagList);\r\n            return tagSet;\r\n        }\r\n        TagsHelper.tagSetFromTagsList = tagSetFromTagsList;\r\n        function getTagsChange(previousTagSet, newTagsList) {\r\n            var changeTags = {\r\n                addTags: [],\r\n                removeTags: []\r\n            };\r\n            var keepTag = {};\r\n            _.forEach(newTagsList, function (tag) {\r\n                if (tag.added)\r\n                    changeTags.addTags.push(tag.name);\r\n                // A user can re-tag an item.  This is useful if a non-admin wants to add their own tagging to an item\r\n                var tagName = tag.name;\r\n                var previousTag = previousTagSet.get(tagName) || previousTagSet.get(unquote(tagName));\r\n                if (previousTag)\r\n                    keepTag[previousTag.name] = true;\r\n            });\r\n            changeTags.removeTags = _.filter(previousTagSet.keys(), function (previousTagName) { return !keepTag[previousTagName]; });\r\n            return changeTags;\r\n        }\r\n        TagsHelper.getTagsChange = getTagsChange;\r\n        function parseTagString(tagString) {\r\n            var tagList = [];\r\n            tagString = tagString.replace(/\"[^\"]*?\"/g, function (quotedTag) {\r\n                tagList.push(quotedTag);\r\n                return '';\r\n            });\r\n            var splitTags = _.flatten(_.map(tagString.split(','), function (commaSplitTag) { return commaSplitTag.split(' '); }));\r\n            return _.union(tagList, splitTags);\r\n        }\r\n        TagsHelper.parseTagString = parseTagString;\r\n        function quote(tag) {\r\n            return _(tag).contains('\"') ? tag : ('\"' + tag + '\"');\r\n        }\r\n        TagsHelper.quote = quote;\r\n        function unquote(tag) {\r\n            return tag.replace(/^\"([^\"]*)\"$/, \"$1\");\r\n        }\r\n        TagsHelper.unquote = unquote;\r\n        function displayTagHtml(tag) {\r\n            return _.escape(unquote(tag)).replace(/ /g, '&nbsp;');\r\n        }\r\n        TagsHelper.displayTagHtml = displayTagHtml;\r\n    })(TagsHelper = VizPortal.TagsHelper || (VizPortal.TagsHelper = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/TagsInputHelper.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"AbstractContentAction.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ChangeTagsActionHelperService = (function () {\r\n        function ChangeTagsActionHelperService(ConfirmActionDialog, ActionHelpers, $translate) {\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.ActionHelpers = ActionHelpers;\r\n            this.$translate = $translate;\r\n        }\r\n        ChangeTagsActionHelperService.prototype.createExecuteFn = function (params) {\r\n            var _this = this;\r\n            return function (itemSet, context) {\r\n                var scope = _this.configureScope(context.scope, itemSet, params.getDescription);\r\n                var previousTagSet = VizPortal.TagsHelper.tagSetFromTagsList(scope.tags.model);\r\n                var dialogConfig = {\r\n                    scope: scope,\r\n                    bodyTemplateUrl: 'confirmActionDialogTags.html',\r\n                    title: _this.$translate.instant('changeTags'),\r\n                    actionName: _this.$translate.instant('changeTagsConfirm'),\r\n                    action: function () {\r\n                        var editTags = VizPortal.TagsHelper.getTagsChange(previousTagSet, scope.tags.model);\r\n                        return params.changeTagsAction(itemSet.keys(), editTags.addTags, editTags.removeTags);\r\n                    },\r\n                    position: { reserveHeight: 450 }\r\n                };\r\n                var dialogInstance = _this.ConfirmActionDialog.open(dialogConfig);\r\n                dialogInstance.result\r\n                    .then(_this.ActionHelpers.notifyStandardError(itemSet, params.notificationIds, params.errorDetailFn))\r\n                    .fin(function () { return scope.$destroy(); });\r\n                return dialogInstance.result;\r\n            };\r\n        };\r\n        ChangeTagsActionHelperService.prototype.configureScope = function (parentScope, itemSet, getDescription) {\r\n            var scope = parentScope.$new();\r\n            scope.description = getDescription(itemSet);\r\n            scope.tags = {\r\n                model: VizPortal.TagsHelper.tagsListFromTaggedItemSet(itemSet)\r\n            };\r\n            return scope;\r\n        };\r\n        ChangeTagsActionHelperService.prototype.errorMessageFor = function (errorItem) {\r\n            switch (errorItem.error.code) {\r\n                case VizPortal.CommonErrorCode.CallingUserInsufficientPermissions:\r\n                    return this.$translate.instant('changeTagsErrorNoPermission');\r\n                case VizPortal.TagErrorCode.TagNameTooLong:\r\n                    return this.$translate.instant('changeTagsErrorNameTooLong');\r\n                default:\r\n                    return this.$translate.instant('errorUnknown');\r\n            }\r\n        };\r\n        ChangeTagsActionHelperService.$inject = ['ConfirmActionDialog', 'ActionHelpers', '$translate', 'DataSources'];\r\n        return ChangeTagsActionHelperService;\r\n    })();\r\n    VizPortal.ChangeTagsActionHelperService = ChangeTagsActionHelperService;\r\n    VizPortal.Module.instance().service('ChangeTagsActionHelperService', ChangeTagsActionHelperService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/TagsInputHelper.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"ChangeTagsActionHelper.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ChangeDatasourcesTagsAction = (function () {\r\n        function ChangeDatasourcesTagsAction(ChangeTagsActionHelper, $translate, DataSources, ContentUrl, ModalService) {\r\n            var _this = this;\r\n            this.ChangeTagsActionHelper = ChangeTagsActionHelper;\r\n            this.$translate = $translate;\r\n            this.DataSources = DataSources;\r\n            this.ContentUrl = ContentUrl;\r\n            this.ModalService = ModalService;\r\n            this.execute = ChangeTagsActionHelper.createExecuteFn({\r\n                changeTagsAction: function (ids, addTags, removeTags) { return _this.DataSources.changeTags(ids, addTags, removeTags); },\r\n                getDescription: function (datasources) { return _this.getDescription(datasources); },\r\n                notificationIds: ChangeDatasourcesTagsAction.notificationTranslationIds,\r\n                errorDetailFn: function (errorItem) { return _this.changeTagsErrorDetail(errorItem); }\r\n            });\r\n        }\r\n        ChangeDatasourcesTagsAction.prototype.getDescription = function (datasources) {\r\n            return (datasources.size() === 1)\r\n                ? this.$translate.instant('changeTagsDatasourceDescription', { NAME: VizPortal.L10n.elideIfLong(datasources.first().name) })\r\n                : this.$translate.instant('changeTagsDatasourcesDescription', { COUNT: datasources.size() }, VizPortal.L10n.Interpolations.Count);\r\n        };\r\n        ChangeDatasourcesTagsAction.prototype.showChangeTagsDialog = function (datasources, actionContext) {\r\n            // Disallow changing tags if all selected datasources are embedded.\r\n            if (datasources.all(function (ds) { return _.isObject(ds.workbook); })) {\r\n                return this.ModalService.alert({\r\n                    titleId: 'changeTagsDatasource_cannotTagAlertTitle',\r\n                    messageId: 'changeTagsDatasource_cannotTagAlertMessage'\r\n                }).result;\r\n            }\r\n            return this.execute(datasources, actionContext);\r\n        };\r\n        ChangeDatasourcesTagsAction.prototype.changeTagsErrorDetail = function (errorItem) {\r\n            return {\r\n                itemName: errorItem.item.name,\r\n                itemUrl: this.ContentUrl.forItem(errorItem.item, VizPortal.DatasourceContentType),\r\n                errorMessage: this.ChangeTagsActionHelper.errorMessageFor(errorItem)\r\n            };\r\n        };\r\n        ChangeDatasourcesTagsAction.notificationTranslationIds = {\r\n            successId: 'changeTagsDatasourcesSuccess',\r\n            errorId: 'changeTagsDatasourcesError'\r\n        };\r\n        ChangeDatasourcesTagsAction.$inject = ['ChangeTagsActionHelperService', '$translate', 'DataSources', 'ContentUrl', 'ModalService'];\r\n        return ChangeDatasourcesTagsAction;\r\n    })();\r\n    VizPortal.ChangeDatasourcesTagsAction = ChangeDatasourcesTagsAction;\r\n    VizPortal.Module.instance().service('ChangeDatasourcesTagsAction', ChangeDatasourcesTagsAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ChangeProjectOwnerAction = (function () {\r\n        function ChangeProjectOwnerAction(ProjectErrors, ActionHelpers, ConfirmActionDialog, $translate, Projects, suggestions) {\r\n            this.ProjectErrors = ProjectErrors;\r\n            this.ActionHelpers = ActionHelpers;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.$translate = $translate;\r\n            this.Projects = Projects;\r\n            this.suggestions = suggestions;\r\n        }\r\n        ChangeProjectOwnerAction.prototype.confirmChangeOwner = function (projects, context) {\r\n            var _this = this;\r\n            var ownerPicker = {\r\n                prompt: projects.size() === 1\r\n                    ? this.$translate.instant('changeOwnerProjectPrompt', { NAME: VizPortal.L10n.elideIfLong(projects.first().name) })\r\n                    : this.$translate.instant('changeOwnerProjectsPrompt', { COUNT: projects.size() }, VizPortal.L10n.Interpolations.Count),\r\n                ownerQuery: function (matchText) { return _this.suggestions.adminUsers(matchText); },\r\n                targetOwner: null\r\n            };\r\n            var newDialogScope = context.scope.$new();\r\n            newDialogScope.ownerPicker = ownerPicker;\r\n            return this.ConfirmActionDialog.open({\r\n                scope: newDialogScope,\r\n                title: this.$translate.instant('changeOwner'),\r\n                bodyTemplateUrl: 'changeOwnerDialog.html',\r\n                actionName: this.$translate.instant('changeOwnerConfirm', { COUNT: projects.size() }, VizPortal.L10n.Interpolations.Count),\r\n                action: function (dialogInstance) {\r\n                    return _this.Projects.setOwner(projects.keys(), ownerPicker.targetOwner.id)\r\n                        .then(function (result) { return _this.notifyResult(projects, result); });\r\n                },\r\n                confirmDisabled: function () { return !ownerPicker.targetOwner || !ownerPicker.targetOwner.id; }\r\n            }).result.fin(function () { return newDialogScope.$destroy(); });\r\n        };\r\n        ChangeProjectOwnerAction.prototype.notifyResult = function (projects, result) {\r\n            var _this = this;\r\n            this.ActionHelpers.notifyStandardError(projects, {\r\n                successId: 'changeOwnerProjectsSuccess',\r\n                errorId: 'changeOwnerProjectsError'\r\n            }, function (errorItem) { return _this.ProjectErrors.errorDetailsFor(errorItem); })(result);\r\n        };\r\n        ChangeProjectOwnerAction.$inject = ['ProjectErrors', 'ActionHelpers', 'ConfirmActionDialog', '$translate', 'Projects', 'SearchSuggestionsService'];\r\n        return ChangeProjectOwnerAction;\r\n    })();\r\n    VizPortal.ChangeProjectOwnerAction = ChangeProjectOwnerAction;\r\n    VizPortal.Module.instance().service('ChangeProjectOwnerAction', ChangeProjectOwnerAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../helpers/TagsInputHelper.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"ChangeTagsActionHelper.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ChangeViewTagsAction = (function () {\r\n        function ChangeViewTagsAction(ChangeTagsActionHelper, $translate, Views, ContentUrl) {\r\n            var _this = this;\r\n            this.ChangeTagsActionHelper = ChangeTagsActionHelper;\r\n            this.$translate = $translate;\r\n            this.Views = Views;\r\n            this.ContentUrl = ContentUrl;\r\n            /*\r\n             changeTagsAction: (ids: string[], addTags: string[], removeTags: string[]) => ng.IPromise<ServerApi.IResult>;\r\n             getDescription: (itemSet: Set<T>) => string;\r\n             notificationIds: INotificationTranslationIds;\r\n             errorDetailFn: (errorItem: IErrorItem<T>) => IErrorDetail;\r\n             */\r\n            this.execute = ChangeTagsActionHelper.createExecuteFn({\r\n                changeTagsAction: function (ids, addTags, removeTags) { return _this.Views.changeTags(ids, addTags, removeTags); },\r\n                getDescription: function (views) { return _this.getDescription(views); },\r\n                notificationIds: ChangeViewTagsAction.notificationTranslationIds,\r\n                errorDetailFn: function (errorItem) { return _this.changeTagsErrorDetail(errorItem); }\r\n            });\r\n        }\r\n        ChangeViewTagsAction.prototype.getDescription = function (views) {\r\n            return (views.size() === 1)\r\n                ? this.$translate.instant('changeTagsViewDescription', { NAME: VizPortal.L10n.elideIfLong(views.first().name) })\r\n                : this.$translate.instant('changeTagsViewsDescription', { COUNT: views.size() }, VizPortal.L10n.Interpolations.Count);\r\n        };\r\n        ChangeViewTagsAction.prototype.changeTagsErrorDetail = function (errorItem) {\r\n            return {\r\n                itemName: errorItem.item.name,\r\n                itemUrl: this.ContentUrl.forItem(errorItem.item, VizPortal.ViewContentType),\r\n                errorMessage: this.ChangeTagsActionHelper.errorMessageFor(errorItem)\r\n            };\r\n        };\r\n        ChangeViewTagsAction.notificationTranslationIds = {\r\n            successId: 'changeTagsViewsSuccess',\r\n            errorId: 'changeTagsViewsError'\r\n        };\r\n        ChangeViewTagsAction.$inject = ['ChangeTagsActionHelperService', '$translate', 'Views', 'ContentUrl'];\r\n        return ChangeViewTagsAction;\r\n    })();\r\n    VizPortal.ChangeViewTagsAction = ChangeViewTagsAction;\r\n    VizPortal.Module.instance().service('ChangeViewTagsAction', ChangeViewTagsAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"AbstractContentAction.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ChangeWorkbookOwnerAction = (function () {\r\n        function ChangeWorkbookOwnerAction(WorkbookErrors, ActionHelpers, ConfirmActionDialog, $translate, Workbooks, suggestions) {\r\n            this.WorkbookErrors = WorkbookErrors;\r\n            this.ActionHelpers = ActionHelpers;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.$translate = $translate;\r\n            this.Workbooks = Workbooks;\r\n            this.suggestions = suggestions;\r\n        }\r\n        ChangeWorkbookOwnerAction.prototype.confirmChangeOwner = function (workbooks, context) {\r\n            var _this = this;\r\n            var ownerPicker = {\r\n                prompt: workbooks.size() === 1\r\n                    ? this.$translate.instant('changeOwnerWorkbookPrompt', { NAME: VizPortal.L10n.elideIfLong(workbooks.first().name) })\r\n                    : this.$translate.instant('changeOwnerWorkbooksPrompt', { COUNT: workbooks.size() }, VizPortal.L10n.Interpolations.Count),\r\n                ownerQuery: function (matchText) { return _this.suggestions.usersWithoutGuest(matchText); },\r\n                targetOwner: null\r\n            };\r\n            var newDialogScope = context.scope.$new();\r\n            newDialogScope.ownerPicker = ownerPicker;\r\n            return this.ConfirmActionDialog.open({\r\n                scope: newDialogScope,\r\n                title: this.$translate.instant('changeOwner'),\r\n                bodyTemplateUrl: 'changeOwnerDialog.html',\r\n                actionName: this.$translate.instant('changeOwnerConfirm', { COUNT: workbooks.size() }, VizPortal.L10n.Interpolations.Count),\r\n                action: function (dialogInstance) {\r\n                    return _this.Workbooks.setOwner(workbooks.keys(), ownerPicker.targetOwner.id)\r\n                        .then(function (result) { return _this.notifyResult(workbooks, result); });\r\n                },\r\n                confirmDisabled: function () { return !ownerPicker.targetOwner || !ownerPicker.targetOwner.id; }\r\n            }).result.fin(function () { return newDialogScope.$destroy(); });\r\n        };\r\n        ChangeWorkbookOwnerAction.prototype.notifyResult = function (workbooks, result) {\r\n            var _this = this;\r\n            this.ActionHelpers.notifyStandardError(workbooks, {\r\n                successId: 'changeOwnerWorkbooksSuccess',\r\n                errorId: 'changeOwnerWorkbooksError'\r\n            }, function (errorItem) { return _this.WorkbookErrors.errorDetailsFor(errorItem); })(result);\r\n        };\r\n        ChangeWorkbookOwnerAction.$inject = ['WorkbookErrors', 'ActionHelpers', 'ConfirmActionDialog', '$translate', 'Workbooks', 'SearchSuggestionsService'];\r\n        return ChangeWorkbookOwnerAction;\r\n    })();\r\n    VizPortal.ChangeWorkbookOwnerAction = ChangeWorkbookOwnerAction;\r\n    VizPortal.Module.instance().service('ChangeWorkbookOwnerAction', ChangeWorkbookOwnerAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../helpers/TagsInputHelper.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"ChangeTagsActionHelper.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ChangeWorkbooksTagsAction = (function () {\r\n        function ChangeWorkbooksTagsAction(ChangeTagsActionHelper, $translate, Workbooks, ContentUrl) {\r\n            var _this = this;\r\n            this.ChangeTagsActionHelper = ChangeTagsActionHelper;\r\n            this.$translate = $translate;\r\n            this.Workbooks = Workbooks;\r\n            this.ContentUrl = ContentUrl;\r\n            this.execute = ChangeTagsActionHelper.createExecuteFn({\r\n                changeTagsAction: function (ids, addTags, removeTags) { return _this.Workbooks.changeTags(ids, addTags, removeTags); },\r\n                getDescription: function (workbooks) { return _this.getDescription(workbooks); },\r\n                notificationIds: ChangeWorkbooksTagsAction.notificationTranslationIds,\r\n                errorDetailFn: function (errorItem) { return _this.changeTagsErrorDetail(errorItem); }\r\n            });\r\n        }\r\n        ChangeWorkbooksTagsAction.prototype.getDescription = function (workbooks) {\r\n            return (workbooks.size() === 1)\r\n                ? this.$translate.instant('changeTagsWorkbookDescription', { NAME: VizPortal.L10n.elideIfLong(workbooks.first().name) })\r\n                : this.$translate.instant('changeTagsWorkbooksDescription', { COUNT: workbooks.size() }, VizPortal.L10n.Interpolations.Count);\r\n        };\r\n        ChangeWorkbooksTagsAction.prototype.changeTagsErrorDetail = function (errorItem) {\r\n            return {\r\n                itemName: errorItem.item.name,\r\n                itemUrl: this.ContentUrl.forItem(errorItem.item, VizPortal.WorkbookContentType),\r\n                errorMessage: this.ChangeTagsActionHelper.errorMessageFor(errorItem)\r\n            };\r\n        };\r\n        ChangeWorkbooksTagsAction.notificationTranslationIds = {\r\n            successId: 'changeTagsWorkbooksSuccess',\r\n            errorId: 'changeTagsWorkbooksError'\r\n        };\r\n        ChangeWorkbooksTagsAction.$inject = ['ChangeTagsActionHelperService', '$translate', 'Workbooks', 'ContentUrl'];\r\n        return ChangeWorkbooksTagsAction;\r\n    })();\r\n    VizPortal.ChangeWorkbooksTagsAction = ChangeWorkbooksTagsAction;\r\n    VizPortal.Module.instance().service('ChangeWorkbooksTagsAction', ChangeWorkbooksTagsAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\n/// <reference path=\"ContentActionNotification.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var CreateProjectAction = (function () {\r\n        function CreateProjectAction(ConfirmActionDialog, $translate, toaster, Projects) {\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.$translate = $translate;\r\n            this.toaster = toaster;\r\n            this.Projects = Projects;\r\n        }\r\n        CreateProjectAction.prototype.execute = function (actionContext) {\r\n            var _this = this;\r\n            var dialogScope = actionContext.scope.$new();\r\n            dialogScope.dialog = {\r\n                name: '',\r\n                description: ''\r\n            };\r\n            return this.ConfirmActionDialog.open({\r\n                scope: dialogScope,\r\n                title: this.$translate.instant('createProjectDialogTitle'),\r\n                bodyTemplateUrl: \"createProjectDialog.html\",\r\n                position: { reserveHeight: 750 },\r\n                actionName: this.$translate.instant('createProjectDialogSubmit'),\r\n                action: function (dialogInstance) {\r\n                    return _this.Projects.create(dialogScope.dialog.name, dialogScope.dialog.description).then(function (result) {\r\n                        if (result.errors && result.errors.length) {\r\n                            dialogInstance.showErrorMessage(_this.errorMessage(result.errors));\r\n                        }\r\n                        else {\r\n                            _this.toaster.pop({\r\n                                type: VizPortal.ToastType.Info,\r\n                                text: _this.$translate.instant('createProjectSuccess', {\r\n                                    PROJECT_NAME: VizPortal.L10n.elideIfLong(dialogScope.dialog.name)\r\n                                })\r\n                            });\r\n                        }\r\n                        return result;\r\n                    });\r\n                }\r\n            }).result.fin(function () { return dialogScope.$destroy(); });\r\n        };\r\n        CreateProjectAction.prototype.errorMessage = function (errors) {\r\n            switch (errors[0].code) {\r\n                case VizPortal.ProjectErrorCode.ProjectNameAlreadyExists:\r\n                    return this.$translate.instant('errorProjectNameAlreadyExists');\r\n                default:\r\n                    return this.$translate.instant('createProjectFailed');\r\n            }\r\n        };\r\n        CreateProjectAction.$inject = ['ConfirmActionDialog', '$translate', 'ToasterService', 'Projects'];\r\n        return CreateProjectAction;\r\n    })();\r\n    VizPortal.CreateProjectAction = CreateProjectAction;\r\n    VizPortal.Module.instance().service('CreateProjectAction', CreateProjectAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DeleteDatasourcesAction = (function () {\r\n        function DeleteDatasourcesAction(DataSourceErrors, ActionHelpers, ConfirmActionDialog, $translate, DataSources, ModalService) {\r\n            this.DataSourceErrors = DataSourceErrors;\r\n            this.ActionHelpers = ActionHelpers;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.$translate = $translate;\r\n            this.DataSources = DataSources;\r\n            this.ModalService = ModalService;\r\n        }\r\n        DeleteDatasourcesAction.prototype.confirmDeleteDatasource = function (datasource, context) {\r\n            return this.confirmDeleteDatasources(VizPortal.Set.singleton(datasource, function (ds) { return ds.id; }), context);\r\n        };\r\n        DeleteDatasourcesAction.prototype.confirmDeleteDatasources = function (datasources, context) {\r\n            var _this = this;\r\n            // Disallow delete if all selected datasources are embedded.\r\n            if (datasources.all(function (ds) { return _.isObject(ds.workbook); })) {\r\n                return this.ModalService.alert({\r\n                    titleId: 'deleteDatasources_cannotDeleteAlertTitle',\r\n                    messageId: 'deleteDatasources_cannotDeleteAlertMessage'\r\n                }).result.then(function () {\r\n                    return {\r\n                        allowed: false\r\n                    };\r\n                });\r\n            }\r\n            var dialogBody = datasources.size() === 1\r\n                ? this.$translate.instant('confirmDeleteDatasource', { DATASOURCE_NAME: VizPortal.L10n.elideIfLong(datasources.first().name) })\r\n                : this.$translate.instant('confirmDeleteDatasources', { DATASOURCE_COUNT: datasources.size() }, VizPortal.L10n.Interpolations.Count);\r\n            return this.ConfirmActionDialog.open({\r\n                scope: context.scope,\r\n                title: this.$translate.instant('delete'),\r\n                bodyText: dialogBody,\r\n                actionName: this.$translate.instant('confirmDeleteButton', {\r\n                    ITEM_COUNT: datasources.size()\r\n                }, VizPortal.L10n.Interpolations.Count),\r\n                isDeleteAction: true,\r\n                action: function (dialogInstance) {\r\n                    return _this.DataSources.del(datasources.keys()).then(function (result) { return _this.notifyResult(datasources, result); });\r\n                }\r\n            }).result.then(function (serverResult) {\r\n                return {\r\n                    allowed: true,\r\n                    serverResult: serverResult\r\n                };\r\n            });\r\n        };\r\n        DeleteDatasourcesAction.prototype.notifyResult = function (datasources, result) {\r\n            var _this = this;\r\n            this.ActionHelpers.notifyStandardError(datasources, {\r\n                successId: 'deleteDatasourcesSuccess',\r\n                errorId: 'deleteDatasourcesError'\r\n            }, function (errorItem) { return _this.DataSourceErrors.errorDetailsFor(errorItem); })(result);\r\n        };\r\n        DeleteDatasourcesAction.$inject = ['DataSourceErrors', 'ActionHelpers', 'ConfirmActionDialog', '$translate', 'DataSources', 'ModalService'];\r\n        return DeleteDatasourcesAction;\r\n    })();\r\n    VizPortal.DeleteDatasourcesAction = DeleteDatasourcesAction;\r\n    VizPortal.Module.instance().service('DeleteDatasourcesAction', DeleteDatasourcesAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DeleteProjectsAction = (function () {\r\n        function DeleteProjectsAction(ProjectErrors, ActionHelpers, ConfirmActionDialog, $translate, Projects) {\r\n            this.ProjectErrors = ProjectErrors;\r\n            this.ActionHelpers = ActionHelpers;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.$translate = $translate;\r\n            this.Projects = Projects;\r\n        }\r\n        DeleteProjectsAction.prototype.confirmDeleteProjects = function (projects, context) {\r\n            var _this = this;\r\n            var workbookCount = projects.sum(function (p) { return p.workbookCount; });\r\n            var datasourceCount = projects.sum(function (p) { return p.datasourceCount; });\r\n            var dialogBody = projects.size() === 1\r\n                ? this.$translate.instant('confirmDeleteProject', {\r\n                    PROJECT_NAME: VizPortal.L10n.elideIfLong(projects.first().name),\r\n                    WORKBOOK_COUNT: workbookCount,\r\n                    DATASOURCE_COUNT: datasourceCount\r\n                }, VizPortal.L10n.Interpolations.Count)\r\n                : this.$translate.instant('confirmDeleteProjects', {\r\n                    PROJECT_COUNT: projects.size(),\r\n                    WORKBOOK_COUNT: workbookCount,\r\n                    DATASOURCE_COUNT: datasourceCount\r\n                }, VizPortal.L10n.Interpolations.Count);\r\n            return this.ConfirmActionDialog.open({\r\n                scope: context.scope,\r\n                title: this.$translate.instant('delete'),\r\n                bodyText: dialogBody,\r\n                actionName: this.$translate.instant('confirmDeleteButton', {\r\n                    ITEM_COUNT: projects.size()\r\n                }, VizPortal.L10n.Interpolations.Count),\r\n                isDeleteAction: true,\r\n                action: function (dialogInstance) {\r\n                    return _this.Projects.del(projects.keys()).then(function (result) { return _this.notifyResult(projects, result); });\r\n                }\r\n            }).result;\r\n        };\r\n        DeleteProjectsAction.prototype.notifyResult = function (projects, result) {\r\n            var _this = this;\r\n            this.ActionHelpers.notifyStandardError(projects, {\r\n                successId: 'deleteProjectsSuccess',\r\n                errorId: 'deleteProjectsError'\r\n            }, function (errorItem) { return _this.ProjectErrors.errorDetailsFor(errorItem); })(result);\r\n        };\r\n        DeleteProjectsAction.$inject = ['ProjectErrors', 'ActionHelpers', 'ConfirmActionDialog', '$translate', 'Projects'];\r\n        return DeleteProjectsAction;\r\n    })();\r\n    VizPortal.DeleteProjectsAction = DeleteProjectsAction;\r\n    VizPortal.Module.instance().service('DeleteProjectsAction', DeleteProjectsAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"AbstractContentAction.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DeleteSitesAction = (function () {\r\n        function DeleteSitesAction($translate, $state, server, SiteSwitchService, ConfirmActionDialog, Sites, ToasterService) {\r\n            this.$translate = $translate;\r\n            this.$state = $state;\r\n            this.server = server;\r\n            this.SiteSwitchService = SiteSwitchService;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.Sites = Sites;\r\n            this.ToasterService = ToasterService;\r\n        }\r\n        DeleteSitesAction.prototype.execute = function (sites, actionContext) {\r\n            var _this = this;\r\n            return this.ConfirmActionDialog.open({\r\n                title: this.$translate.instant('delete'),\r\n                bodyText: this.$translate.instant('confirmDeleteSites', {\r\n                    ITEM_COUNT: sites.size(),\r\n                    ITEM_NAME: VizPortal.L10n.elideIfLong(sites.first().settings.name)\r\n                }, VizPortal.L10n.Interpolations.Count),\r\n                actionName: this.$translate.instant('confirmDeleteButton', {\r\n                    ITEM_COUNT: sites.size()\r\n                }, VizPortal.L10n.Interpolations.Count),\r\n                isDeleteAction: true,\r\n                action: function (confirmActionDialogInstance) {\r\n                    _this.sites = sites;\r\n                    _this.confirmActionDialogInstance = confirmActionDialogInstance;\r\n                    var isAttemptingToDeleteCurrentSite = _this.server.sessionSiteUrlName() !== ''\r\n                        && !_.isUndefined(_this.sites.find(function (site) { return _this.server.isCurrentSiteUrlName(site.settings.urlName); }));\r\n                    if (isAttemptingToDeleteCurrentSite) {\r\n                        return _this.SiteSwitchService.switchIfNeededNoFeedback('')\r\n                            .then(function () { return _this.deleteSites(); }, function () { return _this.deleteSites().then(function () { return _this.$state.go('login.authenticate'); }); });\r\n                    }\r\n                    else {\r\n                        return _this.deleteSites();\r\n                    }\r\n                }\r\n            }).result;\r\n        };\r\n        DeleteSitesAction.prototype.deleteSites = function () {\r\n            var _this = this;\r\n            return this.Sites.del(this.sites.keys()).then(function (actionResult) { return _this.onComplete(actionResult); }, function (errors) { return _this.onFail(errors); }, function (action) { return _this.onNotify(action); });\r\n        };\r\n        DeleteSitesAction.prototype.onComplete = function (actionResult) {\r\n            if (actionResult && actionResult.succeeded === false) {\r\n                this.onFail(actionResult.response && actionResult.response.errors);\r\n            }\r\n            else {\r\n                this.confirmActionDialogInstance.setProgress(100);\r\n                this.ToasterService.pop({\r\n                    type: VizPortal.ToastType.Info,\r\n                    text: this.$translate.instant('deleteSitesSuccess', {\r\n                        ITEM_COUNT: this.sites.size()\r\n                    }, VizPortal.L10n.Interpolations.Count)\r\n                });\r\n                // Refresh session info in case we switched from multi-site to single-site\r\n                this.server.refreshSessionInfo();\r\n            }\r\n        };\r\n        DeleteSitesAction.prototype.onFail = function (errors) {\r\n            var successCount = this.sites.size();\r\n            this.confirmActionDialogInstance.setProgress(undefined);\r\n            if (errors && errors.length) {\r\n                successCount -= errors.length;\r\n                var attemptedToDeleteDefaultSiteError = _.find(errors, function (e) { return e.code === VizPortal.SiteSettingsErrorCode.AttemptedToDeleteDefaultSite; });\r\n                // Error toast if attempted to delete default site\r\n                if (attemptedToDeleteDefaultSiteError) {\r\n                    this.ToasterService.pop({ type: VizPortal.ToastType.Error, text: this.$translate.instant('siteSettingsFailedAttemptedToDeleteDefaultSite') });\r\n                }\r\n                // Inline error message if there are errors besides attempting to delete default site\r\n                if (errors.length > 1 || !attemptedToDeleteDefaultSiteError) {\r\n                    this.confirmActionDialogInstance.showErrorMessage(this.$translate.instant('deleteSitesFailed', {\r\n                        ITEM_COUNT: errors.length\r\n                    }, VizPortal.L10n.Interpolations.Count));\r\n                }\r\n                // If there was a partial success, display it in a success toast\r\n                if (successCount > 0) {\r\n                    this.ToasterService.pop({\r\n                        type: VizPortal.ToastType.Info,\r\n                        text: this.$translate.instant('deleteSitesSuccess', {\r\n                            ITEM_COUNT: successCount\r\n                        }, VizPortal.L10n.Interpolations.Count)\r\n                    });\r\n                    // Refresh session info in case we switched from multi-site to single-site\r\n                    this.server.refreshSessionInfo();\r\n                }\r\n            }\r\n            else {\r\n                // If we have a failure with no errors, assume all delete actions failed\r\n                this.confirmActionDialogInstance.showErrorMessage(this.$translate.instant('deleteSitesFailed', {\r\n                    ITEM_COUNT: this.sites.size()\r\n                }, VizPortal.L10n.Interpolations.Count));\r\n            }\r\n        };\r\n        DeleteSitesAction.prototype.onNotify = function (action) {\r\n            this.confirmActionDialogInstance.setProgress(action.percentComplete);\r\n        };\r\n        DeleteSitesAction.$inject = [\r\n            '$translate',\r\n            '$state',\r\n            'ServerService',\r\n            'SiteSwitchService',\r\n            'ConfirmActionDialog',\r\n            'Sites',\r\n            'ToasterService'\r\n        ];\r\n        return DeleteSitesAction;\r\n    })();\r\n    VizPortal.DeleteSitesAction = DeleteSitesAction;\r\n    VizPortal.Module.instance().service('DeleteSitesAction', DeleteSitesAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DeleteWorkbooksAction = (function () {\r\n        function DeleteWorkbooksAction(WorkbookErrors, ActionHelpers, ConfirmActionDialog, $translate, Workbooks) {\r\n            this.WorkbookErrors = WorkbookErrors;\r\n            this.ActionHelpers = ActionHelpers;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.$translate = $translate;\r\n            this.Workbooks = Workbooks;\r\n        }\r\n        DeleteWorkbooksAction.prototype.confirmDeleteWorkbooks = function (workbooks, context) {\r\n            var _this = this;\r\n            var viewCount = workbooks.sum(function (w) { return w.numSheets; });\r\n            var dialogBody = workbooks.size() === 1\r\n                ? this.$translate.instant('confirmDeleteWorkbook', {\r\n                    WORKBOOK_NAME: VizPortal.L10n.elideIfLong(workbooks.first().name),\r\n                    VIEW_COUNT: viewCount\r\n                }, VizPortal.L10n.Interpolations.Count)\r\n                : this.$translate.instant('confirmDeleteWorkbooks', {\r\n                    WORKBOOK_COUNT: workbooks.size(),\r\n                    VIEW_COUNT: viewCount\r\n                }, VizPortal.L10n.Interpolations.Count);\r\n            return this.ConfirmActionDialog.open({\r\n                scope: context.scope,\r\n                title: this.$translate.instant('delete'),\r\n                bodyText: dialogBody,\r\n                actionName: this.$translate.instant('confirmDeleteButton', {\r\n                    ITEM_COUNT: workbooks.size()\r\n                }, VizPortal.L10n.Interpolations.Count),\r\n                isDeleteAction: true,\r\n                action: function (dialogInstance) {\r\n                    return _this.Workbooks.del(workbooks.keys()).then(function (result) { return _this.notifyResult(workbooks, result); });\r\n                }\r\n            }).result;\r\n        };\r\n        DeleteWorkbooksAction.prototype.notifyResult = function (workbooks, result) {\r\n            var _this = this;\r\n            this.ActionHelpers.notifyStandardError(workbooks, {\r\n                successId: 'deleteWorkbooksSuccess',\r\n                errorId: 'deleteWorkbooksError'\r\n            }, function (errorItem) { return _this.WorkbookErrors.errorDetailsFor(errorItem); })(result);\r\n        };\r\n        DeleteWorkbooksAction.$inject = ['WorkbookErrors', 'ActionHelpers', 'ConfirmActionDialog', '$translate', 'Workbooks'];\r\n        return DeleteWorkbooksAction;\r\n    })();\r\n    VizPortal.DeleteWorkbooksAction = DeleteWorkbooksAction;\r\n    VizPortal.Module.instance().service('DeleteWorkbooksAction', DeleteWorkbooksAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"resourceParts.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\n/// <reference path=\"../ServerApi/types/IWorkbookRevision.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DownloadActions = (function () {\r\n        function DownloadActions($translate, $q, toaster, windowLocationService, Workbooks, DataSources) {\r\n            this.$translate = $translate;\r\n            this.$q = $q;\r\n            this.toaster = toaster;\r\n            this.windowLocationService = windowLocationService;\r\n            this.Workbooks = Workbooks;\r\n            this.DataSources = DataSources;\r\n        }\r\n        DownloadActions.prototype.download = function (downloadItem) {\r\n            if (!downloadItem.downloadUrl)\r\n                return false;\r\n            this.windowLocationService.download(downloadItem.downloadUrl);\r\n            return true;\r\n        };\r\n        DownloadActions.prototype.downloadWorkbook = function (workbook) {\r\n            var _this = this;\r\n            return this.Workbooks\r\n                .getById(workbook.id)\r\n                .then(function (workbook) {\r\n                var success = _this.download(workbook);\r\n                if (!success) {\r\n                    _this.toaster.pop({\r\n                        type: VizPortal.ToastType.Error,\r\n                        text: _this.$translate.instant('downloadDatasourceError', { NAME: VizPortal.L10n.elideIfLong(workbook.name) })\r\n                    });\r\n                }\r\n                return workbook;\r\n            })\r\n                .fail(function (result) {\r\n                _this.toaster.pop({\r\n                    type: VizPortal.ToastType.Error,\r\n                    text: _this.$translate.instant('downloadWorkbookError', { NAME: VizPortal.L10n.elideIfLong(workbook.name) })\r\n                });\r\n                return _this.$q.reject(result);\r\n            });\r\n        };\r\n        DownloadActions.prototype.downloadDatasource = function (datasource) {\r\n            var _this = this;\r\n            return this.DataSources\r\n                .getById(datasource.id)\r\n                .then(function (datasource) {\r\n                var success = _this.download(datasource);\r\n                if (!success) {\r\n                    _this.toaster.pop({\r\n                        type: VizPortal.ToastType.Error,\r\n                        text: _this.$translate.instant('downloadDatasourceError', { NAME: VizPortal.L10n.elideIfLong(datasource.name) })\r\n                    });\r\n                }\r\n                return datasource;\r\n            })\r\n                .fail(function (result) {\r\n                _this.toaster.pop({\r\n                    type: VizPortal.ToastType.Error,\r\n                    text: _this.$translate.instant('downloadDatasourceError', { NAME: VizPortal.L10n.elideIfLong(datasource.name) })\r\n                });\r\n                return _this.$q.reject(result);\r\n            });\r\n        };\r\n        DownloadActions.prototype.downloadWorkbookRevision = function (revision) {\r\n            var success = this.download(revision);\r\n            if (!success) {\r\n                this.toaster.pop({ type: VizPortal.ToastType.Error, text: this.$translate.instant('downloadRevisionError') });\r\n            }\r\n        };\r\n        DownloadActions.$inject = [\r\n            '$translate',\r\n            '$q',\r\n            'ToasterService',\r\n            'WindowLocationService',\r\n            'Workbooks',\r\n            'DataSources'\r\n        ];\r\n        return DownloadActions;\r\n    })();\r\n    VizPortal.DownloadActions = DownloadActions;\r\n    VizPortal.Module.instance().service('DownloadActions', DownloadActions);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var EditSiteAction = (function () {\r\n        function EditSiteAction(ConfirmActionDialog, $translate, $timeout, $window, $q, toaster, server) {\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.$translate = $translate;\r\n            this.$timeout = $timeout;\r\n            this.$window = $window;\r\n            this.$q = $q;\r\n            this.toaster = toaster;\r\n            this.server = server;\r\n        }\r\n        EditSiteAction.prototype.execute = function (site, actionContext) {\r\n            var _this = this;\r\n            var dialogScope = actionContext.scope.$new();\r\n            // TODO: pass these scope properties down explicitly in directive\r\n            // instead of using implicit scope inheritance\r\n            dialogScope.siteSettingsForServerAdminFormState = {};\r\n            dialogScope.siteSettingsForSiteAdminFormState = {};\r\n            dialogScope.siteSettingsForServerAdmin = angular.copy(site);\r\n            dialogScope.siteSettingsForSiteAdmin = {\r\n                id: site.id,\r\n                siteAdminSettings: angular.copy(site.siteAdminSettings)\r\n            };\r\n            dialogScope.isDefaultSite = site.settings.urlName === '';\r\n            dialogScope.liveDBAvailable = this.server.isLiveDBAvailable();\r\n            return this.ConfirmActionDialog.open({\r\n                scope: dialogScope,\r\n                title: this.$translate.instant('editSiteSettings'),\r\n                bodyTemplateUrl: 'siteDialog.html',\r\n                actionName: this.$translate.instant('save'),\r\n                confirmDisabled: function () { return _.isEmpty(dialogScope.siteSettingsForServerAdminFormState) || (dialogScope.siteSettingsForServerAdminFormState.isFormUnchanged() && dialogScope.siteSettingsForSiteAdminFormState.isFormUnchanged()) || !dialogScope.siteSettingsForServerAdminFormState.isValid(); },\r\n                action: function () {\r\n                    return _this.$q.all([\r\n                        dialogScope.siteSettingsForServerAdminFormState.save(),\r\n                        dialogScope.siteSettingsForSiteAdminFormState.save()])\r\n                        .then(function () { return _this.$timeout(function () {\r\n                        _this.toaster.pop({\r\n                            type: VizPortal.ToastType.Info,\r\n                            text: _this.$translate.instant('settingsUpdateSuccess')\r\n                        });\r\n                        _.extend(site, dialogScope.siteSettingsForServerAdmin);\r\n                        _.extend(site.siteAdminSettings, dialogScope.siteSettingsForSiteAdmin.siteAdminSettings);\r\n                    }, VizPortal.ErrorNotifyingServer.ResponseDelay); });\r\n                },\r\n                size: VizPortal.ModalSize.fitToContent\r\n            }).result.fin(function () { return dialogScope.$destroy(); });\r\n        };\r\n        EditSiteAction.$inject = [\r\n            'ConfirmActionDialog',\r\n            '$translate',\r\n            '$timeout',\r\n            '$window',\r\n            '$q',\r\n            'ToasterService',\r\n            'ServerService'\r\n        ];\r\n        return EditSiteAction;\r\n    })();\r\n    VizPortal.EditSiteAction = EditSiteAction;\r\n    VizPortal.Module.instance().service('EditSiteAction', EditSiteAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var MultipleItemResult = (function () {\r\n        function MultipleItemResult(items, serverResult) {\r\n            this.items = items;\r\n            this.serverResult = serverResult;\r\n            this.errorCount = serverResult.errors ? serverResult.errors.length : 0;\r\n            this.successCount = items.size() - this.errorCount;\r\n        }\r\n        MultipleItemResult.prototype.anySucceeded = function () {\r\n            return this.successCount > 0;\r\n        };\r\n        MultipleItemResult.prototype.anyFailed = function () {\r\n            return this.errorCount > 0;\r\n        };\r\n        MultipleItemResult.prototype.errorItems = function () {\r\n            var _this = this;\r\n            return _.map(this.serverResult.errors, function (error) {\r\n                return {\r\n                    error: error,\r\n                    item: _this.items.get(error.id)\r\n                };\r\n            });\r\n        };\r\n        MultipleItemResult.prototype.firstSuccessfulItem = function () {\r\n            var _this = this;\r\n            if (this.successCount === 0) {\r\n                return null;\r\n            }\r\n            return _.once(function () {\r\n                var errorIds = _.map(_this.serverResult.errors, function (error) { return error.id; });\r\n                var successIds = _.difference(_this.items.keys(), errorIds);\r\n                return _this.items.get(successIds[0]);\r\n            })();\r\n        };\r\n        return MultipleItemResult;\r\n    })();\r\n    VizPortal.MultipleItemResult = MultipleItemResult;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/ResultHelper.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../models/MultipleItemResult.ts\" />\r\n/// <reference path=\"../models/Set.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ActionHelpers = (function () {\r\n        function ActionHelpers($translate, ContentActionNotification) {\r\n            this.$translate = $translate;\r\n            this.ContentActionNotification = ContentActionNotification;\r\n        }\r\n        ActionHelpers.prototype.standardErrorDetails = function (result, urlFn, errorMessageFn, itemNameFn) {\r\n            if (itemNameFn === void 0) { itemNameFn = ActionHelpers.DefaultItemNameFn; }\r\n            // Default item name function just uses 'item.name'\r\n            itemNameFn = itemNameFn || (function (item) { return item.name; });\r\n            return _.map(result.errorItems(), function (errorItem) {\r\n                return {\r\n                    itemName: itemNameFn(errorItem.item),\r\n                    itemUrl: urlFn(errorItem.item),\r\n                    errorMessage: errorMessageFn(errorItem)\r\n                };\r\n            });\r\n        };\r\n        ActionHelpers.prototype.standardErrorNotification = function (result, translations, describeErrorDetail, itemNameFn) {\r\n            var _this = this;\r\n            if (itemNameFn === void 0) { itemNameFn = ActionHelpers.DefaultItemNameFn; }\r\n            var firstErrorItem = result.anyFailed() ? result.errorItems()[0] : undefined;\r\n            var firstErrorItemName = firstErrorItem && firstErrorItem.item ? itemNameFn(firstErrorItem.item) : \"\";\r\n            return VizPortal.MultipleResultNotificationOptions.create(result, {\r\n                describeSuccessSummary: function (successCount) {\r\n                    return _this.$translate.instant(translations.successId, {\r\n                        ITEM_COUNT: successCount,\r\n                        ITEM_NAME: VizPortal.L10n.elideIfLong(itemNameFn(result.firstSuccessfulItem()))\r\n                    }, VizPortal.L10n.Interpolations.Count);\r\n                },\r\n                describeErrorSummary: function (errorCount) {\r\n                    return _this.$translate.instant(translations.errorId, {\r\n                        ERROR_COUNT: errorCount,\r\n                        ITEM_NAME: VizPortal.L10n.elideIfLong(firstErrorItemName)\r\n                    }, VizPortal.L10n.Interpolations.Count);\r\n                },\r\n                describeErrorDetail: describeErrorDetail\r\n            });\r\n        };\r\n        ActionHelpers.prototype.notifyStandardError = function (items, translations, describeErrorDetail) {\r\n            var _this = this;\r\n            return function (result) {\r\n                var itemResult = new VizPortal.MultipleItemResult(items, result);\r\n                var errorNotificationOptions = _this.standardErrorNotification(itemResult, translations, describeErrorDetail);\r\n                _this.ContentActionNotification.notify(errorNotificationOptions);\r\n                return result; // to allow promise chaining\r\n            };\r\n        };\r\n        // static\r\n        // Remove any items that resulted in a NotFound error code.\r\n        ActionHelpers.deselectNotFound = function (selectedItems, result, notFoundCode) {\r\n            selectedItems.removeItemsIn(VizPortal.ResultHelper.getErrorIdsWithCode(result, notFoundCode));\r\n        };\r\n        // Remove all items from the selection except those that resulted in an error code other than NotFound.\r\n        ActionHelpers.deselectAllExceptErrors = function (selectedItems, result, notFoundCode) {\r\n            selectedItems.removeItemsNotIn(VizPortal.ResultHelper.getErrorIds(result, { excludeCode: notFoundCode }));\r\n        };\r\n        ActionHelpers.$inject = ['$translate', 'ContentActionNotification'];\r\n        ActionHelpers.DefaultItemNameFn = function (item) { return item.name; };\r\n        return ActionHelpers;\r\n    })();\r\n    VizPortal.ActionHelpers = ActionHelpers;\r\n    VizPortal.Module.instance().service('ActionHelpers', ActionHelpers);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\n/// <reference path=\"ActionHelpers.ts\" />\r\n/// <reference path=\"ContentActionNotification.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var MoveToProjectAction = (function () {\r\n        function MoveToProjectAction(ConfirmActionDialog, $translate, ContentActionNotification, suggestions, Workbooks, WorkbookErrors, DataSources, DataSourceErrors, ModalService) {\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.$translate = $translate;\r\n            this.ContentActionNotification = ContentActionNotification;\r\n            this.suggestions = suggestions;\r\n            this.Workbooks = Workbooks;\r\n            this.WorkbookErrors = WorkbookErrors;\r\n            this.DataSources = DataSources;\r\n            this.DataSourceErrors = DataSourceErrors;\r\n            this.ModalService = ModalService;\r\n        }\r\n        MoveToProjectAction.prototype.moveWorkbooks = function (workbooks, actionContext) {\r\n            var _this = this;\r\n            return this.move({\r\n                promptId: 'selectProjectForWorkbooks',\r\n                successId: 'moveWorkbooksToProjectSuccess',\r\n                errorId: 'moveWorkbooksToProjectError'\r\n            }, workbooks, VizPortal.WorkbookContentType, function (projectId) { return _this.Workbooks.moveToProject(projectId, workbooks.keys()); }, actionContext);\r\n        };\r\n        MoveToProjectAction.prototype.moveDatasources = function (datasources, actionContext) {\r\n            var _this = this;\r\n            // Disallow move if all selected datasources are embedded.\r\n            if (datasources.all(function (ds) { return _.isObject(ds.workbook); })) {\r\n                return this.ModalService.alert({\r\n                    titleId: 'moveDatasourcesToProject_cannotMoveAlertTitle',\r\n                    messageId: 'moveDatasourcesToProject_cannotMoveAlertMessage'\r\n                }).result;\r\n            }\r\n            return this.move({\r\n                promptId: 'selectProjectForDatasources',\r\n                successId: 'moveDatasourcesToProjectSuccess',\r\n                errorId: 'moveDatasourcesToProjectError'\r\n            }, datasources, VizPortal.DatasourceContentType, function (projectId) { return _this.DataSources.moveToProject(projectId, datasources.keys()); }, actionContext);\r\n        };\r\n        MoveToProjectAction.prototype.move = function (translations, items, itemType, moveFn, actionContext) {\r\n            var _this = this;\r\n            var projectPicker = {\r\n                prompt: this.$translate.instant(translations.promptId, {\r\n                    ITEM_COUNT: items.size(),\r\n                    ITEM_NAME: VizPortal.L10n.elideIfLong(items.first().name)\r\n                }, VizPortal.L10n.Interpolations.Count),\r\n                projectsQuery: function (query) { return _this.suggestions.projects(query); },\r\n                targetProject: null\r\n            };\r\n            var newDialogScope = actionContext.scope.$new();\r\n            newDialogScope.projectPicker = projectPicker;\r\n            var dialogInstance = this.ConfirmActionDialog.open({\r\n                scope: newDialogScope,\r\n                title: this.$translate.instant('moveToProject'),\r\n                bodyTemplateUrl: \"moveToProjectDialog.html\",\r\n                actionName: this.$translate.instant('confirmMoveToProject', {\r\n                    ITEM_COUNT: items.size()\r\n                }, VizPortal.L10n.Interpolations.Count),\r\n                action: function () { return moveFn(projectPicker.targetProject.id); },\r\n                confirmDisabled: function () { return !projectPicker.targetProject; }\r\n            });\r\n            dialogInstance.result.then(function (result) {\r\n                _this.ContentActionNotification.notify(_this.notification(new VizPortal.MultipleItemResult(items, result), translations, itemType, projectPicker.targetProject.name));\r\n            });\r\n            return dialogInstance.result.fin(function () { return newDialogScope.$destroy(); });\r\n        };\r\n        MoveToProjectAction.prototype.notification = function (result, translations, itemType, projectName) {\r\n            var _this = this;\r\n            return VizPortal.MultipleResultNotificationOptions.create(result, {\r\n                describeSuccessSummary: function (successCount) {\r\n                    return _this.$translate.instant(translations.successId, {\r\n                        ITEM_COUNT: successCount,\r\n                        PROJECT_NAME: VizPortal.L10n.elideIfLong(projectName)\r\n                    }, VizPortal.L10n.Interpolations.Count);\r\n                },\r\n                describeErrorSummary: function (errorCount) {\r\n                    return _this.$translate.instant(translations.errorId, {\r\n                        ERROR_COUNT: errorCount,\r\n                        PROJECT_NAME: VizPortal.L10n.elideIfLong(projectName)\r\n                    }, VizPortal.L10n.Interpolations.Count);\r\n                },\r\n                describeErrorDetail: function (errorItem) {\r\n                    if (itemType === VizPortal.DatasourceContentType) {\r\n                        return _this.DataSourceErrors.errorDetailsFor(errorItem);\r\n                    }\r\n                    else {\r\n                        return _this.WorkbookErrors.errorDetailsFor(errorItem);\r\n                    }\r\n                }\r\n            });\r\n        };\r\n        MoveToProjectAction.$inject = [\r\n            'ConfirmActionDialog',\r\n            '$translate',\r\n            'ContentActionNotification',\r\n            'SearchSuggestionsService',\r\n            'Workbooks',\r\n            'WorkbookErrors',\r\n            'DataSources',\r\n            'DataSourceErrors',\r\n            'ModalService'\r\n        ];\r\n        return MoveToProjectAction;\r\n    })();\r\n    VizPortal.MoveToProjectAction = MoveToProjectAction;\r\n    VizPortal.Module.instance().service('MoveToProjectAction', MoveToProjectAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\n/// <reference path=\"ContentActionNotification.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var RenameProjectAction = (function () {\r\n        function RenameProjectAction(ConfirmActionDialog, $translate, toaster, Projects) {\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.$translate = $translate;\r\n            this.toaster = toaster;\r\n            this.Projects = Projects;\r\n        }\r\n        RenameProjectAction.prototype.execute = function (project, actionContext) {\r\n            var _this = this;\r\n            var scope = actionContext.scope.$new();\r\n            scope.description = this.$translate.instant('confirmRenameProject', {\r\n                PROJECT_NAME: VizPortal.L10n.elideIfLong(project.name)\r\n            });\r\n            scope.input = {\r\n                text: project.name,\r\n                maxLength: 255\r\n            };\r\n            return this.ConfirmActionDialog.open({\r\n                title: this.$translate.instant('rename'),\r\n                bodyTemplateUrl: 'confirmActionDialogInput.html',\r\n                scope: scope,\r\n                actionName: this.$translate.instant('rename'),\r\n                action: function (dialogInstance) {\r\n                    return _this.Projects.rename(project.id, scope.input.text).then(function (result) {\r\n                        if (result.errors && result.errors.length) {\r\n                            dialogInstance.showErrorMessage(_this.getErrorMessage(result.errors[0], project));\r\n                        }\r\n                        else {\r\n                            _this.toaster.pop({\r\n                                type: VizPortal.ToastType.Info,\r\n                                text: _this.$translate.instant('projectRenamed', {\r\n                                    PROJECT_NAME: VizPortal.L10n.elideIfLong(scope.input.text)\r\n                                })\r\n                            });\r\n                            project.name = scope.input.text;\r\n                        }\r\n                        return result;\r\n                    });\r\n                }\r\n            }).result.fin(function () { return scope.$destroy(); });\r\n        };\r\n        RenameProjectAction.prototype.executeInPlace = function (project, newName) {\r\n            var _this = this;\r\n            return this.Projects.rename(project.id, newName).then(function (result) {\r\n                if (result.errors && result.errors.length) {\r\n                    _this.toaster.pop({ type: VizPortal.ToastType.Error, text: _this.getErrorMessage(result.errors[0], project) });\r\n                }\r\n                else {\r\n                    project.name = newName;\r\n                }\r\n                return result;\r\n            });\r\n        };\r\n        RenameProjectAction.prototype.getErrorMessage = function (error, project) {\r\n            switch (error.code) {\r\n                case VizPortal.ProjectErrorCode.ProjectNameAlreadyExists:\r\n                    return this.$translate.instant('errorProjectNameAlreadyExists');\r\n                default:\r\n                    return this.$translate.instant('projectRenameError', {\r\n                        PROJECT_NAME: VizPortal.L10n.elideIfLong(project.name)\r\n                    });\r\n            }\r\n        };\r\n        RenameProjectAction.$inject = ['ConfirmActionDialog', '$translate', 'ToasterService', 'Projects'];\r\n        return RenameProjectAction;\r\n    })();\r\n    VizPortal.RenameProjectAction = RenameProjectAction;\r\n    VizPortal.Module.instance().service('RenameProjectAction', RenameProjectAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var WorkbookErrors = (function () {\r\n        function WorkbookErrors($state, $translate) {\r\n            this.$state = $state;\r\n            this.$translate = $translate;\r\n        }\r\n        WorkbookErrors.prototype.errorDetailsFor = function (workbookErrorItem) {\r\n            return {\r\n                itemName: workbookErrorItem.item.name,\r\n                itemUrl: workbookErrorItem.error.code === VizPortal.CommonErrorCode.WorkbookNotFound\r\n                    ? null\r\n                    : this.workbookUrl(workbookErrorItem.item),\r\n                errorMessage: this.errorMessageFor(workbookErrorItem)\r\n            };\r\n        };\r\n        WorkbookErrors.prototype.workbookUrl = function (workbook) {\r\n            return this.$state.href('main.site.content.workbook.details', { id: workbook.id });\r\n        };\r\n        WorkbookErrors.prototype.errorMessageFor = function (errorItem) {\r\n            var workbook = errorItem.item;\r\n            switch (errorItem.error.code) {\r\n                case VizPortal.WorkbookErrorCode.WorkbookDescriptionTooLong:\r\n                    return this.$translate.instant('errorWorkbookDescriptionTooLong');\r\n                case VizPortal.CommonErrorCode.WorkbookNotFound:\r\n                    return this.$translate.instant('errorWorkbookNotFound', { WORKBOOK_NAME: VizPortal.L10n.elideIfLong(workbook.name) });\r\n                case VizPortal.WorkbookErrorCode.WorkbookDisabled:\r\n                    return this.$translate.instant('errorWorkbookDisabled', { WORKBOOK_NAME: VizPortal.L10n.elideIfLong(workbook.name) });\r\n                case VizPortal.WorkbookErrorCode.WorkbookNameAlreadyExistsInDestinationProject:\r\n                    return this.$translate.instant('errorWorkbookNameAlreadyExistsInDestinationProject');\r\n                case VizPortal.WorkbookErrorCode.WorkbookDestinationProjectNotFound:\r\n                    return this.$translate.instant('errorWorkbookDestinationProjectNotFound');\r\n                // Permissions errors\r\n                // TODO: Do we want specific error messages for each of these cases?\r\n                case VizPortal.WorkbookErrorCode.WorkbookMoveInsufficientPermissionsOnDestinationProject:\r\n                case VizPortal.WorkbookErrorCode.WorkbookMoveInsufficientPermissionsOnSourceProject:\r\n                case VizPortal.WorkbookErrorCode.WorkbookMoveInsufficientPermissionsOnWorkbook:\r\n                    return this.$translate.instant('errorWorkbookMoveInsufficientPermissions');\r\n                case VizPortal.CommonErrorCode.CallingUserInsufficientPermissions:\r\n                    return this.$translate.instant('errorWorkbookInsufficientPermissions');\r\n                default:\r\n                    return this.$translate.instant('errorUnknown');\r\n            }\r\n        };\r\n        WorkbookErrors.$inject = ['$state', '$translate'];\r\n        return WorkbookErrors;\r\n    })();\r\n    VizPortal.WorkbookErrors = WorkbookErrors;\r\n    VizPortal.Module.instance().service('WorkbookErrors', WorkbookErrors);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/WorkbookErrors.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SetDisplayTabsAction = (function () {\r\n        function SetDisplayTabsAction(ConfirmActionDialog, $translate, Workbooks, WorkbookErrors, ActionHelpers) {\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.$translate = $translate;\r\n            this.Workbooks = Workbooks;\r\n            this.WorkbookErrors = WorkbookErrors;\r\n            this.ActionHelpers = ActionHelpers;\r\n        }\r\n        SetDisplayTabsAction.prototype.setDisplayTabs = function (workbook, displayTabs) {\r\n            return this.setDisplayTabsAction(VizPortal.Set.singleton(workbook, function (wb) { return wb.id; }), displayTabs)();\r\n        };\r\n        SetDisplayTabsAction.prototype.confirmSetDisplayTabs = function (workbooks, context) {\r\n            var workbookArray = workbooks.toArray();\r\n            var anyTabsEnabled = _.any(workbookArray, function (wb) { return wb.displayTabs; });\r\n            var anyTabsDisabled = _.any(workbookArray, function (wb) { return !wb.displayTabs; });\r\n            return this.ConfirmActionDialog.open({\r\n                scope: context.scope,\r\n                title: this.$translate.instant('confirmSetDisplayTabsTitle'),\r\n                bodyText: this.$translate.instant('confirmSetDisplayTabsPrompt', {\r\n                    ITEM_COUNT: workbooks.size(),\r\n                    ITEM_NAME: VizPortal.L10n.elideIfLong(workbooks.first().name)\r\n                }, VizPortal.L10n.Interpolations.Count),\r\n                buttons: [\r\n                    {\r\n                        label: this.$translate.instant('confirmSetDisplayTabsShowButton'),\r\n                        testId: 'confirm-show-tabs',\r\n                        action: this.setDisplayTabsAction(workbooks, true),\r\n                        disabled: function () { return !anyTabsDisabled; }\r\n                    },\r\n                    {\r\n                        label: this.$translate.instant('confirmSetDisplayTabsHideButton'),\r\n                        testId: 'confirm-hide-tabs',\r\n                        action: this.setDisplayTabsAction(workbooks, false),\r\n                        disabled: function () { return !anyTabsEnabled; }\r\n                    }\r\n                ],\r\n                size: '600px' // custom size to fix extra buttons\r\n            }).result;\r\n        };\r\n        SetDisplayTabsAction.prototype.setDisplayTabsAction = function (workbooks, displayTabs) {\r\n            var _this = this;\r\n            return function () { return _this.Workbooks.setDisplayTabs(workbooks.keys(), displayTabs)\r\n                .then(function (result) { return _this.notifyResult(displayTabs, workbooks, result); }); };\r\n        };\r\n        SetDisplayTabsAction.prototype.notifyResult = function (displayTabs, workbooks, result) {\r\n            var _this = this;\r\n            this.ActionHelpers.notifyStandardError(workbooks, {\r\n                successId: displayTabs ? 'setDisplayTabsShowSuccess' : 'setDisplayTabsHideSuccess',\r\n                errorId: displayTabs ? 'setDisplayTabsShowError' : 'setDisplayTabsHideError'\r\n            }, function (errorItem) { return _this.WorkbookErrors.errorDetailsFor(errorItem); })(result);\r\n        };\r\n        SetDisplayTabsAction.$inject = ['ConfirmActionDialog', '$translate', 'Workbooks', 'WorkbookErrors', 'ActionHelpers'];\r\n        return SetDisplayTabsAction;\r\n    })();\r\n    VizPortal.SetDisplayTabsAction = SetDisplayTabsAction;\r\n    VizPortal.Module.instance().service('SetDisplayTabsAction', SetDisplayTabsAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"ActivateSitesAction.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SuspendSitesAction = (function () {\r\n        function SuspendSitesAction(ConfirmActionDialog, $translate, toaster, Sites) {\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.$translate = $translate;\r\n            this.toaster = toaster;\r\n            this.Sites = Sites;\r\n        }\r\n        SuspendSitesAction.prototype.execute = function (sites, actionContext) {\r\n            var _this = this;\r\n            return this.ConfirmActionDialog.open({\r\n                title: this.$translate.instant('suspendSites'),\r\n                bodyText: this.$translate.instant('confirmSuspendSites', {\r\n                    SITE_NAME: VizPortal.L10n.elideIfLong(sites.first().settings.name),\r\n                    ITEM_COUNT: sites.size()\r\n                }, VizPortal.L10n.Interpolations.Count),\r\n                actionName: this.$translate.instant('suspendButtonConfirm', {\r\n                    ITEM_COUNT: sites.size()\r\n                }, VizPortal.L10n.Interpolations.Count),\r\n                isDeleteAction: true,\r\n                action: function (dialogInstance) {\r\n                    return _this.Sites.suspend(sites.keys()).then(function (result) {\r\n                        if (result.errors && result.errors.length) {\r\n                            if (result.errors.length === 1 && result.errors[0].code === VizPortal.SiteSettingsErrorCode.AttemptedToSuspendDefaultSite) {\r\n                                _this.toaster.pop({ type: VizPortal.ToastType.Error, text: _this.$translate.instant('siteSettingsFailedAttemptedToSuspendDefaultSite') });\r\n                                _this.toaster.pop({\r\n                                    type: VizPortal.ToastType.Info,\r\n                                    text: _this.$translate.instant('sitesSuspendSuccess', {\r\n                                        ITEM_COUNT: sites.size() - 1\r\n                                    }, VizPortal.L10n.Interpolations.Count)\r\n                                });\r\n                            }\r\n                            else {\r\n                                dialogInstance.showErrorMessage(_this.$translate.instant('sitesSuspendFailed'));\r\n                            }\r\n                        }\r\n                        else {\r\n                            _this.toaster.pop({\r\n                                type: VizPortal.ToastType.Info,\r\n                                text: _this.$translate.instant('sitesSuspendSuccess', {\r\n                                    ITEM_COUNT: sites.size()\r\n                                }, VizPortal.L10n.Interpolations.Count)\r\n                            });\r\n                        }\r\n                        return result;\r\n                    });\r\n                }\r\n            }).result;\r\n        };\r\n        SuspendSitesAction.$inject = ['ConfirmActionDialog', '$translate', 'ToasterService', 'Sites'];\r\n        return SuspendSitesAction;\r\n    })();\r\n    VizPortal.SuspendSitesAction = SuspendSitesAction;\r\n    VizPortal.Module.instance().service('SuspendSitesAction', SuspendSitesAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\n/// <reference path=\"ActivateSitesAction.ts\" />\r\n/// <reference path=\"CreateExtractTasksAction.ts\" />\r\n/// <reference path=\"ChangeDatasourceOwnerAction.ts\" />\r\n/// <reference path=\"ChangeDatasourcesTagsAction.ts\" />\r\n/// <reference path=\"ChangeProjectOwnerAction.ts\" />\r\n/// <reference path=\"ChangeViewTagsAction.ts\" />\r\n/// <reference path=\"ChangeWorkbookOwnerAction.ts\" />\r\n/// <reference path=\"ChangeWorkbooksTagsAction.ts\" />\r\n/// <reference path=\"CreateProjectAction.ts\" />\r\n/// <reference path=\"DeleteDatasourcesAction.ts\" />\r\n/// <reference path=\"DeleteProjectsAction.ts\" />\r\n/// <reference path=\"DeleteSitesAction.ts\" />\r\n/// <reference path=\"DeleteWorkbooksAction.ts\" />\r\n/// <reference path=\"DownloadActions.ts\" />\r\n/// <reference path=\"EditSiteAction.ts\" />\r\n/// <reference path=\"MoveToProjectAction.ts\" />\r\n/// <reference path=\"RenameProjectAction.ts\" />\r\n/// <reference path=\"SetDisplayTabsAction.ts\" />\r\n/// <reference path=\"SuspendSitesAction.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ContentActions = (function () {\r\n        function ContentActions(windowLocationService, contentActionNotification, ActionHelpers, Projects, Workbooks, DataSources, Views, ChangeDatasourceOwnerAction, ChangeProjectOwnerAction, ChangeWorkbookOwnerAction, MoveToProjectAction, DeleteDatasourcesAction, DeleteProjectsAction, DeleteWorkbooksAction, CreateProjectAction, RenameProjectAction, ChangeViewTagsAction, ChangeWorkbooksTagsAction, ChangeDatasourcesTagsAction, SuspendSitesAction, ActivateSitesAction, DeleteSitesAction, EditSiteAction, CreateExtractTasksAction, DownloadActions) {\r\n            this.windowLocationService = windowLocationService;\r\n            this.contentActionNotification = contentActionNotification;\r\n            this.ActionHelpers = ActionHelpers;\r\n            this.Projects = Projects;\r\n            this.Workbooks = Workbooks;\r\n            this.DataSources = DataSources;\r\n            this.Views = Views;\r\n            this.ChangeDatasourceOwnerAction = ChangeDatasourceOwnerAction;\r\n            this.ChangeProjectOwnerAction = ChangeProjectOwnerAction;\r\n            this.ChangeWorkbookOwnerAction = ChangeWorkbookOwnerAction;\r\n            this.MoveToProjectAction = MoveToProjectAction;\r\n            this.DeleteDatasourcesAction = DeleteDatasourcesAction;\r\n            this.DeleteProjectsAction = DeleteProjectsAction;\r\n            this.DeleteWorkbooksAction = DeleteWorkbooksAction;\r\n            this.CreateProjectAction = CreateProjectAction;\r\n            this.RenameProjectAction = RenameProjectAction;\r\n            this.ChangeViewTagsAction = ChangeViewTagsAction;\r\n            this.ChangeWorkbooksTagsAction = ChangeWorkbooksTagsAction;\r\n            this.ChangeDatasourcesTagsAction = ChangeDatasourcesTagsAction;\r\n            this.SuspendSitesAction = SuspendSitesAction;\r\n            this.ActivateSitesAction = ActivateSitesAction;\r\n            this.DeleteSitesAction = DeleteSitesAction;\r\n            this.EditSiteAction = EditSiteAction;\r\n            this.CreateExtractTasksAction = CreateExtractTasksAction;\r\n            this.DownloadActions = DownloadActions;\r\n        }\r\n        // Delete actions\r\n        ContentActions.prototype.deleteProject = function (projectDetail, actionContext) {\r\n            var _this = this;\r\n            return this.Projects.all()\r\n                .withFilters([VizPortal.Filter.fieldEq(\"id\", projectDetail.id)])\r\n                .getFirst()\r\n                .then(function (projectInfo) {\r\n                return _this.deleteProjects(_this.singleton(projectInfo), actionContext);\r\n            });\r\n        };\r\n        ContentActions.prototype.deleteProjects = function (projects, actionContext) {\r\n            return this.DeleteProjectsAction.confirmDeleteProjects(projects, actionContext);\r\n        };\r\n        ContentActions.prototype.deleteWorkbook = function (workbookDetail, actionContext) {\r\n            var _this = this;\r\n            return this.Workbooks.all()\r\n                .withFilters([VizPortal.Filter.fieldEq(\"id\", workbookDetail.id)])\r\n                .getFirst()\r\n                .then(function (workbookInfo) {\r\n                return _this.deleteWorkbooks(_this.singleton(workbookInfo), actionContext);\r\n            });\r\n        };\r\n        ContentActions.prototype.deleteWorkbooks = function (workbooks, actionContext) {\r\n            return this.DeleteWorkbooksAction.confirmDeleteWorkbooks(workbooks, actionContext);\r\n        };\r\n        // Move to Project\r\n        ContentActions.prototype.moveWorkbooksToProject = function (workbooks, actionContext) {\r\n            return this.MoveToProjectAction.moveWorkbooks(workbooks, actionContext);\r\n        };\r\n        ContentActions.prototype.moveDatasourcesToProject = function (datasources, actionContext) {\r\n            return this.MoveToProjectAction.moveDatasources(datasources, actionContext);\r\n        };\r\n        // Create project\r\n        // Returns the new project id\r\n        ContentActions.prototype.createProject = function (actionContext) {\r\n            return this.CreateProjectAction.execute(actionContext);\r\n        };\r\n        // Helpers\r\n        ContentActions.prototype.singleton = function (item) {\r\n            return VizPortal.Set.singleton(item, function (item) { return item.id; });\r\n        };\r\n        // Rename\r\n        ContentActions.prototype.renameProjectPopup = function (project, actionContext) {\r\n            return this.RenameProjectAction.execute(project, actionContext);\r\n        };\r\n        ContentActions.prototype.renameProject = function (project, newName) {\r\n            return this.RenameProjectAction.executeInPlace(project, newName);\r\n        };\r\n        // Download\r\n        ContentActions.prototype.downloadWorkbook = function (workbook) {\r\n            return this.DownloadActions.downloadWorkbook(workbook);\r\n        };\r\n        ContentActions.prototype.downloadDatasource = function (datasource) {\r\n            return this.DownloadActions.downloadDatasource(datasource);\r\n        };\r\n        // Change Owner\r\n        ContentActions.prototype.changeOwnerOnDatasources = function (datasources, actionContext) {\r\n            return this.ChangeDatasourceOwnerAction.confirmChangeOwner(datasources, actionContext);\r\n        };\r\n        ContentActions.prototype.changeOwnerOnProjects = function (projects, actionContext) {\r\n            return this.ChangeProjectOwnerAction.confirmChangeOwner(projects, actionContext);\r\n        };\r\n        ContentActions.prototype.changeOwnerOnWorkbooks = function (workbooks, actionContext) {\r\n            return this.ChangeWorkbookOwnerAction.confirmChangeOwner(workbooks, actionContext);\r\n        };\r\n        // Update Site Availability\r\n        ContentActions.prototype.suspendSite = function (sites, actionContext) {\r\n            return this.SuspendSitesAction.execute(sites, actionContext);\r\n        };\r\n        ContentActions.prototype.activateSite = function (sites, actionContext) {\r\n            return this.ActivateSitesAction.execute(sites, actionContext);\r\n        };\r\n        // Edit Site Settings\r\n        ContentActions.prototype.editSite = function (site, actionContext) {\r\n            return this.EditSiteAction.execute(site, actionContext);\r\n        };\r\n        // Delete Sites\r\n        ContentActions.prototype.deleteSites = function (sites, actionContext) {\r\n            return this.DeleteSitesAction.execute(sites, actionContext);\r\n        };\r\n        // Authoring\r\n        ContentActions.prototype.authoring = function (authoringUrl) {\r\n            this.windowLocationService.open(authoringUrl);\r\n        };\r\n        ContentActions.prototype.editWorkbook = function (workbook) {\r\n            this.authoring(workbook.editUrl);\r\n        };\r\n        ContentActions.prototype.editView = function (view) {\r\n            this.authoring(view.editUrl);\r\n        };\r\n        ContentActions.prototype.newWorkbook = function (datasource) {\r\n            this.authoring(datasource.newWorkbookUrl);\r\n        };\r\n        // Change Tags\r\n        ContentActions.prototype.handleSingleItemResponse = function (item, translations) {\r\n            var _this = this;\r\n            return function (result) {\r\n                var itemSet = VizPortal.Set.singleton(item, function (item) { return item.id; });\r\n                _this.contentActionNotification.notifyResult(itemSet, result.errors, translations);\r\n                return result; //For chaining\r\n            };\r\n        };\r\n        ContentActions.prototype.setTagsOnViews = function (views, actionContext) {\r\n            return this.ChangeViewTagsAction.execute(views, actionContext);\r\n        };\r\n        ContentActions.prototype.setTagsOnView = function (view, newTagsList) {\r\n            var _this = this;\r\n            var tagsToAdd = _.difference(newTagsList, view.tags);\r\n            var tagsToRemove = _.difference(view.tags, newTagsList);\r\n            return this.Views.changeTags([view.id], tagsToAdd, tagsToRemove)\r\n                .then(this.ActionHelpers.notifyStandardError(VizPortal.Set.fromIdItemArray([view]), VizPortal.ChangeViewTagsAction.notificationTranslationIds, function (errorItem) { return _this.ChangeViewTagsAction.changeTagsErrorDetail(errorItem); }));\r\n        };\r\n        ContentActions.prototype.setTagsOnWorkbook = function (workbook, newTagsList) {\r\n            var _this = this;\r\n            var tagsToAdd = _.difference(newTagsList, workbook.tags);\r\n            var tagsToRemove = _.difference(workbook.tags, newTagsList);\r\n            return this.Workbooks.changeTags([workbook.id], tagsToAdd, tagsToRemove)\r\n                .then(this.ActionHelpers.notifyStandardError(VizPortal.Set.fromIdItemArray([workbook]), VizPortal.ChangeWorkbooksTagsAction.notificationTranslationIds, function (errorItem) { return _this.ChangeWorkbooksTagsAction.changeTagsErrorDetail(errorItem); }));\r\n        };\r\n        ContentActions.prototype.setTagsOnWorkbooks = function (workbooks, actionContext) {\r\n            return this.ChangeWorkbooksTagsAction.execute(workbooks, actionContext);\r\n        };\r\n        ContentActions.prototype.setTagsOnDatasource = function (datasource, newTagsList) {\r\n            var _this = this;\r\n            var tagsToAdd = _.difference(newTagsList, datasource.tags);\r\n            var tagsToRemove = _.difference(datasource.tags, newTagsList);\r\n            return this.DataSources.changeTags([datasource.id], tagsToAdd, tagsToRemove)\r\n                .then(this.ActionHelpers.notifyStandardError(VizPortal.Set.fromIdItemArray([datasource]), VizPortal.ChangeDatasourcesTagsAction.notificationTranslationIds, function (errorItem) { return _this.ChangeDatasourcesTagsAction.changeTagsErrorDetail(errorItem); }));\r\n        };\r\n        ContentActions.prototype.setTagsOnDatasources = function (datasources, actionContext) {\r\n            return this.ChangeDatasourcesTagsAction.showChangeTagsDialog(datasources, actionContext);\r\n        };\r\n        ContentActions.$inject = [\r\n            'WindowLocationService',\r\n            'ContentActionNotification',\r\n            'ActionHelpers',\r\n            'Projects',\r\n            'Workbooks',\r\n            'DataSources',\r\n            'Views',\r\n            'ChangeDatasourceOwnerAction',\r\n            'ChangeProjectOwnerAction',\r\n            'ChangeWorkbookOwnerAction',\r\n            'MoveToProjectAction',\r\n            'DeleteDatasourcesAction',\r\n            'DeleteProjectsAction',\r\n            'DeleteWorkbooksAction',\r\n            'CreateProjectAction',\r\n            'RenameProjectAction',\r\n            'ChangeViewTagsAction',\r\n            'ChangeWorkbooksTagsAction',\r\n            'ChangeDatasourcesTagsAction',\r\n            'SuspendSitesAction',\r\n            'ActivateSitesAction',\r\n            'DeleteSitesAction',\r\n            'EditSiteAction',\r\n            'CreateExtractTasksAction',\r\n            'DownloadActions'\r\n        ];\r\n        return ContentActions;\r\n    })();\r\n    VizPortal.ContentActions = ContentActions;\r\n    VizPortal.Module.instance().service('ContentActions', ContentActions);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ChangeDatasourceDescriptionAction = (function () {\r\n        function ChangeDatasourceDescriptionAction($translate, toaster, DataSources) {\r\n            this.$translate = $translate;\r\n            this.toaster = toaster;\r\n            this.DataSources = DataSources;\r\n        }\r\n        ChangeDatasourceDescriptionAction.prototype.execute = function (datasource, newDescription) {\r\n            var _this = this;\r\n            return this.DataSources.setDescription(datasource.id, newDescription).then(function (result) {\r\n                if (result.errors && result.errors.length) {\r\n                    _this.toaster.pop({ type: VizPortal.ToastType.Error, text: _this.errorMessageFor(result.errors[0], datasource) });\r\n                }\r\n                return result;\r\n            });\r\n        };\r\n        ChangeDatasourceDescriptionAction.prototype.errorMessageFor = function (error, datasource) {\r\n            switch (error.code) {\r\n                case VizPortal.DatasourceErrorCode.DatasourceDescriptionGreaterThanMaxLength:\r\n                    return this.$translate.instant('errorDatasourceDescriptionTooLong');\r\n                case VizPortal.CommonErrorCode.DatasourceNotFound:\r\n                    return this.$translate.instant('errorDatasourceNotFound', { DATASOURCE_NAME: VizPortal.L10n.elideIfLong(datasource.name) });\r\n                default:\r\n                    return this.$translate.instant('errorUnknown');\r\n            }\r\n        };\r\n        ChangeDatasourceDescriptionAction.$inject = ['$translate', 'ToasterService', 'DataSources'];\r\n        return ChangeDatasourceDescriptionAction;\r\n    })();\r\n    VizPortal.ChangeDatasourceDescriptionAction = ChangeDatasourceDescriptionAction;\r\n    VizPortal.Module.instance().service('ChangeDatasourceDescriptionAction', ChangeDatasourceDescriptionAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ChangeProjectDescriptionAction = (function () {\r\n        function ChangeProjectDescriptionAction($translate, toaster, Projects) {\r\n            this.$translate = $translate;\r\n            this.toaster = toaster;\r\n            this.Projects = Projects;\r\n        }\r\n        ChangeProjectDescriptionAction.prototype.execute = function (project, newDescription) {\r\n            var _this = this;\r\n            return this.Projects.setDescription(project.id, newDescription).then(function (result) {\r\n                if (result.errors && result.errors.length) {\r\n                    _this.toaster.pop({ type: VizPortal.ToastType.Error, text: _this.errorMessageFor(result.errors[0], project) });\r\n                }\r\n                return result;\r\n            });\r\n        };\r\n        ChangeProjectDescriptionAction.prototype.errorMessageFor = function (error, project) {\r\n            switch (error.code) {\r\n                case VizPortal.ProjectErrorCode.ProjectDescriptionGreaterThanMaxLength:\r\n                    return this.$translate.instant('errorProjectDescriptionTooLong');\r\n                case VizPortal.CommonErrorCode.ProjectNotFound:\r\n                    return this.$translate.instant('errorProjectNotFound', { PROJECT_NAME: VizPortal.L10n.elideIfLong(project.name) });\r\n                default:\r\n                    return this.$translate.instant('errorUnknown');\r\n            }\r\n        };\r\n        ChangeProjectDescriptionAction.$inject = ['$translate', 'ToasterService', 'Projects'];\r\n        return ChangeProjectDescriptionAction;\r\n    })();\r\n    VizPortal.ChangeProjectDescriptionAction = ChangeProjectDescriptionAction;\r\n    VizPortal.Module.instance().service('ChangeProjectDescriptionAction', ChangeProjectDescriptionAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ChangeWorkbookDescriptionAction = (function () {\r\n        function ChangeWorkbookDescriptionAction($translate, toaster, Workbooks, WorkbookErrors) {\r\n            this.$translate = $translate;\r\n            this.toaster = toaster;\r\n            this.Workbooks = Workbooks;\r\n            this.WorkbookErrors = WorkbookErrors;\r\n        }\r\n        ChangeWorkbookDescriptionAction.prototype.execute = function (workbook, newDescription) {\r\n            var _this = this;\r\n            return this.Workbooks.setDescription(workbook.id, newDescription).then(function (result) {\r\n                if (result.errors && result.errors.length) {\r\n                    _this.toaster.pop({\r\n                        type: VizPortal.ToastType.Error,\r\n                        text: _this.WorkbookErrors.errorMessageFor({ item: workbook, error: result.errors[0] })\r\n                    });\r\n                }\r\n                return result;\r\n            });\r\n        };\r\n        ChangeWorkbookDescriptionAction.$inject = ['$translate', 'ToasterService', 'Workbooks', 'WorkbookErrors'];\r\n        return ChangeWorkbookDescriptionAction;\r\n    })();\r\n    VizPortal.ChangeWorkbookDescriptionAction = ChangeWorkbookDescriptionAction;\r\n    VizPortal.Module.instance().service('ChangeWorkbookDescriptionAction', ChangeWorkbookDescriptionAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/ResultHelper.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var RevisionHistoryAction = (function () {\r\n        function RevisionHistoryAction($translate, $q, $rootScope, ConfirmActionDialog, toaster, Workbooks) {\r\n            this.$translate = $translate;\r\n            this.$q = $q;\r\n            this.$rootScope = $rootScope;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.toaster = toaster;\r\n            this.Workbooks = Workbooks;\r\n        }\r\n        RevisionHistoryAction.prototype.showRevisionHistory = function (workbook) {\r\n            var _this = this;\r\n            var scope = this.$rootScope.$new(true);\r\n            scope.workbookId = workbook.id;\r\n            scope.selectedItems = new VizPortal.Set(function (revision) { return revision.id; });\r\n            scope.prompt = this.$translate.instant('revisionHistoryDialogDescription', {\r\n                NAME: VizPortal.L10n.elideIfLong(workbook.name)\r\n            });\r\n            var revisionHistoryAction = function () {\r\n                return _this.Workbooks.revertWorkbook(scope.workbookId, scope.selectedItems.first().versionNumber)\r\n                    .then(function (result) {\r\n                    if (VizPortal.ResultHelper.hasErrors(result)) {\r\n                        _this.toaster.pop({ type: VizPortal.ToastType.Error, text: _this.$translate.instant('revisionHistoryActionError') });\r\n                    }\r\n                    else {\r\n                        _this.toaster.pop({ type: VizPortal.ToastType.Info, text: _this.$translate.instant('revisionHistoryActionSuccess') });\r\n                    }\r\n                });\r\n            };\r\n            var dialogInstance = this.ConfirmActionDialog.open({\r\n                scope: scope,\r\n                title: this.$translate.instant('revisionHistoryDialogTitle'),\r\n                bodyTemplateUrl: 'revisionHistoryDialog.html',\r\n                actionName: this.$translate.instant('revisionHistoryDialogSubmit'),\r\n                action: revisionHistoryAction,\r\n                confirmDisabled: function () {\r\n                    return scope.selectedItems && scope.selectedItems.size() != 1;\r\n                },\r\n                size: '600px'\r\n            });\r\n            return dialogInstance.result.fin(function () { return scope.$destroy(); });\r\n        };\r\n        RevisionHistoryAction.$inject = [\r\n            '$translate',\r\n            '$q',\r\n            '$rootScope',\r\n            'ConfirmActionDialog',\r\n            'ToasterService',\r\n            'Workbooks'];\r\n        return RevisionHistoryAction;\r\n    })();\r\n    VizPortal.RevisionHistoryAction = RevisionHistoryAction;\r\n    VizPortal.Module.instance().service('RevisionHistoryAction', RevisionHistoryAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../config.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../models/Content.ts\" />\r\n/// <reference path=\"../models/IPlace.ts\" />\r\n/// <reference path=\"../models/IProjectInfo.ts\" />\r\n/// <reference path=\"../ServerApi/types/IFilterClause.ts\" />\r\n/// <reference path=\"../ServerApi/types/IResponse.ts\" />\r\n/// <reference path=\"../services/BreadcrumbsService.ts\" />\r\n/// <reference path=\"../services/BrowserTitleService.ts\" />\r\n/// <reference path=\"../services/ContentActions.ts\" />\r\n/// <reference path=\"../services/ChangeDatasourceDescriptionAction.ts\" />\r\n/// <reference path=\"../services/ChangeProjectDescriptionAction.ts\" />\r\n/// <reference path=\"../services/ChangeWorkbookDescriptionAction.ts\" />\r\n/// <reference path=\"../services/DownloadActions.ts\" />\r\n/// <reference path=\"../services/ModalService.ts\" />\r\n/// <reference path=\"../services/RevisionHistoryAction.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SitePlaceCtrl = (function () {\r\n        function SitePlaceCtrl($location, $scope, $state, breadcrumbs, contentActions, place, server) {\r\n            $scope.place = 'site';\r\n            VizPortal.SubplaceCountsHelper.keepSubplaceCountsUpdated($scope, place);\r\n            VizPortal.SubplaceTabsHelper.refreshWhenCurrentTabClicked($scope, $state);\r\n            breadcrumbs.rememberSiteUrl($location.url());\r\n            $scope.$on('$locationChangeSuccess', function () {\r\n                var path = $location.path();\r\n                if (/^(\\/site\\/[^\\/]+)?\\/(projects|workbooks|views|datasources)(\\/)?$/.test(path)) {\r\n                    breadcrumbs.rememberSiteUrl($location.url());\r\n                }\r\n            });\r\n        }\r\n        SitePlaceCtrl.$inject = [\r\n            '$location',\r\n            '$scope',\r\n            '$state',\r\n            'BreadcrumbsService',\r\n            'ContentActions',\r\n            'place',\r\n            'ServerService'\r\n        ];\r\n        return SitePlaceCtrl;\r\n    })();\r\n    VizPortal.SitePlaceCtrl = SitePlaceCtrl;\r\n    var ProjectPlaceCtrl = (function () {\r\n        function ProjectPlaceCtrl($location, $q, $scope, $state, breadcrumbs, BrowserTitleService, ContentActions, ChangeProjectDescriptionAction, place, project, projectActions) {\r\n            var _this = this;\r\n            this.$q = $q;\r\n            $scope.place = VizPortal.ContentTypes.project;\r\n            $scope.objectName = project.name;\r\n            $scope.project = project;\r\n            $scope.projectSet = VizPortal.Set.singleton(project, function (project) { return project.id; });\r\n            VizPortal.SubplaceCountsHelper.keepSubplaceCountsUpdated($scope, place);\r\n            VizPortal.SubplaceTabsHelper.refreshWhenCurrentTabClicked($scope, $state);\r\n            $scope.allowedAction = function (actionName) { return (!!projectActions && projectActions[actionName]); };\r\n            $scope.del = function ($event) {\r\n                ContentActions.deleteProject(project, VizPortal.ActionContext.fromEvent($event))\r\n                    .then(function () { return $state.go('main.site.content.site.projects'); });\r\n            };\r\n            $scope.changeDescription = function (newDescription) {\r\n                return ChangeProjectDescriptionAction.execute(project, newDescription).then(VizPortal.ResultHelper.rejectResultOnError(_this.$q));\r\n            };\r\n            $scope.changeOwner = function ($event) {\r\n                return ContentActions.changeOwnerOnProjects($scope.projectSet, VizPortal.ActionContext.fromEvent($event))\r\n                    .then(function () { return $state.hardReload(); });\r\n            };\r\n            $scope.rename = function ($event) {\r\n                return ContentActions.renameProjectPopup(project, VizPortal.ActionContext.fromEvent($event))\r\n                    .then(function () { return $state.hardReload(); });\r\n            };\r\n            $scope.contentBreadcrumbUrl = function () { return breadcrumbs.siteUrl\r\n                ? '#' + breadcrumbs.siteUrl\r\n                : $state.href('main.site.content.site.projects'); };\r\n            breadcrumbs.rememberProjectUrl(project, $location.url());\r\n            $scope.$on('$locationChangeSuccess', function () {\r\n                var path = $location.path();\r\n                if (/^(\\/site\\/[^\\/]+)?\\/projects\\/[^\\/]+\\/(workbooks|views|datasources|permissions|details)(\\/)?$/.test(path)) {\r\n                    breadcrumbs.rememberProjectUrl(project, $location.url());\r\n                }\r\n            });\r\n        }\r\n        ProjectPlaceCtrl.$inject = [\r\n            '$location',\r\n            '$q',\r\n            '$scope',\r\n            '$state',\r\n            'BreadcrumbsService',\r\n            'BrowserTitleService',\r\n            'ContentActions',\r\n            'ChangeProjectDescriptionAction',\r\n            'place',\r\n            'project',\r\n            'projectActions'\r\n        ];\r\n        return ProjectPlaceCtrl;\r\n    })();\r\n    VizPortal.ProjectPlaceCtrl = ProjectPlaceCtrl;\r\n    VizPortal.Module.instance().controller('ProjectPlaceCtrl', ProjectPlaceCtrl);\r\n    var WorkbookPlaceCtrl = (function () {\r\n        function WorkbookPlaceCtrl($location, $q, $scope, $state, $translate, breadcrumbs, ContentActions, ChangeWorkbookDescriptionAction, SetDisplayTabsAction, DownloadActions, CreateExtractTasksAction, Favorites, place, workbook, workbookActions, Workbooks, RevisionHistoryAction) {\r\n            var _this = this;\r\n            this.$q = $q;\r\n            $scope.place = VizPortal.ContentTypes.workbook;\r\n            var setWorkbook = function (newWorkbook) {\r\n                workbook = newWorkbook;\r\n                $scope.objectName = workbook.name;\r\n                $scope.workbook = workbook;\r\n                $scope.workbookSet = VizPortal.Set.singleton(workbook, function (workbook) { return workbook.id; });\r\n                $scope.ownerId = workbook.owner.id;\r\n                if (!VizPortal.FeatureFlags.projectControlledPermissionsEnabled) {\r\n                    // The info message is displayed on the permissions dialog for a few special cases when\r\n                    // workboks have tabbed views hidden. This is the only case that is applicable on the\r\n                    // permissions subplace, because it displays permissions for only one workbook at a time.\r\n                    // TODO: Move the info message into the permissions panel controller\r\n                    $scope.permissionsInfoMessage = workbook.displayTabs ? null :\r\n                        $translate.instant('permissions_workbooksWithTabsDisabledMessage');\r\n                }\r\n            };\r\n            setWorkbook(workbook);\r\n            Workbooks.markRecentlyViewed(workbook.id);\r\n            VizPortal.SubplaceCountsHelper.keepSubplaceCountsUpdated($scope, place);\r\n            VizPortal.SubplaceTabsHelper.refreshWhenCurrentTabClicked($scope, $state);\r\n            $scope.del = function ($event) {\r\n                ContentActions.deleteWorkbook(workbook, VizPortal.ActionContext.fromEvent($event))\r\n                    .then(function () { return $state.go('main.site.content.project.workbooks', { id: workbook.project.id }); });\r\n            };\r\n            $scope.changeDescription = function (newDescription) {\r\n                return ChangeWorkbookDescriptionAction.execute(workbook, newDescription).then(VizPortal.ResultHelper.rejectResultOnError(_this.$q));\r\n            };\r\n            $scope.download = function ($event) {\r\n                DownloadActions\r\n                    .downloadWorkbook(workbook)\r\n                    .then(setWorkbook) // We have new information about the workbook, let's update our models\r\n                    .fail(function () { return $state.hardReload(); }); // This may have failed because our model is out of date, let's update it\r\n                $event.preventDefault();\r\n            };\r\n            $scope.changeOwner = function ($event) {\r\n                return ContentActions.changeOwnerOnWorkbooks($scope.workbookSet, VizPortal.ActionContext.fromEvent($event))\r\n                    .then(function () { return $state.hardReload(); });\r\n            };\r\n            $scope.moveToProject = function ($event) {\r\n                return ContentActions.moveWorkbooksToProject($scope.workbookSet, VizPortal.ActionContext.fromEvent($event))\r\n                    .then(function () { return $state.hardReload(); });\r\n            };\r\n            $scope.showRevisionHistory = function () {\r\n                return RevisionHistoryAction.showRevisionHistory(workbook)\r\n                    .then(function () { return $state.hardReload(); });\r\n            };\r\n            $scope.editWorkbook = function ($event) {\r\n                ContentActions.editWorkbook($scope.workbook);\r\n                $event.preventDefault();\r\n            };\r\n            $scope.$watch('workbook.displayTabs', function (newVal, oldVal) {\r\n                if (newVal !== oldVal) {\r\n                    SetDisplayTabsAction.setDisplayTabs(workbook, newVal)\r\n                        .then(function () { return $state.hardReload(); });\r\n                }\r\n            });\r\n            $scope.changeTags = function (newTagsList) {\r\n                return ContentActions.setTagsOnWorkbook($scope.workbook, newTagsList)\r\n                    .then(VizPortal.ResultHelper.rejectResultOnError(_this.$q))\r\n                    .then(function () { return $state.hardReload(); });\r\n            };\r\n            $scope.refreshNow = function ($event) {\r\n                CreateExtractTasksAction.forWorkbook($scope.workbook, VizPortal.ActionContext.fromEvent($event), VizPortal.CreateExtractTasksMode.AllowRefreshNow)\r\n                    .then(function () { return $state.hardReload(); });\r\n            };\r\n            $scope.addFavorite = function () { return Favorites.addWorkbook($scope.workbook); };\r\n            $scope.removeFavorite = function () { return Favorites.removeWorkbook($scope.workbook); };\r\n            $scope.allowedAction = function (actionName) { return (!!workbookActions && workbookActions[actionName]); };\r\n            $scope.contentBreadcrumbUrl = function () { return breadcrumbs.siteUrl\r\n                ? '#' + breadcrumbs.siteUrl\r\n                : $state.href('main.site.content.site.projects'); };\r\n            $scope.projectBreadcrumbUrl = function () { return breadcrumbs.projectUrl\r\n                ? '#' + breadcrumbs.projectUrl\r\n                : $state.href('main.site.content.project.workbooks', { id: workbook.project.id }); };\r\n            breadcrumbs.rememberWorkbookUrl(workbook, $location.url());\r\n            $scope.$on('$locationChangeSuccess', function () {\r\n                var path = $location.path();\r\n                if (/^(\\/site\\/[^\\/]+)?\\/workbooks\\/[^\\/]+\\/(views|datasources|permissions|details)(\\/)?$/.test(path)) {\r\n                    breadcrumbs.rememberWorkbookUrl(workbook, $location.url());\r\n                }\r\n            });\r\n            $scope.isWorkbookRevisionHistoryEnabled = VizPortal.FeatureFlags.workbookVersionHistoryEnabled;\r\n        }\r\n        WorkbookPlaceCtrl.$inject = [\r\n            '$location',\r\n            '$q',\r\n            '$scope',\r\n            '$state',\r\n            '$translate',\r\n            'BreadcrumbsService',\r\n            'ContentActions',\r\n            'ChangeWorkbookDescriptionAction',\r\n            'SetDisplayTabsAction',\r\n            'DownloadActions',\r\n            'CreateExtractTasksAction',\r\n            'Favorites',\r\n            'place',\r\n            'workbook',\r\n            'workbookActions',\r\n            'Workbooks',\r\n            'RevisionHistoryAction'\r\n        ];\r\n        return WorkbookPlaceCtrl;\r\n    })();\r\n    VizPortal.WorkbookPlaceCtrl = WorkbookPlaceCtrl;\r\n    VizPortal.Module.instance().controller('WorkbookPlaceCtrl', WorkbookPlaceCtrl);\r\n    var DatasourcePlaceCtrl = (function () {\r\n        function DatasourcePlaceCtrl($q, $scope, $state, breadcrumbs, server, ContentActions, ChangeDatasourceDescriptionAction, DownloadActions, DeleteDatasourcesAction, datasource, datasourceActions, place) {\r\n            var _this = this;\r\n            this.$q = $q;\r\n            this.server = server;\r\n            this.DeleteDatasourcesAction = DeleteDatasourcesAction;\r\n            this.datasource = datasource;\r\n            $scope.place = VizPortal.ContentTypes.datasource;\r\n            var setDatasource = function (newDatasource) {\r\n                datasource = newDatasource;\r\n                $scope.objectName = datasource.name;\r\n                $scope.datasource = datasource;\r\n                $scope.datasourceSet = VizPortal.Set.singleton(datasource, function (datasource) { return datasource.id; });\r\n                $scope.ownerId = datasource.owner.id;\r\n            };\r\n            setDatasource(datasource);\r\n            VizPortal.SubplaceCountsHelper.keepSubplaceCountsUpdated($scope, place);\r\n            VizPortal.SubplaceTabsHelper.refreshWhenCurrentTabClicked($scope, $state);\r\n            $scope.del = function ($event) {\r\n                _this.DeleteDatasourcesAction.confirmDeleteDatasource(datasource, VizPortal.ActionContext.fromEvent($event))\r\n                    .then(function (result) {\r\n                    if (result.allowed) {\r\n                        $state.go('main.site.content.project.datasources', { id: datasource.project.id });\r\n                    }\r\n                });\r\n            };\r\n            $scope.changeDescription = function (newDescription) {\r\n                return ChangeDatasourceDescriptionAction.execute(datasource, newDescription).then(VizPortal.ResultHelper.rejectResultOnError(_this.$q));\r\n            };\r\n            $scope.download = function ($event) {\r\n                DownloadActions\r\n                    .downloadDatasource(datasource)\r\n                    .then(setDatasource) // We have new information about the data source, let's update our models\r\n                    .fail(function () { return $state.hardReload(); }); // May have failed because our model is out of date, let's update it\r\n                $event.preventDefault();\r\n            };\r\n            $scope.changeOwner = function ($event) {\r\n                return ContentActions.changeOwnerOnDatasources($scope.datasourceSet, VizPortal.ActionContext.fromEvent($event))\r\n                    .then(function () { return $state.hardReload(); });\r\n            };\r\n            $scope.moveToProject = function ($event) {\r\n                return ContentActions.moveDatasourcesToProject($scope.datasourceSet, VizPortal.ActionContext.fromEvent($event))\r\n                    .then(function () { return $state.hardReload(); });\r\n            };\r\n            $scope.newWorkbook = function ($event) {\r\n                ContentActions.newWorkbook($scope.datasource);\r\n                $event.preventDefault();\r\n            };\r\n            $scope.changeTags = function (newTagsList) {\r\n                return ContentActions.setTagsOnDatasource($scope.datasource, newTagsList)\r\n                    .then(VizPortal.ResultHelper.rejectResultOnError(_this.$q))\r\n                    .then(function () { return $state.hardReload(); });\r\n            };\r\n            $scope.allowedAction = function (actionName) { return (!!datasourceActions && datasourceActions[actionName]); };\r\n            // Breadcrumbs\r\n            breadcrumbs.projectChanged(datasource.project);\r\n            $scope.contentBreadcrumbUrl = function () { return breadcrumbs.siteUrl\r\n                ? '#' + breadcrumbs.siteUrl\r\n                : $state.href('main.site.content.site.projects'); };\r\n            $scope.projectBreadcrumbUrl = function () { return breadcrumbs.projectUrl\r\n                ? '#' + breadcrumbs.projectUrl\r\n                : $state.href('main.site.content.project.datasources', { id: datasource.project.id }); };\r\n            $scope.refreshModeIsRemote = function () {\r\n                return _this.remoteRefreshesEnabled() &&\r\n                    datasource.refreshMode === VizPortal.ServerApi.RefreshModeTypes.Remote;\r\n            };\r\n            $scope.refreshModeIsServer = function () {\r\n                return _this.datasource.hasExtracts && !$scope.refreshModeIsRemote();\r\n            };\r\n        }\r\n        DatasourcePlaceCtrl.prototype.remoteRefreshesEnabled = function () {\r\n            return this.server.featureFlags().dataSyncEnabled && this.datasource.hasExtracts;\r\n        };\r\n        DatasourcePlaceCtrl.$inject = [\r\n            '$q',\r\n            '$scope',\r\n            '$state',\r\n            'BreadcrumbsService',\r\n            'ServerService',\r\n            'ContentActions',\r\n            'ChangeDatasourceDescriptionAction',\r\n            'DownloadActions',\r\n            'DeleteDatasourcesAction',\r\n            'datasource',\r\n            'datasourceActions',\r\n            'place'\r\n        ];\r\n        return DatasourcePlaceCtrl;\r\n    })();\r\n    VizPortal.DatasourcePlaceCtrl = DatasourcePlaceCtrl;\r\n    VizPortal.Module.instance().controller('DatasourcePlaceCtrl', DatasourcePlaceCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/Filter.ts\" />\r\n/// <reference path=\"../helpers/ServerFilterClauses.ts\" />\r\n/// <reference path=\"../ServerApi/types/IFilterClause.ts\" />\r\n/// <reference path=\"../ServerApi/types/resourceParts.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ContentFilterService = (function () {\r\n        function ContentFilterService($location) {\r\n            this.$location = $location;\r\n        }\r\n        ContentFilterService.prototype.getFilter = function (explicitFilterKeys, implicitFilters) {\r\n            return VizPortal.Filter.and(this.getFilterClauses(explicitFilterKeys, implicitFilters));\r\n        };\r\n        ContentFilterService.prototype.getFilterClauses = function (explicitFilterKeys, implicitFilters) {\r\n            var explicitFilters = _(this.$location.search()).pick(explicitFilterKeys);\r\n            var filterValues = _.extend(explicitFilters, implicitFilters);\r\n            return VizPortal.ServerFilterClauses.create(filterValues);\r\n        };\r\n        ContentFilterService.$inject = ['$location'];\r\n        return ContentFilterService;\r\n    })();\r\n    VizPortal.ContentFilterService = ContentFilterService;\r\n    VizPortal.Module.instance().service('ContentFilterService', ContentFilterService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SiteRoleFilterHelper;\r\n    (function (SiteRoleFilterHelper) {\r\n        SiteRoleFilterHelper.AnyRole = 'Any';\r\n        function siteRoleOptions(roles, userCountsByRole) {\r\n            if (!userCountsByRole) {\r\n                userCountsByRole = {};\r\n            }\r\n            var options = [\r\n                {\r\n                    value: SiteRoleFilterHelper.AnyRole,\r\n                    translate: 'siteRole_Any',\r\n                    count: userCountsByRole[SiteRoleFilterHelper.AnyRole]\r\n                }\r\n            ];\r\n            _.each(roles, function (role) {\r\n                options.push({\r\n                    value: role,\r\n                    translate: 'siteRole_' + role,\r\n                    count: userCountsByRole[role]\r\n                });\r\n            });\r\n            return options;\r\n        }\r\n        SiteRoleFilterHelper.siteRoleOptions = siteRoleOptions;\r\n    })(SiteRoleFilterHelper = VizPortal.SiteRoleFilterHelper || (VizPortal.SiteRoleFilterHelper = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/SiteRoleFilterHelper.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.FilterCategories = {\r\n        general: 'general',\r\n        datasource: 'datasource'\r\n    };\r\n    (function (PasswordStatus) {\r\n        PasswordStatus[PasswordStatus[\"Any\"] = 0] = \"Any\";\r\n        PasswordStatus[PasswordStatus[\"Embedded\"] = 1] = \"Embedded\";\r\n        PasswordStatus[PasswordStatus[\"NotEmbedded\"] = 2] = \"NotEmbedded\";\r\n    })(VizPortal.PasswordStatus || (VizPortal.PasswordStatus = {}));\r\n    var PasswordStatus = VizPortal.PasswordStatus;\r\n    (function (DatasourceType) {\r\n        DatasourceType[DatasourceType[\"All\"] = 1] = \"All\";\r\n        DatasourceType[DatasourceType[\"Embedded\"] = 2] = \"Embedded\";\r\n        DatasourceType[DatasourceType[\"Published\"] = 3] = \"Published\";\r\n    })(VizPortal.DatasourceType || (VizPortal.DatasourceType = {}));\r\n    var DatasourceType = VizPortal.DatasourceType;\r\n    // TODO This value should be defined in a content specific config file,\r\n    // For now, keep in sync with ContentFilterService.ts\r\n    var portDefault = 'default';\r\n    var FilterPanelService = (function () {\r\n        function FilterPanelService(suggestions, $q) {\r\n            this.suggestions = suggestions;\r\n            this.$q = $q;\r\n            this.createFilterDefinitions();\r\n        }\r\n        FilterPanelService.prototype.createFilterDefinitions = function () {\r\n            var _this = this;\r\n            this.filterDefinitions = _.indexBy([\r\n                // General Filters\r\n                {\r\n                    name: 'project',\r\n                    type: 'typeahead',\r\n                    category: VizPortal.FilterCategories.general,\r\n                    field: VizPortal.ServerApi.FilterFieldNames.projectId,\r\n                    valueFromParams: this.fromSingleParam('project', function (paramValue) { return _this.suggestions.project(paramValue); }),\r\n                    valueToParams: this.toSingleParam('project', function (fieldValue) { return fieldValue.value; }),\r\n                    matchPrefixesOnly: false\r\n                },\r\n                {\r\n                    name: 'owner',\r\n                    type: 'typeahead',\r\n                    category: VizPortal.FilterCategories.general,\r\n                    field: VizPortal.ServerApi.FilterFieldNames.ownerId,\r\n                    valueFromParams: this.fromSingleParam('owner', function (paramValue) { return _this.suggestions.user(paramValue); }),\r\n                    valueToParams: this.toSingleParam('owner', function (fieldValue) { return fieldValue.value; }),\r\n                    matchPrefixesOnly: true\r\n                },\r\n                {\r\n                    name: 'tag',\r\n                    type: 'typeahead',\r\n                    category: VizPortal.FilterCategories.general,\r\n                    field: VizPortal.ServerApi.FilterFieldNames.tags,\r\n                    valueFromParams: this.fromSingleParam('tag', function (paramValue) { return _this.$q.when({ value: paramValue, label: paramValue, count: 0 }); }),\r\n                    valueToParams: this.toSingleParam('tag', function (fieldValue) { return fieldValue.value; }),\r\n                    matchPrefixesOnly: false\r\n                },\r\n                this.siteRoleFilterDefinition(),\r\n                this.groupsMinimumSiteRoleDefinition(),\r\n                this.maxSiteRoleDefinition(),\r\n                this.afterDateFilterDefinition('createdAfter', VizPortal.FilterCategories.general),\r\n                this.beforeDateFilterDefinition('createdBefore', VizPortal.FilterCategories.general),\r\n                this.afterDateFilterDefinition('modifiedAfter', VizPortal.FilterCategories.general),\r\n                this.beforeDateFilterDefinition('modifiedBefore', VizPortal.FilterCategories.general),\r\n                this.booleanFilterDefinition('favorite', VizPortal.FilterCategories.general),\r\n                this.booleanFilterDefinition('recent', VizPortal.FilterCategories.general),\r\n                this.booleanFilterDefinition('hasAlert', VizPortal.FilterCategories.general),\r\n                // Data Source Filters\r\n                this.selectFilterDefinition('showEmbedded', {\r\n                    '': DatasourceType.Published,\r\n                    'true': DatasourceType.All,\r\n                    'only': DatasourceType.Embedded\r\n                }, [\r\n                    { value: DatasourceType.All, translate: 'datasourceTypeAll' },\r\n                    { value: DatasourceType.Published, translate: 'datasourceTypePublishedOnly' },\r\n                    { value: DatasourceType.Embedded, translate: 'datasourceTypeEmbeddedOnly' }\r\n                ], VizPortal.FilterCategories.datasource),\r\n                {\r\n                    name: 'connectionType',\r\n                    type: 'typeahead',\r\n                    category: VizPortal.FilterCategories.datasource,\r\n                    field: VizPortal.ServerApi.FilterFieldNames.connectionType,\r\n                    valueFromParams: this.fromSingleParam('connectionType', function (paramValue) { return _this.suggestions.dataConnectionType(paramValue); }),\r\n                    valueToParams: this.toSingleParam('connectionType', function (fieldValue) { return fieldValue.value; }),\r\n                    matchPrefixesOnly: true\r\n                },\r\n                this.textFilterDefinition('serverName', VizPortal.FilterCategories.datasource),\r\n                this.textDropdownFilterDefinition('serverPort', [\r\n                    { value: null, translate: 'serverPortAny' },\r\n                    { value: 'default', translate: 'serverPortDefault' }\r\n                ], function (val) { return (val === portDefault || (/^\\d*$/.exec(val) && parseInt(val, 10) <= 65535)); }, VizPortal.FilterCategories.datasource),\r\n                this.textFilterDefinition('databaseUsername', VizPortal.FilterCategories.datasource),\r\n                this.selectFilterDefinition('hasPassword', {\r\n                    '': PasswordStatus.Any,\r\n                    'true': PasswordStatus.Embedded,\r\n                    'false': PasswordStatus.NotEmbedded\r\n                }, [\r\n                    { value: PasswordStatus.Any, translate: 'hasPasswordAny' },\r\n                    { value: PasswordStatus.Embedded, translate: 'hasPasswordEmbedded' },\r\n                    { value: PasswordStatus.NotEmbedded, translate: 'hasPasswordNotEmbedded' }\r\n                ], VizPortal.FilterCategories.datasource),\r\n                this.booleanFilterDefinition('hasExtracts', VizPortal.FilterCategories.datasource)\r\n            ], 'name');\r\n        };\r\n        FilterPanelService.prototype.siteRoleFilterDefinition = function () {\r\n            return this.siteRoleSelectFilterDefinition('siteRole', VizPortal.SiteRoles.WithoutGuest);\r\n        };\r\n        FilterPanelService.prototype.groupsMinimumSiteRoleDefinition = function () {\r\n            return this.siteRoleSelectFilterDefinition('groupsMinimumSiteRole', VizPortal.SiteRoles.WithoutGuestOrServerAdmin);\r\n        };\r\n        FilterPanelService.prototype.maxSiteRoleDefinition = function () {\r\n            return this.siteRoleSelectFilterDefinition('maxSiteRole', VizPortal.SiteRoles.WithoutGuest);\r\n        };\r\n        FilterPanelService.prototype.siteRoleSelectFilterDefinition = function (name, roles) {\r\n            return this.selectFilterDefinition(name, \r\n            // param key values mapped to value states\r\n            // Map '' to \"any role\"\r\n            _.extend({}, VizPortal.ServerApi.SiteRoles, { '': VizPortal.SiteRoleFilterHelper.AnyRole }), VizPortal.SiteRoleFilterHelper.siteRoleOptions(roles), VizPortal.FilterCategories.general);\r\n        };\r\n        FilterPanelService.prototype.selectFilterDefinition = function (name, paramToValueMap, options, category) {\r\n            var _this = this;\r\n            var valueToParamMap = Helpers.swapDict(paramToValueMap);\r\n            return {\r\n                name: name,\r\n                type: 'select',\r\n                category: category,\r\n                valueFromParams: function (params) { return _this.$q.when(paramToValueMap[params[name]] || paramToValueMap['']); },\r\n                valueToParams: this.toSingleParam(name, function (val) { return (valueToParamMap[val + ''] || null); }),\r\n                options: options\r\n            };\r\n        };\r\n        FilterPanelService.prototype.booleanFilterDefinition = function (name, category) {\r\n            var _this = this;\r\n            return {\r\n                name: name,\r\n                type: 'boolean',\r\n                category: category,\r\n                valueFromParams: this.fromSingleParam(name, function (paramValue) { return _this.$q.when(Helpers.toBoolean(paramValue)); }),\r\n                valueToParams: this.toSingleParam(name, function (value) { return '' + value; })\r\n            };\r\n        };\r\n        FilterPanelService.prototype.textFilterDefinition = function (name, category) {\r\n            var _this = this;\r\n            return {\r\n                name: name,\r\n                type: 'text',\r\n                category: category,\r\n                valueFromParams: this.fromSingleParam(name, function (paramValue) { return _this.$q.when(paramValue); }),\r\n                valueToParams: this.toSingleParam(name, function (text) { return text; })\r\n            };\r\n        };\r\n        FilterPanelService.prototype.textDropdownFilterDefinition = function (name, options, isValid, category) {\r\n            var _this = this;\r\n            return {\r\n                name: name,\r\n                type: 'textDropdown',\r\n                category: category,\r\n                valueFromParams: this.fromSingleParam(name, function (paramValue) { return _this.$q.when(isValid(paramValue) ? paramValue : null); }),\r\n                valueToParams: this.toSingleParam(name, function (text) { return text; }),\r\n                options: options,\r\n                isValid: isValid\r\n            };\r\n        };\r\n        FilterPanelService.prototype.afterDateFilterDefinition = function (name, category) {\r\n            var _this = this;\r\n            return {\r\n                name: name,\r\n                type: 'date',\r\n                category: category,\r\n                valueFromParams: this.fromSingleParam(name, function (paramValue) { return _this.dateFromISOString(paramValue); }),\r\n                valueToParams: this.toSingleParam(name, function (date) { return VizPortal.DateHelpers.toISOString(date); })\r\n            };\r\n        };\r\n        FilterPanelService.prototype.beforeDateFilterDefinition = function (name, category) {\r\n            var _this = this;\r\n            return {\r\n                name: name,\r\n                type: 'date',\r\n                category: category,\r\n                valueFromParams: this.fromSingleParam(name, function (paramValue) { return _this.dateFromISOString(paramValue); }),\r\n                valueToParams: this.toSingleParam(name, function (date) { return VizPortal.DateHelpers.toISOString(VizPortal.DateHelpers.endOfDay(date)); })\r\n            };\r\n        };\r\n        FilterPanelService.prototype.dateFromISOString = function (paramValue) {\r\n            return this.$q.when(VizPortal.DateHelpers.midnight(VizPortal.DateHelpers.fromISOString(paramValue)));\r\n        };\r\n        FilterPanelService.prototype.fromSingleParam = function (paramName, valueFn) {\r\n            var _this = this;\r\n            return function (params) { return params[paramName] ? valueFn(params[paramName]) : _this.$q.when(null); };\r\n        };\r\n        FilterPanelService.prototype.toSingleParam = function (paramName, paramValueFn) {\r\n            return function (value) {\r\n                var params = {};\r\n                params[paramName] = value ? paramValueFn(value) : null;\r\n                return params;\r\n            };\r\n        };\r\n        FilterPanelService.prototype.getFilterDefinitions = function (filterNames) {\r\n            var _this = this;\r\n            var defns = _.map(filterNames, function (filterName) { return _this.filterDefinitions[filterName]; });\r\n            return _.filter(defns, function (defn) { return defn != null; });\r\n        };\r\n        FilterPanelService.$inject = ['SearchSuggestionsService', '$q'];\r\n        return FilterPanelService;\r\n    })();\r\n    VizPortal.FilterPanelService = FilterPanelService;\r\n    VizPortal.Module.instance().service('FilterPanelService', FilterPanelService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/ContentFilters.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/BrowserSupportService.ts\" />\r\n/// <reference path=\"../services/ContentFilterService.ts\" />\r\n/// <reference path=\"../services/FilterPanelService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var FilterPanelCtrl = (function () {\r\n        function FilterPanelCtrl($scope, $location, BrowserSupportService) {\r\n            var filterDefinitions = $scope.filterDefinitions;\r\n            $scope.filters = _.map(filterDefinitions, function (defn) {\r\n                return { definition: defn, ready: false, value: undefined };\r\n            });\r\n            var isGeneral = function (filter) { return filter.definition.category === VizPortal.FilterCategories.general; };\r\n            var isDatasource = function (filter) { return filter.definition.category === VizPortal.FilterCategories.datasource; };\r\n            var isCheckbox = function (filter) { return filter.definition.type === 'boolean'; };\r\n            $scope.anyGeneralFilters = function () { return _.some($scope.filters, isGeneral); };\r\n            $scope.anyDatasourceFilters = function () { return _.some($scope.filters, isDatasource); };\r\n            $scope.generalFilter = function (filter) { return isGeneral(filter) && !isCheckbox(filter); };\r\n            $scope.generalCheckbox = function (filter) { return isGeneral(filter) && isCheckbox(filter); };\r\n            $scope.datasourceFilter = function (filter) { return isDatasource(filter) && !isCheckbox(filter); };\r\n            $scope.datasourceCheckbox = function (filter) { return isDatasource(filter) && isCheckbox(filter); };\r\n            $scope.filterControls.clearAllFilters = function () {\r\n                var urlParams = $location.search();\r\n                _.each(_.keys(urlParams), function (key) {\r\n                    if (_.has(VizPortal.ContentFiltersKeys, key)) {\r\n                        $location.search(key, null);\r\n                    }\r\n                });\r\n                _.each($scope.filters, function (filterControl) {\r\n                    if (filterControl.clear) {\r\n                        filterControl.clear();\r\n                    }\r\n                });\r\n            };\r\n            $scope.submitSearch = function (searchText, $event) {\r\n                $location.search(VizPortal.ContentFiltersKeys.search, searchText || null);\r\n                if (BrowserSupportService.isTouch() && $event) {\r\n                    $($event.target).blur();\r\n                }\r\n            };\r\n            // Update location when filter selection changes\r\n            _.each($scope.filters, function (filterControl) {\r\n                $scope.$watch(function () { return filterControl.value; }, function () {\r\n                    if (filterControl.ready) {\r\n                        var params = filterControl.definition.valueToParams(filterControl.value);\r\n                        _.each(params, function (value, key) {\r\n                            $location.search(key, value);\r\n                        });\r\n                    }\r\n                });\r\n            });\r\n            var updateModelFromURL = function () {\r\n                var urlParams = $location.search();\r\n                $scope.anyFiltersActive = _.some(_.keys(urlParams), function (key) {\r\n                    return _.has(VizPortal.ContentFiltersKeys, key);\r\n                });\r\n                $scope.searchText = urlParams.search || '';\r\n                _.each($scope.filters, function (filterControl) {\r\n                    filterControl.ready = false;\r\n                    filterControl.definition.valueFromParams(urlParams).then(function (value) {\r\n                        filterControl.ready = true;\r\n                        filterControl.value = value;\r\n                    });\r\n                });\r\n            };\r\n            updateModelFromURL();\r\n            $scope.$on(\"$locationChangeSuccess\", function () {\r\n                updateModelFromURL();\r\n            });\r\n        }\r\n        FilterPanelCtrl.$inject = ['$scope', '$location', 'BrowserSupportService'];\r\n        return FilterPanelCtrl;\r\n    })();\r\n    VizPortal.FilterPanelCtrl = FilterPanelCtrl;\r\n    VizPortal.Module.instance().controller('FilterPanelCtrl', FilterPanelCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/SliceableHelper.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../models/Set.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.SelectionEvent = {\r\n        SelectionStarted: 'selectionStartedEvent',\r\n        SelectionEnded: 'selectionEndedEvent'\r\n    };\r\n    VizPortal.Module.instance().directive('tbSelectionMenu', function () {\r\n        return {\r\n            restrict: 'E',\r\n            replace: true,\r\n            templateUrl: 'selectionMenu.html',\r\n            scope: {\r\n                selection: '=',\r\n                sliceable: '='\r\n            },\r\n            link: function ($scope) {\r\n                var cancelSelectAll = false;\r\n                $scope.$on('$destroy', function () {\r\n                    cancelSelectAll = true;\r\n                });\r\n                $scope.selectAll = function () {\r\n                    $scope.$emit(VizPortal.SelectionEvent.SelectionStarted);\r\n                    $scope.selecting = true;\r\n                    VizPortal.SliceableHelper.fetchAll($scope.sliceable, function (items) {\r\n                        $scope.selection.addItems(items);\r\n                        return cancelSelectAll;\r\n                    }).fin(function () {\r\n                        $scope.$emit(VizPortal.SelectionEvent.SelectionEnded);\r\n                        $scope.selecting = false;\r\n                    });\r\n                };\r\n            }\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DropdownHelper = (function () {\r\n        function DropdownHelper() {\r\n        }\r\n        DropdownHelper.setupDropdownScope = function (scope, $timeout, focusElement, rowToModel) {\r\n            // State transitions (edit, cancel, select, etc.)\r\n            scope.currentRow = {\r\n                index: 0,\r\n                object: null\r\n            };\r\n            function reset() {\r\n                scope.editMode = false;\r\n                scope.textValue = '';\r\n                scope.currentRow.index = -1;\r\n            }\r\n            reset();\r\n            scope.select = function (item) {\r\n                try {\r\n                    scope.model = rowToModel(item);\r\n                }\r\n                catch (e) {\r\n                    return;\r\n                }\r\n                reset();\r\n            };\r\n            scope.cancel = function () {\r\n                reset();\r\n            };\r\n            scope.clear = function () {\r\n                scope.model = null;\r\n                reset();\r\n            };\r\n            scope.edit = function () {\r\n                scope.editMode = true;\r\n                focus();\r\n            };\r\n            function focus() {\r\n                $timeout(function () { return focusElement.focus(); });\r\n            }\r\n            // Close if the user clicks outside the dropdown\r\n            scope.mousedownOutside = function ($event) {\r\n                if ($($event.target).closest(focusElement).length === 0) {\r\n                    scope.cancel();\r\n                }\r\n            };\r\n            // Keyboard handling\r\n            scope.handleKeyEvent = function ($event) {\r\n                switch ($event.which) {\r\n                    case VizPortal.Keys.ArrowDown:\r\n                        scope.currentRow.index++;\r\n                        break;\r\n                    case VizPortal.Keys.ArrowUp:\r\n                        // Don't let the index go below 0 on arrow up\r\n                        scope.currentRow.index = Math.max(scope.currentRow.index - 1, 0);\r\n                        break;\r\n                    case VizPortal.Keys.Enter:\r\n                    case VizPortal.Keys.Tab:\r\n                        $event.preventDefault();\r\n                        scope.select(scope.currentRow.object);\r\n                        break;\r\n                    case VizPortal.Keys.Escape:\r\n                        $event.preventDefault();\r\n                        scope.cancel();\r\n                        break;\r\n                }\r\n            };\r\n        };\r\n        return DropdownHelper;\r\n    })();\r\n    VizPortal.DropdownHelper = DropdownHelper;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/DropdownHelper.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var TypeaheadColumnWidths = (function () {\r\n        function TypeaheadColumnWidths(widths) {\r\n            if (widths === void 0) { widths = []; }\r\n            this.widths = widths;\r\n        }\r\n        TypeaheadColumnWidths.prototype.getActual = function (index) {\r\n            return this.widths[index];\r\n        };\r\n        //Assumes 1 or 2 columns, expands the first cell to fill the total remaining space\r\n        TypeaheadColumnWidths.prototype.setWidths = function (widths, totalWidth) {\r\n            var firstCellWidth = totalWidth - (widths[1] || 0);\r\n            this.widths = [firstCellWidth].concat(widths.slice(1));\r\n        };\r\n        return TypeaheadColumnWidths;\r\n    })();\r\n    VizPortal.Module.instance().directive('tbTypeahead', [\r\n        '$timeout', '$parse',\r\n        function ($timeout, $parse) {\r\n            return {\r\n                restrict: 'E',\r\n                templateUrl: 'typeahead.html',\r\n                replace: true,\r\n                // Commented properties are read from directive attributes and added to the scope in the link function\r\n                scope: {\r\n                    model: '=ngModel',\r\n                    autoEdit: '=',\r\n                    typeaheadItemText: '@'\r\n                },\r\n                link: {\r\n                    pre: function (scope, element, attributes) {\r\n                        scope.placeholder = $parse(attributes.typeaheadPlaceholder)(scope.$parent);\r\n                        scope.matchPrefixesOnly = attributes.typeaheadMatchPrefixesOnly === 'true';\r\n                        scope.withCounts = attributes.typeaheadWithCounts === 'true';\r\n                        scope.typeaheadSource = $parse(attributes.typeaheadSource)(scope.$parent);\r\n                    },\r\n                    post: function (scope, element, attributes) {\r\n                        scope.itemText = function (model) {\r\n                            return model ? model[scope.typeaheadItemText] : (scope.placeholder || '');\r\n                        };\r\n                        var rowToModel = function (row) {\r\n                            if (!row)\r\n                                throw new Error('No row is selected');\r\n                            return row;\r\n                        };\r\n                        VizPortal.DropdownHelper.setupDropdownScope(scope, $timeout, element.find(\"input\"), rowToModel);\r\n                        scope.$watch('textValue', function (value) {\r\n                            if (scope.editMode) {\r\n                                scope.items = scope.typeaheadSource(value);\r\n                                if (value) {\r\n                                    scope.currentRow.index = 0;\r\n                                }\r\n                                else {\r\n                                    scope.currentRow.index = -1;\r\n                                }\r\n                            }\r\n                        });\r\n                        scope.$watch('editMode', function (editMode) {\r\n                            if (editMode) {\r\n                                scope.width = element.width();\r\n                                scope.items = scope.typeaheadSource(scope.textValue);\r\n                                scope.columnWidths = new TypeaheadColumnWidths();\r\n                            }\r\n                        });\r\n                        scope.$watch('autoEdit', function (autoEdit) {\r\n                            if (autoEdit) {\r\n                                scope.edit();\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ByteSizeConversionFactor = (function () {\r\n        function ByteSizeConversionFactor() {\r\n        }\r\n        ByteSizeConversionFactor.ONE_KB = 1000;\r\n        ByteSizeConversionFactor.ONE_MB = 1000000;\r\n        ByteSizeConversionFactor.ONE_GB = 1000000000;\r\n        return ByteSizeConversionFactor;\r\n    })();\r\n    VizPortal.ByteSizeConversionFactor = ByteSizeConversionFactor;\r\n    VizPortal.Module.instance().filter('size', [\r\n        '$translate',\r\n        function ($translate) {\r\n            // For details, see http://stackoverflow.com/questions/10015027/javascript-tofixed-not-rounding\r\n            function roundToPrecision(f, precision) {\r\n                var multiplier = Math.pow(10, precision + 1), wholeNumber = Math.floor(f * multiplier);\r\n                return (Math.round(wholeNumber / 10) * 10 / multiplier);\r\n            }\r\n            return function (sizeInBytes) {\r\n                if (!_.isFinite(sizeInBytes) || sizeInBytes < 0) {\r\n                    return '';\r\n                }\r\n                if (sizeInBytes >= ByteSizeConversionFactor.ONE_GB) {\r\n                    return $translate.instant(VizPortal.L10n.Keys.sizeInGB, {\r\n                        SIZE: roundToPrecision(sizeInBytes / ByteSizeConversionFactor.ONE_GB, 1)\r\n                    }, VizPortal.L10n.Interpolations.Float);\r\n                }\r\n                if (sizeInBytes >= ByteSizeConversionFactor.ONE_MB) {\r\n                    return $translate.instant(VizPortal.L10n.Keys.sizeInMB, {\r\n                        SIZE: roundToPrecision(sizeInBytes / ByteSizeConversionFactor.ONE_MB, 1)\r\n                    }, VizPortal.L10n.Interpolations.Float);\r\n                }\r\n                if (sizeInBytes >= ByteSizeConversionFactor.ONE_KB) {\r\n                    return $translate.instant(VizPortal.L10n.Keys.sizeInKB, {\r\n                        SIZE: roundToPrecision(sizeInBytes / ByteSizeConversionFactor.ONE_KB, 1)\r\n                    }, VizPortal.L10n.Interpolations.Float);\r\n                }\r\n                return $translate.instant(VizPortal.L10n.Keys.sizeInBytes, {\r\n                    SIZE: roundToPrecision(sizeInBytes, 0)\r\n                }, VizPortal.L10n.Interpolations.Count);\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/ISize.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../FeatureFlags.ts\" />\r\n/// <reference path=\"../models/ILayout.ts\" />\r\n/// <reference path=\"../models/ISize.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ListLayout = (function () {\r\n        function ListLayout(rowHeight) {\r\n            if (rowHeight === void 0) { rowHeight = ListLayout.DefaultRowHeight; }\r\n            this.rowHeight = rowHeight;\r\n        }\r\n        ListLayout.prototype.metrics = function (dimensions) {\r\n            return {\r\n                numberOfRows: Math.max(Math.ceil(dimensions.height / this.rowHeight), 1),\r\n                numberOfCols: 1,\r\n                heightOfRowInPx: this.rowHeight\r\n            };\r\n        };\r\n        ListLayout.DefaultRowHeight = VizPortal.FeatureFlags.useTallerRowHeight ? 38 : 28; // should match $dataGridRowHeight in sizes.styl\r\n        return ListLayout;\r\n    })();\r\n    VizPortal.ListLayout = ListLayout;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var CheckConnectionRequest = (function (_super) {\r\n            __extends(CheckConnectionRequest, _super);\r\n            function CheckConnectionRequest(params) {\r\n                _super.call(this, 'checkConnection', params);\r\n            }\r\n            return CheckConnectionRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.CheckConnectionRequest = CheckConnectionRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var UpdateConnectionsRequest = (function (_super) {\r\n            __extends(UpdateConnectionsRequest, _super);\r\n            function UpdateConnectionsRequest(params) {\r\n                _super.call(this, 'updateConnections', params);\r\n            }\r\n            return UpdateConnectionsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.UpdateConnectionsRequest = UpdateConnectionsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\n/// <reference path=\"../ServerApi/requests/CheckConnectionRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/UpdateConnectionsRequest.ts\" />\r\n/// <reference path=\"ContentActionNotification.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    // A sentinel credential id to mean \"Add new OAuth credential\"\r\n    var AddNewOAuthCredentialOptionId = \"__ADD_NEW_OAUTH_CREDENTIAL\";\r\n    VizPortal.PasswordUnchanged = null;\r\n    var CredentialOptions = {\r\n        none: 'none',\r\n        oauth: 'oauth',\r\n        password: 'password' // for Salesforce\r\n    };\r\n    var MixedCredentialOptions = 'mixed';\r\n    var DialogReserveHeight = 450;\r\n    var EditConnectionAction = (function () {\r\n        function EditConnectionAction(ConfirmActionDialog, $translate, ContentActionNotification, ModalService, DataConnections, OAuthCredentials, AddOAuthCredentialAction) {\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.$translate = $translate;\r\n            this.ContentActionNotification = ContentActionNotification;\r\n            this.ModalService = ModalService;\r\n            this.DataConnections = DataConnections;\r\n            this.OAuthCredentials = OAuthCredentials;\r\n            this.AddOAuthCredentialAction = AddOAuthCredentialAction;\r\n        }\r\n        EditConnectionAction.prototype.confirmEditConnections = function (dataSources, context) {\r\n            var datasourceArray = dataSources.toArray();\r\n            if (!this.haveSameConnectionType(datasourceArray)) {\r\n                return this.ModalService.alert({\r\n                    titleId: 'editDataConnections_mixedConnectionTypesTitle',\r\n                    messageId: 'editDataConnections_mixedConnectionTypesMessage'\r\n                }).result;\r\n            }\r\n            if (!this.areEditable(datasourceArray)) {\r\n                return this.ModalService.alert({\r\n                    titleId: 'editDataConnections_nonEditableTitle',\r\n                    messageId: 'editDataConnections_nonEditableMessage'\r\n                }).result;\r\n            }\r\n            if (dataSources.first().connectionOAuth) {\r\n                return this.confirmEditOAuthConnections(dataSources, context);\r\n            }\r\n            else {\r\n                return this.confirmEditDatabaseConnections(dataSources, context);\r\n            }\r\n        };\r\n        EditConnectionAction.prototype.haveSameConnectionType = function (datasources) {\r\n            var uniqueConnectionTypes = _.uniq(_.map(datasources, function (ds) { return ds.connectionType; }));\r\n            return uniqueConnectionTypes.length === 1;\r\n        };\r\n        EditConnectionAction.prototype.areEditable = function (datasources) {\r\n            return _.all(datasources, function (ds) { return ds.connectionTypeEditable; });\r\n        };\r\n        EditConnectionAction.prototype.confirmEditDatabaseConnections = function (dataSources, context) {\r\n            var _this = this;\r\n            var datasource = dataSources.first();\r\n            var datasourceArray = dataSources.toArray();\r\n            var dialogScope = context.scope.$new();\r\n            dialogScope.prompt = this.makePrompt(dataSources);\r\n            dialogScope.editModel = {\r\n                serverName: this.uniqueValueOrMixed(datasourceArray, function (ds) { return ds.connectionDetails.serverName; }),\r\n                serverPort: this.uniqueValueOrMixed(datasourceArray, function (ds) { return ds.connectionDetails.serverPort; }),\r\n                username: this.uniqueValueOrMixed(datasourceArray, function (ds) { return ds.connectionDetails.databaseUsername; }),\r\n                password: {\r\n                    isEmbedded: this.uniqueValueOrUndefined(datasourceArray, function (ds) { return ds.connectionDetails.hasEmbeddedPassword; }),\r\n                    newPassword: VizPortal.PasswordUnchanged\r\n                }\r\n            };\r\n            dialogScope.showTestConnection = dataSources.size() === 1;\r\n            dialogScope.testConnection = function () {\r\n                dialogScope.testConnectionResult = _this.checkEditedConnection(datasource.id, dialogScope.editModel);\r\n            };\r\n            return this.ConfirmActionDialog.open({\r\n                scope: dialogScope,\r\n                title: this.$translate.instant('editConnection'),\r\n                bodyTemplateUrl: \"editConnectionDialog.html\",\r\n                position: { reserveHeight: DialogReserveHeight },\r\n                actionName: this.$translate.instant('save'),\r\n                action: function (dialogInstance) {\r\n                    return _this.applyConnectionEdits(dataSources, dialogScope.editModel);\r\n                }\r\n            }).result.fin(function () { return dialogScope.$destroy(); });\r\n        };\r\n        EditConnectionAction.prototype.makePrompt = function (datasources) {\r\n            return this.$translate.instant('editDataConnections_prompt', {\r\n                ITEM_COUNT: datasources.size(),\r\n                ITEM_NAME: VizPortal.L10n.elideIfLong(datasources.first().name)\r\n            }, VizPortal.L10n.Interpolations.Count);\r\n        };\r\n        EditConnectionAction.prototype.configureEditOAuthScope = function (scope, dataSources) {\r\n            var _this = this;\r\n            var connectionType = dataSources.first().connectionType;\r\n            scope.allowOAuthWithPassword = connectionType === EditConnectionAction.SalesforceConnectionType;\r\n            // Prompts\r\n            scope.promptEmbedCredential = this.$translate.instant('editDataConnections_' + connectionType + '_embedCredential');\r\n            scope.promptNoCredential = this.$translate.instant('editDataConnections_' + connectionType + '_noCredential');\r\n            scope.describeEmbedCredential = this.$translate.instant('editDataConnections_' + connectionType + '_describeEmbedCredential');\r\n            scope.describeNoCredential = this.$translate.instant('editDataConnections_' + connectionType + '_describeNoCredential');\r\n            scope.connectionTypeDisplayName = dataSources.first().connectionTypeDisplayName;\r\n            scope.oauthEditModel = this.createOAuthEditModel(dataSources);\r\n            var refreshCredentials = function () {\r\n                return VizPortal.SliceableHelper.fetchAll(_this.OAuthCredentials.all().addFilter(VizPortal.Filter.fieldEq(\"type\", connectionType)))\r\n                    .then(function (credentialsListResult) {\r\n                    scope.credentials = credentialsListResult.items;\r\n                    return credentialsListResult; // For chaining\r\n                });\r\n            };\r\n            refreshCredentials();\r\n            if (this.OAuthCredentials.canAddForConnectionType(connectionType)) {\r\n                scope.addNewOAuthCredentialOptionValue = AddNewOAuthCredentialOptionId;\r\n            }\r\n            scope.$watch(function () { return scope.oauthEditModel.credentialId; }, function (credentialId) {\r\n                if (credentialId === AddNewOAuthCredentialOptionId) {\r\n                    scope.oauthEditModel.credentialId = undefined;\r\n                    _this.AddOAuthCredentialAction.attemptAuth(connectionType).then(function (credentialId) {\r\n                        refreshCredentials().then(function (credentialsListResult) {\r\n                            // Set the credentialId if it exists in the list\r\n                            if (_.find(credentialsListResult.items, function (credential) { return credential.id === credentialId; })) {\r\n                                scope.oauthEditModel.credentialId = credentialId;\r\n                            }\r\n                        });\r\n                    });\r\n                }\r\n            });\r\n            scope.showTestConnection = dataSources.size() === 1;\r\n            scope.testConnection = function () {\r\n                scope.testConnectionResult =\r\n                    scope.oauthEditModel.credentialOption === CredentialOptions.password\r\n                        ? _this.checkEditedConnection(dataSources.first().id, scope.oauthEditModel.usernamePassword)\r\n                        : _this.checkOAuthConnection(scope.oauthEditModel.credentialId);\r\n            };\r\n            scope.testConnectionDisabled = function () {\r\n                return scope.testConnectionResult && scope.testConnectionResult.isPending\r\n                    || scope.oauthEditModel.credentialOption === MixedCredentialOptions\r\n                    || (scope.oauthEditModel.credentialOption === CredentialOptions.password && !scope.oauthEditModel.usernamePassword.username)\r\n                    || (scope.oauthEditModel.credentialOption === CredentialOptions.oauth && !scope.oauthEditModel.credentialId)\r\n                    || (scope.oauthEditModel.credentialOption === CredentialOptions.none);\r\n            };\r\n        };\r\n        EditConnectionAction.prototype.confirmEditOAuthConnections = function (dataSources, context) {\r\n            var _this = this;\r\n            var dialogScope = context.scope.$new();\r\n            this.configureEditOAuthScope(dialogScope, dataSources);\r\n            dialogScope.prompt = this.makePrompt(dataSources);\r\n            dialogScope.withAuthenticationSubHeader = true;\r\n            return this.ConfirmActionDialog.open({\r\n                scope: dialogScope,\r\n                title: this.$translate.instant('editConnection'),\r\n                size: VizPortal.ModalSize.medium,\r\n                bodyTemplateUrl: dialogScope.allowOAuthWithPassword ? \"editSalesforceConnectionDialog.html\" : \"editOAuthConnectionDialog.html\",\r\n                position: { reserveHeight: DialogReserveHeight },\r\n                actionName: this.$translate.instant('save'),\r\n                action: function (dialogInstance) {\r\n                    return _this.updateOAuthConnections(dataSources, dialogScope.oauthEditModel);\r\n                }\r\n            }).result.fin(function () { return dialogScope.$destroy(); });\r\n        };\r\n        EditConnectionAction.prototype.createOAuthEditModel = function (datasources) {\r\n            var editModel = {\r\n                credentialOption: MixedCredentialOptions,\r\n                credentialId: undefined,\r\n                credentialNoValueOptionText: undefined,\r\n                usernamePassword: {\r\n                    username: '',\r\n                    password: { isEmbedded: false, newPassword: '' }\r\n                }\r\n            };\r\n            this.OAuthCredentials.commonCredentialForDatasources(datasources.keys())\r\n                .then(function (result) {\r\n                var numAuthenticationTypes = 0;\r\n                if (result.hasEmbeddedPassword)\r\n                    numAuthenticationTypes++;\r\n                if (result.hasManagedKeychain)\r\n                    numAuthenticationTypes++;\r\n                if (result.hasOAuthCredential)\r\n                    numAuthenticationTypes++;\r\n                if (result.hasNone)\r\n                    numAuthenticationTypes++;\r\n                // If all connections have the same authentication type then select the proper option and fill in common details\r\n                if (numAuthenticationTypes === 1) {\r\n                    if (result.hasEmbeddedPassword) {\r\n                        editModel.credentialOption = CredentialOptions.password;\r\n                        editModel.usernamePassword = {\r\n                            username: result.commonUsername,\r\n                            password: { isEmbedded: true, newPassword: VizPortal.PasswordUnchanged }\r\n                        };\r\n                    }\r\n                    else if (result.hasManagedKeychain || result.hasOAuthCredential) {\r\n                        editModel.credentialOption = CredentialOptions.oauth;\r\n                        if (result.oauthCredentialId) {\r\n                            editModel.credentialId = result.oauthCredentialId;\r\n                        }\r\n                        else {\r\n                            // This user can see the credential but does not own it.  This displays it as an option with no value\r\n                            editModel.credentialNoValueOptionText = result.commonUsername;\r\n                        }\r\n                    }\r\n                    else if (result.hasNone) {\r\n                        editModel.credentialOption = CredentialOptions.none;\r\n                    }\r\n                }\r\n            });\r\n            return editModel;\r\n        };\r\n        EditConnectionAction.prototype.updateOAuthConnections = function (dataSources, editModel) {\r\n            var _this = this;\r\n            var updateRequest;\r\n            switch (editModel.credentialOption) {\r\n                case CredentialOptions.password:\r\n                    updateRequest = this.updateConnections(dataSources, editModel.usernamePassword);\r\n                    break;\r\n                case CredentialOptions.oauth:\r\n                    updateRequest = this.DataConnections.updateConnectionsOAuth(dataSources.keys(), editModel.credentialId);\r\n                    break;\r\n                case CredentialOptions.none:\r\n                    updateRequest = this.DataConnections.updateConnectionsOAuth(dataSources.keys());\r\n                    break;\r\n                default:\r\n                    throw \"Unexpected credential option: \" + editModel.credentialOption;\r\n            }\r\n            return updateRequest.then(function (result) {\r\n                _this.notifyResult(result, dataSources);\r\n                return result;\r\n            });\r\n        };\r\n        EditConnectionAction.prototype.uniqueValueOrMixed = function (items, iterator) {\r\n            var values = _.map(items, iterator);\r\n            var first = values[0];\r\n            return _.all(values, function (val) { return val === first; }) ? first : VizPortal.TextBoxMixedValues;\r\n        };\r\n        EditConnectionAction.prototype.uniqueValueOrUndefined = function (items, iterator) {\r\n            var values = _.map(items, iterator);\r\n            var first = values[0];\r\n            return _.all(values, function (val) { return val === first; }) ? first : undefined;\r\n        };\r\n        EditConnectionAction.prototype.applyConnectionEdits = function (datasources, editModel) {\r\n            var _this = this;\r\n            return this.updateConnections(datasources, editModel)\r\n                .then(function (result) {\r\n                _this.notifyResult(result, datasources);\r\n                return result;\r\n            });\r\n        };\r\n        EditConnectionAction.prototype.updateConnections = function (datasources, editModel) {\r\n            return this.DataConnections.updateConnections(datasources.keys(), this.editModelToConnectionUpdate(editModel));\r\n        };\r\n        EditConnectionAction.prototype.editModelToConnectionUpdate = function (editModel) {\r\n            return {\r\n                server: editModel.serverName === VizPortal.TextBoxMixedValues ? undefined : editModel.serverName,\r\n                port: editModel.serverPort === VizPortal.TextBoxMixedValues ? undefined : editModel.serverPort,\r\n                username: editModel.username === VizPortal.TextBoxMixedValues ? undefined : editModel.username,\r\n                passwordUpdate: _.isUndefined(editModel.password.isEmbedded) ? undefined : editModel.password\r\n            };\r\n        };\r\n        EditConnectionAction.prototype.notifyResult = function (result, datasources) {\r\n            // Edit connection does not have partial success - it is all-or-nothing\r\n            // So, if any errors are reported, notify complete failure (with the first error message)\r\n            if (result && result.errors && result.errors.length) {\r\n                this.ContentActionNotification.notifyFailure(this.errorMessage(result.errors[0]));\r\n            }\r\n            else {\r\n                this.ContentActionNotification.notifySuccess(this.$translate.instant('updateConnectionsSuccess', {\r\n                    ITEM_COUNT: datasources.size(),\r\n                    ITEM_NAME: VizPortal.L10n.elideIfLong(datasources.first().name)\r\n                }, VizPortal.L10n.Interpolations.Count));\r\n            }\r\n        };\r\n        EditConnectionAction.prototype.errorMessage = function (error) {\r\n            switch (error.code) {\r\n                case VizPortal.CommonErrorCode.DatasourceNotFound:\r\n                case VizPortal.CommonErrorCode.DataConnectionNotFound:\r\n                    return this.$translate.instant('updateConnectionsError_datasourceNotFound');\r\n                case VizPortal.CommonErrorCode.CallingUserInsufficientPermissions:\r\n                    return this.$translate.instant('updateConnectionsError_insufficientPermissions');\r\n                case VizPortal.DataConnectionErrorCode.UpdateConnectionsInvalidPort:\r\n                    return this.$translate.instant('updateConnectionsError_invalidPort');\r\n                default:\r\n                    return this.$translate.instant('errorUnknown');\r\n            }\r\n        };\r\n        EditConnectionAction.prototype.checkEditedConnection = function (datasourceId, editModel) {\r\n            var _this = this;\r\n            var testConnectionResult = { isPending: true };\r\n            this.DataConnections.checkConnection(datasourceId, this.editModelToConnectionUpdate(editModel)).then(function (result) { return _this.updateTestConnectionResult(testConnectionResult, result); });\r\n            return testConnectionResult;\r\n        };\r\n        EditConnectionAction.prototype.checkExistingConnection = function (datasourceId) {\r\n            var _this = this;\r\n            var testConnectionResult = { isPending: true };\r\n            this.DataConnections.checkExistingConnection(datasourceId).then(function (result) { return _this.updateTestConnectionResult(testConnectionResult, result); });\r\n            return testConnectionResult;\r\n        };\r\n        EditConnectionAction.prototype.updateTestConnectionResult = function (testConnectionResult, serverResponse) {\r\n            testConnectionResult.isPending = false;\r\n            testConnectionResult.succeeded = serverResponse.succeeded;\r\n            testConnectionResult.messages = serverResponse.messages;\r\n        };\r\n        EditConnectionAction.prototype.checkOAuthConnection = function (oauthCredentialId) {\r\n            var testConnectionResult = { isPending: true };\r\n            var handleTestResult = function (success) {\r\n                testConnectionResult.succeeded = success;\r\n                testConnectionResult.isPending = false;\r\n            };\r\n            this.OAuthCredentials.test(oauthCredentialId).then(handleTestResult, function () { return handleTestResult(false); });\r\n            return testConnectionResult;\r\n        };\r\n        EditConnectionAction.SalesforceConnectionType = 'salesforce'; // Maybe move to ServerApi\r\n        EditConnectionAction.$inject = [\r\n            'ConfirmActionDialog',\r\n            '$translate',\r\n            'ContentActionNotification',\r\n            'ModalService',\r\n            'DataConnections',\r\n            'OAuthCredentials',\r\n            'AddOAuthCredentialAction'\r\n        ];\r\n        return EditConnectionAction;\r\n    })();\r\n    VizPortal.EditConnectionAction = EditConnectionAction;\r\n    VizPortal.Module.instance().service('EditConnectionAction', EditConnectionAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ColumnWidths = (function () {\r\n        function ColumnWidths() {\r\n            this.resizer = new ColumnWidthsResizer(this);\r\n            this.actualWidths = [];\r\n        }\r\n        ColumnWidths.prototype.getTotal = function () {\r\n            return this.totalActualWidth || null;\r\n        };\r\n        ColumnWidths.prototype.updateTotal = function () {\r\n            this.totalActualWidth = _.reduce(this.actualWidths, function (total, width) { return total + width; }, 0);\r\n        };\r\n        ColumnWidths.prototype.getActual = function (index) {\r\n            return this.actualWidths[index];\r\n        };\r\n        ColumnWidths.prototype.setActual = function (index, width) {\r\n            this.actualWidths[index] = width;\r\n        };\r\n        ColumnWidths.prototype.resetActual = function () {\r\n            this.actualWidths = [];\r\n        };\r\n        ColumnWidths.prototype.getMin = function (index) {\r\n            return this.minWidths && this.minWidths[index];\r\n        };\r\n        ColumnWidths.prototype.setMinWidths = function (minWidths) {\r\n            this.minWidths = minWidths;\r\n            this.maybeExpand();\r\n        };\r\n        ColumnWidths.prototype.hasMinWidths = function () {\r\n            return !!this.minWidths;\r\n        };\r\n        // Minimum overrides preferred.\r\n        ColumnWidths.prototype.getPreferred = function (index) {\r\n            var preferred = this.preferredWidths && this.preferredWidths[index];\r\n            var min = this.getMin(index);\r\n            return _.isNumber(preferred)\r\n                ? (_.isNumber(min) ? Math.max(preferred, min) : preferred)\r\n                : min;\r\n        };\r\n        // The given maximum overrides preferred.  Minimum overrides both.\r\n        ColumnWidths.prototype.getPreferredWithMax = function (index, max) {\r\n            var preferred = this.preferredWidths && this.preferredWidths[index];\r\n            var min = this.getMin(index);\r\n            if (_.isNumber(preferred)) {\r\n                var maxPreferred = Math.min(preferred, max);\r\n                return _.isNumber(min) ? Math.max(maxPreferred, min) : maxPreferred;\r\n            }\r\n            else {\r\n                return min;\r\n            }\r\n        };\r\n        ColumnWidths.prototype.setPreferredWidths = function (preferredWidths, containerWidth) {\r\n            this.preferredWidths = preferredWidths;\r\n            this.containerWidth = containerWidth;\r\n            this.maybeExpand();\r\n        };\r\n        ColumnWidths.prototype.hasPreferredWidths = function () {\r\n            return !!this.preferredWidths;\r\n        };\r\n        ColumnWidths.prototype.setContainerWidth = function (containerWidth) {\r\n            this.containerWidth = containerWidth;\r\n            this.maybeExpand();\r\n        };\r\n        ColumnWidths.prototype.hasContainerWidth = function () {\r\n            return !!this.containerWidth;\r\n        };\r\n        ColumnWidths.prototype.maybeExpand = function () {\r\n            if (this.hasMinWidths() && this.hasPreferredWidths() && this.hasContainerWidth()) {\r\n                this.expandToFill(this.containerWidth);\r\n            }\r\n        };\r\n        ColumnWidths.prototype.expandToFill = function (availableWidth) {\r\n            var _this = this;\r\n            // First, set the widths to the preferred, subject to the minimum widths and maximum starting width.\r\n            var numColumns = Math.max(this.minWidths && this.minWidths.length || 0, this.preferredWidths && this.preferredWidths.length || 0);\r\n            var totalWidth = 0;\r\n            _.times(numColumns, function (index) {\r\n                var width = _this.getPreferredWithMax(index, ColumnWidths.MaxStartWidth);\r\n                _this.setActual(index, width);\r\n                totalWidth += width;\r\n            });\r\n            // Then, distribute any extra width in left-to-right order.\r\n            var extraWidth = availableWidth - totalWidth;\r\n            if (extraWidth > 0) {\r\n                _.each(this.actualWidths, function (actualWidth, index) {\r\n                    var preferredWidth = _this.getPreferred(index);\r\n                    if (extraWidth > 0 && actualWidth < preferredWidth) {\r\n                        var usedWidth = Math.min(preferredWidth - actualWidth, extraWidth);\r\n                        _this.setActual(index, actualWidth + usedWidth);\r\n                        extraWidth -= usedWidth;\r\n                    }\r\n                });\r\n            }\r\n            this.updateTotal();\r\n        };\r\n        ColumnWidths.MaxStartWidth = 200;\r\n        return ColumnWidths;\r\n    })();\r\n    VizPortal.ColumnWidths = ColumnWidths;\r\n    var ColumnWidthsResizer = (function () {\r\n        function ColumnWidthsResizer(widths) {\r\n            this.widths = widths;\r\n        }\r\n        ColumnWidthsResizer.prototype.startResize = function (index, x) {\r\n            this.index = index;\r\n            this.startX = x;\r\n            this.startWidth = this.widths.getActual(index) || 0;\r\n            this.minWidth = this.widths.getMin(index) || 0;\r\n        };\r\n        ColumnWidthsResizer.prototype.continueResize = function (x) {\r\n            var dx = x - this.startX;\r\n            // Ensure column width stays greater than its minimum width.\r\n            if (this.startWidth + dx < this.minWidth) {\r\n                dx = this.minWidth - this.startWidth;\r\n            }\r\n            this.widths.setActual(this.index, this.startWidth + dx);\r\n            this.widths.updateTotal();\r\n        };\r\n        return ColumnWidthsResizer;\r\n    })();\r\n    VizPortal.ColumnWidthsResizer = ColumnWidthsResizer;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../ts/FeatureFlags.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var CommonStyles;\r\n    (function (CommonStyles) {\r\n        var Colors;\r\n        (function (Colors) {\r\n            Colors.White = \"rgb(255,255,255)\";\r\n            Colors.Black = \"rgb(0,0,0)\";\r\n            Colors.Grey40 = \"rgb(40,40,40)\";\r\n            Colors.Grey68 = \"rgb(68,68,68)\";\r\n            Colors.Grey89 = \"rgb(89,89,89)\";\r\n            Colors.Grey102 = \"rgb(102,102,102)\";\r\n            Colors.Grey136 = \"rgb(136,136,136)\";\r\n            Colors.Grey153 = \"rgb(153,153,153)\";\r\n            Colors.Grey178 = \"rgb(178,178,178)\";\r\n            Colors.Grey218 = \"rgb(218,218,218)\";\r\n            Colors.Grey224 = \"rgb(224,224,224)\";\r\n            Colors.Grey230 = \"rgb(230,230,230)\";\r\n            Colors.Grey245 = \"rgb(245,245,245)\";\r\n            Colors.Grey250 = \"rgb(250,250,250)\";\r\n            Colors.BlueHighlight = \"rgb(212,225,237)\";\r\n            Colors.BorderColor = Colors.Grey178;\r\n            Colors.GreyTextColor = Colors.Grey153;\r\n            Colors.NormalTextColor = Colors.Grey102;\r\n            Colors.DisabledTextColor = Colors.Grey218;\r\n            Colors.ActionOrange = \"rgb(235,143,80)\";\r\n            Colors.ActionOrangeDark = \"rgb(209,107,54)\";\r\n        })(Colors = CommonStyles.Colors || (CommonStyles.Colors = {}));\r\n        var Sizes;\r\n        (function (Sizes) {\r\n            Sizes.MinSupportedAppWidth = 1000;\r\n            Sizes.TextBoxPadding = 4;\r\n            Sizes.TextBoxBorderSize = 1;\r\n            Sizes.LineWidth = 1;\r\n            Sizes.SmallSpace = 3;\r\n            Sizes.DefaultSpace = 6;\r\n            Sizes.LineHeight = 16;\r\n            Sizes.LargeSpace = 18;\r\n            Sizes.RowHeight = 23;\r\n            Sizes.XLargeSpace = 35;\r\n            Sizes.SmallFontSize = 11;\r\n            Sizes.NormalFontSize = 12;\r\n            Sizes.HeaderFontSize = VizPortal.FeatureFlags.useUpdatedFontStyles ? 13 : 12;\r\n            Sizes.SmallIconSize = 17;\r\n            Sizes.NormalIconSize = 19;\r\n            Sizes.DataGridHeaderHeight = VizPortal.FeatureFlags.useTallerRowHeight ? 37 : Sizes.XLargeSpace;\r\n            Sizes.DropdownOffset = 3; // Dropdown menus appear detached below their buttons by this many pixels\r\n        })(Sizes = CommonStyles.Sizes || (CommonStyles.Sizes = {}));\r\n        var Fonts;\r\n        (function (Fonts) {\r\n            Fonts.BodyFont = VizPortal.FeatureFlags.useUpdatedFontStyles\r\n                ? \"BentonSans-Book, Verdana, Geneva, sans-serif\"\r\n                : \"Verdana, Geneva, sans-serif\";\r\n            Fonts.HeaderFont = VizPortal.FeatureFlags.useUpdatedFontStyles\r\n                ? \"BentonSans-Book, Arial, Verdana, Geneva, sans-serif\"\r\n                : \"Arial, Verdana, Geneva, sans-serif\";\r\n        })(Fonts = CommonStyles.Fonts || (CommonStyles.Fonts = {}));\r\n        var IconUrls;\r\n        (function (IconUrls) {\r\n            IconUrls.Workbook = 'img/workbook_content_type_small.png';\r\n            IconUrls.View = 'img/view_content_type_small.png';\r\n        })(IconUrls = CommonStyles.IconUrls || (CommonStyles.IconUrls = {}));\r\n        var Helpers;\r\n        (function (Helpers) {\r\n            function Edges(distanceToEdge) {\r\n                return {\r\n                    position: 'absolute',\r\n                    left: distanceToEdge,\r\n                    right: distanceToEdge,\r\n                    top: distanceToEdge,\r\n                    bottom: distanceToEdge\r\n                };\r\n            }\r\n            Helpers.Edges = Edges;\r\n        })(Helpers = CommonStyles.Helpers || (CommonStyles.Helpers = {}));\r\n    })(CommonStyles = VizPortalReact.CommonStyles || (VizPortalReact.CommonStyles = {}));\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../FeatureFlags.ts\" />\r\n/// <reference path=\"ColumnWidths.ts\" />\r\n/// <reference path=\"ListLayout.ts\" />\r\n/// <reference path=\"../../common/react/CommonStyles.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var PermissionsPanelLayoutValues;\r\n    (function (PermissionsPanelLayoutValues) {\r\n        // Keep this column width in sync with $permissionsGridCellWidth in permissions.styl,\r\n        // as well as capabilityColumnWidth in permissionsCellTemplates.jade\r\n        PermissionsPanelLayoutValues.CapabilityColumnWidth = 30;\r\n        PermissionsPanelLayoutValues.MinDialogWidth = 703; // the header of the permissions dialog requires at least this much space.\r\n        PermissionsPanelLayoutValues.MinColumnWidthsByField = {\r\n            granteeName: 200,\r\n            permissionRole: 64\r\n        };\r\n        PermissionsPanelLayoutValues.DefaultColumnWidthsByField = {\r\n            granteeName: 200,\r\n            // Wide enough to fit the section header lock text in all languages\r\n            permissionRole: 180\r\n        };\r\n        var ProjectColumnIndices = {\r\n            granteeName: [0],\r\n            permissionRole: [2, 5, 10]\r\n        };\r\n        var NonProjectColumnIndices = {\r\n            granteeName: [0],\r\n            permissionRole: [2]\r\n        };\r\n        PermissionsPanelLayoutValues.ColumnIndicesByContentType = {\r\n            project: ProjectColumnIndices,\r\n            workbook: NonProjectColumnIndices,\r\n            datasource: NonProjectColumnIndices,\r\n            view: NonProjectColumnIndices\r\n        };\r\n    })(PermissionsPanelLayoutValues || (PermissionsPanelLayoutValues = {}));\r\n    function getPermissionsPanelColumnWidths(contentType) {\r\n        if (VizPortal.FeatureFlags.projectPermissionsTemplatesEnabled) {\r\n            return new PermissionsPanelColumnWidthsImpl(contentType, PermissionsPanelLayoutValues.MinColumnWidthsByField, PermissionsPanelLayoutValues.DefaultColumnWidthsByField, PermissionsPanelLayoutValues.ColumnIndicesByContentType, PermissionsPanelLayoutValues.CapabilityColumnWidth, PermissionsPanelLayoutValues.MinDialogWidth);\r\n        }\r\n        else {\r\n            return new PermissionsPanelColumnWidthsDeprecated(contentType);\r\n        }\r\n    }\r\n    VizPortal.getPermissionsPanelColumnWidths = getPermissionsPanelColumnWidths;\r\n    var PermissionsPanelColumnWidthsImpl = (function (_super) {\r\n        __extends(PermissionsPanelColumnWidthsImpl, _super);\r\n        function PermissionsPanelColumnWidthsImpl(contentType, MinColumnWidthsByField, DefaultColumnWidthsByField, ColumnIndicesByContentType, CapabilityColumnWidth, MinDialogWidth) {\r\n            _super.call(this);\r\n            this.contentType = contentType;\r\n            this.MinColumnWidthsByField = MinColumnWidthsByField;\r\n            this.DefaultColumnWidthsByField = DefaultColumnWidthsByField;\r\n            this.ColumnIndicesByContentType = ColumnIndicesByContentType;\r\n            this.CapabilityColumnWidth = CapabilityColumnWidth;\r\n            this.MinDialogWidth = MinDialogWidth;\r\n            var minWidths = this.orderedWidthsFromFieldNames(this.MinColumnWidthsByField);\r\n            this.setMinWidths(minWidths);\r\n        }\r\n        PermissionsPanelColumnWidthsImpl.prototype.orderedWidthsFromFieldNames = function (widthsByField) {\r\n            var widths = [];\r\n            var columnIndices = this.ColumnIndicesByContentType[this.contentType];\r\n            _.each(widthsByField, function (width, fieldName) {\r\n                _.each(columnIndices[fieldName], function (index) {\r\n                    widths[index] = width;\r\n                });\r\n            });\r\n            return widths;\r\n        };\r\n        /**\r\n         * Sets the preferred widths for each field type to the maximum of the measured widths for that\r\n         * field and its default width (overrides superclass method)\r\n         */\r\n        PermissionsPanelColumnWidthsImpl.prototype.setPreferredWidths = function (measuredWidths, containerWidth) {\r\n            var preferredColumnWidths = this.getPreferredColumnWidths(measuredWidths);\r\n            _super.prototype.setPreferredWidths.call(this, preferredColumnWidths, containerWidth);\r\n        };\r\n        PermissionsPanelColumnWidthsImpl.prototype.getPreferredColumnWidths = function (measuredWidths) {\r\n            var _this = this;\r\n            var preferredWidthsByField = {};\r\n            var columnIndicesByField = this.ColumnIndicesByContentType[this.contentType];\r\n            _.each(columnIndicesByField, function (indices, fieldName) {\r\n                var measuredWidthValues = _.map(indices, function (index) { return measuredWidths[index]; });\r\n                var preferredWidth = _.max(measuredWidthValues.concat(_this.DefaultColumnWidthsByField[fieldName]));\r\n                preferredWidthsByField[fieldName] = preferredWidth;\r\n            });\r\n            return this.orderedWidthsFromFieldNames(preferredWidthsByField);\r\n        };\r\n        PermissionsPanelColumnWidthsImpl.prototype.getPermissionsDialogWidth = function (viewportWidth) {\r\n            var widthsByContentType = this.calculatePermissionsDialogWidths();\r\n            var padding = 2 * VizPortalReact.CommonStyles.Sizes.LargeSpace;\r\n            var effectiveViewportWidth = Math.max(viewportWidth, VizPortalReact.CommonStyles.Sizes.MinSupportedAppWidth) - padding;\r\n            return Math.min(Math.max(widthsByContentType[this.contentType], this.MinDialogWidth), effectiveViewportWidth);\r\n        };\r\n        PermissionsPanelColumnWidthsImpl.prototype.calculatePermissionsDialogWidths = function () {\r\n            var capabilitySectionSpacing = 15;\r\n            var scrollBarWidth = 20;\r\n            var fixedColumnsTotalWidth = sum(this.DefaultColumnWidthsByField) + scrollBarWidth;\r\n            return {\r\n                // The project permissions size equals the workbook permissions (the largest section), plus two extra role columns\r\n                project: (14 * this.CapabilityColumnWidth) + (3 * capabilitySectionSpacing) + fixedColumnsTotalWidth +\r\n                    (2 * this.DefaultColumnWidthsByField['permissionRole']),\r\n                workbook: (14 * this.CapabilityColumnWidth) + (3 * capabilitySectionSpacing) + fixedColumnsTotalWidth,\r\n                view: (11 * this.CapabilityColumnWidth) + (3 * capabilitySectionSpacing) + fixedColumnsTotalWidth,\r\n                datasource: (6 * this.CapabilityColumnWidth) + (2 * capabilitySectionSpacing) + fixedColumnsTotalWidth\r\n            };\r\n        };\r\n        return PermissionsPanelColumnWidthsImpl;\r\n    })(VizPortal.ColumnWidths);\r\n    VizPortal.PermissionsPanelColumnWidthsImpl = PermissionsPanelColumnWidthsImpl;\r\n    /**\r\n     * This implementation is for when the feature flag is off. Since it's deprecated, there were/are\r\n     * no unit tests, so it's okay to hardcode the logic inside the class definition.\r\n     */\r\n    var PermissionsPanelColumnWidthsDeprecated = (function (_super) {\r\n        __extends(PermissionsPanelColumnWidthsDeprecated, _super);\r\n        function PermissionsPanelColumnWidthsDeprecated(contentType) {\r\n            _super.call(this);\r\n            this.contentType = contentType;\r\n            this.CapabilityColumnWidth = 28;\r\n            this.MinDialogWidth = 703; // the header of the permissions dialog requires at least this much space.\r\n            this.MinColumnWidths = {\r\n                granteeName: 234,\r\n                permissionRole: 100,\r\n                editRuleButton: this.CapabilityColumnWidth,\r\n                deleteRuleButton: this.CapabilityColumnWidth\r\n            };\r\n            this.setMinWidths(this.getMinColumnWidths());\r\n        }\r\n        PermissionsPanelColumnWidthsDeprecated.prototype.getMinColumnWidths = function () {\r\n            return [\r\n                this.MinColumnWidths.granteeName,\r\n                this.MinColumnWidths.permissionRole,\r\n                this.MinColumnWidths.editRuleButton,\r\n                this.MinColumnWidths.deleteRuleButton\r\n            ];\r\n        };\r\n        PermissionsPanelColumnWidthsDeprecated.prototype.getPermissionsDialogWidth = function (viewportWidth) {\r\n            var widthsByContentType = this.calculatePermissionsDialogWidths();\r\n            return widthsByContentType[this.contentType];\r\n        };\r\n        PermissionsPanelColumnWidthsDeprecated.prototype.calculatePermissionsDialogWidths = function () {\r\n            var capabilitySectionSpacing = 15;\r\n            var scrollBarWidth = 20;\r\n            var fixedColumnsTotalWidth = sum(this.MinColumnWidths) + scrollBarWidth;\r\n            return {\r\n                project: Math.max((16 * this.CapabilityColumnWidth) + (3 * capabilitySectionSpacing) + fixedColumnsTotalWidth, this.MinDialogWidth),\r\n                workbook: Math.max((14 * this.CapabilityColumnWidth) + (3 * capabilitySectionSpacing) + fixedColumnsTotalWidth, this.MinDialogWidth),\r\n                view: Math.max((11 * this.CapabilityColumnWidth) + (3 * capabilitySectionSpacing) + fixedColumnsTotalWidth, this.MinDialogWidth),\r\n                datasource: Math.max((6 * this.CapabilityColumnWidth) + (2 * capabilitySectionSpacing) + fixedColumnsTotalWidth, this.MinDialogWidth)\r\n            };\r\n        };\r\n        return PermissionsPanelColumnWidthsDeprecated;\r\n    })(VizPortal.ColumnWidths);\r\n    function sum(values) {\r\n        return _.reduce(values, function (memo, num) { return memo + num; });\r\n    }\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DateHelpers;\r\n    (function (DateHelpers) {\r\n        function fromISOString(dateString) {\r\n            if (dateString) {\r\n                // ISO 8601 date-time format. both Z and +/-00:00 formats, though the latter is ignored\r\n                var matches = /(\\d\\d\\d\\d)-(\\d\\d)-(\\d\\d)T(\\d\\d):(\\d\\d):(\\d\\d)(?:(?:\\.|,)(\\d\\d\\d))?((Z)|([+-]\\d\\d(:?\\d\\d)?))?/.exec(dateString);\r\n                var year = parseInt(matches[1], 10);\r\n                var month = parseInt(matches[2], 10) - 1;\r\n                var day = parseInt(matches[3], 10);\r\n                var hours = parseInt(matches[4], 10);\r\n                var minutes = parseInt(matches[5], 10);\r\n                var seconds = parseInt(matches[6], 10);\r\n                var milliseconds = matches[7] ? parseInt(matches[7], 10) : null;\r\n                return new Date(Date.UTC(year, month, day, hours, minutes, seconds, milliseconds));\r\n            }\r\n            else {\r\n                return undefined;\r\n            }\r\n        }\r\n        DateHelpers.fromISOString = fromISOString;\r\n        // Serialize to ISO-8601 format\r\n        // Implementation based on https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/toISOString\r\n        function toISOString(date) {\r\n            if (!date) {\r\n                return undefined;\r\n            }\r\n            function pad(number) {\r\n                if (number < 10) {\r\n                    return '0' + number;\r\n                }\r\n                return '' + number;\r\n            }\r\n            return date.getUTCFullYear() +\r\n                '-' + pad(date.getUTCMonth() + 1) +\r\n                '-' + pad(date.getUTCDate()) +\r\n                'T' + pad(date.getUTCHours()) +\r\n                ':' + pad(date.getUTCMinutes()) +\r\n                ':' + pad(date.getUTCSeconds()) +\r\n                '.' + (date.getUTCMilliseconds() / 1000).toFixed(3).slice(2, 5) +\r\n                'Z';\r\n        }\r\n        DateHelpers.toISOString = toISOString;\r\n        function midnight(date) {\r\n            return new Date(date.getFullYear(), date.getMonth(), date.getDate(), 0, 0, 0, 0);\r\n        }\r\n        DateHelpers.midnight = midnight;\r\n        function endOfDay(date) {\r\n            return new Date(date.getFullYear(), date.getMonth(), date.getDate(), 23, 59, 59, 999);\r\n        }\r\n        DateHelpers.endOfDay = endOfDay;\r\n    })(DateHelpers = VizPortal.DateHelpers || (VizPortal.DateHelpers = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/DateHelpers.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var MapperHelper;\r\n    (function (MapperHelper) {\r\n        function toNumber(value) {\r\n            // Return numbers and null/undefined without conversion\r\n            if (_.isNumber(value) || _.isNull(value) || _.isUndefined(value))\r\n                return value;\r\n            // Otherwise, attempt to parse the value\r\n            return parseInt(value, 10);\r\n        }\r\n        MapperHelper.toNumber = toNumber;\r\n        function toDate(value) {\r\n            return VizPortal.DateHelpers.fromISOString(value);\r\n        }\r\n        MapperHelper.toDate = toDate;\r\n        function arrayToMap(values) {\r\n            return _.object(values, values);\r\n        }\r\n        MapperHelper.arrayToMap = arrayToMap;\r\n        function sortTags(tags) {\r\n            return _(tags).sortBy(function (tagName) { return tagName.toLowerCase(); });\r\n        }\r\n        MapperHelper.sortTags = sortTags;\r\n    })(MapperHelper = VizPortal.MapperHelper || (VizPortal.MapperHelper = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/resourceInfoParts.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"MapperHelper.ts\" />\r\n/// <reference path=\"../models/IExtractTaskInfo.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var AlertListMapper;\r\n    (function (AlertListMapper) {\r\n        var M = VizPortal.MapperHelper;\r\n        function map(total, alerts, workbooks, datasources) {\r\n            return {\r\n                total: total,\r\n                alerts: _.map(alerts, function (alert) {\r\n                    return {\r\n                        id: alert.id,\r\n                        statusCode: M.toNumber(alert.statusCode),\r\n                        taskId: alert.taskId,\r\n                        mostRecentFailureAt: M.toDate(alert.mostRecentFailureAt),\r\n                        lastSuccessAt: M.toDate(alert.lastSuccessAt),\r\n                        workbooks: _.map(alert.affectedWorkbookIds, function (id) { return workbooks[id]; }),\r\n                        datasource: datasources[alert.datasourceId],\r\n                        alertType: alert.alertType,\r\n                        suspended: alert.suspended,\r\n                        consecutiveFailureCount: alert.consecutiveFailureCount\r\n                    };\r\n                })\r\n            };\r\n        }\r\n        AlertListMapper.map = map;\r\n    })(AlertListMapper = VizPortal.AlertListMapper || (VizPortal.AlertListMapper = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/resourceInfoParts.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"resourceParts.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"MapperHelper.ts\" />\r\n/// <reference path=\"../models/ICommentInfo.ts\" />\r\n/// <reference path=\"../ServerApi/types/IComment.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var CommentMapper;\r\n    (function (CommentMapper) {\r\n        var M = VizPortal.MapperHelper;\r\n        function map(comments, users) {\r\n            return _.map(comments, function (comment) {\r\n                return {\r\n                    id: comment.id,\r\n                    text: comment.text,\r\n                    owner: users[comment.ownerId],\r\n                    createdAt: M.toDate(comment.createdAt),\r\n                    updatedAt: M.toDate(comment.updatedAt)\r\n                };\r\n            });\r\n        }\r\n        CommentMapper.map = map;\r\n    })(CommentMapper = VizPortal.CommentMapper || (VizPortal.CommentMapper = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"MapperHelper.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DatasourceMapper;\r\n    (function (DatasourceMapper) {\r\n        var M = VizPortal.MapperHelper;\r\n        function map(serverApiDatasources, users, projects, workbooks, favoriteDatasources) {\r\n            if (projects === void 0) { projects = {}; }\r\n            if (workbooks === void 0) { workbooks = {}; }\r\n            if (favoriteDatasources === void 0) { favoriteDatasources = {}; }\r\n            return _.map(serverApiDatasources, function (ds) {\r\n                return {\r\n                    downloadUrl: ds.downloadUrl,\r\n                    favorite: !!favoriteDatasources[ds.id],\r\n                    hasExtracts: ds.hasExtracts,\r\n                    hasAlert: ds.hasAlert,\r\n                    hasIncrementalExtract: ds.hasIncrementalExtract,\r\n                    lastRefreshedAt: M.toDate(ds.lastRefreshedAt),\r\n                    id: ds.id,\r\n                    name: ds.name,\r\n                    owner: users[ds.ownerId],\r\n                    project: projects[ds.projectId],\r\n                    updatedAt: M.toDate(ds.updatedAt),\r\n                    tags: M.sortTags(ds.tags),\r\n                    refreshMode: ds.refreshMode,\r\n                    remoteAgentName: ds.remoteAgentName,\r\n                    remoteRunNextAt: ds.remoteRunNextAt,\r\n                    connectionType: ds.connectionType,\r\n                    connectionTypeDisplayName: ds.connectionTypeDisplayName,\r\n                    connectionDetails: mapConnectionDetails(ds.connectionDetails),\r\n                    connectionTypeEditable: ds.connectionTypeEditable,\r\n                    connectionOAuth: ds.connectionOAuth,\r\n                    workbook: workbooks[ds.workbookId]\r\n                };\r\n            });\r\n        }\r\n        DatasourceMapper.map = map;\r\n        function mapDetail(ds) {\r\n            var owner = VizPortal.UserMapper.mapOne(ds.owner);\r\n            var project = VizPortal.ProjectMapper.mapName(ds.project);\r\n            var dsInfo = {\r\n                createdAt: M.toDate(ds.createdAt),\r\n                description: ds.description,\r\n                downloadUrl: ds.downloadUrl,\r\n                favorite: ds.favorite,\r\n                hasExtracts: ds.hasExtracts,\r\n                hasAlert: ds.hasAlert,\r\n                hasIncrementalExtract: ds.hasIncrementalExtract,\r\n                lastRefreshedAt: M.toDate(ds.lastRefreshedAt),\r\n                id: ds.id,\r\n                name: ds.name,\r\n                tags: M.sortTags(ds.tags),\r\n                updatedAt: M.toDate(ds.updatedAt),\r\n                newWorkbookUrl: ds.newWorkbookUrl,\r\n                refreshMode: ds.refreshMode,\r\n                remoteAgentName: ds.remoteAgentName,\r\n                remoteRunNextAt: ds.remoteRunNextAt,\r\n                connectionType: ds.connectionType,\r\n                connectionTypeDisplayName: ds.connectionTypeDisplayName,\r\n                connectionDetails: mapConnectionDetails(ds.connectionDetails),\r\n                connectionTypeEditable: ds.connectionTypeEditable,\r\n                connectionOAuth: ds.connectionOAuth,\r\n                owner: owner,\r\n                project: project\r\n            };\r\n            if (ds.workbook)\r\n                dsInfo.workbook = VizPortal.WorkbookMapper.mapOne(ds.workbook, owner, project);\r\n            return dsInfo;\r\n        }\r\n        DatasourceMapper.mapDetail = mapDetail;\r\n        var BASENAME_REGEXP = /[/\\\\]([^/\\\\]*)$/;\r\n        var filePathToBasename = function (file) {\r\n            var basenameMatch = file && file.match(BASENAME_REGEXP);\r\n            return basenameMatch ? basenameMatch[1] : file;\r\n        };\r\n        function mapConnectionDetails(serverConnectionDetails) {\r\n            var connectionDetails = _.clone(serverConnectionDetails);\r\n            // BUGZID 148921: The server sends the full file path but client should only display the file base name\r\n            if (connectionDetails.type === VizPortal.ServerApi.ConnectionDetailType.File) {\r\n                var fileConnectionDetails = connectionDetails; //Used for type safety\r\n                fileConnectionDetails.fileName = filePathToBasename(fileConnectionDetails.fileName);\r\n            }\r\n            return connectionDetails;\r\n        }\r\n    })(DatasourceMapper = VizPortal.DatasourceMapper || (VizPortal.DatasourceMapper = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"MapperHelper.ts\" />\r\n/// <reference path=\"../models/IExtractTaskInfo.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ExtractTaskMapper;\r\n    (function (ExtractTaskMapper) {\r\n        var M = VizPortal.MapperHelper;\r\n        function map(dcs, schedule, site, workbooks, datasources) {\r\n            return _.map(dcs, function (et) {\r\n                var targetWorkbook = et.targetType === VizPortal.ServerApi.ExtractTaskTargetType.Workbook ? workbooks[et.targetId] : undefined;\r\n                var targetDatasource = et.targetType === VizPortal.ServerApi.ExtractTaskTargetType.Datasource ? datasources[et.targetId] : undefined;\r\n                return {\r\n                    id: et.id,\r\n                    priority: et.priority,\r\n                    type: et.type,\r\n                    lastRunAt: M.toDate(et.lastRunAt),\r\n                    runNextAt: M.toDate(et.runNextAt),\r\n                    schedule: schedule[et.scheduleId],\r\n                    site: site[et.siteId],\r\n                    workbook: targetWorkbook,\r\n                    datasource: targetDatasource\r\n                };\r\n            });\r\n        }\r\n        ExtractTaskMapper.map = map;\r\n    })(ExtractTaskMapper = VizPortal.ExtractTaskMapper || (VizPortal.ExtractTaskMapper = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"MapperHelper.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ProjectMapper;\r\n    (function (ProjectMapper) {\r\n        var M = VizPortal.MapperHelper;\r\n        function map(serverApiProjects, users) {\r\n            return _.map(serverApiProjects, function (p) { return mapOne(p, users[p.ownerId]); });\r\n        }\r\n        ProjectMapper.map = map;\r\n        function mapOne(p, owner) {\r\n            return {\r\n                createdAt: M.toDate(p.createdAt),\r\n                datasourceCount: M.toNumber(p.datasourceCount),\r\n                description: p.description,\r\n                id: p.id,\r\n                name: p.name,\r\n                owner: owner,\r\n                viewCount: M.toNumber(p.viewCount),\r\n                workbookCount: M.toNumber(p.workbookCount),\r\n                controlledPermissionsEnabled: p.controlledPermissionsEnabled\r\n            };\r\n        }\r\n        ProjectMapper.mapOne = mapOne;\r\n        function mapDetail(p) {\r\n            return {\r\n                createdAt: M.toDate(p.createdAt),\r\n                description: p.description,\r\n                id: p.id,\r\n                name: p.name,\r\n                owner: VizPortal.UserMapper.mapOne(p.owner),\r\n                controlledPermissionsEnabled: p.controlledPermissionsEnabled\r\n            };\r\n        }\r\n        ProjectMapper.mapDetail = mapDetail;\r\n        function mapName(p) {\r\n            return {\r\n                id: p.id,\r\n                name: p.name\r\n            };\r\n        }\r\n        ProjectMapper.mapName = mapName;\r\n        function mapNames(serverApiProjects) {\r\n            return _.map(serverApiProjects, mapName);\r\n        }\r\n        ProjectMapper.mapNames = mapNames;\r\n    })(ProjectMapper = VizPortal.ProjectMapper || (VizPortal.ProjectMapper = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"MapperHelper.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var RemoteRefreshAgentMapper;\r\n    (function (RemoteRefreshAgentMapper) {\r\n        var M = VizPortal.MapperHelper;\r\n        function mapToResource(agents) {\r\n            return _.map(agents, function (agent) {\r\n                var content = new VizPortal.Set(function (item) { return item.id; });\r\n                content.addItems(agent.content);\r\n                return {\r\n                    id: agent.id,\r\n                    name: agent.name,\r\n                    ownerId: agent.ownerId,\r\n                    content: content\r\n                };\r\n            });\r\n        }\r\n        RemoteRefreshAgentMapper.mapToResource = mapToResource;\r\n    })(RemoteRefreshAgentMapper = VizPortal.RemoteRefreshAgentMapper || (VizPortal.RemoteRefreshAgentMapper = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/resourceInfoParts.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/DateHelpers.ts\" />\r\n/// <reference path=\"../models/IRemoteRefreshScheduleInfo.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var RemoteRefreshScheduleMapper;\r\n    (function (RemoteRefreshScheduleMapper) {\r\n        var dateHelpers = VizPortal.DateHelpers;\r\n        function mapToResource(schedules) {\r\n            return _.map(schedules, function (schedule) {\r\n                return {\r\n                    definition: schedule.definition,\r\n                    refreshType: schedule.refreshType,\r\n                    runNextAt: schedule.runNextAt,\r\n                    lastRunAt: schedule.lastRunAt\r\n                };\r\n            });\r\n        }\r\n        RemoteRefreshScheduleMapper.mapToResource = mapToResource;\r\n        function mapToApi(schedules) {\r\n            var _this = this;\r\n            return _.map(schedules, function (schedule) {\r\n                return _this.mapSingleToApi(schedule);\r\n            });\r\n        }\r\n        RemoteRefreshScheduleMapper.mapToApi = mapToApi;\r\n        function mapSingleToApi(schedule) {\r\n            return {\r\n                definition: schedule.definition,\r\n                refreshType: schedule.refreshType\r\n            };\r\n        }\r\n        RemoteRefreshScheduleMapper.mapSingleToApi = mapSingleToApi;\r\n    })(RemoteRefreshScheduleMapper = VizPortal.RemoteRefreshScheduleMapper || (VizPortal.RemoteRefreshScheduleMapper = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/resourceInfoParts.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.SubscriptionTargetTypes = {\r\n        view: 'view',\r\n        workbook: 'workbook'\r\n    };\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"MapperHelper.ts\" />\r\n/// <reference path=\"../models/ISubscriptionInfo.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SubscriptionMapper;\r\n    (function (SubscriptionMapper) {\r\n        var M = VizPortal.MapperHelper;\r\n        function map(subscriptions, schedules, sites, users) {\r\n            return _.map(subscriptions, function (sub) {\r\n                return {\r\n                    id: sub.id,\r\n                    subject: sub.subject,\r\n                    targetId: sub.targetId,\r\n                    targetName: sub.targetName,\r\n                    targetType: sub.targetType.toLowerCase(),\r\n                    targetPath: sub.targetPath,\r\n                    lastSentAt: M.toDate(sub.lastSentAt),\r\n                    runNextAt: M.toDate(sub.runNextAt),\r\n                    schedule: schedules[sub.scheduleId],\r\n                    site: sites[sub.siteId],\r\n                    user: users[sub.userId]\r\n                };\r\n            });\r\n        }\r\n        SubscriptionMapper.map = map;\r\n    })(SubscriptionMapper = VizPortal.SubscriptionMapper || (VizPortal.SubscriptionMapper = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var UserMapper;\r\n    (function (UserMapper) {\r\n        function map(serverApiUsers) {\r\n            return _.map(serverApiUsers, mapOne);\r\n        }\r\n        UserMapper.map = map;\r\n        function mapOne(u) {\r\n            return {\r\n                id: u.id,\r\n                authId: u.authId,\r\n                displayName: u.displayName,\r\n                username: u.username,\r\n                domainName: u.domainName,\r\n                readOnly: u.readOnly\r\n            };\r\n        }\r\n        UserMapper.mapOne = mapOne;\r\n    })(UserMapper = VizPortal.UserMapper || (VizPortal.UserMapper = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"MapperHelper.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ViewMapper;\r\n    (function (ViewMapper) {\r\n        var M = VizPortal.MapperHelper;\r\n        function map(serverApiViews, workbooks, favoriteViews) {\r\n            if (favoriteViews === void 0) { favoriteViews = {}; }\r\n            return _.map(serverApiViews, function (v) {\r\n                return {\r\n                    favorite: !!favoriteViews[v.id],\r\n                    id: v.id,\r\n                    index: M.toNumber(v.index),\r\n                    name: v.name,\r\n                    path: v.path,\r\n                    tags: M.sortTags(v.tags),\r\n                    thumbnailUrl: v.thumbnailUrl,\r\n                    updatedAt: M.toDate(v.updatedAt),\r\n                    workbook: workbooks[v.workbookId],\r\n                    hitsTotal: v.hitsTotal,\r\n                    favoritesTotal: v.favoritesTotal\r\n                };\r\n            });\r\n        }\r\n        ViewMapper.map = map;\r\n        function mapDetail(v) {\r\n            return {\r\n                createdAt: M.toDate(v.createdAt),\r\n                favorite: v.favorite,\r\n                id: v.id,\r\n                index: M.toNumber(v.index),\r\n                name: v.name,\r\n                path: v.path,\r\n                tags: M.sortTags(v.tags),\r\n                thumbnailUrl: v.thumbnailUrl,\r\n                updatedAt: M.toDate(v.updatedAt),\r\n                editUrl: v.editUrl,\r\n                workbook: VizPortal.WorkbookMapper.mapParent(v.workbook, VizPortal.UserMapper.mapOne(v.owner), VizPortal.ProjectMapper.mapName(v.project))\r\n            };\r\n        }\r\n        ViewMapper.mapDetail = mapDetail;\r\n    })(ViewMapper = VizPortal.ViewMapper || (VizPortal.ViewMapper = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"MapperHelper.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var WorkbookMapper;\r\n    (function (WorkbookMapper) {\r\n        var M = VizPortal.MapperHelper;\r\n        function map(serverApiWorkbooks, users, projects, workbooksStatisticsMax, favoriteWorkbooks) {\r\n            if (favoriteWorkbooks === void 0) { favoriteWorkbooks = {}; }\r\n            return _.map(serverApiWorkbooks, function (w) {\r\n                return mapOne(w, users[w.ownerId], projects[w.projectId], workbooksStatisticsMax, !!favoriteWorkbooks[w.id]);\r\n            });\r\n        }\r\n        WorkbookMapper.map = map;\r\n        function mapOne(w, owner, project, workbooksStatisticsMax, favorite) {\r\n            return {\r\n                defaultViewId: w.defaultViewId,\r\n                displayTabs: w.displayTabs,\r\n                downloadUrl: w.downloadUrl,\r\n                favorite: favorite,\r\n                id: w.id,\r\n                name: w.name,\r\n                numSheets: M.toNumber(w.sheetCount),\r\n                owner: owner,\r\n                project: project,\r\n                repositoryUrl: w.repositoryUrl,\r\n                size: M.toNumber(w.size),\r\n                tags: M.sortTags(w.tags),\r\n                thumbnailUrl: w.thumbnailUrl,\r\n                updatedAt: M.toDate(w.updatedAt),\r\n                hasAlert: w.hasAlert,\r\n                hasExtracts: w.hasExtracts,\r\n                hasIncrementalExtract: w.hasIncrementalExtract,\r\n                hitsTotal: w.hitsTotal,\r\n                hitsLastTwoWeeksTotal: w.hitsLastTwoWeeksTotal,\r\n                favoritesTotal: w.favoritesTotal,\r\n                maxStatValues: workbooksStatisticsMax\r\n            };\r\n        }\r\n        WorkbookMapper.mapOne = mapOne;\r\n        function mapDetail(w) {\r\n            return {\r\n                createdAt: M.toDate(w.createdAt),\r\n                description: w.description,\r\n                displayTabs: w.displayTabs,\r\n                downloadUrl: w.downloadUrl,\r\n                favorite: w.favorite,\r\n                id: w.id,\r\n                name: w.name,\r\n                owner: VizPortal.UserMapper.mapOne(w.owner),\r\n                project: VizPortal.ProjectMapper.mapName(w.project),\r\n                size: M.toNumber(w.size),\r\n                tags: M.sortTags(w.tags),\r\n                thumbnailUrl: w.thumbnailUrl,\r\n                updatedAt: M.toDate(w.updatedAt),\r\n                editUrl: w.editUrl,\r\n                hasAlert: w.hasAlert,\r\n                hasExtracts: w.hasExtracts,\r\n                hasIncrementalExtract: w.hasIncrementalExtract,\r\n                hitsTimeSeries: w.hitsTimeSeries\r\n            };\r\n        }\r\n        WorkbookMapper.mapDetail = mapDetail;\r\n        function mapParents(serverApiWorkbooks, users, projects, favoriteWorkbooks) {\r\n            if (projects === void 0) { projects = {}; }\r\n            if (favoriteWorkbooks === void 0) { favoriteWorkbooks = {}; }\r\n            return _.map(serverApiWorkbooks, function (w) {\r\n                return mapParent(w, users[w.ownerId], projects[w.projectId], !!favoriteWorkbooks[w.id]);\r\n            });\r\n        }\r\n        WorkbookMapper.mapParents = mapParents;\r\n        function mapParent(w, owner, project, favorite) {\r\n            return {\r\n                favorite: favorite,\r\n                id: w.id,\r\n                name: w.name,\r\n                numSheets: M.toNumber(w.sheetCount),\r\n                displayTabs: w.displayTabs,\r\n                owner: owner,\r\n                project: project\r\n            };\r\n        }\r\n        WorkbookMapper.mapParent = mapParent;\r\n    })(WorkbookMapper = VizPortal.WorkbookMapper || (VizPortal.WorkbookMapper = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/resourceInfoParts.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/resourceInfoParts.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/resourceInfoParts.ts\" />\r\n/// <reference path=\"../models/IRemoteRefreshPropertiesInfo.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/resourceInfoParts.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/resourceInfoParts.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/IWorkbookInfo.ts\" />\r\n/// <reference path=\"../models/resourceInfoParts.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetCommentsRequest = (function (_super) {\r\n            __extends(GetCommentsRequest, _super);\r\n            function GetCommentsRequest(params) {\r\n                _super.call(this, 'getComments', params);\r\n            }\r\n            return GetCommentsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetCommentsRequest = GetCommentsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        //TODO Figure out a way to remove the dependency on this variable and then remove it\r\n        ServerApi.DataConnectionTypeKeys = {\r\n            connectionTypeDisplayName: 'connectionTypeDisplayName',\r\n            connectionType: 'connectionType'\r\n        };\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"IDataConnectionType.ts\" />\r\n/// <reference path=\"resourceParts.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        ServerApi.ConnectionDetailType = {\r\n            Database: 'database',\r\n            TableauServer: 'tableauserver',\r\n            File: 'file'\r\n        };\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"resourceParts.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        //TODO Figure out a way to remove the dependency on this variable and then remove it\r\n        ServerApi.ProjectKeys = ServerApi.NamedItemKeys;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/IDataSource.ts\" />\r\n/// <reference path=\"../types/IGetItemsParams.ts\" />\r\n/// <reference path=\"../types/IGetItemsResult.ts\" />\r\n/// <reference path=\"../types/IProject.ts\" />\r\n/// <reference path=\"../types/IUser.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetDatasourcesRequest = (function (_super) {\r\n            __extends(GetDatasourcesRequest, _super);\r\n            function GetDatasourcesRequest(params) {\r\n                _super.call(this, 'getDatasources', params);\r\n            }\r\n            return GetDatasourcesRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetDatasourcesRequest = GetDatasourcesRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/IGetItemsParams.ts\" />\r\n/// <reference path=\"../types/IGetItemsResult.ts\" />\r\n/// <reference path=\"../types/IProject.ts\" />\r\n/// <reference path=\"../types/IUser.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetProjectsRequest = (function (_super) {\r\n            __extends(GetProjectsRequest, _super);\r\n            function GetProjectsRequest(params) {\r\n                _super.call(this, 'getProjects', params);\r\n            }\r\n            return GetProjectsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetProjectsRequest = GetProjectsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/IGetItemsParams.ts\" />\r\n/// <reference path=\"../types/IGetItemsResult.ts\" />\r\n/// <reference path=\"../types/IUser.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetUsersRequest = (function (_super) {\r\n            __extends(GetUsersRequest, _super);\r\n            function GetUsersRequest(params) {\r\n                _super.call(this, 'getUsers', params);\r\n            }\r\n            return GetUsersRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetUsersRequest = GetUsersRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"resourceParts.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"resourceParts.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/IGetItemsParams.ts\" />\r\n/// <reference path=\"../types/IGetItemsResult.ts\" />\r\n/// <reference path=\"../types/IProject.ts\" />\r\n/// <reference path=\"../types/IUser.ts\" />\r\n/// <reference path=\"../types/IView.ts\" />\r\n/// <reference path=\"../types/IWorkbook.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetViewsRequest = (function (_super) {\r\n            __extends(GetViewsRequest, _super);\r\n            function GetViewsRequest(params) {\r\n                _super.call(this, 'getViews', params);\r\n            }\r\n            return GetViewsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetViewsRequest = GetViewsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/IGetItemsParams.ts\" />\r\n/// <reference path=\"../types/IGetItemsResult.ts\" />\r\n/// <reference path=\"../types/IProject.ts\" />\r\n/// <reference path=\"../types/IUser.ts\" />\r\n/// <reference path=\"../types/IWorkbook.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetWorkbooksRequest = (function (_super) {\r\n            __extends(GetWorkbooksRequest, _super);\r\n            function GetWorkbooksRequest(params) {\r\n                _super.call(this, 'getWorkbooks', params);\r\n            }\r\n            return GetWorkbooksRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetWorkbooksRequest = GetWorkbooksRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        ServerApi.RefreshModeTypes = {\r\n            Server: 'Server',\r\n            Remote: 'Remote' // data is refreshed by an end-user's computer\r\n        };\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../mappers/AlertMapper.ts\" />\r\n/// <reference path=\"../mappers/CommentMapper.ts\" />\r\n/// <reference path=\"../mappers/DatasourceMapper.ts\" />\r\n/// <reference path=\"../mappers/ExtractTaskMapper.ts\" />\r\n/// <reference path=\"../mappers/ProjectMapper.ts\" />\r\n/// <reference path=\"../mappers/RemoteRefreshAgentMapper.ts\" />\r\n/// <reference path=\"../mappers/RemoteRefreshScheduleMapper.ts\" />\r\n/// <reference path=\"../mappers/SubscriptionMapper.ts\" />\r\n/// <reference path=\"../mappers/UserMapper.ts\" />\r\n/// <reference path=\"../mappers/ViewMapper.ts\" />\r\n/// <reference path=\"../mappers/WorkbookMapper.ts\" />\r\n/// <reference path=\"../models/IAlertInfo.ts\" />\r\n/// <reference path=\"../models/IDataSourceInfo.ts\" />\r\n/// <reference path=\"../models/IRemoteRefreshAgentInfo.ts\" />\r\n/// <reference path=\"../models/IUserInfo.ts\" />\r\n/// <reference path=\"../models/IViewInfo.ts\" />\r\n/// <reference path=\"../models/IWorkbookInfo.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetCommentsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetDatasourcesRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetProjectsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetUsersRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetViewsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetWorkbooksRequest.ts\" />\r\n/// <reference path=\"../ServerApi/types/IDataSource.ts\" />\r\n/// <reference path=\"../ServerApi/types/IProject.ts\" />\r\n/// <reference path=\"../ServerApi/types/IRemoteRefreshProperties.ts\" />\r\n/// <reference path=\"../ServerApi/types/IUser.ts\" />\r\n/// <reference path=\"../ServerApi/types/IView.ts\" />\r\n/// <reference path=\"../ServerApi/types/IWorkbook.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApiMapper;\r\n    (function (ServerApiMapper) {\r\n        function projects(projectResult) {\r\n            if (!projectResult.projects || projectResult.projects.length <= 0)\r\n                return [];\r\n            var users = index(VizPortal.UserMapper.map(projectResult.users));\r\n            return VizPortal.ProjectMapper.map(projectResult.projects, users);\r\n        }\r\n        ServerApiMapper.projects = projects;\r\n        function dataSources(dataSourcesResult) {\r\n            if (!dataSourcesResult.datasources || dataSourcesResult.datasources.length <= 0)\r\n                return [];\r\n            var users = index(VizPortal.UserMapper.map(dataSourcesResult.users));\r\n            var projects = index(VizPortal.ProjectMapper.mapNames(dataSourcesResult.projects));\r\n            var workbooks = index(VizPortal.WorkbookMapper.map(dataSourcesResult.workbooks, users, projects));\r\n            return VizPortal.DatasourceMapper.map(dataSourcesResult.datasources, users, projects, workbooks, favorites(dataSourcesResult.favorites));\r\n        }\r\n        ServerApiMapper.dataSources = dataSources;\r\n        function workbooks(workbooksResult) {\r\n            if (!workbooksResult.workbooks || workbooksResult.workbooks.length <= 0)\r\n                return [];\r\n            var users = index(VizPortal.UserMapper.map(workbooksResult.users));\r\n            var projects = index(VizPortal.ProjectMapper.mapNames(workbooksResult.projects));\r\n            return VizPortal.WorkbookMapper.map(workbooksResult.workbooks, users, projects, workbooksResult.stats, favorites(workbooksResult.favorites));\r\n        }\r\n        ServerApiMapper.workbooks = workbooks;\r\n        function views(viewResult) {\r\n            if (!viewResult.views || viewResult.views.length <= 0)\r\n                return [];\r\n            var users = index(VizPortal.UserMapper.map(viewResult.users));\r\n            var projects = index(VizPortal.ProjectMapper.mapNames(viewResult.projects));\r\n            var workbooks = index(VizPortal.WorkbookMapper.mapParents(viewResult.workbooks, users, projects));\r\n            return VizPortal.ViewMapper.map(viewResult.views, workbooks, favorites(viewResult.favorites));\r\n        }\r\n        ServerApiMapper.views = views;\r\n        function alertList(alertList) {\r\n            if (!(alertList && alertList.alerts && alertList.alerts.length > 0))\r\n                return { total: 0, alerts: [] };\r\n            var workbooks = index(alertList.workbooks);\r\n            var datasources = index(alertList.datasources);\r\n            return VizPortal.AlertListMapper.map(alertList.totalCount, alertList.alerts, workbooks, datasources);\r\n        }\r\n        ServerApiMapper.alertList = alertList;\r\n        function comments(commentResult) {\r\n            if (_.size(commentResult.comments) <= 0)\r\n                return [];\r\n            var users = index(commentResult.users);\r\n            return VizPortal.CommentMapper.map(commentResult.comments, users);\r\n        }\r\n        ServerApiMapper.comments = comments;\r\n        function extractTasks(extractTaskResult) {\r\n            if (_.size(extractTaskResult.tasks) <= 0)\r\n                return [];\r\n            var schedules = index(extractTaskResult.schedules);\r\n            var sites = index(extractTaskResult.sites);\r\n            var workbooks = index(extractTaskResult.workbooks);\r\n            var datasources = index(extractTaskResult.datasources);\r\n            return VizPortal.ExtractTaskMapper.map(extractTaskResult.tasks, schedules, sites, workbooks, datasources);\r\n        }\r\n        ServerApiMapper.extractTasks = extractTasks;\r\n        function remoteRefreshSchedules(remoteRefreshSchedulesResult) {\r\n            if (_.size(remoteRefreshSchedulesResult.schedules) <= 0)\r\n                return [];\r\n            return VizPortal.RemoteRefreshScheduleMapper.mapToResource(remoteRefreshSchedulesResult.schedules);\r\n        }\r\n        ServerApiMapper.remoteRefreshSchedules = remoteRefreshSchedules;\r\n        function remoteRefreshAgents(remoteRefreshAgentsResult) {\r\n            if (_.size(remoteRefreshAgentsResult.agents) <= 0)\r\n                return [];\r\n            return VizPortal.RemoteRefreshAgentMapper.mapToResource(remoteRefreshAgentsResult.agents);\r\n        }\r\n        ServerApiMapper.remoteRefreshAgents = remoteRefreshAgents;\r\n        function subscriptions(subscriptionResult) {\r\n            if (_.size(subscriptionResult.subscriptions) <= 0)\r\n                return [];\r\n            return VizPortal.SubscriptionMapper.map(subscriptionResult.subscriptions, index(subscriptionResult.schedules), index(subscriptionResult.sites), index(subscriptionResult.users));\r\n        }\r\n        ServerApiMapper.subscriptions = subscriptions;\r\n        function fieldValues(fieldValueResult) {\r\n            return fieldValueResult.fieldValues;\r\n        }\r\n        ServerApiMapper.fieldValues = fieldValues;\r\n        function favorites(ids) {\r\n            return _.indexBy(ids, _.identity);\r\n        }\r\n        function index(items) {\r\n            return _.indexBy(items, VizPortal.NamedItemInfoKeys.id);\r\n        }\r\n    })(ServerApiMapper = VizPortal.ServerApiMapper || (VizPortal.ServerApiMapper = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var AddTagsToWorkbooksRequest = (function (_super) {\r\n            __extends(AddTagsToWorkbooksRequest, _super);\r\n            function AddTagsToWorkbooksRequest(ids, tags) {\r\n                _super.call(this, 'addTagsToWorkbooks', {\r\n                    ids: ids,\r\n                    tags: tags\r\n                });\r\n            }\r\n            return AddTagsToWorkbooksRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.AddTagsToWorkbooksRequest = AddTagsToWorkbooksRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"resourceParts.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        ServerApi.ExtractTaskTargetType = {\r\n            Workbook: 'Workbook',\r\n            Datasource: 'Datasource'\r\n        };\r\n        ServerApi.ExtractTaskType = {\r\n            RefreshExtract: 'RefreshExtract',\r\n            IncrementExtract: 'IncrementExtract'\r\n        };\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/IExtractTask.ts\" />\r\n/// <reference path=\"../types/IResponse.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var CreateExtractTasksRequest = (function (_super) {\r\n            __extends(CreateExtractTasksRequest, _super);\r\n            function CreateExtractTasksRequest(params) {\r\n                _super.call(this, 'createExtractTasks', params);\r\n            }\r\n            return CreateExtractTasksRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.CreateExtractTasksRequest = CreateExtractTasksRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var DeleteWorkbooksRequest = (function (_super) {\r\n            __extends(DeleteWorkbooksRequest, _super);\r\n            function DeleteWorkbooksRequest(ids) {\r\n                _super.call(this, 'deleteWorkbooks', { ids: ids });\r\n            }\r\n            return DeleteWorkbooksRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.DeleteWorkbooksRequest = DeleteWorkbooksRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"actionNames.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\n/// <reference path=\"../types/IWorkbookActions.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetWorkbookActionsRequest = (function (_super) {\r\n            __extends(GetWorkbookActionsRequest, _super);\r\n            function GetWorkbookActionsRequest(id) {\r\n                _super.call(this, 'getWorkbookActions', { id: id });\r\n            }\r\n            return GetWorkbookActionsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetWorkbookActionsRequest = GetWorkbookActionsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        ServerApi.RecentlyViewedObjectType = {\r\n            View: 'view',\r\n            Workbook: 'workbook'\r\n        };\r\n        var MarkRecentlyViewedRequest = (function (_super) {\r\n            __extends(MarkRecentlyViewedRequest, _super);\r\n            function MarkRecentlyViewedRequest(params) {\r\n                _super.call(this, 'markRecentlyViewed', params);\r\n            }\r\n            return MarkRecentlyViewedRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.MarkRecentlyViewedRequest = MarkRecentlyViewedRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\"/>\r\n/// <reference path=\"../types/IMoveToProjectParams.ts\"/>\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var MoveWorkbooksToProjectRequest = (function (_super) {\r\n            __extends(MoveWorkbooksToProjectRequest, _super);\r\n            function MoveWorkbooksToProjectRequest(params) {\r\n                _super.call(this, 'moveWorkbooksToProject', params);\r\n            }\r\n            return MoveWorkbooksToProjectRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.MoveWorkbooksToProjectRequest = MoveWorkbooksToProjectRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var RemoveTagsFromWorkbooksRequest = (function (_super) {\r\n            __extends(RemoveTagsFromWorkbooksRequest, _super);\r\n            function RemoveTagsFromWorkbooksRequest(ids, tags) {\r\n                // The server returns quoted tags unquoted.  This re-adds the double quotes if needed\r\n                var tagsList = _.map(tags, function (tag) { return VizPortal.TagsHelper.quote(tag); });\r\n                _super.call(this, 'removeTagsFromWorkbooks', {\r\n                    ids: ids,\r\n                    tags: tagsList\r\n                });\r\n            }\r\n            return RemoveTagsFromWorkbooksRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.RemoveTagsFromWorkbooksRequest = RemoveTagsFromWorkbooksRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var RevertWorkbookRequest = (function (_super) {\r\n            __extends(RevertWorkbookRequest, _super);\r\n            function RevertWorkbookRequest(params) {\r\n                _super.call(this, 'revertWorkbook', params);\r\n            }\r\n            return RevertWorkbookRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.RevertWorkbookRequest = RevertWorkbookRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var RunExtractRefreshesOnWorkbooksRequest = (function (_super) {\r\n            __extends(RunExtractRefreshesOnWorkbooksRequest, _super);\r\n            // type must be from ServerApi.ExtractTaskType\r\n            function RunExtractRefreshesOnWorkbooksRequest(ids, type) {\r\n                _super.call(this, 'runExtractRefreshesOnWorkbooks', {\r\n                    ids: ids,\r\n                    type: type\r\n                });\r\n            }\r\n            return RunExtractRefreshesOnWorkbooksRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.RunExtractRefreshesOnWorkbooksRequest = RunExtractRefreshesOnWorkbooksRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var SetDisplayTabsRequest = (function (_super) {\r\n            __extends(SetDisplayTabsRequest, _super);\r\n            function SetDisplayTabsRequest(params) {\r\n                _super.call(this, 'setDisplayTabs', params);\r\n            }\r\n            return SetDisplayTabsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.SetDisplayTabsRequest = SetDisplayTabsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\n/// <reference path=\"../types/IResponse.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var SetWorkbookDescriptionRequest = (function (_super) {\r\n            __extends(SetWorkbookDescriptionRequest, _super);\r\n            function SetWorkbookDescriptionRequest(id, description) {\r\n                _super.call(this, 'setWorkbookDescription', {\r\n                    id: id,\r\n                    description: description\r\n                });\r\n            }\r\n            return SetWorkbookDescriptionRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.SetWorkbookDescriptionRequest = SetWorkbookDescriptionRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var SetWorkbooksOwnerRequest = (function (_super) {\r\n            __extends(SetWorkbooksOwnerRequest, _super);\r\n            function SetWorkbooksOwnerRequest(ids, ownerId) {\r\n                _super.call(this, 'setWorkbooksOwner', {\r\n                    ids: ids,\r\n                    ownerId: ownerId\r\n                });\r\n            }\r\n            return SetWorkbooksOwnerRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.SetWorkbooksOwnerRequest = SetWorkbooksOwnerRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/RequestHelper.ts\" />\r\n/// <reference path=\"../helpers/ResourceHelper.ts\" />\r\n/// <reference path=\"../helpers/ResultHelper.ts\" />\r\n/// <reference path=\"../helpers/ServerModelHelper.ts\" />\r\n/// <reference path=\"../models/IWorkbookInfo.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/AddTagsToWorkbooksRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/CreateExtractTasksRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/DeleteWorkbooksRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetWorkbookActionsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetWorkbooksRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/MarkRecentlyViewedRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/MoveWorkbooksToProjectRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/RemoveTagsFromWorkbooksRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/RevertWorkbookRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/RunExtractRefreshesOnWorkbooksRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/SetDisplayTabsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/SetWorkbookDescriptionRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/SetWorkbooksOwnerRequest.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var Workbooks = (function () {\r\n        function Workbooks($q, ErrorNotifyingServer, FetcherFactory) {\r\n            this.$q = $q;\r\n            this.ErrorNotifyingServer = ErrorNotifyingServer;\r\n            this.server = ErrorNotifyingServer.getServerService();\r\n            this.listFetcher = FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetWorkbooksRequest, VizPortal.ServerApiMapper.workbooks);\r\n            this.allQuery = new VizPortal.ResourceQuery(this.listFetcher);\r\n            this.detailFetcher = FetcherFactory.getServerDetailFetcher('getWorkbook', VizPortal.WorkbookMapper.mapDetail);\r\n            this.fieldValuesFetcher = FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetFieldValuesRequest, VizPortal.ServerApiMapper.fieldValues);\r\n        }\r\n        Workbooks.prototype.all = function () {\r\n            return this.allQuery;\r\n        };\r\n        Workbooks.prototype.getById = function (id) {\r\n            return this.detailFetcher.fetchById(id);\r\n        };\r\n        Workbooks.prototype.valuesForField = function (field) {\r\n            return new VizPortal.FieldValuesQuery(this.fieldValuesFetcher, field, VizPortal.ServerApi.FieldValueResourceType.workbook);\r\n        };\r\n        // Actions\r\n        Workbooks.prototype.actions = function (id) {\r\n            return this.server.sendRequest(new VizPortal.ServerApi.GetWorkbookActionsRequest(id));\r\n        };\r\n        Workbooks.prototype.del = function (ids) {\r\n            return this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests(ids, function (idsBlock) { return new VizPortal.ServerApi.DeleteWorkbooksRequest(idsBlock); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        Workbooks.prototype.setDescription = function (id, description) {\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.SetWorkbookDescriptionRequest(id, description));\r\n        };\r\n        Workbooks.prototype.setOwner = function (ids, ownerId) {\r\n            return this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests(ids, function (idsBlock) { return new VizPortal.ServerApi.SetWorkbooksOwnerRequest(idsBlock, ownerId); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        Workbooks.prototype.moveToProject = function (targetProjectId, workbookIds) {\r\n            return this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests(workbookIds, function (idsBlock) { return new VizPortal.ServerApi.MoveWorkbooksToProjectRequest({\r\n                ids: idsBlock,\r\n                projectId: targetProjectId\r\n            }); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        Workbooks.prototype.setDisplayTabs = function (ids, displayTabs) {\r\n            return this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests(ids, function (idsBlock) { return new VizPortal.ServerApi.SetDisplayTabsRequest({\r\n                ids: idsBlock,\r\n                displayTabs: displayTabs\r\n            }); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        Workbooks.prototype.addTags = function (ids, tags) {\r\n            return (tags.length > 0)\r\n                ? this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests2(ids, tags, function (idsBlock, tagsBlock) { return new VizPortal.ServerApi.AddTagsToWorkbooksRequest(idsBlock, tagsBlock); }), VizPortal.ResultHelper.combineResults)\r\n                : this.$q.when({});\r\n        };\r\n        Workbooks.prototype.removeTags = function (ids, tags) {\r\n            return (tags.length > 0)\r\n                ? this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests2(ids, tags, function (idsBlock, tagsBlock) { return new VizPortal.ServerApi.RemoveTagsFromWorkbooksRequest(idsBlock, tagsBlock); }), VizPortal.ResultHelper.combineResults)\r\n                : this.$q.when({});\r\n        };\r\n        Workbooks.prototype.revertWorkbook = function (workbookId, versionNum) {\r\n            var request = new VizPortal.ServerApi.RevertWorkbookRequest({ id: workbookId, version: versionNum });\r\n            return this.ErrorNotifyingServer.sendRequest(request);\r\n        };\r\n        Workbooks.prototype.changeTags = function (ids, tagsToAdd, tagsToRemove) {\r\n            var _this = this;\r\n            return this.removeTags(ids, tagsToRemove)\r\n                .then(function (result) { return VizPortal.ResultHelper.hasErrors(result) ? result : _this.addTags(ids, tagsToAdd); });\r\n        };\r\n        Workbooks.prototype.createExtractTask = function (ids, scheduleId, extractType) {\r\n            return this.ErrorNotifyingServer.sendRequests(VizPortal.RequestHelper.buildRequests(ids, function (idsBlock) { return new VizPortal.ServerApi.CreateExtractTasksRequest({\r\n                targetType: VizPortal.ServerApi.ExtractTaskTargetType.Workbook,\r\n                targetIds: idsBlock,\r\n                scheduleId: scheduleId,\r\n                type: extractType // ServerApi.ExtractTaskType\r\n            }); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        Workbooks.prototype.refreshExtracts = function (ids, extractType) {\r\n            return this.ErrorNotifyingServer.sendRequests(VizPortal.RequestHelper.buildRequests(ids, function (idsBlock) {\r\n                return new VizPortal.ServerApi.RunExtractRefreshesOnWorkbooksRequest(idsBlock, extractType);\r\n            }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        Workbooks.prototype.markRecentlyViewed = function (id) {\r\n            return this.server.sendRequest(new VizPortal.ServerApi.MarkRecentlyViewedRequest({\r\n                objectId: id,\r\n                objectType: VizPortal.ServerApi.RecentlyViewedObjectType.Workbook\r\n            }));\r\n        };\r\n        Workbooks.$inject = [\r\n            '$q',\r\n            'ErrorNotifyingServer',\r\n            'FetcherFactory'\r\n        ];\r\n        return Workbooks;\r\n    })();\r\n    VizPortal.Workbooks = Workbooks;\r\n    VizPortal.Module.instance().service('Workbooks', Workbooks);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../models/ContentTypes.ts\" />\r\n/// <reference path=\"../models/IWorkbookInfo.ts\" />\r\n/// <reference path=\"../models/ListLayout.ts\" />\r\n/// <reference path=\"../models/PermissionsPanelColumnWidths.ts\" />\r\n/// <reference path=\"../models/Set.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../resources/Workbooks.ts\" />\r\n/// <reference path=\"../services/ModalService.ts\" />\r\n/// <reference path=\"../services/ToasterService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var EditPermissionsAction = (function () {\r\n        function EditPermissionsAction(modalService, $q, $window, $translate, getActionableObjectsForAction) {\r\n            this.modalService = modalService;\r\n            this.$q = $q;\r\n            this.$window = $window;\r\n            this.$translate = $translate;\r\n            this.getActionableObjectsForAction = getActionableObjectsForAction;\r\n        }\r\n        EditPermissionsAction.prototype.showEditPermissionsDialog = function (actionContext) {\r\n            var _this = this;\r\n            // Create new scope inherited from parent.\r\n            // We need things like selectedItems.\r\n            var scope = actionContext.scope.$new();\r\n            if (scope.contentType === VizPortal.DatasourceContentType.name && this.areAnyEmbeddedDatasourcesSelected(scope.selectedItems)) {\r\n                return this.$q.when(this.alertCantShowPermissions({\r\n                    translatedMessage: this.$translate.instant('permissions_notShowingEmbeddedAndPublishedDataSources', { ITEM_COUNT: scope.selectedItems.size() }, VizPortal.L10n.Interpolations.Count)\r\n                }));\r\n            }\r\n            return this.getActionableObjectsForAction.editPermissions({\r\n                type: scope.contentType,\r\n                ids: scope.selectedItems.keys()\r\n            }).then(function (result) {\r\n                var ids = result.ids;\r\n                var unactionableItems = scope.selectedItems.clone();\r\n                scope.actionableItems = new VizPortal.Set(function (item) { return item.id; });\r\n                _.each(ids, function (id) {\r\n                    var item = scope.selectedItems.get(id);\r\n                    scope.actionableItems.add(item);\r\n                    unactionableItems.remove(item);\r\n                });\r\n                // if there are any items in the section that the user isn't allowed to set permissions on,\r\n                // we don't show the permissions panel\r\n                if (unactionableItems.size() > 0) {\r\n                    return _this.alertCantShowPermissions({\r\n                        translatedMessage: _this.getCannotViewAllSelectedMessage(scope.contentType, scope.selectedItems)\r\n                    }).result;\r\n                }\r\n                if (VizPortal.FeatureFlags.projectControlledPermissionsEnabled) {\r\n                    scope.authorizables = scope.actionableItems.clone();\r\n                    scope.authorizableType = scope.contentType;\r\n                    scope.templateType = scope.contentType;\r\n                    var widthLayout = VizPortal.getPermissionsPanelColumnWidths(scope.templateType);\r\n                    scope.permissionsContainerWidth = widthLayout.getPermissionsDialogWidth($(_this.$window).width());\r\n                    scope.permissionsPanelHeight = _this.calculatePermissionsPanelHeight();\r\n                }\r\n                else {\r\n                    _this.determineInfoMessageFromAuthorizables(scope); // also sets scope.readOnly\r\n                    if (scope.readOnly) {\r\n                        var tabbedWorkbookSet = new VizPortal.Set(function (workbook) { return workbook.id; });\r\n                        scope.actionableItems.each(function (view) {\r\n                            if (view.workbook.displayTabs) {\r\n                                tabbedWorkbookSet.add(view.workbook);\r\n                            }\r\n                        });\r\n                        scope.authorizables = tabbedWorkbookSet;\r\n                        scope.authorizableType = VizPortal.WorkbookContentType.name;\r\n                        scope.templateType = VizPortal.ViewContentType.name;\r\n                    }\r\n                    else {\r\n                        scope.authorizables = scope.actionableItems.clone();\r\n                        scope.authorizableType = scope.contentType;\r\n                        scope.templateType = scope.contentType;\r\n                    }\r\n                    var headerWidth = _this.headerWidth(scope.authorizableType, scope.readOnly);\r\n                    var widthLayout = VizPortal.getPermissionsPanelColumnWidths(scope.templateType);\r\n                    scope.permissionsContainerWidth = Math.max(widthLayout.getPermissionsDialogWidth($(_this.$window).width()), headerWidth);\r\n                    // Setup description of the dialog.\r\n                    // These may change depending on whether read only mode is on or not.\r\n                    _this.setupDescriptionOnScope(scope, scope.readOnly);\r\n                    scope.permissionsPanelHeight = _this.calculatePermissionsPanelHeightWithoutPCP(!!scope.permissionsInfoMessage);\r\n                }\r\n                return _this.openPermissionsDialog(scope).result;\r\n            }).fin(function () { return scope.$destroy(); });\r\n        };\r\n        EditPermissionsAction.prototype.determineInfoMessageFromAuthorizables = function (scope) {\r\n            if (scope.contentType === VizPortal.ViewContentType.name) {\r\n                // SPECIAL CASES handling of the permission dialog for views (see BUGZID: 128688)\r\n                // We have a special case when user tries to view permissions of Views that are contained in\r\n                // tabbed Workbooks. In this case, it's the Workbooks permissions that determines the permissions\r\n                // for the selected views. So, we need to:\r\n                // (1) Inform the users about this.\r\n                // (2) Display the permissions of those containing workbooks in read only mode.\r\n                // (3) If views selection has both tabbed and untabbed workbooks, don't show permissions and notify users.\r\n                // count number of tabbed workbooks and untabbed workbooks\r\n                var tabbedCount = 0;\r\n                var untabbedCount = 0;\r\n                scope.actionableItems.each(function (view) {\r\n                    view.workbook.displayTabs ? ++tabbedCount : ++untabbedCount;\r\n                });\r\n                if (tabbedCount > 0 && untabbedCount > 0) {\r\n                    // See the SPECIAL CASES comment above.\r\n                    // We can't show permissions when the workbook tabbed settings are mixed.\r\n                    return this.alertCantShowPermissions({\r\n                        translatedMessage: this.$translate.instant('mixedTabbedWorkbookMessage', { ITEM_COUNT: scope.selectedItems.size() }, VizPortal.L10n.Interpolations.Count)\r\n                    }).result;\r\n                }\r\n                else if (tabbedCount === scope.actionableItems.size()) {\r\n                    // if all the workbooks are tabbed, we will open the permissions panel in readonly mode\r\n                    scope.readOnly = true;\r\n                    this.setupPermissionsInfoMessageForTabbedViewsOnScope(scope, scope.actionableItems);\r\n                }\r\n            }\r\n            else if (scope.contentType === VizPortal.WorkbookContentType.name) {\r\n                // if any of the selected workbooks have tabs disabled, we show a notice in the dialog to edit the permissions of the individual views.\r\n                this.setupPermissionsInfoMessageForWorkbooksOnScope(scope, scope.actionableItems);\r\n            }\r\n        };\r\n        EditPermissionsAction.prototype.openPermissionsDialog = function (scope) {\r\n            return this.modalService.open({\r\n                scope: scope,\r\n                templateUrl: VizPortal.FeatureFlags.projectControlledPermissionsEnabled\r\n                    ? 'permissionsDialog.html'\r\n                    : 'permissionsDialogWithoutPCP.html',\r\n                size: VizPortal.ModalSize.fitToContent\r\n            });\r\n        };\r\n        EditPermissionsAction.prototype.alertCantShowPermissions = function (message) {\r\n            return this.modalService.alert(_.extend({\r\n                titleId: 'permissions_cannotViewPermissions'\r\n            }, message));\r\n        };\r\n        /**\r\n        * Calculates the width required by the header\r\n        * TODO: remove this when the projectControlledPermissionsEnabled feature flag dies.\r\n        * Equivalent functionality exists in PermissionsPanelColumnWidths.ts\r\n        */\r\n        EditPermissionsAction.prototype.headerWidth = function (authorizableType, readOnly) {\r\n            var assignPermissionsToContentsWidth = 0;\r\n            if (!readOnly && (authorizableType === VizPortal.ProjectContentType.name || authorizableType === VizPortal.WorkbookContentType.name)) {\r\n                assignPermissionsToContentsWidth = 250 + 6; // 6 px padding\r\n            }\r\n            return 18 // margin\r\n                + 450 // permissions summary\r\n                + 35 // margin\r\n                + 200 // effective permissions search box\r\n                + assignPermissionsToContentsWidth;\r\n        };\r\n        /**\r\n        * Calculates a height to make the permissions panel fit in smaller screen sizes.\r\n        * TODO: refactor the layout of the permissions panel so this isn't needed.\r\n        */\r\n        EditPermissionsAction.prototype.calculatePermissionsPanelHeightWithoutPCP = function (hasInfoMessage) {\r\n            var modalDialog = 28 + 12 + 2; // top padding, bottom padding, border (.tb-modal)\r\n            var modalDialogTitle = 21 + 12; // height, bottom margin (.tb-dialog-title)\r\n            var modalDialogDescription = 16 + 12; // height, bottom margin (.tb-dialog-description)\r\n            if (hasInfoMessage) {\r\n                // if we aren't showing the permissions for all selected items, an extra description is present that we need to account for.\r\n                modalDialogDescription *= 2;\r\n                modalDialogDescription += 16 + 1; // two lines + 1px because icon is 17px\r\n            }\r\n            var availableHeight = $(this.$window).height();\r\n            return availableHeight - (modalDialog + modalDialogTitle + modalDialogDescription + VizPortal.ModalService.MinimumSpaceBetweenDialogAndViewport);\r\n        };\r\n        /**\r\n         * Calculates a height to make the permissions panel fit in smaller screen sizes.\r\n         * TODO: refactor the layout of the permissions panel so this isn't needed.\r\n         */\r\n        EditPermissionsAction.prototype.calculatePermissionsPanelHeight = function () {\r\n            var modalDialog = 24 + 18 + 2; // top padding, bottom padding, border (.tb-modal)\r\n            var modalDialogTitle = 21 + 18; // height, bottom margin (.tb-dialog-title)\r\n            var availableHeight = $(this.$window).height();\r\n            return availableHeight - (modalDialog + modalDialogTitle + VizPortal.ModalService.MinimumSpaceBetweenDialogAndViewport);\r\n        };\r\n        EditPermissionsAction.prototype.setupDescriptionOnScope = function (scope, readOnly) {\r\n            var itemCount = scope.actionableItems.size();\r\n            var itemName = (itemCount > 0) ? scope.authorizables.first().name : \"\";\r\n            var stringId;\r\n            if (readOnly) {\r\n                stringId = 'readonlyViewPermissionsDescription';\r\n            }\r\n            else {\r\n                stringId = EditPermissionsAction.descriptionStringIdMap[scope.contentType];\r\n            }\r\n            scope.editPermissionsDescription = this.$translate.instant(stringId, {\r\n                ITEM_NAME: VizPortal.L10n.elideIfLong(itemName),\r\n                ITEM_COUNT: itemCount\r\n            }, VizPortal.L10n.Interpolations.Count);\r\n        };\r\n        /**\r\n        * If any of the workbooks have tabs disabled, puts a translated message on the scope explaining that view permissions\r\n        * are set on the individual views.\r\n        */\r\n        EditPermissionsAction.prototype.setupPermissionsInfoMessageForWorkbooksOnScope = function (scope, workbooks) {\r\n            var tabbedCount = 0;\r\n            var untabbedCount = 0;\r\n            workbooks.each(function (workbook) {\r\n                workbook.displayTabs ? ++tabbedCount : ++untabbedCount;\r\n            });\r\n            if (tabbedCount === 0) {\r\n                // all workbooks have disabled\r\n                scope.permissionsInfoMessage = this.$translate.instant('permissionsLongMessage_workbooksAllWithIndependentViews');\r\n            }\r\n            else if (untabbedCount > 0) {\r\n                // mixed selection: some workbooks have tabs and some don't\r\n                scope.permissionsInfoMessage = this.$translate.instant('permissionsLongMessage_workbooksSomeWithIndependentViews');\r\n            }\r\n        };\r\n        /**\r\n        * Puts a translated message on the scope explaining that tabbed view permissions are controlled by the parent workbook\r\n        */\r\n        EditPermissionsAction.prototype.setupPermissionsInfoMessageForTabbedViewsOnScope = function (scope, views) {\r\n            var numWorkbooks = _.uniq(views.map(function (view) { return view.workbook.id; })).length;\r\n            if (numWorkbooks === 1) {\r\n                var workbook = views.first().workbook;\r\n                var workbookName = workbook.name;\r\n            }\r\n            scope.permissionsInfoMessage = this.$translate.instant('permissions_tabbedViewsMessage', {\r\n                VIEW_COUNT: views.size(),\r\n                WORKBOOK_COUNT: numWorkbooks,\r\n                WORKBOOK_NAME: VizPortal.L10n.elideIfLong(workbookName)\r\n            }, VizPortal.L10n.Interpolations.Count);\r\n        };\r\n        EditPermissionsAction.prototype.getCannotViewAllSelectedMessage = function (authorizableType, unactionableItems) {\r\n            return this.$translate.instant(EditPermissionsAction.cannotViewAllSelectedMessageIdMap[authorizableType], {\r\n                ITEM_NAME: VizPortal.L10n.elideIfLong(unactionableItems.first().name),\r\n                ITEM_COUNT: unactionableItems.size()\r\n            }, VizPortal.L10n.Interpolations.Count);\r\n        };\r\n        EditPermissionsAction.prototype.areAnyEmbeddedDatasourcesSelected = function (datasources) {\r\n            return !!datasources.find(function (datasource) { return !!datasource.workbook; });\r\n        };\r\n        EditPermissionsAction.$inject = [\r\n            'ModalService',\r\n            '$q',\r\n            '$window',\r\n            '$translate',\r\n            'GetActionableObjectsForAction'];\r\n        EditPermissionsAction.descriptionStringIdMap = (function () {\r\n            var map = {};\r\n            map[VizPortal.ProjectContentType.name] = 'editProjectPermissionsDescription';\r\n            map[VizPortal.WorkbookContentType.name] = 'editWorkbookPermissionsDescription';\r\n            map[VizPortal.ViewContentType.name] = 'editViewPermissionsDescription';\r\n            map[VizPortal.DatasourceContentType.name] = 'editDatasourcePermissionsDescription';\r\n            return map;\r\n        })();\r\n        EditPermissionsAction.cannotViewAllSelectedMessageIdMap = (function () {\r\n            var map = {};\r\n            map[VizPortal.ProjectContentType.name] = 'permissions_cannotViewSelectedProjects';\r\n            map[VizPortal.WorkbookContentType.name] = 'permissions_cannotViewSelectedWorkbooks';\r\n            map[VizPortal.ViewContentType.name] = 'permissions_cannotViewSelectedViews';\r\n            map[VizPortal.DatasourceContentType.name] = 'permissions_cannotViewSelectedDataSources';\r\n            return map;\r\n        })();\r\n        return EditPermissionsAction;\r\n    })();\r\n    VizPortal.EditPermissionsAction = EditPermissionsAction;\r\n    VizPortal.Module.instance().service('EditPermissionsAction', EditPermissionsAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"AbstractContentAction.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var HideViewsAction = (function () {\r\n        function HideViewsAction(ViewErrors, ActionHelpers, ConfirmActionDialog, $translate, Views) {\r\n            this.ViewErrors = ViewErrors;\r\n            this.ActionHelpers = ActionHelpers;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.$translate = $translate;\r\n            this.Views = Views;\r\n        }\r\n        HideViewsAction.prototype.confirmDeleteViews = function (views, context) {\r\n            var _this = this;\r\n            var scope = context.scope;\r\n            var workbooksToDelete = this.workbooksWithNoViews(views);\r\n            scope.deleteViewsConfirmation = this.$translate.instant('confirmDeleteViews', {\r\n                VIEW_COUNT: views.size(),\r\n                VIEW_NAME: VizPortal.L10n.elideIfLong(views.first().name)\r\n            }, VizPortal.L10n.Interpolations.Count);\r\n            scope.deleteWorkbooksConfirmation = workbooksToDelete.length > 0\r\n                ? this.$translate.instant('confirmDeleteViewsWorkbookWarning', {\r\n                    WORKBOOK_COUNT: workbooksToDelete.length,\r\n                    WORKBOOK_NAME: VizPortal.L10n.elideIfLong(workbooksToDelete[0].name)\r\n                }, VizPortal.L10n.Interpolations.Count)\r\n                : null;\r\n            return this.ConfirmActionDialog.open({\r\n                scope: context.scope,\r\n                title: this.$translate.instant('delete'),\r\n                bodyTemplateUrl: \"confirmDeleteViews.html\",\r\n                actionName: this.$translate.instant('confirmDeleteButton', {\r\n                    ITEM_COUNT: views.size()\r\n                }, VizPortal.L10n.Interpolations.Count),\r\n                isDeleteAction: true,\r\n                action: function (dialogInstance) {\r\n                    return _this.Views.hide(views.keys()).then(function (result) { return _this.notifyResult(views, result); });\r\n                }\r\n            }).result;\r\n        };\r\n        // Determine if any workbooks will be deleted as a result of deleting the selected views\r\n        HideViewsAction.prototype.workbooksWithNoViews = function (views) {\r\n            var workbooksToDelete = [];\r\n            var workbookViewCount = {};\r\n            views.each(function (view) {\r\n                var viewCount = workbookViewCount[view.workbook.id] || 0;\r\n                viewCount++;\r\n                if (viewCount === view.workbook.numSheets) {\r\n                    workbooksToDelete.push(view.workbook);\r\n                }\r\n                workbookViewCount[view.workbook.id] = viewCount;\r\n            });\r\n            return workbooksToDelete;\r\n        };\r\n        HideViewsAction.prototype.notifyResult = function (views, result) {\r\n            var _this = this;\r\n            this.ActionHelpers.notifyStandardError(views, {\r\n                successId: 'deleteViewsSuccess',\r\n                errorId: 'deleteViewsError'\r\n            }, function (errorItem) { return _this.ViewErrors.errorDetailsFor(errorItem); })(result);\r\n        };\r\n        HideViewsAction.$inject = ['ViewErrors', 'ActionHelpers', 'ConfirmActionDialog', '$translate', 'Views'];\r\n        return HideViewsAction;\r\n    })();\r\n    VizPortal.HideViewsAction = HideViewsAction;\r\n    VizPortal.Module.instance().service('HideViewsAction', HideViewsAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/ActionContext.ts\" />\r\n/// <reference path=\"../models/ListLayout.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/ContentActions.ts\" />\r\n/// <reference path=\"../services/EditConnectionAction.ts\" />\r\n/// <reference path=\"../services/EditPermissionsAction.ts\" />\r\n/// <reference path=\"../services/HideViewsAction.ts\" />\r\n/// <reference path=\"../services/RevisionHistoryAction.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ActionPanelService = (function () {\r\n        function ActionPanelService($state, ServerService, contentActions, EditConnectionAction, EditPermissionsAction, HideViewsAction, SetDisplayTabsAction, CreateExtractTasksAction, DeleteDatasourcesAction, RevisionHistoryAction) {\r\n            this.$state = $state;\r\n            this.ServerService = ServerService;\r\n            this.contentActions = contentActions;\r\n            this.EditConnectionAction = EditConnectionAction;\r\n            this.EditPermissionsAction = EditPermissionsAction;\r\n            this.HideViewsAction = HideViewsAction;\r\n            this.SetDisplayTabsAction = SetDisplayTabsAction;\r\n            this.CreateExtractTasksAction = CreateExtractTasksAction;\r\n            this.DeleteDatasourcesAction = DeleteDatasourcesAction;\r\n            this.RevisionHistoryAction = RevisionHistoryAction;\r\n            this.contentActionDefinitions = {\r\n                'project': [\r\n                    this.permissionsAction(),\r\n                    this.renameAction(this.bind(contentActions.renameProjectPopup)),\r\n                    this.changeOwnerAction(this.bind(contentActions.changeOwnerOnProjects), VizPortal.CommonErrorCode.ProjectNotFound),\r\n                    this.deleteProjectsAction()\r\n                ],\r\n                'datasource': [\r\n                    this.newWorkbookAction(),\r\n                    this.downloadDatasourceAction(),\r\n                    this.setTagsOnDatasourcesAction(),\r\n                    this.datasourcePermissionsAction(),\r\n                    this.moveDatasourcesToProjectAction(),\r\n                    this.changeOwnerOnDatasourcesAction(),\r\n                    this.createExtractRefreshForDatasourcesAction(),\r\n                    this.editConnectionAction(),\r\n                    this.deleteDatasourcesAction()\r\n                ],\r\n                'workbook': [\r\n                    this.editAction(this.bind(contentActions.editWorkbook), 'editWorkbook_action'),\r\n                    this.downloadWorkbookAction(),\r\n                    this.changeTags(this.bind(contentActions.setTagsOnWorkbooks), VizPortal.CommonErrorCode.WorkbookNotFound),\r\n                    this.permissionsAction(),\r\n                    this.moveWorkbooksToProjectAction(),\r\n                    this.changeOwnerAction(this.bind(contentActions.changeOwnerOnWorkbooks), VizPortal.CommonErrorCode.WorkbookNotFound),\r\n                    this.createExtractRefreshForWorkbooksAction(),\r\n                    this.setDisplayTabsAction(),\r\n                    this.viewWorkbookRevisionHistoryAction(),\r\n                    this.deleteWorkbooksAction()\r\n                ],\r\n                'view': [\r\n                    this.editAction(this.bind(contentActions.editView), 'editView_action'),\r\n                    this.changeTags(this.bind(contentActions.setTagsOnViews), VizPortal.CommonErrorCode.ViewNotFound),\r\n                    this.permissionsAction(),\r\n                    this.deleteViewsAction()\r\n                ],\r\n                'sites': [\r\n                    this.activateSiteAction(this.bind(contentActions.activateSite)),\r\n                    this.suspendSiteAction(this.bind(contentActions.suspendSite)),\r\n                    this.editSiteSettingsAction(this.bind(contentActions.editSite)),\r\n                    this.deleteSitesAction(this.bind(contentActions.deleteSites))\r\n                ]\r\n            };\r\n        }\r\n        ActionPanelService.prototype.bind = function (fn) {\r\n            return angular.bind(this.contentActions, fn);\r\n        };\r\n        // Helper functions\r\n        ActionPanelService.anySelected = function (items) {\r\n            return items.size() > 0;\r\n        };\r\n        ActionPanelService.oneSelected = function (items) {\r\n            return items.size() === 1;\r\n        };\r\n        ActionPanelService.oneSelectedEmbeddedDatasource = function (items) {\r\n            return ActionPanelService.oneSelected(items) && !!items.first().workbook;\r\n        };\r\n        ActionPanelService.prototype.oneSelectedUnrefreshableItem = function (items) {\r\n            if (ActionPanelService.oneSelected(items)) {\r\n                var item = items.first();\r\n                return !item.hasExtracts || !this.isAdminOrOwner(item.owner.id);\r\n            }\r\n            else {\r\n                return false;\r\n            }\r\n        };\r\n        ActionPanelService.prototype.oneSelectedUnrefreshableDatasource = function (datasources) {\r\n            if (ActionPanelService.oneSelected(datasources)) {\r\n                var datasource = datasources.first();\r\n                return !this.CreateExtractTasksAction.isRefreshableDatasource(datasource)\r\n                    || !this.isAdminOrOwner(datasource.owner.id);\r\n            }\r\n            else {\r\n                return false;\r\n            }\r\n        };\r\n        ActionPanelService.prototype.isAdminOrOwner = function (ownerId) {\r\n            return this.ServerService.isSessionSiteOrServerAdmin() || ownerId === this.ServerService.sessionUserId();\r\n        };\r\n        ActionPanelService.prototype.getUpdateSiteAvailabilityDisabledFn = function (toAvailabilityStateName) {\r\n            return function (items) {\r\n                if (items.size() === 1) {\r\n                    // Check if default site or if the action will not change availability\r\n                    var item = items.first();\r\n                    return item.settings.urlName === ''\r\n                        || item.availability === toAvailabilityStateName\r\n                        || item.availability === VizPortal.SiteAvailabilityState.LOCKED;\r\n                }\r\n                else {\r\n                    return false;\r\n                }\r\n            };\r\n        };\r\n        // Action Button factory functions\r\n        ActionPanelService.prototype.moveDatasourcesToProjectAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'move',\r\n                translate: 'move_action',\r\n                isAvailable: ActionPanelService.anySelected,\r\n                isDisabled: function (items, detailedItem, allowedActions) {\r\n                    return (!!allowedActions && !allowedActions.setProject) || ActionPanelService.oneSelectedEmbeddedDatasource(items);\r\n                },\r\n                execute: function (items, context) {\r\n                    var scope = context.scope;\r\n                    _this.contentActions.moveDatasourcesToProject(items, context)\r\n                        .then(function (result) {\r\n                        if (scope.place === 'project') {\r\n                            VizPortal.ActionHelpers.deselectAllExceptErrors(scope.selectedItems, result, VizPortal.CommonErrorCode.DatasourceNotFound);\r\n                        }\r\n                        else {\r\n                            VizPortal.ActionHelpers.deselectNotFound(scope.selectedItems, result, VizPortal.CommonErrorCode.DatasourceNotFound);\r\n                        }\r\n                        scope.refreshContent();\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        ActionPanelService.prototype.moveWorkbooksToProjectAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'move',\r\n                translate: 'move_action',\r\n                isAvailable: ActionPanelService.anySelected,\r\n                isDisabled: function (items, detailedItem, allowedActions) {\r\n                    return (!!allowedActions && !allowedActions.setProject);\r\n                },\r\n                execute: function (items, context) {\r\n                    var scope = context.scope;\r\n                    _this.contentActions.moveWorkbooksToProject(items, context)\r\n                        .then(function (result) {\r\n                        if (scope.place === 'project') {\r\n                            VizPortal.ActionHelpers.deselectAllExceptErrors(scope.selectedItems, result, VizPortal.CommonErrorCode.WorkbookNotFound);\r\n                        }\r\n                        else {\r\n                            VizPortal.ActionHelpers.deselectNotFound(scope.selectedItems, result, VizPortal.CommonErrorCode.WorkbookNotFound);\r\n                        }\r\n                        scope.refreshContent();\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        ActionPanelService.prototype.deleteProjectsAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'delete',\r\n                translate: 'delete_action',\r\n                isAvailable: ActionPanelService.anySelected,\r\n                isDisabled: function (items, detailedItem, allowedActions) {\r\n                    return (!!allowedActions && !allowedActions.del);\r\n                },\r\n                execute: function (items, context) {\r\n                    var scope = context.scope;\r\n                    _this.contentActions.deleteProjects(items, context)\r\n                        .then(function (result) {\r\n                        VizPortal.ActionHelpers.deselectAllExceptErrors(scope.selectedItems, result, VizPortal.CommonErrorCode.ProjectNotFound);\r\n                        scope.refreshContent();\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        ActionPanelService.prototype.deleteDatasourcesAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'delete',\r\n                translate: 'delete_action',\r\n                isAvailable: ActionPanelService.anySelected,\r\n                isDisabled: function (items, detailedItem, allowedActions) {\r\n                    return (!!allowedActions && !allowedActions.del) || ActionPanelService.oneSelectedEmbeddedDatasource(items);\r\n                },\r\n                execute: function (items, context) {\r\n                    var scope = context.scope;\r\n                    _this.DeleteDatasourcesAction.confirmDeleteDatasources(items, context)\r\n                        .then(function (result) {\r\n                        if (result.allowed) {\r\n                            VizPortal.ActionHelpers.deselectAllExceptErrors(scope.selectedItems, result.serverResult, VizPortal.CommonErrorCode.DatasourceNotFound);\r\n                            scope.refreshContent();\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        ActionPanelService.prototype.deleteWorkbooksAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'delete',\r\n                translate: 'delete_action',\r\n                isAvailable: ActionPanelService.anySelected,\r\n                isDisabled: function (items, detailedItem, allowedActions) {\r\n                    return (!!allowedActions && !allowedActions.del);\r\n                },\r\n                execute: function (items, context) {\r\n                    var scope = context.scope;\r\n                    _this.contentActions.deleteWorkbooks(items, context)\r\n                        .then(function (result) {\r\n                        VizPortal.ActionHelpers.deselectAllExceptErrors(scope.selectedItems, result, VizPortal.CommonErrorCode.WorkbookNotFound);\r\n                        scope.refreshContent();\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        ActionPanelService.prototype.deleteViewsAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'delete',\r\n                translate: 'delete_action',\r\n                isAvailable: ActionPanelService.anySelected,\r\n                isDisabled: function (views, detailedItem, allowedActions) {\r\n                    return !!allowedActions && !allowedActions.del;\r\n                },\r\n                execute: function (items, context) {\r\n                    var scope = context.scope;\r\n                    _this.HideViewsAction.confirmDeleteViews(items, context)\r\n                        .then(function (result) {\r\n                        var allViewsSelected = items.size() === scope.subplaceCounts['views'];\r\n                        // If we're in a workbook place, then deleting views will have deleted\r\n                        // the containing workbook, so redirect to the project place.\r\n                        if (scope.place === VizPortal.ContentTypes.workbook && allViewsSelected) {\r\n                            _this.$state.go('main.site.content.project.workbooks', {\r\n                                id: context.scope.workbook.project.id\r\n                            });\r\n                        }\r\n                        else {\r\n                            VizPortal.ActionHelpers.deselectAllExceptErrors(scope.selectedItems, result, VizPortal.CommonErrorCode.ViewNotFound);\r\n                            scope.refreshContent();\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        ActionPanelService.prototype.viewWorkbookRevisionHistoryAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'view-revision-history',\r\n                translate: 'revisionHistory_action',\r\n                isAvailable: function () { return ActionPanelService.anySelected && VizPortal.FeatureFlags.workbookVersionHistoryEnabled; },\r\n                isDisabled: function () { return false; },\r\n                execute: function (items) {\r\n                    _this.RevisionHistoryAction.showRevisionHistory(items.first());\r\n                }\r\n            };\r\n        };\r\n        ActionPanelService.prototype.renameAction = function (renameAction) {\r\n            return {\r\n                name: 'rename',\r\n                translate: 'rename_action',\r\n                isAvailable: ActionPanelService.anySelected,\r\n                isDisabled: function (items, detailedItem, allowedActions) {\r\n                    return (!!allowedActions && !allowedActions.setName) || !ActionPanelService.oneSelected(items);\r\n                },\r\n                execute: function (items, context) {\r\n                    var scope = context.scope;\r\n                    renameAction(items.first(), context)\r\n                        .then(function () { return scope.refreshContent(); });\r\n                }\r\n            };\r\n        };\r\n        ActionPanelService.prototype.downloadDatasourceAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'download',\r\n                isAvailable: ActionPanelService.anySelected,\r\n                isDisabled: function (items, detailedItem, allowedActions) {\r\n                    return (!!allowedActions && !allowedActions.download) || !ActionPanelService.oneSelected(items)\r\n                        || ActionPanelService.oneSelectedEmbeddedDatasource(items);\r\n                },\r\n                execute: function (items, context) {\r\n                    var scope = context.scope;\r\n                    _this.contentActions.downloadDatasource(items.first())\r\n                        .fail(function () { return scope.refreshContent(); }); // May have failed this action was taken on stale information\r\n                }\r\n            };\r\n        };\r\n        ActionPanelService.prototype.downloadWorkbookAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'download',\r\n                isAvailable: ActionPanelService.anySelected,\r\n                isDisabled: function (items, detailedItem, allowedActions) {\r\n                    return (!!allowedActions && !allowedActions.download) || !ActionPanelService.oneSelected(items);\r\n                },\r\n                execute: function (items, context, detailedItem) {\r\n                    var workbook = detailedItem || items.first();\r\n                    var scope = context.scope;\r\n                    _this.contentActions.downloadWorkbook(workbook)\r\n                        .fail(function () { return scope.refreshContent(); }); // May have failed this action was taken on stale information\r\n                }\r\n            };\r\n        };\r\n        ActionPanelService.prototype.permissionsAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'permissions',\r\n                translate: 'permissions_action',\r\n                isAvailable: ActionPanelService.anySelected,\r\n                isDisabled: function (items, detailedItem, allowedActions) {\r\n                    return (allowedActions && !allowedActions.setPermissions);\r\n                },\r\n                execute: function (items, context) {\r\n                    _this.EditPermissionsAction.showEditPermissionsDialog(context);\r\n                }\r\n            };\r\n        };\r\n        ActionPanelService.prototype.datasourcePermissionsAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'permissions',\r\n                translate: 'permissions_action',\r\n                isAvailable: ActionPanelService.anySelected,\r\n                isDisabled: function (items, detailedItem, allowedActions) {\r\n                    return (allowedActions && !allowedActions.setPermissions) || ActionPanelService.oneSelectedEmbeddedDatasource(items);\r\n                },\r\n                execute: function (items, context) {\r\n                    _this.EditPermissionsAction.showEditPermissionsDialog(context);\r\n                }\r\n            };\r\n        };\r\n        ActionPanelService.prototype.changeOwnerAction = function (changeOwnerAction, notFoundCode) {\r\n            return {\r\n                name: 'change-owner',\r\n                translate: 'changeOwner_action',\r\n                isAvailable: ActionPanelService.anySelected,\r\n                isDisabled: function (items, detailedItem, allowedActions) {\r\n                    return (!!allowedActions && !allowedActions.setOwner);\r\n                },\r\n                execute: function (items, context) {\r\n                    var scope = context.scope;\r\n                    var siteUserScope = context.scope;\r\n                    changeOwnerAction(items, context)\r\n                        .then(function (result) {\r\n                        if (siteUserScope.user) {\r\n                            VizPortal.ActionHelpers.deselectAllExceptErrors(scope.selectedItems, result, notFoundCode);\r\n                        }\r\n                        else {\r\n                            VizPortal.ActionHelpers.deselectNotFound(scope.selectedItems, result, notFoundCode);\r\n                        }\r\n                        scope.refreshContent();\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        ActionPanelService.prototype.changeOwnerOnDatasourcesAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'change-owner',\r\n                translate: 'changeOwner_action',\r\n                isDisabled: function (items, detailedItem, allowedActions) {\r\n                    return (!!allowedActions && !allowedActions.setOwner) || ActionPanelService.oneSelectedEmbeddedDatasource(items);\r\n                },\r\n                isAvailable: ActionPanelService.anySelected,\r\n                execute: function (items, context) {\r\n                    var scope = context.scope;\r\n                    var siteUserScope = context.scope;\r\n                    _this.contentActions.changeOwnerOnDatasources(items, context)\r\n                        .then(function (result) {\r\n                        if (siteUserScope.user) {\r\n                            VizPortal.ActionHelpers.deselectAllExceptErrors(scope.selectedItems, result, VizPortal.CommonErrorCode.DatasourceNotFound);\r\n                        }\r\n                        else {\r\n                            VizPortal.ActionHelpers.deselectNotFound(scope.selectedItems, result, VizPortal.CommonErrorCode.DatasourceNotFound);\r\n                        }\r\n                        scope.refreshContent();\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        ActionPanelService.prototype.suspendSiteAction = function (suspendSiteAction) {\r\n            return {\r\n                name: 'suspend-site',\r\n                translate: 'suspend_action',\r\n                isAvailable: ActionPanelService.anySelected,\r\n                isDisabled: this.getUpdateSiteAvailabilityDisabledFn(VizPortal.SiteAvailabilityState.SUSPENDED),\r\n                execute: function (items, context) {\r\n                    var scope = context.scope;\r\n                    suspendSiteAction(items, context)\r\n                        .then(function (result) {\r\n                        VizPortal.ActionHelpers.deselectNotFound(scope.selectedItems, result, VizPortal.CommonErrorCode.SiteNotFound);\r\n                        scope.refreshContent();\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        ActionPanelService.prototype.activateSiteAction = function (activateSiteAction) {\r\n            return {\r\n                name: 'activate-site',\r\n                translate: 'activate_action',\r\n                isAvailable: ActionPanelService.anySelected,\r\n                isDisabled: this.getUpdateSiteAvailabilityDisabledFn(VizPortal.SiteAvailabilityState.ACTIVE),\r\n                execute: function (items, context) {\r\n                    var scope = context.scope;\r\n                    activateSiteAction(items, context)\r\n                        .then(function (result) {\r\n                        VizPortal.ActionHelpers.deselectNotFound(scope.selectedItems, result, VizPortal.CommonErrorCode.SiteNotFound);\r\n                        scope.refreshContent();\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        ActionPanelService.prototype.editSiteSettingsAction = function (editSiteAction) {\r\n            return {\r\n                name: 'edit-site-settings',\r\n                translate: 'editSiteSettings_action',\r\n                isAvailable: ActionPanelService.anySelected,\r\n                isDisabled: function (items) { return !ActionPanelService.oneSelected(items); },\r\n                execute: function (items, context) {\r\n                    var scope = context.scope;\r\n                    editSiteAction(items.first(), context)\r\n                        .then(function () { return scope.refreshContent(); });\r\n                }\r\n            };\r\n        };\r\n        ActionPanelService.prototype.deleteSitesAction = function (deleteSitesAction) {\r\n            return {\r\n                name: 'delete',\r\n                translate: 'delete_action',\r\n                isAvailable: ActionPanelService.anySelected,\r\n                isDisabled: function (items) {\r\n                    return items.size() === 1 && items.first().settings.urlName === '';\r\n                },\r\n                execute: function (items, context) {\r\n                    var scope = context.scope;\r\n                    deleteSitesAction(items, context)\r\n                        .then(function (result) {\r\n                        VizPortal.ActionHelpers.deselectAllExceptErrors(scope.selectedItems, result, VizPortal.CommonErrorCode.SiteNotFound);\r\n                        scope.refreshContent();\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        ActionPanelService.prototype.editAction = function (editAction, translate) {\r\n            return {\r\n                name: 'edit-workbook',\r\n                translate: translate,\r\n                isAvailable: ActionPanelService.anySelected,\r\n                isDisabled: function (items, detailedItem, allowedActions) {\r\n                    return !detailedItem\r\n                        || !detailedItem.editUrl\r\n                        || (!!allowedActions && !allowedActions.launchWebAuthoring);\r\n                },\r\n                execute: function (items, context, detailedItem) {\r\n                    detailedItem && editAction(detailedItem);\r\n                }\r\n            };\r\n        };\r\n        ActionPanelService.prototype.newWorkbookAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'new-workbook',\r\n                translate: 'newWorkbook',\r\n                isAvailable: ActionPanelService.anySelected,\r\n                isDisabled: function (items, detailedItem, allowedActions) {\r\n                    return !detailedItem\r\n                        || !detailedItem.newWorkbookUrl\r\n                        || (!!allowedActions && !allowedActions.launchWebAuthoring);\r\n                },\r\n                execute: function (items, context, detailedItem) {\r\n                    detailedItem && _this.contentActions.newWorkbook(detailedItem);\r\n                }\r\n            };\r\n        };\r\n        ActionPanelService.prototype.changeTags = function (changeTags, notFoundCode) {\r\n            return {\r\n                name: 'change-tags',\r\n                translate: 'tag_action',\r\n                isAvailable: ActionPanelService.anySelected,\r\n                execute: function (items, context) {\r\n                    var scope = context.scope;\r\n                    changeTags(items, context)\r\n                        .then(function (result) {\r\n                        VizPortal.ActionHelpers.deselectNotFound(scope.selectedItems, result, notFoundCode);\r\n                        scope.refreshContent();\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        ActionPanelService.prototype.setTagsOnDatasourcesAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'change-tags',\r\n                translate: 'tag_action',\r\n                isAvailable: ActionPanelService.anySelected,\r\n                isDisabled: function (items) { return ActionPanelService.oneSelectedEmbeddedDatasource(items); },\r\n                execute: function (items, context) {\r\n                    var scope = context.scope;\r\n                    _this.contentActions.setTagsOnDatasources(items, context)\r\n                        .then(function (result) {\r\n                        VizPortal.ActionHelpers.deselectNotFound(scope.selectedItems, result, VizPortal.CommonErrorCode.DatasourceNotFound);\r\n                        scope.refreshContent();\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        ActionPanelService.prototype.createExtractRefreshForDatasourcesAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'create-extract-refresh',\r\n                translate: 'extractTasks_action',\r\n                isAvailable: ActionPanelService.anySelected,\r\n                isDisabled: function (datasources) { return _this.oneSelectedUnrefreshableDatasource(datasources); },\r\n                execute: function (datasources, context) {\r\n                    var scope = context.scope;\r\n                    _this.CreateExtractTasksAction.forDatasources(datasources, context, VizPortal.CreateExtractTasksMode.AllowBoth)\r\n                        .then(function (result) {\r\n                        VizPortal.ActionHelpers.deselectNotFound(scope.selectedItems, result, VizPortal.CommonErrorCode.DatasourceNotFound);\r\n                        scope.refreshContent();\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        ActionPanelService.prototype.createExtractRefreshForWorkbooksAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'create-extract-refresh',\r\n                translate: 'extractTasks_action',\r\n                isAvailable: ActionPanelService.anySelected,\r\n                isDisabled: function (items, detailedItem) {\r\n                    return _this.oneSelectedUnrefreshableItem(items);\r\n                },\r\n                execute: function (workbooks, context) {\r\n                    var scope = context.scope;\r\n                    _this.CreateExtractTasksAction.forWorkbooks(workbooks, context, VizPortal.CreateExtractTasksMode.AllowBoth)\r\n                        .then(function (result) {\r\n                        VizPortal.ActionHelpers.deselectNotFound(scope.selectedItems, result, VizPortal.CommonErrorCode.WorkbookNotFound);\r\n                        scope.refreshContent();\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        ActionPanelService.prototype.editConnectionAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'edit-connection',\r\n                translate: 'editConnection_action',\r\n                isAvailable: ActionPanelService.anySelected,\r\n                isDisabled: function (dataSources) {\r\n                    return dataSources.size() === 1 && !_this.isConnectionEditable(dataSources.first());\r\n                },\r\n                execute: function (dataSources, context) {\r\n                    var scope = context.scope;\r\n                    _this.EditConnectionAction.confirmEditConnections(dataSources, context)\r\n                        .then(function (result) {\r\n                        VizPortal.ActionHelpers.deselectNotFound(scope.selectedItems, result, VizPortal.CommonErrorCode.DatasourceNotFound);\r\n                        scope.refreshContent();\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        ActionPanelService.prototype.setDisplayTabsAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'setDisplayTabs',\r\n                translate: 'setDisplayTabs_action',\r\n                isAvailable: ActionPanelService.anySelected,\r\n                isDisabled: function (workbooks, detail, allowedActions) {\r\n                    return !!allowedActions && !allowedActions.setDisplayTabs;\r\n                },\r\n                execute: function (workbooks, context) {\r\n                    var scope = context.scope;\r\n                    _this.SetDisplayTabsAction.confirmSetDisplayTabs(workbooks, context)\r\n                        .then(function (result) {\r\n                        VizPortal.ActionHelpers.deselectNotFound(scope.selectedItems, result, VizPortal.CommonErrorCode.WorkbookNotFound);\r\n                        scope.refreshContent();\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        ActionPanelService.prototype.isConnectionEditable = function (datasource) {\r\n            return datasource.connectionTypeEditable && this.isAdminOrOwner(datasource.owner.id);\r\n        };\r\n        ActionPanelService.prototype.getContentActionButtons = function (contentType, place) {\r\n            // Special case for embedded data sources in a workbook\r\n            if (place === VizPortal.WorkbookContentType.name && contentType === VizPortal.DatasourceContentType.name) {\r\n                return [\r\n                    this.editConnectionAction()\r\n                ];\r\n            }\r\n            else {\r\n                return this.contentActionDefinitions[contentType];\r\n            }\r\n        };\r\n        ActionPanelService.$inject = [\r\n            '$state',\r\n            'ServerService',\r\n            'ContentActions',\r\n            'EditConnectionAction',\r\n            'EditPermissionsAction',\r\n            'HideViewsAction',\r\n            'SetDisplayTabsAction',\r\n            'CreateExtractTasksAction',\r\n            'DeleteDatasourcesAction',\r\n            'RevisionHistoryAction'\r\n        ];\r\n        return ActionPanelService;\r\n    })();\r\n    VizPortal.ActionPanelService = ActionPanelService;\r\n    VizPortal.Module.instance().service('ActionPanelService', ActionPanelService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/ActionContext.ts\" />\r\n/// <reference path=\"../services/ActionPanelService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ActionButtonsHelper;\r\n    (function (ActionButtonsHelper) {\r\n        function setupActionButtons(scope, actionButtons) {\r\n            scope.menuActions = actionButtons;\r\n            scope.showActionMenu = function () { return _.any(scope.menuActions, scope.availableAction); };\r\n            scope.actionButtonContext = VizPortal.ActionContext.fromEvent;\r\n            scope.actionMenuContext = function (menuButton) {\r\n                return {\r\n                    scope: scope\r\n                };\r\n            };\r\n        }\r\n        ActionButtonsHelper.setupActionButtons = setupActionButtons;\r\n    })(ActionButtonsHelper = VizPortal.ActionButtonsHelper || (VizPortal.ActionButtonsHelper = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/IPlace.ts\" />\r\n/// <reference path=\"../ServerApi/types/IFilterClause.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SubplaceEvents = (function () {\r\n        function SubplaceEvents() {\r\n        }\r\n        SubplaceEvents.Refresh = 'Refresh';\r\n        SubplaceEvents.RefreshCounts = 'RefreshCounts';\r\n        return SubplaceEvents;\r\n    })();\r\n    VizPortal.SubplaceEvents = SubplaceEvents;\r\n    var SubplaceTabsHelper;\r\n    (function (SubplaceTabsHelper) {\r\n        function refreshWhenCurrentTabClicked($scope, $state) {\r\n            $scope.subplaceTabClicked = function (name) {\r\n                var currentTab = $state.includes('**.' + name + '.**');\r\n                if (currentTab) {\r\n                    $scope.$broadcast(SubplaceEvents.Refresh);\r\n                }\r\n                else {\r\n                    $scope.$broadcast(SubplaceEvents.RefreshCounts, name);\r\n                }\r\n            };\r\n        }\r\n        SubplaceTabsHelper.refreshWhenCurrentTabClicked = refreshWhenCurrentTabClicked;\r\n    })(SubplaceTabsHelper = VizPortal.SubplaceTabsHelper || (VizPortal.SubplaceTabsHelper = {}));\r\n    var SubplaceCountsHelper;\r\n    (function (SubplaceCountsHelper) {\r\n        function updateCountsFromSubplace($scope, subplace, count) {\r\n            $scope.subplaceCounts[subplace.name] = count;\r\n        }\r\n        SubplaceCountsHelper.updateCountsFromSubplace = updateCountsFromSubplace;\r\n        function keepSubplaceCountsUpdated($scope, place) {\r\n            var subplaceFilters = {};\r\n            $scope.subplaceCounts = $scope.subplaceCounts || {};\r\n            var refreshCounts = function (force) {\r\n                _.each(place.subplaces(), function (subplace) {\r\n                    var name = subplace.name;\r\n                    var query = subplace.query();\r\n                    var newFilters = query.getFilters();\r\n                    if (force || !_.isEqual(newFilters, subplaceFilters[name])) {\r\n                        subplaceFilters[name] = newFilters;\r\n                        query.getCount().then(function (count) {\r\n                            $scope.subplaceCounts[subplace.name] = count;\r\n                        });\r\n                    }\r\n                });\r\n            };\r\n            $scope.$on('$locationChangeSuccess', function () {\r\n                refreshCounts();\r\n            });\r\n            $scope.$on(SubplaceEvents.RefreshCounts, function () {\r\n                refreshCounts(true);\r\n            });\r\n            refreshCounts();\r\n        }\r\n        SubplaceCountsHelper.keepSubplaceCountsUpdated = keepSubplaceCountsUpdated;\r\n    })(SubplaceCountsHelper = VizPortal.SubplaceCountsHelper || (VizPortal.SubplaceCountsHelper = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/ILayout.ts\" />\r\n/// <reference path=\"../models/ISize.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var FlowLayout = (function () {\r\n        function FlowLayout(itemWidth, itemHeight) {\r\n            this.itemWidth = itemWidth;\r\n            this.itemHeight = itemHeight;\r\n        }\r\n        FlowLayout.prototype.metrics = function (dimensions) {\r\n            return {\r\n                numberOfRows: Math.max(Math.ceil(dimensions.height / this.itemHeight), 1),\r\n                numberOfCols: Math.max(Math.floor(dimensions.width / this.itemWidth), 1),\r\n                heightOfRowInPx: this.itemHeight\r\n            };\r\n        };\r\n        return FlowLayout;\r\n    })();\r\n    VizPortal.FlowLayout = FlowLayout;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var HelpService = (function () {\r\n        function HelpService($window, server) {\r\n            this.$window = $window;\r\n            this.server = server;\r\n        }\r\n        HelpService.prototype.search = function (searchText) {\r\n            searchText = encodeURIComponent(searchText);\r\n            if (this.server.offlineHelpEnabled()) {\r\n                // Example: http://localhost/offline_help/en_us/help.htm#search-workbooks\r\n                this.$window.open(this.offlineHelpRoute('search-') + searchText, '_blank');\r\n            }\r\n            else {\r\n                // Example: http://www.tableau.com/search/support/workbooks\r\n                this.$window.open(this.supportUrlPrefix() + '/search/support/' + searchText, '_blank');\r\n            }\r\n        };\r\n        HelpService.prototype.getServerHelpUrlByCategory = function (category) {\r\n            if (this.server.offlineHelpEnabled()) {\r\n                return this.offlineHelpRoute(HelpService.ONLINE_TOKEN_OFFLINE_PAGE_DICT[category]);\r\n            }\r\n            else {\r\n                var lang = this.helpUrlLanguage();\r\n                // Params must be ordered: edition, lang, version\r\n                var query = $.param({\r\n                    'edition': this.server.helpEdition(),\r\n                    'lang': lang,\r\n                    'version': this.externalVersion()\r\n                });\r\n                // Example: http://www.tableau.com/en-us/app/server-views1?edition=server&lang=en-us&version=9.0\r\n                return HelpService.tableauUrl + '/' + lang + '/app/' + 'server-' + (category ? category : 'help1') + '?' + query;\r\n            }\r\n        };\r\n        HelpService.prototype.getGeneralSupportUrl = function () {\r\n            if (this.server.helpEdition() !== 'online') {\r\n                return this.supportUrlPrefix() + '/support';\r\n            }\r\n            // Open a support request (i.e., Zeus support form)\r\n            return 'https://' + this.server.sessionSupportHost() + this.server.sessionSupportPath() +\r\n                '?' + $.param({\r\n                'uid': this.server.sessionAuthUserId(),\r\n                'serverSiteUserId': this.server.sessionUserId(),\r\n                'serverSiteId': this.server.sessionSiteLuid(),\r\n                'serverInstanceId': this.server.sessionServerId()\r\n            });\r\n        };\r\n        HelpService.prototype.getDatasourceHelpUrl = function () {\r\n            var datasourceHelpUrl = this.server.datasourceHelpUrl();\r\n            if (!datasourceHelpUrl) {\r\n                return '';\r\n            }\r\n            var queryConnector = (datasourceHelpUrl.indexOf('?') >= 0) ? '&' : '?';\r\n            var query = $.param({\r\n                'lang': this.helpUrlLanguage(),\r\n                'version': this.externalVersion()\r\n            });\r\n            return datasourceHelpUrl + queryConnector + query;\r\n        };\r\n        HelpService.prototype.getHelpLinkLocKey = function () {\r\n            return this.server.helpEdition() === 'online' ? 'onlineHelp' : 'serverHelp';\r\n        };\r\n        // Helpers\r\n        HelpService.prototype.supportUrlPrefix = function () {\r\n            var lang = this.helpUrlLanguage();\r\n            return HelpService.tableauUrl + (lang === 'en-us' ? '' : '/' + lang);\r\n        };\r\n        HelpService.prototype.offlineHelpRoute = function (page) {\r\n            var lang = this.helpUrlLanguage().replace('-', '_');\r\n            return 'offline_help/' + lang + '/help.htm' + (page ? '#' + page : '');\r\n        };\r\n        HelpService.prototype.externalVersion = function () {\r\n            var version = this.server.sessionServerVersion().externalVersion;\r\n            var intRegExp = /^\\d+$/;\r\n            if (intRegExp.test(version.major) && intRegExp.test(version.minor)) {\r\n                return version.major + '.' + version.minor;\r\n            }\r\n            else {\r\n                return '0.0';\r\n            }\r\n        };\r\n        HelpService.prototype.helpUrlLanguage = function () {\r\n            switch (this.server.sessionLanguage()) {\r\n                case \"de\": return \"de-de\";\r\n                case \"en\": return \"en-us\";\r\n                case \"es\": return \"es-es\";\r\n                case \"fr\": return \"fr-fr\";\r\n                case \"ja\": return \"ja-jp\";\r\n                case \"ko\": return \"ko-kr\";\r\n                case \"pt\": return \"pt-br\";\r\n                case \"zh\": return \"zh-cn\";\r\n                default: return 'en-us';\r\n            }\r\n        };\r\n        // Needed for offline help, see wgapp/app/mixins/help_support.rb\r\n        HelpService.ONLINE_TOKEN_OFFLINE_PAGE_DICT = {\r\n            'adminusers2': 'csvguidelines.htm',\r\n            'status1': 'service_viewstatus.htm',\r\n            'settings-adsync1': 'groups_globalsync.htm'\r\n        };\r\n        HelpService.tableauUrl = 'http://www.tableau.com';\r\n        HelpService.$inject = [\r\n            '$window',\r\n            'ServerService'\r\n        ];\r\n        return HelpService;\r\n    })();\r\n    VizPortal.HelpService = HelpService;\r\n    VizPortal.Module.instance().service('HelpService', HelpService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var Dispatcher;\r\n    (function (Dispatcher) {\r\n        Dispatcher.instance = new Flux.Dispatcher();\r\n    })(Dispatcher = VizPortalReact.Dispatcher || (VizPortalReact.Dispatcher = {}));\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../ts/ServerApi/types/IOrderClause.ts\" />\r\n/// <reference path=\"Dispatcher.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    function SetOrderAction(order) {\r\n        var payload = {\r\n            actionType: SetOrderAction.Type,\r\n            order: order\r\n        };\r\n        VizPortalReact.Dispatcher.instance.dispatch(payload);\r\n    }\r\n    VizPortalReact.SetOrderAction = SetOrderAction;\r\n    var SetOrderAction;\r\n    (function (SetOrderAction) {\r\n        SetOrderAction.Type = 'set-order';\r\n    })(SetOrderAction = VizPortalReact.SetOrderAction || (VizPortalReact.SetOrderAction = {}));\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    /**\r\n    * TODO: use Event Emitter?\r\n    */\r\n    var Store = (function () {\r\n        function Store() {\r\n            this.changeListeners = [];\r\n        }\r\n        Store.prototype.addChangeListener = function (cb) {\r\n            this.changeListeners = this.changeListeners.concat(cb);\r\n        };\r\n        Store.prototype.removeChangeListener = function (cb) {\r\n            this.changeListeners = _.without(this.changeListeners, cb);\r\n        };\r\n        Store.prototype.broadcast = function () {\r\n            var args = [];\r\n            for (var _i = 0; _i < arguments.length; _i++) {\r\n                args[_i - 0] = arguments[_i];\r\n            }\r\n            this.changeListeners.map(function (cb) {\r\n                // Note: change listeners should be pre-bound to the correct value of 'this'.\r\n                cb.apply(null, args);\r\n            });\r\n        };\r\n        return Store;\r\n    })();\r\n    VizPortalReact.Store = Store;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../ts/ServerApi/types/IOrderClause.ts\" />\r\n/// <reference path=\"Dispatcher.ts\" />\r\n/// <reference path=\"OrderActions.ts\" />\r\n/// <reference path=\"Store.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var OrderStore = (function (_super) {\r\n        __extends(OrderStore, _super);\r\n        function OrderStore(order) {\r\n            var _this = this;\r\n            _super.call(this);\r\n            this.order = order;\r\n            VizPortalReact.Dispatcher.instance.register(function (payload) {\r\n                switch (payload.actionType) {\r\n                    case VizPortalReact.SetOrderAction.Type:\r\n                        _this.order = payload.order;\r\n                        _this.broadcast();\r\n                }\r\n            });\r\n        }\r\n        OrderStore.prototype.getOrderClauses = function () {\r\n            return this.order;\r\n        };\r\n        return OrderStore;\r\n    })(VizPortalReact.Store);\r\n    VizPortalReact.OrderStore = OrderStore;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/Order.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/types/IOrderClause.ts\" />\r\n/// <reference path=\"../../common/react/OrderStore.ts\" />\r\n/// <reference path=\"../../common/react/OrderActions.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SorterFactory = (function () {\r\n        function SorterFactory($location) {\r\n            this.$location = $location;\r\n        }\r\n        SorterFactory.prototype.create = function (defaultOrder) {\r\n            return new Sorter(this.$location, defaultOrder);\r\n        };\r\n        SorterFactory.$inject = ['$location'];\r\n        return SorterFactory;\r\n    })();\r\n    VizPortal.SorterFactory = SorterFactory;\r\n    var Sorter = (function () {\r\n        function Sorter($location, defaultOrder) {\r\n            this.$location = $location;\r\n            this.defaultOrder = defaultOrder;\r\n            this.orderStore = new VizPortalReact.OrderStore(defaultOrder);\r\n        }\r\n        Sorter.prototype.setPrimary = function (field, direction) {\r\n            if (!field) {\r\n                return;\r\n            }\r\n            var order = this.orderStore.getOrderClauses();\r\n            if (VizPortal.Order.startsWithField(order, field)) {\r\n                if (_.isEqual(order, this.defaultOrder) && order.length > 0) {\r\n                    // keep the first clause of the default order\r\n                    order = order.slice(0, 1);\r\n                }\r\n                order = VizPortal.Order.withFirstClauseToggled(order);\r\n            }\r\n            else {\r\n                if (_.isEqual(order, this.defaultOrder)) {\r\n                    // clear the order so that default order clauses don't get inserted into the URL\r\n                    order = [];\r\n                }\r\n                order = VizPortal.Order.withClausePrepended(order, { field: field, ascending: direction === 'asc' });\r\n            }\r\n            VizPortalReact.SetOrderAction(order);\r\n            this.updateOrder();\r\n        };\r\n        Sorter.prototype.removeFieldFromOrder = function (field) {\r\n            var order = this.orderStore.getOrderClauses();\r\n            order = VizPortal.Order.withoutField(order, field);\r\n            if (!order.length) {\r\n                // if the order is now empty, revert back to the default.\r\n                order = this.defaultOrder;\r\n            }\r\n            VizPortalReact.SetOrderAction(order);\r\n            this.updateOrder();\r\n        };\r\n        Sorter.prototype.setOrder = function (order) {\r\n            VizPortalReact.SetOrderAction(order);\r\n            this.updateOrder();\r\n        };\r\n        Sorter.prototype.getOrderClauses = function () {\r\n            return this.orderStore.getOrderClauses();\r\n        };\r\n        Sorter.prototype.isSortAscending = function () {\r\n            var order = this.orderStore.getOrderClauses();\r\n            return order[0].ascending;\r\n        };\r\n        Sorter.prototype.selectedColumnKey = function () {\r\n            var order = this.orderStore.getOrderClauses();\r\n            return order.length > 0 ? order[0].field : '';\r\n        };\r\n        Sorter.prototype.isSortAscendingBy = function (key) {\r\n            return this.selectedColumnKey() === key && this.isSortAscending();\r\n        };\r\n        Sorter.prototype.isSortDescendingBy = function (key) {\r\n            return this.selectedColumnKey() === key && !this.isSortAscending();\r\n        };\r\n        /**\r\n         * Returns the order store so that react components can be notified when the order changes.\r\n         * TODO: Refactor this so that the OrderStore is a dependency that is injected to the Sorter's constructor.\r\n         *       Then this method can be removed.\r\n         */\r\n        Sorter.prototype.getOrderStore = function () {\r\n            return this.orderStore;\r\n        };\r\n        Sorter.prototype.updateOrder = function () {\r\n            var order = this.orderStore.getOrderClauses();\r\n            if (order && order.length > 0) {\r\n                // If the new order is the same as the default, just clear the URL parameter.\r\n                this.$location.search('order', _.isEqual(order, this.defaultOrder) ? null : VizPortal.Order.serialize(order));\r\n            }\r\n        };\r\n        return Sorter;\r\n    })();\r\n    VizPortal.Sorter = Sorter;\r\n    VizPortal.Module.instance().service('SorterFactory', SorterFactory);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../ts/libs.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    /*\r\n     * Constructs urls for site pages, given the site name and query string.\r\n     *\r\n     * e.g.\r\n     *\r\n     *   var siteUrls = new SiteUrls({ siteUrlName: 'mysite', queryString: 'foo=bar' });\r\n     *\r\n     *   siteUrls.projectUrl(12);    // returns '/?foo=bar#/site/mysite/projects/12'\r\n     *\r\n     */\r\n    var SiteUrls = (function () {\r\n        function SiteUrls(config) {\r\n            // Sanitize inputs and calculate prefix\r\n            var queryString = _.isString(config.queryString) ? config.queryString : '';\r\n            // Insert a '?' if necessary\r\n            if (queryString && queryString.length > 0 && queryString[0] !== '?') {\r\n                queryString = '?' + queryString;\r\n            }\r\n            var siteUrlFragment = _.isString(config.siteUrlName) && config.siteUrlName.length > 0\r\n                ? '/site/' + config.siteUrlName\r\n                : '';\r\n            this.prefix = '/' + queryString + '#' + siteUrlFragment;\r\n            this.queryString = queryString;\r\n        }\r\n        // Returns a copy of SiteUrls modified for a different siteUrlName\r\n        SiteUrls.prototype.forSiteUrlName = function (siteUrlName) {\r\n            return new SiteUrls({\r\n                siteUrlName: siteUrlName,\r\n                queryString: this.queryString\r\n            });\r\n        };\r\n        // Home\r\n        SiteUrls.prototype.home = function () {\r\n            return this.prefix + '/home';\r\n        };\r\n        // Projects\r\n        SiteUrls.prototype.projectUrl = function (projectId) {\r\n            return this.prefix + '/projects/' + projectId;\r\n        };\r\n        SiteUrls.prototype.projectViewsUrl = function (projectId) {\r\n            return this.projectUrl(projectId) + '/views';\r\n        };\r\n        SiteUrls.prototype.projectsUrl = function () {\r\n            return this.prefix + '/projects';\r\n        };\r\n        // Workbooks\r\n        SiteUrls.prototype.workbookUrl = function (workbookId) {\r\n            return this.prefix + '/workbooks/' + workbookId;\r\n        };\r\n        SiteUrls.prototype.workbookViewsUrl = function (workbookId) {\r\n            return this.workbookUrl(workbookId) + '/views';\r\n        };\r\n        SiteUrls.prototype.workbookDatasourcesUrl = function (workbookId) {\r\n            return this.workbookUrl(workbookId) + '/datasources';\r\n        };\r\n        SiteUrls.prototype.favoriteWorkbook = function (workbookId) {\r\n            return this.workbookUrl(workbookId);\r\n        };\r\n        // Views\r\n        SiteUrls.prototype.viewUrl = function (viewPath) {\r\n            return this.prefix + '/views/' + viewPath;\r\n        };\r\n        SiteUrls.prototype.favoriteView = function (viewId) {\r\n            return this.prefix + '/redirect_to_view/' + viewId;\r\n        };\r\n        // Users\r\n        SiteUrls.prototype.usersUrl = function () {\r\n            return this.prefix + '/users';\r\n        };\r\n        SiteUrls.prototype.userContentUrl = function (user) {\r\n            return this.prefix + '/user/' + user.domainName + '/' + user.username + '/workbooks';\r\n        };\r\n        SiteUrls.prototype.userSettingsUrl = function (user) {\r\n            return this.prefix + '/user/' + user.domainName + '/' + user.username + '/settings';\r\n        };\r\n        // Data sources\r\n        SiteUrls.prototype.datasourceUrl = function (datasourceId) {\r\n            return this.prefix + '/datasources/' + datasourceId;\r\n        };\r\n        SiteUrls.prototype.datasourceDetailsUrl = function (datasourceId) {\r\n            return this.datasourceUrl(datasourceId) + '/details';\r\n        };\r\n        SiteUrls.prototype.datasourceDataConnectionUrl = function (datasourceId) {\r\n            return this.datasourceUrl(datasourceId) + '/dataConnection';\r\n        };\r\n        // Groups\r\n        SiteUrls.prototype.groupsUrl = function () {\r\n            return this.prefix + '/groups';\r\n        };\r\n        SiteUrls.prototype.group = function (groupId) {\r\n            return this.prefix + '/groups/' + groupId;\r\n        };\r\n        // Schedules\r\n        SiteUrls.prototype.schedule = function (scheduleId, scheduledAction) {\r\n            return this.prefix + '/schedules/' + scheduleId + '/' +\r\n                (scheduledAction === VizPortal.ServerApi.ScheduleActions.Extract ? 'extractRefreshes' : 'subscriptions');\r\n        };\r\n        SiteUrls.prototype.schedulesUrl = function () {\r\n            return this.prefix + '/schedules';\r\n        };\r\n        // Others\r\n        SiteUrls.prototype.settingsUrl = function () {\r\n            return this.prefix + '/settings';\r\n        };\r\n        SiteUrls.prototype.statusUrl = function () {\r\n            return this.prefix + '/status';\r\n        };\r\n        SiteUrls.prototype.tasksUrl = function () {\r\n            return this.prefix + '/tasks';\r\n        };\r\n        return SiteUrls;\r\n    })();\r\n    VizPortalReact.SiteUrls = SiteUrls;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    /**\r\n    * This class is used as a facade for react components to communicate back with the angular world.\r\n    * TODO: rename this file to AngularContextFactory\r\n    */\r\n    var AngularContext = (function () {\r\n        function AngularContext($scope, $injector, $compile) {\r\n            this.$scope = $scope;\r\n            this.$injector = $injector;\r\n            this.$compile = $compile;\r\n        }\r\n        AngularContext.prototype.compileElement = function (element, setupScope) {\r\n            var $scope = setupScope ? setupScope(this.$scope) : this.$scope;\r\n            this.$compile(element)($scope);\r\n            return element;\r\n        };\r\n        AngularContext.prototype.getService = function (name) {\r\n            return this.$injector.get(name);\r\n        };\r\n        AngularContext.prototype.enqueueDigest = function () {\r\n            // we can't call $digest directly because we might already be in a digest cycle and that would cause angular to throw.\r\n            // instead, schedule another digest to run later.\r\n            this.$scope.$evalAsync(angular.noop);\r\n        };\r\n        AngularContext.prototype.evalAsync = function (fn) {\r\n            this.$scope.$evalAsync(fn);\r\n        };\r\n        return AngularContext;\r\n    })();\r\n    VizPortal.AngularContext = AngularContext;\r\n    VizPortal.Module.instance().factory('AngularContextFactory', ['$injector', '$compile',\r\n        function ($injector, $compile) {\r\n            return {\r\n                create: function ($scope) { return new AngularContext($scope, $injector, $compile); }\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../../../ts/libs.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var DataGridFavoriteToggle = (function (_super) {\r\n        __extends(DataGridFavoriteToggle, _super);\r\n        function DataGridFavoriteToggle() {\r\n            _super.apply(this, arguments);\r\n        }\r\n        DataGridFavoriteToggle.prototype.shouldComponentUpdate = function (nextProps, nextState) {\r\n            return React.addons.PureRenderMixin.shouldComponentUpdate.call(this, nextProps, nextState);\r\n        };\r\n        DataGridFavoriteToggle.prototype.render = function () {\r\n            var _this = this;\r\n            var classes = ['tb-favorite-button'];\r\n            if (this.props.isFavorite) {\r\n                classes.push('tb-selected');\r\n            }\r\n            return React.DOM.span({\r\n                className: 'tb-favorite-button-cell',\r\n                onClick: function (event) { return _this.handleClick(event); },\r\n                'data-tb-test-id': this.props.testId\r\n            }, React.DOM.span({\r\n                className: classes.join(' ')\r\n            }));\r\n        };\r\n        DataGridFavoriteToggle.prototype.handleClick = function (event) {\r\n            if (this.props.onSetFavorite) {\r\n                this.props.onSetFavorite(!this.props.isFavorite);\r\n            }\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n        };\r\n        DataGridFavoriteToggle.displayName = 'DataGridFavoriteToggle';\r\n        DataGridFavoriteToggle.element = React.createFactory(DataGridFavoriteToggle);\r\n        return DataGridFavoriteToggle;\r\n    })(React.Component);\r\n    VizPortalReact.DataGridFavoriteToggle = DataGridFavoriteToggle;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../../../ts/libs.ts\" />\r\n/// <reference path=\"../../../../ts/models/IListScope.ts\" />\r\n/// <reference path=\"../../../../ts/controllers/AngularCtrl.ts\" />\r\n/// <reference path=\"../../CommonStyles.ts\" />\r\n/// <reference path=\"DataGridFavoriteToggle.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var DataGridCells;\r\n    (function (DataGridCells) {\r\n        //TODO - make cells subclasses of React.Component\r\n        function CheckboxCell(options) {\r\n            return React.createFactory(React.createClass({\r\n                handleClick: function (event) {\r\n                    var props = this.props;\r\n                    options.onCheckboxClicked(props.row);\r\n                    event.preventDefault();\r\n                    event.stopPropagation();\r\n                },\r\n                render: function () {\r\n                    var props = this.props;\r\n                    var classes = ['tb-checkbox'];\r\n                    if (props.isSelected) {\r\n                        classes.push('tb-checked');\r\n                    }\r\n                    return React.DOM.span({ className: 'tb-checkbox-cell', onClick: this.handleClick, 'data-tb-test-id': options.checkboxCellTestId }, React.DOM.span({ className: classes.join(' ') }));\r\n                }\r\n            }));\r\n        }\r\n        DataGridCells.CheckboxCell = CheckboxCell;\r\n        function FavoriteCell(options) {\r\n            return React.createFactory(React.createClass({\r\n                render: function () {\r\n                    var props = this.props;\r\n                    return VizPortalReact.DataGridFavoriteToggle.element({\r\n                        isFavorite: props.row.data.favorite,\r\n                        onSetFavorite: function (isFavorite) {\r\n                            if (isFavorite) {\r\n                                options.onAddFavorite(props.row);\r\n                            }\r\n                            else {\r\n                                options.onRemoveFavorite(props.row);\r\n                            }\r\n                        },\r\n                        testId: options.favoriteCellTestId\r\n                    });\r\n                }\r\n            }));\r\n        }\r\n        DataGridCells.FavoriteCell = FavoriteCell;\r\n        function ActionsCell(contentFormatter, options) {\r\n            return React.createFactory(React.createClass({\r\n                render: function () {\r\n                    var content = contentFormatter(this.props);\r\n                    if (options.menuDisabled && options.menuDisabled(this.props.row)) {\r\n                        return content;\r\n                    }\r\n                    return VizPortalReact.ActionsMenuColumnCell.element({\r\n                        actions: options.actions,\r\n                        getActionTarget: options.getActionTarget,\r\n                        translate: options.translate,\r\n                        testId: options.testId\r\n                    }, content);\r\n                }\r\n            }));\r\n        }\r\n        DataGridCells.ActionsCell = ActionsCell;\r\n        function SiteRoleCell(propertyName, $translate, testId) {\r\n            return React.createFactory(React.createClass({\r\n                render: function () {\r\n                    var props = this.props;\r\n                    var siteRoleName = props.row.data[propertyName];\r\n                    if (!siteRoleName) {\r\n                        return null;\r\n                    }\r\n                    var translationId = 'siteRole_' + siteRoleName;\r\n                    return React.DOM.span({ 'data-tb-test-id': testId }, $translate.instant(translationId));\r\n                }\r\n            }));\r\n        }\r\n        DataGridCells.SiteRoleCell = SiteRoleCell;\r\n        function UserDisplayNameCell(testId) {\r\n            return React.createFactory(React.createClass({\r\n                render: function () {\r\n                    var props = this.props;\r\n                    var nameElement = React.DOM.a({ href: '/#/user/' + props.row.data.domainName +\r\n                            '/' + props.row.data.username + '/workbooks' }, props.value);\r\n                    if (props.row.data.siteRole === 'Guest') {\r\n                        nameElement = React.DOM.span({}, props.value);\r\n                    }\r\n                    return React.DOM.span({ 'data-tb-test-id': testId }, React.DOM.span({ className: 'tb-grid-icon-user' }), nameElement);\r\n                }\r\n            }));\r\n        }\r\n        DataGridCells.UserDisplayNameCell = UserDisplayNameCell;\r\n        function Link(linkFn) {\r\n            return React.createFactory(React.createClass({\r\n                render: function () {\r\n                    var link = linkFn(this.props.row);\r\n                    var linkElement = React.DOM.a({\r\n                        href: link.url,\r\n                        title: link.text,\r\n                        style: link.style\r\n                    }, link.text);\r\n                    return React.DOM.span({\r\n                        'data-tb-test-id': link.testId\r\n                    }, React.DOM.span({ className: link.iconClassName, title: link.iconTitle }), linkElement);\r\n                }\r\n            }));\r\n        }\r\n        DataGridCells.Link = Link;\r\n        function FixedValue(value) {\r\n            return React.createFactory(React.createClass({\r\n                render: function () {\r\n                    return React.DOM.span({ 'title': value }, value);\r\n                }\r\n            }));\r\n        }\r\n        DataGridCells.FixedValue = FixedValue;\r\n        function PlainTextCell(propertyName, testId) {\r\n            return React.createFactory(React.createClass({\r\n                render: function () {\r\n                    var props = this.props;\r\n                    var text = props.row.data[propertyName];\r\n                    return React.DOM.span({ 'title': text, 'data-tb-test-id': testId }, text);\r\n                }\r\n            }));\r\n        }\r\n        DataGridCells.PlainTextCell = PlainTextCell;\r\n        function PlainTextCellWithTransform(propertyName, transform, testId) {\r\n            return React.createFactory(React.createClass({\r\n                render: function () {\r\n                    var props = this.props;\r\n                    var text = transform(props.row.data[propertyName]);\r\n                    return React.DOM.span({ 'title': text, 'data-tb-test-id': testId }, text);\r\n                }\r\n            }));\r\n        }\r\n        DataGridCells.PlainTextCellWithTransform = PlainTextCellWithTransform;\r\n        function DateTimeCell(propertyName, nullDateTimeLabel, testId) {\r\n            return React.createFactory(React.createClass({\r\n                render: function () {\r\n                    var props = this.props;\r\n                    var dateTime = props.row.data[propertyName];\r\n                    return React.DOM.span({ 'data-tb-test-id': testId }, dateTime ? VizPortal.L10n.localizedDateTime(dateTime) : nullDateTimeLabel);\r\n                }\r\n            }));\r\n        }\r\n        DataGridCells.DateTimeCell = DateTimeCell;\r\n        function SizeCell(propertyName, sizeFilter, testId) {\r\n            return React.createFactory(React.createClass({\r\n                render: function () {\r\n                    var props = this.props;\r\n                    var sizeInBytes = props.row.data[propertyName];\r\n                    return React.DOM.span({ 'data-tb-test-id': testId }, sizeFilter(sizeInBytes));\r\n                }\r\n            }));\r\n        }\r\n        DataGridCells.SizeCell = SizeCell;\r\n        function Checkmark(propertyName) {\r\n            var propertyNameParts = propertyName.split('.');\r\n            return React.createFactory(React.createClass({\r\n                render: function () {\r\n                    var value = this.props.row.data;\r\n                    _.each(propertyNameParts, function (part) {\r\n                        value = value[part];\r\n                    });\r\n                    return React.DOM.span({\r\n                        className: value ? 'tb-icon-checkmark' : null\r\n                    });\r\n                }\r\n            }));\r\n        }\r\n        DataGridCells.Checkmark = Checkmark;\r\n        //TODO - remove this and use React actions menu instead\r\n        function AngularActionsCell(angularContext) {\r\n            return React.createFactory(React.createClass({\r\n                render: function () {\r\n                    return VizPortalReact.AngularDirective.element({\r\n                        angularContext: angularContext,\r\n                        template: \"<tb:popup-menu>\" +\r\n                            \"  <tb:popup-menu-custom-button class='tb-data-grid-action-menu'>\" +\r\n                            \"    <span class='tb-action-icon'></span>\" +\r\n                            \"  </tb:popup-menu-custom-button>\" +\r\n                            \"  <tb:popup-menu-content>\" +\r\n                            \"    <div ng-include=\\\"'actionMenu.html'\\\"></div>\" +\r\n                            \"  </tb:popup-menu-content>\" +\r\n                            \"</tb:popup-menu>\"\r\n                    });\r\n                }\r\n            }));\r\n        }\r\n        DataGridCells.AngularActionsCell = AngularActionsCell;\r\n        function LocalizedCount(propertyName, testId) {\r\n            return React.createFactory(React.createClass({\r\n                render: function () {\r\n                    var props = this.props;\r\n                    var count = props.row.data[propertyName];\r\n                    var localizedCount = VizPortal.L10n.localizedCount(count);\r\n                    return React.DOM.span({ 'data-tb-test-id': testId }, localizedCount);\r\n                }\r\n            }));\r\n        }\r\n        DataGridCells.LocalizedCount = LocalizedCount;\r\n        function LocalizedCountWithBar(dataKey, maxStatsObject, testId) {\r\n            return React.createFactory(React.createClass({\r\n                render: function () {\r\n                    var props = this.props;\r\n                    var count = props.row.data[dataKey];\r\n                    var localizedCount = VizPortal.L10n.localizedCount(count);\r\n                    var max = maxStatsObject(props.row.data)[dataKey];\r\n                    var normalizedValue = max ? (count / max) : 0;\r\n                    var barVerticalMargin = VizPortal.FeatureFlags.useTallerRowHeight ?\r\n                        VizPortalReact.CommonStyles.Sizes.DefaultSpace : VizPortalReact.CommonStyles.Sizes.SmallSpace;\r\n                    return React.DOM.div({\r\n                        style: {\r\n                            marginTop: barVerticalMargin,\r\n                            height: VizPortalReact.DataGrid.BodyRow.InnerHeight - (2 * barVerticalMargin),\r\n                            width: (normalizedValue * 100) + '%',\r\n                            backgroundColor: props.isSelected ?\r\n                                VizPortalReact.CommonStyles.Colors.Grey245 : VizPortalReact.CommonStyles.Colors.Grey218\r\n                        },\r\n                        'data-tb-test-id': testId\r\n                    }, React.DOM.span({\r\n                        style: {\r\n                            lineHeight: VizPortalReact.DataGrid.BodyRow.InnerHeight - (2 * barVerticalMargin) + 'px',\r\n                            paddingLeft: VizPortalReact.CommonStyles.Sizes.DefaultSpace,\r\n                            verticalAlign: 'top'\r\n                        }\r\n                    }, localizedCount));\r\n                }\r\n            }));\r\n        }\r\n        DataGridCells.LocalizedCountWithBar = LocalizedCountWithBar;\r\n        function AlertCell(type, translate, angularContext, testId) {\r\n            return React.createFactory(React.createClass({\r\n                render: function () {\r\n                    var props = this.props;\r\n                    var hasAlert = props.row.data['hasAlert'];\r\n                    if (!hasAlert) {\r\n                        return null;\r\n                    }\r\n                    var id = props.row.data['id'];\r\n                    return VizPortalReact.Menu.element({\r\n                        tbTestId: testId,\r\n                        menuButtonFactory: function () { return React.DOM.span({\r\n                            className: 'tb-data-grid-icon tb-icon-alert',\r\n                            'data-tb-test-id': testId,\r\n                            title: translate('hasAlert')\r\n                        }, ''); },\r\n                        menuPanelFactory: function () {\r\n                            // TODO: rewrite tb:alert-info as a React component\r\n                            return VizPortalReact.AngularDirective.element({\r\n                                angularContext: angularContext,\r\n                                template: \"<div class='tb-popup-menu-content tb-padded-small' style='min-width: 250px; white-space: normal; line-height: normal'>\" +\r\n                                    \"  <tb:alert-info type=\\\"'\" + type + \"'\\\" id=\\\"'\" + id + \"'\\\"></tb:alert-info>\" +\r\n                                    \"</div>\"\r\n                            });\r\n                        }\r\n                    });\r\n                }\r\n            }));\r\n        }\r\n        DataGridCells.AlertCell = AlertCell;\r\n        function ScheduleDescriptionCell(scheduleUrlFn, scheduleFrequencyDescriptionFilter) {\r\n            return React.createFactory(React.createClass({\r\n                render: function () {\r\n                    var row = this.props.row;\r\n                    var schedule = row.data.schedule;\r\n                    return React.DOM.span({}, React.DOM.a({\r\n                        href: scheduleUrlFn(row),\r\n                        title: schedule.name\r\n                    }, schedule.name), React.DOM.span({ dangerouslySetInnerHTML: { __html: '&nbsp;&ndash;&nbsp;' } }), React.DOM.span({}, scheduleFrequencyDescriptionFilter(schedule)));\r\n                }\r\n            }));\r\n        }\r\n        DataGridCells.ScheduleDescriptionCell = ScheduleDescriptionCell;\r\n    })(DataGridCells = VizPortalReact.DataGridCells || (VizPortalReact.DataGridCells = {}));\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"components/dataGrid/DataGridCells.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var CommonDataGridColumns;\r\n    (function (CommonDataGridColumns) {\r\n        function withActions(originalColumn, actionOptions) {\r\n            return _.extend({}, originalColumn, {\r\n                cellFormatter: VizPortalReact.DataGridCells.ActionsCell(originalColumn.cellFormatter, actionOptions),\r\n                cellStyle: _.extend({}, originalColumn.cellStyle, {\r\n                    paddingRight: 0,\r\n                    overflow: 'visible' // To let the action menu extend beyond the row\r\n                })\r\n            });\r\n        }\r\n        CommonDataGridColumns.withActions = withActions;\r\n        // The $scope parameter can be any scope that has a 'selectedItems' member.\r\n        function selected($scope) {\r\n            return {\r\n                name: 'selected-col',\r\n                dataKey: 'selected',\r\n                text: '',\r\n                cellFormatter: VizPortalReact.DataGridCells.CheckboxCell({\r\n                    onCheckboxClicked: function (row) { return toggleSelection($scope, row); }\r\n                }),\r\n                resizable: false,\r\n                sortable: false,\r\n                cellStyle: {\r\n                    padding: 0\r\n                }\r\n            };\r\n        }\r\n        CommonDataGridColumns.selected = selected;\r\n        function favorite($scope) {\r\n            return {\r\n                name: 'favorite-col',\r\n                dataKey: 'favorite',\r\n                text: '',\r\n                cellFormatter: VizPortalReact.DataGridCells.FavoriteCell({\r\n                    onAddFavorite: function (row) { return addFavorite($scope, row); },\r\n                    onRemoveFavorite: function (row) { return removeFavorite($scope, row); }\r\n                }),\r\n                resizable: false,\r\n                sortable: false,\r\n                cellStyle: {\r\n                    padding: 0\r\n                }\r\n            };\r\n        }\r\n        CommonDataGridColumns.favorite = favorite;\r\n        function toggleSelection($scope, row) {\r\n            $scope.$apply(function () {\r\n                $scope.selectedItems.toggle(row.data);\r\n            });\r\n        }\r\n        function addFavorite($scope, row) {\r\n            $scope.$apply(function () {\r\n                $scope.addFavorite(row.data);\r\n                row.data.favorite = true;\r\n                $scope.dataGridProps.update++;\r\n            });\r\n        }\r\n        function removeFavorite($scope, row) {\r\n            $scope.$apply(function () {\r\n                $scope.removeFavorite(row.data);\r\n                row.data.favorite = false;\r\n                $scope.dataGridProps.update++;\r\n            });\r\n        }\r\n        function owner(translate, siteUrls, getOwnerFn) {\r\n            return {\r\n                name: 'owner-name-col',\r\n                dataKey: 'ownerName',\r\n                text: translate('column_owner'),\r\n                direction: 'asc',\r\n                cellFormatter: VizPortalReact.DataGridCells.Link(function (row) {\r\n                    var owner = getOwnerFn ? getOwnerFn(row) : row.data.owner;\r\n                    return {\r\n                        text: owner.displayName,\r\n                        url: siteUrls.userContentUrl(owner)\r\n                    };\r\n                })\r\n            };\r\n        }\r\n        CommonDataGridColumns.owner = owner;\r\n        function alert(type, translate, angularContext) {\r\n            return {\r\n                name: 'has-alert-col',\r\n                dataKey: 'hasAlert',\r\n                text: '',\r\n                tooltip: translate('column_has_alert'),\r\n                resizable: false,\r\n                cellFormatter: VizPortalReact.DataGridCells.AlertCell(type, translate, angularContext),\r\n                headerStyle: {\r\n                    backgroundImage: 'url(img/alert_list_header_normal.png)',\r\n                    backgroundRepeat: 'no-repeat',\r\n                    backgroundPosition: 'center',\r\n                    width: 19\r\n                },\r\n                cellStyle: {\r\n                    overflow: 'visible' // To let the alert drop-down extend beyond the cell\r\n                }\r\n            };\r\n        }\r\n        CommonDataGridColumns.alert = alert;\r\n    })(CommonDataGridColumns = VizPortalReact.CommonDataGridColumns || (VizPortalReact.CommonDataGridColumns = {}));\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../../../ts/libs.ts\" />\r\n/// <reference path=\"../../../../ts/FeatureFlags.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var DataGrid = (function (_super) {\r\n        __extends(DataGrid, _super);\r\n        function DataGrid() {\r\n            _super.apply(this, arguments);\r\n            this.state = {\r\n                measuredHeaderWidths: null,\r\n                measuredColumnWidths: null,\r\n                colWidths: null,\r\n                scrollLeft: 0,\r\n                rows: null,\r\n                isShowingLoadingIndicator: true\r\n            };\r\n        }\r\n        DataGrid.prototype.componentDidMount = function () {\r\n            var rect = React.findDOMNode(this).getBoundingClientRect();\r\n            this.gridWidth = Math.ceil(rect.right - rect.left);\r\n            // Fetch an initial set of rows\r\n            this.fetchInitialData(this.props);\r\n        };\r\n        DataGrid.prototype.componentWillReceiveProps = function (nextProps) {\r\n            // When componentWillRecieveProps is called, this.props is not (yet) equal to the new props.\r\n            this.fetchInitialData(nextProps);\r\n        };\r\n        DataGrid.prototype.fetchInitialData = function (props) {\r\n            this.setState({ isShowingLoadingIndicator: true });\r\n            this.fetchUsingProps(props, 0, 0);\r\n        };\r\n        DataGrid.prototype.fetch = function (start, end) {\r\n            this.fetchUsingProps(this.props, start, end);\r\n        };\r\n        DataGrid.prototype.fetchUsingProps = function (props, start, end) {\r\n            var _this = this;\r\n            if (props.rowStore) {\r\n                props.rowStore.getItems(start, end).then(function (rows) {\r\n                    _this.setState({ rows: rows, isShowingLoadingIndicator: false }, function () {\r\n                        if (_this.props.updated) {\r\n                            _this.props.updated(rows);\r\n                        }\r\n                    });\r\n                });\r\n            }\r\n        };\r\n        DataGrid.prototype.onColumnResize = function (column, width) {\r\n            var newColumnWidth = {};\r\n            newColumnWidth[column.name] = width;\r\n            this.setState({ colWidths: React.addons.update(this.state.colWidths || {}, {\r\n                    $merge: newColumnWidth\r\n                }) });\r\n        };\r\n        DataGrid.prototype.handleClick = function (row, col) {\r\n            if (this.props.onCellClick) {\r\n                this.props.onCellClick(row.data, col.dataKey);\r\n            }\r\n        };\r\n        DataGrid.prototype.handleMeasureHeaderWidths = function (widths) {\r\n            var _this = this;\r\n            this.setState({ measuredHeaderWidths: widths }, function () { return _this.maybeUpdateColumnWidths(); });\r\n        };\r\n        DataGrid.prototype.handleMeasureColumnWidths = function (widths) {\r\n            var _this = this;\r\n            this.setState({ measuredColumnWidths: widths }, function () { return _this.maybeUpdateColumnWidths(); });\r\n        };\r\n        DataGrid.prototype.maybeUpdateColumnWidths = function () {\r\n            var _this = this;\r\n            if (this.state.measuredColumnWidths && this.state.measuredHeaderWidths) {\r\n                // First pass - allocate column widths up to a maximum per column (MaxInitialColumnWidth)\r\n                var preferredWidths = {};\r\n                var widths = {};\r\n                var totalWidth = 0;\r\n                _.each(this.props.cols, function (col) {\r\n                    var columnKey = col.name;\r\n                    var preferredWidth;\r\n                    if (col.preferredWidth) {\r\n                        preferredWidth = col.preferredWidth;\r\n                    }\r\n                    else {\r\n                        preferredWidth = Math.max(_this.state.measuredColumnWidths[columnKey], _this.state.measuredHeaderWidths[columnKey]);\r\n                    }\r\n                    preferredWidths[columnKey] = preferredWidth;\r\n                    widths[columnKey] = Math.min(preferredWidth, DataGrid.MaxInitialColumnWidth);\r\n                    totalWidth += widths[columnKey];\r\n                });\r\n                // TODO: calculate content to determine if vertical scrollbar width is needed\r\n                // Second pass - allocate unused width in left-to-right column order up to each col's preferred width\r\n                var extraAvailable = this.gridWidth - DataGrid.ScrollbarWidth - totalWidth;\r\n                var growToFitCols = 0;\r\n                for (var i = 0; i < this.props.cols.length && extraAvailable > 0; i++) {\r\n                    var col = this.props.cols[i];\r\n                    var extraRequested = preferredWidths[col.name] - widths[col.name];\r\n                    if (extraRequested > 0) {\r\n                        var extraAllocated = Math.min(extraRequested, extraAvailable);\r\n                        widths[col.name] += extraAllocated;\r\n                        extraAvailable -= extraAllocated;\r\n                    }\r\n                    if (col.growToFit) {\r\n                        growToFitCols += 1;\r\n                    }\r\n                }\r\n                // Third pass - allocate remaining width evenly to any growToFit columns\r\n                if (extraAvailable > 0 && growToFitCols > 0) {\r\n                    var extraWidth = extraAvailable / growToFitCols;\r\n                    _.each(this.props.cols, function (col) {\r\n                        if (col.growToFit) {\r\n                            widths[col.name] += extraWidth;\r\n                        }\r\n                    });\r\n                }\r\n                this.setState({ colWidths: widths });\r\n            }\r\n        };\r\n        DataGrid.prototype.render = function () {\r\n            var cols = this.props.cols;\r\n            var rows = this.state.rows;\r\n            var colWidths = this.state.colWidths;\r\n            var scrollLeft = this.state.scrollLeft;\r\n            var children = [];\r\n            if (_.isArray(rows)) {\r\n                // Header\r\n                children.push(DataGrid.HeaderRow.element({\r\n                    key: 'header',\r\n                    cols: cols,\r\n                    colWidths: colWidths || this.getProvisionalColumnWidths(),\r\n                    sortKey: this.props.sortKey,\r\n                    sortAscending: this.props.sortAscending !== false,\r\n                    onHeaderClicked: this.props.onHeaderClicked ? this.props.onHeaderClicked.bind(this) : null,\r\n                    measureColumnWidths: !colWidths && this.handleMeasureHeaderWidths.bind(this),\r\n                    scrollLeft: scrollLeft,\r\n                    onColumnResize: this.onColumnResize.bind(this)\r\n                }));\r\n                // Body\r\n                if (rows.length > 0) {\r\n                    children.push(DataGrid.Body.element({\r\n                        key: 'body',\r\n                        cols: cols,\r\n                        colWidths: colWidths,\r\n                        measureColumnWidths: !colWidths && this.handleMeasureColumnWidths.bind(this),\r\n                        reportScrollLeftFn: this.bodyScrollLeft.bind(this),\r\n                        rows: rows,\r\n                        selectedKeys: this.props.selectedKeys || {},\r\n                        onClick: this.handleClick.bind(this),\r\n                        fetch: this.fetch.bind(this)\r\n                    }));\r\n                }\r\n                else {\r\n                    children.push(DataGrid.EmptyBody.element({\r\n                        key: 'emptyBody',\r\n                        emptyChild: this.props.emptyChild\r\n                    }));\r\n                }\r\n            }\r\n            if (VizPortal.FeatureFlags.reactDataGridLoadingIndicator) {\r\n                if (this.state.isShowingLoadingIndicator) {\r\n                    children.push(React.DOM.div({ className: 'tb-backdrop-white' }));\r\n                    children.push(React.DOM.span({ className: 'tb-loading-indicator' }));\r\n                }\r\n            }\r\n            return React.DOM.div({\r\n                className: 'tb-react-data-grid',\r\n                tabIndex: 0,\r\n                style: {\r\n                    outline: 'none'\r\n                }\r\n            }, children);\r\n        };\r\n        // getProvisionalColumnWidths is used when we have no data rows, so can't measure the width\r\n        // of the data columns. We just choose reasonable widths for the headers.\r\n        DataGrid.prototype.getProvisionalColumnWidths = function () {\r\n            var _this = this;\r\n            // Only compute provisional column widths if the header widths have already been measured\r\n            if (!this.state.measuredHeaderWidths) {\r\n                return null;\r\n            }\r\n            // Find the total width of the measured headers\r\n            var totalWidth = 0;\r\n            var numberOfResizableColumns = 0;\r\n            _.each(this.props.cols, function (col) {\r\n                if (col.preferredWidth) {\r\n                    totalWidth += col.preferredWidth;\r\n                }\r\n                else {\r\n                    totalWidth += _this.state.measuredHeaderWidths[col.name];\r\n                }\r\n                if (col.resizable !== false) {\r\n                    numberOfResizableColumns++;\r\n                }\r\n            });\r\n            // Allocate any extra space evenly between the resizable headers\r\n            var extraAvailable = this.gridWidth - DataGrid.ScrollbarWidth - totalWidth;\r\n            var provisionalColumnWidths = {};\r\n            if (extraAvailable > 0) {\r\n                var extraPerHeader = extraAvailable / numberOfResizableColumns;\r\n                _.each(this.props.cols, function (col) {\r\n                    if (col.resizable !== false) {\r\n                        var width;\r\n                        if (col.preferredWidth) {\r\n                            width = col.preferredWidth;\r\n                        }\r\n                        else {\r\n                            width = _this.state.measuredHeaderWidths[col.name];\r\n                        }\r\n                        provisionalColumnWidths[col.name] = width + extraPerHeader;\r\n                    }\r\n                });\r\n            }\r\n            return provisionalColumnWidths;\r\n        };\r\n        DataGrid.prototype.bodyScrollLeft = function (scrollLeft) {\r\n            if (scrollLeft !== this.state.scrollLeft) {\r\n                this.setState({ scrollLeft: scrollLeft });\r\n            }\r\n        };\r\n        DataGrid.displayName = 'DataGrid';\r\n        DataGrid.element = React.createFactory(DataGrid);\r\n        DataGrid.MaxInitialColumnWidth = 200;\r\n        DataGrid.ScrollbarWidth = 20;\r\n        // Enforcing a minimum column width prevents some glitches when the columns\r\n        // get very narrow. It would be ideal to find ways to remove the glitches and\r\n        // reduce this minimum to 0.\r\n        DataGrid.MinimumColumnWidth = 35;\r\n        return DataGrid;\r\n    })(React.Component);\r\n    VizPortalReact.DataGrid = DataGrid;\r\n    var DataGrid;\r\n    (function (DataGrid) {\r\n        // Helpers\r\n        function measureWidth(componentOrElement) {\r\n            var domNode = React.findDOMNode(componentOrElement);\r\n            var rect = domNode.getBoundingClientRect();\r\n            return Math.ceil(rect.right - rect.left);\r\n        }\r\n        // BodyCell\r\n        var BodyCell = (function (_super) {\r\n            __extends(BodyCell, _super);\r\n            function BodyCell() {\r\n                _super.apply(this, arguments);\r\n            }\r\n            BodyCell.prototype.componentDidMount = function () {\r\n                if (!this.props.reportWidthFn)\r\n                    return;\r\n                var width = measureWidth(this);\r\n                this.props.reportWidthFn(this.props.col.name, width);\r\n            };\r\n            BodyCell.prototype.shouldComponentUpdate = function (nextProps, nextState) {\r\n                return React.addons.PureRenderMixin.shouldComponentUpdate.call(this, nextProps, nextState);\r\n            };\r\n            BodyCell.prototype.render = function () {\r\n                var _this = this;\r\n                var content = this.props.col.cellFormatter\r\n                    ? this.props.col.cellFormatter(this.props)\r\n                    : this.props.value;\r\n                var attrs = {\r\n                    className: 'tb-react-dg-bcell',\r\n                    style: {\r\n                        display: 'inline-block',\r\n                        boxSizing: 'border-box',\r\n                        width: this.props.width\r\n                    },\r\n                    onClick: function (e) {\r\n                        if (e.defaultPrevented) {\r\n                            return;\r\n                        }\r\n                        if (_this.props.onClick) {\r\n                            _this.props.onClick(_this.props.row, _this.props.col);\r\n                        }\r\n                    }\r\n                };\r\n                if (this.props.col.cellStyle) {\r\n                    _.extend(attrs.style, this.props.col.cellStyle);\r\n                }\r\n                return React.DOM.div(attrs, content);\r\n            };\r\n            BodyCell.displayName = 'DataGridBodyCell';\r\n            BodyCell.element = React.createFactory(BodyCell);\r\n            return BodyCell;\r\n        })(React.Component);\r\n        // BodyRow\r\n        var BodyRow = (function (_super) {\r\n            __extends(BodyRow, _super);\r\n            function BodyRow() {\r\n                _super.apply(this, arguments);\r\n            }\r\n            BodyRow.prototype.shouldComponentUpdate = function (nextProps, nextState) {\r\n                return React.addons.PureRenderMixin.shouldComponentUpdate.call(this, nextProps, nextState);\r\n            };\r\n            BodyRow.prototype.render = function () {\r\n                var _this = this;\r\n                var row = this.props.row;\r\n                var colWidths = this.props.colWidths;\r\n                var color = null;\r\n                if (this.props.isSelected) {\r\n                    color = BodyRow.SelectedColor;\r\n                }\r\n                else if (this.props.isHovered) {\r\n                    color = BodyRow.HoverColor;\r\n                }\r\n                var cells = row\r\n                    ? this.props.cols.map(function (col, i) {\r\n                        return BodyCell.element({\r\n                            key: i,\r\n                            col: col,\r\n                            row: row,\r\n                            value: row.data[col.dataKey],\r\n                            width: colWidths && colWidths[col.name],\r\n                            reportWidthFn: !col.preferredWidth && _this.props.handleReportCellWidth,\r\n                            isSelected: _this.props.isSelected,\r\n                            onClick: _this.props.onClick.bind(_this)\r\n                        });\r\n                    })\r\n                    : null;\r\n                var attrs = {\r\n                    className: 'tb-react-dg-brow',\r\n                    style: {\r\n                        height: BodyRow.InnerHeight,\r\n                        borderBottom: '1px solid #e6e6e6',\r\n                        backgroundColor: color,\r\n                        whiteSpace: 'nowrap'\r\n                    },\r\n                    onMouseEnter: function () { return _this.props.handleMouseEnter(row); },\r\n                    onMouseLeave: function () { return _this.props.handleMouseLeave(); }\r\n                };\r\n                if (row && row.rowStyle) {\r\n                    _.extend(attrs.style, row.rowStyle);\r\n                }\r\n                return React.DOM.div(attrs, cells);\r\n            };\r\n            BodyRow.displayName = 'DataGridBodyRow';\r\n            BodyRow.element = React.createFactory(BodyRow);\r\n            BodyRow.InnerHeight = VizPortal.FeatureFlags.useTallerRowHeight ? 37 : 27;\r\n            BodyRow.OuterHeight = BodyRow.InnerHeight + 1;\r\n            BodyRow.SelectedColor = '#d4e1ed';\r\n            BodyRow.HoverColor = '#f5f5f5';\r\n            return BodyRow;\r\n        })(React.Component);\r\n        DataGrid.BodyRow = BodyRow;\r\n        // BodySection\r\n        var BodySection = (function (_super) {\r\n            __extends(BodySection, _super);\r\n            function BodySection() {\r\n                _super.apply(this, arguments);\r\n                this.state = {\r\n                    hoverRow: null\r\n                };\r\n            }\r\n            BodySection.prototype.handleMouseEnter = function (row) {\r\n                this.setState({ hoverRow: row });\r\n            };\r\n            BodySection.prototype.handleMouseLeave = function () {\r\n                this.setState({ hoverRow: null });\r\n            };\r\n            BodySection.prototype.handleReportCellWidth = function (columnKey, width) {\r\n                this.measuredWidths[columnKey] = Math.max(width, this.measuredWidths[columnKey] || 0);\r\n            };\r\n            BodySection.prototype.componentWillMount = function () {\r\n                this.measuredWidths = {};\r\n            };\r\n            BodySection.prototype.componentDidMount = function () {\r\n                if (this.props.measureColumnWidths) {\r\n                    this.props.measureColumnWidths(this.measuredWidths);\r\n                }\r\n            };\r\n            BodySection.prototype.shouldComponentUpdate = function (nextProps, nextState) {\r\n                return React.addons.PureRenderMixin.shouldComponentUpdate.call(this, nextProps, nextState);\r\n            };\r\n            BodySection.prototype.render = function () {\r\n                var cols = this.props.cols;\r\n                var colWidths = this.props.colWidths;\r\n                var rows = this.props.rows;\r\n                var onClick = this.props.onClick;\r\n                var handleMouseEnter = this.handleMouseEnter.bind(this);\r\n                var handleMouseLeave = this.handleMouseLeave.bind(this);\r\n                var handleReportCellWidth = this.props.measureColumnWidths ? this.handleReportCellWidth.bind(this) : null;\r\n                var rowElements = [];\r\n                for (var i = 0; i < rows.length; i++) {\r\n                    var row = rows[i];\r\n                    rowElements.push(BodyRow.element({\r\n                        key: i,\r\n                        row: row,\r\n                        cols: cols,\r\n                        colWidths: colWidths,\r\n                        onClick: onClick,\r\n                        isSelected: row && _.has(this.props.selectedKeys, row.key),\r\n                        isHovered: row && (this.state.hoverRow === row),\r\n                        handleMouseEnter: handleMouseEnter,\r\n                        handleMouseLeave: handleMouseLeave,\r\n                        handleReportCellWidth: handleReportCellWidth\r\n                    }));\r\n                }\r\n                return React.DOM.div({\r\n                    className: 'tb-react-dg-bsection',\r\n                    style: {\r\n                        height: rows.length * BodyRow.OuterHeight\r\n                    }\r\n                }, React.DOM.div({\r\n                    style: {\r\n                        position: 'absolute',\r\n                        minWidth: '100%'\r\n                    }\r\n                }, rowElements));\r\n            };\r\n            BodySection.displayName = 'DataGridBodySection';\r\n            BodySection.element = React.createFactory(BodySection);\r\n            return BodySection;\r\n        })(React.Component);\r\n        // Body\r\n        var Body = (function (_super) {\r\n            __extends(Body, _super);\r\n            function Body() {\r\n                _super.apply(this, arguments);\r\n                this.state = {\r\n                    indexOfFirstVisibleSection: 0,\r\n                    indexOfLastVisibleSection: 0\r\n                };\r\n            }\r\n            // TODO: see if there's a way to enable pure rendering. Currently, it seems to mess up column width measurement.\r\n            Body.prototype.render = function () {\r\n                var _this = this;\r\n                var rows = this.props.rows;\r\n                if (!rows || rows.length === 0) {\r\n                    return React.DOM.div({ className: 'tb-react-dg-body' });\r\n                }\r\n                var sections = this.renderSections();\r\n                var topSpacer = this.state.indexOfFirstVisibleSection * Body.SectionHeight;\r\n                var sectionsWrapper = React.DOM.div({\r\n                    style: {\r\n                        paddingTop: topSpacer,\r\n                        height: rows.length * BodyRow.OuterHeight - topSpacer\r\n                    }\r\n                }, sections);\r\n                return React.DOM.div({\r\n                    className: 'tb-react-dg-body',\r\n                    onScroll: function () { return _this.onScroll(); }\r\n                }, sectionsWrapper);\r\n            };\r\n            Body.prototype.renderSections = function () {\r\n                var sections = [];\r\n                for (var i = this.state.indexOfFirstVisibleSection; i <= this.state.indexOfLastVisibleSection; i++) {\r\n                    var sectionRows = this.props.rows.slice(i * Body.SectionRows, Math.min((i + 1) * Body.SectionRows, this.props.rows.length));\r\n                    sections.push(BodySection.element({\r\n                        key: i,\r\n                        cols: this.props.cols,\r\n                        colWidths: this.props.colWidths,\r\n                        measureColumnWidths: i === this.state.indexOfFirstVisibleSection ? this.props.measureColumnWidths : null,\r\n                        rows: sectionRows,\r\n                        onClick: this.props.onClick,\r\n                        selectedKeys: this.props.selectedKeys\r\n                    }));\r\n                }\r\n                return sections;\r\n            };\r\n            Body.prototype.componentDidMount = function () {\r\n                var _this = this;\r\n                if (!window.addEventListener && window.attachEvent) {\r\n                    var element = React.findDOMNode(this);\r\n                    element.attachEvent('onscroll', function () {\r\n                        _this.onScroll();\r\n                    });\r\n                }\r\n                this.updateSections();\r\n            };\r\n            Body.prototype.componentWillUnmount = function () {\r\n                if (!window.addEventListener && window.attachEvent) {\r\n                    var element = React.findDOMNode(this);\r\n                    element.detachEvent('onscroll');\r\n                }\r\n            };\r\n            Body.prototype.onScroll = function () {\r\n                this.updateSections();\r\n                var reportScrollLeftFn = this.props.reportScrollLeftFn;\r\n                if (reportScrollLeftFn) {\r\n                    reportScrollLeftFn(React.findDOMNode(this).scrollLeft);\r\n                }\r\n            };\r\n            Body.prototype.updateSections = function () {\r\n                var _this = this;\r\n                var node = $(React.findDOMNode(this));\r\n                var viewportTop = node.scrollTop();\r\n                var viewportBottom = viewportTop + node.height();\r\n                var indexOfFirstVisibleSection = Math.floor(viewportTop / Body.SectionHeight);\r\n                var indexOfLastVisibleSection = Math.ceil(viewportBottom / Body.SectionHeight);\r\n                if (indexOfFirstVisibleSection === this.state.indexOfFirstVisibleSection\r\n                    && indexOfLastVisibleSection === this.state.indexOfLastVisibleSection) {\r\n                    return;\r\n                }\r\n                this.setState({\r\n                    indexOfFirstVisibleSection: indexOfFirstVisibleSection,\r\n                    indexOfLastVisibleSection: indexOfLastVisibleSection\r\n                }, function () { return _this.fetch(); });\r\n            };\r\n            Body.prototype.fetch = function () {\r\n                if (!this.props.fetch)\r\n                    return;\r\n                this.props.fetch(this.state.indexOfFirstVisibleSection * Body.SectionRows, (this.state.indexOfLastVisibleSection + 1) * Body.SectionRows - 1);\r\n            };\r\n            Body.displayName = 'DataGridBody';\r\n            Body.element = React.createFactory(Body);\r\n            Body.SectionRows = 10;\r\n            Body.SectionHeight = Body.SectionRows * BodyRow.OuterHeight;\r\n            return Body;\r\n        })(React.Component);\r\n        DataGrid.Body = Body;\r\n        // HeaderColumn\r\n        var HeaderColumn = (function (_super) {\r\n            __extends(HeaderColumn, _super);\r\n            function HeaderColumn(props) {\r\n                var _this = this;\r\n                _super.call(this, props);\r\n                this.state = {\r\n                    hovered: false\r\n                };\r\n                this.boundMouseEnter = function () { return _this.setState({ hovered: true }); };\r\n                this.boundMouseLeave = function () { return _this.setState({ hovered: false }); };\r\n            }\r\n            HeaderColumn.prototype.startResize = function (event) {\r\n                var _this = this;\r\n                var resizeMouseX = event.clientX;\r\n                var node = React.findDOMNode(this);\r\n                var rect = node.getBoundingClientRect();\r\n                var initialWidth = rect.right - rect.left;\r\n                $(document).on(\"mousemove.mousecapture\", function (e) {\r\n                    var delta = e.clientX - resizeMouseX;\r\n                    _this.props.onColumnResize(_this.props.col, Math.max(initialWidth + delta, DataGrid.MinimumColumnWidth));\r\n                    e.preventDefault();\r\n                });\r\n                $(document).on(\"mouseup.mousecapture\", function (e) {\r\n                    $(document).off(\".mousecapture\");\r\n                    e.preventDefault();\r\n                });\r\n                event.preventDefault();\r\n            };\r\n            HeaderColumn.prototype.shouldComponentUpdate = function (nextProps, nextState) {\r\n                return React.addons.PureRenderMixin.shouldComponentUpdate.call(this, nextProps, nextState);\r\n            };\r\n            HeaderColumn.prototype.render = function () {\r\n                var _this = this;\r\n                var col = this.props.col;\r\n                var isSortable = col.sortable !== false;\r\n                var isResizable = col.resizable !== false;\r\n                // Determine column header classes\r\n                var classes = ['tb-react-dg-hcell'];\r\n                if (isSortable) {\r\n                    classes.push('tb-react-dg-hcell-sortable');\r\n                }\r\n                if (this.props.sorted) {\r\n                    classes.push(this.props.sortAscending ? 'tb-react-dg-hcell-sort-asc' : 'tb-react-dg-hcell-sort-desc');\r\n                }\r\n                if (isResizable) {\r\n                    classes.push('tb-react-dg-hcell-resizable');\r\n                }\r\n                // Determine column header attributes\r\n                var attrs = {\r\n                    className: classes.join(' '),\r\n                    onMouseEnter: this.boundMouseEnter,\r\n                    onMouseLeave: this.boundMouseLeave\r\n                };\r\n                if (isSortable && this.props.onHeaderClicked) {\r\n                    attrs.onClick = function () { return _this.props.onHeaderClicked(col.dataKey, col.direction); };\r\n                }\r\n                if (col.headerStyle) {\r\n                    attrs.style = col.headerStyle;\r\n                }\r\n                if (col.tooltip) {\r\n                    attrs.title = col.tooltip;\r\n                }\r\n                var content = this.props.col.headerFormatter\r\n                    ? col.headerFormatter(_.extend({}, this.props, this.state))\r\n                    : React.DOM.span({ className: 'tb-react-dg-hcell-text' }, col.text);\r\n                return React.DOM.span({ className: 'tb-react-dg-hcol', style: { width: this.props.width } }, React.DOM.div(attrs, content), col.resizable === false ? null : React.DOM.div({\r\n                    className: 'tb-react-dg-hdivider tb-disable-selection',\r\n                    onMouseDown: this.startResize.bind(this)\r\n                }));\r\n            };\r\n            HeaderColumn.prototype.componentDidMount = function () {\r\n                if (!this.props.reportWidthFn)\r\n                    return;\r\n                var width = measureWidth(this);\r\n                this.props.reportWidthFn(this.props.col.name, width);\r\n            };\r\n            HeaderColumn.displayName = 'DataGridHeaderColumn';\r\n            HeaderColumn.element = React.createFactory(HeaderColumn);\r\n            return HeaderColumn;\r\n        })(React.Component);\r\n        // HeaderRow\r\n        var HeaderRow = (function (_super) {\r\n            __extends(HeaderRow, _super);\r\n            function HeaderRow() {\r\n                _super.apply(this, arguments);\r\n            }\r\n            HeaderRow.prototype.componentWillMount = function () {\r\n                this.measuredWidths = {};\r\n            };\r\n            HeaderRow.prototype.componentDidMount = function () {\r\n                if (this.props.measureColumnWidths) {\r\n                    this.props.measureColumnWidths(this.measuredWidths);\r\n                }\r\n            };\r\n            HeaderRow.prototype.handleReportHeaderWidth = function (columnKey, width) {\r\n                this.measuredWidths[columnKey] = Math.max(width, this.measuredWidths[columnKey] || 0);\r\n            };\r\n            HeaderRow.prototype.shouldComponentUpdate = function (nextProps, nextState) {\r\n                return React.addons.PureRenderMixin.shouldComponentUpdate.call(this, nextProps, nextState);\r\n            };\r\n            HeaderRow.prototype.render = function () {\r\n                var _this = this;\r\n                var cols = this.props.cols;\r\n                var colWidths = this.props.colWidths;\r\n                var reportWidthFn = this.handleReportHeaderWidth.bind(this);\r\n                ;\r\n                var scrollLeft = this.props.scrollLeft;\r\n                var onColumnResize = this.props.onColumnResize;\r\n                var hcols = cols.map(function (col) {\r\n                    return HeaderColumn.element({\r\n                        key: col.name,\r\n                        col: col,\r\n                        sorted: _this.props.sortKey === col.dataKey,\r\n                        sortAscending: _this.props.sortAscending,\r\n                        reportWidthFn: !col.preferredWidth && reportWidthFn,\r\n                        width: colWidths && colWidths[col.name],\r\n                        onColumnResize: onColumnResize,\r\n                        onHeaderClicked: _this.props.onHeaderClicked\r\n                    });\r\n                });\r\n                return React.DOM.div({ className: 'tb-react-dg-hrow' }, React.DOM.span({ className: 'tb-react-dg-hcols', style: { marginLeft: -scrollLeft } }, hcols));\r\n            };\r\n            HeaderRow.displayName = 'DataGridHeaderRow';\r\n            HeaderRow.element = React.createFactory(HeaderRow);\r\n            return HeaderRow;\r\n        })(React.Component);\r\n        DataGrid.HeaderRow = HeaderRow;\r\n        // EmptyBody\r\n        var EmptyBody = (function (_super) {\r\n            __extends(EmptyBody, _super);\r\n            function EmptyBody() {\r\n                _super.apply(this, arguments);\r\n            }\r\n            EmptyBody.prototype.shouldComponentUpdate = function (nextProps, nextState) {\r\n                return React.addons.PureRenderMixin.shouldComponentUpdate.call(this, nextProps, nextState);\r\n            };\r\n            EmptyBody.prototype.render = function () {\r\n                return React.DOM.div({\r\n                    className: 'tb-react-dg-body'\r\n                }, this.props.emptyChild);\r\n            };\r\n            EmptyBody.displayName = 'EmptyBody';\r\n            EmptyBody.element = React.createFactory(EmptyBody);\r\n            return EmptyBody;\r\n        })(React.Component);\r\n        DataGrid.EmptyBody = EmptyBody;\r\n    })(DataGrid = VizPortalReact.DataGrid || (VizPortalReact.DataGrid = {}));\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/CommonDataGridColumns.ts\" />\r\n/// <reference path=\"../../common/react/components/dataGrid/DataGrid.ts\" />\r\n/// <reference path=\"../../common/react/components/dataGrid/DataGridCells.ts\" />\r\n/// <reference path=\"../../ts/controllers/AngularCtrl.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var DatasourceGrid;\r\n    (function (DatasourceGrid) {\r\n        function columns(translate, scope, siteUrls, actions, getActionTarget, anyActionsAllowed, inProjectPlace, inWorkbookPlace, angularContext) {\r\n            var columns = [];\r\n            if (anyActionsAllowed) {\r\n                columns.push(VizPortalReact.CommonDataGridColumns.selected(scope));\r\n            }\r\n            columns = columns.concat([\r\n                nameColumn(anyActionsAllowed, translate, siteUrls, actions, getActionTarget, inWorkbookPlace),\r\n                {\r\n                    name: 'connection-type-col',\r\n                    dataKey: 'connectionTypeDisplayName',\r\n                    text: translate('column_connection_type'),\r\n                    direction: 'asc'\r\n                },\r\n                {\r\n                    name: 'connects-to-col',\r\n                    dataKey: 'connectsTo',\r\n                    text: translate('column_connects_to'),\r\n                    sortable: false,\r\n                    cellFormatter: connectsToCellFormatter(siteUrls)\r\n                },\r\n                {\r\n                    name: 'last-refreshed-at-col',\r\n                    dataKey: 'lastRefreshedAt',\r\n                    text: translate('column_last_refresh'),\r\n                    cellFormatter: VizPortalReact.DataGridCells.DateTimeCell('lastRefreshedAt', translate('live')),\r\n                    direction: 'desc'\r\n                }\r\n            ]);\r\n            if (!inProjectPlace && !inWorkbookPlace) {\r\n                columns.push({\r\n                    name: 'project-name-col',\r\n                    dataKey: 'projectName',\r\n                    text: translate('column_project'),\r\n                    direction: 'asc',\r\n                    cellFormatter: VizPortalReact.DataGridCells.Link(function (row) {\r\n                        return {\r\n                            text: row.data.project ? row.data.project.name : '',\r\n                            url: row.data.project ? siteUrls.projectUrl(row.data.project.id) : ''\r\n                        };\r\n                    })\r\n                });\r\n            }\r\n            if (!inWorkbookPlace) {\r\n                columns.push(VizPortalReact.CommonDataGridColumns.owner(translate, siteUrls));\r\n                columns.push({\r\n                    name: 'updated-at-col',\r\n                    dataKey: 'updatedAt',\r\n                    text: translate('column_updated'),\r\n                    direction: 'desc',\r\n                    cellFormatter: VizPortalReact.DataGridCells.DateTimeCell('updatedAt')\r\n                });\r\n            }\r\n            columns.push(VizPortalReact.CommonDataGridColumns.alert('datasource', translate, angularContext));\r\n            return columns;\r\n        }\r\n        DatasourceGrid.columns = columns;\r\n        function nameColumn(anyActionsAllowed, translate, siteUrls, actions, getActionTarget, inWorkbookPlace) {\r\n            var column = {\r\n                name: 'name-col',\r\n                dataKey: 'name',\r\n                text: translate('column_name'),\r\n                direction: 'asc',\r\n                cellFormatter: React.createFactory(React.createClass({\r\n                    render: function () {\r\n                        var props = this.props;\r\n                        var datasource = props.row.data;\r\n                        var isEmbedded = !!datasource.workbook;\r\n                        return isEmbedded\r\n                            ? embeddedName(datasource, inWorkbookPlace, siteUrls)\r\n                            : publishedName(datasource, siteUrls);\r\n                    }\r\n                }))\r\n            };\r\n            if (anyActionsAllowed) {\r\n                column = VizPortalReact.CommonDataGridColumns.withActions(column, {\r\n                    actions: actions,\r\n                    getActionTarget: getActionTarget,\r\n                    translate: translate\r\n                });\r\n            }\r\n            return column;\r\n        }\r\n        function embeddedName(datasource, inWorkbookPlace, siteUrls) {\r\n            var title = datasource.name;\r\n            var parts = [\r\n                React.DOM.span({ key: 'icon', className: 'tb-icon-datasource-embedded' }),\r\n                React.DOM.span({ key: 'name' }, datasource.name)\r\n            ];\r\n            if (!inWorkbookPlace) {\r\n                title += \" - \" + datasource.workbook.name;\r\n                parts.push(React.DOM.span({ key: 'dash' }, ' - '));\r\n                parts.push(React.DOM.a({\r\n                    key: 'workbookLink',\r\n                    href: siteUrls.workbookDatasourcesUrl(datasource.workbook.id),\r\n                    title: datasource.workbook.name\r\n                }, datasource.workbook.name));\r\n            }\r\n            return React.DOM.span({ title: title }, parts);\r\n        }\r\n        function publishedName(datasource, siteUrls) {\r\n            return React.DOM.span({ title: datasource.name }, React.DOM.span({ className: 'tb-icon-datasource-published' }), React.DOM.a({\r\n                href: siteUrls.datasourceUrl(datasource.id),\r\n                title: datasource.name\r\n            }, datasource.name));\r\n        }\r\n        function connectsToCellFormatter(siteUrls) {\r\n            return React.createFactory(React.createClass({\r\n                render: function () {\r\n                    var props = this.props;\r\n                    var datasource = props.row.data;\r\n                    switch (datasource.connectionDetails.type) {\r\n                        case VizPortal.ServerApi.ConnectionDetailType.TableauServer:\r\n                            return React.DOM.a({\r\n                                href: siteUrls.datasourceUrl(datasource.connectionDetails.id)\r\n                            }, React.DOM.span({ className: 'tb-icon-datasource-connection-tableau' }), React.DOM.span({ title: datasource.connectionDetails.name }, datasource.connectionDetails.name));\r\n                        case VizPortal.ServerApi.ConnectionDetailType.File:\r\n                            return React.DOM.span({}, React.DOM.span({ className: 'tb-icon-datasource-connection-file' }), React.DOM.span({ title: datasource.connectionDetails.fileName }, datasource.connectionDetails.fileName));\r\n                        default:\r\n                            return React.DOM.span({}, React.DOM.span({ className: 'tb-icon-datasource-connection-external' }), React.DOM.span({ title: datasource.connectionDetails.serverName }, datasource.connectionDetails.serverName));\r\n                    }\r\n                }\r\n            }));\r\n        }\r\n    })(DatasourceGrid = VizPortalReact.DatasourceGrid || (VizPortalReact.DatasourceGrid = {}));\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/CommonDataGridColumns.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var ProjectGrid;\r\n    (function (ProjectGrid) {\r\n        function columns(translate, siteUrls, actions, getActionTarget, scope, anyActionsAllowed) {\r\n            var columns = [];\r\n            if (anyActionsAllowed) {\r\n                columns.push(VizPortalReact.CommonDataGridColumns.selected(scope));\r\n            }\r\n            columns = columns.concat([\r\n                nameColumn(translate, siteUrls, anyActionsAllowed, actions, getActionTarget),\r\n                {\r\n                    name: 'workbook-count-col',\r\n                    dataKey: 'workbookCount',\r\n                    text: translate('column_numWorkbooks'),\r\n                    cellFormatter: VizPortalReact.DataGridCells.LocalizedCount('workbookCount'),\r\n                    direction: 'asc',\r\n                    headerStyle: { textAlign: 'right' },\r\n                    cellStyle: { textAlign: 'right' }\r\n                },\r\n                {\r\n                    name: 'view-count-col',\r\n                    dataKey: 'viewCount',\r\n                    text: translate('column_numViews'),\r\n                    cellFormatter: VizPortalReact.DataGridCells.LocalizedCount('viewCount'),\r\n                    direction: 'asc',\r\n                    headerStyle: { textAlign: 'right' },\r\n                    cellStyle: { textAlign: 'right' }\r\n                },\r\n                {\r\n                    name: 'datasource-count-col',\r\n                    dataKey: 'datasourceCount',\r\n                    text: translate('column_numDatasources'),\r\n                    cellFormatter: VizPortalReact.DataGridCells.LocalizedCount('datasourceCount'),\r\n                    direction: 'asc',\r\n                    headerStyle: { textAlign: 'right' },\r\n                    cellStyle: { textAlign: 'right' }\r\n                },\r\n                VizPortalReact.CommonDataGridColumns.owner(translate, siteUrls),\r\n                {\r\n                    name: 'created-at-col',\r\n                    dataKey: 'createdAt',\r\n                    text: translate('column_created'),\r\n                    direction: 'desc',\r\n                    cellFormatter: VizPortalReact.DataGridCells.DateTimeCell('createdAt')\r\n                },\r\n            ]);\r\n            return columns;\r\n        }\r\n        ProjectGrid.columns = columns;\r\n        function nameColumn(translate, siteUrls, anyActionsAllowed, actions, getActionTarget) {\r\n            var col = {\r\n                name: 'name-col',\r\n                dataKey: 'name',\r\n                text: translate('column_name'),\r\n                direction: 'asc',\r\n                cellFormatter: VizPortalReact.DataGridCells.Link(function (row) {\r\n                    return {\r\n                        text: row.data.name,\r\n                        url: siteUrls.projectUrl(row.data.id),\r\n                        iconClassName: 'tb-grid-icon-project',\r\n                        iconTitle: translate('project')\r\n                    };\r\n                })\r\n            };\r\n            if (anyActionsAllowed) {\r\n                col = VizPortalReact.CommonDataGridColumns.withActions(col, {\r\n                    actions: actions,\r\n                    getActionTarget: getActionTarget,\r\n                    translate: translate\r\n                });\r\n            }\r\n            return col;\r\n        }\r\n    })(ProjectGrid = VizPortalReact.ProjectGrid || (VizPortalReact.ProjectGrid = {}));\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/CommonDataGridColumns.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var SiteGrid;\r\n    (function (SiteGrid) {\r\n        function columns(translate, scope, sizeFilter, actions, getActionTarget, siteUrls, showLiveDatabaseConnectionsColumn) {\r\n            var columns = [\r\n                VizPortalReact.CommonDataGridColumns.selected(scope),\r\n                nameColumn(translate, siteUrls, actions, getActionTarget),\r\n                {\r\n                    name: 'user-count-col',\r\n                    dataKey: 'userCount',\r\n                    text: translate('column_userCount'),\r\n                    cellFormatter: VizPortalReact.DataGridCells.LocalizedCount('userCount'),\r\n                    direction: 'asc',\r\n                    headerStyle: { textAlign: 'right' },\r\n                    cellStyle: { textAlign: 'right' }\r\n                },\r\n                {\r\n                    name: 'admin-count-col',\r\n                    dataKey: 'adminCount',\r\n                    text: translate('column_adminCount'),\r\n                    cellFormatter: VizPortalReact.DataGridCells.LocalizedCount('adminCount'),\r\n                    direction: 'asc',\r\n                    headerStyle: { textAlign: 'right' },\r\n                    cellStyle: { textAlign: 'right' }\r\n                },\r\n                {\r\n                    name: 'user-quota-col',\r\n                    dataKey: 'userQuota',\r\n                    text: translate('column_maxUsers'),\r\n                    cellFormatter: userQuotaFormatter(translate),\r\n                    direction: 'asc',\r\n                    headerStyle: { textAlign: 'right' },\r\n                    cellStyle: { textAlign: 'right' }\r\n                },\r\n                {\r\n                    name: 'storage-used-col',\r\n                    dataKey: 'storageUsedBytes',\r\n                    text: translate('column_storageUsed'),\r\n                    cellFormatter: storageUsedFormatter(sizeFilter),\r\n                    direction: 'asc',\r\n                    headerStyle: { textAlign: 'right' },\r\n                    cellStyle: { textAlign: 'right' }\r\n                },\r\n                {\r\n                    name: 'storage-quota-col',\r\n                    dataKey: 'storageQuotaBytes',\r\n                    text: translate('column_storageQuota'),\r\n                    cellFormatter: storageQuotaFormatter(translate, sizeFilter),\r\n                    direction: 'asc',\r\n                    headerStyle: { textAlign: 'right' },\r\n                    cellStyle: { textAlign: 'right' }\r\n                },\r\n                {\r\n                    name: 'status-col',\r\n                    dataKey: 'availability',\r\n                    text: translate('column_status'),\r\n                    cellFormatter: VizPortalReact.DataGridCells.PlainTextCellWithTransform('availability', translate),\r\n                    direction: 'asc'\r\n                },\r\n                {\r\n                    name: 'metrics-col',\r\n                    dataKey: 'metricsEnabled',\r\n                    text: translate('column_metrics'),\r\n                    cellFormatter: VizPortalReact.DataGridCells.Checkmark('settings.metricsEnabled'),\r\n                    direction: 'desc'\r\n                },\r\n                {\r\n                    name: 'web-authoring-col',\r\n                    dataKey: 'authoringEnabled',\r\n                    text: translate('column_webAuthoring'),\r\n                    cellFormatter: VizPortalReact.DataGridCells.Checkmark('settings.authoringEnabled'),\r\n                    direction: 'desc'\r\n                },\r\n                {\r\n                    name: 'sheet-image-col',\r\n                    dataKey: 'sheetImageEnabled',\r\n                    text: translate('column_sheetImage'),\r\n                    cellFormatter: VizPortalReact.DataGridCells.Checkmark('settings.sheetImageEnabled'),\r\n                    direction: 'desc'\r\n                }\r\n            ];\r\n            if (showLiveDatabaseConnectionsColumn) {\r\n                columns.push({\r\n                    name: 'live-connections-whitelist-enabled-col',\r\n                    dataKey: 'liveDBConnectionsWhitelistEnabled',\r\n                    text: translate('column_liveDBConnectionsWhitelistEnabled'),\r\n                    cellFormatter: VizPortalReact.DataGridCells.Checkmark('siteAdminSettings.liveDBConnectionsWhitelistEnabled'),\r\n                    direction: 'desc'\r\n                });\r\n            }\r\n            columns.push({\r\n                name: 'edit-membership-col',\r\n                dataKey: 'siteAdminsCanAddUsers',\r\n                text: translate('column_editMembership'),\r\n                cellFormatter: VizPortalReact.DataGridCells.Checkmark('settings.siteAdminsCanAddUsers'),\r\n                direction: 'desc'\r\n            });\r\n            columns.push({\r\n                name: 'created-at-col',\r\n                dataKey: 'createdAt',\r\n                text: translate('column_created'),\r\n                direction: 'desc',\r\n                cellFormatter: VizPortalReact.DataGridCells.DateTimeCell('createdAt')\r\n            });\r\n            return columns;\r\n        }\r\n        SiteGrid.columns = columns;\r\n        function nameColumn(translate, siteUrls, actions, getActionTarget) {\r\n            var iconTitle = translate('site');\r\n            return VizPortalReact.CommonDataGridColumns.withActions({\r\n                name: 'name-col',\r\n                dataKey: 'name',\r\n                text: translate('column_name'),\r\n                direction: 'asc',\r\n                cellFormatter: VizPortalReact.DataGridCells.Link(function (row) {\r\n                    var site = row.data;\r\n                    return {\r\n                        text: site.settings.name,\r\n                        url: siteUrls.forSiteUrlName(site.settings.urlName).projectsUrl(),\r\n                        iconClassName: 'tb-grid-icon-site',\r\n                        iconTitle: iconTitle\r\n                    };\r\n                })\r\n            }, {\r\n                actions: actions,\r\n                getActionTarget: getActionTarget,\r\n                translate: translate\r\n            });\r\n        }\r\n        function userQuotaFormatter(translate) {\r\n            var serverLimitElement = React.DOM.span({}, translate('serverLimit'));\r\n            return React.createFactory(React.createClass({\r\n                render: function () {\r\n                    var site = this.props.row.data;\r\n                    if (site.settings.userQuotaEnabled) {\r\n                        return React.DOM.span({}, VizPortal.L10n.localizedCount(site.settings.userQuota));\r\n                    }\r\n                    else {\r\n                        return serverLimitElement;\r\n                    }\r\n                }\r\n            }));\r\n        }\r\n        function storageUsedFormatter(sizeFilter) {\r\n            return React.createFactory(React.createClass({\r\n                render: function () {\r\n                    var site = this.props.row.data;\r\n                    return React.DOM.span({}, site.settings.storageQuotaEnabled\r\n                        ? React.DOM.span({}, '(' + VizPortal.L10n.localizedPercent(site.storageQuotaPercentUsed) + ') ')\r\n                        : null, React.DOM.span({}, sizeFilter(site.storageUsedBytes)));\r\n                }\r\n            }));\r\n        }\r\n        function storageQuotaFormatter(translate, sizeFilter) {\r\n            var serverLimitElement = React.DOM.span({}, translate('serverLimit'));\r\n            return React.createFactory(React.createClass({\r\n                render: function () {\r\n                    var site = this.props.row.data;\r\n                    if (site.settings.storageQuotaEnabled) {\r\n                        return React.DOM.span({}, sizeFilter(site.settings.storageQuotaBytes));\r\n                    }\r\n                    else {\r\n                        return serverLimitElement;\r\n                    }\r\n                }\r\n            }));\r\n        }\r\n    })(SiteGrid = VizPortalReact.SiteGrid || (VizPortalReact.SiteGrid = {}));\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/CommonDataGridColumns.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var ViewGrid;\r\n    (function (ViewGrid) {\r\n        function columns(\r\n            // Dependencies\r\n            translate, scope, \r\n            // Other params\r\n            siteUrls, actions, getActionTarget, anyActionsAllowed, inProjectPlace, inWorkbookPlace) {\r\n            var columns = [];\r\n            if (anyActionsAllowed) {\r\n                columns.push(_.extend({}, VizPortalReact.CommonDataGridColumns.selected(scope), {\r\n                    headerStyle: {\r\n                        borderRight: 'none' // Hides the border between the selected and favorite columns\r\n                    }\r\n                }));\r\n            }\r\n            columns.push(VizPortalReact.CommonDataGridColumns.favorite(scope));\r\n            columns.push(nameColumn(translate, siteUrls, anyActionsAllowed, actions, getActionTarget));\r\n            if (!inWorkbookPlace) {\r\n                columns.push({\r\n                    name: 'workbook-name-col',\r\n                    dataKey: 'workbookName',\r\n                    text: translate('column_workbook'),\r\n                    direction: 'asc',\r\n                    cellFormatter: VizPortalReact.DataGridCells.Link(function (row) {\r\n                        return {\r\n                            text: row.data.workbook.name,\r\n                            url: siteUrls.workbookViewsUrl(row.data.workbook.id)\r\n                        };\r\n                    })\r\n                });\r\n            }\r\n            columns.push({\r\n                name: 'index-col',\r\n                dataKey: 'index',\r\n                text: translate('column_sheetNumber'),\r\n                cellFormatter: VizPortalReact.DataGridCells.LocalizedCount('index'),\r\n                direction: 'asc',\r\n                headerStyle: { textAlign: 'right' },\r\n                cellStyle: { textAlign: 'right' }\r\n            });\r\n            if (!inWorkbookPlace && !inProjectPlace) {\r\n                columns.push({\r\n                    name: 'project-name-col',\r\n                    dataKey: 'projectName',\r\n                    text: translate('column_project'),\r\n                    direction: 'asc',\r\n                    cellFormatter: VizPortalReact.DataGridCells.Link(function (row) {\r\n                        return {\r\n                            text: row.data.workbook.project.name,\r\n                            url: siteUrls.projectViewsUrl(row.data.workbook.project.id)\r\n                        };\r\n                    })\r\n                });\r\n            }\r\n            if (!inWorkbookPlace) {\r\n                columns.push(VizPortalReact.CommonDataGridColumns.owner(translate, siteUrls, function (row) { return row.data.workbook.owner; }));\r\n                columns.push({\r\n                    name: 'updated-at-col',\r\n                    dataKey: 'updatedAt',\r\n                    text: translate('column_updated'),\r\n                    direction: 'desc',\r\n                    cellFormatter: VizPortalReact.DataGridCells.DateTimeCell('updatedAt')\r\n                });\r\n            }\r\n            return columns;\r\n        }\r\n        ViewGrid.columns = columns;\r\n        function nameColumn(translate, siteUrls, anyActionsAllowed, actions, getActionTarget) {\r\n            var col = {\r\n                name: 'name-col',\r\n                dataKey: 'name',\r\n                text: translate('column_name'),\r\n                direction: 'asc',\r\n                cellFormatter: VizPortalReact.DataGridCells.Link(function (row) {\r\n                    return {\r\n                        text: row.data.name,\r\n                        url: siteUrls.viewUrl(row.data.path),\r\n                        iconClassName: 'tb-grid-icon-view',\r\n                        iconTitle: translate('view')\r\n                    };\r\n                })\r\n            };\r\n            if (anyActionsAllowed) {\r\n                col = VizPortalReact.CommonDataGridColumns.withActions(col, {\r\n                    actions: actions,\r\n                    getActionTarget: getActionTarget,\r\n                    translate: translate\r\n                });\r\n            }\r\n            return col;\r\n        }\r\n    })(ViewGrid = VizPortalReact.ViewGrid || (VizPortalReact.ViewGrid = {}));\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../../../ts/libs.ts\" />\r\n/// <reference path=\"../../CommonStyles.ts\" />\r\n/// <reference path=\"../../OrderStore.ts\" />\r\n/// <reference path=\"../../SorterActions.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    function SelectableSortKeyDataGridColumn(columnSpec, keyToTextMap, orderStore, sorterActions, cellFormatterForKey) {\r\n        _.extend(columnSpec, getOrderDirectionAndTextFromStore(orderStore, keyToTextMap));\r\n        columnSpec.text = keyToTextMap[columnSpec.dataKey];\r\n        columnSpec.headerFormatter = headerFormatter(keyToTextMap, sorterActions);\r\n        columnSpec.cellFormatter = cellFormatterForKey ? cellFormatterForKey[columnSpec.dataKey] : null;\r\n        return columnSpec;\r\n    }\r\n    VizPortalReact.SelectableSortKeyDataGridColumn = SelectableSortKeyDataGridColumn;\r\n    function getOrderDirectionAndTextFromStore(orderStore, keyToTextMap) {\r\n        var orderClauses = orderStore.getOrderClauses();\r\n        for (var i = 0; i < orderClauses.length; i++) {\r\n            var orderClause = orderClauses[i];\r\n            if (keyToTextMap[orderClause.field]) {\r\n                // stop at the first orderclause that this column owns\r\n                return {\r\n                    dataKey: orderClause.field,\r\n                    direction: orderClause.ascending ? 'asc' : 'desc',\r\n                    text: keyToTextMap[orderClause.field]\r\n                };\r\n            }\r\n        }\r\n        return undefined;\r\n    }\r\n    function headerFormatter(keyToTextMap, sorterActions) {\r\n        return React.createFactory(React.createClass({\r\n            displayName: 'SelectableSortKeyColumnHeaderFormatter',\r\n            getInitialState: function () {\r\n                return {\r\n                    menuHovered: false\r\n                };\r\n            },\r\n            render: function () {\r\n                var _this = this;\r\n                var menuButtonTop = (VizPortalReact.CommonStyles.Sizes.DataGridHeaderHeight - VizPortalReact.CommonStyles.Sizes.NormalIconSize) / 2;\r\n                var menu = VizPortalReact.Menu.element({\r\n                    ref: 'menu',\r\n                    style: {\r\n                        lineHeight: 'normal',\r\n                        fontFamily: VizPortalReact.CommonStyles.Fonts.BodyFont,\r\n                        fontSize: VizPortalReact.CommonStyles.Sizes.NormalFontSize,\r\n                        // vertically center the icon on the right side of the column header\r\n                        position: 'absolute',\r\n                        top: menuButtonTop,\r\n                        right: VizPortalReact.CommonStyles.Sizes.DefaultSpace\r\n                    },\r\n                    menuButtonFactory: function (props) { return React.DOM.span({\r\n                        className: 'tb-drop-down-icon'\r\n                    }); },\r\n                    // TODO: refactor this into a common component. Similar code in ActionsMenuColumnCell.ts\r\n                    menuPanelFactory: function (props) {\r\n                        var headerColProps = _this.props;\r\n                        var currentKey = headerColProps.col.dataKey;\r\n                        var menuItems = _.map(keyToTextMap, function (text, key) {\r\n                            var isSelected = key === currentKey;\r\n                            var menuItemContent = [\r\n                                React.DOM.span({\r\n                                    className: 'tb-padded-right',\r\n                                    style: {\r\n                                        visibility: isSelected ? 'visible' : 'hidden'\r\n                                    }\r\n                                }, ''),\r\n                                React.DOM.span({}, text)\r\n                            ];\r\n                            return React.DOM.div({\r\n                                className: 'tb-popup-menu-item',\r\n                                'data-tb-test-id': key,\r\n                                onClick: function () {\r\n                                    _this.selectKey(key, sorterActions);\r\n                                    _this.refs['menu'].closeMenu();\r\n                                }\r\n                            }, menuItemContent);\r\n                        });\r\n                        return React.DOM.div({\r\n                            className: 'tb-popup-menu-content tb-padded-small'\r\n                        }, menuItems);\r\n                    },\r\n                    menuPanelStyle: {\r\n                        // position drop down 3px below header cell\r\n                        top: menuButtonTop + VizPortalReact.CommonStyles.Sizes.NormalIconSize + VizPortalReact.CommonStyles.Sizes.DropdownOffset,\r\n                        right: -(VizPortalReact.CommonStyles.Sizes.DefaultSpace),\r\n                        left: 'auto'\r\n                    }\r\n                });\r\n                return React.DOM.div({\r\n                    style: {\r\n                        textDecoration: (this.props.hovered && !this.state.menuHovered) ? 'underline' : 'none'\r\n                    }\r\n                }, React.DOM.div({\r\n                    style: {\r\n                        marginRight: VizPortalReact.CommonStyles.Sizes.NormalIconSize - VizPortalReact.CommonStyles.Sizes.DefaultSpace,\r\n                        overflow: 'hidden',\r\n                        textOverflow: 'ellipsis'\r\n                    }\r\n                }, this.props.col.text), React.DOM.div({\r\n                    // stop propagation to prevent header cell from sorting.\r\n                    onClick: function (event) { return event.stopPropagation(); },\r\n                    onMouseOver: function () { return _this.setState({ menuHovered: true }); },\r\n                    onMouseOut: function () { return _this.setState({ menuHovered: false }); }\r\n                }, menu));\r\n            },\r\n            selectKey: function (key, sorterActions) {\r\n                var props = this.props;\r\n                if (props.col.dataKey === key) {\r\n                    // if the user selects the same metric in the menu, don't do anything\r\n                    return;\r\n                }\r\n                // TODO: combine these into one call so as to not trigger multiple requests in a post angular world.\r\n                sorterActions.removeFieldFromOrder(props.col.dataKey);\r\n                sorterActions.setPrimaryOrder(key, props.col.direction);\r\n            }\r\n        }));\r\n    }\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/CommonDataGridColumns.ts\" />\r\n/// <reference path=\"../../common/react/components/dataGrid/SelectableSortKeyDataGridColumn.ts\" />\r\n/// <reference path=\"../../ts/services/SorterFactory.ts\" />\r\n/// <reference path=\"../../ts/controllers/AngularCtrl.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var WorkbookGrid;\r\n    (function (WorkbookGrid) {\r\n        function columns(\r\n            // Dependencies\r\n            translate, sizeFilter, scope, angularContext, \r\n            // Other params\r\n            siteUrls, actions, getActionTarget, anyActionsAllowed, showProjectColumn, orderStore, sorterActions) {\r\n            var columns = [];\r\n            if (anyActionsAllowed) {\r\n                columns.push(_.extend({}, VizPortalReact.CommonDataGridColumns.selected(scope), {\r\n                    headerStyle: {\r\n                        borderRight: 'none' // Hides the border between the selected and favorite columns\r\n                    }\r\n                }));\r\n            }\r\n            columns.push(VizPortalReact.CommonDataGridColumns.favorite(scope));\r\n            columns.push(nameColumn(translate, siteUrls, anyActionsAllowed, actions, getActionTarget));\r\n            if (VizPortal.FeatureFlags.contentAnalyticsEnabled) {\r\n                var viewsColKeys = ['hitsTotal', 'hitsLastMonthTotal', 'hitsLastTwoWeeksTotal', 'hitsLastDayTotal'];\r\n                var keyToTextMap = _.reduce(viewsColKeys, function (memo, key) {\r\n                    memo[key] = translate('metric_' + key);\r\n                    return memo;\r\n                }, {});\r\n                var defaultKey = 'hitsTotal';\r\n                var defaultText = keyToTextMap[defaultKey];\r\n                columns.push(VizPortalReact.SelectableSortKeyDataGridColumn({\r\n                    name: 'hits-col',\r\n                    dataKey: defaultKey,\r\n                    text: defaultText,\r\n                    direction: 'desc',\r\n                    headerStyle: { textAlign: 'left' },\r\n                    cellStyle: { textAlign: 'left' },\r\n                    preferredWidth: 200\r\n                }, keyToTextMap, orderStore, sorterActions, \r\n                // cell formatters for the different column keys\r\n                // TODO: update when the server supports hitsLastMonthTotal\r\n                // TODO: update when the server supports hitsLastDayTotal\r\n                {\r\n                    'hitsTotal': VizPortalReact.DataGridCells.LocalizedCountWithBar('hitsTotal', function (data) { return data.maxStatValues; }, 'metrics-column-bars'),\r\n                    'hitsLastTwoWeeksTotal': VizPortalReact.DataGridCells.LocalizedCountWithBar('hitsLastTwoWeeksTotal', function (data) { return data.maxStatValues; }, 'metrics-column-bars')\r\n                }));\r\n                columns.push({\r\n                    name: 'favorites-col',\r\n                    dataKey: 'favoritesTotal',\r\n                    text: translate('metric_favoritesTotal'),\r\n                    cellFormatter: VizPortalReact.DataGridCells.LocalizedCountWithBar('favoritesTotal', function (data) { return data.maxStatValues; }, 'favorites-column-bars'),\r\n                    direction: 'desc',\r\n                    headerStyle: { textAlign: 'left' },\r\n                    cellStyle: { textAlign: 'left' },\r\n                    preferredWidth: 200\r\n                });\r\n            }\r\n            columns.push({\r\n                name: 'num-sheets-col',\r\n                dataKey: 'numSheets',\r\n                text: translate('column_numSheets'),\r\n                cellFormatter: VizPortalReact.DataGridCells.LocalizedCount('numSheets'),\r\n                direction: 'asc',\r\n                headerStyle: { textAlign: 'right' },\r\n                cellStyle: { textAlign: 'right' }\r\n            });\r\n            columns.push({\r\n                name: 'size-col',\r\n                dataKey: 'size',\r\n                text: translate('column_size'),\r\n                cellFormatter: VizPortalReact.DataGridCells.SizeCell('size', sizeFilter),\r\n                direction: 'asc',\r\n                headerStyle: { textAlign: 'right' },\r\n                cellStyle: { textAlign: 'right' }\r\n            });\r\n            if (showProjectColumn) {\r\n                columns.push({\r\n                    name: 'project-name-col',\r\n                    dataKey: 'projectName',\r\n                    text: translate('column_project'),\r\n                    direction: 'asc',\r\n                    cellFormatter: VizPortalReact.DataGridCells.Link(function (row) {\r\n                        return {\r\n                            text: row.data.project.name,\r\n                            url: siteUrls.projectUrl(row.data.project.id)\r\n                        };\r\n                    })\r\n                });\r\n            }\r\n            columns = columns.concat([\r\n                VizPortalReact.CommonDataGridColumns.owner(translate, siteUrls),\r\n                {\r\n                    name: 'updated-at-col',\r\n                    dataKey: 'updatedAt',\r\n                    text: translate('column_updated'),\r\n                    direction: 'desc',\r\n                    cellFormatter: VizPortalReact.DataGridCells.DateTimeCell('updatedAt')\r\n                },\r\n                VizPortalReact.CommonDataGridColumns.alert('workbook', translate, angularContext)\r\n            ]);\r\n            return columns;\r\n        }\r\n        WorkbookGrid.columns = columns;\r\n        function nameColumn(translate, siteUrls, anyActionsAllowed, actions, getActionTarget) {\r\n            var col = {\r\n                name: 'name-col',\r\n                dataKey: 'name',\r\n                text: translate('column_name'),\r\n                direction: 'asc',\r\n                cellFormatter: VizPortalReact.DataGridCells.Link(function (row) {\r\n                    return {\r\n                        text: row.data.name,\r\n                        url: siteUrls.workbookUrl(row.data.id),\r\n                        iconClassName: 'tb-grid-icon-workbook',\r\n                        iconTitle: translate('workbook')\r\n                    };\r\n                })\r\n            };\r\n            if (anyActionsAllowed) {\r\n                col = VizPortalReact.CommonDataGridColumns.withActions(col, {\r\n                    actions: actions,\r\n                    getActionTarget: getActionTarget,\r\n                    translate: translate\r\n                });\r\n            }\r\n            return col;\r\n        }\r\n    })(WorkbookGrid = VizPortalReact.WorkbookGrid || (VizPortalReact.WorkbookGrid = {}));\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../controllers/ContentPlaceCtrl.ts\" />\r\n/// <reference path=\"../controllers/FilterPanelCtrl.ts\" />\r\n/// <reference path=\"../directives/tbSelectionMenu.ts\" />\r\n/// <reference path=\"../directives/tbTypeahead.ts\" />\r\n/// <reference path=\"../filters/SizeFilter.ts\" />\r\n/// <reference path=\"../helpers/ActionButtonsHelper.ts\" />\r\n/// <reference path=\"../helpers/SubplaceCountsHelper.ts\" />\r\n/// <reference path=\"../models/Content.ts\" />\r\n/// <reference path=\"../models/ContentTypes.ts\" />\r\n/// <reference path=\"../models/FlowLayout.ts\" />\r\n/// <reference path=\"../models/ITemplate.ts\" />\r\n/// <reference path=\"../models/IPlace.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/types/resourceParts.ts\" />\r\n/// <reference path=\"../ServerApi/types/IOrderClause.ts\" />\r\n/// <reference path=\"../services/ActionPanelService.ts\" />\r\n/// <reference path=\"../services/BrowserTitleService.ts\" />\r\n/// <reference path=\"../services/FilterPanelService.ts\" />\r\n/// <reference path=\"../services/HelpService.ts\" />\r\n/// <reference path=\"../services/SorterFactory.ts\" />\r\n/// <reference path=\"../../app/SiteUrls.ts\" />\r\n/// <reference path=\"../../app/content/DatasourceGrid.ts\" />\r\n/// <reference path=\"../../app/content/ProjectGrid.ts\" />\r\n/// <reference path=\"../../app/content/SiteGrid.ts\" />\r\n/// <reference path=\"../../app/content/ViewGrid.ts\" />\r\n/// <reference path=\"../../app/content/WorkbookGrid.ts\" />\r\n/// <reference path=\"../../common/react/OrderStore.ts\" />\r\n/// <reference path=\"../../common/react/SorterActions.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ContentSubplaceCtrl = (function () {\r\n        function ContentSubplaceCtrl($scope, $translate, $state, AngularToReactDataGridBridge, sizeFilter, BrowserTitleService, ContentActions, CreateSiteAction, queryService, filterPanelService, actionPanelService, ServerService, SorterFactory, Favorites, BrowserSupportService, HelpService, AngularContextFactory, subplace, resource, detailsUrl, projectUrl, workbookUrl, defaultOrder, shouldFetchDetails) {\r\n            var _this = this;\r\n            this.$scope = $scope;\r\n            this.$translate = $translate;\r\n            this.AngularToReactDataGridBridge = AngularToReactDataGridBridge;\r\n            this.sizeFilter = sizeFilter;\r\n            this.actionPanelService = actionPanelService;\r\n            this.ServerService = ServerService;\r\n            this.HelpService = HelpService;\r\n            this.AngularContextFactory = AngularContextFactory;\r\n            this.subplace = subplace;\r\n            this.projectUrl = projectUrl;\r\n            // Sort Order\r\n            $scope.sorter = SorterFactory.create(defaultOrder);\r\n            var useReactDataGrid = this.isReactDataGridEnabled(subplace.type);\r\n            $scope.useReactDataGrid = useReactDataGrid;\r\n            if (useReactDataGrid) {\r\n                this.configureForReactDataGrid(subplace.type, $scope.place, $scope.sorter);\r\n            }\r\n            $scope.busy = false;\r\n            BrowserTitleService.setTitle(subplace.name, $scope.objectName);\r\n            $scope.isTouch = BrowserSupportService.isTouch();\r\n            $scope.selectedItems = new VizPortal.Set(function (item) { return item.id; });\r\n            $scope.contentType = subplace.type.name;\r\n            var explicitFilterKeys = subplace.filterKeys();\r\n            $scope.filterControls = {};\r\n            // Filter panel controls\r\n            $scope.filterDefinitions = filterPanelService.getFilterDefinitions(explicitFilterKeys);\r\n            $scope.filterFieldValues = function (filterField) {\r\n                return function (matchText) { return subplace.filterValuesQuery(filterField).withMatchText(matchText); };\r\n            };\r\n            $scope.getFieldValueQuery = function (filterField) {\r\n                return subplace.filterValuesQuery(filterField).withMatchText('');\r\n            };\r\n            $scope.availableAction = function (action) { return action.isAvailable($scope.selectedItems, $scope.detailedItem, $scope.allowedActions); };\r\n            VizPortal.ActionButtonsHelper.setupActionButtons($scope, actionPanelService.getContentActionButtons($scope.contentType, $scope.place));\r\n            $scope.listActions = [\r\n                {\r\n                    name: 'create-project',\r\n                    translate: 'createProject',\r\n                    isAvailable: function () { return subplace.type.name === VizPortal.ProjectContentType.name && ServerService.isSessionSiteOrServerAdmin(); },\r\n                    execute: function ($event) {\r\n                        ContentActions.createProject(VizPortal.ActionContext.fromEvent($event))\r\n                            .then(function (result) {\r\n                            if (result.id) {\r\n                                $scope.refreshContent();\r\n                            }\r\n                        });\r\n                    }\r\n                },\r\n                {\r\n                    name: 'create-new-site',\r\n                    translate: 'newSite',\r\n                    isAvailable: function () { return subplace.type.name === VizPortal.SitesContentType.name; },\r\n                    execute: function ($event) {\r\n                        CreateSiteAction.execute($scope).then(function () { return $state.hardReload(); });\r\n                    }\r\n                }\r\n            ];\r\n            $scope.availableListAction = function (listAction) { return listAction.isAvailable(); };\r\n            // Layout\r\n            $scope.gridLayout = _.once(function (width, height) {\r\n                return new VizPortal.FlowLayout(width, height);\r\n            });\r\n            // Popovers\r\n            $scope.getItemDetails = function (item) {\r\n                var detailsResource = resource;\r\n                return detailsResource.getById(item.id);\r\n            };\r\n            var getActions = function (item) {\r\n                var actionResource = resource;\r\n                //TODO: Remove this check once all objects have permissions\r\n                if (!actionResource.actions)\r\n                    return null;\r\n                return actionResource.actions(item.id);\r\n            };\r\n            // Fetch and set detailed item iff 1 item is selected\r\n            $scope.detailedItem = null;\r\n            var pendingDetailId;\r\n            $scope.$watch(function () { return ($scope.selectedItems.size() === 1) ? $scope.selectedItems.first().id : null; }, function (id) {\r\n                $scope.detailedItem = null;\r\n                $scope.allowedActions = null;\r\n                if (_.isString(id)) {\r\n                    pendingDetailId = id;\r\n                    var item = $scope.selectedItems.first();\r\n                    if (shouldFetchDetails(item)) {\r\n                        $scope.getItemDetails(item).then(function (detailedItem) {\r\n                            if (id === pendingDetailId) {\r\n                                $scope.detailedItem = detailedItem;\r\n                                if ($scope.dataGridProps) {\r\n                                    $scope.dataGridProps.update++;\r\n                                }\r\n                            }\r\n                        });\r\n                    }\r\n                    //TODO Remove then object below once all resources have actions\r\n                    (getActions(item) || { then: angular.noop }).then(function (actions) {\r\n                        if (id === pendingDetailId)\r\n                            $scope.allowedActions = actions;\r\n                    });\r\n                }\r\n                else {\r\n                    pendingDetailId = null;\r\n                }\r\n            });\r\n            $scope.refreshContent = function () {\r\n                _this.refresh();\r\n                $scope.$emit(VizPortal.SubplaceEvents.RefreshCounts, subplace.name);\r\n            };\r\n            $scope.$on(VizPortal.SubplaceEvents.Refresh, function () {\r\n                $scope.refreshContent();\r\n            });\r\n            $scope.$on(VizPortal.SelectionEvent.SelectionStarted, function () {\r\n                $scope.busy = true;\r\n            });\r\n            $scope.$on(VizPortal.SelectionEvent.SelectionEnded, function () {\r\n                $scope.busy = false;\r\n            });\r\n            this.query = queryService.createQueryUpdaterFromSubplace($scope, subplace, function (query) {\r\n                if (useReactDataGrid) {\r\n                    _this.AngularToReactDataGridBridge.updateReactDataGridRowStore({ scope: $scope, sliceable: query });\r\n                }\r\n                $scope.sliceable = query;\r\n                $scope.sorter.setOrder(query.getOrder());\r\n            });\r\n            $scope.detailsUrl = detailsUrl;\r\n            $scope.projectUrl = projectUrl;\r\n            $scope.workbookUrl = workbookUrl;\r\n            $scope.sliceChanged = function (newSlice) {\r\n                $scope.isEmpty = newSlice.total === 0;\r\n                $scope.selectedItems.updateItems(newSlice.items);\r\n                VizPortal.SubplaceCountsHelper.updateCountsFromSubplace($scope, subplace, newSlice.total);\r\n            };\r\n            $scope.anyActionsAllowed = function () { return _this.anyActionsAllowed(subplace.type.name, $scope.place, $scope.ownerId); };\r\n            $scope.showModeSwitcher = function () {\r\n                switch ($scope.contentType) {\r\n                    case VizPortal.ContentTypes.project:\r\n                    case VizPortal.ContentTypes.workbook:\r\n                    case VizPortal.ContentTypes.view:\r\n                        return true;\r\n                    default:\r\n                        return false;\r\n                }\r\n            };\r\n            $scope.shouldShowReadMore = function ($event) {\r\n                var card = $($event.currentTarget).parent();\r\n                var descriptionContainerHeight = card.find('.tb-card-view-description').height() - 16; // 16px == lineHeight\r\n                var descriptionTextHeight = card.find('.tb-card-view-description-text').height();\r\n                return descriptionTextHeight > descriptionContainerHeight;\r\n            };\r\n            $scope.addFavorite = function (item) {\r\n                switch ($scope.contentType) {\r\n                    case VizPortal.ContentTypes.workbook:\r\n                        return Favorites.addWorkbook(item);\r\n                    case VizPortal.ContentTypes.view:\r\n                        return Favorites.addView(item);\r\n                    default:\r\n                        return;\r\n                }\r\n            };\r\n            $scope.removeFavorite = function (item) {\r\n                switch ($scope.contentType) {\r\n                    case VizPortal.ContentTypes.workbook:\r\n                        return Favorites.removeWorkbook(item);\r\n                    case VizPortal.ContentTypes.view:\r\n                        return Favorites.removeView(item);\r\n                    default:\r\n                        return;\r\n                }\r\n            };\r\n            $scope.isLiveDBAvailable = ServerService.isLiveDBAvailable(); // Used in Sites subplace\r\n            $scope.emptyTemplateModel = this.createEmptyTemplateModel($scope.contentType, $scope.place);\r\n            this.refresh();\r\n        }\r\n        ContentSubplaceCtrl.prototype.isReactDataGridEnabled = function (contentType) {\r\n            switch (contentType) {\r\n                case VizPortal.DatasourceContentType:\r\n                    return VizPortal.FeatureFlags.reactDatasourceGrid;\r\n                case VizPortal.ProjectContentType:\r\n                    return VizPortal.FeatureFlags.reactProjectGrid;\r\n                case VizPortal.SitesContentType:\r\n                    return VizPortal.FeatureFlags.reactSitesGrid;\r\n                case VizPortal.WorkbookContentType:\r\n                    return VizPortal.FeatureFlags.reactWorkbookGrid;\r\n                case VizPortal.ViewContentType:\r\n                case VizPortal.ViewInWorkbookContentType:\r\n                    return VizPortal.FeatureFlags.reactViewGrid;\r\n            }\r\n            return false;\r\n        };\r\n        ContentSubplaceCtrl.prototype.configureForReactDataGrid = function (contentType, place, sorter) {\r\n            var _this = this;\r\n            var orderStore = sorter.getOrderStore();\r\n            var sorterActions = {\r\n                setPrimaryOrder: function (columnKey, direction) { return _this.$scope.$apply(function () { return _this.$scope.sorter.setPrimary(columnKey, direction); }); },\r\n                removeFieldFromOrder: function (columnKey) { return _this.$scope.$apply(function () { return _this.$scope.sorter.removeFieldFromOrder(columnKey); }); }\r\n            };\r\n            var columns = this.reactDataGridColumnsFor(contentType, place, orderStore, sorterActions);\r\n            var emptyTemplateModel = this.createEmptyTemplateModel(contentType.name, place);\r\n            this.AngularToReactDataGridBridge.attachReactDataGridToScope(this.$scope, columns, emptyTemplateModel);\r\n            this.$scope.dataGridProps.updated = function (rows) {\r\n                _this.$scope.isEmpty = rows.length === 0;\r\n                _this.$scope.selectedItems.updateItems(_.map(rows, function (row) { return row.data; }));\r\n                VizPortal.SubplaceCountsHelper.updateCountsFromSubplace(_this.$scope, _this.subplace, rows.length);\r\n            };\r\n            this.$scope.$watch(function () { return _this.$scope.sorter.selectedColumnKey() + ';' + _this.$scope.sorter.isSortAscending(); }, function () {\r\n                _this.$scope.dataGridProps.cols = _this.reactDataGridColumnsFor(contentType, place, orderStore, sorterActions);\r\n                _this.$scope.dataGridProps.update++;\r\n            });\r\n        };\r\n        ContentSubplaceCtrl.prototype.reactDataGridColumnsFor = function (contentType, place, orderStore, sorterActions) {\r\n            var _this = this;\r\n            var siteUrls = new VizPortalReact.SiteUrls({\r\n                siteUrlName: this.ServerService.sessionSiteUrlName(),\r\n                queryString: window.location.search\r\n            });\r\n            var getActionTarget = function () {\r\n                return {\r\n                    items: _this.$scope.selectedItems,\r\n                    detailedItem: _this.$scope.detailedItem,\r\n                    actionContext: { scope: _this.$scope },\r\n                    allowedActions: _this.$scope.allowedActions\r\n                };\r\n            };\r\n            switch (contentType) {\r\n                case VizPortal.ProjectContentType:\r\n                    return VizPortalReact.ProjectGrid.columns(function (id) { return _this.$translate.instant(id); }, siteUrls, this.actionPanelService.getContentActionButtons(contentType.name, place), getActionTarget, this.$scope, this.anyActionsAllowed(contentType.name, place, this.$scope.ownerId));\r\n                case VizPortal.SitesContentType:\r\n                    return VizPortalReact.SiteGrid.columns(function (id) { return _this.$translate.instant(id); }, this.$scope, this.sizeFilter, this.actionPanelService.getContentActionButtons(contentType.name, place), getActionTarget, siteUrls, this.ServerService.isLiveDBAvailable());\r\n                case VizPortal.WorkbookContentType:\r\n                    return VizPortalReact.WorkbookGrid.columns(function (id) { return _this.$translate.instant(id); }, this.sizeFilter, this.$scope, this.AngularContextFactory.create(this.$scope), siteUrls, this.actionPanelService.getContentActionButtons(contentType.name, place), getActionTarget, this.anyActionsAllowed(contentType.name, place, this.$scope.ownerId), place !== 'project', orderStore, sorterActions);\r\n                case VizPortal.ViewContentType:\r\n                case VizPortal.ViewInWorkbookContentType:\r\n                    return VizPortalReact.ViewGrid.columns(function (id) { return _this.$translate.instant(id); }, this.$scope, siteUrls, this.actionPanelService.getContentActionButtons(contentType.name, place), getActionTarget, this.anyActionsAllowed(contentType.name, place, this.$scope.ownerId), place === 'project', place === 'workbook');\r\n                case VizPortal.DatasourceContentType:\r\n                    return VizPortalReact.DatasourceGrid.columns(function (id) { return _this.$translate.instant(id); }, this.$scope, siteUrls, this.actionPanelService.getContentActionButtons(contentType.name, place), getActionTarget, this.anyActionsAllowed(contentType.name, place, this.$scope.ownerId), place === 'project', place === 'workbook', this.AngularContextFactory.create(this.$scope));\r\n                default:\r\n                    throw \"No react data grid for content type \" + contentType.name;\r\n            }\r\n        };\r\n        // Is the user able to perform any actions\r\n        ContentSubplaceCtrl.prototype.anyActionsAllowed = function (contentType, place, ownerId) {\r\n            switch (contentType) {\r\n                case VizPortal.ProjectContentType.name:\r\n                    return this.ServerService.isSessionSiteOrServerAdmin();\r\n                case VizPortal.DatasourceContentType.name:\r\n                    if (place === VizPortal.WorkbookContentType.name) {\r\n                        // Viewing a data sources subplace in a workbook place and the user is not an admin or the workbook owner\r\n                        return this.ServerService.isSessionSiteOrServerAdmin() || ownerId === this.ServerService.sessionUserId();\r\n                    }\r\n                default:\r\n                    return true;\r\n            }\r\n        };\r\n        ContentSubplaceCtrl.prototype.refresh = function () {\r\n            this.query.refresh();\r\n        };\r\n        ContentSubplaceCtrl.prototype.createEmptyTemplateModel = function (contentType, place) {\r\n            var emptyTemplateModel = {};\r\n            switch (contentType) {\r\n                case VizPortal.ContentTypes.view:\r\n                    emptyTemplateModel.title = 'viewsEmptyMessage';\r\n                    break;\r\n                case VizPortal.ContentTypes.workbook:\r\n                    var isDataSourcePlace = place === VizPortal.DatasourceContentType.name;\r\n                    emptyTemplateModel.title = isDataSourcePlace ? 'workbooksForDataSourceEmptyMessage' : 'workbooksEmptyMessage';\r\n                    break;\r\n                case VizPortal.ContentTypes.project:\r\n                    emptyTemplateModel.title = 'projectsEmptyMessage';\r\n                    break;\r\n                case VizPortal.ContentTypes.datasource:\r\n                    var helpUrl = this.HelpService.getDatasourceHelpUrl();\r\n                    emptyTemplateModel.title = 'datasourcesEmptyMessage';\r\n                    if (helpUrl) {\r\n                        emptyTemplateModel.help = {\r\n                            links: [{\r\n                                    localizedValueKey: 'remoteRefreshSchedulesEmptyHelp',\r\n                                    url: helpUrl\r\n                                }]\r\n                        };\r\n                    }\r\n                    break;\r\n                case VizPortal.SitesContentType.name:\r\n                    emptyTemplateModel.title = 'sitesEmptyMessage';\r\n                    break;\r\n            }\r\n            return emptyTemplateModel;\r\n        };\r\n        ContentSubplaceCtrl.$inject = [\r\n            // Services\r\n            '$scope',\r\n            '$translate',\r\n            '$state',\r\n            'AngularToReactDataGridBridge',\r\n            'sizeFilter',\r\n            'BrowserTitleService',\r\n            'ContentActions',\r\n            'CreateSiteAction',\r\n            'QueryService',\r\n            'FilterPanelService',\r\n            'ActionPanelService',\r\n            'ServerService',\r\n            'SorterFactory',\r\n            'Favorites',\r\n            'BrowserSupportService',\r\n            'HelpService',\r\n            'AngularContextFactory',\r\n            // Resolved on ui-router state config, keep in sync with IContentSubplaceResolve\r\n            'subplace',\r\n            'resource',\r\n            'detailsUrl',\r\n            'projectUrl',\r\n            'workbookUrl',\r\n            'defaultOrder',\r\n            'shouldFetchDetails'\r\n        ];\r\n        return ContentSubplaceCtrl;\r\n    })();\r\n    VizPortal.ContentSubplaceCtrl = ContentSubplaceCtrl;\r\n    VizPortal.Module.instance().controller('ContentSubplaceCtrl', ContentSubplaceCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ErrorCtrl = (function () {\r\n        function ErrorCtrl($scope, $state, $stateParams, server) {\r\n            // attempt to coerce to number\r\n            var error = +$stateParams.errorCode;\r\n            if (!error) {\r\n                var redirectState = $stateParams.redirectState || 'main.site.content.site.projects';\r\n                var redirectSiteUrlName = $stateParams.redirectSiteUrlName || server.sessionSiteUrlName();\r\n                $scope.redirectLocKey = $stateParams.redirectLocKey || 'backToContent';\r\n                $scope.redirectUrl = $state.href(redirectState, { siteUrlName: redirectSiteUrlName });\r\n                $scope.detailsLocKey = $stateParams.detailsLocKey || 'pageDoesNotExist';\r\n            }\r\n            else {\r\n                switch (error) {\r\n                    case VizPortal.SolrErrorCode.SolrDisabled:\r\n                    case VizPortal.SolrErrorCode.SolrCommunicationError:\r\n                        $scope.redirectLocKey = null;\r\n                        $scope.redirectUrl = null;\r\n                        $scope.detailsLocKey = 'serverDown';\r\n                        break;\r\n                    default:\r\n                        $scope.redirectLocKey = null;\r\n                        $scope.redirectUrl = null;\r\n                        $scope.detailsLocKey = $stateParams.detailsLocKey || 'pageDoesNotExist';\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        ErrorCtrl.StateParamKeys = {\r\n            DetailsLocKey: 'detailsLocKey',\r\n            RedirectState: 'redirectState',\r\n            RedirectLocKey: 'redirectLocKey',\r\n            RedirectSiteUrlName: 'redirectSiteUrlName'\r\n        };\r\n        ErrorCtrl.$inject = [\r\n            '$scope',\r\n            '$state',\r\n            '$stateParams',\r\n            'ServerService'\r\n        ];\r\n        return ErrorCtrl;\r\n    })();\r\n    VizPortal.ErrorCtrl = ErrorCtrl;\r\n    VizPortal.Module.instance().controller('ErrorCtrl', ErrorCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/CommonDataGridColumns.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var ExtractTasksGrid;\r\n    (function (ExtractTasksGrid) {\r\n        function columns(translate, scope, anyActionsAllowed, actions, isServerPage, serverUrls, siteUrls, scheduleFrequencyDescriptionFilter, showWorkbookOrDatasourceColumn, showScheduleColumn, showSiteColumn) {\r\n            var columns = [\r\n                VizPortalReact.CommonDataGridColumns.selected(scope)\r\n            ];\r\n            if (showWorkbookOrDatasourceColumn) {\r\n                columns.push({\r\n                    name: 'workbook-datasource-col',\r\n                    dataKey: 'targetName',\r\n                    direction: 'asc',\r\n                    text: translate('column_task_workbook_data_source'),\r\n                    cellFormatter: targetLinkFormatter(siteUrls, translate)\r\n                });\r\n            }\r\n            columns.push({\r\n                name: 'task-type-col',\r\n                dataKey: 'type',\r\n                direction: 'asc',\r\n                text: translate('column_task_type'),\r\n                cellFormatter: VizPortalReact.DataGridCells.PlainTextCellWithTransform('type', function (type) { return type === VizPortal.ServerApi.ExtractTaskType.IncrementExtract\r\n                    ? translate('extractTasksIncremental')\r\n                    : translate('extractTasksFull'); })\r\n            });\r\n            if (showScheduleColumn) {\r\n                columns.push({\r\n                    name: 'schedule-name-col',\r\n                    dataKey: 'scheduleName',\r\n                    direction: 'asc',\r\n                    text: translate('column_task_schedule'),\r\n                    cellFormatter: VizPortalReact.DataGridCells.ScheduleDescriptionCell(function (row) {\r\n                        var subscription = row.data;\r\n                        // This cast to ISchedule shouldn't be necessary, but for some reason\r\n                        // subscription.schedule is of type INamedItemInfo.\r\n                        // TODO: figure out why this is the case and refactor the types accordingly.\r\n                        var schedule = subscription.schedule;\r\n                        return isServerPage\r\n                            ? serverUrls.schedule(schedule.id, schedule.scheduledAction)\r\n                            : siteUrls.schedule(schedule.id, schedule.scheduledAction);\r\n                    }, scheduleFrequencyDescriptionFilter)\r\n                });\r\n            }\r\n            columns.push({\r\n                name: 'priority-col',\r\n                dataKey: 'priority',\r\n                direction: 'asc',\r\n                text: translate('column_task_priority'),\r\n                cellFormatter: VizPortalReact.DataGridCells.LocalizedCount('priority'),\r\n                headerStyle: { textAlign: 'right' },\r\n                cellStyle: { textAlign: 'right' }\r\n            });\r\n            if (showSiteColumn) {\r\n                columns.push({\r\n                    name: 'site-name-col',\r\n                    dataKey: 'siteName',\r\n                    direction: 'asc',\r\n                    text: translate('column_task_site'),\r\n                    cellFormatter: VizPortalReact.DataGridCells.PlainTextCellWithTransform('site', function (site) { return site.name; })\r\n                });\r\n            }\r\n            columns.push({\r\n                name: 'last-run-at-col',\r\n                dataKey: 'lastRunAt',\r\n                text: translate('column_task_last_update'),\r\n                direction: 'desc',\r\n                cellFormatter: VizPortalReact.DataGridCells.DateTimeCell('lastRunAt', translate('never'))\r\n            });\r\n            columns.push({\r\n                name: 'next-run-at-col',\r\n                dataKey: 'runNextAt',\r\n                text: translate('column_task_next_update'),\r\n                direction: 'asc',\r\n                cellFormatter: VizPortalReact.DataGridCells.DateTimeCell('runNextAt', translate('disabled'))\r\n            });\r\n            // Add the actions menu to whichever column was first (not including the 'selected' column)\r\n            if (anyActionsAllowed) {\r\n                columns[1] = VizPortalReact.CommonDataGridColumns.withActions(columns[1], {\r\n                    actions: actions,\r\n                    getActionTarget: function () {\r\n                        return {\r\n                            items: scope.selectedItems,\r\n                            actionContext: { scope: scope }\r\n                        };\r\n                    },\r\n                    translate: translate\r\n                });\r\n            }\r\n            return columns;\r\n        }\r\n        ExtractTasksGrid.columns = columns;\r\n        function targetLinkFormatter(siteUrls, translate) {\r\n            return VizPortalReact.DataGridCells.Link(function (row) {\r\n                var extractTask = row.data;\r\n                var siteUrlsForRow = siteUrls.forSiteUrlName(extractTask.site.urlName);\r\n                if (row.data.datasource) {\r\n                    var datasource = row.data.datasource;\r\n                    return {\r\n                        text: datasource.name,\r\n                        url: siteUrlsForRow.datasourceUrl(datasource.id),\r\n                        iconClassName: 'tb-grid-icon-datasource',\r\n                        iconTitle: translate('datasource')\r\n                    };\r\n                }\r\n                else {\r\n                    var workbook = row.data.workbook;\r\n                    return {\r\n                        text: workbook.name,\r\n                        url: siteUrlsForRow.workbookUrl(workbook.id),\r\n                        iconClassName: 'tb-grid-icon-workbook',\r\n                        iconTitle: translate('workbook')\r\n                    };\r\n                }\r\n            });\r\n        }\r\n    })(ExtractTasksGrid = VizPortalReact.ExtractTasksGrid || (VizPortalReact.ExtractTasksGrid = {}));\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/CommonDataGridColumns.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var RemoteRefreshScheduleGrid;\r\n    (function (RemoteRefreshScheduleGrid) {\r\n        function columns(translate, scope, anyActionsAllowed, actions, remoteRefreshScheduleTypeNameFilter, cronExpressionFilter) {\r\n            var columns = [];\r\n            if (anyActionsAllowed) {\r\n                columns.push(VizPortalReact.CommonDataGridColumns.selected(scope));\r\n            }\r\n            var refreshTypeColumn = {\r\n                name: 'refreshType-col',\r\n                dataKey: 'refreshType',\r\n                text: translate('column_remote_schedule_refresh_type'),\r\n                direction: 'asc',\r\n                cellFormatter: VizPortalReact.DataGridCells.PlainTextCellWithTransform('refreshType', remoteRefreshScheduleTypeNameFilter)\r\n            };\r\n            if (anyActionsAllowed) {\r\n                refreshTypeColumn = VizPortalReact.CommonDataGridColumns.withActions(refreshTypeColumn, {\r\n                    actions: actions,\r\n                    getActionTarget: function () {\r\n                        return {\r\n                            items: scope.selectedItems,\r\n                            actionContext: { scope: scope }\r\n                        };\r\n                    },\r\n                    translate: translate\r\n                });\r\n            }\r\n            columns = columns.concat([\r\n                refreshTypeColumn,\r\n                {\r\n                    name: 'definition-col',\r\n                    dataKey: 'definition',\r\n                    text: translate('column_remote_schedule_definition'),\r\n                    direction: 'asc',\r\n                    cellFormatter: VizPortalReact.DataGridCells.PlainTextCellWithTransform('definition', cronExpressionFilter)\r\n                },\r\n                {\r\n                    name: 'priority-col',\r\n                    dataKey: 'priority',\r\n                    text: translate('column_task_priority'),\r\n                    cellFormatter: VizPortalReact.DataGridCells.FixedValue(translate('notApplicable')),\r\n                    direction: 'asc'\r\n                },\r\n                {\r\n                    name: 'lastRunAt-col',\r\n                    dataKey: 'lastRunAt',\r\n                    text: translate('column_task_last_update'),\r\n                    direction: 'asc',\r\n                    cellFormatter: VizPortalReact.DataGridCells.DateTimeCell('lastRunAt', translate('unavailable'))\r\n                },\r\n                {\r\n                    name: 'runNextAt-col',\r\n                    dataKey: 'runNextAt',\r\n                    text: translate('column_task_next_update'),\r\n                    direction: 'asc',\r\n                    cellFormatter: VizPortalReact.DataGridCells.DateTimeCell('runNextAt', translate('unavailable'))\r\n                }\r\n            ]);\r\n            return columns;\r\n        }\r\n        RemoteRefreshScheduleGrid.columns = columns;\r\n    })(RemoteRefreshScheduleGrid = VizPortalReact.RemoteRefreshScheduleGrid || (VizPortalReact.RemoteRefreshScheduleGrid = {}));\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../../../ts/libs.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var AngularToReactDataGridBridge = (function () {\r\n        function AngularToReactDataGridBridge($translate, locLinkifier) {\r\n            this.$translate = $translate;\r\n            this.locLinkifier = locLinkifier;\r\n        }\r\n        AngularToReactDataGridBridge.prototype.attachReactDataGridToScope = function ($scope, columns, emptyTemplateModel) {\r\n            $scope.dataGridProps = {\r\n                // Message to display for an empty grid\r\n                emptyChild: this.emptyTemplateElementFor(emptyTemplateModel),\r\n                // This gets incremented on each update, to force the data grid to re-render\r\n                update: 0,\r\n                cols: columns,\r\n                // Sort on header click\r\n                onHeaderClicked: function (columnKey, direction) {\r\n                    $scope.$apply(function () {\r\n                        $scope.sorter.setPrimary(columnKey, direction);\r\n                    });\r\n                },\r\n                // Select row on cell click\r\n                onCellClick: function (item, columnKey) {\r\n                    $scope.$apply(function () {\r\n                        if (VizPortal.FeatureFlags.toggleSelectableRow) {\r\n                            var onlySelectedRow = $scope.selectedItems.size() === 1 && $scope.selectedItems.contains(item);\r\n                            var isActionMenu = columnKey === 'actions';\r\n                            if (onlySelectedRow && !isActionMenu) {\r\n                                $scope.selectedItems.toggle(item);\r\n                            }\r\n                            else {\r\n                                $scope.selectedItems.clear();\r\n                                $scope.selectedItems.add(item);\r\n                            }\r\n                        }\r\n                        else {\r\n                            $scope.selectedItems.clear();\r\n                            $scope.selectedItems.add(item);\r\n                        }\r\n                        var keys = $scope.selectedItems.keys();\r\n                        $scope.dataGridProps.selectedKeys = _.object(keys, keys);\r\n                        $scope.dataGridProps.update++;\r\n                    });\r\n                }\r\n            };\r\n            // Re-render the grid when the sort order changes\r\n            $scope.$watch(function () { return $scope.sorter.selectedColumnKey() + ';' + $scope.sorter.isSortAscending(); }, function () {\r\n                $scope.dataGridProps.sortKey = $scope.sorter.selectedColumnKey();\r\n                $scope.dataGridProps.sortAscending = $scope.sorter.isSortAscending();\r\n                $scope.dataGridProps.update++;\r\n            });\r\n            // Re-render the grid when the selection changes\r\n            // TODO: find a better way to monitor changes in selected items\r\n            $scope.$watch(function () { return $scope.selectedItems.size(); }, function () {\r\n                var keys = $scope.selectedItems.keys();\r\n                $scope.dataGridProps.selectedKeys = _.object(keys, keys);\r\n                $scope.dataGridProps.update++;\r\n            });\r\n        };\r\n        AngularToReactDataGridBridge.prototype.emptyTemplateElementFor = function (emptyTemplateModel) {\r\n            var _this = this;\r\n            var children = [];\r\n            if (emptyTemplateModel.title) {\r\n                children.push(React.DOM.div({\r\n                    key: 'title',\r\n                    className: 'tb-data-grid-empty-title'\r\n                }, this.$translate.instant(emptyTemplateModel.title)));\r\n            }\r\n            if (emptyTemplateModel.body) {\r\n                children.push(React.DOM.div({\r\n                    key: 'body',\r\n                    className: 'tb-data-grid-empty-body'\r\n                }, _.map(emptyTemplateModel.body, function (paragraph) {\r\n                    return React.DOM.div({\r\n                        className: 'tb-data-grid-empty-body-paragraph'\r\n                    }, _.map(paragraph.statements, function (statement) {\r\n                        return React.DOM.div({\r\n                            key: 'help',\r\n                            dangerouslySetInnerHTML: { __html: _this.locLinkifier(statement) }\r\n                        });\r\n                    }));\r\n                })));\r\n            }\r\n            if (emptyTemplateModel.help) {\r\n                children.push(React.DOM.div({\r\n                    key: 'help',\r\n                    className: 'tb-data-grid-empty-help-link',\r\n                    dangerouslySetInnerHTML: { __html: this.locLinkifier(emptyTemplateModel.help) }\r\n                }));\r\n            }\r\n            return React.DOM.div({ className: 'tb-data-grid-empty' }, children);\r\n        };\r\n        AngularToReactDataGridBridge.prototype.updateReactDataGridRowStore = function (config) {\r\n            var keyForItem = config.keyForItem || (function (item) { return item['id']; });\r\n            config.scope.dataGridProps.rowStore = new VizPortalReact.SparseCachedList(config.sliceable, function (item) {\r\n                return {\r\n                    key: keyForItem(item),\r\n                    data: item,\r\n                    rowStyle: config.getRowStyle ? config.getRowStyle(item) : null\r\n                };\r\n            });\r\n            config.scope.dataGridProps.update++;\r\n        };\r\n        AngularToReactDataGridBridge.$inject = [\r\n            '$translate',\r\n            'locLinkifierFilter'\r\n        ];\r\n        return AngularToReactDataGridBridge;\r\n    })();\r\n    VizPortalReact.AngularToReactDataGridBridge = AngularToReactDataGridBridge;\r\n    VizPortal.Module.instance().service('AngularToReactDataGridBridge', AngularToReactDataGridBridge);\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    // Sorts things locally on the browser client (as opposed to sorting on the server)\r\n    var LocalSorter = (function () {\r\n        function LocalSorter() {\r\n            this.comparableValueTransforms = {};\r\n        }\r\n        // For a given 'fieldName', mutate the values under comparison using 'subFunc'.\r\n        // Useful when we do not want to sort by the raw value, but by some transformed\r\n        //   version of it.\r\n        LocalSorter.prototype.addTransformForValueComparison = function (fieldName, transformFunc) {\r\n            // _.memoize creates a caching version of the function passed to it\r\n            this.comparableValueTransforms[fieldName] = _.memoize(transformFunc);\r\n        };\r\n        // Sort 'unsortedItems' as specified by 'clauses'\r\n        LocalSorter.prototype.sortByClauses = function (unsortedItems, clauses) {\r\n            var _this = this;\r\n            if (!unsortedItems || unsortedItems.length == 0)\r\n                return unsortedItems;\r\n            var itemsToSort = unsortedItems.slice(0);\r\n            if (!clauses || clauses.length == 0)\r\n                return itemsToSort;\r\n            itemsToSort.sort(function (a, b) { return _this.compareByClauses(a, b, clauses, 0); });\r\n            return itemsToSort;\r\n        };\r\n        // Compare two items in the order specified by 'clauses'\r\n        LocalSorter.prototype.compareByClauses = function (a, b, clauses, clauseIndex) {\r\n            if (clauseIndex >= clauses.length)\r\n                return 0;\r\n            // Compare items according to the first clause\r\n            var clause = clauses[clauseIndex];\r\n            var fieldName = clause.field;\r\n            var valA = a[fieldName];\r\n            var valB = b[fieldName];\r\n            // Maybe transform raw values before comparison\r\n            var transformFunc = this.comparableValueTransforms[fieldName];\r\n            if (transformFunc) {\r\n                valA = transformFunc(valA);\r\n                valB = transformFunc(valB);\r\n            }\r\n            if (valA > valB) {\r\n                return clause.ascending ? 1 : -1;\r\n            }\r\n            else if (valA < valB) {\r\n                return clause.ascending ? -1 : 1;\r\n            }\r\n            else {\r\n                // terms are equal, compare items according to the next clause\r\n                return this.compareByClauses(a, b, clauses, clauseIndex + 1);\r\n            }\r\n        };\r\n        return LocalSorter;\r\n    })();\r\n    VizPortal.LocalSorter = LocalSorter;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var RefreshPropertyHelper;\r\n    (function (RefreshPropertyHelper) {\r\n        function getAvailableRefreshTypes(item) {\r\n            var types = [];\r\n            types.push(VizPortal.ServerApi.RemoteRefreshTypes.Full);\r\n            if (item.hasIncrementalExtract) {\r\n                types.push(VizPortal.ServerApi.RemoteRefreshTypes.Incremental);\r\n            }\r\n            return types;\r\n        }\r\n        RefreshPropertyHelper.getAvailableRefreshTypes = getAvailableRefreshTypes;\r\n        function canBeRefreshedRemotely(datasource) {\r\n            // To be refreshed remotely (on a sync client) the datasource must have an extract and not be OAuth.\r\n            return datasource.hasExtracts &&\r\n                !(datasource.connectionOAuth &&\r\n                    datasource.connectionDetails &&\r\n                    datasource.connectionDetails.type === VizPortal.ServerApi.ConnectionDetailType.Database);\r\n        }\r\n        RefreshPropertyHelper.canBeRefreshedRemotely = canBeRefreshedRemotely;\r\n        function getCurrentRefreshLocation($translate, refreshed) {\r\n            if (refreshed && refreshed.refreshMode === VizPortal.ServerApi.RefreshModeTypes.Remote && refreshed.remoteAgentName) {\r\n                return refreshed.remoteAgentName;\r\n            }\r\n            else if (refreshed && refreshed.refreshMode === VizPortal.ServerApi.RefreshModeTypes.Remote && !refreshed.remoteAgentName) {\r\n                return $translate.instant('remoteRefreshModeUnlinkedLabel');\r\n            }\r\n            else {\r\n                return $translate.instant('remoteRefreshModeServerLabel');\r\n            }\r\n        }\r\n        RefreshPropertyHelper.getCurrentRefreshLocation = getCurrentRefreshLocation;\r\n        // Prevent deep links to the incorrect refresh schedules page\r\n        // 'extractTasks' is the default state\r\n        function redirectByDatasourceRefreshMode($state, refreshMode) {\r\n            // Don't assume the refresh mode property is defined. If it isn't 'extractTasks' is the default state.\r\n            if ($state.is('main.site.content.datasource.remoteRefreshSchedules') && refreshMode !== VizPortal.ServerApi.RefreshModeTypes.Remote) {\r\n                $state.go('^.extractTasks');\r\n            }\r\n            if ($state.is('main.site.content.datasource.extractTasks') && refreshMode === VizPortal.ServerApi.RefreshModeTypes.Remote) {\r\n                $state.go('^.remoteRefreshSchedules');\r\n            }\r\n        }\r\n        RefreshPropertyHelper.redirectByDatasourceRefreshMode = redirectByDatasourceRefreshMode;\r\n    })(RefreshPropertyHelper = VizPortal.RefreshPropertyHelper || (VizPortal.RefreshPropertyHelper = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ChangeDatasourceRemoteRefreshPropertiesAction = (function () {\r\n        function ChangeDatasourceRemoteRefreshPropertiesAction($q, $translate, $window, $state, ConfirmActionDialog, ToasterService, HelpService, ServerService, RemoteRefreshAgents, ChangeDatasourceRefreshModeAction, ChangeDatasourceRemoteAgentAction, CreateExtractTasksAction, CreateRemoteRefreshScheduleAction) {\r\n            this.$q = $q;\r\n            this.$translate = $translate;\r\n            this.$window = $window;\r\n            this.$state = $state;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.ToasterService = ToasterService;\r\n            this.HelpService = HelpService;\r\n            this.ServerService = ServerService;\r\n            this.RemoteRefreshAgents = RemoteRefreshAgents;\r\n            this.ChangeDatasourceRefreshModeAction = ChangeDatasourceRefreshModeAction;\r\n            this.ChangeDatasourceRemoteAgentAction = ChangeDatasourceRemoteAgentAction;\r\n            this.CreateExtractTasksAction = CreateExtractTasksAction;\r\n            this.CreateRemoteRefreshScheduleAction = CreateRemoteRefreshScheduleAction;\r\n            // A special agent \"name\" for the option to add a new agent. (The @@s have no associated magic)\r\n            this.AddNewAgentOption = '@@add-new-agent@@';\r\n        }\r\n        ChangeDatasourceRemoteRefreshPropertiesAction.prototype.execute = function ($event, datasource, openCreateRefreshScheduleOnSave, existingRefreshSchedulesCount) {\r\n            var _this = this;\r\n            var context = VizPortal.ActionContext.fromEvent($event);\r\n            var dialogScope = context.scope.$new();\r\n            dialogScope.prompt = this.$translate.instant('editRemoteRefreshPropertiesDialogPrompt', { DATASOURCE_NAME: VizPortal.L10n.elideIfLong(datasource.name) });\r\n            // careful, the UI depends on Server being the first item in the array, remote the second.\r\n            dialogScope.remoteRefreshModeOptions = [VizPortal.ServerApi.RefreshModeTypes.Server, VizPortal.ServerApi.RefreshModeTypes.Remote];\r\n            dialogScope.remoteAgentOptions = [];\r\n            dialogScope.remoteAgentOptionsEnabled = function () { return dialogScope.editModel.refreshMode === VizPortal.ServerApi.RefreshModeTypes.Remote; };\r\n            dialogScope.remoteRefreshDescription = function () {\r\n                return {\r\n                    localizedStatementKey: 'remoteRefreshModeEditRemoteDescription',\r\n                    links: [{\r\n                            key: '{LEARN_HOW_TO_ADD_A_COMPUTER_TO_THE_LIST}',\r\n                            localizedValueKey: 'remoteRefreshModeEditRemoteDescriptionSetupLink',\r\n                            url: _this.HelpService.getServerHelpUrlByCategory('dataconnections7')\r\n                        }]\r\n                };\r\n            };\r\n            dialogScope.editModel = { refreshMode: datasource.refreshMode, remoteAgentName: datasource.remoteAgentName };\r\n            dialogScope.existingRefreshSchedules = function () { return existingRefreshSchedulesCount; };\r\n            dialogScope.warnRefreshesToBeDeleted = function () {\r\n                return datasource.refreshMode === VizPortal.ServerApi.RefreshModeTypes.Server &&\r\n                    dialogScope.editModel.refreshMode === VizPortal.ServerApi.RefreshModeTypes.Remote &&\r\n                    existingRefreshSchedulesCount > 0;\r\n            };\r\n            dialogScope.warnEmbeddedPassword = function () {\r\n                return datasource.refreshMode === VizPortal.ServerApi.RefreshModeTypes.Server &&\r\n                    dialogScope.editModel.refreshMode === VizPortal.ServerApi.RefreshModeTypes.Remote &&\r\n                    datasource.connectionDetails &&\r\n                    datasource.connectionDetails.hasEmbeddedPassword;\r\n            };\r\n            dialogScope.remoteAgentSelectClicked = function () { return _this.refreshAvailableRemoteAgents(datasource, dialogScope); };\r\n            dialogScope.$watch('editModel.remoteAgentName', function (newRemoteAgent, oldRemoteAgent, scope) {\r\n                if (newRemoteAgent === oldRemoteAgent) {\r\n                    return;\r\n                }\r\n                if (newRemoteAgent === _this.AddNewAgentOption) {\r\n                    dialogScope.editModel.remoteAgentName = oldRemoteAgent;\r\n                    _this.$window.open(_this.HelpService.getServerHelpUrlByCategory('dataconnections7'), VizPortal.LinkTargetAttributes.Blank);\r\n                }\r\n            });\r\n            this.refreshAvailableRemoteAgents(datasource, dialogScope);\r\n            return this.ConfirmActionDialog.open({\r\n                scope: dialogScope,\r\n                title: this.$translate.instant('editRemoteRefreshScheduleDialogTitle'),\r\n                bodyTemplateUrl: 'confirmActionDialogRemoteRefreshProperties.html',\r\n                size: '400px',\r\n                actionName: openCreateRefreshScheduleOnSave ? this.$translate.instant('next') : this.$translate.instant('save'),\r\n                action: angular.noop,\r\n                confirmDisabled: function () {\r\n                    return dialogScope.editModel.refreshMode === VizPortal.ServerApi.RefreshModeTypes.Remote && !dialogScope.editModel.remoteAgentName;\r\n                }\r\n            }).result\r\n                .then(function (result) {\r\n                // if both mode and agent are changing the change agent action will pop success toast with all the necessary information  so don't duplicate the same toast here\r\n                var supressSuccessToast = openCreateRefreshScheduleOnSave ||\r\n                    (datasource.refreshMode === VizPortal.ServerApi.RefreshModeTypes.Server && dialogScope.editModel.refreshMode === VizPortal.ServerApi.RefreshModeTypes.Remote && datasource.remoteAgentName !== dialogScope.editModel.remoteAgentName);\r\n                // There's a race condition in the back-end, send the two requests sequentially.\r\n                return _this.ChangeDatasourceRefreshModeAction.execute(datasource, datasource.refreshMode, dialogScope.editModel.refreshMode, dialogScope.editModel.remoteAgentName, supressSuccessToast, false);\r\n            })\r\n                .then(VizPortal.ResultHelper.rejectResultOnError(this.$q))\r\n                .then(function (result) {\r\n                return _this.ChangeDatasourceRemoteAgentAction.execute(datasource, datasource.remoteAgentName, dialogScope.editModel.remoteAgentName, dialogScope.editModel.refreshMode, openCreateRefreshScheduleOnSave, false);\r\n            })\r\n                .then(VizPortal.ResultHelper.rejectResultOnError(this.$q))\r\n                .then(function (result) {\r\n                if (openCreateRefreshScheduleOnSave) {\r\n                    // if it was requested open the proper create schedule action\r\n                    if (dialogScope.editModel.refreshMode === VizPortal.ServerApi.RefreshModeTypes.Remote) {\r\n                        return _this.CreateRemoteRefreshScheduleAction.execute($event, datasource, VizPortal.RefreshPropertyHelper.getAvailableRefreshTypes(datasource));\r\n                    }\r\n                    else {\r\n                        return _this.CreateExtractTasksAction.forDatasource(datasource, VizPortal.ActionContext.fromEvent($event), VizPortal.CreateExtractTasksMode.AllowSchedule);\r\n                    }\r\n                }\r\n                else {\r\n                    // we're not creating a schedule afterwards\r\n                    return _this.$q.when(result);\r\n                }\r\n            })\r\n                .then(function () {\r\n                if (openCreateRefreshScheduleOnSave) {\r\n                    // defer the refresh property success toast and only show one toast when also showing the create schedule dialog\r\n                    if (dialogScope.editModel.refreshMode === VizPortal.ServerApi.RefreshModeTypes.Remote) {\r\n                        _this.ToasterService.pop({\r\n                            type: VizPortal.ToastType.Info,\r\n                            text: _this.$translate.instant('editRemoteRefreshPropertiesAgentSuccess', { AGENT_NAME: VizPortal.L10n.elideIfLong(dialogScope.editModel.remoteAgentName) })\r\n                        });\r\n                    }\r\n                    else {\r\n                        _this.ToasterService.pop({ type: VizPortal.ToastType.Info, text: _this.$translate.instant('editRemoteRefreshPropertiesServerSuccess') });\r\n                    }\r\n                }\r\n            }) // if chaining anything after this make sure to rejectResultOnError for the remote/server extract refresh actions\r\n                .fin(function () {\r\n                dialogScope.$destroy();\r\n                _this.$state.hardReload();\r\n            });\r\n        };\r\n        ChangeDatasourceRemoteRefreshPropertiesAction.prototype.refreshAvailableRemoteAgents = function (datasource, scope) {\r\n            var _this = this;\r\n            this.RemoteRefreshAgents.get()\r\n                .then(function (result) {\r\n                var remoteAgentNames = _.map(result.agents, function (agent) { return agent.name; });\r\n                if (datasource.remoteAgentName) {\r\n                    remoteAgentNames = _.union(remoteAgentNames, [datasource.remoteAgentName]);\r\n                }\r\n                if (!datasource.remoteAgentName && datasource.refreshMode === VizPortal.ServerApi.RefreshModeTypes.Server) {\r\n                    // automatically try to select the first available agent if the current refresh mode is server\r\n                    // if the current refresh mode is remote and there isn't a remote agent specified the previously specified agent was unlinked\r\n                    if (remoteAgentNames.length > 0) {\r\n                        scope.editModel.remoteAgentName = remoteAgentNames[0];\r\n                    }\r\n                }\r\n                // Add the options representing remote agents\r\n                scope.remoteAgentOptions = _.map(remoteAgentNames, function (name) { return ({\r\n                    display: name,\r\n                    name: name\r\n                }); });\r\n                // Add the last option for adding a new remote agent\r\n                scope.remoteAgentOptions.push({\r\n                    display: _this.$translate.instant('remoteRefreshAgentAddNew'),\r\n                    name: _this.AddNewAgentOption\r\n                });\r\n            });\r\n        };\r\n        ChangeDatasourceRemoteRefreshPropertiesAction.$inject = [\r\n            '$q',\r\n            '$translate',\r\n            '$window',\r\n            '$state',\r\n            'ConfirmActionDialog',\r\n            'ToasterService',\r\n            'HelpService',\r\n            'ServerService',\r\n            'RemoteRefreshAgents',\r\n            'ChangeDatasourceRefreshModeAction',\r\n            'ChangeDatasourceRemoteAgentAction',\r\n            'CreateExtractTasksAction',\r\n            'CreateRemoteRefreshScheduleAction'\r\n        ];\r\n        return ChangeDatasourceRemoteRefreshPropertiesAction;\r\n    })();\r\n    VizPortal.ChangeDatasourceRemoteRefreshPropertiesAction = ChangeDatasourceRemoteRefreshPropertiesAction;\r\n    VizPortal.Module.instance().service('ChangeDatasourceRemoteRefreshPropertiesAction', ChangeDatasourceRemoteRefreshPropertiesAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var CronExpressionDefaultValues = (function () {\r\n        function CronExpressionDefaultValues() {\r\n        }\r\n        CronExpressionDefaultValues.seconds = '0';\r\n        CronExpressionDefaultValues.minutes = '0';\r\n        CronExpressionDefaultValues.hours = '0';\r\n        CronExpressionDefaultValues.dayOfMonth = '?';\r\n        CronExpressionDefaultValues.month = '*';\r\n        CronExpressionDefaultValues.dayOfWeek = '*';\r\n        CronExpressionDefaultValues.year = '';\r\n        CronExpressionDefaultValues.expression = CronExpressionDefaultValues.seconds + ' ' +\r\n            CronExpressionDefaultValues.minutes + ' ' +\r\n            CronExpressionDefaultValues.hours + ' ' +\r\n            CronExpressionDefaultValues.dayOfMonth + ' ' +\r\n            CronExpressionDefaultValues.month + ' ' +\r\n            CronExpressionDefaultValues.dayOfWeek + ' ' +\r\n            CronExpressionDefaultValues.year;\r\n        return CronExpressionDefaultValues;\r\n    })();\r\n    VizPortal.CronExpressionDefaultValues = CronExpressionDefaultValues;\r\n    var CronExpressionFieldValues = (function () {\r\n        function CronExpressionFieldValues(seconds, minutes, hours, dayOfMonth, month, dayOfWeek, year) {\r\n            if (seconds === void 0) { seconds = CronExpressionDefaultValues.seconds; }\r\n            if (minutes === void 0) { minutes = CronExpressionDefaultValues.minutes; }\r\n            if (hours === void 0) { hours = CronExpressionDefaultValues.hours; }\r\n            if (dayOfMonth === void 0) { dayOfMonth = CronExpressionDefaultValues.dayOfMonth; }\r\n            if (month === void 0) { month = CronExpressionDefaultValues.month; }\r\n            if (dayOfWeek === void 0) { dayOfWeek = CronExpressionDefaultValues.dayOfWeek; }\r\n            if (year === void 0) { year = CronExpressionDefaultValues.year; }\r\n            this.seconds = seconds;\r\n            this.minutes = minutes;\r\n            this.hours = hours;\r\n            this.dayOfMonth = dayOfMonth;\r\n            this.month = month;\r\n            this.dayOfWeek = dayOfWeek;\r\n            this.year = year;\r\n        }\r\n        return CronExpressionFieldValues;\r\n    })();\r\n    VizPortal.CronExpressionFieldValues = CronExpressionFieldValues;\r\n    var CronExpressionFieldSubsetTypes = (function () {\r\n        function CronExpressionFieldSubsetTypes() {\r\n        }\r\n        CronExpressionFieldSubsetTypes.All = '1'; // ie '*'\r\n        CronExpressionFieldSubsetTypes.Any = '2'; // ie '?'\r\n        CronExpressionFieldSubsetTypes.Specific = '3'; // ie '3'\r\n        CronExpressionFieldSubsetTypes.SpecificIncrement = '4'; // ie '0/2'\r\n        CronExpressionFieldSubsetTypes.Range = '5'; // ie '1-5'\r\n        CronExpressionFieldSubsetTypes.RangeIncrement = '6'; // ie '1-5/2'\r\n        CronExpressionFieldSubsetTypes.Invalid = '7';\r\n        return CronExpressionFieldSubsetTypes;\r\n    })();\r\n    VizPortal.CronExpressionFieldSubsetTypes = CronExpressionFieldSubsetTypes;\r\n    var RemoteRefreshScheduleEditorViewModel = (function () {\r\n        function RemoteRefreshScheduleEditorViewModel() {\r\n            this.hoursOfDay = _.clone(RemoteRefreshScheduleEditorViewModel.defaultHoursOfDay);\r\n            this.dayOfWeek = _.clone(RemoteRefreshScheduleEditorViewModel.defaultDayOfWeek);\r\n            this.editorModeIsDaily = RemoteRefreshScheduleEditorViewModel.defaultEditorModeIsDaily;\r\n        }\r\n        // Get the cron expression equivalent to the current view model\r\n        RemoteRefreshScheduleEditorViewModel.prototype.getCronExpression = function () {\r\n            var values = new CronExpressionFieldValues();\r\n            values.minutes = this.buildMinutesExpression();\r\n            values.hours = this.buildHoursExpression();\r\n            values.dayOfWeek = this.buildDayOfWeekExpression();\r\n            return CronExpressionHelper.buildFromFields(values);\r\n        };\r\n        // This does NOT validate the expression string, assumes that it is a valid cron expression.\r\n        // This only supports the subset of cron expressions currently implemented by the UI.\r\n        RemoteRefreshScheduleEditorViewModel.prototype.setFromCronExpression = function (expression) {\r\n            var minutesField = CronExpressionHelper.getMinutesField(expression);\r\n            var hoursField = CronExpressionHelper.getHoursField(expression);\r\n            var dayOfWeekField = CronExpressionHelper.getDayOfWeekField(expression);\r\n            var days = [false, false, false, false, false, false, false];\r\n            // minutes and hours of day\r\n            var minutesParts = CronExpressionHelper.getTimeFieldSubsetParts(minutesField);\r\n            var hoursParts = CronExpressionHelper.getTimeFieldSubsetParts(hoursField);\r\n            // Expression can be an incremented range or a specific. Increment is described\r\n            // using hours or minutes.\r\n            if (minutesParts.increment !== undefined || hoursParts.increment !== undefined) {\r\n                this.editorModeIsDaily = false;\r\n                this.hoursOfDay.increment = (minutesParts.increment !== undefined ? minutesParts.increment : 0) +\r\n                    (hoursParts.increment !== undefined ? hoursParts.increment * 60 : 0);\r\n                this.hoursOfDay.from = hoursParts.from * 60;\r\n                this.hoursOfDay.to = hoursParts.to * 60;\r\n            }\r\n            else {\r\n                this.editorModeIsDaily = true;\r\n                this.hoursOfDay.specific = hoursParts.specific * 60;\r\n            }\r\n            // days of week\r\n            _.each(dayOfWeekField.split(','), function (subset) {\r\n                var type = CronExpressionHelper.getTypeFromFieldSubset(subset);\r\n                if (type === CronExpressionFieldSubsetTypes.Range) {\r\n                    var from = CronExpressionHelper.getFromPartFromSubset(subset);\r\n                    var to = CronExpressionHelper.getToPartFromSubset(subset);\r\n                    _.each(_.range(from, to + 1), function (dayNumber) { return days[dayNumber - 1] = true; });\r\n                }\r\n                else if (type === CronExpressionFieldSubsetTypes.Specific) {\r\n                    days[CronExpressionHelper.getSpecificPartFromSubset(subset) - 1] = true;\r\n                }\r\n                else if (type === CronExpressionFieldSubsetTypes.All) {\r\n                    days = [true, true, true, true, true, true, true];\r\n                }\r\n                else {\r\n                    throw '#setFromCronExpression failed when parsing the dayOfWeek field of the expression: {' + expression + '}. #getTypeFromFieldSubset returned: {' + type + '} for subset parameter: {' + subset + '}';\r\n                }\r\n            });\r\n            this.dayOfWeek = {\r\n                sunday: days[0],\r\n                monday: days[1],\r\n                tuesday: days[2],\r\n                wednesday: days[3],\r\n                thursday: days[4],\r\n                friday: days[5],\r\n                saturday: days[6]\r\n            };\r\n        };\r\n        RemoteRefreshScheduleEditorViewModel.prototype.isValid = function () {\r\n            return this.intervalIsValid() && this.dayOfWeekNotEmpty();\r\n        };\r\n        RemoteRefreshScheduleEditorViewModel.isEqual = function (objThis, objThat) {\r\n            return _.isEqual(objThis.hoursOfDay, objThat.hoursOfDay) &&\r\n                _.isEqual(objThis.dayOfWeek, objThat.dayOfWeek) &&\r\n                objThis.editorModeIsDaily === objThat.editorModeIsDaily;\r\n        };\r\n        RemoteRefreshScheduleEditorViewModel.prototype.isEqual = function (that) {\r\n            return RemoteRefreshScheduleEditorViewModel.isEqual(this, that);\r\n        };\r\n        RemoteRefreshScheduleEditorViewModel.clone = function (objThis, objThat) {\r\n            objThis.hoursOfDay = _.clone(objThat.hoursOfDay);\r\n            objThis.dayOfWeek = _.clone(objThat.dayOfWeek);\r\n            objThis.editorModeIsDaily = objThat.editorModeIsDaily;\r\n            return objThis;\r\n        };\r\n        RemoteRefreshScheduleEditorViewModel.prototype.clone = function (that) {\r\n            return RemoteRefreshScheduleEditorViewModel.clone(this, that);\r\n        };\r\n        RemoteRefreshScheduleEditorViewModel.prototype.intervalIsValid = function () {\r\n            return this.editorModeIsDaily || this.hoursOfDay.from < this.hoursOfDay.to;\r\n        };\r\n        RemoteRefreshScheduleEditorViewModel.prototype.dayOfWeekNotEmpty = function () {\r\n            return !_.isEqual(this.dayOfWeek, RemoteRefreshScheduleEditorViewModel.emptyDayOfWeek);\r\n        };\r\n        // Build the minutes cron expression field from the view model\r\n        // Cron expression values for minutes are 0-59\r\n        RemoteRefreshScheduleEditorViewModel.prototype.buildMinutesExpression = function () {\r\n            if (this.editorModeIsDaily) {\r\n                return '0';\r\n            }\r\n            else {\r\n                var minutesIncrement = this.hoursOfDay.increment % 60;\r\n                return '0' + (minutesIncrement > 0 ? '/' + minutesIncrement : '');\r\n            }\r\n        };\r\n        // Build the hours cron expression field from the view model\r\n        // Cron expression values for hours are 0-23\r\n        RemoteRefreshScheduleEditorViewModel.prototype.buildHoursExpression = function () {\r\n            if (this.editorModeIsDaily) {\r\n                return (this.hoursOfDay.specific / 60) + '';\r\n            }\r\n            else {\r\n                // The view model combines cron's minutes & hours into a single increment field described in minutes.\r\n                var minutesIncrement = this.hoursOfDay.increment % 60;\r\n                var hoursIncrement = (this.hoursOfDay.increment >= 60 ? this.hoursOfDay.increment - minutesIncrement : 0) / 60;\r\n                if (hoursIncrement > 0) {\r\n                    return (this.hoursOfDay.from / 60) + '-' + (this.hoursOfDay.to / 60) + '/' + hoursIncrement;\r\n                }\r\n                else {\r\n                    return (this.hoursOfDay.from / 60) + '-' + (this.hoursOfDay.to / 60);\r\n                }\r\n            }\r\n        };\r\n        // Build the day of week cron expression field from the view model\r\n        // Collapse the days of week into the minimum cron expression so that it can be localized and translated into\r\n        // the most succinct statement possible. Cron expression values for day of week are 1-7, Sunday through Saturday.\r\n        RemoteRefreshScheduleEditorViewModel.prototype.buildDayOfWeekExpression = function () {\r\n            var days = [this.dayOfWeek.sunday,\r\n                this.dayOfWeek.monday,\r\n                this.dayOfWeek.tuesday,\r\n                this.dayOfWeek.wednesday,\r\n                this.dayOfWeek.thursday,\r\n                this.dayOfWeek.friday,\r\n                this.dayOfWeek.saturday];\r\n            var expression = '';\r\n            var indexOfStart = days.indexOf(true);\r\n            var indexOfEnd = days.indexOf(false, indexOfStart);\r\n            if (indexOfStart === -1) {\r\n                return '?';\r\n            }\r\n            if (indexOfStart === 0 && indexOfEnd === -1) {\r\n                return '*';\r\n            }\r\n            while (true) {\r\n                indexOfEnd = days.indexOf(false, indexOfStart);\r\n                if (indexOfEnd === -1) {\r\n                    if (indexOfStart === days.length - 1) {\r\n                        expression = expression + (indexOfStart + 1) + '';\r\n                    }\r\n                    else if (indexOfStart === days.length - 2) {\r\n                        expression = expression + (indexOfStart + 1) + ',' + (indexOfStart + 2);\r\n                    }\r\n                    else {\r\n                        expression = expression + (indexOfStart + 1) + '-' + (days.length);\r\n                    }\r\n                    break;\r\n                }\r\n                else {\r\n                    if (indexOfEnd - indexOfStart === 1) {\r\n                        expression = expression + (indexOfStart + 1);\r\n                    }\r\n                    else if (indexOfEnd - indexOfStart === 2) {\r\n                        expression = expression + (indexOfStart + 1) + ',' + indexOfEnd;\r\n                    }\r\n                    else {\r\n                        expression = expression + (indexOfStart + 1) + '-' + indexOfEnd;\r\n                    }\r\n                    indexOfStart = days.indexOf(true, indexOfEnd);\r\n                    if (indexOfStart !== -1) {\r\n                        expression = expression + ',';\r\n                    }\r\n                    else {\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            return expression;\r\n        };\r\n        RemoteRefreshScheduleEditorViewModel.minuteIncrementOptions = [15, 30, 1 * 60, 2 * 60, 4 * 60, 8 * 60, 12 * 60]; // represented as minutes\r\n        RemoteRefreshScheduleEditorViewModel.defaultHoursOfDay = {\r\n            specific: 5 * 60,\r\n            increment: 2 * 60,\r\n            from: 8 * 60,\r\n            to: 17 * 60\r\n        };\r\n        RemoteRefreshScheduleEditorViewModel.defaultDayOfWeek = {\r\n            sunday: false,\r\n            monday: true,\r\n            tuesday: true,\r\n            wednesday: true,\r\n            thursday: true,\r\n            friday: true,\r\n            saturday: false\r\n        };\r\n        RemoteRefreshScheduleEditorViewModel.emptyDayOfWeek = {\r\n            sunday: false,\r\n            monday: false,\r\n            tuesday: false,\r\n            wednesday: false,\r\n            thursday: false,\r\n            friday: false,\r\n            saturday: false\r\n        };\r\n        RemoteRefreshScheduleEditorViewModel.defaultEditorModeIsDaily = true; // default mode is daily at 5am\r\n        return RemoteRefreshScheduleEditorViewModel;\r\n    })();\r\n    VizPortal.RemoteRefreshScheduleEditorViewModel = RemoteRefreshScheduleEditorViewModel;\r\n    var CronExpressionHelper;\r\n    (function (CronExpressionHelper) {\r\n        // Helper methods for cron expressions in the Quartz Scheduler format.\r\n        // Docs: http://www.quartz-scheduler.org/documentation/quartz-1.x/tutorials/crontrigger\r\n        //\r\n        // Expression consists of 7 fields:\r\n        //   _Field_      _Mandatory_   _Values_          _Special_     _Notes_\r\n        //   Seconds      true          0-59              , - * /\r\n        //   Minutes      true          0-59              , - * /\r\n        //   Hours        true          0-23              , - * /\r\n        //   Day of month true          1-31              , - * ? / L W\r\n        //   Month        true          1-12              , - * /       Jan-Dec\r\n        //   Day of week  true          1-7               , - * ? / L # Sun-Sat\r\n        //   Year         false         empty, 1970-2099  , - * /\r\n        //\r\n        // WARN: Non-numeric values are not supported by this implementation (ie 'Jan' or 'Sun')\r\n        // Concatenate discrete fields into a single cron expression string\r\n        function buildFromFields(fields) {\r\n            var expression = fields.seconds + ' ' +\r\n                fields.minutes + ' ' +\r\n                fields.hours + ' ' +\r\n                fields.dayOfMonth + ' ' +\r\n                fields.month + ' ' +\r\n                fields.dayOfWeek;\r\n            // year is optional\r\n            if (fields.year) {\r\n                expression = expression + ' ' + fields.year;\r\n            }\r\n            return expression;\r\n        }\r\n        CronExpressionHelper.buildFromFields = buildFromFields;\r\n        // Parse discrete fields from a cron expression string.\r\n        function buildFromExpression(expression) {\r\n            var fields = new CronExpressionFieldValues();\r\n            var split = expression.split(' ');\r\n            fields.seconds = split[0];\r\n            fields.minutes = split[1];\r\n            fields.hours = split[2];\r\n            fields.dayOfMonth = split[3];\r\n            fields.month = split[4];\r\n            fields.dayOfWeek = split[5];\r\n            if (split.length === 7) {\r\n                fields.year = split[6];\r\n            }\r\n            return fields;\r\n        }\r\n        CronExpressionHelper.buildFromExpression = buildFromExpression;\r\n        // Given a subset of a field that is comma delimited, determine the type. This type informs the parsing applied\r\n        // to the field.\r\n        function getTypeFromFieldSubset(field) {\r\n            if (field === '*')\r\n                return CronExpressionFieldSubsetTypes.All;\r\n            if (field === '?')\r\n                return CronExpressionFieldSubsetTypes.Any;\r\n            // A sinle one or two digit number\r\n            if (field.search('^([0-9]|[0-9][0-9])$') !== -1)\r\n                return CronExpressionFieldSubsetTypes.Specific;\r\n            // A single one or two digit number with a one or two digit increment\r\n            if (field.search('((^)|(^([0-9]|[0-9][0-9])))\\/([0-9]|[0-9][0-9])$') !== -1)\r\n                return CronExpressionFieldSubsetTypes.SpecificIncrement;\r\n            // Two one or two digit numbers separated by a dash, describing the from and to properties of the range.\r\n            if (field.search('^(([0-9]|[0-9][0-9])-([0-9]|[0-9][0-9]))$') !== -1)\r\n                return CronExpressionFieldSubsetTypes.Range;\r\n            // Two one or two digit numbers separated by a dash, describing the from and to properties of the range, with a one or two digit increment.\r\n            if (field.search('^(([0-9]|[0-9][0-9])-([0-9]|[0-9][0-9]))\\/([0-9]|[0-9][0-9])$') !== -1)\r\n                return CronExpressionFieldSubsetTypes.RangeIncrement;\r\n            return CronExpressionFieldSubsetTypes.Invalid;\r\n        }\r\n        CronExpressionHelper.getTypeFromFieldSubset = getTypeFromFieldSubset;\r\n        // Return the \"specific\" part in a field subset.\r\n        // Example: 1/4 returns 1\r\n        // Example: 4 returns 4\r\n        // Example: 0/2 returns 2\r\n        function getSpecificPartFromSubset(subset) {\r\n            // input may or may not have an increment\r\n            var slash = subset.indexOf('/');\r\n            // an increment with no specific value is an implied 0\r\n            if (slash === 0)\r\n                return 0;\r\n            var number = slash === -1 ? subset : subset.substring(0, slash);\r\n            return parseInt(number, 10);\r\n        }\r\n        CronExpressionHelper.getSpecificPartFromSubset = getSpecificPartFromSubset;\r\n        // Return the \"from\" part of a range in a field subset.\r\n        // Example: 1-2 returns 1\r\n        // Example: 4-10/2 returns 4\r\n        function getFromPartFromSubset(subset) {\r\n            var number = subset.substring(0, subset.indexOf('-'));\r\n            return parseInt(number, 10);\r\n        }\r\n        CronExpressionHelper.getFromPartFromSubset = getFromPartFromSubset;\r\n        // Return the \"to\" part of a range in a field subset.\r\n        // Example: 1-2 returns 2\r\n        // Example: 4-10/2 returns 10\r\n        function getToPartFromSubset(subset) {\r\n            // input may or may not have an increment\r\n            var slash = subset.indexOf('/');\r\n            var number = subset.substring(subset.indexOf('-') + 1, slash === -1 ? subset.length : slash);\r\n            return parseInt(number, 10);\r\n        }\r\n        CronExpressionHelper.getToPartFromSubset = getToPartFromSubset;\r\n        // Return the \"increment\" part in a field subset.\r\n        // Example: 2/5 returns 5\r\n        // Example: 4-10/2 returns 2\r\n        function getIncrementPartFromSubset(subset) {\r\n            var number = subset.substring(subset.indexOf('/') + 1);\r\n            return parseInt(number, 10);\r\n        }\r\n        CronExpressionHelper.getIncrementPartFromSubset = getIncrementPartFromSubset;\r\n        // Given a field subset, return a view model equivalent. Subsets are the comma delimited portions of a cron expression field.\r\n        // Example: '8-17/2' returns { increment: 2, from: 8, to: 17 }\r\n        function getTimeFieldSubsetParts(subset) {\r\n            var parts = {};\r\n            var type = CronExpressionHelper.getTypeFromFieldSubset(subset);\r\n            if (type === CronExpressionFieldSubsetTypes.Specific) {\r\n                parts.specific = getSpecificPartFromSubset(subset);\r\n            }\r\n            else if (type === CronExpressionFieldSubsetTypes.SpecificIncrement) {\r\n                parts.specific = getSpecificPartFromSubset(subset);\r\n                parts.increment = getIncrementPartFromSubset(subset);\r\n            }\r\n            else if (type === CronExpressionFieldSubsetTypes.Range) {\r\n                parts.from = getFromPartFromSubset(subset);\r\n                parts.to = getToPartFromSubset(subset);\r\n            }\r\n            else if (type === CronExpressionFieldSubsetTypes.RangeIncrement) {\r\n                parts.from = getFromPartFromSubset(subset);\r\n                parts.to = getToPartFromSubset(subset);\r\n                parts.increment = getIncrementPartFromSubset(subset);\r\n            }\r\n            else {\r\n                throw '#getTimeFieldSubsetParts failed. #getTypeFromFieldSubset returned: {' + type + '} for subset parameter: {' + subset + '}';\r\n            }\r\n            return parts;\r\n        }\r\n        CronExpressionHelper.getTimeFieldSubsetParts = getTimeFieldSubsetParts;\r\n        // Get the seconds field of a cron expression string\r\n        function getSecondsField(expression) {\r\n            return buildFromExpression(expression).seconds;\r\n        }\r\n        CronExpressionHelper.getSecondsField = getSecondsField;\r\n        // Get the minutes field of a cron expression string\r\n        function getMinutesField(expression) {\r\n            return buildFromExpression(expression).minutes;\r\n        }\r\n        CronExpressionHelper.getMinutesField = getMinutesField;\r\n        // Get the hours field of a cron expression string\r\n        function getHoursField(expression) {\r\n            return buildFromExpression(expression).hours;\r\n        }\r\n        CronExpressionHelper.getHoursField = getHoursField;\r\n        // Get the day of month field of a cron expression string\r\n        function getDayOfMonthField(expression) {\r\n            return buildFromExpression(expression).dayOfMonth;\r\n        }\r\n        CronExpressionHelper.getDayOfMonthField = getDayOfMonthField;\r\n        // Get the month field of a cron expression string\r\n        function getMonthField(expression) {\r\n            return buildFromExpression(expression).month;\r\n        }\r\n        CronExpressionHelper.getMonthField = getMonthField;\r\n        // Get the day of week field of a cron expression string\r\n        function getDayOfWeekField(expression) {\r\n            return buildFromExpression(expression).dayOfWeek;\r\n        }\r\n        CronExpressionHelper.getDayOfWeekField = getDayOfWeekField;\r\n        // Get the year field of a cron expression string\r\n        function getYearField(expression) {\r\n            return buildFromExpression(expression).year;\r\n        }\r\n        CronExpressionHelper.getYearField = getYearField;\r\n        // Set the seconds field of a cron expression string\r\n        function setSecondsField(expression, val) {\r\n            var fields = buildFromExpression(expression);\r\n            fields.seconds = val;\r\n            return buildFromFields(fields);\r\n        }\r\n        CronExpressionHelper.setSecondsField = setSecondsField;\r\n        // Set the minutes field of a cron expression string\r\n        function setMinutesField(expression, val) {\r\n            var fields = buildFromExpression(expression);\r\n            fields.minutes = val;\r\n            return buildFromFields(fields);\r\n        }\r\n        CronExpressionHelper.setMinutesField = setMinutesField;\r\n        // Set the hours field of a cron expression string\r\n        function setHoursField(expression, val) {\r\n            var fields = buildFromExpression(expression);\r\n            fields.hours = val;\r\n            return buildFromFields(fields);\r\n        }\r\n        CronExpressionHelper.setHoursField = setHoursField;\r\n        // Set the day of month field of a cron expression string\r\n        function setDayOfMonthField(expression, val) {\r\n            var fields = buildFromExpression(expression);\r\n            fields.dayOfMonth = val;\r\n            return buildFromFields(fields);\r\n        }\r\n        CronExpressionHelper.setDayOfMonthField = setDayOfMonthField;\r\n        // Set the month field of a cron expression string\r\n        function setMonthField(expression, val) {\r\n            var fields = buildFromExpression(expression);\r\n            fields.month = val;\r\n            return buildFromFields(fields);\r\n        }\r\n        CronExpressionHelper.setMonthField = setMonthField;\r\n        // Set the day of week field of a cron expression string\r\n        function setDayOfWeekField(expression, val) {\r\n            var fields = buildFromExpression(expression);\r\n            fields.dayOfWeek = val;\r\n            return buildFromFields(fields);\r\n        }\r\n        CronExpressionHelper.setDayOfWeekField = setDayOfWeekField;\r\n        // Set the year field of a cron expression string\r\n        function setYearField(expression, val) {\r\n            var fields = buildFromExpression(expression);\r\n            fields.year = val;\r\n            return buildFromFields(fields);\r\n        }\r\n        CronExpressionHelper.setYearField = setYearField;\r\n    })(CronExpressionHelper = VizPortal.CronExpressionHelper || (VizPortal.CronExpressionHelper = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../fetchers/IListFetcher.ts\" />\r\n/// <reference path=\"../fetchers/ListResult.ts\" />\r\n/// <reference path=\"../ServerApi/types/IGetItemsParams.ts\" />\r\n/// <reference path=\"../ServerApi/types/IGetItemsResult.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerResourceFetcher = (function () {\r\n        function ServerResourceFetcher(server, requestType, resultMapper) {\r\n            this.server = server;\r\n            this.requestType = requestType;\r\n            this.resultMapper = resultMapper;\r\n        }\r\n        ServerResourceFetcher.prototype.fetchList = function (params) {\r\n            var _this = this;\r\n            return this.server\r\n                .sendRequest(new this.requestType(params))\r\n                .then(function (result) {\r\n                var startIndex = params.page ? params.page.startIndex : 0;\r\n                return new VizPortal.ListResult(_this.resultMapper(result), startIndex, result.totalCount);\r\n            });\r\n        };\r\n        return ServerResourceFetcher;\r\n    })();\r\n    VizPortal.ServerResourceFetcher = ServerResourceFetcher;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/IResponse.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var CreateRemoteRefreshScheduleRequest = (function (_super) {\r\n            __extends(CreateRemoteRefreshScheduleRequest, _super);\r\n            function CreateRemoteRefreshScheduleRequest(params) {\r\n                _super.call(this, 'createRemoteRefreshSchedule', params);\r\n            }\r\n            return CreateRemoteRefreshScheduleRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.CreateRemoteRefreshScheduleRequest = CreateRemoteRefreshScheduleRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/IResponse.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var DeleteRemoteRefreshSchedulesRequest = (function (_super) {\r\n            __extends(DeleteRemoteRefreshSchedulesRequest, _super);\r\n            function DeleteRemoteRefreshSchedulesRequest(params) {\r\n                _super.call(this, 'deleteRemoteRefreshSchedules', params);\r\n            }\r\n            return DeleteRemoteRefreshSchedulesRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.DeleteRemoteRefreshSchedulesRequest = DeleteRemoteRefreshSchedulesRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/IRemoteRefreshSchedule.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        // Remote refreshes can be full or incremental\r\n        ServerApi.RemoteRefreshTypes = {\r\n            Full: 'Full',\r\n            Incremental: 'Incremental'\r\n        };\r\n        // Given a datasource id, get the remote refresh schedules\r\n        var GetRemoteRefreshSchedulesRequest = (function (_super) {\r\n            __extends(GetRemoteRefreshSchedulesRequest, _super);\r\n            function GetRemoteRefreshSchedulesRequest(params) {\r\n                _super.call(this, 'getRemoteRefreshSchedules', params);\r\n            }\r\n            return GetRemoteRefreshSchedulesRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetRemoteRefreshSchedulesRequest = GetRemoteRefreshSchedulesRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/IResponse.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var UpdateRemoteRefreshScheduleRequest = (function (_super) {\r\n            __extends(UpdateRemoteRefreshScheduleRequest, _super);\r\n            function UpdateRemoteRefreshScheduleRequest(params) {\r\n                _super.call(this, 'updateRemoteRefreshSchedule', params);\r\n            }\r\n            return UpdateRemoteRefreshScheduleRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.UpdateRemoteRefreshScheduleRequest = UpdateRemoteRefreshScheduleRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"ServerService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ErrorNotifyingServer = (function () {\r\n        function ErrorNotifyingServer(ServerService, toaster, $translate, $timeout) {\r\n            this.ServerService = ServerService;\r\n            this.toaster = toaster;\r\n            this.$translate = $translate;\r\n            this.$timeout = $timeout;\r\n        }\r\n        ErrorNotifyingServer.prototype.notifyOnFail = function (result) {\r\n            var _this = this;\r\n            result.fail(function (reason) {\r\n                if (reason === VizPortal.ErrorReason.Unknown) {\r\n                    _this.toaster.pop({ type: VizPortal.ToastType.Error, text: _this.$translate.instant('unexpectedError') });\r\n                }\r\n            });\r\n            return result;\r\n        };\r\n        ErrorNotifyingServer.prototype.addDelay = function (result) {\r\n            var _this = this;\r\n            return result.then(function (value) { return _this.$timeout(function () { return value; }, ErrorNotifyingServer.ResponseDelay); });\r\n        };\r\n        ErrorNotifyingServer.prototype.sendRequest = function (request) {\r\n            return this.notifyOnFail(this.ServerService.sendRequest(request));\r\n        };\r\n        ErrorNotifyingServer.prototype.sendRequestAndDelay = function (request) {\r\n            return this.addDelay(this.sendRequest(request));\r\n        };\r\n        ErrorNotifyingServer.prototype.sendRequests = function (requests, combineResults) {\r\n            return this.notifyOnFail(this.ServerService.sendRequests(requests, combineResults));\r\n        };\r\n        ErrorNotifyingServer.prototype.sendRequestsAndDelay = function (requests, combineResults) {\r\n            return this.addDelay(this.sendRequests(requests, combineResults));\r\n        };\r\n        ErrorNotifyingServer.prototype.getServerService = function () {\r\n            return this.ServerService;\r\n        };\r\n        ErrorNotifyingServer.ResponseDelay = 2000;\r\n        ErrorNotifyingServer.$inject = ['ServerService', 'ToasterService', '$translate', '$timeout'];\r\n        return ErrorNotifyingServer;\r\n    })();\r\n    VizPortal.ErrorNotifyingServer = ErrorNotifyingServer;\r\n    VizPortal.Module.instance().service('ErrorNotifyingServer', ErrorNotifyingServer);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../fetchers/ServerResourceFetcher.ts\" />\r\n/// <reference path=\"../helpers/ServerModelHelper.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/CreateRemoteRefreshScheduleRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/DeleteRemoteRefreshSchedulesRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetRemoteRefreshSchedulesRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/UpdateRemoteRefreshScheduleRequest.ts\" />\r\n/// <reference path=\"../services/ErrorNotifyingServer.ts\" />\r\n/// <reference path=\"Resource.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var RemoteRefreshSchedules = (function (_super) {\r\n        __extends(RemoteRefreshSchedules, _super);\r\n        function RemoteRefreshSchedules(ErrorNotifyingServer, FetcherFactory) {\r\n            _super.call(this, FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetRemoteRefreshSchedulesRequest, VizPortal.ServerApiMapper.remoteRefreshSchedules));\r\n            this.ErrorNotifyingServer = ErrorNotifyingServer;\r\n        }\r\n        RemoteRefreshSchedules.prototype.create = function (targetId, item) {\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.CreateRemoteRefreshScheduleRequest({\r\n                targetId: targetId,\r\n                definition: item.definition,\r\n                refreshType: item.refreshType\r\n            }));\r\n        };\r\n        RemoteRefreshSchedules.prototype.update = function (targetId, initialSchedule, finalSchedule) {\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.UpdateRemoteRefreshScheduleRequest({\r\n                targetId: targetId,\r\n                initial: VizPortal.RemoteRefreshScheduleMapper.mapSingleToApi(initialSchedule),\r\n                final: VizPortal.RemoteRefreshScheduleMapper.mapSingleToApi(finalSchedule)\r\n            }));\r\n        };\r\n        RemoteRefreshSchedules.prototype.del = function (targetId, items) {\r\n            var schedules = items.toArray();\r\n            return this.ErrorNotifyingServer.sendRequests(VizPortal.RequestHelper.buildRequests(schedules, function (schedulesBlock) {\r\n                return new VizPortal.ServerApi.DeleteRemoteRefreshSchedulesRequest({\r\n                    targetId: targetId,\r\n                    schedules: VizPortal.RemoteRefreshScheduleMapper.mapToApi(schedulesBlock)\r\n                });\r\n            }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        RemoteRefreshSchedules.$inject = ['ErrorNotifyingServer', 'FetcherFactory'];\r\n        return RemoteRefreshSchedules;\r\n    })(VizPortal.Resource);\r\n    VizPortal.RemoteRefreshSchedules = RemoteRefreshSchedules;\r\n    VizPortal.Module.instance().service('RemoteRefreshSchedules', RemoteRefreshSchedules);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/CronExpressionHelper.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\n/// <reference path=\"../resources/RemoteRefreshSchedules.ts\" />\r\n/// <reference path=\"ContentActionNotification.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var CreateRemoteRefreshScheduleAction = (function () {\r\n        function CreateRemoteRefreshScheduleAction($translate, $filter, ConfirmActionDialog, ContentActionNotification, RemoteRefreshSchedules) {\r\n            this.$translate = $translate;\r\n            this.$filter = $filter;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.ContentActionNotification = ContentActionNotification;\r\n            this.RemoteRefreshSchedules = RemoteRefreshSchedules;\r\n        }\r\n        CreateRemoteRefreshScheduleAction.prototype.execute = function ($event, item, availableTypes) {\r\n            var _this = this;\r\n            var context = VizPortal.ActionContext.fromEvent($event);\r\n            this.scope = context.scope.$new();\r\n            this.scope.availableTypeOptions = availableTypes;\r\n            this.scope.minuteIncrementOptions = VizPortal.RemoteRefreshScheduleEditorViewModel.minuteIncrementOptions;\r\n            this.scope.prompt = this.$translate.instant('createRemoteRefreshScheduleCustomDialogPrompt', { ITEM_NAME: VizPortal.L10n.elideIfLong(item.name) });\r\n            this.scope.startOnMonday = VizPortal.L10n.firstDayOfWeekIsMonday();\r\n            this.scope.editorViewModel = new VizPortal.RemoteRefreshScheduleEditorViewModel();\r\n            this.scope.scheduleInfo = {\r\n                definition: this.scope.editorViewModel.getCronExpression(),\r\n                refreshType: VizPortal.ServerApi.RemoteRefreshTypes.Full,\r\n                runNextAt: null\r\n            };\r\n            var dialogInstance = this.ConfirmActionDialog.open({\r\n                title: this.$translate.instant('createRemoteRefreshScheduleDialogTitle'),\r\n                bodyTemplateUrl: 'confirmActionDialogRemoteRefreshSchedule.html',\r\n                size: '500px',\r\n                scope: this.scope,\r\n                position: _.extend(VizPortal.ModalService.anchoredTo(context.targetElement), { reserveHeight: 600 }),\r\n                actionName: this.$translate.instant('createRemoteRefreshScheduleDialogSubmit'),\r\n                action: function () {\r\n                    _this.scope.scheduleInfo.definition = _this.scope.editorViewModel.getCronExpression();\r\n                    return _this.RemoteRefreshSchedules.create(item.id, _this.scope.scheduleInfo);\r\n                },\r\n                confirmDisabled: function () { return !_this.scope.editorViewModel.isValid(); }\r\n            });\r\n            return dialogInstance.result\r\n                .then(function (result) {\r\n                if (result.errors && result.errors.length) {\r\n                    var errorMessage = _this.errorMessageFor(result.errors[0]);\r\n                    dialogInstance.showErrorMessage(errorMessage);\r\n                }\r\n                else {\r\n                    _this.ContentActionNotification.notifySuccess(_this.$translate.instant('createRemoteRefreshScheduleSuccess', { REFRESH_TYPE_NAME: _this.$filter('remoteRefreshScheduleTypeName')(_this.scope.scheduleInfo.refreshType) }));\r\n                }\r\n                return result;\r\n            })\r\n                .fin(function () { return _this.scope.$destroy(); });\r\n        };\r\n        CreateRemoteRefreshScheduleAction.prototype.errorMessageFor = function (error) {\r\n            return this.$translate.instant('errorUnknown');\r\n        };\r\n        CreateRemoteRefreshScheduleAction.$inject = [\r\n            '$translate',\r\n            '$filter',\r\n            'ConfirmActionDialog',\r\n            'ContentActionNotification',\r\n            'RemoteRefreshSchedules'\r\n        ];\r\n        return CreateRemoteRefreshScheduleAction;\r\n    })();\r\n    VizPortal.CreateRemoteRefreshScheduleAction = CreateRemoteRefreshScheduleAction;\r\n    VizPortal.Module.instance().service('CreateRemoteRefreshScheduleAction', CreateRemoteRefreshScheduleAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DeleteRemoteRefreshSchedulesAction = (function () {\r\n        function DeleteRemoteRefreshSchedulesAction($translate, ConfirmActionDialog, ContentActionNotification, RemoteRefreshSchedules) {\r\n            this.$translate = $translate;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.ContentActionNotification = ContentActionNotification;\r\n            this.RemoteRefreshSchedules = RemoteRefreshSchedules;\r\n        }\r\n        DeleteRemoteRefreshSchedulesAction.prototype.execute = function (context, item, selected) {\r\n            var _this = this;\r\n            return this.ConfirmActionDialog.open({\r\n                scope: context.scope,\r\n                title: this.$translate.instant('delete'),\r\n                bodyText: this.$translate.instant('confirmDeleteRemoteRefreshSchedules', { COUNT: selected.size() }, VizPortal.L10n.Interpolations.Count),\r\n                actionName: this.$translate.instant('confirmDeleteButton', { ITEM_COUNT: selected.size() }, VizPortal.L10n.Interpolations.Count),\r\n                isDeleteAction: true,\r\n                action: function (dialogInstance) {\r\n                    return _this.RemoteRefreshSchedules.del(item.id, selected)\r\n                        .then(function (result) {\r\n                        if (result.errors && result.errors.length) {\r\n                            var errorMessage = _this.errorMessageFor(result.errors[0]);\r\n                            dialogInstance.showErrorMessage(errorMessage);\r\n                        }\r\n                        else {\r\n                            _this.ContentActionNotification.notifySuccess(_this.$translate.instant('deleteRemoteRefreshScheduleSuccess', { ITEM_COUNT: selected.size() }, VizPortal.L10n.Interpolations.Count));\r\n                        }\r\n                        return result;\r\n                    });\r\n                }\r\n            }).result;\r\n        };\r\n        DeleteRemoteRefreshSchedulesAction.prototype.errorMessageFor = function (error) {\r\n            return this.$translate.instant('errorUnknown');\r\n        };\r\n        DeleteRemoteRefreshSchedulesAction.$inject = [\r\n            '$translate',\r\n            'ConfirmActionDialog',\r\n            'ContentActionNotification',\r\n            'RemoteRefreshSchedules'\r\n        ];\r\n        return DeleteRemoteRefreshSchedulesAction;\r\n    })();\r\n    VizPortal.DeleteRemoteRefreshSchedulesAction = DeleteRemoteRefreshSchedulesAction;\r\n    VizPortal.Module.instance().service('DeleteRemoteRefreshSchedulesAction', DeleteRemoteRefreshSchedulesAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\n/// <reference path=\"../resources/RemoteRefreshSchedules.ts\" />\r\n/// <reference path=\"CreateRemoteRefreshScheduleAction.ts\" />\r\n/// <reference path=\"ContentActionNotification.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var EditRemoteRefreshScheduleAction = (function () {\r\n        function EditRemoteRefreshScheduleAction($translate, $filter, ConfirmActionDialog, ContentActionNotification, RemoteRefreshSchedules) {\r\n            this.$translate = $translate;\r\n            this.$filter = $filter;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.ContentActionNotification = ContentActionNotification;\r\n            this.RemoteRefreshSchedules = RemoteRefreshSchedules;\r\n        }\r\n        EditRemoteRefreshScheduleAction.prototype.execute = function (context, item, schedule, availableTypes) {\r\n            var _this = this;\r\n            this.scope = context.scope.$new();\r\n            this.scope.availableTypeOptions = availableTypes;\r\n            this.scope.minuteIncrementOptions = VizPortal.RemoteRefreshScheduleEditorViewModel.minuteIncrementOptions;\r\n            this.scope.prompt = this.$translate.instant('editRemoteRefreshScheduleCustomDialogPrompt', { DATASOURCE_NAME: VizPortal.L10n.elideIfLong(item.name) });\r\n            this.scope.startOnMonday = VizPortal.L10n.firstDayOfWeekIsMonday();\r\n            this.scope.editorViewModel = new VizPortal.RemoteRefreshScheduleEditorViewModel();\r\n            this.scope.editorViewModel.setFromCronExpression(schedule.definition);\r\n            this.scope.scheduleInfo = _.clone(schedule);\r\n            var initialViewModel = new VizPortal.RemoteRefreshScheduleEditorViewModel().clone(this.scope.editorViewModel);\r\n            var dialogInstance = this.ConfirmActionDialog.open({\r\n                title: this.$translate.instant('editRemoteRefreshScheduleDialogTitle'),\r\n                bodyTemplateUrl: 'confirmActionDialogRemoteRefreshSchedule.html',\r\n                size: '500px',\r\n                scope: this.scope,\r\n                position: _.extend(VizPortal.ModalService.anchoredTo(context.targetElement), { reserveHeight: 600 }),\r\n                actionName: this.$translate.instant('editRemoteRefreshSchedule'),\r\n                action: function () {\r\n                    _this.scope.scheduleInfo.definition = _this.scope.editorViewModel.getCronExpression();\r\n                    return _this.RemoteRefreshSchedules.update(item.id, schedule, _this.scope.scheduleInfo);\r\n                },\r\n                confirmDisabled: function () {\r\n                    return !_this.scope.editorViewModel.isValid() ||\r\n                        (_this.scope.editorViewModel.isEqual(initialViewModel) && _this.scope.scheduleInfo.refreshType === schedule.refreshType);\r\n                }\r\n            });\r\n            return dialogInstance.result\r\n                .then(function (result) {\r\n                if (result.errors && result.errors.length) {\r\n                    var errorMessage = _this.errorMessageFor(result.errors[0]);\r\n                    dialogInstance.showErrorMessage(errorMessage);\r\n                }\r\n                else {\r\n                    _this.ContentActionNotification.notifySuccess(_this.$translate.instant('editRemoteRefreshScheduleSuccess', { REFRESH_TYPE_NAME: _this.$filter('remoteRefreshScheduleTypeName')(_this.scope.scheduleInfo.refreshType) }));\r\n                }\r\n                return result;\r\n            })\r\n                .fin(function () { return _this.scope.$destroy(); });\r\n        };\r\n        EditRemoteRefreshScheduleAction.prototype.errorMessageFor = function (error) {\r\n            return this.$translate.instant('errorUnknown');\r\n        };\r\n        EditRemoteRefreshScheduleAction.$inject = [\r\n            '$translate',\r\n            '$filter',\r\n            'ConfirmActionDialog',\r\n            'ContentActionNotification',\r\n            'RemoteRefreshSchedules'\r\n        ];\r\n        return EditRemoteRefreshScheduleAction;\r\n    })();\r\n    VizPortal.EditRemoteRefreshScheduleAction = EditRemoteRefreshScheduleAction;\r\n    VizPortal.Module.instance().service('EditRemoteRefreshScheduleAction', EditRemoteRefreshScheduleAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var QueryService = (function () {\r\n        function QueryService($location) {\r\n            this.$location = $location;\r\n        }\r\n        QueryService.prototype.createQueryUpdaterFromSubplace = function ($scope, subplace, refreshFn) {\r\n            return new QueryUpdater(this.$location, $scope, subplace.type, subplace.resource, refreshFn, subplace.defaultFilters, subplace.filterKeys());\r\n        };\r\n        QueryService.prototype.createQueryUpdater = function ($scope, type, resource, refreshFn, defaultFilters) {\r\n            return new QueryUpdater(this.$location, $scope, type, resource, refreshFn, defaultFilters);\r\n        };\r\n        QueryService.$inject = ['$location'];\r\n        return QueryService;\r\n    })();\r\n    VizPortal.QueryService = QueryService;\r\n    var QueryUpdater = (function () {\r\n        function QueryUpdater($location, $scope, type, resource, refreshFn, defaultFilters, filterKeys) {\r\n            var _this = this;\r\n            if (filterKeys === void 0) { filterKeys = type.filterKeys; }\r\n            this.$location = $location;\r\n            this.$scope = $scope;\r\n            this.type = type;\r\n            this.resource = resource;\r\n            this.refreshFn = refreshFn;\r\n            this.defaultFilters = defaultFilters;\r\n            this.filterKeys = filterKeys;\r\n            // store last order and filters so we know if we will need to update the resource query\r\n            this.order = null;\r\n            this.filters = null;\r\n            $scope.$on('$locationChangeSuccess', function (event, newLoc, oldLoc) {\r\n                // Only trigger a refresh if we're at the same location\r\n                // i.e. only the query string has changed\r\n                newLoc = newLoc.split('?')[0];\r\n                oldLoc = oldLoc.split('?')[0];\r\n                if (newLoc === oldLoc) {\r\n                    _this.refreshIfOrderOrFilterChanged();\r\n                }\r\n            });\r\n        }\r\n        // public methods\r\n        QueryUpdater.prototype.refresh = function () {\r\n            var orderAndFilters = this.getCurrentOrderAndFilters();\r\n            var order = orderAndFilters.order;\r\n            var filters = orderAndFilters.filters;\r\n            var extraQueryParams = this.type.extraQueryParams;\r\n            this.rememberOrderAndFilter(order, filters);\r\n            var resourceQuery = this.createResourceQuery(order, filters, extraQueryParams);\r\n            this.refreshFn(resourceQuery);\r\n        };\r\n        // private methods\r\n        QueryUpdater.prototype.refreshIfOrderOrFilterChanged = function () {\r\n            var orderAndFilters = this.getCurrentOrderAndFilters();\r\n            var order = orderAndFilters.order;\r\n            var filters = orderAndFilters.filters;\r\n            var extraQueryParams = this.type.extraQueryParams;\r\n            if (this.didOrderOrFilterChanged(order, filters)) {\r\n                this.rememberOrderAndFilter(order, filters);\r\n                var resourceQuery = this.createResourceQuery(order, filters, extraQueryParams);\r\n                this.refreshFn(resourceQuery);\r\n            }\r\n        };\r\n        QueryUpdater.prototype.didOrderOrFilterChanged = function (newOrder, newFilters) {\r\n            return (!_.isEqual(newOrder, this.order) || !_.isEqual(newFilters, this.filters));\r\n        };\r\n        QueryUpdater.prototype.rememberOrderAndFilter = function (order, filters) {\r\n            this.order = order;\r\n            this.filters = filters;\r\n        };\r\n        QueryUpdater.prototype.createResourceQuery = function (order, filters, extraParams) {\r\n            return this.resource.all().withFilters(filters).withOrder(order).withExtraParams(extraParams);\r\n        };\r\n        QueryUpdater.prototype.getCurrentOrderAndFilters = function () {\r\n            var urlParams = this.$location.search();\r\n            return {\r\n                order: VizPortal.Order.fromInput(urlParams.order, this.type.orderKeys) || this.type.defaultOrder,\r\n                filters: this.getFilterClauses(urlParams, this.filterKeys, this.defaultFilters)\r\n            };\r\n        };\r\n        QueryUpdater.prototype.getFilterClauses = function (urlParams, filterKeys, defaultFilters) {\r\n            return VizPortal.ServerFilterClauses.create(_.defaults(_(urlParams).pick(filterKeys), defaultFilters || {}));\r\n        };\r\n        return QueryUpdater;\r\n    })();\r\n    VizPortal.Module.instance().service('QueryService', QueryService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/Set.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SelectionService = (function () {\r\n        function SelectionService() {\r\n        }\r\n        SelectionService.prototype.rowClicked = function (selectedItems, row, colIndex) {\r\n            var isCheckbox = colIndex === 0;\r\n            if (isCheckbox) {\r\n                selectedItems.toggle(row);\r\n            }\r\n            else {\r\n                selectedItems.clear();\r\n                selectedItems.add(row);\r\n            }\r\n        };\r\n        return SelectionService;\r\n    })();\r\n    VizPortal.SelectionService = SelectionService;\r\n    VizPortal.Module.instance().service('SelectionService', SelectionService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../../app/content/RemoteRefreshScheduleGrid.ts\" />\r\n/// <reference path=\"../../common/react/components/dataGrid/AngularToReactDataGridBridge.ts\" />\r\n/// <reference path=\"../helpers/ActionButtonsHelper.ts\" />\r\n/// <reference path=\"../helpers/LocalSorter.ts\" />\r\n/// <reference path=\"../helpers/RefreshPropertyHelper.ts\" />\r\n/// <reference path=\"../helpers/SubplaceCountsHelper.ts\" />\r\n/// <reference path=\"../models/ContentTypes.ts\" />\r\n/// <reference path=\"../models/IEmptyTemplate.ts\" />\r\n/// <reference path=\"../models/ITemplate.ts\" />\r\n/// <reference path=\"../models/IPlace.ts\" />\r\n/// <reference path=\"../services/BrowserTitleService.ts\" />\r\n/// <reference path=\"../services/ChangeDatasourceRemoteRefreshPropertiesAction.ts\" />\r\n/// <reference path=\"../services/CreateRemoteRefreshScheduleAction.ts\" />\r\n/// <reference path=\"../services/DeleteRemoteRefreshSchedulesAction.ts\" />\r\n/// <reference path=\"../services/EditRemoteRefreshScheduleAction.ts\" />\r\n/// <reference path=\"../services/HelpService.ts\" />\r\n/// <reference path=\"../services/QueryService.ts\" />\r\n/// <reference path=\"../services/SelectionService.ts\" />\r\n/// <reference path=\"../services/SorterFactory.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var RemoteRefreshSchedulesCtrl = (function () {\r\n        function RemoteRefreshSchedulesCtrl($q, $translate, AngularToReactDataGridBridge, $scope, $state, $filter, BrowserTitleService, subplace, serverService, queryService, selectionService, HelpService, sorterFactory, datasource, CreateRemoteRefreshScheduleAction, DeleteRemoteRefreshSchedulesAction, EditRemoteRefreshScheduleAction, ChangeDatasourceRemoteRefreshPropertiesAction) {\r\n            var _this = this;\r\n            this.$q = $q;\r\n            this.$translate = $translate;\r\n            this.AngularToReactDataGridBridge = AngularToReactDataGridBridge;\r\n            this.$scope = $scope;\r\n            this.$filter = $filter;\r\n            this.serverService = serverService;\r\n            this.HelpService = HelpService;\r\n            this.datasource = datasource;\r\n            this.DeleteRemoteRefreshSchedulesAction = DeleteRemoteRefreshSchedulesAction;\r\n            this.EditRemoteRefreshScheduleAction = EditRemoteRefreshScheduleAction;\r\n            $scope.selectedItems = new VizPortal.Set(RemoteRefreshSchedulesCtrl.keyForSchedule);\r\n            var actions = this.createActions($scope.selectedItems);\r\n            if (VizPortal.FeatureFlags.reactRemoteSchedulesGrid) {\r\n                this.configureForReactDataGrid(actions);\r\n            }\r\n            BrowserTitleService.setTitle('refreshSchedule', $scope.objectName);\r\n            // If a deep link was used to this sub-place after the refresh mode was changed, redirect to the correct one.\r\n            this.redirectByExtractsAndRefreshMode($state, datasource);\r\n            $scope.$on(VizPortal.SubplaceEvents.Refresh, function () {\r\n                _this.refreshRemoteRefreshSchedules();\r\n            });\r\n            $scope.datasource = datasource;\r\n            $scope.anyActionsAllowed = function () { return _this.anyActionsAllowed(); };\r\n            $scope.refreshPropertiesAreEditable = function () { return $scope.anyActionsAllowed() && VizPortal.RefreshPropertyHelper.canBeRefreshedRemotely(datasource); };\r\n            $scope.currentRefreshLocation = function () { return VizPortal.RefreshPropertyHelper.getCurrentRefreshLocation($translate, $scope.datasource); };\r\n            $scope.sorter = sorterFactory.create(VizPortal.RemoteRefreshScheduleContentType.defaultOrder);\r\n            $scope.availableAction = function (action) { return action.isAvailable($scope.selectedItems); };\r\n            VizPortal.ActionButtonsHelper.setupActionButtons($scope, actions);\r\n            $scope.listActions = [{\r\n                    name: 'new-remote-refresh-schedule',\r\n                    translate: 'newExtractRefresh',\r\n                    isAvailable: function () { return $scope.anyActionsAllowed(); },\r\n                    execute: function ($event) { return CreateRemoteRefreshScheduleAction.execute($event, datasource, VizPortal.RefreshPropertyHelper.getAvailableRefreshTypes($scope.datasource))\r\n                        .then(function () { return _this.refreshRemoteRefreshSchedules(); }); }\r\n                }];\r\n            $scope.availableListAction = function (listAction) { return listAction.isAvailable(); };\r\n            $scope.headerClicked = function (header) { return $scope.sorter.setPrimary(header.attrs['key'], header.attrs['direction']); };\r\n            $scope.rowClicked = function (row, colIndex) {\r\n                if ($scope.anyActionsAllowed()) {\r\n                    selectionService.rowClicked($scope.selectedItems, row, colIndex);\r\n                }\r\n            };\r\n            this.waitForCountOfSchedules = $q.defer();\r\n            $scope.changeRemoteRefreshProperties = function ($event) {\r\n                _this.waitForCountOfSchedules.promise.then(function (countOfSchedules) {\r\n                    ChangeDatasourceRemoteRefreshPropertiesAction.execute($event, $scope.datasource, false, countOfSchedules);\r\n                });\r\n            };\r\n            $scope.sliceChanged = function (newSlice) {\r\n                _this.waitForCountOfSchedules.resolve(newSlice.total);\r\n                $scope.selectedItems.updateItems(newSlice.items);\r\n                VizPortal.SubplaceCountsHelper.updateCountsFromSubplace($scope, subplace, newSlice.total);\r\n            };\r\n            $scope.emptyTemplateModel = this.emptyTemplateModel();\r\n            this.query = queryService.createQueryUpdaterFromSubplace($scope, subplace, function (resourceQuery) {\r\n                $scope.sliceable = new LocallySortingScheduleInfoSliceable(resourceQuery, $filter);\r\n                if (VizPortal.FeatureFlags.reactRemoteSchedulesGrid) {\r\n                    _this.AngularToReactDataGridBridge.updateReactDataGridRowStore({\r\n                        scope: $scope,\r\n                        sliceable: $scope.sliceable,\r\n                        keyForItem: RemoteRefreshSchedulesCtrl.keyForSchedule\r\n                    });\r\n                }\r\n            });\r\n            this.refreshRemoteRefreshSchedules();\r\n        }\r\n        RemoteRefreshSchedulesCtrl.keyForSchedule = function (remoteRefreshSchedule) {\r\n            return remoteRefreshSchedule.definition + '_' + remoteRefreshSchedule.refreshType;\r\n        };\r\n        RemoteRefreshSchedulesCtrl.prototype.anyActionsAllowed = function () {\r\n            return this.serverService.isSessionSiteOrServerAdmin() || this.datasource.owner.id === this.serverService.sessionUserId();\r\n        };\r\n        RemoteRefreshSchedulesCtrl.prototype.emptyTemplateModel = function () {\r\n            return {\r\n                title: 'extractTasksEmptyMessage',\r\n                body: [{\r\n                        statements: [\r\n                            {\r\n                                localizedStatementKey: 'remoteRefreshSchedulesEmptyParagraph1'\r\n                            }\r\n                        ]\r\n                    }],\r\n                help: {\r\n                    links: [{\r\n                            localizedValueKey: 'remoteRefreshSchedulesEmptyHelp',\r\n                            url: this.HelpService.getDatasourceHelpUrl()\r\n                        }]\r\n                }\r\n            };\r\n        };\r\n        RemoteRefreshSchedulesCtrl.prototype.configureForReactDataGrid = function (actions) {\r\n            var _this = this;\r\n            this.$scope.useReactDataGrid = true;\r\n            var columns = VizPortalReact.RemoteRefreshScheduleGrid.columns(function (id) { return _this.$translate.instant(id); }, this.$scope, this.anyActionsAllowed(), actions, this.$filter('remoteRefreshScheduleTypeName'), this.$filter('cronExpression'));\r\n            this.AngularToReactDataGridBridge.attachReactDataGridToScope(this.$scope, columns, this.emptyTemplateModel());\r\n        };\r\n        RemoteRefreshSchedulesCtrl.prototype.redirectByExtractsAndRefreshMode = function ($state, datasource) {\r\n            // Prevent deep links for live data sources\r\n            if (!datasource.hasExtracts) {\r\n                $state.go('^.connectedWorkbooks'); // Go to default sibling state\r\n            }\r\n            // Prevent deep links to the incorrect refresh schedules page\r\n            VizPortal.RefreshPropertyHelper.redirectByDatasourceRefreshMode($state, datasource.refreshMode);\r\n        };\r\n        RemoteRefreshSchedulesCtrl.prototype.createActions = function (selectedItems) {\r\n            var _this = this;\r\n            return [\r\n                {\r\n                    name: 'delete',\r\n                    translate: 'delete_action',\r\n                    isAvailable: function (items) { return !items.isEmpty() && _this.$scope.anyActionsAllowed(); },\r\n                    execute: function (items, context) {\r\n                        _this.DeleteRemoteRefreshSchedulesAction.execute(context, _this.datasource, _this.$scope.selectedItems)\r\n                            .then(function (result) {\r\n                            // Is this the right NotFound error code for RemoteRefreshSchedules?\r\n                            VizPortal.ActionHelpers.deselectAllExceptErrors(_this.$scope.selectedItems, result, VizPortal.SchedulingErrorCode.SchedulingTaskNotFound);\r\n                            _this.refreshRemoteRefreshSchedules();\r\n                        });\r\n                    }\r\n                }, {\r\n                    name: 'edit',\r\n                    translate: 'editRemoteRefreshSchedule_action',\r\n                    isAvailable: function (items) { return items.size() === 1 && _this.$scope.anyActionsAllowed(); },\r\n                    execute: function (items, context) {\r\n                        _this.EditRemoteRefreshScheduleAction.execute(context, _this.datasource, items.first(), VizPortal.RefreshPropertyHelper.getAvailableRefreshTypes(_this.datasource)).then(function (result) {\r\n                            // Is this the right NotFound error code for RemoteRefreshSchedules?\r\n                            VizPortal.ActionHelpers.deselectNotFound(_this.$scope.selectedItems, result, VizPortal.SchedulingErrorCode.SchedulingTaskNotFound);\r\n                            _this.refreshRemoteRefreshSchedules();\r\n                        });\r\n                    }\r\n                }\r\n            ];\r\n        };\r\n        RemoteRefreshSchedulesCtrl.prototype.refreshRemoteRefreshSchedules = function () {\r\n            this.waitForCountOfSchedules = this.$q.defer();\r\n            this.query.refresh();\r\n        };\r\n        RemoteRefreshSchedulesCtrl.$inject = [\r\n            '$q',\r\n            '$translate',\r\n            'AngularToReactDataGridBridge',\r\n            '$scope',\r\n            '$state',\r\n            '$filter',\r\n            'BrowserTitleService',\r\n            'subplace',\r\n            'ServerService',\r\n            'QueryService',\r\n            'SelectionService',\r\n            'HelpService',\r\n            'SorterFactory',\r\n            'datasource',\r\n            'CreateRemoteRefreshScheduleAction',\r\n            'DeleteRemoteRefreshSchedulesAction',\r\n            'EditRemoteRefreshScheduleAction',\r\n            'ChangeDatasourceRemoteRefreshPropertiesAction'\r\n        ];\r\n        return RemoteRefreshSchedulesCtrl;\r\n    })();\r\n    VizPortal.RemoteRefreshSchedulesCtrl = RemoteRefreshSchedulesCtrl;\r\n    // Injects client-side sorting into getSlice for the wrapped ResourceQuery instance\r\n    // (Note that sorting a slice would be incorrect for other datasources that support paging)\r\n    var LocallySortingScheduleInfoSliceable = (function () {\r\n        function LocallySortingScheduleInfoSliceable(wrappedQuery, $filter) {\r\n            this.wrappedQuery = wrappedQuery;\r\n            this.localSorter = new VizPortal.LocalSorter();\r\n            // Sort by the localized version of these fields rather than the raw values:\r\n            this.localSorter.addTransformForValueComparison('refreshType', $filter('remoteRefreshScheduleTypeName'));\r\n            this.localSorter.addTransformForValueComparison('definition', $filter('cronExpression'));\r\n        }\r\n        LocallySortingScheduleInfoSliceable.prototype.getSlice = function (start, size) {\r\n            var _this = this;\r\n            return this.wrappedQuery.getSlice(start, size).then(function (listResult) {\r\n                return new VizPortal.ListResult(_this.localSorter.sortByClauses(listResult.items, _this.wrappedQuery.getOrder()));\r\n            });\r\n        };\r\n        return LocallySortingScheduleInfoSliceable;\r\n    })();\r\n    VizPortal.Module.instance().controller('RemoteRefreshSchedulesCtrl', RemoteRefreshSchedulesCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"CreateOrEditScheduleCtrl.ts\" />\r\n/// <reference path=\"../ServerApi/types/ISchedule.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var CreateOrEditScheduleViewModelMapper;\r\n    (function (CreateOrEditScheduleViewModelMapper) {\r\n        function defaultSchedule() {\r\n            return _.extend({\r\n                name: '',\r\n                scheduledAction: VizPortal.ServerApi.ScheduleActions.Extract,\r\n                priority: 50,\r\n                parallel: true\r\n            }, this.defaultScheduleFrequency());\r\n        }\r\n        CreateOrEditScheduleViewModelMapper.defaultSchedule = defaultSchedule;\r\n        function defaultScheduleFrequency() {\r\n            return {\r\n                scheduleType: VizPortal.ServerApi.ScheduleTypes.Hourly,\r\n                hourly: {\r\n                    startTime: 0,\r\n                    endTime: 0,\r\n                    recurrenceMinutes: 60\r\n                },\r\n                daily: {\r\n                    startTime: 0\r\n                },\r\n                weekly: {\r\n                    startTime: 0,\r\n                    recurrenceDaysOfWeek: []\r\n                },\r\n                monthly: {\r\n                    startTime: 0,\r\n                    recurrenceDayOfMonth: VizPortal.ServerApi.ScheduleLastDayOfMonth\r\n                }\r\n            };\r\n        }\r\n        CreateOrEditScheduleViewModelMapper.defaultScheduleFrequency = defaultScheduleFrequency;\r\n        function viewModelFromSchedule(schedule) {\r\n            var viewModel = this.defaultSchedule();\r\n            viewModel.id = schedule.id;\r\n            viewModel.name = schedule.name;\r\n            viewModel.scheduleType = schedule.scheduleType;\r\n            viewModel.scheduledAction = schedule.scheduledAction;\r\n            viewModel.priority = schedule.priority;\r\n            viewModel.parallel = schedule.parallel;\r\n            return _.extend(viewModel, this.viewModelFromScheduleFrequency({ scheduleType: schedule.scheduleType, scheduleDetails: schedule.scheduleDetails }));\r\n        }\r\n        CreateOrEditScheduleViewModelMapper.viewModelFromSchedule = viewModelFromSchedule;\r\n        function viewModelFromScheduleFrequency(schedule) {\r\n            var viewModel = this.defaultScheduleFrequency();\r\n            viewModel.scheduleType = schedule.scheduleType;\r\n            switch (schedule.scheduleType) {\r\n                case VizPortal.ServerApi.ScheduleTypes.Hourly:\r\n                    viewModel.hourly = _.clone(schedule.scheduleDetails);\r\n                    break;\r\n                case VizPortal.ServerApi.ScheduleTypes.Daily:\r\n                    viewModel.daily = _.clone(schedule.scheduleDetails);\r\n                    break;\r\n                case VizPortal.ServerApi.ScheduleTypes.Weekly:\r\n                    viewModel.weekly = {\r\n                        startTime: schedule.scheduleDetails.startTime,\r\n                        recurrenceDaysOfWeek: _.clone(schedule.scheduleDetails.recurrenceDaysOfWeek)\r\n                    };\r\n                    break;\r\n                case VizPortal.ServerApi.ScheduleTypes.Monthly:\r\n                    viewModel.monthly = _.clone(schedule.scheduleDetails);\r\n                    break;\r\n            }\r\n            return viewModel;\r\n        }\r\n        CreateOrEditScheduleViewModelMapper.viewModelFromScheduleFrequency = viewModelFromScheduleFrequency;\r\n        function createScheduleParamsFromViewModel(viewModel) {\r\n            return {\r\n                name: viewModel.name,\r\n                priority: viewModel.priority,\r\n                scheduleType: viewModel.scheduleType,\r\n                parallel: viewModel.parallel,\r\n                scheduledAction: viewModel.scheduledAction,\r\n                scheduleDetails: scheduleDetailsFromViewModel(viewModel)\r\n            };\r\n        }\r\n        CreateOrEditScheduleViewModelMapper.createScheduleParamsFromViewModel = createScheduleParamsFromViewModel;\r\n        function updateScheduleParamsFromViewModel(viewModel) {\r\n            return {\r\n                id: viewModel.id,\r\n                name: viewModel.name,\r\n                priority: viewModel.priority,\r\n                scheduleType: viewModel.scheduleType,\r\n                parallel: viewModel.parallel,\r\n                scheduleDetails: scheduleDetailsFromViewModel(viewModel)\r\n            };\r\n        }\r\n        CreateOrEditScheduleViewModelMapper.updateScheduleParamsFromViewModel = updateScheduleParamsFromViewModel;\r\n        function scheduleFrequencyFromViewModel(viewModel) {\r\n            return {\r\n                scheduleType: viewModel.scheduleType,\r\n                scheduleDetails: scheduleDetailsFromViewModel(viewModel)\r\n            };\r\n        }\r\n        CreateOrEditScheduleViewModelMapper.scheduleFrequencyFromViewModel = scheduleFrequencyFromViewModel;\r\n        function scheduleDetailsFromViewModel(viewModel) {\r\n            switch (viewModel.scheduleType) {\r\n                case VizPortal.ServerApi.ScheduleTypes.Daily:\r\n                    return viewModel.daily;\r\n                case VizPortal.ServerApi.ScheduleTypes.Hourly:\r\n                    return viewModel.hourly;\r\n                case VizPortal.ServerApi.ScheduleTypes.Weekly:\r\n                    return viewModel.weekly;\r\n                case VizPortal.ServerApi.ScheduleTypes.Monthly:\r\n                    return viewModel.monthly;\r\n            }\r\n            throw \"Unknown scheduleType: \" + viewModel.scheduleType;\r\n        }\r\n    })(CreateOrEditScheduleViewModelMapper = VizPortal.CreateOrEditScheduleViewModelMapper || (VizPortal.CreateOrEditScheduleViewModelMapper = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"CreateOrEditScheduleViewModelMapper.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/types/ISchedule.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var CreateOrEditScheduleCtrl = (function () {\r\n        function CreateOrEditScheduleCtrl($scope, $translate) {\r\n            this.$translate = $translate;\r\n            $scope.scheduleActions = _.values(VizPortal.ServerApi.ScheduleActions);\r\n            $scope.hourlyFrequencies = this.hourlyFrequencies();\r\n            $scope.daysOfMonth = this.daysOfMonth();\r\n        }\r\n        CreateOrEditScheduleCtrl.prototype.hourlyFrequencies = function () {\r\n            var _this = this;\r\n            var hourlyFrequencies = [];\r\n            _.each([15, 30], function (minutes) {\r\n                hourlyFrequencies.push({\r\n                    label: _this.$translate.instant('minutes', { MINUTES: minutes }),\r\n                    value: minutes\r\n                });\r\n            });\r\n            _.each([1, 2, 4, 6, 8, 12], function (hours) {\r\n                hourlyFrequencies.push({\r\n                    label: _this.$translate.instant('hours', { HOURS: hours }),\r\n                    value: hours * 60\r\n                });\r\n            });\r\n            return hourlyFrequencies;\r\n        };\r\n        CreateOrEditScheduleCtrl.prototype.daysOfMonth = function () {\r\n            var _this = this;\r\n            var daysOfMonth = [];\r\n            _.each(_.range(1, 32), function (day) {\r\n                daysOfMonth.push({\r\n                    label: _this.$translate.instant('dayOfMonth', { DAY: day }),\r\n                    value: '' + day\r\n                });\r\n            });\r\n            daysOfMonth.push({ label: this.$translate.instant(\"last\"), value: VizPortal.ServerApi.ScheduleLastDayOfMonth });\r\n            return daysOfMonth;\r\n        };\r\n        CreateOrEditScheduleCtrl.$inject = [\r\n            '$scope',\r\n            '$translate'\r\n        ];\r\n        return CreateOrEditScheduleCtrl;\r\n    })();\r\n    VizPortal.CreateOrEditScheduleCtrl = CreateOrEditScheduleCtrl;\r\n    VizPortal.Module.instance().controller('CreateOrEditScheduleCtrl', CreateOrEditScheduleCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/ISchedule.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var UpdateScheduleRequest = (function (_super) {\r\n            __extends(UpdateScheduleRequest, _super);\r\n            function UpdateScheduleRequest(params) {\r\n                _super.call(this, 'updateSchedule', params);\r\n            }\r\n            return UpdateScheduleRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.UpdateScheduleRequest = UpdateScheduleRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../controllers/CreateOrEditScheduleCtrl.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\n/// <reference path=\"../ServerApi/requests/CreateScheduleRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/UpdateScheduleRequest.ts\" />\r\n/// <reference path=\"ContentActionNotification.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ScheduleDialogMode;\r\n    (function (ScheduleDialogMode) {\r\n        ScheduleDialogMode[ScheduleDialogMode[\"Create\"] = 0] = \"Create\";\r\n        ScheduleDialogMode[ScheduleDialogMode[\"Edit\"] = 1] = \"Edit\";\r\n    })(ScheduleDialogMode || (ScheduleDialogMode = {}));\r\n    // TODO: rename to CreateOrUpdateScheduleAction\r\n    var CreateScheduleAction = (function () {\r\n        function CreateScheduleAction(ConfirmActionDialog, $translate, ContentActionNotification, Schedules, ScheduleErrors) {\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.$translate = $translate;\r\n            this.ContentActionNotification = ContentActionNotification;\r\n            this.Schedules = Schedules;\r\n            this.ScheduleErrors = ScheduleErrors;\r\n        }\r\n        CreateScheduleAction.prototype.createSchedule = function (context) {\r\n            return this.showDialog(ScheduleDialogMode.Create, VizPortal.CreateOrEditScheduleViewModelMapper.defaultSchedule(), context);\r\n        };\r\n        CreateScheduleAction.prototype.editSchedule = function (schedule, context) {\r\n            return this.showDialog(ScheduleDialogMode.Edit, VizPortal.CreateOrEditScheduleViewModelMapper.viewModelFromSchedule(schedule), context);\r\n        };\r\n        CreateScheduleAction.prototype.showDialog = function (mode, scheduleViewModel, context) {\r\n            var _this = this;\r\n            var dialogScope = context.scope.$new();\r\n            dialogScope.scheduleViewModel = scheduleViewModel;\r\n            var title;\r\n            var actionName;\r\n            var action;\r\n            if (mode === ScheduleDialogMode.Create) {\r\n                title = this.$translate.instant('createScheduleDialogTitle');\r\n                actionName = this.$translate.instant('createScheduleDialog_create');\r\n                action = function (dialogInstance) {\r\n                    return _this.submitScheduleCreate(dialogScope.scheduleViewModel, dialogInstance);\r\n                };\r\n            }\r\n            else {\r\n                title = this.$translate.instant('editScheduleDialogTitle');\r\n                actionName = this.$translate.instant('createScheduleDialog_save');\r\n                var originalName = scheduleViewModel.name;\r\n                action = function (dialogInstance) {\r\n                    return _this.submitScheduleUpdate(dialogScope.scheduleViewModel, originalName, dialogInstance);\r\n                };\r\n            }\r\n            return this.ConfirmActionDialog.open({\r\n                scope: dialogScope,\r\n                title: title,\r\n                bodyTemplateUrl: \"createScheduleDialog.html\",\r\n                actionName: actionName,\r\n                action: action,\r\n                size: VizPortal.ModalSize.fitToContent\r\n            }).result.fin(function () { return dialogScope.$destroy(); });\r\n        };\r\n        CreateScheduleAction.prototype.submitScheduleCreate = function (scheduleViewModel, dialogInstance) {\r\n            var _this = this;\r\n            var params = VizPortal.CreateOrEditScheduleViewModelMapper.createScheduleParamsFromViewModel(scheduleViewModel);\r\n            return this.Schedules.create(params).then(function (result) {\r\n                if (result.errors && result.errors.length) {\r\n                    var errorMessage = _this.ScheduleErrors.errorMessageFor(result.errors[0]);\r\n                    dialogInstance.showErrorMessage(errorMessage);\r\n                }\r\n                else {\r\n                    _this.ContentActionNotification.notifySuccess(_this.$translate.instant('createScheduleSuccess', { SCHEDULE_NAME: VizPortal.L10n.elideIfLong(params.name) }));\r\n                }\r\n                return result;\r\n            });\r\n        };\r\n        CreateScheduleAction.prototype.submitScheduleUpdate = function (scheduleViewModel, originalScheduleName, dialogInstance) {\r\n            var _this = this;\r\n            var params = VizPortal.CreateOrEditScheduleViewModelMapper.updateScheduleParamsFromViewModel(scheduleViewModel);\r\n            return this.Schedules.update(params).then(function (result) {\r\n                if (result.errors && result.errors.length) {\r\n                    var errorMessage = _this.ScheduleErrors.errorMessageFor(result.errors[0], originalScheduleName);\r\n                    if (dialogInstance) {\r\n                        dialogInstance.showErrorMessage(errorMessage);\r\n                    }\r\n                    else {\r\n                        _this.ContentActionNotification.notifyFailure(errorMessage);\r\n                    }\r\n                }\r\n                else {\r\n                    _this.ContentActionNotification.notifySuccess(_this.$translate.instant('updateScheduleSuccess', { SCHEDULE_NAME: VizPortal.L10n.elideIfLong(params.name) }));\r\n                }\r\n                return result;\r\n            });\r\n        };\r\n        CreateScheduleAction.$inject = ['ConfirmActionDialog', '$translate', 'ContentActionNotification', 'Schedules', 'ScheduleErrors'];\r\n        return CreateScheduleAction;\r\n    })();\r\n    VizPortal.CreateScheduleAction = CreateScheduleAction;\r\n    VizPortal.Module.instance().service('CreateScheduleAction', CreateScheduleAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DeleteSchedulesAction = (function () {\r\n        function DeleteSchedulesAction(ScheduleErrors, ActionHelpers, ConfirmActionDialog, $translate, Schedules) {\r\n            this.ScheduleErrors = ScheduleErrors;\r\n            this.ActionHelpers = ActionHelpers;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.$translate = $translate;\r\n            this.Schedules = Schedules;\r\n        }\r\n        DeleteSchedulesAction.prototype.deleteSchedules = function (schedules, context) {\r\n            var _this = this;\r\n            var scheduleCount = schedules.size();\r\n            var extractTaskCount = this.countExtractTasks(schedules);\r\n            var subscriptionScheduleCount = this.countSubscriptionSchedules(schedules);\r\n            var bodyText;\r\n            if (scheduleCount === 1) {\r\n                if (subscriptionScheduleCount > 0) {\r\n                    bodyText = this.$translate.instant('confirmDeleteSubscriptionSchedule', {\r\n                        SCHEDULE_NAME: VizPortal.L10n.elideIfLong(schedules.first().name)\r\n                    });\r\n                }\r\n                else {\r\n                    bodyText = this.$translate.instant('confirmDeleteExtractRefreshSchedule', {\r\n                        SCHEDULE_NAME: VizPortal.L10n.elideIfLong(schedules.first().name),\r\n                        EXTRACT_COUNT: extractTaskCount\r\n                    }, VizPortal.L10n.Interpolations.Count);\r\n                }\r\n            }\r\n            else {\r\n                bodyText = this.$translate.instant('confirmDeleteSchedules', {\r\n                    SCHEDULE_COUNT: scheduleCount,\r\n                    EXTRACT_COUNT: extractTaskCount,\r\n                    SUBSCRIPTION_COUNT: subscriptionScheduleCount\r\n                }, VizPortal.L10n.Interpolations.Count);\r\n            }\r\n            return this.ConfirmActionDialog.open({\r\n                scope: context.scope,\r\n                title: this.$translate.instant('delete'),\r\n                bodyText: bodyText,\r\n                actionName: this.$translate.instant('confirmDeleteButton', {\r\n                    ITEM_COUNT: schedules.size()\r\n                }, VizPortal.L10n.Interpolations.Count),\r\n                isDeleteAction: true,\r\n                action: function (dialogInstance) {\r\n                    return _this.Schedules.del(schedules.keys()).then(function (result) { return _this.notifyResult(schedules, result); });\r\n                }\r\n            }).result;\r\n        };\r\n        DeleteSchedulesAction.prototype.notifyResult = function (schedules, result) {\r\n            var _this = this;\r\n            this.ActionHelpers.notifyStandardError(schedules, {\r\n                successId: 'deleteSchedulesSuccess',\r\n                errorId: 'deleteSchedulesError'\r\n            }, function (errorItem) { return _this.ScheduleErrors.errorDetailsFor(errorItem); })(result);\r\n        };\r\n        // returns the number of extract tasks in the given set of schedules\r\n        DeleteSchedulesAction.prototype.countExtractTasks = function (schedules) {\r\n            return _.reduce(schedules.toArray(), function (sum, s) { return sum + (s.scheduledAction === VizPortal.ServerApi.ScheduleActions.Extract ? s.taskCount : 0); }, 0);\r\n        };\r\n        // returns the number of subscription schedules in the given set of schedules\r\n        DeleteSchedulesAction.prototype.countSubscriptionSchedules = function (schedules) {\r\n            return _.reduce(schedules.toArray(), function (sum, s) { return sum + (s.scheduledAction === VizPortal.ServerApi.ScheduleActions.Subscription ? 1 : 0); }, 0);\r\n        };\r\n        DeleteSchedulesAction.$inject = ['ScheduleErrors', 'ActionHelpers', 'ConfirmActionDialog', '$translate', 'Schedules'];\r\n        return DeleteSchedulesAction;\r\n    })();\r\n    VizPortal.DeleteSchedulesAction = DeleteSchedulesAction;\r\n    VizPortal.Module.instance().service('DeleteSchedulesAction', DeleteSchedulesAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\n/// <reference path=\"ContentActionNotification.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var RenameScheduleAction = (function () {\r\n        function RenameScheduleAction(toaster, ConfirmActionDialog, $translate, Schedules, ScheduleErrors) {\r\n            this.toaster = toaster;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.$translate = $translate;\r\n            this.Schedules = Schedules;\r\n            this.ScheduleErrors = ScheduleErrors;\r\n        }\r\n        RenameScheduleAction.prototype.confirmRename = function (schedule, context) {\r\n            var _this = this;\r\n            var scope = context.scope.$new();\r\n            scope.description = this.$translate.instant('confirmRenameSchedule', {\r\n                SCHEDULE_NAME: VizPortal.L10n.elideIfLong(schedule.name)\r\n            });\r\n            scope.input = {\r\n                text: schedule.name,\r\n                maxLength: 255\r\n            };\r\n            return this.ConfirmActionDialog.open({\r\n                title: this.$translate.instant('rename'),\r\n                bodyTemplateUrl: 'confirmActionDialogInput.html',\r\n                scope: scope,\r\n                actionName: this.$translate.instant('rename'),\r\n                action: function (dialogInstance) {\r\n                    return _this.Schedules.rename(schedule.id, scope.input.text)\r\n                        .then(function (result) { return _this.handleResult(schedule, scope.input.text, result, dialogInstance); });\r\n                }\r\n            }).result.fin(function () { return scope.$destroy(); });\r\n        };\r\n        RenameScheduleAction.prototype.renameInPlace = function (schedule, newName) {\r\n            var _this = this;\r\n            return this.Schedules.rename(schedule.id, newName)\r\n                .then(function (result) { return _this.handleResult(schedule, newName, result); });\r\n        };\r\n        RenameScheduleAction.prototype.handleResult = function (schedule, newName, result, dialogInstance) {\r\n            if (result.errors && result.errors.length) {\r\n                var errorMessage = this.ScheduleErrors.errorMessageFor(result.errors[0], schedule.name);\r\n                if (dialogInstance) {\r\n                    dialogInstance.showErrorMessage(errorMessage);\r\n                }\r\n                else {\r\n                    this.toaster.pop({ type: VizPortal.ToastType.Error, text: errorMessage });\r\n                }\r\n            }\r\n            else {\r\n                var successMsg = this.$translate.instant('updateScheduleNameSuccess', {\r\n                    ITEM_NAME: VizPortal.L10n.elideIfLong(schedule.name),\r\n                    NEW_ITEM_NAME: VizPortal.L10n.elideIfLong(newName)\r\n                });\r\n                this.toaster.pop({ type: VizPortal.ToastType.Info, text: successMsg });\r\n                schedule.name = newName;\r\n            }\r\n            return result;\r\n        };\r\n        RenameScheduleAction.$inject = ['ToasterService', 'ConfirmActionDialog', '$translate', 'Schedules', 'ScheduleErrors'];\r\n        return RenameScheduleAction;\r\n    })();\r\n    VizPortal.RenameScheduleAction = RenameScheduleAction;\r\n    VizPortal.Module.instance().service('RenameScheduleAction', RenameScheduleAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"AbstractContentAction.ts\" />\r\n/// <reference path=\"../resources/Schedules.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var RunSchedulesAction = (function (_super) {\r\n        __extends(RunSchedulesAction, _super);\r\n        function RunSchedulesAction(ConfirmActionDialog, ContentActionNotification, $translate, Schedules) {\r\n            _super.call(this, ConfirmActionDialog, ContentActionNotification);\r\n            this.$translate = $translate;\r\n            this.Schedules = Schedules;\r\n        }\r\n        RunSchedulesAction.prototype.configureDialog = function (dialogConfig, schedules) {\r\n            var _this = this;\r\n            dialogConfig.bodyText = this.$translate.instant('schedulesRunPrompt', {\r\n                ITEM_COUNT: schedules.size(),\r\n                ITEM_NAME: VizPortal.L10n.elideIfLong(schedules.first().name)\r\n            }, VizPortal.L10n.Interpolations.Count);\r\n            dialogConfig.title = this.$translate.instant('runNow');\r\n            dialogConfig.actionName = this.$translate.instant('runNowConfirmButton');\r\n            dialogConfig.action = function () { return _this.Schedules.run(schedules.keys()); };\r\n        };\r\n        RunSchedulesAction.prototype.notificationTranslationIds = function () {\r\n            return {\r\n                successId: 'schedulesRunSuccess',\r\n                errorId: 'schedulesRunError'\r\n            };\r\n        };\r\n        RunSchedulesAction.$inject = ['ConfirmActionDialog', 'ContentActionNotification', '$translate', 'Schedules'];\r\n        return RunSchedulesAction;\r\n    })(VizPortal.AbstractContentAction);\r\n    VizPortal.RunSchedulesAction = RunSchedulesAction;\r\n    VizPortal.Module.instance().service('RunSchedulesAction', RunSchedulesAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"AbstractContentAction.ts\" />\r\n/// <reference path=\"../resources/Schedules.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var RunServerSchedulesAction = (function (_super) {\r\n        __extends(RunServerSchedulesAction, _super);\r\n        function RunServerSchedulesAction(ConfirmActionDialog, ContentActionNotification, $translate, Schedules) {\r\n            _super.call(this, ConfirmActionDialog, ContentActionNotification);\r\n            this.$translate = $translate;\r\n            this.Schedules = Schedules;\r\n        }\r\n        RunServerSchedulesAction.prototype.configureDialog = function (dialogConfig, schedules) {\r\n            var _this = this;\r\n            dialogConfig.bodyText = this.$translate.instant('schedulesRunPrompt', {\r\n                ITEM_COUNT: schedules.size(),\r\n                ITEM_NAME: VizPortal.L10n.elideIfLong(schedules.first().name)\r\n            }, VizPortal.L10n.Interpolations.Count);\r\n            dialogConfig.title = this.$translate.instant('runNow');\r\n            dialogConfig.actionName = this.$translate.instant('runNowConfirmButton', {\r\n                ITEM_COUNT: schedules.size()\r\n            }, VizPortal.L10n.Interpolations.Count);\r\n            dialogConfig.action = function () { return _this.Schedules.runServer(schedules.keys()); };\r\n        };\r\n        RunServerSchedulesAction.prototype.notificationTranslationIds = function () {\r\n            return {\r\n                successId: 'schedulesRunSuccess',\r\n                errorId: 'schedulesRunError'\r\n            };\r\n        };\r\n        RunServerSchedulesAction.$inject = ['ConfirmActionDialog', 'ContentActionNotification', '$translate', 'Schedules'];\r\n        return RunServerSchedulesAction;\r\n    })(VizPortal.AbstractContentAction);\r\n    VizPortal.RunServerSchedulesAction = RunServerSchedulesAction;\r\n    VizPortal.Module.instance().service('RunServerSchedulesAction', RunServerSchedulesAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    /*\r\n     * Determines which schedule-related actions a user has permission to perform.\r\n     */\r\n    var SchedulePermissions = (function () {\r\n        function SchedulePermissions(ServerService) {\r\n            this.ServerService = ServerService;\r\n        }\r\n        // This covers edit, rename, delete, enable/disable\r\n        SchedulePermissions.prototype.canEditSchedule = function () {\r\n            return this.ServerService.isSessionServerAdmin();\r\n        };\r\n        SchedulePermissions.prototype.canRunSchedule = function () {\r\n            return this.ServerService.isSessionSiteOrServerAdmin();\r\n        };\r\n        SchedulePermissions.$inject = ['ServerService'];\r\n        return SchedulePermissions;\r\n    })();\r\n    VizPortal.SchedulePermissions = SchedulePermissions;\r\n    VizPortal.Module.instance().service('SchedulePermissions', SchedulePermissions);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ScheduleErrors = (function () {\r\n        function ScheduleErrors(ServerService, SchedulesConfig, $translate) {\r\n            this.ServerService = ServerService;\r\n            this.SchedulesConfig = SchedulesConfig;\r\n            this.$translate = $translate;\r\n        }\r\n        ScheduleErrors.prototype.errorDetailsFor = function (scheduleErrorItem) {\r\n            return {\r\n                itemName: scheduleErrorItem.item.name,\r\n                itemUrl: scheduleErrorItem.error.code === VizPortal.SchedulingErrorCode.SchedulingScheduleNotFound\r\n                    ? null\r\n                    : this.scheduleUrl(scheduleErrorItem.item),\r\n                errorMessage: this.errorMessageForItem(scheduleErrorItem)\r\n            };\r\n        };\r\n        ScheduleErrors.prototype.scheduleUrl = function (schedule) {\r\n            return this.ServerService.sessionSiteId()\r\n                ? this.SchedulesConfig.siteUrlFor(schedule)\r\n                : this.SchedulesConfig.serverUrlFor(schedule);\r\n        };\r\n        ScheduleErrors.prototype.errorMessageForItem = function (errorItem) {\r\n            return this.errorMessageFor(errorItem.error, errorItem.item.name);\r\n        };\r\n        ScheduleErrors.prototype.errorMessageFor = function (error, scheduleName) {\r\n            if (scheduleName === void 0) { scheduleName = ''; }\r\n            switch (error.code) {\r\n                case VizPortal.SchedulingErrorCode.SchedulingScheduleNotFound:\r\n                    return this.$translate.instant('errorScheduleNotFound', { SCHEDULE_NAME: VizPortal.L10n.elideIfLong(scheduleName) });\r\n                case VizPortal.SchedulingErrorCode.SchedulingNameAlreadyExists:\r\n                    return this.$translate.instant('errorScheduleNameAlreadyExists');\r\n                case VizPortal.SchedulingErrorCode.SchedulingNameTooLong:\r\n                    return this.$translate.instant('errorScheduleNameTooLong');\r\n                default:\r\n                    return this.$translate.instant('errorUnknown');\r\n            }\r\n        };\r\n        ScheduleErrors.$inject = ['ServerService', 'SchedulesConfig', '$translate'];\r\n        return ScheduleErrors;\r\n    })();\r\n    VizPortal.ScheduleErrors = ScheduleErrors;\r\n    VizPortal.Module.instance().service('ScheduleErrors', ScheduleErrors);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"ScheduleErrors.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SetScheduleStatusAction = (function () {\r\n        function SetScheduleStatusAction(ScheduleErrors, ActionHelpers, ConfirmActionDialog, $translate, Schedules) {\r\n            this.ScheduleErrors = ScheduleErrors;\r\n            this.ActionHelpers = ActionHelpers;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.$translate = $translate;\r\n            this.Schedules = Schedules;\r\n        }\r\n        SetScheduleStatusAction.prototype.enableSchedule = function (schedule) {\r\n            return this.enableSchedules(this.singleton(schedule));\r\n        };\r\n        SetScheduleStatusAction.prototype.disableSchedule = function (schedule) {\r\n            return this.disableSchedules(this.singleton(schedule));\r\n        };\r\n        SetScheduleStatusAction.prototype.singleton = function (schedule) {\r\n            return VizPortal.Set.singleton(schedule, function (s) { return s.id; });\r\n        };\r\n        SetScheduleStatusAction.prototype.confirmEnableSchedules = function (schedules, context) {\r\n            var _this = this;\r\n            return this.confirmAction(schedules, context, function () { return _this.enableSchedules(schedules); }, SetScheduleStatusAction.EnableTranslationIds);\r\n        };\r\n        SetScheduleStatusAction.prototype.confirmDisableSchedules = function (schedules, context) {\r\n            var _this = this;\r\n            return this.confirmAction(schedules, context, function () { return _this.disableSchedules(schedules); }, SetScheduleStatusAction.DisableTranslationIds);\r\n        };\r\n        SetScheduleStatusAction.prototype.confirmAction = function (schedules, context, action, translationIds) {\r\n            return this.ConfirmActionDialog.open({\r\n                scope: context.scope,\r\n                title: this.$translate.instant(translationIds.title),\r\n                bodyText: this.$translate.instant(translationIds.body, {\r\n                    ITEM_COUNT: schedules.size(),\r\n                    NAME: VizPortal.L10n.elideIfLong(schedules.first().name)\r\n                }, VizPortal.L10n.Interpolations.Count),\r\n                actionName: this.$translate.instant(translationIds.actionName, {\r\n                    ITEM_COUNT: schedules.size()\r\n                }, VizPortal.L10n.Interpolations.Count),\r\n                action: action\r\n            }).result;\r\n        };\r\n        SetScheduleStatusAction.prototype.enableSchedules = function (schedules) {\r\n            var _this = this;\r\n            return this.Schedules.enable(schedules.keys())\r\n                .then(function (result) {\r\n                return _this.notifyResult(schedules, result, SetScheduleStatusAction.EnableTranslationIds);\r\n            });\r\n        };\r\n        SetScheduleStatusAction.prototype.disableSchedules = function (schedules) {\r\n            var _this = this;\r\n            return this.Schedules.disable(schedules.keys())\r\n                .then(function (result) {\r\n                return _this.notifyResult(schedules, result, SetScheduleStatusAction.DisableTranslationIds);\r\n            });\r\n        };\r\n        SetScheduleStatusAction.prototype.notifyResult = function (schedules, result, translationIds) {\r\n            var _this = this;\r\n            this.ActionHelpers.notifyStandardError(schedules, translationIds, function (errorItem) { return _this.ScheduleErrors.errorDetailsFor(errorItem); })(result);\r\n        };\r\n        SetScheduleStatusAction.$inject = ['ScheduleErrors', 'ActionHelpers', 'ConfirmActionDialog', '$translate', 'Schedules'];\r\n        SetScheduleStatusAction.EnableTranslationIds = {\r\n            successId: 'enableSchedulesSuccess',\r\n            errorId: 'enableSchedulesError',\r\n            title: 'enableSchedulesDialogTitle',\r\n            body: 'enableSchedulesDialogPrompt',\r\n            actionName: 'enableSchedulesDialogSubmit'\r\n        };\r\n        SetScheduleStatusAction.DisableTranslationIds = {\r\n            successId: 'disableSchedulesSuccess',\r\n            errorId: 'disableSchedulesError',\r\n            title: 'disableSchedulesDialogTitle',\r\n            body: 'disableSchedulesDialogPrompt',\r\n            actionName: 'disableSchedulesDialogSubmit'\r\n        };\r\n        return SetScheduleStatusAction;\r\n    })();\r\n    VizPortal.SetScheduleStatusAction = SetScheduleStatusAction;\r\n    VizPortal.Module.instance().service('SetScheduleStatusAction', SetScheduleStatusAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../../app/IMainScope.ts\" />\r\n/// <reference path=\"../controllers/CreateOrEditScheduleCtrl.ts\" />\r\n/// <reference path=\"../controllers/CreateOrEditScheduleViewModelMapper.ts\" />\r\n/// <reference path=\"../helpers/ActionContext.ts\" />\r\n/// <reference path=\"../helpers/SubplaceCountsHelper.ts\" />\r\n/// <reference path=\"../resources/Schedules.ts\" />\r\n/// <reference path=\"../services/CreateScheduleAction.ts\" />\r\n/// <reference path=\"../services/DeleteSchedulesAction.ts\" />\r\n/// <reference path=\"../services/RenameScheduleAction.ts\" />\r\n/// <reference path=\"../services/RunSchedulesAction.ts\" />\r\n/// <reference path=\"../services/RunServerSchedulesAction.ts\" />\r\n/// <reference path=\"../services/SchedulePermissions.ts\" />\r\n/// <reference path=\"../services/SetScheduleStatusAction.ts\" />\r\n/// <reference path=\"../services/SorterFactory.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ScheduleCtrl = (function () {\r\n        function ScheduleCtrl($scope, $state, schedule, place, SchedulePermissions, CreateScheduleAction, DeleteSchedulesAction, SetScheduleStatusAction, RunServerSchedulesAction, RunSchedulesAction, RenameScheduleAction, siteId) {\r\n            var _this = this;\r\n            this.SchedulePermissions = SchedulePermissions;\r\n            this.CreateScheduleAction = CreateScheduleAction;\r\n            this.DeleteSchedulesAction = DeleteSchedulesAction;\r\n            this.SetScheduleStatusAction = SetScheduleStatusAction;\r\n            this.RunServerSchedulesAction = RunServerSchedulesAction;\r\n            this.RunSchedulesAction = RunSchedulesAction;\r\n            this.RenameScheduleAction = RenameScheduleAction;\r\n            $scope.objectName = schedule.name;\r\n            VizPortal.SubplaceTabsHelper.refreshWhenCurrentTabClicked($scope, $state);\r\n            VizPortal.SubplaceCountsHelper.keepSubplaceCountsUpdated($scope, place);\r\n            $scope.schedule = schedule;\r\n            // Permissions\r\n            $scope.canRunNow = function () { return SchedulePermissions.canRunSchedule(); };\r\n            $scope.canEditSchedule = function () { return SchedulePermissions.canEditSchedule(); };\r\n            $scope.isSubscription = schedule.scheduledAction === VizPortal.ServerApi.ScheduleActions.Subscription;\r\n            $scope.rename = function ($event) {\r\n                RenameScheduleAction.confirmRename(schedule, VizPortal.ActionContext.fromEvent($event))\r\n                    .then(function () { return $state.hardReload(); });\r\n            };\r\n            // Edit schedule\r\n            $scope.beginEdit = function () {\r\n                $scope.scheduleViewModel = VizPortal.CreateOrEditScheduleViewModelMapper.viewModelFromSchedule(schedule);\r\n                $scope.editMode = true;\r\n            };\r\n            $scope.cancelEdit = function () { return $scope.editMode = false; };\r\n            $scope.save = function ($event) {\r\n                $scope.busy = true;\r\n                _this.CreateScheduleAction.submitScheduleUpdate($scope.scheduleViewModel, $scope.schedule.name)\r\n                    .then(function () {\r\n                    $scope.editMode = false;\r\n                    $state.hardReload();\r\n                })\r\n                    .fin(function () { return $scope.busy = false; });\r\n            };\r\n            $scope.scheduleStatus = {\r\n                enabled: !!schedule.runNextAt\r\n            };\r\n            $scope.$watch('scheduleStatus.enabled', function (newVal, oldVal) {\r\n                if (newVal !== oldVal) {\r\n                    var action = newVal\r\n                        ? _this.SetScheduleStatusAction.enableSchedule(schedule)\r\n                        : _this.SetScheduleStatusAction.disableSchedule(schedule);\r\n                    action.then(function () { return $state.hardReload(); });\r\n                }\r\n            });\r\n            var scheduleSet = VizPortal.Set.singleton(schedule, function (s) { return s.id; });\r\n            $scope.del = function ($event) {\r\n                _this.DeleteSchedulesAction.deleteSchedules(scheduleSet, VizPortal.ActionContext.fromEvent($event))\r\n                    .then(function () { return $state.go('^.^.schedules'); });\r\n            };\r\n            $scope.runNow = function ($event) {\r\n                if (!siteId) {\r\n                    _this.RunServerSchedulesAction.execute(scheduleSet, VizPortal.ActionContext.fromEvent($event))\r\n                        .then(function () { return $state.hardReload(); });\r\n                }\r\n                else {\r\n                    _this.RunSchedulesAction.execute(scheduleSet, VizPortal.ActionContext.fromEvent($event))\r\n                        .then(function () { return $state.hardReload(); });\r\n                }\r\n            };\r\n        }\r\n        ScheduleCtrl.$inject = [\r\n            '$scope',\r\n            '$state',\r\n            'schedule',\r\n            'place',\r\n            'SchedulePermissions',\r\n            'CreateScheduleAction',\r\n            'DeleteSchedulesAction',\r\n            'SetScheduleStatusAction',\r\n            'RunServerSchedulesAction',\r\n            'RunSchedulesAction',\r\n            'RenameScheduleAction',\r\n            'siteId'\r\n        ];\r\n        return ScheduleCtrl;\r\n    })();\r\n    VizPortal.ScheduleCtrl = ScheduleCtrl;\r\n    VizPortal.Module.instance().controller('ScheduleCtrl', ScheduleCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"AbstractContentAction.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ChangeExtractTaskPriorityAction = (function (_super) {\r\n        __extends(ChangeExtractTaskPriorityAction, _super);\r\n        function ChangeExtractTaskPriorityAction(ConfirmActionDialog, ContentActionNotification, $translate, ExtractTasks) {\r\n            _super.call(this, ConfirmActionDialog, ContentActionNotification);\r\n            this.$translate = $translate;\r\n            this.ExtractTasks = ExtractTasks;\r\n        }\r\n        ChangeExtractTaskPriorityAction.prototype.configureDialog = function (dialogConfig, extractTasks) {\r\n            var _this = this;\r\n            var scope = dialogConfig.scope;\r\n            if (extractTasks.size() === 1) {\r\n                var task = extractTasks.first();\r\n                if (task.workbook) {\r\n                    scope.description = this.$translate.instant('extractTasksSetPriorityWorkbookPrompt', {\r\n                        PARENT_NAME: VizPortal.L10n.elideIfLong(task.workbook.name)\r\n                    });\r\n                }\r\n                else if (task.datasource) {\r\n                    scope.description = this.$translate.instant('extractTasksSetPriorityDatasourcePrompt', {\r\n                        PARENT_NAME: VizPortal.L10n.elideIfLong(task.datasource.name)\r\n                    });\r\n                }\r\n            }\r\n            else {\r\n                scope.description = this.$translate.instant('extractTasksSetPriorityMultiplePrompt', {\r\n                    ITEM_COUNT: extractTasks.size()\r\n                }, VizPortal.L10n.Interpolations.Count);\r\n            }\r\n            scope.numberDescription = this.$translate.instant('createScheduleFormPriorityDescription');\r\n            scope.input = {\r\n                num: Math.min.apply(Math, _.map(extractTasks.toArray(), function (extractTasks) { return extractTasks.priority; })),\r\n                min: VizPortal.ExtractTasks.MIN_PRIORITY,\r\n                max: VizPortal.ExtractTasks.MAX_PRIORITY,\r\n                isInteger: true,\r\n                width: '75px'\r\n            };\r\n            dialogConfig.bodyTemplateUrl = 'confirmActionDialogInputNumber.html';\r\n            dialogConfig.title = this.$translate.instant('tasksSetPriority');\r\n            dialogConfig.actionName = this.$translate.instant('tasksSetPriorityConfirm', {\r\n                ITEM_COUNT: extractTasks.size()\r\n            }, VizPortal.L10n.Interpolations.Count);\r\n            dialogConfig.action = function () { return _this.ExtractTasks.setPriority(extractTasks.keys(), scope.input.num); };\r\n        };\r\n        ChangeExtractTaskPriorityAction.prototype.notificationTranslationIds = function () {\r\n            return {\r\n                successId: 'extractTasksSetPrioritySuccess',\r\n                errorId: 'extractTasksSetPriorityError'\r\n            };\r\n        };\r\n        ChangeExtractTaskPriorityAction.$inject = ['ConfirmActionDialog', 'ContentActionNotification', '$translate', 'ExtractTasks'];\r\n        return ChangeExtractTaskPriorityAction;\r\n    })(VizPortal.AbstractContentAction);\r\n    VizPortal.ChangeExtractTaskPriorityAction = ChangeExtractTaskPriorityAction;\r\n    VizPortal.Module.instance().service('ChangeExtractTaskPriorityAction', ChangeExtractTaskPriorityAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\n/// <reference path=\"../resources/Schedules.ts\" />\r\n/// <reference path=\"ContentActionNotification.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ChangeScheduleAction = (function () {\r\n        function ChangeScheduleAction($translate, ConfirmActionDialog, SearchSuggestionsService, Subscriptions, ExtractTasks, ActionHelpers) {\r\n            this.$translate = $translate;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.SearchSuggestionsService = SearchSuggestionsService;\r\n            this.Subscriptions = Subscriptions;\r\n            this.ExtractTasks = ExtractTasks;\r\n            this.ActionHelpers = ActionHelpers;\r\n        }\r\n        // Generic logic\r\n        ChangeScheduleAction.prototype.createDialogScope = function (parentScope, items, options) {\r\n            var scope = parentScope.$new();\r\n            scope.descriptionTranslateKey = options.descriptionTranslateKey;\r\n            scope.descriptionTranslateValues = options.descriptionTranslateValues;\r\n            scope.filterList = {\r\n                model: null,\r\n                displayField: 'name',\r\n                suggestions: this.SearchSuggestionsService.schedulesSource(options.scheduledActionType)\r\n            };\r\n            return scope;\r\n        };\r\n        ChangeScheduleAction.prototype.execute = function (items, context, options) {\r\n            var scope = this.createDialogScope(context.scope, items, options);\r\n            var getSchedule = function () { return scope.filterList.model; };\r\n            var dialogInstance = this.ConfirmActionDialog.open({\r\n                scope: scope,\r\n                bodyTemplateUrl: 'confirmActionDialogFilterListBox.html',\r\n                title: this.$translate.instant('changeSchedule'),\r\n                actionName: this.$translate.instant('changeScheduleConfirm', { COUNT: items.size() }, VizPortal.L10n.Interpolations.Count),\r\n                action: function () { return options.action(items.keys(), getSchedule().id); },\r\n                confirmDisabled: function () { return !getSchedule(); }\r\n            });\r\n            dialogInstance.result\r\n                .then(this.ActionHelpers.notifyStandardError(items, options.notificationTranslationIds, function (errorItem) { return options.errorDetailFn(getSchedule())(errorItem); }));\r\n            dialogInstance.result.fin(function () { return scope.$destroy(); });\r\n            return dialogInstance.result;\r\n        };\r\n        ChangeScheduleAction.prototype.setScheduleErrorMessageFor = function (errorItem, schedule) {\r\n            switch (errorItem.error.code) {\r\n                case VizPortal.SchedulingErrorCode.SchedulingScheduleNotFound:\r\n                    return this.$translate.instant('scheduleNotFound', { SCHEDULE: schedule.name });\r\n            }\r\n            return null;\r\n        };\r\n        // Subscription specific logic\r\n        ChangeScheduleAction.prototype.forSubscriptions = function (subscriptions, context) {\r\n            var _this = this;\r\n            var descriptionTranslateKey;\r\n            var descriptionTranslateValues;\r\n            if (subscriptions.size() === 1) {\r\n                var sub = subscriptions.first();\r\n                descriptionTranslateValues = { TARGET_NAME: VizPortal.L10n.elideIfLong(sub.targetName) };\r\n                if (sub.targetType === VizPortal.SubscriptionTargetTypes.view) {\r\n                    descriptionTranslateKey = 'changeScheduleSubscriptionViewPrompt';\r\n                }\r\n                else if (sub.targetType === VizPortal.SubscriptionTargetTypes.workbook) {\r\n                    descriptionTranslateKey = 'changeScheduleSubscriptionWorkbookPrompt';\r\n                }\r\n            }\r\n            else {\r\n                descriptionTranslateKey = 'changeScheduleSubscriptionsPrompt';\r\n                descriptionTranslateValues = { COUNT: subscriptions.size() };\r\n            }\r\n            var options = {\r\n                action: function (ids, scheduleId) { return _this.Subscriptions.setSchedule(ids, scheduleId); },\r\n                notificationTranslationIds: {\r\n                    successId: 'changeScheduleSubscriptionsSuccess',\r\n                    errorId: 'changeScheduleSubscriptionsError'\r\n                },\r\n                errorDetailFn: function (schedule) { return _this.subscriptionErrorDetailFactory(schedule); },\r\n                scheduledActionType: VizPortal.ServerApi.ScheduleActions.Subscription,\r\n                descriptionTranslateKey: descriptionTranslateKey,\r\n                descriptionTranslateValues: descriptionTranslateValues\r\n            };\r\n            return this.execute(subscriptions, context, options);\r\n        };\r\n        ChangeScheduleAction.prototype.subscriptionErrorDetailFactory = function (schedule) {\r\n            var _this = this;\r\n            return function (errorItem) {\r\n                return {\r\n                    itemName: errorItem.item.subject,\r\n                    errorMessage: _this.subscriptionErrorMessageFor(errorItem, schedule)\r\n                };\r\n            };\r\n        };\r\n        ChangeScheduleAction.prototype.subscriptionErrorMessageFor = function (errorItem, schedule) {\r\n            switch (errorItem.error.code) {\r\n                case VizPortal.CommonErrorCode.SubscriptionNotFound:\r\n                    return this.$translate.instant('subscriptionNotFound', { SUBSCRIPTION_SUBJECT: errorItem.item.subject });\r\n            }\r\n            return this.setScheduleErrorMessageFor(errorItem, schedule);\r\n        };\r\n        // Extract Tasks specific logic\r\n        ChangeScheduleAction.prototype.forExtractTasks = function (extractTasks, context) {\r\n            var _this = this;\r\n            var descriptionTranslateKey;\r\n            var descriptionTranslateValues;\r\n            if (extractTasks.size() === 1) {\r\n                var task = extractTasks.first();\r\n                if (task.workbook) {\r\n                    descriptionTranslateKey = 'changeScheduleExtractTasksWorkbookPrompt';\r\n                    descriptionTranslateValues = { PARENT_NAME: VizPortal.L10n.elideIfLong(task.workbook.name) };\r\n                }\r\n                else if (task.datasource) {\r\n                    descriptionTranslateKey = 'changeScheduleExtractTasksDatasourcePrompt';\r\n                    descriptionTranslateValues = { PARENT_NAME: VizPortal.L10n.elideIfLong(task.datasource.name) };\r\n                }\r\n            }\r\n            else {\r\n                descriptionTranslateKey = 'changeScheduleExtractTasksPrompt';\r\n                descriptionTranslateValues = { COUNT: extractTasks.size() };\r\n            }\r\n            var options = {\r\n                action: function (ids, scheduleId) { return _this.ExtractTasks.setSchedule(ids, scheduleId); },\r\n                notificationTranslationIds: {\r\n                    successId: 'changeScheduleExtractTasksSuccess',\r\n                    errorId: 'changeScheduleExtractTasksError'\r\n                },\r\n                errorDetailFn: function (schedule) { return _this.extractTaskErrorDetailFactory(schedule); },\r\n                scheduledActionType: VizPortal.ServerApi.ScheduleActions.Extract,\r\n                descriptionTranslateKey: descriptionTranslateKey,\r\n                descriptionTranslateValues: descriptionTranslateValues\r\n            };\r\n            return this.execute(extractTasks, context, options);\r\n        };\r\n        ChangeScheduleAction.prototype.extractTaskErrorDetailFactory = function (schedule) {\r\n            var _this = this;\r\n            return function (errorItem) {\r\n                var namedItem = errorItem.item.datasource || errorItem.item.workbook;\r\n                return {\r\n                    itemName: namedItem.name,\r\n                    errorMessage: _this.extractTaskErrorMessageFor(errorItem, schedule)\r\n                };\r\n            };\r\n        };\r\n        ChangeScheduleAction.prototype.extractTaskErrorMessageFor = function (errorItem, schedule) {\r\n            switch (errorItem.error.code) {\r\n                case VizPortal.SchedulingErrorCode.SchedulingTaskNotFound:\r\n                    if (errorItem.item.workbook)\r\n                        return this.$translate.instant('extractTaskNotFoundForWorkbook', { WORKBOOK_NAME: VizPortal.L10n.elideIfLong(errorItem.item.workbook.name) });\r\n                    if (errorItem.item.datasource)\r\n                        return this.$translate.instant('extractTaskNotFoundForDatasource', { DATASOURCE_NAME: VizPortal.L10n.elideIfLong(errorItem.item.datasource.name) });\r\n            }\r\n            return this.setScheduleErrorMessageFor(errorItem, schedule);\r\n        };\r\n        ChangeScheduleAction.$inject = [\r\n            '$translate',\r\n            'ConfirmActionDialog',\r\n            'SearchSuggestionsService',\r\n            'Subscriptions',\r\n            'ExtractTasks',\r\n            'ActionHelpers'\r\n        ];\r\n        return ChangeScheduleAction;\r\n    })();\r\n    VizPortal.ChangeScheduleAction = ChangeScheduleAction;\r\n    VizPortal.Module.instance().service('ChangeScheduleAction', ChangeScheduleAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DeleteExtractTasksAction = (function () {\r\n        function DeleteExtractTasksAction(ConfirmActionDialog, ActionHelpers, ContentUrl, $translate, ExtractTasks) {\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.ActionHelpers = ActionHelpers;\r\n            this.ContentUrl = ContentUrl;\r\n            this.$translate = $translate;\r\n            this.ExtractTasks = ExtractTasks;\r\n        }\r\n        DeleteExtractTasksAction.prototype.executeWithContext = function (extractTasks, context) {\r\n            var _this = this;\r\n            var description;\r\n            if (extractTasks.size() === 1) {\r\n                var task = extractTasks.first();\r\n                if (task.workbook) {\r\n                    description = this.$translate.instant('confirmDeleteExtractWorkbook', { PARENT_NAME: VizPortal.L10n.elideIfLong(task.workbook.name) });\r\n                }\r\n                else if (task.datasource) {\r\n                    description = this.$translate.instant('confirmDeleteExtractDatasources', { PARENT_NAME: VizPortal.L10n.elideIfLong(task.datasource.name) });\r\n                }\r\n            }\r\n            else {\r\n                description = this.$translate.instant('confirmDeleteExtracts', {\r\n                    ITEM_COUNT: extractTasks.size()\r\n                }, VizPortal.L10n.Interpolations.Count);\r\n            }\r\n            return this.ConfirmActionDialog.open({\r\n                scope: context.scope,\r\n                title: this.$translate.instant('delete'),\r\n                bodyText: description,\r\n                actionName: this.$translate.instant('confirmDeleteButton', { ITEM_COUNT: extractTasks.size() }, VizPortal.L10n.Interpolations.Count),\r\n                isDeleteAction: true,\r\n                action: function (dialogInstance) {\r\n                    return _this.ExtractTasks.del(extractTasks.keys())\r\n                        .then(_this.ActionHelpers.notifyStandardError(extractTasks, {\r\n                        successId: 'deleteExtractTasksSuccess',\r\n                        errorId: 'deleteExtractTasksError'\r\n                    }, function (errorItem) {\r\n                        var namedItem = errorItem.item.workbook || errorItem.item.datasource;\r\n                        return {\r\n                            itemName: namedItem.name,\r\n                            itemUrl: _this.urlFor(errorItem),\r\n                            errorMessage: _this.errorMessageFor(errorItem)\r\n                        };\r\n                    }));\r\n                }\r\n            }).result;\r\n        };\r\n        DeleteExtractTasksAction.prototype.urlFor = function (errorItem) {\r\n            var href;\r\n            if (errorItem.item.workbook) {\r\n                href = this.ContentUrl.forItem(errorItem.item.workbook, VizPortal.WorkbookContentType);\r\n            }\r\n            if (errorItem.item.datasource) {\r\n                href = this.ContentUrl.forItem(errorItem.item.datasource, VizPortal.DatasourceContentType);\r\n            }\r\n            return href;\r\n        };\r\n        DeleteExtractTasksAction.prototype.errorMessageFor = function (errorItem) {\r\n            switch (errorItem.error.code) {\r\n                case VizPortal.SchedulingErrorCode.SchedulingTaskNotFound:\r\n                    if (errorItem.item.workbook)\r\n                        return this.$translate.instant('errorExtractTaskForWorkbookNotFound', {\r\n                            WORKBOOK_NAME: VizPortal.L10n.elideIfLong(errorItem.item.workbook.name),\r\n                            SCHEDULE_NAME: VizPortal.L10n.elideIfLong(errorItem.item.schedule.name)\r\n                        });\r\n                    if (errorItem.item.datasource)\r\n                        return this.$translate.instant('errorExtractTaskForDatasourceNotFound', {\r\n                            DATASOURCE_NAME: VizPortal.L10n.elideIfLong(errorItem.item.datasource.name),\r\n                            SCHEDULE_NAME: VizPortal.L10n.elideIfLong(errorItem.item.schedule.name)\r\n                        });\r\n            }\r\n        };\r\n        DeleteExtractTasksAction.$inject = ['ConfirmActionDialog', 'ActionHelpers', 'ContentUrl', '$translate', 'ExtractTasks'];\r\n        return DeleteExtractTasksAction;\r\n    })();\r\n    VizPortal.DeleteExtractTasksAction = DeleteExtractTasksAction;\r\n    VizPortal.Module.instance().service('DeleteExtractTasksAction', DeleteExtractTasksAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var DeleteExtractTasksRequest = (function (_super) {\r\n            __extends(DeleteExtractTasksRequest, _super);\r\n            function DeleteExtractTasksRequest(ids) {\r\n                _super.call(this, 'deleteExtractTasks', { ids: ids });\r\n            }\r\n            return DeleteExtractTasksRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.DeleteExtractTasksRequest = DeleteExtractTasksRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/IGetItemsParams.ts\" />\r\n/// <reference path=\"../types/IGetItemsResult.ts\" />\r\n/// <reference path=\"../types/IDataSource.ts\" />\r\n/// <reference path=\"../types/IExtractTask.ts\" />\r\n/// <reference path=\"../types/ISchedule.ts\" />\r\n/// <reference path=\"../types/ISite.ts\" />\r\n/// <reference path=\"../types/IWorkbook.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetExtractTasksRequest = (function (_super) {\r\n            __extends(GetExtractTasksRequest, _super);\r\n            function GetExtractTasksRequest(params) {\r\n                _super.call(this, 'getExtractTasks', params);\r\n            }\r\n            return GetExtractTasksRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetExtractTasksRequest = GetExtractTasksRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var RunExtractTasksRequest = (function (_super) {\r\n            __extends(RunExtractTasksRequest, _super);\r\n            function RunExtractTasksRequest(ids) {\r\n                _super.call(this, 'runExtractTasks', {\r\n                    ids: ids\r\n                });\r\n            }\r\n            return RunExtractTasksRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.RunExtractTasksRequest = RunExtractTasksRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\n/// <reference path=\"../types/IResponse.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var SetExtractTasksPriorityRequest = (function (_super) {\r\n            __extends(SetExtractTasksPriorityRequest, _super);\r\n            function SetExtractTasksPriorityRequest(ids, priority) {\r\n                _super.call(this, 'setExtractTasksPriority', {\r\n                    ids: ids,\r\n                    priority: priority\r\n                });\r\n            }\r\n            return SetExtractTasksPriorityRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.SetExtractTasksPriorityRequest = SetExtractTasksPriorityRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var SetExtractTasksScheduleRequest = (function (_super) {\r\n            __extends(SetExtractTasksScheduleRequest, _super);\r\n            function SetExtractTasksScheduleRequest(ids, scheduleId) {\r\n                _super.call(this, 'setExtractTasksSchedule', {\r\n                    ids: ids,\r\n                    scheduleId: scheduleId\r\n                });\r\n            }\r\n            return SetExtractTasksScheduleRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.SetExtractTasksScheduleRequest = SetExtractTasksScheduleRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/RequestHelper.ts\" />\r\n/// <reference path=\"../helpers/ResultHelper.ts\" />\r\n/// <reference path=\"../helpers/ServerModelHelper.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/DeleteExtractTasksRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetExtractTasksRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/RunExtractTasksRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/SetExtractTasksPriorityRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/SetExtractTasksScheduleRequest.ts\" />\r\n/// <reference path=\"../ServerApi/types/IExtractTask.ts\" />\r\n/// <reference path=\"../services/ErrorNotifyingServer.ts\" />\r\n/// <reference path=\"Resource.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ExtractTasks = (function (_super) {\r\n        __extends(ExtractTasks, _super);\r\n        function ExtractTasks(ErrorNotifyingServer, FetcherFactory) {\r\n            _super.call(this, FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetExtractTasksRequest, VizPortal.ServerApiMapper.extractTasks));\r\n            this.ErrorNotifyingServer = ErrorNotifyingServer;\r\n        }\r\n        ExtractTasks.prototype.del = function (ids) {\r\n            return this.ErrorNotifyingServer.sendRequests(VizPortal.RequestHelper.buildRequests(ids, function (idsBlock) { return new VizPortal.ServerApi.DeleteExtractTasksRequest(idsBlock); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        ExtractTasks.prototype.run = function (ids) {\r\n            return this.ErrorNotifyingServer.sendRequests(VizPortal.RequestHelper.buildRequests(ids, function (idsBlock) { return new VizPortal.ServerApi.RunExtractTasksRequest(idsBlock); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        ExtractTasks.prototype.setPriority = function (ids, priority) {\r\n            return this.ErrorNotifyingServer.sendRequests(VizPortal.RequestHelper.buildRequests(ids, function (idsBlock) { return new VizPortal.ServerApi.SetExtractTasksPriorityRequest(idsBlock, priority); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        ExtractTasks.prototype.setSchedule = function (ids, scheduleId) {\r\n            return this.ErrorNotifyingServer.sendRequests(VizPortal.RequestHelper.buildRequests(ids, function (idsBlock) { return new VizPortal.ServerApi.SetExtractTasksScheduleRequest(idsBlock, scheduleId); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        ExtractTasks.MAX_PRIORITY = 100;\r\n        ExtractTasks.MIN_PRIORITY = 1;\r\n        ExtractTasks.$inject = ['ErrorNotifyingServer', 'FetcherFactory'];\r\n        return ExtractTasks;\r\n    })(VizPortal.Resource);\r\n    VizPortal.ExtractTasks = ExtractTasks;\r\n    VizPortal.Module.instance().service('ExtractTasks', ExtractTasks);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"AbstractContentAction.ts\" />\r\n/// <reference path=\"../resources/ExtractTasks.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var RunExtractTasksAction = (function (_super) {\r\n        __extends(RunExtractTasksAction, _super);\r\n        function RunExtractTasksAction(ConfirmActionDialog, ContentActionNotification, $translate, ExtractTasks) {\r\n            _super.call(this, ConfirmActionDialog, ContentActionNotification);\r\n            this.$translate = $translate;\r\n            this.ExtractTasks = ExtractTasks;\r\n        }\r\n        RunExtractTasksAction.prototype.configureDialog = function (dialogConfig, extractTasks) {\r\n            var _this = this;\r\n            var extractTaskCount = extractTasks.size();\r\n            if (extractTaskCount === 1) {\r\n                var extractTask = extractTasks.first();\r\n                if (extractTask.datasource) {\r\n                    dialogConfig.bodyText = this.$translate.instant('extractTaskForDataSourceRunPrompt', {\r\n                        DATASOURCE_NAME: VizPortal.L10n.elideIfLong(extractTask.datasource.name)\r\n                    });\r\n                }\r\n                else if (extractTask.workbook) {\r\n                    dialogConfig.bodyText = this.$translate.instant('extractTaskForWorkbookRunPrompt', {\r\n                        WORKBOOK_NAME: VizPortal.L10n.elideIfLong(extractTask.workbook.name)\r\n                    });\r\n                }\r\n                else {\r\n                    dialogConfig.bodyText = this.$translate.instant('extractTasksRunPrompt', {\r\n                        ITEM_COUNT: extractTaskCount\r\n                    }, VizPortal.L10n.Interpolations.Count);\r\n                }\r\n            }\r\n            else {\r\n                dialogConfig.bodyText = this.$translate.instant('extractTasksRunPrompt', {\r\n                    ITEM_COUNT: extractTaskCount\r\n                }, VizPortal.L10n.Interpolations.Count);\r\n            }\r\n            dialogConfig.title = this.$translate.instant('runNow');\r\n            dialogConfig.actionName = this.$translate.instant('runNowConfirmButton', {\r\n                ITEM_COUNT: extractTaskCount\r\n            }, VizPortal.L10n.Interpolations.Count);\r\n            dialogConfig.action = function () { return _this.ExtractTasks.run(extractTasks.keys()); };\r\n        };\r\n        RunExtractTasksAction.prototype.notificationTranslationIds = function () {\r\n            return {\r\n                successId: 'extractTasksRunSuccess',\r\n                errorId: 'extractTasksRunError'\r\n            };\r\n        };\r\n        RunExtractTasksAction.$inject = ['ConfirmActionDialog', 'ContentActionNotification', '$translate', 'ExtractTasks'];\r\n        return RunExtractTasksAction;\r\n    })(VizPortal.AbstractContentAction);\r\n    VizPortal.RunExtractTasksAction = RunExtractTasksAction;\r\n    VizPortal.Module.instance().service('RunExtractTasksAction', RunExtractTasksAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var DeleteSubscriptionsRequest = (function (_super) {\r\n            __extends(DeleteSubscriptionsRequest, _super);\r\n            function DeleteSubscriptionsRequest(ids) {\r\n                _super.call(this, 'deleteSubscriptions', { ids: ids });\r\n            }\r\n            return DeleteSubscriptionsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.DeleteSubscriptionsRequest = DeleteSubscriptionsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"resourceParts.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/IGetItemsParams.ts\" />\r\n/// <reference path=\"../types/IGetItemsResult.ts\" />\r\n/// <reference path=\"../types/IDataSource.ts\" />\r\n/// <reference path=\"../types/ISubscription.ts\" />\r\n/// <reference path=\"../types/ISchedule.ts\" />\r\n/// <reference path=\"../types/ISite.ts\" />\r\n/// <reference path=\"../types/IWorkbook.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetSubscriptionsRequest = (function (_super) {\r\n            __extends(GetSubscriptionsRequest, _super);\r\n            function GetSubscriptionsRequest(params) {\r\n                _super.call(this, 'getSubscriptions', params);\r\n            }\r\n            return GetSubscriptionsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetSubscriptionsRequest = GetSubscriptionsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var SetSubscriptionsScheduleRequest = (function (_super) {\r\n            __extends(SetSubscriptionsScheduleRequest, _super);\r\n            function SetSubscriptionsScheduleRequest(ids, scheduleId) {\r\n                _super.call(this, 'setSubscriptionsSchedule', {\r\n                    ids: ids,\r\n                    scheduleId: scheduleId\r\n                });\r\n            }\r\n            return SetSubscriptionsScheduleRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.SetSubscriptionsScheduleRequest = SetSubscriptionsScheduleRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\n/// <reference path=\"../types/IResponse.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var SetSubscriptionSubjectRequest = (function (_super) {\r\n            __extends(SetSubscriptionSubjectRequest, _super);\r\n            function SetSubscriptionSubjectRequest(id, subject) {\r\n                _super.call(this, 'setSubscriptionSubject', {\r\n                    id: id,\r\n                    subject: subject\r\n                });\r\n            }\r\n            return SetSubscriptionSubjectRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.SetSubscriptionSubjectRequest = SetSubscriptionSubjectRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/RequestHelper.ts\" />\r\n/// <reference path=\"../helpers/ResultHelper.ts\" />\r\n/// <reference path=\"../helpers/ServerModelHelper.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/DeleteSubscriptionsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetSubscriptionsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/SetSubscriptionsScheduleRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/SetSubscriptionSubjectRequest.ts\" />\r\n/// <reference path=\"../ServerApi/types/ISubscription.ts\" />\r\n/// <reference path=\"../services/ErrorNotifyingServer.ts\" />\r\n/// <reference path=\"Resource.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var Subscriptions = (function (_super) {\r\n        __extends(Subscriptions, _super);\r\n        function Subscriptions(ErrorNotifyingServer, FetcherFactory) {\r\n            _super.call(this, FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetSubscriptionsRequest, VizPortal.ServerApiMapper.subscriptions));\r\n            this.ErrorNotifyingServer = ErrorNotifyingServer;\r\n        }\r\n        Subscriptions.prototype.del = function (ids) {\r\n            return this.ErrorNotifyingServer.sendRequests(VizPortal.RequestHelper.buildRequests(ids, function (idsBlock) { return new VizPortal.ServerApi.DeleteSubscriptionsRequest(idsBlock); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        Subscriptions.prototype.setSchedule = function (ids, scheduleId) {\r\n            return this.ErrorNotifyingServer.sendRequests(VizPortal.RequestHelper.buildRequests(ids, function (idsBlock) { return new VizPortal.ServerApi.SetSubscriptionsScheduleRequest(idsBlock, scheduleId); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        Subscriptions.prototype.changeSubject = function (id, subject) {\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.SetSubscriptionSubjectRequest(id, subject));\r\n        };\r\n        Subscriptions.$inject = ['ErrorNotifyingServer', 'FetcherFactory'];\r\n        return Subscriptions;\r\n    })(VizPortal.Resource);\r\n    VizPortal.Subscriptions = Subscriptions;\r\n    VizPortal.Module.instance().service('Subscriptions', Subscriptions);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/Order.ts\" />\r\n/// <reference path=\"../models/ContentFilters.ts\" />\r\n/// <reference path=\"../models/ContentTypes.ts\" />\r\n/// <reference path=\"../models/IPlace.ts\" />\r\n/// <reference path=\"../resources/ExtractTasks.ts\" />\r\n/// <reference path=\"../resources/Subscriptions.ts\" />\r\n/// <reference path=\"../ServerApi/types/IOrderClause.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    // TODO: This should be named \"TasksPlace\".\r\n    var TaskPlace = (function () {\r\n        function TaskPlace($location, ExtractTasks, Subscriptions) {\r\n            var _this = this;\r\n            this.$location = $location;\r\n            this.ExtractTasks = ExtractTasks;\r\n            this.Subscriptions = Subscriptions;\r\n            this.urlParamsFn = function () { return _this.$location.search(); };\r\n        }\r\n        TaskPlace.prototype.create = function (siteId, implicitFilters) {\r\n            if (implicitFilters === void 0) { implicitFilters = {}; }\r\n            var place = new VizPortal.Place();\r\n            var excludeFilterKeys = _.union(TaskPlace.ExcludeFilterKeys, _.keys(implicitFilters));\r\n            place.addSubplace(VizPortal.Subplace.create('extractTasks', VizPortal.ExtractTaskContentType, this.ExtractTasks, this.urlParamsFn, _.extend({}, implicitFilters, { siteId: siteId }), excludeFilterKeys));\r\n            place.addSubplace(VizPortal.Subplace.create('subscriptions', VizPortal.SubscriptionContentType, this.Subscriptions, this.urlParamsFn, _.extend({}, implicitFilters, { siteId: siteId }), excludeFilterKeys));\r\n            return place;\r\n        };\r\n        TaskPlace.ExcludeFilterKeys = [\r\n            VizPortal.ContentFiltersKeys.siteId\r\n        ];\r\n        TaskPlace.$inject = [\r\n            '$location',\r\n            'ExtractTasks',\r\n            'Subscriptions'\r\n        ];\r\n        return TaskPlace;\r\n    })();\r\n    VizPortal.TaskPlace = TaskPlace;\r\n    VizPortal.Module.instance().service('TaskPlace', TaskPlace);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../../app/IMainScope.ts\" />\r\n/// <reference path=\"../helpers/SubplaceCountsHelper.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../models/IPlace.ts\" />\r\n/// <reference path=\"../models/TaskPlace.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var TasksCtrl = (function () {\r\n        function TasksCtrl($scope, $state, place) {\r\n            VizPortal.SubplaceTabsHelper.refreshWhenCurrentTabClicked($scope, $state);\r\n            VizPortal.SubplaceCountsHelper.keepSubplaceCountsUpdated($scope, place);\r\n        }\r\n        TasksCtrl.$inject = [\r\n            '$scope',\r\n            '$state',\r\n            'place'\r\n        ];\r\n        return TasksCtrl;\r\n    })();\r\n    VizPortal.TasksCtrl = TasksCtrl;\r\n    VizPortal.Module.instance().controller('TasksCtrl', TasksCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../../app/content/ExtractTasksGrid.ts\" />\r\n/// <reference path=\"../controllers/ContentPlaceCtrl.ts\" />\r\n/// <reference path=\"../controllers/RemoteRefreshSchedulesCtrl.ts\" />\r\n/// <reference path=\"../controllers/ScheduleCtrl.ts\" />\r\n/// <reference path=\"../helpers/ActionButtonsHelper.ts\" />\r\n/// <reference path=\"../helpers/RefreshPropertyHelper.ts\" />\r\n/// <reference path=\"../helpers/SubplaceCountsHelper.ts\" />\r\n/// <reference path=\"../models/ContentTypes.ts\" />\r\n/// <reference path=\"../models/IEmptyTemplate.ts\" />\r\n/// <reference path=\"../models/ITemplate.ts\" />\r\n/// <reference path=\"../resources/Schedules.ts\" />\r\n/// <reference path=\"../services/BrowserTitleService.ts\" />\r\n/// <reference path=\"../services/ChangeDatasourceRemoteRefreshPropertiesAction.ts\" />\r\n/// <reference path=\"../services/ChangeExtractTaskPriorityAction.ts\" />\r\n/// <reference path=\"../services/ChangeScheduleAction.ts\" />\r\n/// <reference path=\"../services/DeleteExtractTasksAction.ts\" />\r\n/// <reference path=\"../services/HelpService.ts\" />\r\n/// <reference path=\"../services/QueryService.ts\" />\r\n/// <reference path=\"../services/RunExtractTasksAction.ts\" />\r\n/// <reference path=\"../services/SelectionService.ts\" />\r\n/// <reference path=\"../services/SorterFactory.ts\" />\r\n/// <reference path=\"TasksCtrl.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ExtractTasksCtrl = (function () {\r\n        function ExtractTasksCtrl($q, $translate, AngularToReactDataGridBridge, $filter, $scope, $state, BrowserTitleService, subplace, extractTasksContext, queryService, selectionService, sorterFactory, DeleteExtractTasksAction, RunExtractTasksAction, ChangeExtractTaskPriorityAction, ChangeScheduleAction, ChangeDatasourceRemoteRefreshPropertiesAction, ServerService, HelpService) {\r\n            var _this = this;\r\n            this.$q = $q;\r\n            this.$translate = $translate;\r\n            this.AngularToReactDataGridBridge = AngularToReactDataGridBridge;\r\n            this.$filter = $filter;\r\n            this.$scope = $scope;\r\n            this.$state = $state;\r\n            this.extractTasksContext = extractTasksContext;\r\n            this.DeleteExtractTasksAction = DeleteExtractTasksAction;\r\n            this.RunExtractTasksAction = RunExtractTasksAction;\r\n            this.ChangeExtractTaskPriorityAction = ChangeExtractTaskPriorityAction;\r\n            this.ChangeScheduleAction = ChangeScheduleAction;\r\n            this.ServerService = ServerService;\r\n            this.HelpService = HelpService;\r\n            BrowserTitleService.setTitle($scope.objectName ? 'refreshSchedule' : 'extractTasks', $scope.objectName);\r\n            // If a deep link was used to this sub-place after the refresh mode was changed, redirect to the correct one.\r\n            this.redirectByExtractsAndRefreshMode($state, extractTasksContext.datasource);\r\n            this.waitForCountOfSchedules = $q.defer();\r\n            $scope.selectedItems = new VizPortal.Set(function (extractTask) { return extractTask.id; });\r\n            var actions = this.createActions($scope.selectedItems);\r\n            $scope.useReactDataGrid = VizPortal.FeatureFlags.reactExtractTasksGrid;\r\n            if (VizPortal.FeatureFlags.reactExtractTasksGrid) {\r\n                this.configureForReactDataGrid(actions);\r\n            }\r\n            $scope.rowClicked = function (row, colIndex) {\r\n                if ($scope.anyActionsAllowed()) {\r\n                    selectionService.rowClicked($scope.selectedItems, row, colIndex);\r\n                }\r\n            };\r\n            $scope.sorter = sorterFactory.create(VizPortal.ExtractTaskContentType.defaultOrder);\r\n            this.query = queryService.createQueryUpdaterFromSubplace($scope, subplace, function (resourceQuery) {\r\n                if (VizPortal.FeatureFlags.reactExtractTasksGrid) {\r\n                    _this.AngularToReactDataGridBridge.updateReactDataGridRowStore({ scope: $scope, sliceable: resourceQuery });\r\n                }\r\n                $scope.sliceable = resourceQuery;\r\n                $scope.sorter.setOrder(resourceQuery.getOrder());\r\n            });\r\n            this.refreshExtractTasks();\r\n            $scope.$on(VizPortal.SubplaceEvents.Refresh, function () {\r\n                _this.refreshExtractTasks();\r\n            });\r\n            $scope.availableAction = function (action) { return action.isAvailable($scope.selectedItems); };\r\n            VizPortal.ActionButtonsHelper.setupActionButtons($scope, actions);\r\n            $scope.listActions = [{\r\n                    name: 'new-refresh-task',\r\n                    translate: 'newExtractRefresh',\r\n                    isAvailable: function () { return (!!_this.extractTasksContext.createExtractTaskFn && _this.extractTasksContext.modifyExtractTasksPermission); },\r\n                    execute: function ($event) {\r\n                        // If refresh properties can be modified the expectation is that creating a schedule when none exist will first\r\n                        // show the refresh properties.\r\n                        if ($scope.refreshPropertiesAreEditable()) {\r\n                            // Refresh properties are enabled, wait for the current count.\r\n                            _this.waitForCountOfSchedules.promise.then(function (countOfSchedules) {\r\n                                if (countOfSchedules === 0) {\r\n                                    // No schedules exist, show refresh properties before showing the create action.\r\n                                    ChangeDatasourceRemoteRefreshPropertiesAction.execute($event, extractTasksContext.datasource, true, countOfSchedules);\r\n                                }\r\n                                else {\r\n                                    // Schedules exist, open the create action directly.\r\n                                    _this.extractTasksContext.createExtractTaskFn(VizPortal.ActionContext.fromEvent($event)).then(function () { return _this.refreshExtractTasks(); });\r\n                                }\r\n                            });\r\n                        }\r\n                        else {\r\n                            // Refresh property feature isn't enabled, immediately open the create action.\r\n                            _this.extractTasksContext.createExtractTaskFn(VizPortal.ActionContext.fromEvent($event)).then(function () { return _this.refreshExtractTasks(); });\r\n                        }\r\n                    }\r\n                }];\r\n            $scope.availableListAction = function (listAction) { return listAction.isAvailable(); };\r\n            $scope.anyActionsAllowed = function () { return _this.anyActionsAllowed(); };\r\n            $scope.headerClicked = function (header) { return $scope.sorter.setPrimary(header.attrs['key'], header.attrs['direction']); };\r\n            $scope.extractTypeTranslationKey = function (extractTask) {\r\n                switch (extractTask.type) {\r\n                    case VizPortal.ServerApi.ExtractTaskType.IncrementExtract: return 'extractTasksIncremental';\r\n                    case VizPortal.ServerApi.ExtractTaskType.RefreshExtract: return 'extractTasksFull';\r\n                    default: return null;\r\n                }\r\n            };\r\n            $scope.sliceChanged = function (newSlice) {\r\n                _this.waitForCountOfSchedules.resolve(newSlice.total);\r\n                $scope.selectedItems.updateItems(newSlice.items);\r\n                VizPortal.SubplaceCountsHelper.updateCountsFromSubplace($scope, subplace, newSlice.total);\r\n            };\r\n            $scope.emptyTemplateModel = this.createEmptyTemplateModel(extractTasksContext);\r\n            $scope.showRefreshProperties = function () {\r\n                return ServerService.featureFlags().dataSyncEnabled && extractTasksContext.datasource !== undefined;\r\n            };\r\n            $scope.currentRefreshLocation = function () { return VizPortal.RefreshPropertyHelper.getCurrentRefreshLocation(_this.$translate, extractTasksContext.datasource); };\r\n            $scope.refreshPropertiesAreEditable = function () {\r\n                return $scope.showRefreshProperties() &&\r\n                    extractTasksContext.modifyExtractTasksPermission &&\r\n                    VizPortal.RefreshPropertyHelper.canBeRefreshedRemotely(extractTasksContext.datasource);\r\n            };\r\n            $scope.changeRemoteRefreshProperties = function ($event) {\r\n                _this.waitForCountOfSchedules.promise.then(function (countOfSchedules) {\r\n                    ChangeDatasourceRemoteRefreshPropertiesAction.execute($event, extractTasksContext.datasource, false, countOfSchedules);\r\n                });\r\n            };\r\n        }\r\n        ExtractTasksCtrl.prototype.anyActionsAllowed = function () {\r\n            return this.extractTasksContext.modifyExtractTasksPermission;\r\n        };\r\n        ExtractTasksCtrl.prototype.isServerPage = function () {\r\n            return this.$state.includes(\"main.server.**\");\r\n        };\r\n        ExtractTasksCtrl.prototype.showWorkbookOrDatasourceColumn = function () {\r\n            var place = this.$scope.place;\r\n            return !(place === 'workbook' || place === 'datasource');\r\n        };\r\n        ExtractTasksCtrl.prototype.showScheduleColumn = function () {\r\n            return !this.$state.includes(\"**.schedule.**\");\r\n        };\r\n        ExtractTasksCtrl.prototype.showSiteColumn = function () {\r\n            return this.isServerPage();\r\n        };\r\n        ExtractTasksCtrl.prototype.redirectByExtractsAndRefreshMode = function ($state, datasource) {\r\n            if (datasource) {\r\n                // Prevent deep links for live data sources.\r\n                if (!datasource.hasExtracts) {\r\n                    $state.go('^.connectedWorkbooks'); // Go to default sibling state\r\n                }\r\n                // Prevent deep links to the incorrect refresh schedules page\r\n                VizPortal.RefreshPropertyHelper.redirectByDatasourceRefreshMode($state, datasource.refreshMode);\r\n            }\r\n        };\r\n        ExtractTasksCtrl.prototype.createActions = function (selectedItems) {\r\n            var _this = this;\r\n            return [\r\n                {\r\n                    name: 'tasks-run-now',\r\n                    translate: 'runNow_action',\r\n                    isAvailable: function (extractTasks) {\r\n                        return !extractTasks.isEmpty() && _this.extractTasksContext.modifyExtractTasksPermission;\r\n                    },\r\n                    execute: function (items, context) {\r\n                        _this.RunExtractTasksAction.execute(items, context)\r\n                            .then(function (result) {\r\n                            VizPortal.ActionHelpers.deselectNotFound(selectedItems, result, VizPortal.SchedulingErrorCode.SchedulingTaskNotFound);\r\n                            _this.refreshExtractTasks();\r\n                        });\r\n                    }\r\n                },\r\n                {\r\n                    name: 'tasks-change-schedule',\r\n                    translate: 'changeSchedule_action',\r\n                    isAvailable: function (extractTasks) {\r\n                        return !extractTasks.isEmpty() && _this.extractTasksContext.modifyExtractTasksPermission;\r\n                    },\r\n                    execute: function (items, context) {\r\n                        _this.ChangeScheduleAction.forExtractTasks(items, context)\r\n                            .then(function (result) {\r\n                            var scheduleScope = _this.$scope;\r\n                            if (scheduleScope.schedule) {\r\n                                VizPortal.ActionHelpers.deselectAllExceptErrors(selectedItems, result, VizPortal.SchedulingErrorCode.SchedulingTaskNotFound);\r\n                            }\r\n                            else {\r\n                                VizPortal.ActionHelpers.deselectNotFound(selectedItems, result, VizPortal.SchedulingErrorCode.SchedulingTaskNotFound);\r\n                            }\r\n                            _this.refreshExtractTasks();\r\n                        });\r\n                    }\r\n                },\r\n                {\r\n                    name: 'tasks-priority',\r\n                    translate: 'tasksSetPriority_action',\r\n                    isAvailable: function (extractTasks) {\r\n                        return !extractTasks.isEmpty() && _this.ServerService.isSessionSiteOrServerAdmin();\r\n                    },\r\n                    execute: function (items, context) {\r\n                        _this.ChangeExtractTaskPriorityAction.execute(items, context)\r\n                            .then(function (result) {\r\n                            VizPortal.ActionHelpers.deselectNotFound(selectedItems, result, VizPortal.SchedulingErrorCode.SchedulingTaskNotFound);\r\n                            _this.refreshExtractTasks();\r\n                        });\r\n                    }\r\n                },\r\n                {\r\n                    name: 'tasks-delete',\r\n                    translate: 'delete_action',\r\n                    isAvailable: function (extractTasks) {\r\n                        return !extractTasks.isEmpty() && _this.extractTasksContext.modifyExtractTasksPermission;\r\n                    },\r\n                    execute: function (items, context) {\r\n                        _this.DeleteExtractTasksAction.executeWithContext(items, context)\r\n                            .then(function (result) {\r\n                            VizPortal.ActionHelpers.deselectAllExceptErrors(selectedItems, result, VizPortal.SchedulingErrorCode.SchedulingTaskNotFound);\r\n                            _this.refreshExtractTasks();\r\n                        });\r\n                    }\r\n                }\r\n            ];\r\n        };\r\n        ExtractTasksCtrl.prototype.refreshExtractTasks = function () {\r\n            this.waitForCountOfSchedules = this.$q.defer();\r\n            this.query.refresh();\r\n        };\r\n        ExtractTasksCtrl.prototype.createEmptyTemplateModel = function (extractTasksContext) {\r\n            var emptyTemplateModel = {};\r\n            emptyTemplateModel.title = 'extractTasksEmptyMessage';\r\n            // The extract tasks grid is used in multiple locations, only show this information for data sources.\r\n            // Only data sources have a refresh mode, check that it exists.\r\n            if (this.ServerService.featureFlags().dataSyncEnabled && extractTasksContext.datasource) {\r\n                emptyTemplateModel.help = {\r\n                    links: [{\r\n                            localizedValueKey: 'remoteRefreshSchedulesEmptyHelp',\r\n                            url: this.HelpService.getDatasourceHelpUrl()\r\n                        }]\r\n                };\r\n                // Don't display the help information for OAuth connections because they can only be refreshed on server\r\n                if (extractTasksContext.datasource && !extractTasksContext.datasource.connectionOAuth) {\r\n                    emptyTemplateModel.body = [{\r\n                            statements: [\r\n                                {\r\n                                    localizedStatementKey: 'remoteRefreshSchedulesEmptyParagraph1'\r\n                                }\r\n                            ]\r\n                        }];\r\n                }\r\n            }\r\n            return emptyTemplateModel;\r\n        };\r\n        ExtractTasksCtrl.prototype.configureForReactDataGrid = function (actions) {\r\n            var _this = this;\r\n            var siteUrls = new VizPortalReact.SiteUrls({\r\n                siteUrlName: this.ServerService.sessionSiteUrlName(),\r\n                queryString: window.location.search\r\n            });\r\n            var columns = VizPortalReact.ExtractTasksGrid.columns(function (id) { return _this.$translate.instant(id); }, this.$scope, this.anyActionsAllowed(), actions, this.isServerPage(), new VizPortalReact.ServerUrls(window.location.search), siteUrls, this.$filter('scheduleFrequencyDescription'), this.showWorkbookOrDatasourceColumn(), this.showScheduleColumn(), this.showSiteColumn());\r\n            this.AngularToReactDataGridBridge.attachReactDataGridToScope(this.$scope, columns, this.createEmptyTemplateModel(this.extractTasksContext));\r\n        };\r\n        ExtractTasksCtrl.$inject = [\r\n            '$q',\r\n            '$translate',\r\n            'AngularToReactDataGridBridge',\r\n            '$filter',\r\n            '$scope',\r\n            '$state',\r\n            'BrowserTitleService',\r\n            'subplace',\r\n            'extractTasksContext',\r\n            'QueryService',\r\n            'SelectionService',\r\n            'SorterFactory',\r\n            'DeleteExtractTasksAction',\r\n            'RunExtractTasksAction',\r\n            'ChangeExtractTaskPriorityAction',\r\n            'ChangeScheduleAction',\r\n            'ChangeDatasourceRemoteRefreshPropertiesAction',\r\n            'ServerService',\r\n            'HelpService'\r\n        ];\r\n        return ExtractTasksCtrl;\r\n    })();\r\n    VizPortal.ExtractTasksCtrl = ExtractTasksCtrl;\r\n    VizPortal.Module.instance().controller('ExtractTasksCtrl', ExtractTasksCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var CreateGroupRequest = (function (_super) {\r\n            __extends(CreateGroupRequest, _super);\r\n            function CreateGroupRequest(params) {\r\n                _super.call(this, 'createGroup', params);\r\n            }\r\n            return CreateGroupRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.CreateGroupRequest = CreateGroupRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var DeleteGroupsRequest = (function (_super) {\r\n            __extends(DeleteGroupsRequest, _super);\r\n            function DeleteGroupsRequest(ids) {\r\n                _super.call(this, 'deleteGroups', { ids: ids });\r\n            }\r\n            return DeleteGroupsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.DeleteGroupsRequest = DeleteGroupsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"resourceParts.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        ServerApi.LocalGroupDomainName = 'local';\r\n        ServerApi.GroupKeys = ServerApi.NamedItemKeys;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/IGetItemsParams.ts\" />\r\n/// <reference path=\"../types/IGetItemsResult.ts\" />\r\n/// <reference path=\"../types/IGroup.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetGroupsRequest = (function (_super) {\r\n            __extends(GetGroupsRequest, _super);\r\n            function GetGroupsRequest(params) {\r\n                _super.call(this, 'getGroups', params);\r\n            }\r\n            return GetGroupsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetGroupsRequest = GetGroupsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var UpdateGroupNameRequest = (function (_super) {\r\n            __extends(UpdateGroupNameRequest, _super);\r\n            function UpdateGroupNameRequest(params) {\r\n                _super.call(this, 'updateGroupName', params);\r\n            }\r\n            return UpdateGroupNameRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.UpdateGroupNameRequest = UpdateGroupNameRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var UpdateGroupsMinimumSiteRoleRequest = (function (_super) {\r\n            __extends(UpdateGroupsMinimumSiteRoleRequest, _super);\r\n            function UpdateGroupsMinimumSiteRoleRequest(params) {\r\n                _super.call(this, 'updateGroupsMinimumSiteRole', params);\r\n            }\r\n            return UpdateGroupsMinimumSiteRoleRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.UpdateGroupsMinimumSiteRoleRequest = UpdateGroupsMinimumSiteRoleRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/RequestHelper.ts\" />\r\n/// <reference path=\"../helpers/ResultHelper.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/CreateGroupRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/DeleteGroupsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetGroupsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/UpdateGroupNameRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/UpdateGroupsMinimumSiteRoleRequest.ts\" />\r\n/// <reference path=\"../ServerApi/types/IGroup.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\n/// <reference path=\"Resource.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var Groups = (function (_super) {\r\n        __extends(Groups, _super);\r\n        function Groups(ErrorNotifyingServer, FetcherFactory) {\r\n            _super.call(this, FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetGroupsRequest, function (result) { return result.groups; }));\r\n            this.ErrorNotifyingServer = ErrorNotifyingServer;\r\n            this.server = ErrorNotifyingServer.getServerService();\r\n        }\r\n        Groups.isActiveDirectory = function (group) {\r\n            return group.domainName && group.domainName !== VizPortal.ServerApi.LocalGroupDomainName;\r\n        };\r\n        // Actions\r\n        // create new group\r\n        Groups.prototype.createGroup = function (groupName) {\r\n            var params = {\r\n                name: groupName\r\n            };\r\n            return this.ErrorNotifyingServer.sendRequestAndDelay(new VizPortal.ServerApi.CreateGroupRequest(params));\r\n        };\r\n        // delete groups\r\n        Groups.prototype.deleteGroups = function (ids) {\r\n            return this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests(ids, function (idsBlock) { return new VizPortal.ServerApi.DeleteGroupsRequest(idsBlock); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        // update group name\r\n        Groups.prototype.updateGroupName = function (groupId, name) {\r\n            var params = {\r\n                groupId: groupId,\r\n                name: name\r\n            };\r\n            return this.ErrorNotifyingServer.sendRequestAndDelay(new VizPortal.ServerApi.UpdateGroupNameRequest(params));\r\n        };\r\n        // get group details\r\n        Groups.prototype.getGroupDetails = function (groupId) {\r\n            var params = {\r\n                id: groupId\r\n            };\r\n            return this.server.sendRequest(new VizPortal.ServerApi.GetGroupDetailsRequest(params));\r\n        };\r\n        Groups.prototype.updateGroupsMinimumSiteRole = function (groupIds, siteRole) {\r\n            return this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests(groupIds, function (idsBlock) {\r\n                return new VizPortal.ServerApi.UpdateGroupsMinimumSiteRoleRequest({\r\n                    groupIds: idsBlock,\r\n                    minimumSiteRole: siteRole\r\n                });\r\n            }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        Groups.$inject = ['ErrorNotifyingServer', 'FetcherFactory'];\r\n        return Groups;\r\n    })(VizPortal.Resource);\r\n    VizPortal.Groups = Groups;\r\n    VizPortal.Module.instance().service('Groups', Groups);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/types/ISiteRole.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    // TODO: hook this up in a bunch of other places.\r\n    var SiteRoles = (function () {\r\n        function SiteRoles(serverService) {\r\n            this.serverService = serverService;\r\n        }\r\n        SiteRoles.prototype.optionsForCurrentUser = function () {\r\n            var rolesToRemoveFromList = [VizPortal.ServerApi.SiteRoles.Guest];\r\n            if (!this.serverService.isSessionServerAdmin()) {\r\n                rolesToRemoveFromList.push(VizPortal.ServerApi.SiteRoles.ServerAdministrator);\r\n            }\r\n            return _.difference(SiteRoles.All, rolesToRemoveFromList);\r\n        };\r\n        SiteRoles.All = [\r\n            VizPortal.ServerApi.SiteRoles.ServerAdministrator,\r\n            VizPortal.ServerApi.SiteRoles.SiteAdministrator,\r\n            VizPortal.ServerApi.SiteRoles.Publisher,\r\n            VizPortal.ServerApi.SiteRoles.Interactor,\r\n            VizPortal.ServerApi.SiteRoles.Viewer,\r\n            VizPortal.ServerApi.SiteRoles.Unlicensed,\r\n            VizPortal.ServerApi.SiteRoles.ViewerWithPublish,\r\n            VizPortal.ServerApi.SiteRoles.UnlicensedWithPublish,\r\n            VizPortal.ServerApi.SiteRoles.Guest\r\n        ];\r\n        SiteRoles.WithoutGuest = _.without(SiteRoles.All, VizPortal.ServerApi.SiteRoles.Guest);\r\n        SiteRoles.WithoutGuestOrServerAdmin = _.without(SiteRoles.All, VizPortal.ServerApi.SiteRoles.Guest, VizPortal.ServerApi.SiteRoles.ServerAdministrator);\r\n        SiteRoles.Mixed = 'Mixed';\r\n        SiteRoles.$inject = ['ServerService'];\r\n        return SiteRoles;\r\n    })();\r\n    VizPortal.SiteRoles = SiteRoles;\r\n    VizPortal.Module.instance().service('SiteRoles', SiteRoles);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetGroupDetailsRequest = (function (_super) {\r\n            __extends(GetGroupDetailsRequest, _super);\r\n            function GetGroupDetailsRequest(params) {\r\n                _super.call(this, 'getGroup', params);\r\n            }\r\n            return GetGroupDetailsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetGroupDetailsRequest = GetGroupDetailsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"resourceInfoParts.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"IUserInfo.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/IGetItemsParams.ts\" />\r\n/// <reference path=\"../types/IGetItemsResult.ts\" />\r\n/// <reference path=\"../types/IGroup.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var SearchActiveDirectoryGroupNameRequest = (function (_super) {\r\n            __extends(SearchActiveDirectoryGroupNameRequest, _super);\r\n            function SearchActiveDirectoryGroupNameRequest(params) {\r\n                _super.call(this, 'searchActiveDirectoryGroupName', params);\r\n            }\r\n            return SearchActiveDirectoryGroupNameRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.SearchActiveDirectoryGroupNameRequest = SearchActiveDirectoryGroupNameRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/IActionResult.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var SyncActiveDirectoryGroupRequest = (function (_super) {\r\n            __extends(SyncActiveDirectoryGroupRequest, _super);\r\n            function SyncActiveDirectoryGroupRequest(params) {\r\n                _super.call(this, 'syncActiveDirectoryGroup', params);\r\n            }\r\n            return SyncActiveDirectoryGroupRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.SyncActiveDirectoryGroupRequest = SyncActiveDirectoryGroupRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/IActionResult.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var SyncActiveDirectoryGroupsRequest = (function (_super) {\r\n            __extends(SyncActiveDirectoryGroupsRequest, _super);\r\n            function SyncActiveDirectoryGroupsRequest(groups) {\r\n                _super.call(this, 'syncActiveDirectoryGroups', { groups: groups });\r\n            }\r\n            return SyncActiveDirectoryGroupsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.SyncActiveDirectoryGroupsRequest = SyncActiveDirectoryGroupsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/SearchActiveDirectoryGroupNameRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/SyncActiveDirectoryGroupRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/SyncActiveDirectoryGroupsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/types/IGroup.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\n/// <reference path=\"Resource.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var basicGroupInfoToAdGroup = function (group) {\r\n        return {\r\n            name: group.name,\r\n            domainName: group.domainName\r\n        };\r\n    };\r\n    var ActiveDirectoryGroups = (function () {\r\n        function ActiveDirectoryGroups(ErrorNotifyingServer) {\r\n            this.ErrorNotifyingServer = ErrorNotifyingServer;\r\n        }\r\n        // search for active directory groups\r\n        ActiveDirectoryGroups.prototype.searchActiveDirectoryGroupName = function (searchInputText) {\r\n            var request = new VizPortal.ServerApi.SearchActiveDirectoryGroupNameRequest({ name: searchInputText });\r\n            return this.ErrorNotifyingServer.sendRequest(request);\r\n        };\r\n        // synchronize a group, if the group does not exist then it will be added\r\n        ActiveDirectoryGroups.prototype.syncAdGroup = function (groupName, groupDomainName, siteRole) {\r\n            var request = new VizPortal.ServerApi.SyncActiveDirectoryGroupRequest({\r\n                name: groupName,\r\n                domainName: groupDomainName,\r\n                siteRole: siteRole\r\n            });\r\n            return this.ErrorNotifyingServer.sendRequest(request);\r\n        };\r\n        // synchronize groups\r\n        ActiveDirectoryGroups.prototype.syncAdGroups = function (groups) {\r\n            var adGroups = _.map(groups, basicGroupInfoToAdGroup);\r\n            var request = new VizPortal.ServerApi.SyncActiveDirectoryGroupsRequest(adGroups);\r\n            return this.ErrorNotifyingServer.sendRequest(request);\r\n        };\r\n        ActiveDirectoryGroups.$inject = ['ErrorNotifyingServer'];\r\n        return ActiveDirectoryGroups;\r\n    })();\r\n    VizPortal.ActiveDirectoryGroups = ActiveDirectoryGroups;\r\n    VizPortal.Module.instance().service('ActiveDirectoryGroups', ActiveDirectoryGroups);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../resources/ActiveDirectoryGroups.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.SyncGroupEvent = {\r\n        groupSynced: \"groupSynced\"\r\n    };\r\n    var ActiveDirectoryGroupAction = (function () {\r\n        function ActiveDirectoryGroupAction($timeout, $translate, $q, ActiveDirectoryGroups, ConfirmActionDialog, longRunningActionService, toaster) {\r\n            this.$timeout = $timeout;\r\n            this.$translate = $translate;\r\n            this.$q = $q;\r\n            this.ActiveDirectoryGroups = ActiveDirectoryGroups;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.longRunningActionService = longRunningActionService;\r\n            this.toaster = toaster;\r\n        }\r\n        ActiveDirectoryGroupAction.prototype.showSyncAdGroupDialog = function (group, scope) {\r\n            var _this = this;\r\n            var dialogScope = scope.$new();\r\n            dialogScope.group = {\r\n                model: group\r\n            };\r\n            var dialogBody = this.$translate.instant('confirmSyncAdGroup', { GROUP_NAME: VizPortal.L10n.elideIfLong(group.name) });\r\n            var dialogInstance = this.ConfirmActionDialog.open({\r\n                scope: dialogScope,\r\n                title: this.$translate.instant('synchronize'),\r\n                bodyText: dialogBody,\r\n                actionName: this.$translate.instant('synchronize'),\r\n                action: function () { return _this.ActiveDirectoryGroups.syncAdGroup(group.name, group.domainName); }\r\n            });\r\n            return dialogInstance.result\r\n                .then(VizPortal.ResultHelper.rejectResultOnError(this.$q))\r\n                .then(function (result) {\r\n                // notification\r\n                _this.toaster.pop({\r\n                    type: VizPortal.ToastType.Info,\r\n                    text: _this.$translate.instant('syncAdGroupSubmitted', { GROUP_NAME: VizPortal.L10n.elideIfLong(dialogScope.group.model.name) })\r\n                });\r\n                return result;\r\n            })\r\n                .then(this.longRunningActionService\r\n                .startProgressTrackingForResponse())\r\n                .then(this.longRunningActionService.delayResultForSolr())\r\n                .then(this.handleSyncCompleteFor(dialogScope, ActiveDirectoryGroupAction.Mode.sync))\r\n                .fail(this.handleSyncErrorResultFor(dialogScope, ActiveDirectoryGroupAction.Mode.sync))\r\n                .fin(function () { return dialogScope.$destroy(); });\r\n        };\r\n        ActiveDirectoryGroupAction.prototype.showSyncAdGroupsDialog = function (selectedGroups, scope) {\r\n            var _this = this;\r\n            var groups = _.filter(selectedGroups, VizPortal.Groups.isActiveDirectory);\r\n            if (groups.length === 0) {\r\n                // No active directory groups were selected, display an error message\r\n                return this.ConfirmActionDialog.open({\r\n                    scope: scope,\r\n                    title: this.$translate.instant('synchronize'),\r\n                    bodyText: this.$translate.instant('syncAdGroupsNoGroups')\r\n                }).result;\r\n            }\r\n            else if (groups.length === 1) {\r\n                // Only 1 active directory group was selected, use the single single AD dialog\r\n                return this.showSyncAdGroupDialog(groups[0], scope);\r\n            }\r\n            else {\r\n                var dialogInstance = this.ConfirmActionDialog.open({\r\n                    scope: scope,\r\n                    title: this.$translate.instant('synchronize'),\r\n                    bodyText: this.$translate.instant('confirmSyncAdGroups', { GROUP_COUNT: groups.length }, VizPortal.L10n.Interpolations.Count),\r\n                    actionName: this.$translate.instant('synchronizeConfirm', { COUNT: groups.length }, VizPortal.L10n.Interpolations.Count),\r\n                    action: function () {\r\n                        var responsePromise = _this.ActiveDirectoryGroups.syncAdGroups(groups);\r\n                        // Display results\r\n                        responsePromise.then(VizPortal.ResultHelper.rejectResultOnError(_this.$q))\r\n                            .then(function (result) {\r\n                            var successMessage = _this.$translate.instant('syncAdGroupsSubmitted', { GROUP_COUNT: groups.length }, VizPortal.L10n.Interpolations.Count);\r\n                            _this.toaster.pop({ type: VizPortal.ToastType.Info, text: successMessage });\r\n                            return result;\r\n                        })\r\n                            .fail(function (result) {\r\n                            var errorMessage = _this.$translate.instant('syncAdGroupsError', { GROUP_COUNT: groups.length }, VizPortal.L10n.Interpolations.Count);\r\n                            _this.toaster.pop({ type: VizPortal.ToastType.Error, text: errorMessage });\r\n                        });\r\n                        return responsePromise;\r\n                    }\r\n                });\r\n                return dialogInstance.result;\r\n            }\r\n        };\r\n        ActiveDirectoryGroupAction.prototype.showAddAdGroupDialog = function (scope) {\r\n            var _this = this;\r\n            var dialogScope = scope.$new();\r\n            dialogScope.group = {};\r\n            var dialogInstance = this.ConfirmActionDialog.open({\r\n                scope: dialogScope,\r\n                title: this.$translate.instant('addUsersImportAdGroupTitle'),\r\n                bodyTemplateUrl: 'addActiveDirectoryGroupDialog.html',\r\n                actionName: this.$translate.instant('addUsersImportAdGroupSubmit'),\r\n                action: function () {\r\n                    var group = dialogScope.group.model;\r\n                    var siteRole = dialogScope.group.siteRole || VizPortal.ServerApi.SiteRoles.Unlicensed;\r\n                    return _this.ActiveDirectoryGroups.syncAdGroup(group.name, group.domainName, siteRole);\r\n                },\r\n                position: { reserveHeight: 450 },\r\n                size: VizPortal.ModalSize.fitToContent,\r\n                confirmDisabled: function () { return !dialogScope.group.model || !dialogScope.group.siteRole; } // TODO: Replace with form validation\r\n            });\r\n            return dialogInstance.result\r\n                .then(VizPortal.ResultHelper.rejectResultOnError(this.$q))\r\n                .then(function (result) {\r\n                _this.toaster.pop({\r\n                    type: VizPortal.ToastType.Info,\r\n                    text: _this.$translate.instant('addAdGroupSubmitted', { GROUP_NAME: VizPortal.L10n.elideIfLong(dialogScope.group.model.name) })\r\n                });\r\n                return result;\r\n            })\r\n                .then(this.longRunningActionService\r\n                .startProgressTrackingForResponse())\r\n                .then(this.longRunningActionService.delayResultForSolr())\r\n                .then(this.handleSyncCompleteFor(dialogScope, ActiveDirectoryGroupAction.Mode.add))\r\n                .fail(this.handleSyncErrorResultFor(dialogScope, ActiveDirectoryGroupAction.Mode.add))\r\n                .fin(function () { return dialogScope.$destroy(); });\r\n        };\r\n        ActiveDirectoryGroupAction.prototype.handleSyncErrorResultFor = function (scope, actionType) {\r\n            var _this = this;\r\n            return function (result) {\r\n                if (!result || !result.errors)\r\n                    return; // Must have failed for some reason with out an error code, like cancel\r\n                var group = scope.group.model;\r\n                var errorStringArgs = {\r\n                    GROUP_NAME: VizPortal.L10n.elideIfLong(group.name),\r\n                    DOMAIN_NAME: VizPortal.L10n.elideIfLong(group.domainName)\r\n                };\r\n                if (result.errors[0].code === VizPortal.CommonErrorCode.AdGroupNotFound) {\r\n                    // ad group not found is the only thing we expect to handle at the moment\r\n                    _this.toaster.pop({ type: VizPortal.ToastType.Error, text: _this.$translate.instant('errorActiveDirectoryGroupNotFound', errorStringArgs) });\r\n                }\r\n                else {\r\n                    _this.toaster.pop({ type: VizPortal.ToastType.Error, text: _this.$translate.instant(actionType + 'AdGroupError', errorStringArgs) });\r\n                }\r\n                return result; // For chaining\r\n            };\r\n        };\r\n        ActiveDirectoryGroupAction.prototype.handleSyncCompleteFor = function (scope, actionType) {\r\n            var _this = this;\r\n            return function (result) {\r\n                // Add a delay to allow solr to index\r\n                scope.$emit(VizPortal.SyncGroupEvent.groupSynced);\r\n                // Create success messages\r\n                var completeMessageStringArgs = {\r\n                    GROUP_NAME: VizPortal.L10n.elideIfLong(scope.group.model.name),\r\n                    DOMAIN_NAME: VizPortal.L10n.elideIfLong(scope.group.model.domainName)\r\n                };\r\n                var successLines = [\r\n                    _this.$translate.instant(actionType + 'AdGroupSuccess', completeMessageStringArgs),\r\n                    _this.$translate.instant('syncAdGroupSuccessSummary', {\r\n                        NUM_ADDED: result.usersAddedToGroup || 0,\r\n                        NUM_REMOVED: result.usersRemovedFromGroup || 0\r\n                    }, VizPortal.L10n.Interpolations.Count)\r\n                ];\r\n                if (result.usersAddedToSite > 0) {\r\n                    successLines.push(_this.$translate.instant('syncAdGroupSuccessNumAddedToSite', { NUM_ADDED: result.usersAddedToSite }, VizPortal.L10n.Interpolations.Count));\r\n                }\r\n                if (result.usersSiteRoleUpdated > 0) {\r\n                    successLines.push(_this.$translate.instant('syncAdGroupSuccessNumSiteRoleUpdated', { NUM_UPDATED: result.usersSiteRoleUpdated }, VizPortal.L10n.Interpolations.Count));\r\n                }\r\n                _this.toaster.pop({\r\n                    type: VizPortal.ToastType.Info,\r\n                    text: successLines.join('\\n'),\r\n                    timeout: VizPortal.ToasterService.NoTimeout\r\n                });\r\n                // Create error messages\r\n                var errorLines = [\r\n                    _this.$translate.instant(actionType + 'AdGroupError', completeMessageStringArgs)\r\n                ];\r\n                if (result.usersWithInsufficientLicenses > 0) {\r\n                    errorLines.push(_this.$translate.instant('syncAdGroupErrorInsufficientLicenses', { COUNT: result.usersWithInsufficientLicenses }, VizPortal.L10n.Interpolations.Count));\r\n                }\r\n                if (result.usersSkipped > 0) {\r\n                    errorLines.push(_this.$translate.instant('syncAdGroupErrorNumUsersSkipped', { COUNT: result.usersWithInsufficientLicenses }, VizPortal.L10n.Interpolations.Count));\r\n                }\r\n                if (errorLines.length > 1) {\r\n                    _this.toaster.pop({ type: VizPortal.ToastType.Error, text: errorLines.join('\\n') });\r\n                }\r\n                return result; // For Chaining\r\n            };\r\n        };\r\n        ActiveDirectoryGroupAction.$inject = ['$timeout',\r\n            '$translate',\r\n            '$q',\r\n            'ActiveDirectoryGroups',\r\n            'ConfirmActionDialog',\r\n            'LongRunningActionService',\r\n            'ToasterService'];\r\n        // Used for proper translations\r\n        ActiveDirectoryGroupAction.Mode = {\r\n            add: 'add',\r\n            sync: 'sync'\r\n        };\r\n        return ActiveDirectoryGroupAction;\r\n    })();\r\n    VizPortal.ActiveDirectoryGroupAction = ActiveDirectoryGroupAction;\r\n    VizPortal.Module.instance().service('ActiveDirectoryGroupAction', ActiveDirectoryGroupAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var UpdateGroupsMinimumSiteRoleAction = (function () {\r\n        function UpdateGroupsMinimumSiteRoleAction($translate, $q, $filter, Groups, toaster, confirmActionDialog) {\r\n            this.$translate = $translate;\r\n            this.$q = $q;\r\n            this.$filter = $filter;\r\n            this.Groups = Groups;\r\n            this.toaster = toaster;\r\n            this.confirmActionDialog = confirmActionDialog;\r\n        }\r\n        UpdateGroupsMinimumSiteRoleAction.prototype.executeInPlace = function (group, siteRole) {\r\n            var _this = this;\r\n            var groupSet = VizPortal.Set.fromIdItemArray([group]);\r\n            return this.Groups.updateGroupsMinimumSiteRole([group.id], siteRole)\r\n                .then(VizPortal.ResultHelper.rejectResultOnError(this.$q))\r\n                .then(function () { return _this.handleSuccessResult(groupSet, siteRole); })\r\n                .fail(function (result) { return _this.handleErrorResult(groupSet, siteRole, result); });\r\n        };\r\n        UpdateGroupsMinimumSiteRoleAction.prototype.showUpdateGroupsMinimumSiteRoleDialog = function (groupsToSet, context) {\r\n            var _this = this;\r\n            var groupsOnlyAD = groupsToSet.filter(VizPortal.Groups.isActiveDirectory);\r\n            if (groupsOnlyAD.size() === 0) {\r\n                // No active directory groups were selected, display an error message\r\n                return this.confirmActionDialog.open({\r\n                    scope: context.scope,\r\n                    title: this.$translate.instant('minimumSiteRole'),\r\n                    bodyText: this.$translate.instant('minimumSiteRoleNoADGroups')\r\n                }).result;\r\n            }\r\n            var dialogScope = context.scope.$new();\r\n            dialogScope.siteRole = (groupsOnlyAD.size() === 1) ? groupsOnlyAD.first().minimumSiteRole : VizPortal.ServerApi.SiteRoles.Unlicensed;\r\n            dialogScope.siteRoleOptions = VizPortal.SiteRoles.WithoutGuestOrServerAdmin;\r\n            dialogScope.setSiteRole = function (role) {\r\n                dialogScope.siteRole = role;\r\n            };\r\n            dialogScope.description = this.$translate.instant('confirmSetGroupsMinimumSiteRoleDesc', {\r\n                GROUP_NAME: VizPortal.L10n.elideIfLong(groupsOnlyAD.first().name),\r\n                GROUP_COUNT: groupsOnlyAD.size()\r\n            }, VizPortal.L10n.Interpolations.Count);\r\n            var dialogInstance = this.confirmActionDialog.open({\r\n                title: this.$translate.instant('confirmSetGroupsMinimumSiteRoleTitle'),\r\n                bodyTemplateUrl: 'confirmActionDialogInputRole.html',\r\n                scope: dialogScope,\r\n                confirmDisabled: function () { return false; },\r\n                actionName: this.$translate.instant('confirmSetGroupsMinimumSiteRoleButton', {\r\n                    ITEM_COUNT: groupsOnlyAD.size()\r\n                }, VizPortal.L10n.Interpolations.Count),\r\n                action: function (dialogInstance) { return _this.setGroupsSiteRoles(groupsOnlyAD, dialogScope.siteRole); }\r\n            });\r\n            dialogInstance.result.fin(function () { return dialogScope.$destroy(); });\r\n            return dialogInstance.result;\r\n        };\r\n        UpdateGroupsMinimumSiteRoleAction.prototype.setGroupsSiteRoles = function (selectedGroups, siteRole) {\r\n            var _this = this;\r\n            var groups = _.map(selectedGroups.toArray(), function (group) { return group.id; });\r\n            return this.Groups.updateGroupsMinimumSiteRole(groups, siteRole)\r\n                .then(VizPortal.ResultHelper.rejectResultOnError(this.$q))\r\n                .then(function () { return _this.handleSuccessResult(selectedGroups, siteRole); })\r\n                .fail(function (result) { return _this.handleErrorResult(selectedGroups, siteRole, result); });\r\n        };\r\n        UpdateGroupsMinimumSiteRoleAction.prototype.handleSuccessResult = function (groups, siteRole) {\r\n            this.toaster.pop({\r\n                type: VizPortal.ToastType.Info,\r\n                text: this.$translate.instant('updateGroupsMinimumSiteRoleSuccess', {\r\n                    GROUP_NAME: VizPortal.L10n.elideIfLong(groups.first().name),\r\n                    COUNT: groups.size(),\r\n                    SITE_ROLE: this.$filter('siteRole')(siteRole)\r\n                }, VizPortal.L10n.Interpolations.Count)\r\n            });\r\n        };\r\n        UpdateGroupsMinimumSiteRoleAction.prototype.handleErrorResult = function (groups, siteRole, result) {\r\n            this.toaster.pop({\r\n                type: VizPortal.ToastType.Error,\r\n                text: this.$translate.instant('updateGroupsMinimumSiteRoleError', {\r\n                    GROUP_NAME: VizPortal.L10n.elideIfLong(groups.first().name),\r\n                    COUNT: groups.size(),\r\n                    SITE_ROLE: this.$filter('siteRole')(siteRole)\r\n                }, VizPortal.L10n.Interpolations.Count)\r\n            });\r\n            return this.$q.reject(result); // for chaining errors\r\n        };\r\n        UpdateGroupsMinimumSiteRoleAction.$inject = [\r\n            '$translate',\r\n            '$q',\r\n            '$filter',\r\n            'Groups',\r\n            'ToasterService',\r\n            'ConfirmActionDialog'\r\n        ];\r\n        return UpdateGroupsMinimumSiteRoleAction;\r\n    })();\r\n    VizPortal.UpdateGroupsMinimumSiteRoleAction = UpdateGroupsMinimumSiteRoleAction;\r\n    VizPortal.Module.instance().service('UpdateGroupsMinimumSiteRoleAction', UpdateGroupsMinimumSiteRoleAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../../ts/libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var CheckboxState = (function () {\r\n        function CheckboxState() {\r\n        }\r\n        CheckboxState.toggle = function (checkboxState) {\r\n            // toggle:\r\n            // mixed   => checked\r\n            // checked => empty\r\n            // empty   => checked\r\n            switch (checkboxState) {\r\n                case CheckboxState.checked: {\r\n                    return CheckboxState.empty;\r\n                }\r\n                default: {\r\n                    return CheckboxState.checked;\r\n                }\r\n            }\r\n        };\r\n        CheckboxState.checked = 'checked';\r\n        CheckboxState.mixed = 'mixed';\r\n        CheckboxState.empty = 'empty';\r\n        return CheckboxState;\r\n    })();\r\n    VizPortal.CheckboxState = CheckboxState;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var ImportExternalSiteUsersRequest = (function (_super) {\r\n            __extends(ImportExternalSiteUsersRequest, _super);\r\n            function ImportExternalSiteUsersRequest(params) {\r\n                _super.call(this, 'importExternalUsers', params);\r\n            }\r\n            return ImportExternalSiteUsersRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.ImportExternalSiteUsersRequest = ImportExternalSiteUsersRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var ImportThirdPartySiteUsersRequest = (function (_super) {\r\n            __extends(ImportThirdPartySiteUsersRequest, _super);\r\n            function ImportThirdPartySiteUsersRequest(params) {\r\n                _super.call(this, 'importThirdPartyUsers', params);\r\n            }\r\n            return ImportThirdPartySiteUsersRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.ImportThirdPartySiteUsersRequest = ImportThirdPartySiteUsersRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var AddUsersToSiteRequest = (function (_super) {\r\n            __extends(AddUsersToSiteRequest, _super);\r\n            function AddUsersToSiteRequest(usernames, siteRole) {\r\n                _super.call(this, 'addUsersToSite', { usernames: usernames, siteRole: siteRole });\r\n            }\r\n            return AddUsersToSiteRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.AddUsersToSiteRequest = AddUsersToSiteRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var CreateLocalUserRequest = (function (_super) {\r\n            __extends(CreateLocalUserRequest, _super);\r\n            function CreateLocalUserRequest(params) {\r\n                _super.call(this, 'createLocalUser', params);\r\n            }\r\n            return CreateLocalUserRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.CreateLocalUserRequest = CreateLocalUserRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var DeleteUsersRequest = (function (_super) {\r\n            __extends(DeleteUsersRequest, _super);\r\n            function DeleteUsersRequest(ids) {\r\n                _super.call(this, 'deleteUsers', { ids: ids });\r\n            }\r\n            return DeleteUsersRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.DeleteUsersRequest = DeleteUsersRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetRemainingUserQuotaRequest = (function (_super) {\r\n            __extends(GetRemainingUserQuotaRequest, _super);\r\n            function GetRemainingUserQuotaRequest() {\r\n                _super.call(this, 'getRemainingUserQuota', {});\r\n            }\r\n            return GetRemainingUserQuotaRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetRemainingUserQuotaRequest = GetRemainingUserQuotaRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"IUser.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        ServerApi.SiteUserAuthSetting = {\r\n            Saml: 'SAML',\r\n            Default: 'DEFAULT'\r\n        };\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../requests/Request.ts\" />\r\n/// <reference path=\"../types/IGetItemsParams.ts\" />\r\n/// <reference path=\"../types/IGetItemsResult.ts\" />\r\n/// <reference path=\"../types/ISiteUser.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetSiteUsersRequest = (function (_super) {\r\n            __extends(GetSiteUsersRequest, _super);\r\n            function GetSiteUsersRequest(params) {\r\n                _super.call(this, 'getSiteUsers', params);\r\n            }\r\n            return GetSiteUsersRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetSiteUsersRequest = GetSiteUsersRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var ImportSiteUsersFromActiveDirectoryRequest = (function (_super) {\r\n            __extends(ImportSiteUsersFromActiveDirectoryRequest, _super);\r\n            function ImportSiteUsersFromActiveDirectoryRequest(params) {\r\n                _super.call(this, 'importUsersFromActiveDirectory', params);\r\n            }\r\n            return ImportSiteUsersFromActiveDirectoryRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.ImportSiteUsersFromActiveDirectoryRequest = ImportSiteUsersFromActiveDirectoryRequest;\r\n        var ImportServerUsersFromActiveDirectoryRequest = (function (_super) {\r\n            __extends(ImportServerUsersFromActiveDirectoryRequest, _super);\r\n            function ImportServerUsersFromActiveDirectoryRequest(params) {\r\n                _super.call(this, 'importServerUsersFromActiveDirectory', params);\r\n            }\r\n            return ImportServerUsersFromActiveDirectoryRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.ImportServerUsersFromActiveDirectoryRequest = ImportServerUsersFromActiveDirectoryRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var UpdateUsersAdminStatusRequest = (function (_super) {\r\n            __extends(UpdateUsersAdminStatusRequest, _super);\r\n            function UpdateUsersAdminStatusRequest(params) {\r\n                _super.call(this, 'updateUsersAdminStatus', params);\r\n            }\r\n            return UpdateUsersAdminStatusRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.UpdateUsersAdminStatusRequest = UpdateUsersAdminStatusRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var UpdateUsersGroupMembershipRequest = (function (_super) {\r\n            __extends(UpdateUsersGroupMembershipRequest, _super);\r\n            function UpdateUsersGroupMembershipRequest(params) {\r\n                _super.call(this, 'updateUsersGroupMembership', params);\r\n            }\r\n            return UpdateUsersGroupMembershipRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.UpdateUsersGroupMembershipRequest = UpdateUsersGroupMembershipRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var UpdateUsersSiteRoleRequest = (function (_super) {\r\n            __extends(UpdateUsersSiteRoleRequest, _super);\r\n            function UpdateUsersSiteRoleRequest(params) {\r\n                _super.call(this, 'updateUsersSiteRole', params);\r\n            }\r\n            return UpdateUsersSiteRoleRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.UpdateUsersSiteRoleRequest = UpdateUsersSiteRoleRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/RequestHelper.ts\" />\r\n/// <reference path=\"../helpers/ResultHelper.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/ImportExternalUsers.ts\" />\r\n/// <reference path=\"../ServerApi/requests/ImportThirdPartySiteUsers.ts\" />\r\n/// <reference path=\"../ServerApi/requests/AddUsersToSiteRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/CreateLocalUserRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/DeleteUsersRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetRemainingUserQuotaRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetSiteUsersRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/ImportUsersFromActiveDirectoryRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/UpdateUsersAdminStatusRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/UpdateUsersGroupMembershipRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/UpdateUsersSiteRoleRequest.ts\" />\r\n/// <reference path=\"../ServerApi/types/ISiteUser.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\n/// <reference path=\"Resource.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SiteUsers = (function (_super) {\r\n        __extends(SiteUsers, _super);\r\n        function SiteUsers(ErrorNotifyingServer, FetcherFactory, $q) {\r\n            _super.call(this, FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetSiteUsersRequest, function (result) { return result.users; }));\r\n            this.ErrorNotifyingServer = ErrorNotifyingServer;\r\n            this.$q = $q;\r\n            this.server = ErrorNotifyingServer.getServerService();\r\n        }\r\n        // gets the user with the specified username & domainName.\r\n        SiteUsers.prototype.getUserByUsernameAndDomain = function (username, domainName) {\r\n            return this.all()\r\n                .addFilter(VizPortal.Filter.stringFieldEq('username', username))\r\n                .addFilter(VizPortal.Filter.stringFieldEq('domainName', domainName))\r\n                .getFirst();\r\n        };\r\n        // group membership - remove only\r\n        SiteUsers.prototype.removeFromGroups = function (userIds, groupIds) {\r\n            return this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests2(userIds, groupIds, function (userIdsBlock, groupIdsBlock) { return new VizPortal.ServerApi.UpdateUsersGroupMembershipRequest({\r\n                userIds: userIdsBlock,\r\n                addToGroupIds: [],\r\n                removeFromGroupIds: groupIdsBlock\r\n            }); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        SiteUsers.prototype.getUserCountsBySiteRole = function (baseQuery) {\r\n            // remove any existing site role filter\r\n            var filtersWithoutSiteRole = _.filter(baseQuery.getFilters(), function (filter) {\r\n                return !(filter.field && filter.field === VizPortal.ServerApi.FilterFieldNames.siteRole);\r\n            });\r\n            var modifiedQuery = baseQuery.withFilters(filtersWithoutSiteRole);\r\n            var counts = {};\r\n            var promises = _.map(VizPortal.SiteRoles.WithoutGuest, function (siteRole) {\r\n                return modifiedQuery\r\n                    .addFilter(VizPortal.Filter.stringFieldEq(VizPortal.ServerApi.FilterFieldNames.siteRole, siteRole))\r\n                    .getCount()\r\n                    .then(function (totalCount) {\r\n                    counts[siteRole] = totalCount;\r\n                });\r\n            });\r\n            //Any site role\r\n            promises.push(modifiedQuery.getCount().then(function (totalCount) { counts['Any'] = totalCount; }));\r\n            return this.$q.all(promises).then(function () { return counts; });\r\n        };\r\n        // group membership - add only\r\n        SiteUsers.prototype.addToGroups = function (userIds, groupIds) {\r\n            return this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests2(userIds, groupIds, function (userIdsBlock, groupIdsBlock) { return new VizPortal.ServerApi.UpdateUsersGroupMembershipRequest({\r\n                userIds: userIdsBlock,\r\n                addToGroupIds: groupIdsBlock,\r\n                removeFromGroupIds: []\r\n            }); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        // group membership - add and remove\r\n        SiteUsers.prototype.updateUsersGroupMembership = function (userIds, addToGroupIds, removeFromGroupIds) {\r\n            return this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests3(userIds, addToGroupIds, removeFromGroupIds, function (userIdsBlock, addToGroupIdsBlock, removeFromGroupIdsBlock) { return new VizPortal.ServerApi.UpdateUsersGroupMembershipRequest({\r\n                userIds: userIdsBlock,\r\n                addToGroupIds: addToGroupIdsBlock,\r\n                removeFromGroupIds: removeFromGroupIdsBlock\r\n            }); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        // creates a local user\r\n        SiteUsers.prototype.createLocalUser = function (username, displayName, email, password, admin, siteRole) {\r\n            var _this = this;\r\n            return this.server.sendRequest(new VizPortal.ServerApi.GeneratePublicKeyRequest()).\r\n                then(function (generatePublicKeyResult) {\r\n                var key = generatePublicKeyResult.key;\r\n                var keyId = generatePublicKeyResult.keyId;\r\n                var encryptedPassword = rsa.encrypt(password, key);\r\n                var createLocalUserRequest = new VizPortal.ServerApi.CreateLocalUserRequest({\r\n                    username: username,\r\n                    displayName: displayName,\r\n                    email: email,\r\n                    encryptedPassword: encryptedPassword,\r\n                    keyId: keyId,\r\n                    admin: admin,\r\n                    siteRole: siteRole\r\n                });\r\n                return _this.ErrorNotifyingServer.sendRequestAndDelay(createLocalUserRequest);\r\n            });\r\n        };\r\n        // adds users to this site\r\n        SiteUsers.prototype.addUsersToSite = function (usernames, siteRole) {\r\n            return this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests(usernames, function (usernamesBlock) { return new VizPortal.ServerApi.AddUsersToSiteRequest(usernamesBlock, siteRole); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        // delete users from this site\r\n        SiteUsers.prototype.deleteUsers = function (userIds) {\r\n            return this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests(userIds, function (userIdsBlock) { return new VizPortal.ServerApi.DeleteUsersRequest(userIdsBlock); }), VizPortal.ResultHelper.combineUserResults);\r\n        };\r\n        // imports users from active directory to this site\r\n        SiteUsers.prototype.importUsersFromActiveDirectory = function (userIds, siteRole, serverAdmin) {\r\n            if (serverAdmin === void 0) { serverAdmin = false; }\r\n            var requestBuilder;\r\n            if (serverAdmin) {\r\n                requestBuilder = function (userIdsBlock) { return new VizPortal.ServerApi.ImportSiteUsersFromActiveDirectoryRequest({ usernames: userIdsBlock, admin: true }); };\r\n            }\r\n            else {\r\n                requestBuilder = function (userIdsBlock) { return new VizPortal.ServerApi.ImportSiteUsersFromActiveDirectoryRequest({ usernames: userIdsBlock, siteRole: siteRole }); };\r\n            }\r\n            return this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests(userIds, requestBuilder), VizPortal.ResultHelper.combineUserResults);\r\n        };\r\n        SiteUsers.prototype.importExternalUsers = function (emails, siteRole) {\r\n            return this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests(emails, function (emailsBlock) { return new VizPortal.ServerApi.ImportExternalSiteUsersRequest({\r\n                emailAddresses: emailsBlock,\r\n                siteRole: siteRole\r\n            }); }), VizPortal.ResultHelper.combineImportUserResults);\r\n        };\r\n        SiteUsers.prototype.importThirdPartyUsers = function (emails, siteRole) {\r\n            return this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests(emails, function (emailsBlock) { return new VizPortal.ServerApi.ImportThirdPartySiteUsersRequest({\r\n                emailAddresses: emailsBlock,\r\n                siteRole: siteRole\r\n            }); }), VizPortal.ResultHelper.combineImportUserResults);\r\n        };\r\n        // updates users site role for this site\r\n        SiteUsers.prototype.updateUsersSiteRole = function (userIds, siteRole) {\r\n            return this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests(userIds, function (userIdsBlock) { return new VizPortal.ServerApi.UpdateUsersSiteRoleRequest({\r\n                userIds: userIdsBlock,\r\n                siteRole: siteRole\r\n            }); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        // site membership - change these users' server admin status. Includes SOLR delay.\r\n        SiteUsers.prototype.updateServerAdminStatusAndDelay = function (userIds, admin) {\r\n            return this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests(userIds, function (userIdsBlock) { return new VizPortal.ServerApi.UpdateUsersAdminStatusRequest({\r\n                userIds: userIdsBlock,\r\n                admin: admin\r\n            }); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        // site membership - change these users' server admin status. No SOLR delay.\r\n        SiteUsers.prototype.updateServerAdminStatusNoDelay = function (userIds, admin) {\r\n            return this.ErrorNotifyingServer.sendRequests(VizPortal.RequestHelper.buildRequests(userIds, function (userIdsBlock) { return new VizPortal.ServerApi.UpdateUsersAdminStatusRequest({\r\n                userIds: userIdsBlock,\r\n                admin: admin\r\n            }); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        SiteUsers.prototype.getRemainingUserQuota = function () {\r\n            return this.server.sendRequest(new VizPortal.ServerApi.GetRemainingUserQuotaRequest())\r\n                .then(function (result) { return result.usersRemaining; });\r\n        };\r\n        SiteUsers.$inject = ['ErrorNotifyingServer', 'FetcherFactory', '$q'];\r\n        return SiteUsers;\r\n    })(VizPortal.Resource);\r\n    VizPortal.SiteUsers = SiteUsers;\r\n    VizPortal.Module.instance().service('SiteUsers', SiteUsers);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/IGroup.ts\" />\r\n/// <reference path=\"../types/IGroupMember.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetUsersGroupMembershipRequest = (function (_super) {\r\n            __extends(GetUsersGroupMembershipRequest, _super);\r\n            function GetUsersGroupMembershipRequest(params) {\r\n                _super.call(this, 'getUsersGroupMembership', params);\r\n            }\r\n            return GetUsersGroupMembershipRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetUsersGroupMembershipRequest = GetUsersGroupMembershipRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../fetchers/ListResult.ts\" />\r\n/// <reference path=\"../models/ISliceable.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SliceableFactory = (function () {\r\n        function SliceableFactory($q) {\r\n            this.$q = $q;\r\n        }\r\n        SliceableFactory.prototype.fromArray = function (list) {\r\n            var _this = this;\r\n            if (list === void 0) { list = []; }\r\n            return {\r\n                getSlice: function (start, size) {\r\n                    var slice = list.slice(start, start + size);\r\n                    return _this.$q.when(new VizPortal.ListResult(slice, start, list.length));\r\n                }\r\n            };\r\n        };\r\n        SliceableFactory.prototype.searchArray = function (searchFilterFn, listPromise) {\r\n            var _this = this;\r\n            var list;\r\n            return function (search) {\r\n                var filteredSliceable;\r\n                var createFilteredSliceable = function () {\r\n                    var filteredList = _.filter(list, function (item) { return searchFilterFn(item, search); });\r\n                    // Angular tries to optimize ng-repeats by adding a \"$$hashKey property to objects to prevent re-rendering\r\n                    // items in a list that have not changed.  This breaks the tbTypeaheadFormat directive that relies on re-rendering\r\n                    // each item in the list so we need to pass in \"fresh\" models every time the search changes.\r\n                    filteredList = _.map(filteredList, _.clone);\r\n                    filteredSliceable = _this.fromArray(filteredList);\r\n                };\r\n                createFilteredSliceable();\r\n                return {\r\n                    getSlice: function (start, size) {\r\n                        if (list)\r\n                            return filteredSliceable.getSlice(start, size);\r\n                        return listPromise.then(function (newList) {\r\n                            list = newList;\r\n                            createFilteredSliceable();\r\n                            return filteredSliceable.getSlice(start, size);\r\n                        });\r\n                    }\r\n                };\r\n            };\r\n        };\r\n        SliceableFactory.$inject = ['$q'];\r\n        return SliceableFactory;\r\n    })();\r\n    VizPortal.SliceableFactory = SliceableFactory;\r\n    VizPortal.Module.instance().service('SliceableFactory', SliceableFactory);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"ContentActionNotification.ts\" />\r\n/// <reference path=\"../ServerApi/types/IUserActionResult.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var UserActionNotification = (function () {\r\n        function UserActionNotification($translate, toaster) {\r\n            this.$translate = $translate;\r\n            this.toaster = toaster;\r\n        }\r\n        UserActionNotification.prototype.notify = function (params) {\r\n            var _this = this;\r\n            _.defaults(params, {\r\n                results: [],\r\n                errors: []\r\n            });\r\n            this.notifyErrors(params);\r\n            // handle results (successes & partial successes)\r\n            var errorsByUserId = _.groupBy(params.errors, 'id');\r\n            var usersMappedByResults = this.getUsersByResultMap(params.users, params.results, params.successCode, errorsByUserId);\r\n            _.each(usersMappedByResults, function (usersForResult, resultCode) {\r\n                var toastType = (resultCode === params.successCode)\r\n                    ? VizPortal.ToastType.Info\r\n                    : VizPortal.ToastType.Error;\r\n                // TODO: refactor getUsersByResultMap() to make this not necessary.\r\n                var users = _.unique(usersForResult);\r\n                var msg = (users.length > 1)\r\n                    ? _this.multiResultMessageFor(resultCode, users.length)\r\n                    : _this.resultMessageFor(resultCode, nameFor(users[0], _this.$translate));\r\n                _this.toaster.pop({ type: toastType, text: msg });\r\n            });\r\n        };\r\n        UserActionNotification.prototype.notifyErrors = function (params) {\r\n            var _this = this;\r\n            _.defaults(params, {\r\n                errors: []\r\n            });\r\n            // handle errors (failures)\r\n            if (params.errors.length > 0) {\r\n                _.each(params.errors, function (error) {\r\n                    var user = params.users.get(error.id);\r\n                    var nameForMsg = (user && nameFor(user, _this.$translate)) || error.username;\r\n                    if (_.isFunction(params.showErrorMsgFunc)) {\r\n                        params.showErrorMsgFunc(_this.errorMessageFor(error, nameForMsg));\r\n                    }\r\n                    else {\r\n                        _this.toaster.pop({ type: VizPortal.ToastType.Error, text: _this.errorMessageFor(error, nameForMsg) });\r\n                    }\r\n                });\r\n            }\r\n        };\r\n        /*\r\n         * TODO: we need to know the action that was being attempted in order to produce\r\n         *       more specific error messages.\r\n         *       The design of this class should probably be reworked to handle that.\r\n         */\r\n        UserActionNotification.prototype.errorMessageFor = function (error, username) {\r\n            var errorCode = error.code;\r\n            if (!!VizPortal.LdapErrorCode[errorCode]) {\r\n                return this.ldapErrorMessage(error, username);\r\n            }\r\n            switch (errorCode) {\r\n                case VizPortal.UserErrorCode.UserAlreadyExists:\r\n                    return this.$translate.instant('errorUserAlreadyExists', { NEW_ITEM_NAME: VizPortal.L10n.elideIfLong(username) });\r\n                case VizPortal.UserErrorCode.UserNotSupportedGuestOperation:\r\n                    return this.$translate.instant('errorUserNotSupportedGuestOperation');\r\n                case VizPortal.UserErrorCode.UserNotSupportedSelfOperation:\r\n                    return this.$translate.instant('errorUserNotSupportedSelfOperation');\r\n                case VizPortal.UserErrorCode.UserInsufficientSiteQuota:\r\n                    return this.$translate.instant('errorUserInsufficientSiteQuota');\r\n                case VizPortal.CommonErrorCode.CallingUserInsufficientPermissions:\r\n                    return this.$translate.instant('errorInsufficientPermision', { USER_NAME: VizPortal.L10n.elideIfLong(username) });\r\n                case VizPortal.CommonErrorCode.ADUserNotFound:\r\n                    return this.$translate.instant('errorUserNotFoundInAD', { USER_NAME: VizPortal.L10n.elideIfLong(username) });\r\n                case VizPortal.CommonErrorCode.UnexpectedErrorOccurred:\r\n                    return this.$translate.instant('unexpectedErrorOnServer');\r\n                default:\r\n                    return this.$translate.instant('errorUnknown');\r\n            }\r\n        };\r\n        UserActionNotification.prototype.ldapErrorMessage = function (error, username) {\r\n            var errorCode = error.code;\r\n            switch (errorCode) {\r\n                case VizPortal.LdapErrorCode.LdapServerDown:\r\n                    return this.$translate.instant('errorLdapServerDown', { USER_NAME: VizPortal.L10n.elideIfLong(username) });\r\n                case VizPortal.LdapErrorCode.LdapInvalidCredentials:\r\n                    return this.$translate.instant('errorLdapInvalidCredentials', { USER_NAME: VizPortal.L10n.elideIfLong(username) });\r\n                default:\r\n                    return this.$translate.instant('errorUnknownLdapError', { USER_NAME: VizPortal.L10n.elideIfLong(username) });\r\n            }\r\n        };\r\n        UserActionNotification.prototype.resultMessageFor = function (resultCode, username) {\r\n            return this.$translate.instant('userActionResult_' + resultCode, { USER_NAME: VizPortal.L10n.elideIfLong(username) });\r\n        };\r\n        UserActionNotification.prototype.multiResultMessageFor = function (resultCode, count) {\r\n            return this.$translate.instant('userActionBulkOperationResult_' + resultCode, { COUNT: count }, VizPortal.L10n.Interpolations.Count);\r\n        };\r\n        // returns a dictionary of users keyed by result code.\r\n        // each user might appear multiple times (multiple result codes per user).\r\n        // if a user is not associated with any result codes, this function associates them with the success code.\r\n        UserActionNotification.prototype.getUsersByResultMap = function (users, results, successCode, errorsByUserId) {\r\n            var _this = this;\r\n            var resultSet = VizPortal.Set.fromIdItemArray(results);\r\n            var map = {};\r\n            users.each(function (user) {\r\n                var resultsForThisUser = resultSet.get(user.id);\r\n                var resultCodesForThisUser = resultsForThisUser && resultSet.get(user.id).codes || [];\r\n                if (resultCodesForThisUser.length > 0) {\r\n                    // there were partial success results for this user.  map them.\r\n                    _.each(resultCodesForThisUser, function (resultCode) {\r\n                        // Check for op codes in the results array that are considered errors.\r\n                        // Map non-errors to the sucess result code.\r\n                        var resultToNotifyFor = _this.isErrorResult(resultCode) ? resultCode.toString() : successCode;\r\n                        if (map[resultToNotifyFor]) {\r\n                            map[resultToNotifyFor].push(user);\r\n                        }\r\n                        else {\r\n                            map[resultToNotifyFor] = [user];\r\n                        }\r\n                    });\r\n                }\r\n                else if (!errorsByUserId[user.id]) {\r\n                    // If there are no result codes or error codes for this user, treat operation as a success.\r\n                    if (map[successCode]) {\r\n                        map[successCode].push(user);\r\n                    }\r\n                    else {\r\n                        map[successCode] = [user];\r\n                    }\r\n                }\r\n            });\r\n            return map;\r\n        };\r\n        UserActionNotification.prototype.isErrorResult = function (resultCode) {\r\n            switch (resultCode) {\r\n                case 14: // user that owns content on site/server, gets unlicensed instead\r\n                case 15: // server admin that owns content on site/server cannot be deleted\r\n                case 32: // site at quota\r\n                case 31: // not enough licenses to add to site\r\n                case 42: // not enough licenses to promote to admin\r\n                case 52:\r\n                    return true;\r\n                default:\r\n                    return false;\r\n            }\r\n        };\r\n        UserActionNotification.$inject = [\r\n            '$translate',\r\n            'ToasterService'];\r\n        return UserActionNotification;\r\n    })();\r\n    VizPortal.UserActionNotification = UserActionNotification;\r\n    VizPortal.Module.instance().service('UserActionNotification', UserActionNotification);\r\n    // Notification For:\r\n    // => adding users to site\r\n    var AddUserToSiteActionNotification = (function () {\r\n        function AddUserToSiteActionNotification($translate, toaster) {\r\n            this.$translate = $translate;\r\n            this.toaster = toaster;\r\n        }\r\n        AddUserToSiteActionNotification.prototype.notify = function (showErrorMsgFunc, result, username, siteRoleEnum) {\r\n            if (!!result.errors && result.errors.length > 0) {\r\n                var errorMsg = this.errorMessageFor(result.errors[0], username);\r\n                showErrorMsgFunc(errorMsg);\r\n            }\r\n            else {\r\n                var translatedSiteRole = this.$translate.instant(siteRoleEnum);\r\n                var successMsg = this.$translate.instant('addUserToSiteWithSiteRoleSuccessMsg', { NEW_ITEM_NAME: VizPortal.L10n.elideIfLong(username), SITE_ROLE: translatedSiteRole });\r\n                this.toaster.pop({ type: VizPortal.ToastType.Info, text: successMsg });\r\n            }\r\n        };\r\n        AddUserToSiteActionNotification.prototype.errorMessageFor = function (error, username) {\r\n            switch (error.code) {\r\n                case VizPortal.CommonErrorCode.SystemUserNotFound:\r\n                    return this.$translate.instant('errorSystemUserNotFound', { USER_NAME: VizPortal.L10n.elideIfLong(username) });\r\n                case VizPortal.UserErrorCode.UserAlreadyExists:\r\n                    return this.$translate.instant('errorUserAlreadyExists', { NEW_ITEM_NAME: VizPortal.L10n.elideIfLong(username) });\r\n                case VizPortal.UserErrorCode.UserInsufficientSiteQuota:\r\n                    return this.$translate.instant('errorUserInsufficientSiteQuota');\r\n                default:\r\n                    return this.$translate.instant('errorUnknown');\r\n            }\r\n        };\r\n        AddUserToSiteActionNotification.$inject = [\r\n            '$translate',\r\n            'ToasterService'];\r\n        return AddUserToSiteActionNotification;\r\n    })();\r\n    VizPortal.AddUserToSiteActionNotification = AddUserToSiteActionNotification;\r\n    VizPortal.Module.instance().service('AddUserToSiteActionNotification', AddUserToSiteActionNotification);\r\n    // Notification For:\r\n    // => site role change for single site\r\n    var SiteRolesUpdateActionNotification = (function () {\r\n        function SiteRolesUpdateActionNotification($state, $filter, $translate, contentActionNotification) {\r\n            this.$state = $state;\r\n            this.$filter = $filter;\r\n            this.$translate = $translate;\r\n            this.contentActionNotification = contentActionNotification;\r\n        }\r\n        SiteRolesUpdateActionNotification.prototype.notify = function (result, users, siteRoleEnum) {\r\n            var _this = this;\r\n            var translatedSiteRole = this.$filter('siteRole')(siteRoleEnum);\r\n            var successfulName = getSuccessfulName(users, result, this.$translate);\r\n            var failingName = getFailingName(users, result, this.$translate);\r\n            // create a notification object for result reporting\r\n            var notification = VizPortal.MultipleResultNotificationOptions.create(new VizPortal.MultipleItemResult(users, result), {\r\n                describeSuccessSummary: function (successCount) {\r\n                    return _this.$translate.instant('updateSiteRoleSuccess', {\r\n                        SUCCESS_COUNT: successCount,\r\n                        USER_NAME: VizPortal.L10n.elideIfLong(successfulName),\r\n                        SITE_ROLE: translatedSiteRole\r\n                    }, VizPortal.L10n.Interpolations.Count);\r\n                },\r\n                describeErrorSummary: function (errorCount) {\r\n                    return _this.$translate.instant('updateSiteRoleError', {\r\n                        ERROR_COUNT: errorCount,\r\n                        USER_NAME: VizPortal.L10n.elideIfLong(failingName),\r\n                        SITE_ROLE: translatedSiteRole\r\n                    }, VizPortal.L10n.Interpolations.Count);\r\n                },\r\n                describeErrorDetail: function (errorItem) {\r\n                    return {\r\n                        itemName: errorItem.item.username,\r\n                        itemUrl: getUrlForUser(_this.$state, errorItem.item),\r\n                        errorMessage: _this.errorMessageFor(errorItem, translatedSiteRole)\r\n                    };\r\n                }\r\n            });\r\n            // pass the notification object to the service for displaying\r\n            this.contentActionNotification.notify(notification);\r\n        };\r\n        SiteRolesUpdateActionNotification.prototype.errorMessageFor = function (errorItem, siteRole) {\r\n            switch (errorItem.error.code) {\r\n                case VizPortal.UserErrorCode.UserInsufficientLicenses:\r\n                    return this.$translate.instant('errorUserInsufficientLicenses_updateSiteRole', { SITE_ROLE: siteRole });\r\n                case VizPortal.UserErrorCode.UserNotSupportedGuestOperation:\r\n                    return this.$translate.instant('errorUserNotSupportedGuestOperation');\r\n                case VizPortal.UserErrorCode.UserNotSupportedAdminOperation:\r\n                    return this.$translate.instant('errorUserNotSupportedAdminOperation');\r\n                case VizPortal.UserErrorCode.UserNotSupportedSelfOperation:\r\n                    return this.$translate.instant('errorUserNotSupportedSelfOperation');\r\n                case VizPortal.UserErrorCode.UserInsufficientSiteQuota:\r\n                    return this.$translate.instant('errorUserInsufficientSiteQuota');\r\n                default:\r\n                    return this.$translate.instant('errorUnknown');\r\n            }\r\n        };\r\n        SiteRolesUpdateActionNotification.$inject = [\r\n            '$state',\r\n            '$filter',\r\n            '$translate',\r\n            'ContentActionNotification'];\r\n        return SiteRolesUpdateActionNotification;\r\n    })();\r\n    VizPortal.SiteRolesUpdateActionNotification = SiteRolesUpdateActionNotification;\r\n    VizPortal.Module.instance().service('SiteRolesUpdateActionNotification', SiteRolesUpdateActionNotification);\r\n    // Notification For:\r\n    // => site membership and roles change for single site\r\n    var SiteMembershipUpdateActionNotification = (function () {\r\n        function SiteMembershipUpdateActionNotification($state, $translate, contentActionNotification) {\r\n            this.$state = $state;\r\n            this.$translate = $translate;\r\n            this.contentActionNotification = contentActionNotification;\r\n        }\r\n        SiteMembershipUpdateActionNotification.prototype.notify = function (result, users, userCount, addedUser, addedToSiteCount, addedToSiteName, removedFromSiteCount, removedFromSiteName) {\r\n            var _this = this;\r\n            var successId;\r\n            var errorId;\r\n            var messageArgs = {\r\n                USER_NAME: VizPortal.L10n.elideIfLong(nameFor(addedUser, this.$translate))\r\n            };\r\n            // determine result notification strings and args\r\n            if (addedToSiteCount > 0) {\r\n                if (removedFromSiteCount > 0) {\r\n                    successId = 'siteRolesChanged_usersAddedToSitesAndRemovedFromSites';\r\n                    errorId = 'siteRolesChanged_usersAddedToSitesAndRemovedFromSites_failed';\r\n                    angular.extend(messageArgs, {\r\n                        ADD_COUNT: addedToSiteCount,\r\n                        ADD_NAME: VizPortal.L10n.elideIfLong(addedToSiteName),\r\n                        REMOVE_COUNT: removedFromSiteCount,\r\n                        REMOVE_NAME: VizPortal.L10n.elideIfLong(removedFromSiteName)\r\n                    });\r\n                }\r\n                else {\r\n                    successId = 'siteRolesChanged_usersAddedToSites';\r\n                    errorId = 'siteRolesChanged_usersAddedToSites_failed';\r\n                    angular.extend(messageArgs, {\r\n                        ADD_COUNT: addedToSiteCount,\r\n                        ADD_NAME: VizPortal.L10n.elideIfLong(addedToSiteName)\r\n                    });\r\n                }\r\n            }\r\n            else {\r\n                successId = 'siteRolesChanged_usersRemovedFromSites';\r\n                errorId = 'siteRolesChanged_usersRemovedFromSites_failed';\r\n                angular.extend(messageArgs, {\r\n                    REMOVE_COUNT: removedFromSiteCount,\r\n                    REMOVE_NAME: VizPortal.L10n.elideIfLong(removedFromSiteName)\r\n                });\r\n            }\r\n            // create a notification object for result reporting\r\n            var notification = VizPortal.MultipleResultNotificationOptions.create(new VizPortal.MultipleItemResult(users, result), {\r\n                describeSuccessSummary: function (successCount) {\r\n                    angular.extend(messageArgs, { USER_COUNT: successCount });\r\n                    return _this.$translate.instant(successId, messageArgs, VizPortal.L10n.Interpolations.Count);\r\n                },\r\n                describeErrorSummary: function (errorCount) {\r\n                    angular.extend(messageArgs, { USER_COUNT: errorCount });\r\n                    return _this.$translate.instant(errorId, messageArgs, VizPortal.L10n.Interpolations.Count);\r\n                },\r\n                describeErrorDetail: function (errorItem) {\r\n                    return {\r\n                        itemName: errorItem.item.username,\r\n                        itemUrl: getUrlForUser(_this.$state, errorItem.item),\r\n                        errorMessage: _this.errorMessageFor(errorItem)\r\n                    };\r\n                }\r\n            });\r\n            // pass the notification object to the service for displaying\r\n            this.contentActionNotification.notify(notification);\r\n        };\r\n        SiteMembershipUpdateActionNotification.prototype.errorMessageFor = function (errorItem) {\r\n            switch (errorItem.error.code) {\r\n                case VizPortal.CommonErrorCode.SystemUserNotFound:\r\n                    return this.$translate.instant('errorSystemUserNotFound', { USER_NAME: VizPortal.L10n.elideIfLong(errorItem.item.username) });\r\n                case VizPortal.UserErrorCode.UserInsufficientLicenses:\r\n                    return this.$translate.instant('errorUserInsufficientLicenses');\r\n                case VizPortal.UserErrorCode.UserNotSupportedGuestOperation:\r\n                    return this.$translate.instant('errorUserNotSupportedGuestOperation');\r\n                case VizPortal.UserErrorCode.UserInsufficientSiteQuota:\r\n                    return this.$translate.instant('errorUserInsufficientSiteQuota');\r\n                default:\r\n                    return this.$translate.instant('errorUnknown');\r\n            }\r\n        };\r\n        SiteMembershipUpdateActionNotification.$inject = [\r\n            '$state',\r\n            '$translate',\r\n            'ContentActionNotification'];\r\n        return SiteMembershipUpdateActionNotification;\r\n    })();\r\n    VizPortal.SiteMembershipUpdateActionNotification = SiteMembershipUpdateActionNotification;\r\n    VizPortal.Module.instance().service('SiteMembershipUpdateActionNotification', SiteMembershipUpdateActionNotification);\r\n    // Notification For:\r\n    // => single or multiple server admin update\r\n    var ServerAdminUpdateActionNotification = (function () {\r\n        function ServerAdminUpdateActionNotification($filter, $state, $translate, contentActionNotification) {\r\n            this.$filter = $filter;\r\n            this.$state = $state;\r\n            this.$translate = $translate;\r\n            this.contentActionNotification = contentActionNotification;\r\n        }\r\n        ServerAdminUpdateActionNotification.prototype.notify = function (result, users, newAdminState) {\r\n            var _this = this;\r\n            var successId;\r\n            var errorId;\r\n            if (newAdminState) {\r\n                successId = 'serverAdminPromotionSuccess';\r\n                errorId = 'serverAdminPromotionFailed';\r\n            }\r\n            else {\r\n                successId = 'serverAdminDemotionSuccess';\r\n                errorId = 'serverAdminDemotionFailed';\r\n            }\r\n            var successfulName = getSuccessfulName(users, result, this.$translate);\r\n            var failingName = getFailingName(users, result, this.$translate);\r\n            // create a notification object for result reporting\r\n            var notification = VizPortal.MultipleResultNotificationOptions.create(new VizPortal.MultipleItemResult(users, result), {\r\n                describeSuccessSummary: function (successCount) {\r\n                    var messageArgs = {\r\n                        USER_COUNT: successCount,\r\n                        USER_NAME: VizPortal.L10n.elideIfLong(successfulName)\r\n                    };\r\n                    return _this.$translate.instant(successId, messageArgs, VizPortal.L10n.Interpolations.Count);\r\n                },\r\n                describeErrorSummary: function (errorCount) {\r\n                    var messageArgs = {\r\n                        USER_COUNT: errorCount,\r\n                        USER_NAME: VizPortal.L10n.elideIfLong(failingName)\r\n                    };\r\n                    return _this.$translate.instant(errorId, messageArgs, VizPortal.L10n.Interpolations.Count);\r\n                },\r\n                describeErrorDetail: function (errorItem) {\r\n                    return {\r\n                        itemName: errorItem.item.username,\r\n                        itemUrl: getUrlForUser(_this.$state, errorItem.item),\r\n                        errorMessage: _this.errorMessageFor(errorItem)\r\n                    };\r\n                }\r\n            });\r\n            // pass the notification object to the service for displaying\r\n            this.contentActionNotification.notify(notification);\r\n        };\r\n        ServerAdminUpdateActionNotification.prototype.errorMessageFor = function (errorItem) {\r\n            switch (errorItem.error.code) {\r\n                case VizPortal.UserErrorCode.UserInsufficientLicenses:\r\n                    var translatedRole = this.$filter('siteRole')(VizPortal.ServerApi.SiteRoles.ServerAdministrator);\r\n                    return this.$translate.instant('errorUserInsufficientLicenses_updateSiteRole', { SITE_ROLE: translatedRole });\r\n                case VizPortal.CommonErrorCode.CallingUserInsufficientPermissions:\r\n                    return this.$translate.instant('errorCallingUserInsufficientPermissions_serverAdminChange');\r\n                case VizPortal.CommonErrorCode.SystemUserNotFound:\r\n                    return this.$translate.instant('errorSystemUserNotFound', { USER_NAME: VizPortal.L10n.elideIfLong(errorItem.item.username) });\r\n                case VizPortal.UserErrorCode.UserNotSupportedGuestOperation:\r\n                    return this.$translate.instant('errorUserNotSupportedGuestOperation');\r\n                case VizPortal.UserErrorCode.UserNotSupportedSelfOperation:\r\n                    return this.$translate.instant('errorUserNotSupportedSelfOperation');\r\n                case VizPortal.UserErrorCode.UserInsufficientSiteQuota:\r\n                    return this.$translate.instant('errorUserInsufficientSiteQuota');\r\n                default:\r\n                    return this.$translate.instant('errorUnknown');\r\n            }\r\n        };\r\n        ServerAdminUpdateActionNotification.$inject = [\r\n            '$filter',\r\n            '$state',\r\n            '$translate',\r\n            'ContentActionNotification'];\r\n        return ServerAdminUpdateActionNotification;\r\n    })();\r\n    VizPortal.ServerAdminUpdateActionNotification = ServerAdminUpdateActionNotification;\r\n    VizPortal.Module.instance().service('ServerAdminUpdateActionNotification', ServerAdminUpdateActionNotification);\r\n    // Notification For:\r\n    // => group membership for users\r\n    var GroupMembershipUpdateActionNotification = (function () {\r\n        function GroupMembershipUpdateActionNotification($state, $translate, contentActionNotification) {\r\n            this.$state = $state;\r\n            this.$translate = $translate;\r\n            this.contentActionNotification = contentActionNotification;\r\n        }\r\n        GroupMembershipUpdateActionNotification.prototype.notify = function (result, users, addedToGroupCount, addedToGroupName, removedFromGroupCount, removedFromGroupName) {\r\n            var _this = this;\r\n            var notification;\r\n            if (result.errors && result.errors.length && result.errors[0].code === VizPortal.CommonErrorCode.GroupNotFound) {\r\n                // TODO: how can we determine if the \"to\" group or the \"from\" group (or both) are not found?\r\n                notification = {\r\n                    errorSummary: this.$translate.instant('errorGroupNotFound', {\r\n                        ITEM_NAME: VizPortal.L10n.elideIfLong(addedToGroupName || removedFromGroupName)\r\n                    })\r\n                };\r\n            }\r\n            else {\r\n                var successId;\r\n                var errorId;\r\n                var messageArgs = {\r\n                    USER_NAME: VizPortal.L10n.elideIfLong(nameFor(users.first(), this.$translate))\r\n                };\r\n                // determine result notification strings and args\r\n                if (addedToGroupCount > 0) {\r\n                    if (removedFromGroupCount > 0) {\r\n                        successId = 'groupMembershipChanged_usersAddedToGroupsAndRemovedFromGroups';\r\n                        errorId = 'groupMembershipChanged_usersAddedToGroupsAndRemovedFromGroups_failed';\r\n                        angular.extend(messageArgs, {\r\n                            ADD_COUNT: addedToGroupCount,\r\n                            ADD_NAME: VizPortal.L10n.elideIfLong(addedToGroupName),\r\n                            REMOVE_COUNT: removedFromGroupCount,\r\n                            REMOVE_NAME: VizPortal.L10n.elideIfLong(removedFromGroupName)\r\n                        });\r\n                    }\r\n                    else {\r\n                        successId = 'groupMembershipChanged_usersAddedToGroups';\r\n                        errorId = 'groupMembershipChanged_usersAddedToGroups_failed';\r\n                        angular.extend(messageArgs, {\r\n                            ADD_COUNT: addedToGroupCount,\r\n                            ADD_NAME: VizPortal.L10n.elideIfLong(addedToGroupName)\r\n                        });\r\n                    }\r\n                }\r\n                else {\r\n                    successId = 'groupMembershipChanged_usersRemovedFromGroups';\r\n                    errorId = 'groupMembershipChanged_usersRemovedFromGroups_failed';\r\n                    angular.extend(messageArgs, {\r\n                        REMOVE_COUNT: removedFromGroupCount,\r\n                        REMOVE_NAME: VizPortal.L10n.elideIfLong(removedFromGroupName)\r\n                    });\r\n                }\r\n                // TODO: this doesn't seem right - do the errors apply to users or groups? I don't think\r\n                // we can calculate the success count if errors can apply to groups.\r\n                notification = VizPortal.MultipleResultNotificationOptions.create(new VizPortal.MultipleItemResult(users, result), {\r\n                    describeSuccessSummary: function (successCount) {\r\n                        angular.extend(messageArgs, { USER_COUNT: successCount });\r\n                        return _this.$translate.instant(successId, messageArgs, VizPortal.L10n.Interpolations.Count);\r\n                    },\r\n                    describeErrorSummary: function (errorCount) {\r\n                        angular.extend(messageArgs, { USER_COUNT: errorCount });\r\n                        return _this.$translate.instant(errorId, messageArgs, VizPortal.L10n.Interpolations.Count);\r\n                    },\r\n                    describeErrorDetail: function (errorItem) {\r\n                        return {\r\n                            itemName: errorItem.item.username,\r\n                            itemUrl: getUrlForUser(_this.$state, errorItem.item),\r\n                            errorMessage: _this.errorMessageFor(errorItem)\r\n                        };\r\n                    }\r\n                });\r\n            }\r\n            // pass the notification object to the service for displaying\r\n            this.contentActionNotification.notify(notification);\r\n        };\r\n        GroupMembershipUpdateActionNotification.prototype.errorMessageFor = function (errorItem) {\r\n            switch (errorItem.error.code) {\r\n                case VizPortal.GroupErrorCode.InvalidGroupMembershipUpdate:\r\n                    return this.$translate.instant('errorInvalidAllUsersGroupMembershipUpdate');\r\n                case VizPortal.CommonErrorCode.SiteUserNotFound:\r\n                    return this.$translate.instant('errorUserNotFound');\r\n                case VizPortal.CommonErrorCode.SystemUserNotFound:\r\n                    return this.$translate.instant('errorSystemUserNotFound', { USER_NAME: VizPortal.L10n.elideIfLong(errorItem.item.username) });\r\n                case VizPortal.CommonErrorCode.GroupNotFound:\r\n                    return this.$translate.instant('errorGroupNotFound');\r\n                default:\r\n                    return this.$translate.instant('errorUnknown');\r\n            }\r\n        };\r\n        GroupMembershipUpdateActionNotification.$inject = [\r\n            '$state',\r\n            '$translate',\r\n            'ContentActionNotification'];\r\n        return GroupMembershipUpdateActionNotification;\r\n    })();\r\n    VizPortal.GroupMembershipUpdateActionNotification = GroupMembershipUpdateActionNotification;\r\n    VizPortal.Module.instance().service('GroupMembershipUpdateActionNotification', GroupMembershipUpdateActionNotification);\r\n    // helpers\r\n    var nameFor = function (user, $translate) {\r\n        return $translate.instant('userActionNameFormattedForToast', { DISPLAY_NAME: VizPortal.L10n.elideIfLong(user.displayName), USER_NAME: VizPortal.L10n.elideIfLong(user.username) });\r\n    };\r\n    // get name of a successful item\r\n    // returns empty string if no items successful\r\n    var getSuccessfulName = function (users, result, $translate) {\r\n        var successfulItem = getSuccessfulItem(users, result);\r\n        return successfulItem ? nameFor(successfulItem, $translate) : \"\";\r\n    };\r\n    // get name of a failing item\r\n    // returns empty string if no items failed\r\n    var getFailingName = function (users, result, $translate) {\r\n        var failingItem = getFailingItem(users, result);\r\n        return failingItem ? nameFor(failingItem, $translate) : \"\";\r\n    };\r\n    // get a successful item, useful when there is only one item that is successful\r\n    // returns undefined if no items successful\r\n    var getSuccessfulItem = function (users, result) {\r\n        return users.find(function (item) {\r\n            var matchingError = undefined;\r\n            if (!!result.errors) {\r\n                matchingError = _.find(result.errors, function (error) {\r\n                    return item.id === error.id;\r\n                });\r\n            }\r\n            ;\r\n            return !matchingError;\r\n        });\r\n    };\r\n    // get a failing item, useful when there is only one item that is failing\r\n    // returns undefined if no items failed\r\n    var getFailingItem = function (users, result) {\r\n        return users.find(function (item) {\r\n            var matchingError = undefined;\r\n            if (!!result.errors) {\r\n                matchingError = _.find(result.errors, function (error) {\r\n                    return item.id === error.id;\r\n                });\r\n            }\r\n            ;\r\n            return !!matchingError;\r\n        });\r\n    };\r\n    // get the URL to the specified user's profile page\r\n    var getUrlForUser = function (state, user) {\r\n        if (user.username === 'guest' && user.domainName === 'local') {\r\n            return null;\r\n        }\r\n        else {\r\n            return state.href(\"main.site.user.workbooks\", { username: user.username, domainName: user.domainName });\r\n        }\r\n    };\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../../common/components/checkboxes/CheckboxState.ts\" />\r\n/// <reference path=\"../helpers/Order.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../models/IApplyCancelButtons.ts\" />\r\n/// <reference path=\"../models/ColumnWidths.ts\" />\r\n/// <reference path=\"../models/OrderKeys.ts\" />\r\n/// <reference path=\"../resources/Groups.ts\" />\r\n/// <reference path=\"../resources/SiteUsers.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetGroupsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetUsersGroupMembershipRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/UpdateUsersGroupMembershipRequest.ts\" />\r\n/// <reference path=\"../services/SliceableFactory.ts\" />\r\n/// <reference path=\"../services/UserActionNotification.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.GroupMembershipEvent = {\r\n        MembershipChanged: \"MembershipChanged\"\r\n    };\r\n    VizPortal.GroupMembershipDialogFilters = {\r\n        AllGroups: \"groupMembershipAllGroups\",\r\n        AssignedGroups: \"groupMembershipAssignedGroups\",\r\n        SearchResults: \"groupMembershipSearchResults\"\r\n    };\r\n    var GroupMembershipDialogCtrl = (function () {\r\n        function GroupMembershipDialogCtrl($q, $scope, $translate, groupMembershipUpdateActionNotification, groups, server, SiteUsers, toaster, BrowserSupportService, sliceableFactory) {\r\n            var _this = this;\r\n            this.$q = $q;\r\n            this.$translate = $translate;\r\n            this.groupMembershipUpdateActionNotification = groupMembershipUpdateActionNotification;\r\n            this.groups = groups;\r\n            this.SiteUsers = SiteUsers;\r\n            this.toaster = toaster;\r\n            this.sliceableFactory = sliceableFactory;\r\n            this.server = server;\r\n            this.serverState = {};\r\n            this.groupIdToGroup = {};\r\n            this.clientChanges = {};\r\n            this.scope = $scope;\r\n            this.scope.busy = false;\r\n            this.scope.needsAssignedGroupsRefresh = false;\r\n            this.scope.sliceable = groups.all().withOrder(GroupMembershipDialogCtrl.ListOrder);\r\n            this.scope.columnWidths = {\r\n                getActual: this.getColumnWidths,\r\n                getMin: this.getColumnWidths,\r\n                hasPreferredWidths: function () { return true; }\r\n            };\r\n            this.uncheckedAssignedGroups = 0;\r\n            this.scope.groupFilter = { selection: VizPortal.GroupMembershipDialogFilters.AllGroups };\r\n            this.scope.lastGroupFilter = this.scope.groupFilter.selection;\r\n            this.updateGroupFilters();\r\n            this.scope.searchInput = { text: '' };\r\n            var displayName = ($scope.users.size() > 0) ? $scope.users.first().displayName : '';\r\n            this.scope.editGroupMembershipDescription =\r\n                $translate.instant('editGroupMembershipDescription', { USER_COUNT: $scope.users.size(), USER_NAME: VizPortal.L10n.elideIfLong(displayName) }, VizPortal.L10n.Interpolations.Count);\r\n            this.scope.isDirty = function () {\r\n                return !_.isEmpty(_this.clientChanges);\r\n            };\r\n            // IApplyCancelButtons\r\n            this.scope.applyCancelButtons = {\r\n                applyString: $translate.instant(\"save\"),\r\n                cancelString: $translate.instant(\"cancel\"),\r\n                apply: function () { return _this.apply(); },\r\n                cancel: function () { return _this.scope.dismiss(); },\r\n                disableApply: function () { return (!_this.scope.isDirty() || _this.scope.busy); },\r\n                disableCancel: function () { return _this.scope.busy; },\r\n                isBusy: function () { return _this.scope.busy; }\r\n            };\r\n            this.scope.isGroupDirty = function (group) {\r\n                return !!_this.clientChanges[group.id];\r\n            };\r\n            this.scope.checkboxClicked = function (group, colIndex) {\r\n                if (group.isAllUsersGroup) {\r\n                    return;\r\n                }\r\n                if (_this.scope.groupFilter.selection === VizPortal.GroupMembershipDialogFilters.AssignedGroups) {\r\n                    //keep track of the checkbox changes made to the assigned groups\r\n                    if (_this.scope.clientState[group.id] === VizPortal.CheckboxState.empty) {\r\n                        _this.uncheckedAssignedGroups--;\r\n                    }\r\n                    else if (_this.scope.clientState[group.id] === VizPortal.CheckboxState.checked) {\r\n                        _this.uncheckedAssignedGroups++;\r\n                    }\r\n                    //if the number of checked/mixed groups matches the original number, a refresh isn't needed.\r\n                    _this.scope.needsAssignedGroupsRefresh = _this.uncheckedAssignedGroups > 0;\r\n                }\r\n                _this.scope.clientState[group.id] = VizPortal.CheckboxState.toggle(_this.scope.clientState[group.id]);\r\n                // if the client & server state are equal, remove the group from client changes\r\n                // to avoid sending no-op requests to the server.\r\n                if (_this.isClientAndServerStateEqualFor(group.id)) {\r\n                    delete _this.clientChanges[group.id];\r\n                }\r\n                else {\r\n                    _this.clientChanges[group.id] = _this.scope.clientState[group.id];\r\n                    _this.groupIdToGroup[group.id] = _this.clone(group);\r\n                }\r\n            };\r\n            this.scope.submitSearch = function (searchText, $event) {\r\n                if (!searchText) {\r\n                    _this.scope.groupFilter.selection = _this.scope.lastGroupFilter;\r\n                }\r\n                else {\r\n                    if (_this.scope.groupFilter.selection !== VizPortal.GroupMembershipDialogFilters.SearchResults) {\r\n                        _this.scope.groupFilter.selection = VizPortal.GroupMembershipDialogFilters.SearchResults;\r\n                    }\r\n                    _this.scope.sliceable = groups.all().withFiltersAndOrder([VizPortal.Filter.search(searchText)], GroupMembershipDialogCtrl.ListOrder);\r\n                }\r\n                if (BrowserSupportService.isTouch() && $event) {\r\n                    // blur to retract the keyboard when search is explicitly submitted\r\n                    $($event.target).blur();\r\n                }\r\n            };\r\n            this.scope.refreshAssignedGroups = function () {\r\n                _this.scope.sliceable = _this.getAssignedGroupsList();\r\n                _this.scope.needsAssignedGroupsRefresh = false;\r\n            };\r\n            this.scope.$watch('groupFilter.selection', function (newFilter) {\r\n                _this.updateGroupFilters();\r\n                if (newFilter === VizPortal.GroupMembershipDialogFilters.AssignedGroups) {\r\n                    _this.scope.refreshAssignedGroups();\r\n                }\r\n                if (newFilter === VizPortal.GroupMembershipDialogFilters.AllGroups) {\r\n                    _this.scope.sliceable = groups.all().withOrder(GroupMembershipDialogCtrl.ListOrder);\r\n                }\r\n                if (newFilter !== VizPortal.GroupMembershipDialogFilters.SearchResults) {\r\n                    _this.scope.lastGroupFilter = newFilter;\r\n                    _this.scope.searchInput.text = '';\r\n                }\r\n                _this.scope.needsAssignedGroupsRefresh = false;\r\n            });\r\n            this.getServerState(this.scope.users);\r\n        }\r\n        //The last column's width is dependent on whether or not the scroll bar is visible.\r\n        GroupMembershipDialogCtrl.prototype.getColumnWidths = function (index) {\r\n            //checkbox column and group name column are constant. These should be kept in sync with the design spec for the dialog.\r\n            var widths = [27, 278];\r\n            var calcMemberCountWidth = $('.tb-group-membership .tb-data-grid-body-background').width() - widths[0] - widths[1];\r\n            return index === 2 ? calcMemberCountWidth : widths[index];\r\n        };\r\n        GroupMembershipDialogCtrl.prototype.updateGroupFilters = function () {\r\n            var filters = [\r\n                VizPortal.GroupMembershipDialogFilters.AllGroups,\r\n                VizPortal.GroupMembershipDialogFilters.AssignedGroups\r\n            ];\r\n            if (this.scope.groupFilter.selection === VizPortal.GroupMembershipDialogFilters.SearchResults) {\r\n                filters.push(VizPortal.GroupMembershipDialogFilters.SearchResults);\r\n            }\r\n            this.scope.groupFilters = filters;\r\n        };\r\n        GroupMembershipDialogCtrl.prototype.getAssignedGroupsList = function () {\r\n            var _this = this;\r\n            var groupsList = [];\r\n            _.each(this.scope.clientState, function (checkboxState, groupId) {\r\n                if (checkboxState !== VizPortal.CheckboxState.empty) {\r\n                    groupsList.push(_this.groupIdToGroup[groupId]);\r\n                }\r\n            });\r\n            this.uncheckedAssignedGroups = 0;\r\n            return this.sliceableFactory.fromArray(groupsList.sort(function (groupA, groupB) {\r\n                return groupA.name.localeCompare(groupB.name, VizPortal.L10n.language);\r\n            }));\r\n        };\r\n        // true if either client & server state are both checked, or client state is empty and server state is null.\r\n        // note: server state doesn't use empty for empty groups, because of pagnination -- we don't know how many\r\n        // groups there might be, so we only track the ones that have relevant membership, and treat the nulls as empty.\r\n        GroupMembershipDialogCtrl.prototype.isClientAndServerStateEqualFor = function (groupId) {\r\n            return ((this.scope.clientState[groupId] === this.serverState[groupId])\r\n                || (this.scope.clientState[groupId] === VizPortal.CheckboxState.empty && !this.serverState[groupId]));\r\n        };\r\n        GroupMembershipDialogCtrl.prototype.clone = function (group) {\r\n            return { name: group.name, id: group.id, userCount: group.userCount,\r\n                isAllUsersGroup: group.isAllUsersGroup, domainName: group.domainName };\r\n        };\r\n        GroupMembershipDialogCtrl.prototype.getServerState = function (users) {\r\n            var _this = this;\r\n            var userIds = users.keys();\r\n            if (userIds && userIds.length > 0) {\r\n                // request group membership info from the server.\r\n                this.server.sendRequest(new VizPortal.ServerApi.GetUsersGroupMembershipRequest({ userIds: userIds }))\r\n                    .then(function (result) {\r\n                    // count how many selected users belong to each group.\r\n                    // e.g. {allUsers: 3, bigGroup: 2, ...}\r\n                    var groupMembershipCounts = _.countBy(result.members, function (user) { return user.groupId; });\r\n                    // for each group, compute the checkbox state.\r\n                    // e.g. {allUsers: 'checked', bigGroup: 'mixed', ...}\r\n                    _this.serverState = {};\r\n                    var selectedUsersCount = _this.scope.users.size();\r\n                    _.each(groupMembershipCounts, function (memberCount, groupId) {\r\n                        _this.serverState[groupId] = _this.stringForGroupState(memberCount, selectedUsersCount);\r\n                    });\r\n                    _this.scope.clientState = _.clone(_this.serverState);\r\n                    _.each(_this.clientChanges, function (clientGroupState, groupId) {\r\n                        _this.scope.clientState[groupId] = clientGroupState;\r\n                    });\r\n                    _.each(result.groups, function (group) {\r\n                        _this.groupIdToGroup[group.id] = group;\r\n                    });\r\n                });\r\n            }\r\n        };\r\n        GroupMembershipDialogCtrl.prototype.apply = function () {\r\n            var _this = this;\r\n            var users = _.clone(this.scope.users); // clone for independence from further selection\r\n            var userIds = users.keys();\r\n            var params = {\r\n                userIds: userIds,\r\n                addToGroupIds: [],\r\n                removeFromGroupIds: []\r\n            };\r\n            // build up input params for the request: group IDs to add to & group IDs to remove from.\r\n            _.each(this.clientChanges, function (clientGroupState, groupId) {\r\n                if (clientGroupState === VizPortal.CheckboxState.checked) {\r\n                    params.addToGroupIds.push(groupId);\r\n                }\r\n                if (clientGroupState === VizPortal.CheckboxState.empty) {\r\n                    params.removeFromGroupIds.push(groupId);\r\n                }\r\n            });\r\n            if (this.isValidParamsForUpdate(params)) {\r\n                this.scope.busy = true;\r\n                // send the update to the server.\r\n                return this.SiteUsers.updateUsersGroupMembership(params.userIds, params.addToGroupIds, params.removeFromGroupIds).then(function (result) {\r\n                    var addedToGroupName = '';\r\n                    if (params.addToGroupIds.length > 0) {\r\n                        addedToGroupName = _this.groupIdToGroup[params.addToGroupIds[0]].name;\r\n                    }\r\n                    var removedFromGroupName = '';\r\n                    if (params.removeFromGroupIds.length > 0) {\r\n                        removedFromGroupName = _this.groupIdToGroup[params.removeFromGroupIds[0]].name;\r\n                    }\r\n                    // show toast\r\n                    _this.groupMembershipUpdateActionNotification.notify(result, users, params.addToGroupIds.length, addedToGroupName, params.removeFromGroupIds.length, removedFromGroupName);\r\n                    _this.scope.$emit(VizPortal.GroupMembershipEvent.MembershipChanged);\r\n                    _this.scope.close(result);\r\n                });\r\n            }\r\n            return this.$q.when({});\r\n        };\r\n        // Given params for making an UpdateUsersGroupMembership request\r\n        // returns true iff there's at least one user and at least one group to add or remove the user from\r\n        GroupMembershipDialogCtrl.prototype.isValidParamsForUpdate = function (params) {\r\n            return (params.userIds.length > 0 && (params.addToGroupIds.length > 0 || params.removeFromGroupIds.length > 0));\r\n        };\r\n        // Given the number of members in a group, and the number of selected users,\r\n        // returns a string corresponding to the checkbox state.\r\n        GroupMembershipDialogCtrl.prototype.stringForGroupState = function (memberCount, selectedUsersCount) {\r\n            if (memberCount === selectedUsersCount) {\r\n                return VizPortal.CheckboxState.checked;\r\n            }\r\n            else if (memberCount > 0) {\r\n                return VizPortal.CheckboxState.mixed;\r\n            }\r\n            else {\r\n                return VizPortal.CheckboxState.empty;\r\n            }\r\n        };\r\n        GroupMembershipDialogCtrl.$inject = [\r\n            '$q',\r\n            '$scope',\r\n            '$translate',\r\n            'GroupMembershipUpdateActionNotification',\r\n            'Groups',\r\n            'ServerService',\r\n            'SiteUsers',\r\n            'ToasterService',\r\n            'BrowserSupportService',\r\n            'SliceableFactory'\r\n        ];\r\n        GroupMembershipDialogCtrl.ListOrder = [VizPortal.Order.asc(VizPortal.OrderKeys.name)];\r\n        return GroupMembershipDialogCtrl;\r\n    })();\r\n    VizPortal.GroupMembershipDialogCtrl = GroupMembershipDialogCtrl;\r\n    VizPortal.Module.instance().controller('GroupMembershipDialogCtrl', GroupMembershipDialogCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../controllers/GroupMembershipDialogCtrl.ts\" />\r\n/// <reference path=\"../ServerApi/types/ISiteUser.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var EditGroupMembershipAction = (function () {\r\n        function EditGroupMembershipAction(modalService) {\r\n            this.modalService = modalService;\r\n        }\r\n        // TODO: use ConfimActionDialog\r\n        EditGroupMembershipAction.prototype.showEditGroupMembershipDialog = function (users, context) {\r\n            var scope = context.scope.$new(true);\r\n            scope.users = users;\r\n            var dialogInstance = this.modalService.open({\r\n                scope: scope,\r\n                templateUrl: 'groupMembershipDialog.html',\r\n                size: VizPortal.ModalSize.fitToContent,\r\n                controller: VizPortal.GroupMembershipDialogCtrl\r\n            });\r\n            return dialogInstance.result.fin(function () { return scope.$destroy(); });\r\n        };\r\n        EditGroupMembershipAction.$inject = ['ModalService'];\r\n        return EditGroupMembershipAction;\r\n    })();\r\n    VizPortal.EditGroupMembershipAction = EditGroupMembershipAction;\r\n    VizPortal.Module.instance().service('EditGroupMembershipAction', EditGroupMembershipAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/types/ISiteUser.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var RemoveUsersFromSiteAction = (function () {\r\n        function RemoveUsersFromSiteAction($state, $translate, ConfirmActionDialog, userActionNotification, serverService, SiteUsers, toaster) {\r\n            this.$state = $state;\r\n            this.$translate = $translate;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.userActionNotification = userActionNotification;\r\n            this.serverService = serverService;\r\n            this.SiteUsers = SiteUsers;\r\n            this.toaster = toaster;\r\n        }\r\n        RemoveUsersFromSiteAction.prototype.showRemoveUsersFromSiteDialog = function (siteUsersToRemove, context) {\r\n            var _this = this;\r\n            var dialogBody = this.$translate.instant('confirmRemoveUsersFromSite', {\r\n                USER_NAME: VizPortal.L10n.elideIfLong(siteUsersToRemove.first().displayName),\r\n                USER_COUNT: siteUsersToRemove.size(),\r\n                SITE_NAME: VizPortal.L10n.elideIfLong(this.serverService.sessionSiteName())\r\n            }, VizPortal.L10n.Interpolations.Count);\r\n            var dialogInstance = this.ConfirmActionDialog.open({\r\n                scope: context.scope,\r\n                title: this.$translate.instant('remove'),\r\n                bodyText: dialogBody,\r\n                actionName: this.$translate.instant('confirmRemoveButton', {\r\n                    ITEM_COUNT: siteUsersToRemove.size()\r\n                }, VizPortal.L10n.Interpolations.Count),\r\n                action: function () { return _this.SiteUsers.deleteUsers(siteUsersToRemove.keys()); },\r\n                isDeleteAction: true\r\n            });\r\n            dialogInstance.result.then(function (result) {\r\n                var params = {\r\n                    users: siteUsersToRemove,\r\n                    results: result.results,\r\n                    errors: result.errors,\r\n                    successCode: '13'\r\n                };\r\n                _this.userActionNotification.notify(params);\r\n            });\r\n            return dialogInstance.result;\r\n        };\r\n        RemoveUsersFromSiteAction.$inject = ['$state',\r\n            '$translate',\r\n            'ConfirmActionDialog',\r\n            'UserActionNotification',\r\n            'ServerService',\r\n            'SiteUsers',\r\n            'ToasterService'];\r\n        return RemoveUsersFromSiteAction;\r\n    })();\r\n    VizPortal.RemoveUsersFromSiteAction = RemoveUsersFromSiteAction;\r\n    VizPortal.Module.instance().service('RemoveUsersFromSiteAction', RemoveUsersFromSiteAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SetSiteUsersSiteRoleAction = (function () {\r\n        function SetSiteUsersSiteRoleAction($translate, $q, confirmActionDialog, serverAdminUpdateActionNotification, serverService, siteRolesUpdateActionNotification, siteRoles, siteUsers, toaster) {\r\n            this.$translate = $translate;\r\n            this.$q = $q;\r\n            this.confirmActionDialog = confirmActionDialog;\r\n            this.serverAdminUpdateActionNotification = serverAdminUpdateActionNotification;\r\n            this.serverService = serverService;\r\n            this.siteRolesUpdateActionNotification = siteRolesUpdateActionNotification;\r\n            this.siteRoles = siteRoles;\r\n            this.siteUsers = siteUsers;\r\n            this.toaster = toaster;\r\n        }\r\n        SetSiteUsersSiteRoleAction.prototype.showSetSiteUsersSiteRoleDialog = function (siteUsersToSet, context) {\r\n            var _this = this;\r\n            var dialogScope = context.scope.$new();\r\n            dialogScope.siteRole = (siteUsersToSet.size() === 1) ? siteUsersToSet.first().siteRole : VizPortal.ServerApi.SiteRoles.Unlicensed;\r\n            dialogScope.siteRoleOptions = this.siteRoles.optionsForCurrentUser();\r\n            dialogScope.setSiteRole = function (role) {\r\n                dialogScope.siteRole = role;\r\n            };\r\n            dialogScope.description = this.$translate.instant('confirmSetUsersSiteRoleDesc', {\r\n                USER_NAME: VizPortal.L10n.elideIfLong(siteUsersToSet.first().displayName),\r\n                USER_COUNT: siteUsersToSet.size()\r\n            }, VizPortal.L10n.Interpolations.Count);\r\n            var dialogInstance = this.confirmActionDialog.open({\r\n                title: this.$translate.instant('confirmSetUsersSiteRoleTitle'),\r\n                bodyTemplateUrl: 'confirmActionDialogInputRole.html',\r\n                scope: dialogScope,\r\n                confirmDisabled: function () { return false; },\r\n                actionName: this.$translate.instant('confirmSetUsersSiteRoleButton', {\r\n                    ITEM_COUNT: siteUsersToSet.size()\r\n                }, VizPortal.L10n.Interpolations.Count),\r\n                action: function (dialogInstance) { return _this.setSiteUsersSiteRoles(siteUsersToSet, dialogScope.siteRole); }\r\n            });\r\n            dialogInstance.result.fin(function () { return dialogScope.$destroy(); });\r\n            return dialogInstance.result;\r\n        };\r\n        SetSiteUsersSiteRoleAction.prototype.setSiteUsersSiteRoles = function (selectedUsers, siteRole) {\r\n            var _this = this;\r\n            var users = selectedUsers.clone();\r\n            if (siteRole === VizPortal.ServerApi.SiteRoles.ServerAdministrator) {\r\n                return this.makeUsersServerAdmins(users)\r\n                    .then(function (showToastForPromotedAdmins) {\r\n                    return showToastForPromotedAdmins();\r\n                });\r\n            }\r\n            else {\r\n                // demote server admins\r\n                // update site roles\r\n                // show toast for both after complete to avoid toast showing up behind dialog.\r\n                var showToastForDemotedAdmins = function () { };\r\n                var serverAdmins = users.filter(function (user) { return user.siteRole === VizPortal.ServerApi.SiteRoles.ServerAdministrator; });\r\n                return this.demoteServerAdminsNoDelay(serverAdmins)\r\n                    .then(function (result) {\r\n                    // don't try update site role for admins that did not get demoted\r\n                    if (!!result.errors) {\r\n                        _.each(result.errors, function (error) {\r\n                            users.remove(users.get(error.id));\r\n                        });\r\n                    }\r\n                    showToastForDemotedAdmins = (function () { return _this.serverAdminUpdateActionNotification.notify(result, serverAdmins, false); });\r\n                    return _this.updateUsersSiteRole(users, siteRole);\r\n                })\r\n                    .then(function (showToastForUpdatedUsersSiteRoles) {\r\n                    showToastForDemotedAdmins();\r\n                    // we might not have any users whose roles were updated, if they were removed from errors in updating admin status.\r\n                    // if we don't have any users whose roles were updated, we'll only show the demoted admins toast.\r\n                    if (users.size() > 0) {\r\n                        showToastForUpdatedUsersSiteRoles();\r\n                    }\r\n                });\r\n            }\r\n        };\r\n        // if any selected users are server admins && current user is server admin, demote!\r\n        SetSiteUsersSiteRoleAction.prototype.demoteServerAdminsNoDelay = function (serverAdmins) {\r\n            if (serverAdmins.size() === 0) {\r\n                return this.$q.when({});\r\n            }\r\n            else if (!this.serverService.isSessionServerAdmin()) {\r\n                // hand craft an IResult with errors\r\n                var result = { errors: [] };\r\n                serverAdmins.each(function (user) {\r\n                    result.errors.push({\r\n                        id: user.id,\r\n                        code: VizPortal.CommonErrorCode.CallingUserInsufficientPermissions\r\n                    });\r\n                });\r\n                return this.$q.when(result);\r\n            }\r\n            else {\r\n                return this.siteUsers.updateServerAdminStatusNoDelay(serverAdmins.keys(), false);\r\n            }\r\n        };\r\n        SetSiteUsersSiteRoleAction.prototype.updateUsersSiteRole = function (users, siteRole) {\r\n            var _this = this;\r\n            return this.siteUsers.updateUsersSiteRole(users.keys(), siteRole).then(function (result) {\r\n                // returns a function that shows toast for the action\r\n                return function () { return _this.siteRolesUpdateActionNotification.notify(result, users, siteRole); };\r\n            });\r\n        };\r\n        // makes the users server admins and shows toast\r\n        SetSiteUsersSiteRoleAction.prototype.makeUsersServerAdmins = function (users) {\r\n            var _this = this;\r\n            return this.siteUsers.updateServerAdminStatusAndDelay(users.keys(), true).then(function (result) {\r\n                // returns a function to show toast for the action\r\n                return function () { return _this.serverAdminUpdateActionNotification.notify(result, users, true); };\r\n            });\r\n        };\r\n        SetSiteUsersSiteRoleAction.$inject = ['$translate',\r\n            '$q',\r\n            'ConfirmActionDialog',\r\n            'ServerAdminUpdateActionNotification',\r\n            'ServerService',\r\n            'SiteRolesUpdateActionNotification',\r\n            'SiteRoles',\r\n            'SiteUsers',\r\n            'ToasterService'];\r\n        return SetSiteUsersSiteRoleAction;\r\n    })();\r\n    VizPortal.SetSiteUsersSiteRoleAction = SetSiteUsersSiteRoleAction;\r\n    VizPortal.Module.instance().service('SetSiteUsersSiteRoleAction', SetSiteUsersSiteRoleAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var UpdateUserAuthSettingsRequest = (function (_super) {\r\n            __extends(UpdateUserAuthSettingsRequest, _super);\r\n            function UpdateUserAuthSettingsRequest(userIds, authSetting) {\r\n                _super.call(this, 'updateUserAuthSettings', { userIds: userIds, authSetting: authSetting });\r\n            }\r\n            return UpdateUserAuthSettingsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.UpdateUserAuthSettingsRequest = UpdateUserAuthSettingsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/types/ISiteUser.ts\" />\r\n/// <reference path=\"../ServerApi/requests/UpdateUserAuthSettingsRequest.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var UpdateUserAuthenticationAction = (function () {\r\n        function UpdateUserAuthenticationAction(modal) {\r\n            this.modal = modal;\r\n        }\r\n        UpdateUserAuthenticationAction.prototype.showUpdateUserAuthenticationDialog = function (siteUsersToUpdate, context) {\r\n            var scope = context.scope.$new();\r\n            scope.siteUsersToUpdate = siteUsersToUpdate;\r\n            // dialogScope.siteUsersToUpdate = siteUsersToUpdate;\r\n            var dialogInstance = this.modal.open({\r\n                scope: scope,\r\n                templateUrl: 'updateUserAuthenticationDialog.html',\r\n                controller: UpdateUserAuthenticationCtrl\r\n            });\r\n            dialogInstance.result.fin(function () { return scope.$destroy(); });\r\n            return dialogInstance.result;\r\n        };\r\n        UpdateUserAuthenticationAction.$inject = ['ModalService'];\r\n        return UpdateUserAuthenticationAction;\r\n    })();\r\n    VizPortal.UpdateUserAuthenticationAction = UpdateUserAuthenticationAction;\r\n    VizPortal.Module.instance().service('UpdateUserAuthenticationAction', UpdateUserAuthenticationAction);\r\n    var UpdateUserAuthenticationCtrl = (function () {\r\n        function UpdateUserAuthenticationCtrl($scope, $translate, toaster, server) {\r\n            this.$scope = $scope;\r\n            this.$translate = $translate;\r\n            this.toaster = toaster;\r\n            this.server = server;\r\n            $scope.defaultDisabled = _.all($scope.siteUsersToUpdate.toArray(), function (user) { return user.authSetting === VizPortal.ServerApi.SiteUserAuthSetting.Default || !user.authSetting; });\r\n            $scope.samlDisabled = !server.thirdPartyAuthState().enabled\r\n                || _.all($scope.siteUsersToUpdate.toArray(), function (user) { return user.authSetting === VizPortal.ServerApi.SiteUserAuthSetting.Saml; });\r\n            var confirm = function (authSetting) {\r\n                $scope.busy = true;\r\n                var userIds = $scope.siteUsersToUpdate.keys();\r\n                server\r\n                    .sendRequest(new VizPortal.ServerApi.UpdateUserAuthSettingsRequest(userIds, authSetting))\r\n                    .then(function (result) {\r\n                    $scope.busy = false;\r\n                    if (result.errors && result.errors.length) {\r\n                        toaster.pop({ type: VizPortal.ToastType.Error, text: $translate.instant('unexpectedError') });\r\n                        return;\r\n                    }\r\n                    $scope.close(result);\r\n                }, function (result) {\r\n                    $scope.busy = false;\r\n                    toaster.pop({ type: VizPortal.ToastType.Error, text: $translate.instant('unexpectedError') });\r\n                });\r\n            };\r\n            $scope.confirmDefault = function () { return confirm(VizPortal.ServerApi.SiteUserAuthSetting.Default); };\r\n            $scope.confirmSAML = function () { return confirm(VizPortal.ServerApi.SiteUserAuthSetting.Saml); };\r\n        }\r\n        UpdateUserAuthenticationCtrl.$inject = [\r\n            '$scope',\r\n            '$translate',\r\n            'ToasterService',\r\n            'ServerService'\r\n        ];\r\n        return UpdateUserAuthenticationCtrl;\r\n    })();\r\n    VizPortal.Module.instance().controller('UpdateUserAuthenticationCtrl', UpdateUserAuthenticationCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/ActionHelpers.ts\" />\r\n/// <reference path=\"../services/EditGroupMembershipAction.ts\" />\r\n/// <reference path=\"../services/RemoveUsersFromSiteAction.ts\" />\r\n/// <reference path=\"../services/SetSiteUsersSiteRoleAction.ts\" />\r\n/// <reference path=\"../services/UpdateUserAuthenticationAction.ts\" />\r\n/// <reference path=\"../models/IListScope.ts\" />\r\n/// <reference path=\"../models/ISiteUserInfo.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SiteUsersActions = (function () {\r\n        function SiteUsersActions(EditGroupMembershipAction, RemoveUsersFromSiteAction, SetSiteUsersSiteRoleAction, serverService, UpdateUserAuthenticationAction) {\r\n            this.EditGroupMembershipAction = EditGroupMembershipAction;\r\n            this.RemoveUsersFromSiteAction = RemoveUsersFromSiteAction;\r\n            this.SetSiteUsersSiteRoleAction = SetSiteUsersSiteRoleAction;\r\n            this.serverService = serverService;\r\n            this.UpdateUserAuthenticationAction = UpdateUserAuthenticationAction;\r\n            this.siteUsersActionDefinition = [\r\n                this.editUsersGroupMembershipAction(),\r\n                this.setSiteUsersSiteRoleAction(),\r\n                this.updateUserAuthenticationAction(),\r\n                this.removeUsersFromSiteAction()\r\n            ];\r\n        }\r\n        // Public API\r\n        SiteUsersActions.prototype.getSiteUsersActionsButtons = function () {\r\n            return this.siteUsersActionDefinition;\r\n        };\r\n        // action button factory\r\n        SiteUsersActions.prototype.editUsersGroupMembershipAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'groupMembership',\r\n                translate: 'groupMembership_action',\r\n                isAvailable: function (items) { return items.size() > 0; },\r\n                execute: function (items, context) {\r\n                    var scope = context.scope;\r\n                    _this.EditGroupMembershipAction.showEditGroupMembershipDialog(items, context)\r\n                        .then(function (result) {\r\n                        if (result) {\r\n                            VizPortal.ActionHelpers.deselectNotFound(scope.selectedItems, result, VizPortal.CommonErrorCode.SiteUserNotFound);\r\n                            scope.refreshItems();\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        SiteUsersActions.prototype.removeUsersFromSiteAction = function () {\r\n            var _this = this;\r\n            var isAvailable = this.serverService.canSessionUserManageUsers();\r\n            return {\r\n                name: 'remove',\r\n                translate: 'remove_action',\r\n                isAvailable: function (items) { return _this.canRemove(items); },\r\n                execute: function (items, context) {\r\n                    var scope = context.scope;\r\n                    _this.RemoveUsersFromSiteAction.showRemoveUsersFromSiteDialog(items, context)\r\n                        .then(function (result) {\r\n                        if (result) {\r\n                            VizPortal.ActionHelpers.deselectAllExceptErrors(scope.selectedItems, result, VizPortal.CommonErrorCode.SiteUserNotFound);\r\n                            scope.refreshItems();\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        SiteUsersActions.prototype.updateUserAuthenticationAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'authentication',\r\n                translate: 'authentication_action',\r\n                isAvailable: function (items) { return _this.canEditAuthenticationSetting(items); },\r\n                execute: function (items, context) {\r\n                    var scope = context.scope;\r\n                    _this.UpdateUserAuthenticationAction.showUpdateUserAuthenticationDialog(items, context)\r\n                        .then(function (result) {\r\n                        VizPortal.ActionHelpers.deselectNotFound(scope.selectedItems, result, VizPortal.CommonErrorCode.SiteUserNotFound);\r\n                        scope.refreshItems();\r\n                        _this.serverService.refreshSessionInfo();\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        SiteUsersActions.prototype.canEditAuthenticationSetting = function (items) {\r\n            return !items.isEmpty() && this.serverService.isThirdPartyAuthEditable();\r\n        };\r\n        // $note-ltan-1-28-2015\r\n        // Used by SiteUsersPlace and GroupUsersSubplace\r\n        SiteUsersActions.prototype.setSiteUsersSiteRoleAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'siteRole',\r\n                translate: 'siteRole_action',\r\n                isAvailable: function (items) { return _this.canChangeRole(items); },\r\n                execute: function (items, context) {\r\n                    var scope = context.scope;\r\n                    _this.SetSiteUsersSiteRoleAction.showSetSiteUsersSiteRoleDialog(items, context)\r\n                        .then(function (result) {\r\n                        VizPortal.ActionHelpers.deselectNotFound(scope.selectedItems, result, VizPortal.CommonErrorCode.SiteUserNotFound);\r\n                        scope.refreshItems();\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        // Determine if change role action is allowed.\r\n        // - Disallow if all selected users are server admins unless the current user is a Server Admin\r\n        // - Disallow if the only selection is a guest user.\r\n        // - Disallow site admins from attempting to change role of a set of all server admins\r\n        // - Disallow if session user cannot manage users\r\n        SiteUsersActions.prototype.canChangeRole = function (users) {\r\n            return ((users.size() > 0)\r\n                && !SiteUsersActions.isSingleSelectAndGuest(users)\r\n                && (!SiteUsersActions.areAllSelectedUsersServerAdmins(users) || this.serverService.isSessionServerAdmin()))\r\n                && this.serverService.canSessionUserManageUsers();\r\n        };\r\n        // Determine if remove users action is allowed.\r\n        // - Disallow if session user is not allowed (per server setting) to manage users.\r\n        // - Disallow if the only selection is a guest user.\r\n        // - Disallow site admins from attempting to remove a set of all server admins\r\n        SiteUsersActions.prototype.canRemove = function (users) {\r\n            var canManageUsers = this.serverService.canSessionUserManageUsers();\r\n            return ((users.size() > 0)\r\n                && canManageUsers\r\n                && !SiteUsersActions.isSingleSelectAndGuest(users)\r\n                && (!SiteUsersActions.areAllSelectedUsersServerAdmins(users) || this.serverService.isSessionServerAdmin()));\r\n        };\r\n        SiteUsersActions.isSingleSelectAndGuest = function (users) {\r\n            return (users.size() === 1 && users.first().siteRole === VizPortal.ServerApi.SiteRoles.Guest);\r\n        };\r\n        SiteUsersActions.areAllSelectedUsersServerAdmins = function (users) {\r\n            return _.every(users.toArray(), function (user) {\r\n                // return true if every user is server admin\r\n                return (user.siteRole === VizPortal.ServerApi.SiteRoles.ServerAdministrator);\r\n            });\r\n        };\r\n        SiteUsersActions.$inject = [\r\n            'EditGroupMembershipAction',\r\n            'RemoveUsersFromSiteAction',\r\n            'SetSiteUsersSiteRoleAction',\r\n            'ServerService',\r\n            'UpdateUserAuthenticationAction'\r\n        ];\r\n        return SiteUsersActions;\r\n    })();\r\n    VizPortal.SiteUsersActions = SiteUsersActions;\r\n    ;\r\n    VizPortal.Module.instance().service('SiteUsersActions', SiteUsersActions);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../models/IGroupDetailsInfo.ts\" />\r\n/// <reference path=\"../models/ISiteUserInfo.ts\" />\r\n/// <reference path=\"ActiveDirectoryGroupAction.ts\" />\r\n/// <reference path=\"UpdateGroupsMinimumSiteRoleAction.ts\" />\r\n/// <reference path=\"SiteUsersActions.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.GroupUsersEvent = {\r\n        usersRemoved: \"usersRemoved\",\r\n        usersAdded: \"usersAdded\"\r\n    };\r\n    var GroupActions = (function () {\r\n        function GroupActions($q, $translate, ActiveDirectoryGroupAction, AddUsersToGroupAction, CreateGroupDialogAction, DeleteGroupAction, UpdateGroupsMinimumSiteRoleAction, EditGroupMembershipAction, RemoveUsersFromGroupAction, SiteUsersActions, UpdateGroupNameAction) {\r\n            this.$q = $q;\r\n            this.$translate = $translate;\r\n            this.ActiveDirectoryGroupAction = ActiveDirectoryGroupAction;\r\n            this.AddUsersToGroupAction = AddUsersToGroupAction;\r\n            this.CreateGroupDialogAction = CreateGroupDialogAction;\r\n            this.DeleteGroupAction = DeleteGroupAction;\r\n            this.UpdateGroupsMinimumSiteRoleAction = UpdateGroupsMinimumSiteRoleAction;\r\n            this.EditGroupMembershipAction = EditGroupMembershipAction;\r\n            this.RemoveUsersFromGroupAction = RemoveUsersFromGroupAction;\r\n            this.SiteUsersActions = SiteUsersActions;\r\n            this.UpdateGroupNameAction = UpdateGroupNameAction;\r\n            this.groupsActionDefinition = [\r\n                this.syncGroupsAction(),\r\n                this.updateGroupNameAction(),\r\n                this.setGroupSiteRoleAction(),\r\n                this.deleteGroupAction()\r\n            ];\r\n            this.groupUsersActionDefinition = [\r\n                this.editUsersGroupMembershipAction(),\r\n                this.SiteUsersActions.setSiteUsersSiteRoleAction(),\r\n                this.removeUsersFromGroupAction()\r\n            ];\r\n            this.allUsersGroupUsersActionDefinition = [\r\n                this.SiteUsersActions.setSiteUsersSiteRoleAction()\r\n            ];\r\n        }\r\n        // public api\r\n        GroupActions.prototype.getGroupsActionButtons = function () {\r\n            return this.groupsActionDefinition;\r\n        };\r\n        GroupActions.prototype.getGroupUsersActionButtons = function (isAllUsersGroup) {\r\n            return isAllUsersGroup ? this.allUsersGroupUsersActionDefinition : this.groupUsersActionDefinition;\r\n        };\r\n        GroupActions.prototype.createGroup = function (dialogScope) {\r\n            return this.CreateGroupDialogAction.showCreateGroupDialog(dialogScope);\r\n        };\r\n        GroupActions.prototype.deleteGroup = function (group, dialogScope) {\r\n            var groups = new VizPortal.Set(function (group) { return group.id; });\r\n            groups.add(group);\r\n            return this.DeleteGroupAction.showDeleteGroupDialog(groups, dialogScope);\r\n        };\r\n        GroupActions.prototype.addUsersToGroup = function (group) {\r\n            return this.AddUsersToGroupAction.showAddUsersToGroupDialog(group);\r\n        };\r\n        GroupActions.prototype.renameGroup = function (group, dialogScope) {\r\n            return this.UpdateGroupNameAction.showUpdateGroupNameDialog(group, dialogScope);\r\n        };\r\n        GroupActions.prototype.syncAdGroup = function (group, dialogScope) {\r\n            return this.ActiveDirectoryGroupAction.showSyncAdGroupDialog(group, dialogScope.$new(true));\r\n        };\r\n        // action button factories\r\n        GroupActions.prototype.removeUsersFromGroupAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'remove',\r\n                translate: 'remove_action',\r\n                isAvailable: function (items) { return items.size() > 0; },\r\n                execute: function (items, context) {\r\n                    var scope = context.scope;\r\n                    _this.RemoveUsersFromGroupAction.showRemoveUsersFromGroupDialog(items, scope.group).then(function (result) {\r\n                        if (result) {\r\n                            VizPortal.ActionHelpers.deselectAllExceptErrors(scope.selectedItems, result, VizPortal.CommonErrorCode.SiteUserNotFound);\r\n                            scope.refreshItems();\r\n                            scope.$emit(VizPortal.GroupUsersEvent.usersRemoved);\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        // There is an identical action definition in SiteUsersActions.\r\n        // This one a bit different in that it clears selection in case some users get removed from\r\n        // the group (deselectAllExceptErrors). That way we won't have hidden selection lurking around.\r\n        GroupActions.prototype.editUsersGroupMembershipAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'groupMembership',\r\n                translate: 'groupMembership_action',\r\n                isAvailable: function (items) { return items.size() > 0; },\r\n                execute: function (items, context) {\r\n                    var scope = context.scope;\r\n                    _this.EditGroupMembershipAction.showEditGroupMembershipDialog(items, context)\r\n                        .then(function (result) {\r\n                        if (result) {\r\n                            VizPortal.ActionHelpers.deselectAllExceptErrors(scope.selectedItems, result, VizPortal.CommonErrorCode.SiteUserNotFound);\r\n                            scope.refreshItems();\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        GroupActions.prototype.setGroupSiteRoleAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'siteRole',\r\n                translate: 'minimumSiteRole_action',\r\n                isAvailable: function (items) { return items.size() > 0; },\r\n                isDisabled: function (items) { return items.size() === 1 && !_this.isActiveDirectoryGroup(items.first()); },\r\n                execute: function (items, context) {\r\n                    var scope = context.scope;\r\n                    _this.UpdateGroupsMinimumSiteRoleAction.showUpdateGroupsMinimumSiteRoleDialog(items, context)\r\n                        .then(function (result) {\r\n                        VizPortal.ActionHelpers.deselectNotFound(scope.selectedItems, result, VizPortal.CommonErrorCode.GroupNotFound);\r\n                        scope.refreshItems();\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        GroupActions.prototype.deleteGroupAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'delete',\r\n                translate: 'delete_action',\r\n                isAvailable: function (items) { return items.size() > 0; },\r\n                isDisabled: function (items) { return items.size() === 1 && !_this.isDeletable(items.first()); },\r\n                execute: function (items, context) {\r\n                    var scope = context.scope;\r\n                    _this.DeleteGroupAction.showDeleteGroupDialog(items, scope).then(function (result) {\r\n                        if (result) {\r\n                            VizPortal.ActionHelpers.deselectAllExceptErrors(scope.selectedItems, result, VizPortal.CommonErrorCode.GroupNotFound);\r\n                            scope.refreshItems();\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        GroupActions.prototype.updateGroupNameAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'rename',\r\n                translate: 'rename_action',\r\n                isAvailable: function (items) { return items.size() > 0; },\r\n                isDisabled: function (items) { return items.size() !== 1 || !_this.isRenamable(items.first()); },\r\n                execute: function (items, context) {\r\n                    var scope = context.scope;\r\n                    _this.UpdateGroupNameAction.showUpdateGroupNameDialog(items.first(), scope).then(function (result) {\r\n                        if (result) {\r\n                            VizPortal.ActionHelpers.deselectNotFound(scope.selectedItems, result, VizPortal.CommonErrorCode.GroupNotFound);\r\n                            scope.refreshItems();\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        GroupActions.prototype.syncGroupsAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'synchronize',\r\n                translate: 'synchronize_action',\r\n                isAvailable: function (items) { return items.size() > 0; },\r\n                isDisabled: function (items) { return items.size() === 1 && !_this.isSyncable(items.first()); },\r\n                execute: function (items, context) {\r\n                    var scope = context.scope;\r\n                    _this.ActiveDirectoryGroupAction.showSyncAdGroupsDialog(items.toArray(), context.scope).then(function (result) {\r\n                        if (result) {\r\n                            VizPortal.ActionHelpers.deselectNotFound(scope.selectedItems, result, VizPortal.CommonErrorCode.GroupNotFound);\r\n                            scope.refreshItems();\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        // returns true if the given group can be deleted\r\n        GroupActions.prototype.isDeletable = function (group) {\r\n            return !group.isAllUsersGroup;\r\n        };\r\n        // returns true if the given group can be renamed\r\n        GroupActions.prototype.isRenamable = function (group) {\r\n            return !group.isAllUsersGroup && !this.isActiveDirectoryGroup(group);\r\n        };\r\n        // returns true if the given group can be synced from active directory\r\n        GroupActions.prototype.isSyncable = function (group) {\r\n            return !group.isAllUsersGroup && this.isActiveDirectoryGroup(group);\r\n        };\r\n        // returns true if the given group is not local\r\n        GroupActions.prototype.isActiveDirectoryGroup = function (group) {\r\n            return VizPortal.Groups.isActiveDirectory(group);\r\n        };\r\n        GroupActions.$inject = ['$q',\r\n            '$translate',\r\n            'ActiveDirectoryGroupAction',\r\n            'AddUsersToGroupAction',\r\n            'CreateGroupDialogAction',\r\n            'DeleteGroupAction',\r\n            'UpdateGroupsMinimumSiteRoleAction',\r\n            'EditGroupMembershipAction',\r\n            'RemoveUsersFromGroupAction',\r\n            'SiteUsersActions',\r\n            'UpdateGroupNameAction'];\r\n        return GroupActions;\r\n    })();\r\n    VizPortal.GroupActions = GroupActions;\r\n    VizPortal.Module.instance().service('GroupActions', GroupActions);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../resources/Groups.ts\" />\r\n/// <reference path=\"../resources/SiteRoles.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetGroupDetailsRequest.ts\" />\r\n/// <reference path=\"../services/BrowserTitleService.ts\" />\r\n/// <reference path=\"../services/GroupActions.ts\" />\r\n/// <reference path=\"../services/UpdateGroupsMinimumSiteRoleAction.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var GroupDetailsCtrl = (function () {\r\n        function GroupDetailsCtrl($scope, $state, BrowserTitleService, canSessionUserManageUsers, groupDetails, groupActions, serverService, updateGroupsMinimumSiteRoleAction) {\r\n            var _this = this;\r\n            this.$scope = $scope;\r\n            this.$state = $state;\r\n            this.groupDetails = groupDetails;\r\n            this.groupActions = groupActions;\r\n            BrowserTitleService.setTitle('details', $scope.objectName);\r\n            $scope.canSessionUserManageUsers = canSessionUserManageUsers;\r\n            this.$scope.groupDetailsModel = {\r\n                domainName: groupDetails.domainName,\r\n                createdAt: groupDetails.createdAt,\r\n                updatedAt: groupDetails.updatedAt,\r\n                isAllUsersGroup: groupDetails.isAllUsersGroup,\r\n                minimumSiteRole: groupDetails.minimumSiteRole\r\n            };\r\n            this.$scope.isLocalGroup = function () {\r\n                var domainName = _this.$scope.groupDetailsModel.domainName;\r\n                return !(domainName && domainName !== 'local');\r\n            };\r\n            this.$scope.isAllUsersGroup = function () {\r\n                return _this.$scope.groupDetailsModel.isAllUsersGroup || false;\r\n            };\r\n            this.$scope.deleteGroup = function ($event) {\r\n                _this.groupActions.deleteGroup(groupDetails, _this.$scope).then(function () {\r\n                    $state.go('main.site.groups');\r\n                });\r\n            };\r\n            $scope.allowMinimumSiteRole = serverService.isServerDomainFamilyActiveDirectory()\r\n                && VizPortal.Groups.isActiveDirectory(groupDetails);\r\n            if ($scope.allowMinimumSiteRole) {\r\n                $scope.isEditingMinimumSiteRole = false;\r\n                $scope.siteRoleOptions = VizPortal.SiteRoles.WithoutGuestOrServerAdmin;\r\n                $scope.editSiteRole = function () {\r\n                    $scope.isEditingMinimumSiteRole = true;\r\n                    $scope.isSavingMinimumSiteRole = false;\r\n                };\r\n                var resetEditSiteRole = function () {\r\n                    $scope.isEditingMinimumSiteRole = false;\r\n                    $scope.groupDetailsModel.minimumSiteRole = groupDetails.minimumSiteRole;\r\n                };\r\n                $scope.saveSiteRole = function () {\r\n                    $scope.isSavingMinimumSiteRole = true;\r\n                    var savingMinimumSiteRole = $scope.groupDetailsModel.minimumSiteRole;\r\n                    updateGroupsMinimumSiteRoleAction.executeInPlace(groupDetails, savingMinimumSiteRole)\r\n                        .then(function () {\r\n                        groupDetails.minimumSiteRole = savingMinimumSiteRole;\r\n                        resetEditSiteRole();\r\n                    })\r\n                        .fin(function () {\r\n                        $scope.isSavingMinimumSiteRole = false;\r\n                    });\r\n                };\r\n                $scope.cancelSiteRole = resetEditSiteRole;\r\n            }\r\n        }\r\n        GroupDetailsCtrl.$inject = [\r\n            '$scope',\r\n            '$state',\r\n            'BrowserTitleService',\r\n            'canSessionUserManageUsers',\r\n            'groupDetails',\r\n            'GroupActions',\r\n            'ServerService',\r\n            'UpdateGroupsMinimumSiteRoleAction'\r\n        ];\r\n        return GroupDetailsCtrl;\r\n    })();\r\n    VizPortal.GroupDetailsCtrl = GroupDetailsCtrl;\r\n    VizPortal.Module.instance().controller('GroupDetailsCtrl', GroupDetailsCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/resourceInfoParts.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../../app/IMainScope.ts\" />\r\n/// <reference path=\"../helpers/SubplaceCountsHelper.ts\" />\r\n/// <reference path=\"../models/IGroupInfo.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../resources/Groups.ts\" />\r\n/// <reference path=\"../services/BreadcrumbsService.ts\" />\r\n/// <reference path=\"../services/GroupActions.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var GroupPlaceCtrl = (function () {\r\n        function GroupPlaceCtrl($scope, $state, breadcrumbs, group, groupsResource, groupActions, serverService) {\r\n            var _this = this;\r\n            this.$scope = $scope;\r\n            this.$state = $state;\r\n            this.groupsResource = groupsResource;\r\n            this.groupActions = groupActions;\r\n            this.serverService = serverService;\r\n            $scope.objectName = group.name;\r\n            $scope.group = group;\r\n            $scope.$on(VizPortal.GroupUsersEvent.usersAdded, function () {\r\n                _this.refreshGroup();\r\n            });\r\n            $scope.$on(VizPortal.GroupUsersEvent.usersRemoved, function () {\r\n                _this.refreshGroup();\r\n            });\r\n            $scope.$on(VizPortal.SyncGroupEvent.groupSynced, function () {\r\n                _this.refreshGroup();\r\n            });\r\n            $scope.$on(VizPortal.GroupMembershipEvent.MembershipChanged, function () {\r\n                _this.refreshGroup();\r\n            });\r\n            $scope.groupsBreadcrumbUrl = function () { return breadcrumbs.groupsUrl\r\n                ? '#' + breadcrumbs.groupsUrl\r\n                : _this.$state.href('main.site.groups'); };\r\n            $scope.canRename =\r\n                function () { return !group.isAllUsersGroup && !_this.isActiveDirectoryGroup(group); };\r\n            $scope.rename = function ($event) {\r\n                _this.groupActions.renameGroup(group, $scope)\r\n                    .then(function () { return _this.$state.hardReload(); });\r\n            };\r\n            $scope.canSynchronize =\r\n                function () { return _this.serverService.canSessionUserManageUsers() && !group.isAllUsersGroup && _this.isActiveDirectoryGroup(group); };\r\n            $scope.synchronize = function ($event) {\r\n                _this.groupActions.syncAdGroup(group, _this.$scope)\r\n                    .then(function () {\r\n                    _this.refreshGroup();\r\n                    $scope.$broadcast(VizPortal.SubplaceEvents.Refresh, \"users\");\r\n                });\r\n            };\r\n            // handles refreshing the tab count and subplace\r\n            $scope.subplaceTabClicked = function (name) {\r\n                if (name === \"users\") {\r\n                    _this.refreshGroup();\r\n                    $scope.$broadcast(VizPortal.SubplaceEvents.Refresh, name);\r\n                }\r\n            };\r\n        }\r\n        // fetch the latest group data from server\r\n        GroupPlaceCtrl.prototype.refreshGroup = function () {\r\n            var _this = this;\r\n            this.groupsResource.getById(this.$scope.group.id).then(function (group) {\r\n                if (group) {\r\n                    _this.$scope.group = group;\r\n                }\r\n                else {\r\n                    // Group may have been deleted, or permissions changed, so do a hard reload\r\n                    _this.$state.hardReload();\r\n                }\r\n            });\r\n        };\r\n        // returns true if the given group is not local\r\n        GroupPlaceCtrl.prototype.isActiveDirectoryGroup = function (group) {\r\n            return (group.domainName && group.domainName !== 'local');\r\n        };\r\n        GroupPlaceCtrl.$inject = [\r\n            '$scope',\r\n            '$state',\r\n            'BreadcrumbsService',\r\n            'group',\r\n            'Groups',\r\n            'GroupActions',\r\n            'ServerService'\r\n        ];\r\n        return GroupPlaceCtrl;\r\n    })();\r\n    VizPortal.GroupPlaceCtrl = GroupPlaceCtrl;\r\n    VizPortal.Module.instance().controller('GroupPlaceCtrl', GroupPlaceCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/ActiveDirectoryGroupAction.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var AddGroupsOptionsAction = (function () {\r\n        function AddGroupsOptionsAction(modal) {\r\n            this.modal = modal;\r\n        }\r\n        AddGroupsOptionsAction.prototype.showAddGroupsOptionsDialog = function (context) {\r\n            var dialogInstance = this.modal.open({\r\n                scope: context.scope,\r\n                templateUrl: 'addGroupsOptionsDialog.html',\r\n                size: VizPortal.ModalSize.fitToContent,\r\n                position: _.extend(VizPortal.ModalService.anchoredTo(context.targetElement), { reserveHeight: AddGroupsOptionsAction.reserveHeight }),\r\n                controller: AddGroupsOptionsDialogCtrl\r\n            });\r\n            return dialogInstance.result;\r\n        };\r\n        AddGroupsOptionsAction.$inject = ['ModalService'];\r\n        AddGroupsOptionsAction.reserveHeight = 450;\r\n        return AddGroupsOptionsAction;\r\n    })();\r\n    VizPortal.AddGroupsOptionsAction = AddGroupsOptionsAction;\r\n    VizPortal.Module.instance().service('AddGroupsOptionsAction', AddGroupsOptionsAction);\r\n    var AddGroupsOptionsDialogCtrl = (function () {\r\n        function AddGroupsOptionsDialogCtrl($scope, createGroupDialogAction, activeDirectoryGroupAction) {\r\n            this.createGroupDialogAction = createGroupDialogAction;\r\n            this.activeDirectoryGroupAction = activeDirectoryGroupAction;\r\n            $scope.addLocalGroup = function () {\r\n                // Note: The order here is important, because $scope.close() will destroy the scope.\r\n                // The promise is passed through so an action can be taken when the group creation is complete.\r\n                var promise = createGroupDialogAction.showCreateGroupDialog($scope.$parent);\r\n                $scope.close(promise);\r\n            };\r\n            $scope.importAdGroup = function () {\r\n                // Note: The order here is important, because $scope.close() will destroy the scope.\r\n                activeDirectoryGroupAction.showAddAdGroupDialog($scope.$parent);\r\n                $scope.close({});\r\n            };\r\n        }\r\n        AddGroupsOptionsDialogCtrl.$inject = [\r\n            '$scope',\r\n            'CreateGroupDialogAction',\r\n            'ActiveDirectoryGroupAction'];\r\n        return AddGroupsOptionsDialogCtrl;\r\n    })();\r\n    VizPortal.AddGroupsOptionsDialogCtrl = AddGroupsOptionsDialogCtrl;\r\n    VizPortal.Module.instance().controller('AddGroupsOptionsDialogCtrl', AddGroupsOptionsDialogCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../../ts/libs.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var ActionsMenuColumnCell = (function (_super) {\r\n        __extends(ActionsMenuColumnCell, _super);\r\n        function ActionsMenuColumnCell() {\r\n            _super.apply(this, arguments);\r\n        }\r\n        ActionsMenuColumnCell.prototype.render = function () {\r\n            var _this = this;\r\n            var actions = this.props.actions;\r\n            var translate = this.props.translate;\r\n            var getActionTarget = this.props.getActionTarget;\r\n            var menu = VizPortalReact.Menu.element({\r\n                ref: 'menu',\r\n                menuButtonFactory: function (props) {\r\n                    return ActionsMenuColumnCell.MenuButton.element(props);\r\n                },\r\n                // TODO: refactor this into a common component. Similar code in SelectableSortKeyDataGridColumn's menu panel.\r\n                menuPanelFactory: function (props) {\r\n                    var actionTarget = getActionTarget();\r\n                    var menuItems = _.map(_.filter(actions, function (action) { return action.isAvailable(actionTarget.items, actionTarget.detailedItem, actionTarget.allowedActions); }), function (action) {\r\n                        var disabled = action.isDisabled && action.isDisabled(actionTarget.items, actionTarget.detailedItem, actionTarget.allowedActions);\r\n                        return React.DOM.div({\r\n                            className: 'tb-popup-menu-item' + (disabled ? ' tb-disabled' : ''),\r\n                            'data-tb-test-id': 'action-' + action.name,\r\n                            onClick: function () {\r\n                                _this.refs['menu'].closeMenu();\r\n                                if (!disabled) {\r\n                                    action.execute(actionTarget.items, actionTarget.actionContext, actionTarget.detailedItem);\r\n                                }\r\n                            }\r\n                        }, translate(action.translate || action.name));\r\n                    });\r\n                    return React.DOM.div({\r\n                        className: 'tb-popup-menu-content tb-padded-small'\r\n                    }, menuItems);\r\n                }\r\n            });\r\n            return React.DOM.div({\r\n                style: {\r\n                    position: 'relative'\r\n                },\r\n                'data-tb-test-id': this.props.testId\r\n            }, \r\n            // Left part - the cell contents\r\n            React.DOM.div({\r\n                style: {\r\n                    // Reserve enough space for the action menu button and padding\r\n                    marginRight: VizPortalReact.DataGrid.BodyRow.InnerHeight + VizPortalReact.CommonStyles.Sizes.DefaultSpace,\r\n                    overflow: 'hidden',\r\n                    textOverflow: 'ellipsis'\r\n                }\r\n            }, this.props.children), \r\n            // Right part - the actions menu\r\n            React.DOM.div({\r\n                style: {\r\n                    position: 'absolute',\r\n                    right: 0,\r\n                    top: 0\r\n                }\r\n            }, menu));\r\n        };\r\n        ActionsMenuColumnCell.displayName = 'ActionsMenuColumnCell';\r\n        ActionsMenuColumnCell.element = React.createFactory(ActionsMenuColumnCell);\r\n        return ActionsMenuColumnCell;\r\n    })(React.Component);\r\n    VizPortalReact.ActionsMenuColumnCell = ActionsMenuColumnCell;\r\n    var ActionsMenuColumnCell;\r\n    (function (ActionsMenuColumnCell) {\r\n        var MenuButton = (function (_super) {\r\n            __extends(MenuButton, _super);\r\n            function MenuButton() {\r\n                _super.apply(this, arguments);\r\n            }\r\n            MenuButton.prototype.render = function () {\r\n                var highlight = this.props.hovered || this.props.menuOpen;\r\n                return React.DOM.span({\r\n                    // Using 'tb-selected' for highlight, because opacity is difficult to achieve\r\n                    // in a cross-browser way using React inline css.\r\n                    className: 'tb-action-icon tb-data-grid-action-menu' + (highlight ? ' tb-selected' : '')\r\n                });\r\n            };\r\n            MenuButton.displayName = 'MenuButton';\r\n            MenuButton.element = React.createFactory(MenuButton);\r\n            return MenuButton;\r\n        })(React.Component);\r\n        ActionsMenuColumnCell.MenuButton = MenuButton;\r\n    })(ActionsMenuColumnCell = VizPortalReact.ActionsMenuColumnCell || (VizPortalReact.ActionsMenuColumnCell = {}));\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    /*\r\n     * SparseCachedList\r\n     *\r\n     * Caches (possibly sparse) blocks of data\r\n     *\r\n     */\r\n    var SparseCachedList = (function () {\r\n        function SparseCachedList(sliceable, transform, blockSize) {\r\n            if (blockSize === void 0) { blockSize = SparseCachedList.DefaultBlockSize; }\r\n            this.sliceable = sliceable;\r\n            this.transform = transform;\r\n            this.blockSize = blockSize;\r\n            this.cachedData = null;\r\n            this.fetching = [];\r\n        }\r\n        // Fetches blocks as necessary to cover the range from 'start' to 'end'.\r\n        // Returns the entire cached data array.\r\n        SparseCachedList.prototype.getItems = function (start, end) {\r\n            var _this = this;\r\n            start = Math.max(start, 0);\r\n            if (this.cachedData) {\r\n                // Empty data-set\r\n                if (this.cachedData.length === 0) {\r\n                    return Q.when(this.cachedData);\r\n                }\r\n                end = Math.min(end, this.cachedData.length - 1);\r\n            }\r\n            var fetches = [];\r\n            var blockSize = this.blockSize;\r\n            var firstBlockToFetch = Math.floor(start / blockSize);\r\n            var lastBlockToFetch = Math.floor(end / blockSize);\r\n            for (var blockIndex = firstBlockToFetch; blockIndex <= lastBlockToFetch; blockIndex++) {\r\n                if (this.fetching[blockIndex] !== true) {\r\n                    this.fetching[blockIndex] = true;\r\n                    fetches.push(this.fetchBlock(blockIndex));\r\n                }\r\n            }\r\n            return Q.all(fetches).then(function () {\r\n                return _this.cachedData;\r\n            });\r\n        };\r\n        SparseCachedList.prototype.fetchBlock = function (blockIndex) {\r\n            var _this = this;\r\n            return Q(this.sliceable.getSlice(blockIndex * this.blockSize, this.blockSize))\r\n                .then(function (result) {\r\n                // Update fetched data\r\n                // CONSIDER: use List from immutable.js to avoid expensive copying\r\n                var newCachedData = _.clone(_this.cachedData || []);\r\n                newCachedData.length = result.total;\r\n                for (var i = 0; i < result.items.length; i++) {\r\n                    newCachedData[result.index + i] = _this.transform(result.items[i]);\r\n                }\r\n                _this.cachedData = newCachedData;\r\n                return newCachedData;\r\n            });\r\n        };\r\n        SparseCachedList.DefaultBlockSize = 1000;\r\n        return SparseCachedList;\r\n    })();\r\n    VizPortalReact.SparseCachedList = SparseCachedList;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../controllers/AngularCtrl.ts\" />\r\n/// <reference path=\"../controllers/ContentPlaceCtrl.ts\" />\r\n/// <reference path=\"../controllers/FilterPanelCtrl.ts\" />\r\n/// <reference path=\"../helpers/ActionButtonsHelper.ts\" />\r\n/// <reference path=\"../models/ContentTypes.ts\" />\r\n/// <reference path=\"../models/ISliceable.ts\" />\r\n/// <reference path=\"../models/ITabsBannerModel.ts\" />\r\n/// <reference path=\"../models/ITemplate.ts\" />\r\n/// <reference path=\"../models/Set.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/types/IGroup.ts\" />\r\n/// <reference path=\"../services/AddGroupsOptionsAction.ts\" />\r\n/// <reference path=\"../services/BreadcrumbsService.ts\" />\r\n/// <reference path=\"../services/BrowserTitleService.ts\" />\r\n/// <reference path=\"../services/QueryService.ts\" />\r\n/// <reference path=\"../services/SelectionService.ts\" />\r\n/// <reference path=\"../services/SorterFactory.ts\" />\r\n/// <reference path=\"../../common/react/components/dataGrid/DataGrid.ts\" />\r\n/// <reference path=\"../../common/react/components/dataGrid/DataGridCells.ts\" />\r\n/// <reference path=\"../../common/react/components/ActionsMenuColumnCell.ts\" />\r\n/// <reference path=\"../../common/react/CommonDataGridColumns.ts\" />\r\n/// <reference path=\"../../common/react/SparseCachedList.ts\" />\r\n/// <reference path=\"../../ts/FeatureFlags.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var GroupsPlaceCtrl = (function () {\r\n        function GroupsPlaceCtrl($location, $scope, $translate, AngularToReactDataGridBridge, breadcrumbs, BrowserTitleService, groups, groupActions, addGroupsOptionsAction, queryService, SelectionService, SorterFactory, ServerService, AngularContextFactory, filterPanelService) {\r\n            var _this = this;\r\n            this.$scope = $scope;\r\n            this.$translate = $translate;\r\n            this.AngularToReactDataGridBridge = AngularToReactDataGridBridge;\r\n            this.groups = groups;\r\n            this.groupActions = groupActions;\r\n            this.addGroupsOptionsAction = addGroupsOptionsAction;\r\n            this.queryService = queryService;\r\n            this.ServerService = ServerService;\r\n            this.AngularContextFactory = AngularContextFactory;\r\n            this.filterPanelService = filterPanelService;\r\n            var isActiveDirectory = this.ServerService.isServerDomainFamilyActiveDirectory();\r\n            var canSessionUserManageUsers = this.ServerService.canSessionUserManageUsers();\r\n            var showMinimumSiteRole = isActiveDirectory;\r\n            $scope.reactDataGridInGroupsPlace = VizPortal.FeatureFlags.reactDataGridInGroupsPlace;\r\n            BrowserTitleService.setTitle('groups');\r\n            $scope.model = { itemsCount: 0 };\r\n            $scope.selectedItems = new VizPortal.Set(function (group) { return group.id; });\r\n            if (VizPortal.FeatureFlags.reactDataGridInGroupsPlace) {\r\n                this.configureForReactDataGrid(showMinimumSiteRole);\r\n            }\r\n            $scope.rowClicked = function (row, colIndex) {\r\n                SelectionService.rowClicked($scope.selectedItems, row, colIndex);\r\n            };\r\n            $scope.filterControls = {};\r\n            $scope.filterDefinitions = showMinimumSiteRole\r\n                ? filterPanelService.getFilterDefinitions(['groupsMinimumSiteRole'])\r\n                : [];\r\n            $scope.sorter = SorterFactory.create(VizPortal.GroupContentType.defaultOrder);\r\n            var queryUpdater = this.createQueryUpdater();\r\n            $scope.sliceChanged = function (newSlice) {\r\n                $scope.selectedItems.updateItems(newSlice.items);\r\n                $scope.model.itemsCount = newSlice.total;\r\n            };\r\n            $scope.refreshItems = function () {\r\n                queryUpdater.refresh();\r\n            };\r\n            $scope.refreshItems();\r\n            $scope.placeTitleClicked = function () {\r\n                $scope.refreshItems();\r\n            };\r\n            $scope.$on(VizPortal.SyncGroupEvent.groupSynced, $scope.refreshItems);\r\n            $scope.headerClicked = function (header) { return $scope.sorter.setPrimary(header.attrs['key'], header.attrs['direction']); };\r\n            $scope.getDomainString = function (row) {\r\n                return row.domainName || $translate.instant('localDomain');\r\n            };\r\n            $scope.isAD = isActiveDirectory;\r\n            $scope.availableAction = function (action) { return action.isAvailable($scope.selectedItems); };\r\n            VizPortal.ActionButtonsHelper.setupActionButtons($scope, groupActions.getGroupsActionButtons());\r\n            $scope.listActions = [\r\n                {\r\n                    name: 'add-groups',\r\n                    translate: 'addGroups',\r\n                    isAvailable: function () { return (isActiveDirectory && canSessionUserManageUsers); },\r\n                    execute: function ($event) {\r\n                        addGroupsOptionsAction.showAddGroupsOptionsDialog(VizPortal.ActionContext.fromEvent($event))\r\n                            .then(function (result) {\r\n                            $scope.refreshItems();\r\n                        });\r\n                    }\r\n                },\r\n                {\r\n                    name: 'create-group',\r\n                    translate: 'createGroup',\r\n                    isAvailable: function () { return !(isActiveDirectory && canSessionUserManageUsers); },\r\n                    execute: function ($event) {\r\n                        _this.groupActions.createGroup($scope).then(function (result) {\r\n                            $scope.refreshItems();\r\n                        });\r\n                    }\r\n                }\r\n            ];\r\n            $scope.availableListAction = function (listAction) { return listAction.isAvailable(); };\r\n            breadcrumbs.rememberGroupsUrl($location.url());\r\n            $scope.$on('$locationChangeSuccess', function () {\r\n                var path = $location.path();\r\n                if (/^(\\/site\\/[^\\/]+)?\\/groups(\\/)?$/.test(path)) {\r\n                    breadcrumbs.rememberGroupsUrl($location.url());\r\n                }\r\n            });\r\n            $scope.emptyTemplateModel = GroupsPlaceCtrl.emptyTemplateModel;\r\n            $scope.showMinimumSiteRole = showMinimumSiteRole;\r\n        }\r\n        GroupsPlaceCtrl.prototype.configureForReactDataGrid = function (showMinimumSiteRole) {\r\n            var columns = this.dataGridColumns(this.$scope, showMinimumSiteRole);\r\n            this.AngularToReactDataGridBridge.attachReactDataGridToScope(this.$scope, columns, GroupsPlaceCtrl.emptyTemplateModel);\r\n        };\r\n        GroupsPlaceCtrl.prototype.createQueryUpdater = function () {\r\n            var _this = this;\r\n            if (VizPortal.FeatureFlags.reactDataGridInGroupsPlace) {\r\n                return this.queryService.createQueryUpdater(this.$scope, VizPortal.GroupContentType, this.groups, function (resourceQuery) {\r\n                    _this.AngularToReactDataGridBridge.updateReactDataGridRowStore({ scope: _this.$scope, sliceable: resourceQuery });\r\n                    _this.$scope.sliceable = resourceQuery;\r\n                    _this.$scope.sorter.setOrder(resourceQuery.getOrder());\r\n                    resourceQuery.getCount().then(function (result) {\r\n                        _this.$scope.model.itemsCount = result;\r\n                    });\r\n                }, {});\r\n            }\r\n            else {\r\n                return this.queryService.createQueryUpdater(this.$scope, VizPortal.GroupContentType, this.groups, function (resourceQuery) {\r\n                    _this.$scope.sliceable = resourceQuery;\r\n                    resourceQuery.getCount().then(function (result) {\r\n                        _this.$scope.model.itemsCount = result;\r\n                    });\r\n                }, {});\r\n            }\r\n        };\r\n        // TODO: move this into a GroupGrid class (like WorkbookGrid etc.)\r\n        GroupsPlaceCtrl.prototype.dataGridColumns = function ($scope, showMinimumSiteRole) {\r\n            // Group name column\r\n            var groupNameColumn = {\r\n                name: 'name-col',\r\n                dataKey: 'name',\r\n                text: this.$translate.instant('column_name'),\r\n                direction: 'asc',\r\n                cellFormatter: this.groupNameCellFormatter($scope),\r\n                cellStyle: {\r\n                    paddingRight: 0,\r\n                    verticalAlign: 'top',\r\n                    overflow: 'visible'\r\n                }\r\n            };\r\n            var columns = [\r\n                VizPortalReact.CommonDataGridColumns.selected($scope),\r\n                groupNameColumn\r\n            ];\r\n            if (this.ServerService.isServerDomainFamilyActiveDirectory()) {\r\n                columns.push({\r\n                    name: 'domain-name-col',\r\n                    dataKey: 'domainName',\r\n                    direction: 'asc',\r\n                    text: this.$translate.instant('column_domainName')\r\n                });\r\n            }\r\n            columns.push({\r\n                name: 'user-count-col',\r\n                dataKey: 'userCount',\r\n                text: this.$translate.instant('column_userCount'),\r\n                direction: 'asc',\r\n                cellFormatter: VizPortalReact.DataGridCells.LocalizedCount('userCount'),\r\n                headerStyle: { textAlign: 'right' },\r\n                cellStyle: { textAlign: 'right' }\r\n            });\r\n            if (showMinimumSiteRole) {\r\n                columns.push({\r\n                    name: 'min-site-role-col',\r\n                    dataKey: 'minimumSiteRole',\r\n                    text: this.$translate.instant('column_minimumSiteRole'),\r\n                    cellFormatter: VizPortalReact.DataGridCells.SiteRoleCell('minimumSiteRole', this.$translate),\r\n                    direction: 'asc'\r\n                });\r\n            }\r\n            return columns;\r\n        };\r\n        GroupsPlaceCtrl.prototype.groupNameCellFormatter = function ($scope) {\r\n            var siteUrls = new VizPortalReact.SiteUrls({\r\n                siteUrlName: this.ServerService.sessionSiteUrlName(),\r\n                queryString: window.location.search\r\n            });\r\n            var actions = this.groupActions.getGroupsActionButtons();\r\n            var $translate = this.$translate;\r\n            return React.createFactory(React.createClass({\r\n                render: function () {\r\n                    return VizPortalReact.ActionsMenuColumnCell.element({\r\n                        actions: actions,\r\n                        getActionTarget: function () {\r\n                            return {\r\n                                items: $scope.selectedItems,\r\n                                actionContext: { scope: $scope }\r\n                            };\r\n                        },\r\n                        translate: function (id) { return $translate.instant(id); }\r\n                    }, React.DOM.span({ className: 'tb-grid-icon-group' }), React.DOM.a({ href: siteUrls.group(this.props.row.data.id) }, this.props.value));\r\n                }\r\n            }));\r\n        };\r\n        GroupsPlaceCtrl.$inject = [\r\n            '$location',\r\n            '$scope',\r\n            '$translate',\r\n            'AngularToReactDataGridBridge',\r\n            'BreadcrumbsService',\r\n            'BrowserTitleService',\r\n            'Groups',\r\n            'GroupActions',\r\n            'AddGroupsOptionsAction',\r\n            'QueryService',\r\n            'SelectionService',\r\n            'SorterFactory',\r\n            'ServerService',\r\n            'AngularContextFactory',\r\n            'FilterPanelService'\r\n        ];\r\n        GroupsPlaceCtrl.emptyTemplateModel = { title: 'groupsEmptyMessage' };\r\n        return GroupsPlaceCtrl;\r\n    })();\r\n    VizPortal.GroupsPlaceCtrl = GroupsPlaceCtrl;\r\n    VizPortal.Module.instance().controller('GroupsPlaceCtrl', GroupsPlaceCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/CommonDataGridColumns.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var GroupUsersGrid;\r\n    (function (GroupUsersGrid) {\r\n        function columns(translate, scope, siteUrls, siteRoleFilter, actions) {\r\n            var columns = [\r\n                VizPortalReact.CommonDataGridColumns.selected(scope),\r\n                nameColumn(translate, siteUrls, actions, scope),\r\n                {\r\n                    name: 'username-col',\r\n                    dataKey: 'username',\r\n                    text: translate('column_username'),\r\n                    direction: 'asc'\r\n                },\r\n                {\r\n                    name: 'siteRole-col',\r\n                    dataKey: 'siteRole',\r\n                    text: translate('column_site_role'),\r\n                    direction: 'asc',\r\n                    cellFormatter: VizPortalReact.DataGridCells.PlainTextCellWithTransform('siteRole', function (siteRole) { return siteRoleFilter(siteRole); })\r\n                },\r\n                {\r\n                    name: 'lastSignIn-col',\r\n                    dataKey: 'lastSignIn',\r\n                    text: translate('column_last_sign_in'),\r\n                    direction: 'desc',\r\n                    cellFormatter: VizPortalReact.DataGridCells.DateTimeCell('lastSignIn')\r\n                }\r\n            ];\r\n            return columns;\r\n        }\r\n        GroupUsersGrid.columns = columns;\r\n        function nameColumn(translate, siteUrls, actions, scope) {\r\n            var disabledStyle = {\r\n                color: VizPortalReact.CommonStyles.Colors.Grey102,\r\n                textDecoration: 'none',\r\n                pointerEvents: 'none'\r\n            };\r\n            var isDisabled = function (row) {\r\n                var user = row.data;\r\n                return user.readOnly || user.siteRole === 'Guest';\r\n            };\r\n            return VizPortalReact.CommonDataGridColumns.withActions({\r\n                name: 'displayName-col',\r\n                dataKey: 'displayName',\r\n                text: translate('column_fullName'),\r\n                direction: 'asc',\r\n                cellFormatter: VizPortalReact.DataGridCells.Link(function (row) {\r\n                    var disabled = isDisabled(row);\r\n                    var user = row.data;\r\n                    return {\r\n                        text: user.displayName,\r\n                        url: disabled ? null : siteUrls.userContentUrl(user),\r\n                        style: disabled ? disabledStyle : null,\r\n                        iconClassName: 'tb-grid-icon-user',\r\n                        iconTitle: translate('user')\r\n                    };\r\n                })\r\n            }, {\r\n                actions: actions,\r\n                getActionTarget: function () {\r\n                    return {\r\n                        items: scope.selectedItems,\r\n                        actionContext: { scope: scope }\r\n                    };\r\n                },\r\n                translate: translate,\r\n                scope: scope,\r\n                menuDisabled: isDisabled\r\n            });\r\n        }\r\n    })(GroupUsersGrid = VizPortalReact.GroupUsersGrid || (VizPortalReact.GroupUsersGrid = {}));\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../../app/content/GroupUsersGrid.ts\" />\r\n/// <reference path=\"../../common/react/components/dataGrid/AngularToReactDataGridBridge.ts\" />\r\n/// <reference path=\"../controllers/GroupPlaceCtrl.ts\" />\r\n/// <reference path=\"../helpers/ActionButtonsHelper.ts\" />\r\n/// <reference path=\"../helpers/SubplaceCountsHelper.ts\" />\r\n/// <reference path=\"../models/IEmptyTemplate.ts\" />\r\n/// <reference path=\"../models/ITemplate.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/BrowserTitleService.ts\" />\r\n/// <reference path=\"../services/GroupActions.ts\" />\r\n/// <reference path=\"../services/QueryService.ts\" />\r\n/// <reference path=\"../services/SelectionService.ts\" />\r\n/// <reference path=\"../services/SorterFactory.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var GroupUsersSubplaceCtrl = (function () {\r\n        function GroupUsersSubplaceCtrl($scope, $translate, AngularToReactDataGridBridge, siteRoleFilter, ServerService, BrowserTitleService, SorterFactory, users, group, queryService, selectionService, groupActions) {\r\n            var _this = this;\r\n            this.$scope = $scope;\r\n            this.$translate = $translate;\r\n            this.AngularToReactDataGridBridge = AngularToReactDataGridBridge;\r\n            this.siteRoleFilter = siteRoleFilter;\r\n            this.ServerService = ServerService;\r\n            var actions = groupActions.getGroupUsersActionButtons(group.isAllUsersGroup);\r\n            if (VizPortal.FeatureFlags.reactGroupUsersGrid) {\r\n                this.configureForReactDataGrid(actions);\r\n            }\r\n            BrowserTitleService.setTitle('members', group.name);\r\n            $scope.group = group;\r\n            // selection\r\n            $scope.selectedItems = new VizPortal.Set(function (user) { return user.id; });\r\n            $scope.rowClicked = function (row, colIndex) {\r\n                selectionService.rowClicked($scope.selectedItems, row, colIndex);\r\n            };\r\n            // query\r\n            var queryUpdater = queryService.createQueryUpdater($scope, VizPortal.GroupUserContentType, users, function (resourceQuery) {\r\n                if (VizPortal.FeatureFlags.reactGroupUsersGrid) {\r\n                    _this.AngularToReactDataGridBridge.updateReactDataGridRowStore({ scope: $scope, sliceable: resourceQuery });\r\n                }\r\n                $scope.sliceable = resourceQuery;\r\n            }, { inGroup: group.id });\r\n            // refresh\r\n            $scope.refreshItems = function () {\r\n                queryUpdater.refresh();\r\n            };\r\n            $scope.refreshItems();\r\n            $scope.$on(VizPortal.SubplaceEvents.Refresh, function () {\r\n                $scope.refreshItems();\r\n            });\r\n            // sorting\r\n            $scope.sorter = SorterFactory.create(VizPortal.GroupUserContentType.defaultOrder);\r\n            $scope.headerClicked = function (header) { return $scope.sorter.setPrimary(header.attrs['key'], header.attrs['direction']); };\r\n            // actions\r\n            $scope.availableAction = function (action) { return action.isAvailable($scope.selectedItems); };\r\n            VizPortal.ActionButtonsHelper.setupActionButtons($scope, actions);\r\n            $scope.listActions = [{\r\n                    name: 'add-users-to-group',\r\n                    translate: 'addUsers',\r\n                    isAvailable: function () { return !group.isAllUsersGroup; },\r\n                    execute: function ($event) {\r\n                        groupActions.addUsersToGroup(group).then(function () {\r\n                            $scope.refreshItems();\r\n                            $scope.$emit(VizPortal.GroupUsersEvent.usersAdded);\r\n                        });\r\n                    }\r\n                }];\r\n            $scope.availableListAction = function (listAction) { return listAction.isAvailable(); };\r\n            $scope.emptyTemplateModel = GroupUsersSubplaceCtrl.emptyTemplateModel;\r\n        }\r\n        GroupUsersSubplaceCtrl.prototype.configureForReactDataGrid = function (actions) {\r\n            var _this = this;\r\n            this.$scope.useReactDataGrid = true;\r\n            var siteUrls = new VizPortalReact.SiteUrls({\r\n                siteUrlName: this.ServerService.sessionSiteUrlName(),\r\n                queryString: window.location.search\r\n            });\r\n            var columns = VizPortalReact.GroupUsersGrid.columns(function (id) { return _this.$translate.instant(id); }, this.$scope, siteUrls, this.siteRoleFilter, actions);\r\n            this.AngularToReactDataGridBridge.attachReactDataGridToScope(this.$scope, columns, GroupUsersSubplaceCtrl.emptyTemplateModel);\r\n        };\r\n        GroupUsersSubplaceCtrl.$inject = [\r\n            '$scope',\r\n            '$translate',\r\n            'AngularToReactDataGridBridge',\r\n            'siteRoleFilter',\r\n            'ServerService',\r\n            'BrowserTitleService',\r\n            'SorterFactory',\r\n            'SiteUsers',\r\n            'group',\r\n            'QueryService',\r\n            'SelectionService',\r\n            'GroupActions'\r\n        ];\r\n        GroupUsersSubplaceCtrl.emptyTemplateModel = { title: 'usersEmptyMessage' };\r\n        return GroupUsersSubplaceCtrl;\r\n    })();\r\n    VizPortal.GroupUsersSubplaceCtrl = GroupUsersSubplaceCtrl;\r\n    VizPortal.Module.instance().controller('GroupUsersSubplaceCtrl', GroupUsersSubplaceCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var AddFavoriteRequest = (function (_super) {\r\n            __extends(AddFavoriteRequest, _super);\r\n            function AddFavoriteRequest(params) {\r\n                _super.call(this, 'addFavorite', params);\r\n            }\r\n            return AddFavoriteRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.AddFavoriteRequest = AddFavoriteRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"resourceParts.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/IGetItemsParams.ts\" />\r\n/// <reference path=\"../types/IGetItemsResult.ts\" />\r\n/// <reference path=\"../types/IFavorite.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetFavoritesRequest = (function (_super) {\r\n            __extends(GetFavoritesRequest, _super);\r\n            function GetFavoritesRequest(params) {\r\n                _super.call(this, 'getFavorites', params);\r\n            }\r\n            return GetFavoritesRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetFavoritesRequest = GetFavoritesRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var RemoveFavoriteRequest = (function (_super) {\r\n            __extends(RemoveFavoriteRequest, _super);\r\n            function RemoveFavoriteRequest(params) {\r\n                _super.call(this, 'removeFavorite', params);\r\n            }\r\n            return RemoveFavoriteRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.RemoveFavoriteRequest = RemoveFavoriteRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/IDataSourceInfo.ts\" />\r\n/// <reference path=\"../models/IViewInfo.ts\" />\r\n/// <reference path=\"../models/IWorkbookInfo.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/AddFavoriteRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetFavoritesRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/RemoveFavoriteRequest.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\n/// <reference path=\"Resource.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var FavoriteObjectType = (function () {\r\n        function FavoriteObjectType() {\r\n        }\r\n        FavoriteObjectType.VIEW = 'view';\r\n        FavoriteObjectType.WORKBOOK = 'workbook';\r\n        return FavoriteObjectType;\r\n    })();\r\n    VizPortal.FavoriteObjectType = FavoriteObjectType;\r\n    var Favorites = (function (_super) {\r\n        __extends(Favorites, _super);\r\n        function Favorites(server, FetcherFactory) {\r\n            _super.call(this, FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetFavoritesRequest, function (result) { return result.favorites; }));\r\n            this.server = server;\r\n        }\r\n        Favorites.prototype.addView = function (view) {\r\n            return this.add(view.id, FavoriteObjectType.VIEW);\r\n        };\r\n        Favorites.prototype.addWorkbook = function (workbook) {\r\n            return this.add(workbook.id, FavoriteObjectType.WORKBOOK);\r\n        };\r\n        Favorites.prototype.removeView = function (view) {\r\n            return this.remove(view.id, FavoriteObjectType.VIEW);\r\n        };\r\n        Favorites.prototype.removeViewById = function (id) {\r\n            return this.remove(id, FavoriteObjectType.VIEW);\r\n        };\r\n        Favorites.prototype.removeWorkbook = function (workbook) {\r\n            return this.remove(workbook.id, FavoriteObjectType.WORKBOOK);\r\n        };\r\n        Favorites.prototype.removeWorkbookById = function (id) {\r\n            return this.remove(id, FavoriteObjectType.WORKBOOK);\r\n        };\r\n        Favorites.prototype.add = function (objectId, objectType) {\r\n            return this.server.sendRequest(new VizPortal.ServerApi.AddFavoriteRequest({\r\n                objectId: objectId,\r\n                objectType: objectType\r\n            }));\r\n        };\r\n        Favorites.prototype.remove = function (objectId, objectType) {\r\n            return this.server.sendRequest(new VizPortal.ServerApi.RemoveFavoriteRequest({\r\n                objectId: objectId,\r\n                objectType: objectType\r\n            }));\r\n        };\r\n        Favorites.$inject = ['ServerService', 'FetcherFactory'];\r\n        return Favorites;\r\n    })(VizPortal.Resource);\r\n    VizPortal.Favorites = Favorites;\r\n    VizPortal.Module.instance().service('Favorites', Favorites);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var AddTagsToViewsRequest = (function (_super) {\r\n            __extends(AddTagsToViewsRequest, _super);\r\n            function AddTagsToViewsRequest(ids, tags) {\r\n                _super.call(this, 'addTagsToViews', {\r\n                    ids: ids,\r\n                    tags: tags\r\n                });\r\n            }\r\n            return AddTagsToViewsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.AddTagsToViewsRequest = AddTagsToViewsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../helpers/Helpers.ts\" />\r\n/// <reference path=\"../types/IFieldValue.ts\" />\r\n/// <reference path=\"../types/IFieldValuesParams.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetFieldValuesRequest = (function (_super) {\r\n            __extends(GetFieldValuesRequest, _super);\r\n            function GetFieldValuesRequest(params) {\r\n                _super.call(this, 'getFieldValues', params);\r\n            }\r\n            return GetFieldValuesRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetFieldValuesRequest = GetFieldValuesRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"actionNames.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\n/// <reference path=\"../types/IViewActions.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetViewActionsRequest = (function (_super) {\r\n            __extends(GetViewActionsRequest, _super);\r\n            function GetViewActionsRequest(id) {\r\n                _super.call(this, 'getViewActions', { id: id });\r\n            }\r\n            return GetViewActionsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetViewActionsRequest = GetViewActionsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/IView.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetViewByPathRequest = (function (_super) {\r\n            __extends(GetViewByPathRequest, _super);\r\n            function GetViewByPathRequest(path) {\r\n                _super.call(this, 'getViewByPath', { path: path });\r\n            }\r\n            return GetViewByPathRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetViewByPathRequest = GetViewByPathRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var HideViewsRequest = (function (_super) {\r\n            __extends(HideViewsRequest, _super);\r\n            function HideViewsRequest(ids) {\r\n                _super.call(this, 'hideViews', { ids: ids });\r\n            }\r\n            return HideViewsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.HideViewsRequest = HideViewsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var RemoveTagsFromViewsRequest = (function (_super) {\r\n            __extends(RemoveTagsFromViewsRequest, _super);\r\n            function RemoveTagsFromViewsRequest(ids, tags) {\r\n                // The server returns quoted tags unquoted.  This re-adds the double quotes if needed\r\n                var tagsList = _.map(tags, function (tag) { return VizPortal.TagsHelper.quote(tag); });\r\n                _super.call(this, 'removeTagsFromViews', {\r\n                    ids: ids,\r\n                    tags: tagsList\r\n                });\r\n            }\r\n            return RemoveTagsFromViewsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.RemoveTagsFromViewsRequest = RemoveTagsFromViewsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/RequestHelper.ts\" />\r\n/// <reference path=\"../helpers/ResourceHelper.ts\" />\r\n/// <reference path=\"../helpers/ResultHelper.ts\" />\r\n/// <reference path=\"../helpers/ServerModelHelper.ts\" />\r\n/// <reference path=\"../models/IViewInfo.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/AddTagsToViewsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetFieldValuesRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetViewActionsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetViewByPathRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetViewsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/HideViewsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/MarkRecentlyViewedRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/RemoveTagsFromViewsRequest.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var Views = (function () {\r\n        function Views($q, ErrorNotifyingServer, FetcherFactory) {\r\n            this.$q = $q;\r\n            this.ErrorNotifyingServer = ErrorNotifyingServer;\r\n            this.server = ErrorNotifyingServer.getServerService();\r\n            this.listFetcher = FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetViewsRequest, VizPortal.ServerApiMapper.views);\r\n            this.allQuery = new VizPortal.ResourceQuery(this.listFetcher);\r\n            this.detailFetcher = FetcherFactory.getServerDetailFetcher('getView', VizPortal.ViewMapper.mapDetail);\r\n            this.fieldValuesFetcher = FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetFieldValuesRequest, VizPortal.ServerApiMapper.fieldValues);\r\n        }\r\n        Views.prototype.all = function () {\r\n            return this.allQuery;\r\n        };\r\n        Views.prototype.getById = function (id) {\r\n            return this.detailFetcher.fetchById(id);\r\n        };\r\n        Views.prototype.getByPath = function (path) {\r\n            var _this = this;\r\n            return this.server.sendRequest(new VizPortal.ServerApi.GetViewByPathRequest(path))\r\n                .then(function (viewDetail) {\r\n                var error = viewDetail.errors && viewDetail.errors[0] && viewDetail.errors[0].code;\r\n                if (error) {\r\n                    return _this.$q.reject(error);\r\n                }\r\n                else {\r\n                    return _this.$q.when(VizPortal.ViewMapper.mapDetail(viewDetail));\r\n                }\r\n            });\r\n        };\r\n        Views.prototype.valuesForField = function (field) {\r\n            return new VizPortal.FieldValuesQuery(this.fieldValuesFetcher, field, VizPortal.ServerApi.FieldValueResourceType.view);\r\n        };\r\n        // Actions\r\n        Views.prototype.actions = function (id) {\r\n            return this.server.sendRequest(new VizPortal.ServerApi.GetViewActionsRequest(id));\r\n        };\r\n        Views.prototype.hide = function (ids) {\r\n            return this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests(ids, function (idsBlock) { return new VizPortal.ServerApi.HideViewsRequest(idsBlock); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        Views.prototype.addTags = function (ids, tags) {\r\n            return (tags.length > 0)\r\n                ? this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests2(ids, tags, function (idsBlock, tagsBlock) { return new VizPortal.ServerApi.AddTagsToViewsRequest(idsBlock, tagsBlock); }), VizPortal.ResultHelper.combineResults)\r\n                : this.$q.when({});\r\n        };\r\n        Views.prototype.removeTags = function (ids, tags) {\r\n            return (tags.length > 0)\r\n                ? this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests2(ids, tags, function (idsBlock, tagsBlock) { return new VizPortal.ServerApi.RemoveTagsFromViewsRequest(idsBlock, tagsBlock); }), VizPortal.ResultHelper.combineResults)\r\n                : this.$q.when({});\r\n        };\r\n        Views.prototype.changeTags = function (ids, tagsToAdd, tagsToRemove) {\r\n            var _this = this;\r\n            return this.removeTags(ids, tagsToRemove)\r\n                .then(function (result) { return (VizPortal.ResultHelper.hasErrors(result) ? result : _this.addTags(ids, tagsToAdd)); });\r\n        };\r\n        Views.prototype.markRecentlyViewed = function (id) {\r\n            return this.server.sendRequest(new VizPortal.ServerApi.MarkRecentlyViewedRequest({\r\n                objectId: id,\r\n                objectType: VizPortal.ServerApi.RecentlyViewedObjectType.View\r\n            }));\r\n        };\r\n        Views.$inject = [\r\n            '$q',\r\n            'ErrorNotifyingServer',\r\n            'FetcherFactory'\r\n        ];\r\n        return Views;\r\n    })();\r\n    VizPortal.Views = Views;\r\n    VizPortal.Module.instance().service('Views', Views);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/Order.ts\" />\r\n/// <reference path=\"../models/OrderKeys.ts\" />\r\n/// <reference path=\"../resources/Favorites.ts\" />\r\n/// <reference path=\"../resources/Views.ts\" />\r\n/// <reference path=\"../resources/Workbooks.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var HomeCtrl = (function () {\r\n        function HomeCtrl($scope, $state, Favorites, Views, Workbooks) {\r\n            $scope.favoriteViews = [];\r\n            Views.all().withFiltersAndOrder([VizPortal.Filter.fieldEq(VizPortal.ServerApi.FilterFieldNames.isFavorite, true)], [VizPortal.Order.asc(VizPortal.ServerApi.NamedItemKeys.name)]).getSlice(0, HomeCtrl.ItemsPerSection).then(function (result) {\r\n                $scope.favoriteViews = result.items || [];\r\n            });\r\n            $scope.favoriteWorkbooks = [];\r\n            Workbooks.all().withFiltersAndOrder([VizPortal.Filter.fieldEq(VizPortal.ServerApi.FilterFieldNames.isFavorite, true)], [VizPortal.Order.asc(VizPortal.ServerApi.NamedItemKeys.name)]).getSlice(0, HomeCtrl.ItemsPerSection).then(function (result) {\r\n                $scope.favoriteWorkbooks = result.items || [];\r\n            });\r\n            $scope.recentViews = [];\r\n            Views.all().withFiltersAndOrder([VizPortal.Filter.fieldEq(VizPortal.ServerApi.FilterFieldNames.isRecent, true)], [VizPortal.Order.asc(VizPortal.ServerApi.NamedItemKeys.name)]).getSlice(0, HomeCtrl.ItemsPerSection).then(function (result) {\r\n                $scope.recentViews = result.items || [];\r\n            });\r\n            $scope.recentWorkbooks = [];\r\n            Workbooks.all().withFiltersAndOrder([VizPortal.Filter.fieldEq(VizPortal.ServerApi.FilterFieldNames.isRecent, true)], [VizPortal.Order.asc(VizPortal.ServerApi.NamedItemKeys.name)]).getSlice(0, HomeCtrl.ItemsPerSection).then(function (result) {\r\n                $scope.recentWorkbooks = result.items || [];\r\n            });\r\n            $scope.updatedWorkbooks = [];\r\n            Workbooks.all().withFiltersAndOrder([], [{ field: VizPortal.OrderKeys.updatedAt, ascending: false }]).getSlice(0, HomeCtrl.ItemsPerSection).then(function (result) {\r\n                $scope.updatedWorkbooks = result.items || [];\r\n            });\r\n            $scope.viewUrl = function (view) { return $state.href('main.site.viz', { path: view.path }); };\r\n            $scope.workbookUrl = function (workbook) { return $state.href('main.site.content.workbook.views', { id: workbook.id }); };\r\n            $scope.recentViewsUrl = function () { return $state.href('main.site.content.site.views') + '?recent=true'; };\r\n            $scope.recentWorkbooksUrl = function () { return $state.href('main.site.content.site.workbooks') + '?recent=true'; };\r\n            $scope.favoriteViewsUrl = function () { return $state.href('main.site.content.site.views') + '?favorite=true'; };\r\n            $scope.favoriteWorkbooksUrl = function () { return $state.href('main.site.content.site.workbooks') + '?favorite=true'; };\r\n            $scope.updatedWorkbooksUrl = function () { return $state.href('main.site.content.site.workbooks') + '?order=updatedAt:desc'; };\r\n            $scope.addViewFavorite = function (view) { return Favorites.addView(view); };\r\n            $scope.removeViewFavorite = function (view) { return Favorites.removeView(view); };\r\n            $scope.addWorkbookFavorite = function (workbook) { return Favorites.addWorkbook(workbook); };\r\n            $scope.removeWorkbookFavorite = function (workbook) { return Favorites.removeWorkbook(workbook); };\r\n            $scope.getItemDetails = function (item) {\r\n                var view = item;\r\n                var workbook = item;\r\n                if (workbook.numSheets) {\r\n                    return Workbooks.getById(workbook.id);\r\n                }\r\n                else {\r\n                    return Views.getById(view.id);\r\n                }\r\n            };\r\n            $scope.scrollLeft = function (section) {\r\n                var sectionElement = $('.tb-home-section-' + section);\r\n                sectionElement.scrollLeft(sectionElement.scrollLeft() - sectionElement.width());\r\n            };\r\n            $scope.scrollRight = function (section) {\r\n                var sectionElement = $('.tb-home-section-' + section);\r\n                sectionElement.scrollLeft(sectionElement.scrollLeft() + sectionElement.width());\r\n            };\r\n            $scope.showScrollControls = function (section) {\r\n                var sectionElement = $('.tb-home-section-' + section);\r\n                var contentElement = sectionElement.find('.tb-home-section-items-content');\r\n                return sectionElement.width() < contentElement.width();\r\n            };\r\n            $scope.canScrollLeft = function (section) {\r\n                var sectionElement = $('.tb-home-section-' + section);\r\n                return sectionElement.scrollLeft() > 0;\r\n            };\r\n            $scope.canScrollRight = function (section) {\r\n                var sectionElement = $('.tb-home-section-' + section);\r\n                var contentElement = sectionElement.find('.tb-home-section-items-content');\r\n                return sectionElement.scrollLeft() + sectionElement.width() < contentElement.width();\r\n            };\r\n        }\r\n        // The server only stores 12 recents,\r\n        // so we just show 12 of each category for consistency.\r\n        HomeCtrl.ItemsPerSection = 12;\r\n        HomeCtrl.$inject = [\r\n            '$scope',\r\n            '$state',\r\n            'Favorites',\r\n            'Views',\r\n            'Workbooks'\r\n        ];\r\n        return HomeCtrl;\r\n    })();\r\n    VizPortal.HomeCtrl = HomeCtrl;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var InitializationCtrl = (function () {\r\n        function InitializationCtrl($scope, $state, server) {\r\n            $scope.formData = {\r\n                username: '',\r\n                password: '',\r\n                confirmPassword: '',\r\n                displayName: ''\r\n            };\r\n            $scope.isActiveDirectory = function () { return server.isServerDomainFamilyActiveDirectory(); };\r\n            $scope.isLocal = function () { return server.isServerDomainFamilyLocal(); };\r\n            $scope.passwordFieldsAreNonEmpty = function () {\r\n                return !$scope.isActiveDirectory() &&\r\n                    $scope.formData.password &&\r\n                    $scope.formData.confirmPassword &&\r\n                    $scope.formData.password.length > 0 &&\r\n                    $scope.formData.confirmPassword.length > 0;\r\n            };\r\n            $scope.maybeInitialize = function () {\r\n                if ($scope.initializationForm.$valid) {\r\n                    $scope.busy = true;\r\n                    server.initialize($scope.formData.username, $scope.formData.password, $scope.formData.displayName)\r\n                        .then(function () {\r\n                        $scope.result = 'success';\r\n                        $state.go('main.site.content.site.projects', { siteUrlName: '' });\r\n                    })\r\n                        .fail(function (errorCode) {\r\n                        $scope.result = 'failure';\r\n                        $scope.busy = false;\r\n                        switch (errorCode) {\r\n                            case VizPortal.UserErrorCode.UserInsufficientLicenses:\r\n                                $scope.errorMessageKey = 'signInFailedUnlicensedServer';\r\n                                break;\r\n                            default:\r\n                                $scope.errorMessageKey = 'initializationFailed';\r\n                                break;\r\n                        }\r\n                    });\r\n                }\r\n                else {\r\n                    $scope.result = 'invalidForm';\r\n                }\r\n            };\r\n        }\r\n        InitializationCtrl.$inject = [\r\n            '$scope',\r\n            '$state',\r\n            'ServerService'\r\n        ];\r\n        return InitializationCtrl;\r\n    })();\r\n    VizPortal.InitializationCtrl = InitializationCtrl;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/ILicensingInfo.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetLicensingInfoRequest = (function (_super) {\r\n            __extends(GetLicensingInfoRequest, _super);\r\n            function GetLicensingInfoRequest(params) {\r\n                if (params === void 0) { params = {}; }\r\n                _super.call(this, 'getLicensingInfo', params);\r\n            }\r\n            return GetLicensingInfoRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetLicensingInfoRequest = GetLicensingInfoRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/types/ILicensingInfo.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetLicensingInfoRequest.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var LicensesService = (function () {\r\n        function LicensesService(server) {\r\n            this.server = server;\r\n        }\r\n        LicensesService.prototype.fetch = function () {\r\n            return this.server.sendRequest(new VizPortal.ServerApi.GetLicensingInfoRequest())\r\n                .then(function (result) {\r\n                if (result.isCore === true) {\r\n                    // Core Licensing\r\n                    var totalLicensedCores = _.reduce(result.coreLicensingInfos, function (memo, info) { return memo + info.numLicensedCores; }, 0);\r\n                    var totalCoreLicensesAvailable = (result.totalCoreLicenses - totalLicensedCores);\r\n                    return _.extend(result, {\r\n                        totalLicensedCores: totalLicensedCores,\r\n                        totalCoreLicensesAvailable: totalCoreLicensesAvailable\r\n                    });\r\n                }\r\n                else if (result.isCore === false) {\r\n                    // Seat Licensing\r\n                    var totalSeatLicenses = result.seatLicensingInfo.numRemainingSeats + result.seatLicensingInfo.numLicensedUsers;\r\n                    return _.extend(result, {\r\n                        totalSeatLicenses: totalSeatLicenses\r\n                    });\r\n                }\r\n            });\r\n        };\r\n        LicensesService.$inject = ['ServerService'];\r\n        return LicensesService;\r\n    })();\r\n    VizPortal.LicensesService = LicensesService;\r\n    VizPortal.Module.instance().service('LicensesService', LicensesService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/BrowserTitleService.ts\" />\r\n/// <reference path=\"../services/LicensesService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var LicensesCtrl = (function () {\r\n        function LicensesCtrl($scope, $translate, BrowserTitleService, licensingInfo) {\r\n            BrowserTitleService.setTitle('serverSettings_licenses');\r\n            $scope.licensingInfo = licensingInfo;\r\n            $scope.isEmpty = !licensingInfo.productKeyInfos || !licensingInfo.productKeyInfos.length;\r\n            $scope.formatExpirationDate = function (date) {\r\n                if (!date || LicensesCtrl.TrialRegExp.test(date)) {\r\n                    return '';\r\n                }\r\n                else if (LicensesCtrl.PermanentRegExp.test(date)) {\r\n                    return $translate.instant('never');\r\n                }\r\n                else {\r\n                    return VizPortal.L10n.localizedDate(date);\r\n                }\r\n            };\r\n        }\r\n        LicensesCtrl.PermanentRegExp = /permanent/i;\r\n        LicensesCtrl.TrialRegExp = /trial/i;\r\n        LicensesCtrl.$inject = [\r\n            '$scope',\r\n            '$translate',\r\n            'BrowserTitleService',\r\n            'licensingInfo'\r\n        ];\r\n        return LicensesCtrl;\r\n    })();\r\n    VizPortal.LicensesCtrl = LicensesCtrl;\r\n    VizPortal.Module.instance().controller('LicensesCtrl', LicensesCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ErrorMessageHandler = (function () {\r\n        function ErrorMessageHandler(server, $translate) {\r\n            this.server = server;\r\n            this.$translate = $translate;\r\n        }\r\n        ErrorMessageHandler.prototype.getSignInErrorMessages = function (errorCode) {\r\n            var _this = this;\r\n            var isClientCertWithFallback = this.server.authenticationType() === VizPortal.ServerApi.AuthenticationType.ClientCertificateWithFallback;\r\n            var errorMessageKeys = [];\r\n            switch (errorCode) {\r\n                case VizPortal.CommonErrorCode.SiteNotFound:\r\n                case VizPortal.CommonErrorCode.SiteUserNotFound:\r\n                    errorMessageKeys.push('signInFailedSiteNotFound');\r\n                    errorMessageKeys.push('contactServerAdmin');\r\n                    break;\r\n                case VizPortal.CommonErrorCode.SystemUserNotFound:\r\n                case VizPortal.UserErrorCode.UserOpenIdUserNotFound:\r\n                    errorMessageKeys.push('errorUserNotFound');\r\n                    errorMessageKeys.push('contactServerAdmin');\r\n                    break;\r\n                case VizPortal.UserErrorCode.UserOpenIdConflictingUserAccount:\r\n                    errorMessageKeys.push('conflictingUserAccount');\r\n                    errorMessageKeys.push('contactServerAdmin');\r\n                    break;\r\n                case VizPortal.SiteSwitchErrorCodes.UserUnlicensedForSite:\r\n                    errorMessageKeys.push('signInFailedUserUnlicensedForSite');\r\n                    errorMessageKeys.push('contactServerAdmin');\r\n                    break;\r\n                case VizPortal.SiteSwitchErrorCodes.SiteLocked:\r\n                    errorMessageKeys.push('signInFailedSiteLocked');\r\n                    errorMessageKeys.push('contactServerAdmin');\r\n                    break;\r\n                case VizPortal.SiteSwitchErrorCodes.SiteSuspended:\r\n                    errorMessageKeys.push('signInFailedSiteSuspended');\r\n                    errorMessageKeys.push('contactServerAdmin');\r\n                    break;\r\n                case VizPortal.LoginErrorCodes.ClientCertificateNotFound:\r\n                    errorMessageKeys.push('signinFailedClientCertificateNotFound');\r\n                    errorMessageKeys.push(isClientCertWithFallback ?\r\n                        'signInUsingTableauServerCredentialsOption' : 'contactServerAdmin');\r\n                    break;\r\n                case VizPortal.LoginErrorCodes.ClientCertificateUserNotFoundInCertificate:\r\n                    errorMessageKeys.push('signinFailedClientCertificateUserNotFoundInCertificate');\r\n                    errorMessageKeys.push(isClientCertWithFallback ?\r\n                        'signInUsingTableauServerCredentialsOption' : 'contactServerAdmin');\r\n                    break;\r\n                case VizPortal.LoginErrorCodes.ClientCertificateUserNotFoundOnServer:\r\n                    errorMessageKeys.push('signinFailedClientCertificateUserNotFoundOnServer');\r\n                    errorMessageKeys.push(isClientCertWithFallback ?\r\n                        'signInUsingTableauServerCredentialsOption' : 'contactServerAdmin');\r\n                    break;\r\n                case VizPortal.LoginErrorCodes.KerberosFailed:\r\n                case VizPortal.LoginErrorCodes.SspiFailed:\r\n                    errorMessageKeys.push('signInFailedAutoSignin');\r\n                    errorMessageKeys.push('signInUsingTableauServerCredentials');\r\n                    break;\r\n                case VizPortal.LoginErrorCodes.BadCredentials:\r\n                    errorMessageKeys.push('signInFailedBadCredentials');\r\n                    break;\r\n                case VizPortal.CommonErrorCode.InvalidSession:\r\n                    errorMessageKeys.push('sessionExpired');\r\n                    break;\r\n                case VizPortal.CommonErrorCode.UnlicensedServer:\r\n                    errorMessageKeys.push('signInFailedUnlicensedServer');\r\n                    errorMessageKeys.push('contactServerAdmin');\r\n                    break;\r\n                case VizPortal.UserErrorCode.UserOpenIdIdpNotReachable:\r\n                    errorMessageKeys.push('cannotReachOpenIdIdp');\r\n                    errorMessageKeys.push('contactServerAdmin');\r\n                    break;\r\n                case VizPortal.UserErrorCode.UserOpenIdBadConfig:\r\n                    errorMessageKeys.push('openIdBadConfig');\r\n                    errorMessageKeys.push('contactServerAdmin');\r\n                    break;\r\n                case VizPortal.LoginErrorCodes.OpenIdFailed:\r\n                    errorMessageKeys.push('signInFailedUnknownReason');\r\n                    errorMessageKeys.push('contactServerAdmin');\r\n                    break;\r\n                default:\r\n                    errorMessageKeys.push('signInFailedUnknownReason');\r\n                    break;\r\n            }\r\n            return _.map(errorMessageKeys, function (key) { return _this.$translate.instant(key); });\r\n        };\r\n        ErrorMessageHandler.$inject = [\r\n            'ServerService',\r\n            '$translate'\r\n        ];\r\n        return ErrorMessageHandler;\r\n    })();\r\n    VizPortal.ErrorMessageHandler = ErrorMessageHandler;\r\n    VizPortal.Module.instance().service('ErrorMessageHandler', ErrorMessageHandler);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ExternalAuthService = (function () {\r\n        function ExternalAuthService($stateParams, $location, serverService, windowLocationService) {\r\n            this.$stateParams = $stateParams;\r\n            this.$location = $location;\r\n            this.serverService = serverService;\r\n            this.windowLocationService = windowLocationService;\r\n        }\r\n        ExternalAuthService.prototype.getLoginUrl = function () {\r\n            if (this.serverService.isAuthenticationSaml()) {\r\n                return ExternalAuthService.SamlLoginUrl;\r\n            }\r\n            else if (this.serverService.isAuthenticationOpenId()) {\r\n                return ExternalAuthService.OpenIdLoginUrl;\r\n            }\r\n            return \"\";\r\n        };\r\n        ExternalAuthService.prototype.login = function () {\r\n            if (!this.serverService.isAuthenticationExternal()) {\r\n                throw new Error(\"This server doesn't use external authentication\");\r\n            }\r\n            var closePopupWhenDone = Helpers.BooleanQueryParamRegex.test(this.$location.search()[VizPortal.UrlParamKeys.ClosePopupWhenDone]);\r\n            var redirect;\r\n            if (this.$stateParams.externalRedirect) {\r\n                redirect = this.$stateParams.externalRedirect;\r\n            }\r\n            else if (this.$stateParams.redirect) {\r\n                redirect = this.windowLocationService.getPathQuery() + '#' + this.$stateParams.redirect;\r\n            }\r\n            else if (closePopupWhenDone) {\r\n                redirect = '/' + this.serverService.serverLanguage() + '/closePopup.html';\r\n            }\r\n            else {\r\n                redirect = '/';\r\n            }\r\n            var siteUrlName;\r\n            if (_.isString(this.$stateParams.site)) {\r\n                siteUrlName = this.$stateParams.site;\r\n            }\r\n            else if (_.isString(this.$stateParams.redirect)) {\r\n                var match = this.$stateParams.redirect.match('^/site/([^/]*).*$');\r\n                siteUrlName = match && match[1];\r\n            }\r\n            var url = this.getLoginUrl() + '?' + this.buildQueryParams(redirect, siteUrlName, closePopupWhenDone);\r\n            this.windowLocationService.navigateToWithoutAddingToHistory(url);\r\n        };\r\n        ExternalAuthService.prototype.buildQueryParams = function (redirect, siteUrlName, sendPodInfo) {\r\n            var redirectKey, siteUrlNameKey;\r\n            if (this.serverService.isAuthenticationSaml()) {\r\n                redirectKey = 'dest';\r\n                siteUrlNameKey = 'target_site';\r\n            }\r\n            else if (this.serverService.isAuthenticationOpenId()) {\r\n                redirectKey = 'path';\r\n                siteUrlNameKey = 'siteUrlName';\r\n            }\r\n            var queryParams = {};\r\n            queryParams[redirectKey] = redirect;\r\n            if (siteUrlName && _.isString(siteUrlName)) {\r\n                queryParams[siteUrlNameKey] = siteUrlName;\r\n            }\r\n            // This parameter ensures that the server doesn't try to redirect the close-pop-up page to\r\n            // the correct POD for the site. Instead, it redirects to a different page on the destination\r\n            // POD which can send the POD info back to the parent window.\r\n            if (sendPodInfo) {\r\n                queryParams.sendPodInfo = sendPodInfo;\r\n            }\r\n            return $.param(queryParams);\r\n        };\r\n        ExternalAuthService.SamlLoginUrl = 'vizportal/api/saml';\r\n        ExternalAuthService.OpenIdLoginUrl = 'vizportal/api/web/v1/auth/openId';\r\n        ExternalAuthService.$inject = [\r\n            '$stateParams',\r\n            '$location',\r\n            'ServerService',\r\n            'WindowLocationService'\r\n        ];\r\n        return ExternalAuthService;\r\n    })();\r\n    VizPortal.ExternalAuthService = ExternalAuthService;\r\n    VizPortal.Module.instance().service('ExternalAuthService', ExternalAuthService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../FeatureFlags.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var StartPageService = (function () {\r\n        function StartPageService($location, $state, server, stateWrapperService) {\r\n            this.$location = $location;\r\n            this.$state = $state;\r\n            this.server = server;\r\n            this.stateWrapperService = stateWrapperService;\r\n        }\r\n        // Given a startPageUrl and a siteUrlName, returns the navigable start page. i.e.:\r\n        //  1. If start page url is invalid, returns default start page for current site\r\n        //  2. Prepends site prefix to the startPageUrl if site prefix is needed (not needed for default site\r\n        //     urls and for non-site urls)\r\n        StartPageService.prototype.getStartPageForSite = function (startPageUrl, siteUrlName) {\r\n            var startPageState = this.getStartPageState(startPageUrl);\r\n            var isDefaultSite = !!siteUrlName;\r\n            if (!startPageState) {\r\n                return this.getDefaultStartPageForSite(siteUrlName);\r\n            }\r\n            else if (this.isStartPageInASite(startPageState) && isDefaultSite) {\r\n                return '/site/' + siteUrlName + startPageUrl;\r\n            }\r\n            else {\r\n                return startPageUrl;\r\n            }\r\n        };\r\n        // Gets a navigable start page url for the current user on the given site\r\n        StartPageService.prototype.getCurrentUserStartPageForSite = function (siteUrlName) {\r\n            return this.getStartPageForSite(this.server.getStartPage(), siteUrlName);\r\n        };\r\n        // Gets the navigable start page url for the current user on the current site\r\n        StartPageService.prototype.getCurrentUserStartPageForCurrentSite = function () {\r\n            return this.getStartPageForSite(this.server.getStartPage(), this.server.sessionSiteUrlName());\r\n        };\r\n        // Get the current $location with the site prefix removed\r\n        StartPageService.prototype.getCurrentUrlAsStartPage = function () {\r\n            return this.$location.url().replace(VizPortal.SiteUrlNameCapturingRegex, '');\r\n        };\r\n        // Get's state that matches the given startPageUrl, or a falsy value if no match\r\n        StartPageService.prototype.getStartPageState = function (savedStartPageUrl) {\r\n            if (!savedStartPageUrl) {\r\n                return null;\r\n            }\r\n            var split = savedStartPageUrl.split('?');\r\n            var path = split[0];\r\n            // tl;dr: Assuming no query parameters shouldn't cause any bugs right now, but it might cause weird ones in the future\r\n            // Long version: Given our current state configuration, we only need the path to resolve the correct state.\r\n            // I think it's possible this changes in the future. For example we could have two states that share a path\r\n            // but take different query parameters. We should still be able to ignore the query params in this case because\r\n            // all we're trying to do is tell whether it's a site url or not, and if they share a path they must be\r\n            // in the same site.\r\n            var search = {};\r\n            return this.stateWrapperService.getMatchingState(path, search);\r\n        };\r\n        StartPageService.prototype.isStartPageInASite = function (startPageState) {\r\n            return this.stateWrapperService.isDescendantOf(startPageState, 'main.site');\r\n        };\r\n        StartPageService.prototype.getDefaultStartPageForSite = function (siteUrlName) {\r\n            var startState = 'main.site.content.site.projects';\r\n            if (VizPortal.FeatureFlags.homePlaceEnabled) {\r\n                startState = 'main.site.home';\r\n            }\r\n            // $state.href returns the # at the front. We need to remove it\r\n            var href = this.$state.href(startState, { siteUrlName: siteUrlName });\r\n            return href.replace(/^#/, '');\r\n        };\r\n        StartPageService.$inject = ['$location', '$state', 'ServerService', 'StateWrapperService'];\r\n        return StartPageService;\r\n    })();\r\n    VizPortal.StartPageService = StartPageService;\r\n    VizPortal.Module.instance().service('StartPageService', StartPageService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/ErrorMessageHandler.ts\" />\r\n/// <reference path=\"../services/ExternalAuthService.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\n/// <reference path=\"../services/StartPageService.ts\" />\r\n/// <reference path=\"../services/WindowLocationService.ts\" />\r\n/// <reference path=\"../services/WindowPopupService.ts\" />\r\n/// <reference path=\"../ServerApi/types/IError.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var LoginCtrl = (function () {\r\n        function LoginCtrl($scope, server, $state, $stateParams, $location, $translate, externalAuthService, startPageService, windowLocationService, windowPopupService, errorMessageHandler) {\r\n            function authenticatedRedirect() {\r\n                // if we are a popup, window simply gets closed, no need to redirect\r\n                if (windowPopupService.maybeNotifyAndClose()) {\r\n                    return;\r\n                }\r\n                // if we're not a popup, redirect user to the appropriate place\r\n                var redirect = $stateParams.redirect;\r\n                var externalRedirect = $stateParams.externalRedirect;\r\n                var isSigninToSpecificSite = _.isString($stateParams.site);\r\n                // If this is a multisite session and the user did not specify a url,\r\n                // let the user choose which site to enter\r\n                if (externalRedirect) {\r\n                    // External: does not require hash prefix\r\n                    windowLocationService.setPathQueryFragment(externalRedirect);\r\n                }\r\n                else if (redirect) {\r\n                    // In-app: uses hash prefix\r\n                    $location.url(redirect);\r\n                }\r\n                else if (server.isSessionMultiSite() && !isSigninToSpecificSite) {\r\n                    $state.go('login.site');\r\n                }\r\n                else {\r\n                    $location.url(startPageService.getCurrentUserStartPageForCurrentSite());\r\n                }\r\n            }\r\n            function handleLoginErrorCode(errorCode) {\r\n                $scope.errorMessages = errorMessageHandler.getSignInErrorMessages(errorCode);\r\n                if (errorCode === VizPortal.LoginErrorCodes.KerberosFailed || errorCode === VizPortal.LoginErrorCodes.SspiFailed) {\r\n                    $scope.autoLoginDidFail = true;\r\n                }\r\n            }\r\n            $scope.maybeLogin = function () {\r\n                if (server.authenticationType() === VizPortal.ServerApi.AuthenticationType.ClientCertificate) {\r\n                    // Username and password is not valid for client certificate without fallback, so attempt to autoLogin\r\n                    $scope.autoLogin();\r\n                }\r\n                else if ($scope.loginForm.$valid) {\r\n                    $scope.errorMessages = [];\r\n                    $scope.busy = true;\r\n                    server.login($scope.credentials.username, $scope.credentials.password, $stateParams.site)\r\n                        .then(authenticatedRedirect, function (error) {\r\n                        if (error && error.code === VizPortal.CommonErrorCode.RedirectToOtherPod) {\r\n                            var redirectUrl = $stateParams.externalRedirect;\r\n                            if (!redirectUrl && _.isString($stateParams.redirect)) {\r\n                                redirectUrl = '/#' + $stateParams.redirect;\r\n                            }\r\n                            if (!redirectUrl && _.isString($stateParams.site)) {\r\n                                redirectUrl = '/#/site/' + $stateParams.site + '/';\r\n                            }\r\n                            if (!redirectUrl) {\r\n                                redirectUrl = '/#' + $location.url();\r\n                            }\r\n                            server.redirectToOtherPod(error, redirectUrl);\r\n                            return;\r\n                        }\r\n                        // Clear the password if credentials failed\r\n                        $scope.credentials.password = '';\r\n                        // This is really not how error should be handled. However, somehow in the development of the project,\r\n                        // some promise are rejected using ServerAPI.IError, and other simply with the error code. For example,\r\n                        // 401 errors returns only the code. To handle those scenarios, the error is coerced to either\r\n                        // error.code or simply error. In the future, it would be important to have a standard on how promises\r\n                        // can be rejected. A suggested approach is that promises should always be rejected with an instance of Error.\r\n                        handleLoginErrorCode(error && error.code || error);\r\n                        $scope.busy = false;\r\n                    });\r\n                }\r\n                else if ($scope.loginForm.$error.required) {\r\n                    if (!$scope.credentials.username) {\r\n                        $scope.errorMessages = [$translate.instant('enterYourUsername')];\r\n                        angular.element('input[name=\"username\"]').focus();\r\n                    }\r\n                    else if (!$scope.credentials.password) {\r\n                        $scope.errorMessages = [$translate.instant('enterYourPassword')];\r\n                        angular.element('input[name=\"password\"]').focus();\r\n                    }\r\n                }\r\n            };\r\n            $scope.shouldDisplayWindowsCredentialsLink = function () {\r\n                return server.isWindowsCredentialsAutoLogin() && !$scope.autoLoginDidFail;\r\n            };\r\n            $scope.isUsernameAndPasswordEnabled = function () {\r\n                return !server.isAuthenticationExternal() &&\r\n                    server.authenticationType() !== VizPortal.ServerApi.AuthenticationType.ClientCertificate;\r\n            };\r\n            $scope.autoLogin = function () {\r\n                $scope.busy = true;\r\n                return server.autoLogin($stateParams.site)\r\n                    .then(authenticatedRedirect, function (errorCode) {\r\n                    handleLoginErrorCode(errorCode);\r\n                    $scope.busy = false;\r\n                    $scope.initialized = true;\r\n                });\r\n            };\r\n            $scope.windowsCredentialsDisplayName = function () { return server.sessionUserDisplayName(); };\r\n            var licenseExpirationDateIfWithinWarningPeriod = server.licenseExpirationDateIfWithinWarningPeriod();\r\n            if ($stateParams.error) {\r\n                // coerce to number\r\n                var errorCode = +$stateParams.error;\r\n                handleLoginErrorCode(errorCode);\r\n            }\r\n            else if (licenseExpirationDateIfWithinWarningPeriod) {\r\n                $scope.errorMessages = [\r\n                    $translate.instant('licenseExpirationDateWarningMessage', {\r\n                        LICENSE_EXPIRATION_DATE: VizPortal.L10n.localizedDateTime(licenseExpirationDateIfWithinWarningPeriod)\r\n                    })\r\n                ];\r\n            }\r\n            $scope.preloginCustomization = server.preloginCustomization();\r\n            var allowAutoSignin = !Helpers.BooleanQueryParamRegex.test($stateParams.disableAutoSignin);\r\n            if (!server.inSession() && server.isAuthenticationAutoLogin() && allowAutoSignin) {\r\n                // Attempt auto login unless there is a query parameter saying not to\r\n                $scope.autoLogin();\r\n            }\r\n            else if (server.isAuthenticationExternal()) {\r\n                externalAuthService.login();\r\n            }\r\n            else {\r\n                $scope.initialized = true;\r\n            }\r\n            $scope.credentials = {\r\n                username: '',\r\n                password: ''\r\n            };\r\n        }\r\n        LoginCtrl.$inject = [\r\n            '$scope',\r\n            'ServerService',\r\n            '$state',\r\n            '$stateParams',\r\n            '$location',\r\n            '$translate',\r\n            'ExternalAuthService',\r\n            'StartPageService',\r\n            'WindowLocationService',\r\n            'WindowPopupService',\r\n            'ErrorMessageHandler'\r\n        ];\r\n        return LoginCtrl;\r\n    })();\r\n    VizPortal.LoginCtrl = LoginCtrl;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    (function (Keys) {\r\n        Keys[Keys[\"Backspace\"] = 8] = \"Backspace\";\r\n        Keys[Keys[\"Tab\"] = 9] = \"Tab\";\r\n        Keys[Keys[\"Enter\"] = 13] = \"Enter\";\r\n        Keys[Keys[\"Escape\"] = 27] = \"Escape\";\r\n        Keys[Keys[\"Space\"] = 32] = \"Space\";\r\n        Keys[Keys[\"End\"] = 35] = \"End\";\r\n        Keys[Keys[\"Home\"] = 36] = \"Home\";\r\n        Keys[Keys[\"ArrowLeft\"] = 37] = \"ArrowLeft\";\r\n        Keys[Keys[\"ArrowUp\"] = 38] = \"ArrowUp\";\r\n        Keys[Keys[\"ArrowRight\"] = 39] = \"ArrowRight\";\r\n        Keys[Keys[\"ArrowDown\"] = 40] = \"ArrowDown\";\r\n        Keys[Keys[\"Delete\"] = 46] = \"Delete\";\r\n    })(VizPortal.Keys || (VizPortal.Keys = {}));\r\n    var Keys = VizPortal.Keys;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/IGetItemsParams.ts\" />\r\n/// <reference path=\"../types/IGetItemsResult.ts\" />\r\n/// <reference path=\"../types/ISiteNameWithId.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetSiteNamesRequest = (function (_super) {\r\n            __extends(GetSiteNamesRequest, _super);\r\n            function GetSiteNamesRequest(params) {\r\n                _super.call(this, 'getSiteNames', params);\r\n            }\r\n            return GetSiteNamesRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetSiteNamesRequest = GetSiteNamesRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetSiteNamesRequest.ts\" />\r\n/// <reference path=\"Resource.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SiteNameSansIds = (function (_super) {\r\n        __extends(SiteNameSansIds, _super);\r\n        function SiteNameSansIds(FetcherFactory) {\r\n            _super.call(this, FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetSiteNamesAcrossAllPodsRequest, function (result) { return result.siteNames; }));\r\n        }\r\n        SiteNameSansIds.$inject = ['FetcherFactory'];\r\n        return SiteNameSansIds;\r\n    })(VizPortal.Resource);\r\n    VizPortal.SiteNameSansIds = SiteNameSansIds;\r\n    VizPortal.Module.instance().service('SiteNamesAcrossAllPods', SiteNameSansIds);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/IGetItemsParams.ts\" />\r\n/// <reference path=\"../types/IGetItemsResult.ts\" />\r\n/// <reference path=\"../types/ISiteNameSansId.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetSiteNamesAcrossAllPodsRequest = (function (_super) {\r\n            __extends(GetSiteNamesAcrossAllPodsRequest, _super);\r\n            function GetSiteNamesAcrossAllPodsRequest(params) {\r\n                _super.call(this, 'getSiteNamesAcrossAllPods', params);\r\n            }\r\n            return GetSiteNamesAcrossAllPodsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetSiteNamesAcrossAllPodsRequest = GetSiteNamesAcrossAllPodsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SiteSwitchService = (function () {\r\n        function SiteSwitchService($location, $q, $rootScope, $state, $translate, server, stateWrapper, toaster, windowLocation) {\r\n            var _this = this;\r\n            this.$location = $location;\r\n            this.$q = $q;\r\n            this.$rootScope = $rootScope;\r\n            this.$state = $state;\r\n            this.$translate = $translate;\r\n            this.server = server;\r\n            this.stateWrapper = stateWrapper;\r\n            this.toaster = toaster;\r\n            this.windowLocation = windowLocation;\r\n            $rootScope.$on('$locationChangeSuccess', function () {\r\n                var toState = _this.stateWrapper.getMatchingState(_this.$location.path(), _this.$location.search());\r\n                if (_this.stateWrapper.isDescendantOf(toState, 'main.server')) {\r\n                    _this.previousServerUrl = _this.$location.url();\r\n                }\r\n                else if (stateWrapper.isDescendantOf(toState, 'main.site')) {\r\n                    _this.previousSiteUrl = _this.$location.url();\r\n                }\r\n            });\r\n        }\r\n        SiteSwitchService.prototype.serverUrl = function () {\r\n            if (this.previousServerUrl) {\r\n                return '/#' + this.previousServerUrl;\r\n            }\r\n            else {\r\n                return this.$state.href('main.server.status');\r\n            }\r\n        };\r\n        SiteSwitchService.prototype.siteUrl = function () {\r\n            if (this.previousSiteUrl) {\r\n                return '/#' + this.previousSiteUrl;\r\n            }\r\n            else {\r\n                return this.$state.href('main.site.content.site.projects', { siteUrlName: this.server.sessionSiteUrlName() });\r\n            }\r\n        };\r\n        SiteSwitchService.prototype.switchToSite = function (urlName) {\r\n            var _this = this;\r\n            if (this.server.isCurrentSiteUrlName(urlName)) {\r\n                if (this.inServerState()) {\r\n                    // server -> current site\r\n                    if (this.previousSiteUrl) {\r\n                        this.$location.url(this.previousSiteUrl);\r\n                    }\r\n                    else {\r\n                        this.$state.go('main.site.content.site.projects', { siteUrlName: urlName });\r\n                    }\r\n                }\r\n                else {\r\n                }\r\n            }\r\n            else {\r\n                // server/site -> other site\r\n                // TFSID: 404042 reload page afterwards\r\n                this.switchIfNeeded(urlName, '/#/site/' + urlName + '/').then(function () {\r\n                    _this.windowLocation.navigateTo(_this.$state.href('main.site.content.site.projects', { siteUrlName: urlName }, { absolute: true }));\r\n                    _this.windowLocation.reload();\r\n                });\r\n            }\r\n        };\r\n        /**\r\n        * Switches the site if the given urLName if it's not the current site's urlName\r\n        *\r\n        * Use this instead of ServerService.switchSiteIfNeeded in order to give proper\r\n        * feedback in the error conditions\r\n        */\r\n        SiteSwitchService.prototype.switchIfNeeded = function (urlName, podRedirectPath) {\r\n            var _this = this;\r\n            this.previousSiteUrl = null;\r\n            return this.server.switchSiteIfNeeded(urlName, podRedirectPath)\r\n                .fail(function (error) {\r\n                var errorLocKey = _this.getSwitchSiteErrorLocKey(error);\r\n                // Site switch failed\r\n                if (_this.server.isSessionMultiSite()) {\r\n                    // If multi-site, let the user choose which site to go to\r\n                    _this.$state.go('login.error.noSite', {\r\n                        detailsLocKey: errorLocKey,\r\n                        redirectState: 'login.site',\r\n                        redirectLocKey: 'goToSiteList'\r\n                    });\r\n                }\r\n                else {\r\n                    // We're single site, or this is our first state  (from a full page reload)\r\n                    // TODO: Should have a redirect on error page to precise last state or user's start page\r\n                    _this.$state.go('login.error.noSite', {\r\n                        detailsLocKey: errorLocKey\r\n                    });\r\n                }\r\n                return _this.$q.reject(error);\r\n            });\r\n        };\r\n        SiteSwitchService.prototype.getSwitchSiteErrorLocKey = function (error) {\r\n            switch (error.code) {\r\n                case VizPortal.SiteSwitchErrorCodes.UserNotMemberOfSiteOrSiteNotExist:\r\n                    return 'switchSiteFailedNotMemberOrNotExist';\r\n                case VizPortal.SiteSwitchErrorCodes.SiteLocked:\r\n                    return 'switchSiteFailedSiteLocked';\r\n                case VizPortal.SiteSwitchErrorCodes.SiteSuspended:\r\n                    return 'switchSiteFailedSiteSuspended';\r\n                case VizPortal.SiteSwitchErrorCodes.UserUnlicensedForSite:\r\n                    return 'switchSiteFailedUserUnlicensed';\r\n                default:\r\n                    return 'switchSiteFailedUnknown';\r\n            }\r\n        };\r\n        SiteSwitchService.prototype.switchIfNeededNoFeedback = function (urlName) {\r\n            this.previousSiteUrl = null;\r\n            return this.server.switchSiteIfNeeded(urlName);\r\n        };\r\n        SiteSwitchService.prototype.inServerState = function () {\r\n            return this.$state.includes('main.server.**');\r\n        };\r\n        SiteSwitchService.$inject = [\r\n            '$location',\r\n            '$q',\r\n            '$rootScope',\r\n            '$state',\r\n            '$translate',\r\n            'ServerService',\r\n            'StateWrapperService',\r\n            'ToasterService',\r\n            'WindowLocationService'\r\n        ];\r\n        return SiteSwitchService;\r\n    })();\r\n    VizPortal.SiteSwitchService = SiteSwitchService;\r\n    VizPortal.Module.instance().service('SiteSwitchService', SiteSwitchService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/Filter.ts\" />\r\n/// <reference path=\"../helpers/Keys.ts\" />\r\n/// <reference path=\"../models/ISliceable.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../resources/SiteNameSansIds.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetSiteNamesAcrossAllPodsRequest.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\n/// <reference path=\"../services/SiteSwitchService.ts\" />\r\n/// <reference path=\"../services/StartPageService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var LoginSitePickerCtrl = (function () {\r\n        function LoginSitePickerCtrl($scope, $location, siteNames, siteSwitchService, startPageService) {\r\n            $scope.siteSearchValue = '';\r\n            $scope.$watch('siteSearchValue', function (newValue) {\r\n                var query = siteNames.all();\r\n                if (_.isString(newValue) && newValue.length > 0) {\r\n                    query = query.withFilters([VizPortal.Filter.search(newValue)]);\r\n                }\r\n                $scope.sliceableSiteNames = query;\r\n            });\r\n            $scope.currentRow = {\r\n                index: 0\r\n            };\r\n            $scope.select = function (siteName) {\r\n                var siteUrl = siteName.urlName;\r\n                siteSwitchService.switchIfNeeded(siteUrl, '/#/site/' + siteUrl + '/').then(function () {\r\n                    return $location.url(startPageService.getCurrentUserStartPageForCurrentSite());\r\n                });\r\n            };\r\n            $scope.$watch('site', function (newSiteName) {\r\n                if (!newSiteName)\r\n                    return;\r\n                $scope.select(newSiteName);\r\n            });\r\n            $scope.handleKeyEvent = function ($event) {\r\n                switch ($event.which) {\r\n                    case VizPortal.Keys.ArrowDown:\r\n                        $event.preventDefault();\r\n                        $scope.currentRow.index++;\r\n                        break;\r\n                    case VizPortal.Keys.ArrowUp:\r\n                        $event.preventDefault();\r\n                        $scope.currentRow.index--;\r\n                        break;\r\n                    case VizPortal.Keys.Enter:\r\n                        $scope.select($scope.currentRow.object);\r\n                        break;\r\n                    case VizPortal.Keys.Escape:\r\n                        $scope.siteSearchValue = '';\r\n                        break;\r\n                }\r\n            };\r\n        }\r\n        LoginSitePickerCtrl.$inject = [\r\n            '$scope',\r\n            '$location',\r\n            'SiteNamesAcrossAllPods',\r\n            'SiteSwitchService',\r\n            'StartPageService'\r\n        ];\r\n        return LoginSitePickerCtrl;\r\n    })();\r\n    VizPortal.LoginSitePickerCtrl = LoginSitePickerCtrl;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/IGetItemsParams.ts\" />\r\n/// <reference path=\"../types/IGetItemsResult.ts\" />\r\n/// <reference path=\"../types/IWorkbookRevision.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetWorkbookVersionsRequest = (function (_super) {\r\n            __extends(GetWorkbookVersionsRequest, _super);\r\n            function GetWorkbookVersionsRequest(params) {\r\n                _super.call(this, 'getWorkbookVersions', params);\r\n            }\r\n            return GetWorkbookVersionsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetWorkbookVersionsRequest = GetWorkbookVersionsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var DeleteWorkbookVersionsRequest = (function (_super) {\r\n            __extends(DeleteWorkbookVersionsRequest, _super);\r\n            function DeleteWorkbookVersionsRequest(ids) {\r\n                _super.call(this, 'deleteWorkbookVersions', { ids: ids });\r\n            }\r\n            return DeleteWorkbookVersionsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.DeleteWorkbookVersionsRequest = DeleteWorkbookVersionsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../ServerApi/requests/getWorkbookVersionsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/DeleteWorkbookVersionsRequest.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var WorkbookRevisions = (function (_super) {\r\n        __extends(WorkbookRevisions, _super);\r\n        function WorkbookRevisions(ErrorNotifyingServer, FetcherFactory) {\r\n            _super.call(this, FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetWorkbookVersionsRequest, function (result) { return result.versions; }));\r\n            this.ErrorNotifyingServer = ErrorNotifyingServer;\r\n            this.server = ErrorNotifyingServer.getServerService();\r\n        }\r\n        WorkbookRevisions.prototype.del = function (id) {\r\n            return this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests([id], function (idsBlock) { return new VizPortal.ServerApi.DeleteWorkbookVersionsRequest(idsBlock); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        WorkbookRevisions.$inject = ['ErrorNotifyingServer', 'FetcherFactory'];\r\n        return WorkbookRevisions;\r\n    })(VizPortal.Resource);\r\n    VizPortal.WorkbookRevisions = WorkbookRevisions;\r\n    VizPortal.Module.instance().service('WorkbookRevisions', WorkbookRevisions);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var PreviewWorkbookRevisionAction = (function () {\r\n        function PreviewWorkbookRevisionAction($translate, toaster, windowLocationService) {\r\n            this.$translate = $translate;\r\n            this.toaster = toaster;\r\n            this.windowLocationService = windowLocationService;\r\n        }\r\n        PreviewWorkbookRevisionAction.prototype.openPreview = function (revision) {\r\n            this.windowLocationService.open('http://www.google.com');\r\n        };\r\n        PreviewWorkbookRevisionAction.$inject = ['$translate',\r\n            'ToasterService',\r\n            'WindowLocationService'];\r\n        return PreviewWorkbookRevisionAction;\r\n    })();\r\n    VizPortal.PreviewWorkbookRevisionAction = PreviewWorkbookRevisionAction;\r\n    VizPortal.Module.instance().service('PreviewWorkbookRevisionAction', PreviewWorkbookRevisionAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/ResultHelper.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DeleteWorkbookRevisionAction = (function () {\r\n        function DeleteWorkbookRevisionAction($translate, ConfirmActionDialog, toasterService, WorkbookRevisions) {\r\n            this.$translate = $translate;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.toasterService = toasterService;\r\n            this.WorkbookRevisions = WorkbookRevisions;\r\n        }\r\n        DeleteWorkbookRevisionAction.prototype.showDialogForAction = function (revision, context) {\r\n            var _this = this;\r\n            return this.ConfirmActionDialog.open({\r\n                scope: context.scope,\r\n                title: this.$translate.instant('delete'),\r\n                bodyText: this.$translate.instant('deleteWorkbookRevisionConfirm'),\r\n                actionName: this.$translate.instant('delete'),\r\n                isDeleteAction: true,\r\n                action: function (dialogInstance) {\r\n                    return _this.WorkbookRevisions.del(revision.id).then(function (result) {\r\n                        if (VizPortal.ResultHelper.hasErrors(result)) {\r\n                            _this.toasterService.pop({ type: VizPortal.ToastType.Error, text: _this.$translate.instant('deleteWorkbookRevisionError') });\r\n                        }\r\n                        else {\r\n                            _this.toasterService.pop({ type: VizPortal.ToastType.Info, text: _this.$translate.instant('deleteWorkbookRevisionSuccess') });\r\n                        }\r\n                    });\r\n                }\r\n            }).result;\r\n        };\r\n        DeleteWorkbookRevisionAction.$inject = ['$translate',\r\n            'ConfirmActionDialog',\r\n            'ToasterService',\r\n            'WorkbookRevisions'];\r\n        return DeleteWorkbookRevisionAction;\r\n    })();\r\n    VizPortal.DeleteWorkbookRevisionAction = DeleteWorkbookRevisionAction;\r\n    VizPortal.Module.instance().service('DeleteWorkbookRevisionAction', DeleteWorkbookRevisionAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/types/IWorkbookRevision.ts\" />\r\n/// <reference path=\"PreviewWorkbookRevisionAction.ts\" />\r\n/// <reference path=\"DeleteWorkbookRevisionAction.ts\" />\r\n/// <reference path=\"DownloadActions.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var RevisionActions = (function () {\r\n        function RevisionActions($q, $translate, PreviewWorkbookRevisionAction, DeleteWorkbookRevisionAction, DownloadActions) {\r\n            this.$q = $q;\r\n            this.$translate = $translate;\r\n            this.PreviewWorkbookRevisionAction = PreviewWorkbookRevisionAction;\r\n            this.DeleteWorkbookRevisionAction = DeleteWorkbookRevisionAction;\r\n            this.DownloadActions = DownloadActions;\r\n            this.workbookRevisionsActionDefinition = [\r\n                this.previewWorkbookRevisionAction(),\r\n                this.deleteWorkbookRevisionAction(),\r\n                this.downloadWorkbookRevisionAction()\r\n            ];\r\n        }\r\n        // public api\r\n        RevisionActions.prototype.getWorkbookRevisionActionButtons = function () {\r\n            return this.workbookRevisionsActionDefinition;\r\n        };\r\n        // action button factories\r\n        RevisionActions.prototype.previewWorkbookRevisionAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'preview',\r\n                translate: 'preview_action',\r\n                isAvailable: function (items) { return true; },\r\n                execute: function (items) {\r\n                    _this.PreviewWorkbookRevisionAction.openPreview(items.first());\r\n                    console.log('TODO: previewWorkbookRevisionAction');\r\n                    return _this.$q.when({});\r\n                }\r\n            };\r\n        };\r\n        RevisionActions.prototype.deleteWorkbookRevisionAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'remove',\r\n                translate: 'remove_action',\r\n                isAvailable: function (items) { return items.size() === 1; },\r\n                execute: function (items, context) {\r\n                    var scope = context.scope;\r\n                    _this.DeleteWorkbookRevisionAction.showDialogForAction(items.first(), context).then(function () { return scope.refreshItems(); });\r\n                }\r\n            };\r\n        };\r\n        RevisionActions.prototype.downloadWorkbookRevisionAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'download',\r\n                translate: 'download_action',\r\n                isAvailable: function (items) { return true; },\r\n                execute: function (items) {\r\n                    return _this.DownloadActions.downloadWorkbookRevision(items.first());\r\n                }\r\n            };\r\n        };\r\n        RevisionActions.$inject = ['$q',\r\n            '$translate',\r\n            'PreviewWorkbookRevisionAction',\r\n            'DeleteWorkbookRevisionAction',\r\n            'DownloadActions'];\r\n        return RevisionActions;\r\n    })();\r\n    VizPortal.RevisionActions = RevisionActions;\r\n    VizPortal.Module.instance().service('RevisionActions', RevisionActions);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../filters/SizeFilter.ts\" />\r\n/// <reference path=\"../helpers/ActionButtonsHelper.ts\" />\r\n/// <reference path=\"../models/ContentTypes.ts\" />\r\n/// <reference path=\"../models/ISliceable.ts\" />\r\n/// <reference path=\"../models/resourceInfoParts.ts\" />\r\n/// <reference path=\"../models/Set.ts\" />\r\n/// <reference path=\"../resources/WorkbookRevisions.ts\" />\r\n/// <reference path=\"../services/ActionPanelService.ts\" />\r\n/// <reference path=\"../services/QueryService.ts\" />\r\n/// <reference path=\"../services/RevisionActions.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\n/// <reference path=\"../../common/react/components/dataGrid/DataGrid.ts\" />\r\n/// <reference path=\"../../common/react/components/dataGrid/DataGridCells.ts\" />\r\n/// <reference path=\"../../common/react/components/ActionsMenuColumnCell.ts\" />\r\n/// <reference path=\"../../common/react/CommonDataGridColumns.ts\" />\r\n/// <reference path=\"../../common/react/CommonStyles.ts\" />\r\n/// <reference path=\"../../common/react/SparseCachedList.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var RevisionHistoryDialogCtrl = (function () {\r\n        function RevisionHistoryDialogCtrl($scope, $translate, AngularToReactDataGridBridge, queryService, AngularContextFactory, revisionActions, ServerService, WorkbookRevisions, sizeFilter) {\r\n            this.$scope = $scope;\r\n            this.$translate = $translate;\r\n            this.AngularToReactDataGridBridge = AngularToReactDataGridBridge;\r\n            this.queryService = queryService;\r\n            this.AngularContextFactory = AngularContextFactory;\r\n            this.revisionActions = revisionActions;\r\n            this.ServerService = ServerService;\r\n            this.WorkbookRevisions = WorkbookRevisions;\r\n            this.sizeFilter = sizeFilter;\r\n            this.configureForReactDataGrid();\r\n            var queryUpdater = this.createQueryUpdater();\r\n            $scope.refreshItems = function () {\r\n                queryUpdater.refresh();\r\n            };\r\n            $scope.refreshItems();\r\n        }\r\n        RevisionHistoryDialogCtrl.prototype.configureForReactDataGrid = function () {\r\n            var _this = this;\r\n            this.$scope.dataGridProps = {\r\n                cols: this.dataGridColumns(this.$scope),\r\n                update: 0,\r\n                onCellClick: function (item, columnKey) {\r\n                    _this.$scope.$apply(function () {\r\n                        if (!item.deleted) {\r\n                            if (VizPortal.FeatureFlags.toggleSelectableRow) {\r\n                                var onlySelectedRow = _this.$scope.selectedItems.size() === 1 && _this.$scope.selectedItems.contains(item);\r\n                                var isActionMenu = columnKey === 'actions';\r\n                                if (onlySelectedRow && !isActionMenu) {\r\n                                    _this.$scope.selectedItems.toggle(item);\r\n                                }\r\n                                else {\r\n                                    _this.$scope.selectedItems.clear();\r\n                                    _this.$scope.selectedItems.add(item);\r\n                                }\r\n                            }\r\n                            else {\r\n                                _this.$scope.selectedItems.clear();\r\n                                _this.$scope.selectedItems.add(item);\r\n                            }\r\n                            var keys = _this.$scope.selectedItems.keys();\r\n                            _this.$scope.dataGridProps.selectedKeys = _.object(keys, keys);\r\n                            _this.$scope.dataGridProps.update++;\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n            // TODO: find a better way to monitor changes in selected items\r\n            this.$scope.$watch(function () { return _this.$scope.selectedItems.size(); }, function () {\r\n                var keys = _this.$scope.selectedItems.keys();\r\n                _this.$scope.dataGridProps.selectedKeys = _.object(keys, keys);\r\n                _this.$scope.dataGridProps.update++;\r\n            });\r\n        };\r\n        RevisionHistoryDialogCtrl.prototype.createQueryUpdater = function () {\r\n            var _this = this;\r\n            return this.queryService.createQueryUpdater(this.$scope, VizPortal.WorkbookRevisionContentType, this.WorkbookRevisions, function (resourceQuery) {\r\n                _this.AngularToReactDataGridBridge.updateReactDataGridRowStore({\r\n                    scope: _this.$scope,\r\n                    sliceable: resourceQuery,\r\n                    getRowStyle: _this.getRowStyle\r\n                });\r\n                _this.$scope.sliceable = resourceQuery;\r\n            }, { forWorkbook: this.$scope.workbookId });\r\n        };\r\n        RevisionHistoryDialogCtrl.prototype.dataGridColumns = function ($scope) {\r\n            var columns = [];\r\n            // 'Name' columns\r\n            columns.push({\r\n                name: 'version-num-col',\r\n                dataKey: 'versionNumber',\r\n                text: this.$translate.instant('revisionHistoryRevisionNumberColumn'),\r\n                cellFormatter: this.revisionNameCellFormatter(),\r\n                headerStyle: { textAlign: 'left' },\r\n                cellStyle: { textAlign: 'left' },\r\n                resizable: false,\r\n                growToFit: true,\r\n                sortable: false\r\n            });\r\n            // 'Owner' column\r\n            columns.push({\r\n                name: 'owner-col',\r\n                dataKey: 'owner',\r\n                text: this.$translate.instant('revisionHistoryOwnerColumn'),\r\n                cellFormatter: VizPortalReact.DataGridCells.PlainTextCell('publisher'),\r\n                headerStyle: { textAlign: 'left' },\r\n                cellStyle: { textAlign: 'left' },\r\n                resizable: false,\r\n                growToFit: true,\r\n                sortable: false\r\n            });\r\n            // 'Date' column\r\n            columns.push({\r\n                name: 'publish-time-col',\r\n                dataKey: 'publishTime',\r\n                text: this.$translate.instant('revisionHistoryPublishDateColumn'),\r\n                cellFormatter: VizPortalReact.DataGridCells.DateTimeCell('publishTime'),\r\n                headerStyle: { textAlign: 'right' },\r\n                cellStyle: { textAlign: 'right' },\r\n                resizable: false,\r\n                growToFit: true,\r\n                sortable: false\r\n            });\r\n            // 'Actions' column\r\n            columns.push({\r\n                name: 'actions-col',\r\n                dataKey: 'actions',\r\n                text: '',\r\n                cellFormatter: this.revisionActionsCellFormatter($scope),\r\n                headerStyle: { textAlign: 'right' },\r\n                cellStyle: { textAlign: 'right', overflow: 'visible' },\r\n                resizable: false,\r\n                sortable: false\r\n            });\r\n            return columns;\r\n        };\r\n        RevisionHistoryDialogCtrl.prototype.revisionNameCellFormatter = function () {\r\n            var $translate = this.$translate;\r\n            return React.createFactory(React.createClass({\r\n                render: function () {\r\n                    var props = this.props;\r\n                    var str = $translate.instant('revisionHistoryRevisionNumberLabel', { REVISION_NUMBER: props.value });\r\n                    return React.DOM.span({}, str);\r\n                }\r\n            }));\r\n        };\r\n        RevisionHistoryDialogCtrl.prototype.revisionActionsCellFormatter = function ($scope) {\r\n            var actions = this.revisionActions.getWorkbookRevisionActionButtons();\r\n            var $translate = this.$translate;\r\n            return React.createFactory(React.createClass({\r\n                render: function () {\r\n                    var revision = this.props.row.data;\r\n                    return revision.deleted\r\n                        ? React.DOM.span({}, '')\r\n                        : VizPortalReact.ActionsMenuColumnCell.element({\r\n                            actions: actions,\r\n                            getActionTarget: function () {\r\n                                return {\r\n                                    items: $scope.selectedItems,\r\n                                    actionContext: { scope: $scope }\r\n                                };\r\n                            },\r\n                            translate: function (id) { return $translate.instant(id); }\r\n                        }, React.DOM.div({ key: 'name' }, ''));\r\n                }\r\n            }));\r\n        };\r\n        RevisionHistoryDialogCtrl.prototype.getRowStyle = function (revision) {\r\n            return revision.deleted\r\n                ? {\r\n                    backgroundColor: VizPortalReact.CommonStyles.Colors.White,\r\n                    color: VizPortalReact.CommonStyles.Colors.DisabledTextColor\r\n                }\r\n                : null;\r\n        };\r\n        RevisionHistoryDialogCtrl.$inject = [\r\n            '$scope',\r\n            '$translate',\r\n            'AngularToReactDataGridBridge',\r\n            'QueryService',\r\n            'AngularContextFactory',\r\n            'RevisionActions',\r\n            'ServerService',\r\n            'WorkbookRevisions',\r\n            'sizeFilter'\r\n        ];\r\n        return RevisionHistoryDialogCtrl;\r\n    })();\r\n    VizPortal.RevisionHistoryDialogCtrl = RevisionHistoryDialogCtrl;\r\n    VizPortal.Module.instance().controller('RevisionHistoryDialogCtrl', RevisionHistoryDialogCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/ErrorMessageHandler.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\n/// <reference path=\"../services/WindowLocationService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SignInErrorCtrl = (function () {\r\n        function SignInErrorCtrl($scope, $stateParams, $location, windowLocationService, errorMessageHandler) {\r\n            // Coerse error code\r\n            var errorCode = +$stateParams.errorCode;\r\n            var redirectPath = $stateParams.redirectPath || '/';\r\n            $scope.tryAgain = function () {\r\n                // Prevent redirect injection by appending the current host to the redirect\r\n                var target = $location.protocol() + '://' + $location.host() + ':' + $location.port() + redirectPath;\r\n                windowLocationService.navigateToWithoutAddingToHistory(target);\r\n            };\r\n            $scope.errorMessages = errorMessageHandler.getSignInErrorMessages(errorCode);\r\n        }\r\n        SignInErrorCtrl.$inject = [\r\n            '$scope',\r\n            '$stateParams',\r\n            '$location',\r\n            'WindowLocationService',\r\n            'ErrorMessageHandler'\r\n        ];\r\n        return SignInErrorCtrl;\r\n    })();\r\n    VizPortal.SignInErrorCtrl = SignInErrorCtrl;\r\n    VizPortal.Module.instance().controller('SignInErrorCtrl', SignInErrorCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/CommonDataGridColumns.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var ScheduleGrid;\r\n    (function (ScheduleGrid) {\r\n        function columns(translate, scope, actions, isServerPage, serverUrls, siteUrls, scheduleTypeNameFilter, scheduleActionNameFilter) {\r\n            var columns = [\r\n                VizPortalReact.CommonDataGridColumns.selected(scope),\r\n                nameColumn(translate, isServerPage, serverUrls, siteUrls, actions, scope),\r\n                {\r\n                    name: 'frequency-col',\r\n                    dataKey: 'scheduleType',\r\n                    text: translate('column_schedule_frequency'),\r\n                    direction: 'asc',\r\n                    cellFormatter: VizPortalReact.DataGridCells.PlainTextCellWithTransform('scheduleType', scheduleTypeNameFilter)\r\n                },\r\n                {\r\n                    name: 'task-type-col',\r\n                    dataKey: 'scheduledAction',\r\n                    text: translate('column_schedule_type'),\r\n                    direction: 'asc',\r\n                    cellFormatter: VizPortalReact.DataGridCells.PlainTextCellWithTransform('scheduledAction', scheduleActionNameFilter)\r\n                },\r\n                {\r\n                    name: 'task-count-col',\r\n                    dataKey: 'taskCount',\r\n                    text: translate('column_schedule_task_count'),\r\n                    cellFormatter: VizPortalReact.DataGridCells.LocalizedCount('taskCount'),\r\n                    direction: 'asc',\r\n                    headerStyle: { textAlign: 'right' },\r\n                    cellStyle: { textAlign: 'right' }\r\n                },\r\n                {\r\n                    name: 'execution-col',\r\n                    dataKey: 'parallel',\r\n                    direction: 'asc',\r\n                    text: translate('column_schedule_behavior'),\r\n                    cellFormatter: VizPortalReact.DataGridCells.PlainTextCellWithTransform('parallel', function (parallel) {\r\n                        return parallel ? translate('scheduleBehaviorParallel') : translate('scheduleBehaviorSerial');\r\n                    })\r\n                },\r\n                {\r\n                    name: 'next-run-at-col',\r\n                    dataKey: 'runNextAt',\r\n                    text: translate('column_schedule_next_run'),\r\n                    direction: 'asc',\r\n                    cellFormatter: VizPortalReact.DataGridCells.DateTimeCell('runNextAt', translate('disabled'))\r\n                }\r\n            ];\r\n            return columns;\r\n        }\r\n        ScheduleGrid.columns = columns;\r\n        function nameColumn(translate, isServerPage, serverUrls, siteUrls, actions, scope) {\r\n            return VizPortalReact.CommonDataGridColumns.withActions({\r\n                name: 'name-col',\r\n                dataKey: 'name',\r\n                text: translate('column_name'),\r\n                direction: 'asc',\r\n                cellFormatter: VizPortalReact.DataGridCells.Link(function (row) {\r\n                    return {\r\n                        text: row.data.name,\r\n                        url: isServerPage\r\n                            ? serverUrls.schedule(row.data.id, row.data.scheduledAction)\r\n                            : siteUrls.schedule(row.data.id, row.data.scheduledAction),\r\n                        iconClassName: 'tb-grid-icon-schedule',\r\n                        iconTitle: translate('schedule')\r\n                    };\r\n                })\r\n            }, {\r\n                actions: actions,\r\n                getActionTarget: function () {\r\n                    return {\r\n                        items: scope.selectedItems,\r\n                        actionContext: { scope: scope }\r\n                    };\r\n                },\r\n                translate: translate\r\n            });\r\n        }\r\n    })(ScheduleGrid = VizPortalReact.ScheduleGrid || (VizPortalReact.ScheduleGrid = {}));\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SchedulesConfig = (function () {\r\n        function SchedulesConfig($state) {\r\n            this.$state = $state;\r\n        }\r\n        SchedulesConfig.prototype.siteUrlFor = function (schedule) {\r\n            return this.$state.href('main.site.schedule.' + this.defaultChildState(schedule), { id: schedule.id });\r\n        };\r\n        SchedulesConfig.prototype.serverUrlFor = function (schedule) {\r\n            return this.$state.href('main.server.schedule.' + this.defaultChildState(schedule), { id: schedule.id });\r\n        };\r\n        SchedulesConfig.prototype.defaultChildState = function (schedule) {\r\n            return schedule.scheduledAction === VizPortal.ServerApi.ScheduleActions.Extract\r\n                ? 'extractTasks'\r\n                : 'subscriptions';\r\n        };\r\n        SchedulesConfig.$inject = ['$state'];\r\n        return SchedulesConfig;\r\n    })();\r\n    VizPortal.SchedulesConfig = SchedulesConfig;\r\n    VizPortal.Module.instance().service('SchedulesConfig', SchedulesConfig);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../../app/IMainScope.ts\" />\r\n/// <reference path=\"../../app/IPlaceTitleScope.ts\" />\r\n/// <reference path=\"../../app/content/ScheduleGrid.ts\" />\r\n/// <reference path=\"../../common/react/components/dataGrid/AngularToReactDataGridBridge.ts\" />\r\n/// <reference path=\"../helpers/ActionButtonsHelper.ts\" />\r\n/// <reference path=\"../models/IEmptyTemplate.ts\" />\r\n/// <reference path=\"../models/ITemplate.ts\" />\r\n/// <reference path=\"../resources/Schedules.ts\" />\r\n/// <reference path=\"../services/BrowserTitleService.ts\" />\r\n/// <reference path=\"../services/CreateScheduleAction.ts\" />\r\n/// <reference path=\"../services/DeleteSchedulesAction.ts\" />\r\n/// <reference path=\"../services/QueryService.ts\" />\r\n/// <reference path=\"../services/RenameScheduleAction.ts\" />\r\n/// <reference path=\"../services/RunServerSchedulesAction.ts\" />\r\n/// <reference path=\"../services/RunSchedulesAction.ts\" />\r\n/// <reference path=\"../services/SchedulePermissions.ts\" />\r\n/// <reference path=\"../services/SchedulesConfig.ts\" />\r\n/// <reference path=\"../services/SelectionService.ts\" />\r\n/// <reference path=\"../services/SetScheduleStatusAction.ts\" />\r\n/// <reference path=\"../services/SorterFactory.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SchedulesCtrl = (function () {\r\n        function SchedulesCtrl($scope, $state, $translate, AngularToReactDataGridBridge, $filter, BrowserTitleService, siteId, queryService, SchedulesConfig, SchedulePermissions, SelectionService, Schedules, SorterFactory, ServerService, CreateScheduleAction, SetScheduleStatusAction, RunServerSchedulesAction, RunSchedulesAction, DeleteSchedulesAction, RenameScheduleAction) {\r\n            var _this = this;\r\n            this.$scope = $scope;\r\n            this.$state = $state;\r\n            this.$translate = $translate;\r\n            this.AngularToReactDataGridBridge = AngularToReactDataGridBridge;\r\n            this.$filter = $filter;\r\n            this.SchedulesConfig = SchedulesConfig;\r\n            this.SchedulePermissions = SchedulePermissions;\r\n            this.Schedules = Schedules;\r\n            this.ServerService = ServerService;\r\n            this.CreateScheduleAction = CreateScheduleAction;\r\n            this.SetScheduleStatusAction = SetScheduleStatusAction;\r\n            this.RunServerSchedulesAction = RunServerSchedulesAction;\r\n            this.RunSchedulesAction = RunSchedulesAction;\r\n            this.DeleteSchedulesAction = DeleteSchedulesAction;\r\n            this.RenameScheduleAction = RenameScheduleAction;\r\n            var selectedItems = new VizPortal.Set(function (schedule) { return schedule.id; });\r\n            var actions = this.createActions(selectedItems, siteId);\r\n            $scope.selectedItems = selectedItems;\r\n            $scope.useReactDataGrid = VizPortal.FeatureFlags.reactSchedulesGrid;\r\n            if (VizPortal.FeatureFlags.reactSchedulesGrid) {\r\n                this.configureForReactDataGrid(actions);\r\n            }\r\n            BrowserTitleService.setTitle('schedules');\r\n            $scope.sorter = SorterFactory.create(VizPortal.ScheduleContentType.defaultOrder);\r\n            this.query = queryService.createQueryUpdater($scope, VizPortal.ScheduleContentType, Schedules, function (resourceQuery) {\r\n                if (siteId) {\r\n                    resourceQuery = resourceQuery.addFilter(VizPortal.Filter.fieldEq(VizPortal.ServerApi.FilterFieldNames.siteId, siteId));\r\n                }\r\n                if (VizPortal.FeatureFlags.reactSchedulesGrid) {\r\n                    _this.AngularToReactDataGridBridge.updateReactDataGridRowStore({ scope: $scope, sliceable: resourceQuery });\r\n                }\r\n                $scope.sliceable = resourceQuery;\r\n                $scope.sorter.setOrder(resourceQuery.getOrder());\r\n                resourceQuery.getCount().then(function (result) {\r\n                    _this.$scope.schedules.count = result;\r\n                });\r\n            }, {});\r\n            this.query.refresh();\r\n            $scope.placeTitleClicked = function () {\r\n                _this.refreshSchedules();\r\n            };\r\n            $scope.availableAction = function (action) { return action.isAvailable($scope.selectedItems); };\r\n            VizPortal.ActionButtonsHelper.setupActionButtons($scope, actions);\r\n            $scope.listActions = [{\r\n                    name: 'create-new-schedule',\r\n                    translate: 'newSchedule',\r\n                    isAvailable: function () { return ServerService.isSessionServerAdmin(); },\r\n                    execute: function ($event) {\r\n                        CreateScheduleAction.createSchedule(VizPortal.ActionContext.fromEvent($event)).then(function () { return _this.refreshSchedules(); });\r\n                    }\r\n                }];\r\n            $scope.availableListAction = function (listAction) { return listAction.isAvailable(); };\r\n            $scope.rowClicked = function (row, colIndex) {\r\n                SelectionService.rowClicked($scope.selectedItems, row, colIndex);\r\n            };\r\n            $scope.sliceChanged = function (newSlice) {\r\n                $scope.selectedItems.updateItems(newSlice.items);\r\n                $scope.schedules.count = newSlice.total;\r\n            };\r\n            $scope.headerClicked = function (header) { return $scope.sorter.setPrimary(header.attrs['key'], header.attrs['direction']); };\r\n            $scope.schedules = { count: 0 };\r\n            $scope.scheduleUrl = function (schedule) {\r\n                return siteId\r\n                    ? _this.SchedulesConfig.siteUrlFor(schedule)\r\n                    : _this.SchedulesConfig.serverUrlFor(schedule);\r\n            };\r\n            $scope.emptyTemplateModel = SchedulesCtrl.emptyTemplateModel;\r\n        }\r\n        SchedulesCtrl.prototype.configureForReactDataGrid = function (actions) {\r\n            var _this = this;\r\n            var siteUrls = new VizPortalReact.SiteUrls({\r\n                siteUrlName: this.ServerService.sessionSiteUrlName(),\r\n                queryString: window.location.search\r\n            });\r\n            var columns = VizPortalReact.ScheduleGrid.columns(function (id) { return _this.$translate.instant(id); }, this.$scope, actions, this.isServerPage(), new VizPortalReact.ServerUrls(window.location.search), siteUrls, this.$filter('scheduleTypeName'), this.$filter('scheduleActionName'));\r\n            this.AngularToReactDataGridBridge.attachReactDataGridToScope(this.$scope, columns, SchedulesCtrl.emptyTemplateModel);\r\n        };\r\n        SchedulesCtrl.prototype.isServerPage = function () {\r\n            return this.$state.includes(\"main.server.**\");\r\n        };\r\n        SchedulesCtrl.prototype.createActions = function (selectedItems, siteId) {\r\n            var _this = this;\r\n            return [\r\n                {\r\n                    name: 'schedules-run-now',\r\n                    translate: 'runNow_action',\r\n                    isAvailable: function (schedules) {\r\n                        return schedules.size() > 0 && _this.SchedulePermissions.canRunSchedule();\r\n                    },\r\n                    execute: function (items, context) {\r\n                        if (!siteId) {\r\n                            _this.RunServerSchedulesAction.execute(items, context)\r\n                                .then(function (result) {\r\n                                VizPortal.ActionHelpers.deselectNotFound(selectedItems, result, VizPortal.SchedulingErrorCode.SchedulingScheduleNotFound);\r\n                                _this.refreshSchedules();\r\n                            });\r\n                        }\r\n                        else {\r\n                            _this.RunSchedulesAction.execute(items, context)\r\n                                .then(function (result) {\r\n                                VizPortal.ActionHelpers.deselectNotFound(selectedItems, result, VizPortal.SchedulingErrorCode.SchedulingScheduleNotFound);\r\n                                _this.refreshSchedules();\r\n                            });\r\n                        }\r\n                    }\r\n                },\r\n                {\r\n                    name: 'enableSchedules',\r\n                    translate: 'enable_action',\r\n                    isAvailable: function (schedules) {\r\n                        return schedules.size() > 0 && _this.SchedulePermissions.canEditSchedule();\r\n                    },\r\n                    isDisabled: function (schedules) {\r\n                        return !_.any(schedules.toArray(), function (schedule) { return !_this.isScheduleEnabled(schedule); });\r\n                    },\r\n                    execute: function (items, context) {\r\n                        _this.SetScheduleStatusAction.confirmEnableSchedules(items, context)\r\n                            .then(function (result) {\r\n                            VizPortal.ActionHelpers.deselectNotFound(selectedItems, result, VizPortal.SchedulingErrorCode.SchedulingScheduleNotFound);\r\n                            _this.refreshSchedules();\r\n                        });\r\n                    }\r\n                },\r\n                {\r\n                    name: 'disableSchedules',\r\n                    translate: 'disable_action',\r\n                    isAvailable: function (schedules) {\r\n                        return schedules.size() > 0 && _this.SchedulePermissions.canEditSchedule();\r\n                    },\r\n                    isDisabled: function (schedules) {\r\n                        return !_.any(schedules.toArray(), function (schedule) { return _this.isScheduleEnabled(schedule); });\r\n                    },\r\n                    execute: function (items, context) {\r\n                        _this.SetScheduleStatusAction.confirmDisableSchedules(items, context)\r\n                            .then(function (result) {\r\n                            VizPortal.ActionHelpers.deselectNotFound(selectedItems, result, VizPortal.SchedulingErrorCode.SchedulingScheduleNotFound);\r\n                            _this.refreshSchedules();\r\n                        });\r\n                    }\r\n                },\r\n                {\r\n                    name: 'rename-schedule',\r\n                    translate: 'rename_action',\r\n                    isAvailable: function (schedules) {\r\n                        return schedules.size() > 0 && _this.SchedulePermissions.canEditSchedule();\r\n                    },\r\n                    isDisabled: function (schedules) { return schedules.size() !== 1; },\r\n                    execute: function (items, context) {\r\n                        _this.RenameScheduleAction.confirmRename(items.first(), context)\r\n                            .then(function (result) {\r\n                            VizPortal.ActionHelpers.deselectNotFound(selectedItems, result, VizPortal.SchedulingErrorCode.SchedulingScheduleNotFound);\r\n                            _this.refreshSchedules();\r\n                        });\r\n                    }\r\n                },\r\n                {\r\n                    name: 'edit-schedule',\r\n                    translate: 'editScheduleSettings_action',\r\n                    isAvailable: function (schedules) {\r\n                        return schedules.size() > 0 && _this.SchedulePermissions.canEditSchedule();\r\n                    },\r\n                    isDisabled: function (schedules) { return schedules.size() !== 1; },\r\n                    execute: function (items, context) {\r\n                        _this.CreateScheduleAction.editSchedule(items.first(), context)\r\n                            .then(function (result) {\r\n                            VizPortal.ActionHelpers.deselectNotFound(selectedItems, result, VizPortal.SchedulingErrorCode.SchedulingScheduleNotFound);\r\n                            _this.refreshSchedules();\r\n                        });\r\n                    }\r\n                },\r\n                {\r\n                    name: 'delete-schedule',\r\n                    translate: 'delete_action',\r\n                    isAvailable: function (schedules) {\r\n                        return schedules.size() > 0 && _this.SchedulePermissions.canEditSchedule();\r\n                    },\r\n                    execute: function (items, context) {\r\n                        _this.DeleteSchedulesAction.deleteSchedules(items, context)\r\n                            .then(function (result) {\r\n                            VizPortal.ActionHelpers.deselectAllExceptErrors(selectedItems, result, VizPortal.SchedulingErrorCode.SchedulingScheduleNotFound);\r\n                            _this.refreshSchedules();\r\n                        });\r\n                    }\r\n                }\r\n            ];\r\n        };\r\n        SchedulesCtrl.prototype.refreshSchedules = function () {\r\n            this.query.refresh();\r\n        };\r\n        SchedulesCtrl.prototype.isScheduleEnabled = function (schedule) {\r\n            return !!schedule.runNextAt;\r\n        };\r\n        SchedulesCtrl.$inject = [\r\n            '$scope',\r\n            '$state',\r\n            '$translate',\r\n            'AngularToReactDataGridBridge',\r\n            '$filter',\r\n            'BrowserTitleService',\r\n            'siteId',\r\n            'QueryService',\r\n            'SchedulesConfig',\r\n            'SchedulePermissions',\r\n            'SelectionService',\r\n            'Schedules',\r\n            'SorterFactory',\r\n            'ServerService',\r\n            'CreateScheduleAction',\r\n            'SetScheduleStatusAction',\r\n            'RunServerSchedulesAction',\r\n            'RunSchedulesAction',\r\n            'DeleteSchedulesAction',\r\n            'RenameScheduleAction'\r\n        ];\r\n        SchedulesCtrl.emptyTemplateModel = { title: 'schedulesEmptyMessage' };\r\n        return SchedulesCtrl;\r\n    })();\r\n    VizPortal.SchedulesCtrl = SchedulesCtrl;\r\n    VizPortal.Module.instance().controller('SchedulesCtrl', SchedulesCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        ServerApi.WorkerProcessType = {\r\n            clusterController: 'clustercontroller',\r\n            gateway: 'gateway',\r\n            vizportal: 'vizportal',\r\n            vizqlServer: 'vizqlserver',\r\n            cacheServer: 'cacheserver',\r\n            searchServer: 'searchserver',\r\n            backgrounder: 'backgrounder',\r\n            dataServer: 'dataserver',\r\n            dataEngine: 'dataengine',\r\n            wgServer: 'wgserver',\r\n            fileStore: 'filestore',\r\n            repository: 'repository'\r\n        };\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/IWorkerProcess.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        ServerApi.WorkerStatusType = {\r\n            active: 'active',\r\n            activeSyncing: 'activesyncing',\r\n            busy: 'busy',\r\n            decommissionFailedReadOnly: 'decommissionfailedreadonly',\r\n            decommissioningReadOnly: 'decommissioningreadonly',\r\n            down: 'down',\r\n            passive: 'passive',\r\n            readOnly: 'readonly',\r\n            readyForRemoval: 'readyforremoval',\r\n            statusNotAvailable: 'statusnotavailable',\r\n            statusNotAvailableSyncing: 'statusnotavailablesyncing',\r\n            unlicensed: 'unlicensed'\r\n        };\r\n        var GetWorkerProcessStatus = (function (_super) {\r\n            __extends(GetWorkerProcessStatus, _super);\r\n            function GetWorkerProcessStatus(params) {\r\n                _super.call(this, 'getWorkerProcessStatus', params);\r\n            }\r\n            return GetWorkerProcessStatus;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetWorkerProcessStatus = GetWorkerProcessStatus;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ConfirmActionDialog = (function () {\r\n        function ConfirmActionDialog($rootScope, modal, $q) {\r\n            this.$rootScope = $rootScope;\r\n            this.modal = modal;\r\n            this.$q = $q;\r\n        }\r\n        ConfirmActionDialog.prototype.open = function (config) {\r\n            var _this = this;\r\n            if (!_.isUndefined(config.bodyText) && !_.isUndefined(config.bodyTemplateUrl)) {\r\n                throw new Error('bodyTemplateUrl cannot be defined if bodyText is defined on an IConfirmActionDialogOptions object');\r\n            }\r\n            // Convert single button to multiple buttons\r\n            if (!config.buttons && config.actionName) {\r\n                config.buttons = [\r\n                    {\r\n                        label: config.actionName,\r\n                        action: config.action,\r\n                        disabled: config.confirmDisabled\r\n                    }\r\n                ];\r\n            }\r\n            var lastError = undefined;\r\n            var buttonActor;\r\n            var confirmActionDialogScope = (config.scope || this.$rootScope).$new();\r\n            confirmActionDialogScope.setActor = function (button) { return buttonActor = button; };\r\n            confirmActionDialogScope.isActor = function (button) { return buttonActor === button; };\r\n            confirmActionDialogScope.progress = { percent: undefined };\r\n            // Determine initial focus\r\n            confirmActionDialogScope.initialFocus = _.find(config.buttons, function (button) { return !button.disabled || !button.disabled(); });\r\n            var modalOptions = {\r\n                templateUrl: 'confirmActionDialog.html',\r\n                position: config.position,\r\n                scope: confirmActionDialogScope,\r\n                controller: [\r\n                    '$scope', function (dialogScope) {\r\n                        dialogScope.config = config;\r\n                        dialogScope.busy = false;\r\n                        dialogScope.confirm = function () {\r\n                            if (!buttonActor) {\r\n                                return;\r\n                            }\r\n                            dialogScope.busy = true;\r\n                            dialogScope.errorMessage = undefined;\r\n                            lastError = undefined;\r\n                            dialogScope.progress.percent = undefined;\r\n                            // prevent closing of the dialog while we are waiting for the actionPromise to resolve\r\n                            modalOptions.keyboard = false;\r\n                            modalOptions.backdrop = 'static'; // static backdrops don't close the modal on click.\r\n                            // Convert the action result to a promise, if necessary\r\n                            var actionPromise = _this.$q.when(buttonActor.action(confirmActionDialogInstance));\r\n                            actionPromise.then(function (result) {\r\n                                if (lastError) {\r\n                                    dialogScope.errorMessage = lastError;\r\n                                }\r\n                                else {\r\n                                    dialogScope.close(result);\r\n                                }\r\n                            })\r\n                                .fin(function () {\r\n                                dialogScope.busy = false;\r\n                                modalOptions.backdrop = true;\r\n                                modalOptions.keyboard = true;\r\n                            });\r\n                        };\r\n                    }\r\n                ],\r\n                size: config.size\r\n            };\r\n            // Pre-load the dialog body template to avoid flickering/re-layout\r\n            if (config.bodyTemplateUrl) {\r\n                modalOptions.resolve = {\r\n                    bodyTemplateContent: ['$http', '$templateCache', function ($http, $templateCache) {\r\n                            return $http.get(config.bodyTemplateUrl, { cache: $templateCache });\r\n                        }]\r\n                };\r\n            }\r\n            var confirmActionDialogInstance = this.modal.open(modalOptions);\r\n            confirmActionDialogInstance.showErrorMessage = function (error) {\r\n                lastError = error;\r\n            };\r\n            confirmActionDialogInstance.setProgress = function (progress) {\r\n                confirmActionDialogScope.progress.percent = progress;\r\n            };\r\n            confirmActionDialogInstance.result.fin(function () { return confirmActionDialogScope.$destroy(); });\r\n            return confirmActionDialogInstance;\r\n        };\r\n        ConfirmActionDialog.$inject = ['$rootScope', 'ModalService', '$q'];\r\n        return ConfirmActionDialog;\r\n    })();\r\n    VizPortal.ConfirmActionDialog = ConfirmActionDialog;\r\n    VizPortal.Module.instance().service('ConfirmActionDialog', ConfirmActionDialog);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var RebuildSearchIndexRequest = (function (_super) {\r\n            __extends(RebuildSearchIndexRequest, _super);\r\n            function RebuildSearchIndexRequest(params) {\r\n                if (params === void 0) { params = {}; }\r\n                _super.call(this, 'rebuildSearchIndex', params);\r\n            }\r\n            return RebuildSearchIndexRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.RebuildSearchIndexRequest = RebuildSearchIndexRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/RebuildSearchIndexRequest.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var RebuildSearchIndexService = (function () {\r\n        function RebuildSearchIndexService($translate, server, lrActionService, toasterService) {\r\n            this.$translate = $translate;\r\n            this.server = server;\r\n            this.lrActionService = lrActionService;\r\n            this.toasterService = toasterService;\r\n            this.rebuildSearchIndexPercent = 0;\r\n            this.rebuildSearchIndexPending = false;\r\n        }\r\n        RebuildSearchIndexService.prototype.handleCurrentJob = function () {\r\n            var _this = this;\r\n            return this.lrActionService.getLastByType(VizPortal.LongRunningActionType.RebuildSearchIndex)\r\n                .then(function (action) { return _this.handleRebuildSearchIndexStatus(action); });\r\n        };\r\n        RebuildSearchIndexService.prototype.getRebuildSearchIndexPercent = function () {\r\n            return this.rebuildSearchIndexPercent;\r\n        };\r\n        RebuildSearchIndexService.prototype.getRebuildSearchIndexPending = function () {\r\n            return this.rebuildSearchIndexPending;\r\n        };\r\n        RebuildSearchIndexService.prototype.rebuildSearchIndex = function () {\r\n            var _this = this;\r\n            this.rebuildSearchIndexPercent = 0;\r\n            return this.server.sendRequest(new VizPortal.ServerApi.RebuildSearchIndexRequest)\r\n                .then(function (result) {\r\n                var existingRebuild = !result.actionId;\r\n                if (!existingRebuild) {\r\n                    _this.trackRebuildSearchIndexProgress(result.actionId);\r\n                }\r\n                else {\r\n                    _this.getRebuildSearchIndexStatus();\r\n                }\r\n            });\r\n        };\r\n        RebuildSearchIndexService.prototype.cancelPoll = function () {\r\n            if (this.rebuildSearchIndexPoller) {\r\n                this.rebuildSearchIndexPoller.cancel();\r\n            }\r\n            this.rebuildSearchIndexPercent = 0;\r\n            this.rebuildSearchIndexPending = false;\r\n        };\r\n        RebuildSearchIndexService.prototype.trackRebuildSearchIndexProgress = function (actionId) {\r\n            var _this = this;\r\n            var completeFn = function (action) {\r\n                if (action && action.succeeded === false) {\r\n                    failFn(action && action.response && action.response.errors);\r\n                }\r\n                else {\r\n                    _this.rebuildSearchIndexPercent = 100;\r\n                    _this.toasterService.pop({ type: VizPortal.ToastType.Info, text: _this.$translate.instant('rebuildSearchIndexSuccess') });\r\n                }\r\n            };\r\n            var notifyFn = function (action) {\r\n                _this.rebuildSearchIndexPercent = action.percentComplete;\r\n            };\r\n            var failFn = function (reason) {\r\n                if (reason !== VizPortal.ErrorReason.Canceled) {\r\n                    _this.toasterService.pop({ type: VizPortal.ToastType.Error, text: _this.$translate.instant('rebuildSearchIndexError') });\r\n                }\r\n            };\r\n            if (actionId) {\r\n                this.rebuildSearchIndexPending = true;\r\n                this.rebuildSearchIndexPoller = this.lrActionService.trackProgress(actionId);\r\n                this.rebuildSearchIndexPoller.promise\r\n                    .then(completeFn, failFn, notifyFn)\r\n                    .fin(function () { return _this.rebuildSearchIndexPending = false; });\r\n            }\r\n            else {\r\n                failFn(VizPortal.ErrorReason.Unknown);\r\n            }\r\n        };\r\n        RebuildSearchIndexService.prototype.getRebuildSearchIndexStatus = function () {\r\n            var _this = this;\r\n            this.lrActionService.getLastByType(VizPortal.LongRunningActionType.RebuildSearchIndex)\r\n                .then(function (action) { return _this.handleRebuildSearchIndexStatus(action); });\r\n        };\r\n        RebuildSearchIndexService.prototype.handleRebuildSearchIndexStatus = function (action) {\r\n            if (action && action.state !== VizPortal.LongRunningActionState.Complete) {\r\n                this.rebuildSearchIndexPercent = action.percentComplete;\r\n                this.trackRebuildSearchIndexProgress(action.id);\r\n            }\r\n        };\r\n        RebuildSearchIndexService.$inject = [\r\n            '$translate',\r\n            'ServerService',\r\n            'LongRunningActionService',\r\n            'ToasterService'\r\n        ];\r\n        return RebuildSearchIndexService;\r\n    })();\r\n    VizPortal.RebuildSearchIndexService = RebuildSearchIndexService;\r\n    VizPortal.Module.instance().service('RebuildSearchIndexService', RebuildSearchIndexService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/IWorkerProcess.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetServerInfoRequest = (function (_super) {\r\n            __extends(GetServerInfoRequest, _super);\r\n            function GetServerInfoRequest(params) {\r\n                _super.call(this, 'getServerInfo', params);\r\n            }\r\n            return GetServerInfoRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetServerInfoRequest = GetServerInfoRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/IHost.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetServerInfoRequest.ts\" />\r\n/// <reference path=\"../ServerApi/types/IWorkerProcess.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerInfoService = (function () {\r\n        function ServerInfoService(server) {\r\n            this.server = server;\r\n        }\r\n        ServerInfoService.prototype.fetch = function () {\r\n            var _this = this;\r\n            return this.server.sendRequest(new VizPortal.ServerApi.GetServerInfoRequest({}))\r\n                .then(function (result) {\r\n                return _this.makeHosts(result);\r\n            });\r\n        };\r\n        // Transform the array of ServerComponentProcesses into an ordered array of Hosts\r\n        ServerInfoService.prototype.makeHosts = function (result) {\r\n            var groupedByHosts = _.groupBy(result.processes, 'host');\r\n            return _.map(result.workerHosts, function (hostName) {\r\n                var host = {\r\n                    name: hostName,\r\n                    processes: _.groupBy(groupedByHosts[hostName], 'type')\r\n                };\r\n                return host;\r\n            });\r\n        };\r\n        ServerInfoService.$inject = ['ServerService'];\r\n        return ServerInfoService;\r\n    })();\r\n    VizPortal.ServerInfoService = ServerInfoService;\r\n    VizPortal.Module.instance().service('ServerInfoService', ServerInfoService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/IHost.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetWorkerProcessStatus.ts\" />\r\n/// <reference path=\"../ServerApi/types/IWorkerProcess.ts\" />\r\n/// <reference path=\"../services/BrowserTitleService.ts\" />\r\n/// <reference path=\"../services/ConfirmActionDialog.ts\" />\r\n/// <reference path=\"../services/RebuildSearchIndexService.ts\" />\r\n/// <reference path=\"../services/ServerInfoService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerStatusCtrl = (function () {\r\n        function ServerStatusCtrl($scope, $translate, $state, BrowserTitleService, server, rebuildSearchIndexService, confirmActionDialog, serverInfo, hosts) {\r\n            var _this = this;\r\n            this.hosts = hosts;\r\n            BrowserTitleService.setTitle('serverStatus');\r\n            $scope.showZiplog = server.isTabAdminServiceEnabled();\r\n            // Server Status Grid\r\n            this.featureFlags = server.featureFlags();\r\n            $scope.hosts = this.hosts;\r\n            $scope.isSingleHost = function () { return $scope.hosts.length === 1; };\r\n            $scope.components = this.getComponents();\r\n            $scope.legendStatuses = ServerStatusCtrl.legendStatuses;\r\n            $scope.isPreferred = function (component, host) {\r\n                return component === VizPortal.ServerApi.WorkerProcessType.repository\r\n                    && _this.featureFlags.ha2Enabled\r\n                    && host.processes\r\n                    && host.processes[VizPortal.ServerApi.WorkerProcessType.repository]\r\n                    && host.processes[VizPortal.ServerApi.WorkerProcessType.repository][0].preferred;\r\n            };\r\n            $scope.refreshStatuses = function () {\r\n                $scope.refreshButtonBusy = true;\r\n                serverInfo.fetch()\r\n                    .then(function (hosts) {\r\n                    $scope.hosts = hosts; // Update hosts if server config has changed\r\n                    $scope.$broadcast(ServerStatusCtrl.refreshProcessStatusEvent);\r\n                })\r\n                    .fin(function () { return $scope.refreshButtonBusy = false; });\r\n            };\r\n            // Rebuild Search Index\r\n            $scope.rebuildSearchIndexPending = function () { return rebuildSearchIndexService.getRebuildSearchIndexPending(); };\r\n            $scope.rebuildSearchIndexPercent = function () { return rebuildSearchIndexService.getRebuildSearchIndexPercent(); };\r\n            $scope.rebuildSearchIndex = function () {\r\n                confirmActionDialog.open({\r\n                    title: $translate.instant('rebuildSearchIndexConfirmTitle'),\r\n                    bodyText: $translate.instant('rebuildSearchIndexConfirmMessage'),\r\n                    actionName: $translate.instant('rebuildSearchIndexConfirmButton'),\r\n                    isDeleteAction: true,\r\n                    action: function () {\r\n                        rebuildSearchIndexService.rebuildSearchIndex();\r\n                    },\r\n                    errorMessage: $translate.instant('rebuildSearchIndexError')\r\n                });\r\n            };\r\n            $scope.$on('$destroy', function () { return rebuildSearchIndexService.cancelPoll(); });\r\n        }\r\n        ServerStatusCtrl.prototype.getComponents = function () {\r\n            return _.without(ServerStatusCtrl.WorkerProcessTypes, (!this.featureFlags.ha2Enabled || !this.featureFlags.ha2FilestoreEnabled ? VizPortal.ServerApi.WorkerProcessType.fileStore : ''), (!this.featureFlags.ha2Enabled || this.hosts.length === 1 ? VizPortal.ServerApi.WorkerProcessType.clusterController : ''));\r\n        };\r\n        ServerStatusCtrl.refreshProcessStatusEvent = 'refreshProcessStatus';\r\n        ServerStatusCtrl.legendStatuses = [\r\n            VizPortal.ServerApi.WorkerStatusType.active,\r\n            VizPortal.ServerApi.WorkerStatusType.busy,\r\n            VizPortal.ServerApi.WorkerStatusType.passive,\r\n            VizPortal.ServerApi.WorkerStatusType.unlicensed,\r\n            VizPortal.ServerApi.WorkerStatusType.down,\r\n            VizPortal.ServerApi.WorkerStatusType.statusNotAvailable\r\n        ];\r\n        ServerStatusCtrl.WorkerProcessTypes = [\r\n            VizPortal.ServerApi.WorkerProcessType.clusterController,\r\n            VizPortal.ServerApi.WorkerProcessType.gateway,\r\n            VizPortal.ServerApi.WorkerProcessType.vizportal,\r\n            VizPortal.ServerApi.WorkerProcessType.wgServer,\r\n            VizPortal.ServerApi.WorkerProcessType.vizqlServer,\r\n            VizPortal.ServerApi.WorkerProcessType.cacheServer,\r\n            VizPortal.ServerApi.WorkerProcessType.searchServer,\r\n            VizPortal.ServerApi.WorkerProcessType.backgrounder,\r\n            VizPortal.ServerApi.WorkerProcessType.dataServer,\r\n            VizPortal.ServerApi.WorkerProcessType.dataEngine,\r\n            VizPortal.ServerApi.WorkerProcessType.fileStore,\r\n            VizPortal.ServerApi.WorkerProcessType.repository\r\n        ];\r\n        ServerStatusCtrl.$inject = [\r\n            '$scope',\r\n            '$translate',\r\n            '$state',\r\n            'BrowserTitleService',\r\n            'ServerService',\r\n            'RebuildSearchIndexService',\r\n            'ConfirmActionDialog',\r\n            'ServerInfoService',\r\n            'hosts' // Resolved by $stateProvider\r\n        ];\r\n        return ServerStatusCtrl;\r\n    })();\r\n    VizPortal.ServerStatusCtrl = ServerStatusCtrl;\r\n    VizPortal.Module.instance().controller('ServerStatusCtrl', ServerStatusCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetUserSettingsRequest = (function (_super) {\r\n            __extends(GetUserSettingsRequest, _super);\r\n            function GetUserSettingsRequest(params) {\r\n                _super.call(this, 'getUserSettings', params);\r\n            }\r\n            return GetUserSettingsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetUserSettingsRequest = GetUserSettingsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetUserSettingsRequest.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../controllers/ContentPlaceCtrl.ts\" />\r\n/// <reference path=\"../models/IUserSettings.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerUserPlaceCtrl = (function () {\r\n        function ServerUserPlaceCtrl($scope, serverUser, userSettings) {\r\n            this.$scope = $scope;\r\n            this.serverUser = serverUser;\r\n            this.userSettings = userSettings;\r\n            $scope.serverUser = this.serverUser;\r\n            $scope.userSettings = userSettings;\r\n        }\r\n        ServerUserPlaceCtrl.$inject = [\r\n            '$scope',\r\n            'serverUser',\r\n            'userSettings'\r\n        ];\r\n        return ServerUserPlaceCtrl;\r\n    })();\r\n    VizPortal.ServerUserPlaceCtrl = ServerUserPlaceCtrl;\r\n    VizPortal.Module.instance().controller('ServerUserPlaceCtrl', ServerUserPlaceCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/CommonDataGridColumns.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var ServerUsersGrid;\r\n    (function (ServerUsersGrid) {\r\n        function columns(translate, scope, serverUrls, siteRoleFilter, actions, showDomainNameColumn) {\r\n            var columns = [\r\n                VizPortalReact.CommonDataGridColumns.selected(scope),\r\n                nameColumn(translate, serverUrls, actions, scope),\r\n                {\r\n                    name: 'username-col',\r\n                    dataKey: 'username',\r\n                    text: translate('column_username'),\r\n                    direction: 'asc'\r\n                },\r\n                {\r\n                    name: 'maxSiteRole-col',\r\n                    dataKey: 'maxSiteRole',\r\n                    text: translate('column_max_site_role'),\r\n                    direction: 'asc',\r\n                    cellFormatter: VizPortalReact.DataGridCells.PlainTextCellWithTransform('maxSiteRole', function (maxSiteRole) { return siteRoleFilter(maxSiteRole); })\r\n                },\r\n                {\r\n                    name: 'siteCount-col',\r\n                    dataKey: 'siteCount',\r\n                    text: translate('column_site_count'),\r\n                    cellFormatter: VizPortalReact.DataGridCells.LocalizedCount('siteCount'),\r\n                    direction: 'asc',\r\n                    headerStyle: { textAlign: 'right' },\r\n                    cellStyle: { textAlign: 'right' }\r\n                }\r\n            ];\r\n            if (showDomainNameColumn) {\r\n                columns.push({\r\n                    name: 'domainName-col',\r\n                    dataKey: 'domainName',\r\n                    text: translate('column_domainName'),\r\n                    direction: 'asc'\r\n                });\r\n            }\r\n            columns.push({\r\n                name: 'lastSignIn-col',\r\n                dataKey: 'lastSignIn',\r\n                text: translate('column_last_sign_in'),\r\n                direction: 'desc',\r\n                cellFormatter: VizPortalReact.DataGridCells.DateTimeCell('lastSignIn')\r\n            });\r\n            return columns;\r\n        }\r\n        ServerUsersGrid.columns = columns;\r\n        function nameColumn(translate, serverUrls, actions, scope) {\r\n            var disabledStyle = {\r\n                color: VizPortalReact.CommonStyles.Colors.Grey102,\r\n                textDecoration: 'none',\r\n                pointerEvents: 'none'\r\n            };\r\n            var isDisabled = function (row) {\r\n                var user = row.data;\r\n                return user.readOnly || user.maxSiteRole === 'Guest';\r\n            };\r\n            return VizPortalReact.CommonDataGridColumns.withActions({\r\n                name: 'displayName-col',\r\n                dataKey: 'displayName',\r\n                text: translate('column_fullName'),\r\n                direction: 'asc',\r\n                cellFormatter: VizPortalReact.DataGridCells.Link(function (row) {\r\n                    var disabled = isDisabled(row);\r\n                    var user = row.data;\r\n                    return {\r\n                        text: user.displayName,\r\n                        url: disabled ? null : serverUrls.userSettingsUrl(user),\r\n                        style: disabled ? disabledStyle : null,\r\n                        iconClassName: 'tb-grid-icon-user',\r\n                        iconTitle: translate('user')\r\n                    };\r\n                })\r\n            }, {\r\n                actions: actions,\r\n                getActionTarget: function () {\r\n                    return {\r\n                        items: scope.selectedItems,\r\n                        actionContext: { scope: scope }\r\n                    };\r\n                },\r\n                translate: translate,\r\n                menuDisabled: isDisabled\r\n            });\r\n        }\r\n    })(ServerUsersGrid = VizPortalReact.ServerUsersGrid || (VizPortalReact.ServerUsersGrid = {}));\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var CreateLocalServerUserRequest = (function (_super) {\r\n            __extends(CreateLocalServerUserRequest, _super);\r\n            function CreateLocalServerUserRequest(params) {\r\n                _super.call(this, 'createLocalServerUser', params);\r\n            }\r\n            return CreateLocalServerUserRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.CreateLocalServerUserRequest = CreateLocalServerUserRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetServerUsersRequest = (function (_super) {\r\n            __extends(GetServerUsersRequest, _super);\r\n            function GetServerUsersRequest(params) {\r\n                _super.call(this, 'getServerUsers', params);\r\n            }\r\n            return GetServerUsersRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetServerUsersRequest = GetServerUsersRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetUserRefreshTokenCountRequest = (function (_super) {\r\n            __extends(GetUserRefreshTokenCountRequest, _super);\r\n            function GetUserRefreshTokenCountRequest(params) {\r\n                _super.call(this, 'getUserRefreshTokenCount', params);\r\n            }\r\n            return GetUserRefreshTokenCountRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetUserRefreshTokenCountRequest = GetUserRefreshTokenCountRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/IConnectedDevice.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetUserConnectedDevicesRequest = (function (_super) {\r\n            __extends(GetUserConnectedDevicesRequest, _super);\r\n            function GetUserConnectedDevicesRequest(params) {\r\n                _super.call(this, 'getUserConnectedDevices', params);\r\n            }\r\n            return GetUserConnectedDevicesRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetUserConnectedDevicesRequest = GetUserConnectedDevicesRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/IUserRole.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetUsersSiteRolesRequest = (function (_super) {\r\n            __extends(GetUsersSiteRolesRequest, _super);\r\n            function GetUsersSiteRolesRequest(params) {\r\n                _super.call(this, 'getUsersSiteRoles', params);\r\n            }\r\n            return GetUsersSiteRolesRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetUsersSiteRolesRequest = GetUsersSiteRolesRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/IResponse.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var DeleteUserConnectedDevicesRequest = (function (_super) {\r\n            __extends(DeleteUserConnectedDevicesRequest, _super);\r\n            function DeleteUserConnectedDevicesRequest(params) {\r\n                _super.call(this, 'deleteUserConnectedDevices', params);\r\n            }\r\n            return DeleteUserConnectedDevicesRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.DeleteUserConnectedDevicesRequest = DeleteUserConnectedDevicesRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var UpdateServerUsersAdminStatusRequest = (function (_super) {\r\n            __extends(UpdateServerUsersAdminStatusRequest, _super);\r\n            function UpdateServerUsersAdminStatusRequest(params) {\r\n                _super.call(this, 'updateServerUsersAdminStatus', params);\r\n            }\r\n            return UpdateServerUsersAdminStatusRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.UpdateServerUsersAdminStatusRequest = UpdateServerUsersAdminStatusRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var UpdateServerUsersSiteMembershipRequest = (function (_super) {\r\n            __extends(UpdateServerUsersSiteMembershipRequest, _super);\r\n            function UpdateServerUsersSiteMembershipRequest(params) {\r\n                _super.call(this, 'updateServerUsersSiteMembership', params);\r\n            }\r\n            return UpdateServerUsersSiteMembershipRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.UpdateServerUsersSiteMembershipRequest = UpdateServerUsersSiteMembershipRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"IUser.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/RequestHelper.ts\" />\r\n/// <reference path=\"../helpers/ResultHelper.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/CreateLocalServerUserRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetServerUsersRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetUserRefreshTokenCountRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetUserConnectedDevicesRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetUserSettingsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetUsersSiteRolesRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/DeleteUserConnectedDevicesRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/UpdateServerUsersAdminStatusRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/UpdateServerUsersSiteMembershipRequest.ts\" />\r\n/// <reference path=\"../ServerApi/types/IServerUser.ts\" />\r\n/// <reference path=\"../ServerApi/types/ISiteRole.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\n/// <reference path=\"Resource.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerUsers = (function (_super) {\r\n        __extends(ServerUsers, _super);\r\n        function ServerUsers(ErrorNotifyingServer, FetcherFactory, $q) {\r\n            _super.call(this, FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetServerUsersRequest, function (result) { return result.users; }));\r\n            this.ErrorNotifyingServer = ErrorNotifyingServer;\r\n            this.$q = $q;\r\n        }\r\n        // returns the server user with the specified username & domainName.\r\n        ServerUsers.prototype.getUserByUsernameAndDomain = function (username, domainName) {\r\n            return this.all()\r\n                .addFilter(VizPortal.Filter.stringFieldEq('username', username))\r\n                .addFilter(VizPortal.Filter.stringFieldEq('domainName', domainName))\r\n                .getFirst();\r\n        };\r\n        // returns the server users with the specified IDs\r\n        ServerUsers.prototype.getByUserIds = function (userIds) {\r\n            var query = this.all();\r\n            var usersFilter = VizPortal.Filter.stringFieldInArray(VizPortal.ServerApi.NamedItemKeys.id, userIds);\r\n            query = query.addFilter(usersFilter);\r\n            return query.getCount().then(function (totalCount) {\r\n                return query.getSlice(0, totalCount);\r\n            });\r\n        };\r\n        ServerUsers.prototype.getUserCountsByMaxSiteRole = function (baseQuery) {\r\n            // Remove any existing max site role filter\r\n            var filtersWithoutMaxSiteRole = _.filter(baseQuery.getFilters(), function (filter) {\r\n                return !(filter.field && filter.field === VizPortal.ServerApi.FilterFieldNames.maxSiteRole);\r\n            });\r\n            var modifiedQuery = baseQuery.withFilters(filtersWithoutMaxSiteRole);\r\n            var counts = {};\r\n            var promises = _.map(VizPortal.SiteRoles.WithoutGuest, function (maxSiteRole) {\r\n                return modifiedQuery\r\n                    .addFilter(VizPortal.Filter.stringFieldEq(VizPortal.ServerApi.FilterFieldNames.maxSiteRole, maxSiteRole))\r\n                    .getCount()\r\n                    .then(function (count) {\r\n                    counts[maxSiteRole] = count;\r\n                });\r\n            });\r\n            // Any site role\r\n            promises.push(modifiedQuery.getCount().then(function (count) { counts['Any'] = count; }));\r\n            return this.$q.all(promises).then(function () { return counts; });\r\n        };\r\n        ServerUsers.prototype.getUserSettings = function (username, domain) {\r\n            var params = {\r\n                username: username,\r\n                domainName: domain\r\n            };\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.GetUserSettingsRequest(params));\r\n        };\r\n        ServerUsers.prototype.getUserRefreshTokenCount = function (username, domain) {\r\n            var params = {\r\n                username: username,\r\n                domainName: domain\r\n            };\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.GetUserRefreshTokenCountRequest(params))\r\n                .then(function (result) { return result.refreshTokenCount; });\r\n        };\r\n        ServerUsers.prototype.getUserConnectedDevices = function (userId) {\r\n            var params = {\r\n                userId: userId\r\n            };\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.GetUserConnectedDevicesRequest(params))\r\n                .then(function (result) { return result.devices; });\r\n        };\r\n        ServerUsers.prototype.deleteUserConnectedDevices = function (userId, deviceIds) {\r\n            var params = {\r\n                userId: userId,\r\n                deviceIds: deviceIds\r\n            };\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.DeleteUserConnectedDevicesRequest(params));\r\n        };\r\n        // returns the server users' roles across all sites\r\n        ServerUsers.prototype.getSiteRoles = function (userIds) {\r\n            return this.ErrorNotifyingServer.sendRequests(VizPortal.RequestHelper.buildRequests(userIds, function (userIdsBlock) { return new VizPortal.ServerApi.GetUsersSiteRolesRequest({ ids: userIdsBlock }); }), function (results) {\r\n                return {\r\n                    errors: VizPortal.ResultHelper.combineErrors(results),\r\n                    users: VizPortal.ResultHelper.combine(results, function (result) { return result.users; })\r\n                };\r\n            });\r\n        };\r\n        // site membership - add/remove server users from sites\r\n        ServerUsers.prototype.updateServerUsersSiteMembership = function (userIds, addToSiteRoles, removeFromSiteIds) {\r\n            return this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests3(userIds, addToSiteRoles, removeFromSiteIds, function (userIdsBlock, addToSiteRolesBlock, removeFromSiteIdsBlock) { return new VizPortal.ServerApi.UpdateServerUsersSiteMembershipRequest({\r\n                userIds: userIdsBlock,\r\n                addToSiteRoles: addToSiteRolesBlock,\r\n                removeFromSiteIds: removeFromSiteIdsBlock\r\n            }); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        // site membership - change these users' server admin status\r\n        ServerUsers.prototype.updateServerAdminStatus = function (userIds, admin) {\r\n            return this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests(userIds, function (userIdsBlock) { return new VizPortal.ServerApi.UpdateServerUsersAdminStatusRequest({\r\n                userIds: userIdsBlock,\r\n                admin: admin\r\n            }); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        // delete users from server\r\n        ServerUsers.prototype.deleteUsers = function (userIds) {\r\n            return this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests(userIds, function (userIdsBlock) { return new VizPortal.ServerApi.DeleteServerUsersRequest({ ids: userIdsBlock }); }), VizPortal.ResultHelper.combineUserResults);\r\n        };\r\n        // import users from active directory to server\r\n        ServerUsers.prototype.importUsersFromActiveDirectory = function (usernames) {\r\n            return this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests(usernames, function (usernamesBlock) { return new VizPortal.ServerApi.ImportServerUsersFromActiveDirectoryRequest({ usernames: usernamesBlock }); }), VizPortal.ResultHelper.combineImportUserResults);\r\n        };\r\n        // create a new local server user\r\n        ServerUsers.prototype.createLocalServerUser = function (username, displayName, email, password) {\r\n            var _this = this;\r\n            return this.ErrorNotifyingServer.sendRequestAndDelay(new VizPortal.ServerApi.GeneratePublicKeyRequest()).\r\n                then(function (generatePublicKeyResult) {\r\n                var key = generatePublicKeyResult.key;\r\n                var keyId = generatePublicKeyResult.keyId;\r\n                var encryptedPassword = rsa.encrypt(password, key);\r\n                var createLocalServerUserRequest = new VizPortal.ServerApi.CreateLocalServerUserRequest({\r\n                    username: username,\r\n                    displayName: displayName,\r\n                    email: email,\r\n                    encryptedPassword: encryptedPassword,\r\n                    keyId: keyId\r\n                });\r\n                return _this.ErrorNotifyingServer.sendRequestAndDelay(createLocalServerUserRequest);\r\n            });\r\n        };\r\n        ServerUsers.$inject = ['ErrorNotifyingServer', 'FetcherFactory', '$q'];\r\n        return ServerUsers;\r\n    })(VizPortal.Resource);\r\n    VizPortal.ServerUsers = ServerUsers;\r\n    VizPortal.Module.instance().service('ServerUsers', ServerUsers);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var UsernameHelpers;\r\n    (function (UsernameHelpers) {\r\n        function splitUsernames(usernamesText) {\r\n            return _.chain(usernamesText.split(/[;,\\r\\n]+/))\r\n                .map(function (username) { return username.trim(); })\r\n                .compact() // Remove empty strings\r\n                .unique() // Remove dupes\r\n                .value();\r\n        }\r\n        UsernameHelpers.splitUsernames = splitUsernames;\r\n    })(UsernameHelpers = VizPortal.UsernameHelpers || (VizPortal.UsernameHelpers = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/UsernameHelpers.ts\" />\r\n/// <reference path=\"../models/Set.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../resources/SiteUsers.ts\" />\r\n/// <reference path=\"../resources/SiteRoles.ts\" />\r\n/// <reference path=\"../ServerApi/requests/ImportUsersFromActiveDirectoryRequest.ts\" />\r\n/// <reference path=\"../ServerApi/types/ISiteRole.ts\" />\r\n/// <reference path=\"../services/AddUsersOptionsAction.ts\"/>\r\n/// <reference path=\"../services/ToasterService.ts\" />\r\n/// <reference path=\"../services/UserActionNotification.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var AddActiveDirectorySiteUsersDialogCtrl = (function () {\r\n        function AddActiveDirectorySiteUsersDialogCtrl($scope, $q, $translate, toaster, serverAdminUpdateActionNotification, siteRoles, siteRolesUpdateActionNotification, siteUsers, userActionNotification, availableQuota) {\r\n            var _this = this;\r\n            this.$scope = $scope;\r\n            this.$q = $q;\r\n            this.$translate = $translate;\r\n            this.toaster = toaster;\r\n            this.serverAdminUpdateActionNotification = serverAdminUpdateActionNotification;\r\n            this.siteRolesUpdateActionNotification = siteRolesUpdateActionNotification;\r\n            this.siteUsers = siteUsers;\r\n            this.userActionNotification = userActionNotification;\r\n            // possible site roles settings for the imported group include everything except guest & admin.\r\n            $scope.siteRoleOptions = siteRoles.optionsForCurrentUser();\r\n            $scope.siteRole = availableQuota <= 0 ? VizPortal.ServerApi.SiteRoles.Unlicensed : VizPortal.ServerApi.SiteRoles.Interactor;\r\n            $scope.setSiteRole = function (role) {\r\n                $scope.siteRole = role;\r\n            };\r\n            $scope.addActiveDirectoryUsers = function (userTextInput) { return _this.importUsers(userTextInput); };\r\n            // TODO: dry this out. Duplicated in AddActiveDirectoryUsersAction.ts\r\n            $scope.availableQuota = availableQuota;\r\n            $scope.isSiteRoleOptionDisabled = function (siteRole) {\r\n                // when available quota is 0, only allow Unlicensed and UnlicensedWithPublish users to be added.\r\n                return availableQuota <= 0 && siteRole !== VizPortal.ServerApi.SiteRoles.Unlicensed && siteRole !== VizPortal.ServerApi.SiteRoles.UnlicensedWithPublish;\r\n            };\r\n            $scope.isQuotaEnabledForSite = _.isNumber(availableQuota);\r\n        }\r\n        AddActiveDirectorySiteUsersDialogCtrl.prototype.importUsers = function (userTextInput) {\r\n            var _this = this;\r\n            this.$scope.busy = true;\r\n            this.$scope.usersToAdd = VizPortal.UsernameHelpers.splitUsernames(userTextInput); // match strings delimited by semicolons & commas\r\n            var siteRole = this.$scope.siteRole;\r\n            var serverAdmin = false;\r\n            if (siteRole === VizPortal.ServerApi.SiteRoles.ServerAdministrator) {\r\n                siteRole = VizPortal.ServerApi.SiteRoles.Unlicensed;\r\n                serverAdmin = true;\r\n            }\r\n            return this.siteUsers.importUsersFromActiveDirectory(this.$scope.usersToAdd, siteRole, serverAdmin).then(function (result) {\r\n                _this.userActionNotification.notify({\r\n                    users: VizPortal.Set.fromIdItemArray(result.users),\r\n                    results: result.results,\r\n                    errors: result.errors,\r\n                    successCode: '12' // Added to site TODO: add enum for this\r\n                });\r\n                _this.$scope.$emit(VizPortal.UserAddedEvent);\r\n                return _this.$q.when({});\r\n            })\r\n                .then(function (result) { return _this.$scope.close(result); });\r\n        };\r\n        AddActiveDirectorySiteUsersDialogCtrl.$inject = [\r\n            '$scope',\r\n            '$q',\r\n            '$translate',\r\n            'ToasterService',\r\n            'ServerAdminUpdateActionNotification',\r\n            'SiteRoles',\r\n            'SiteRolesUpdateActionNotification',\r\n            'SiteUsers',\r\n            'UserActionNotification',\r\n            // resolved in AddActiveDirectoryUsersAction\r\n            'availableQuota'\r\n        ];\r\n        return AddActiveDirectorySiteUsersDialogCtrl;\r\n    })();\r\n    VizPortal.AddActiveDirectorySiteUsersDialogCtrl = AddActiveDirectorySiteUsersDialogCtrl;\r\n    VizPortal.Module.instance().controller('AddActiveDirectorySiteUsersDialogCtrl', AddActiveDirectorySiteUsersDialogCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetSiteNamesRequest.ts\" />\r\n/// <reference path=\"Resource.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SiteNameWithIds = (function (_super) {\r\n        __extends(SiteNameWithIds, _super);\r\n        function SiteNameWithIds(FetcherFactory) {\r\n            _super.call(this, FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetSiteNamesRequest, function (result) { return result.siteNames; }));\r\n        }\r\n        SiteNameWithIds.$inject = ['FetcherFactory'];\r\n        return SiteNameWithIds;\r\n    })(VizPortal.Resource);\r\n    VizPortal.SiteNameWithIds = SiteNameWithIds;\r\n    VizPortal.Module.instance().service('SiteNames', SiteNameWithIds);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SiteRolesPickerClientService = (function () {\r\n        function SiteRolesPickerClientService($state, $translate, serverAdminUpdateActionNotification, serverUsers, toaster) {\r\n            this.$state = $state;\r\n            this.$translate = $translate;\r\n            this.serverAdminUpdateActionNotification = serverAdminUpdateActionNotification;\r\n            this.serverUsers = serverUsers;\r\n            this.toaster = toaster;\r\n        }\r\n        // section: update site membership or roles\r\n        // Takes userids and site role changes and package them into a parameter\r\n        // object that can be used for backend requests.\r\n        SiteRolesPickerClientService.prototype.siteRoleChangesToParams = function (userIds, changes) {\r\n            var addToSiteRoles = [];\r\n            var removeFromSiteIds = [];\r\n            _.each(changes, function (change, siteId) {\r\n                if (change.checkboxState === VizPortal.CheckboxState.checked) {\r\n                    addToSiteRoles.push({\r\n                        siteId: siteId,\r\n                        siteRole: change.siteRole\r\n                    });\r\n                }\r\n                else if (change.checkboxState === VizPortal.CheckboxState.empty) {\r\n                    removeFromSiteIds.push(siteId);\r\n                }\r\n            });\r\n            return {\r\n                userIds: userIds,\r\n                addToSiteRoles: addToSiteRoles,\r\n                removeFromSiteIds: removeFromSiteIds\r\n            };\r\n        };\r\n        // Exactly the same as ServerUsers.updateServerUsersSiteMembership, except that\r\n        // this one directly takes a parameters object.\r\n        SiteRolesPickerClientService.prototype.updateServerUsersSiteMembership = function (params) {\r\n            return this.serverUsers.updateServerUsersSiteMembership(params.userIds, params.addToSiteRoles, params.removeFromSiteIds);\r\n        };\r\n        // section: update server admin\r\n        SiteRolesPickerClientService.prototype.updateServerAdmin = function (users, newAdminState) {\r\n            var _this = this;\r\n            var userIds = users.pluck('id');\r\n            var promise = this.serverUsers.updateServerAdminStatus(userIds, newAdminState);\r\n            promise.then(function (result) {\r\n                _this.serverAdminUpdateActionNotification.notify(result, users, newAdminState);\r\n            });\r\n            return promise;\r\n        };\r\n        SiteRolesPickerClientService.$inject = [\r\n            '$state',\r\n            '$translate',\r\n            'ServerAdminUpdateActionNotification',\r\n            'ServerUsers',\r\n            'ToasterService'];\r\n        return SiteRolesPickerClientService;\r\n    })();\r\n    VizPortal.SiteRolesPickerClientService = SiteRolesPickerClientService;\r\n    VizPortal.Module.instance().service('SiteRolesPickerClientService', SiteRolesPickerClientService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../../common/components/checkboxes/CheckboxState.ts\" />\r\n/// <reference path=\"../fetchers/ListResult.ts\" />\r\n/// <reference path=\"../helpers/Filter.ts\" />\r\n/// <reference path=\"../helpers/SliceableHelper.ts\" />\r\n/// <reference path=\"../models/ColumnWidths.ts\" />\r\n/// <reference path=\"../models/IEmptyTemplate.ts\" />\r\n/// <reference path=\"../models/ISliceable.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../resources/SiteNameWithIds.ts\" />\r\n/// <reference path=\"../resources/SiteRoles.ts\" />\r\n/// <reference path=\"../services/SiteRolesPickerClientService.ts\" />\r\n/// <reference path=\"../services/SliceableFactory.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.SiteMembershipDialogFilters = {\r\n        AllSites: \"siteMembershipAllSites\",\r\n        AssignedSites: \"siteMembershipAssignedSites\",\r\n        SearchResults: \"siteMembershipSearchResults\"\r\n    };\r\n    var SiteRolesPickerCtrl = (function () {\r\n        function SiteRolesPickerCtrl($scope, serverService, siteNamesResource, BrowserSupportService, sliceableFactory) {\r\n            var _this = this;\r\n            this.$scope = $scope;\r\n            this.serverService = serverService;\r\n            this.siteNamesResource = siteNamesResource;\r\n            this.sliceableFactory = sliceableFactory;\r\n            this.uncheckedAssignedSites = 0;\r\n            $scope.siteFilter = { selection: VizPortal.SiteMembershipDialogFilters.AllSites };\r\n            this.userCountsAndRolesBySiteId = {};\r\n            $scope.searchInput = { text: '' };\r\n            if (!$scope.changes) {\r\n                $scope.changes = {\r\n                    siteRoles: {},\r\n                    serverAdmin: undefined\r\n                };\r\n            }\r\n            $scope.emptyTemplateModel = {\r\n                title: 'noAssignedSites',\r\n                action: function () { return $scope.siteFilter.selection = VizPortal.SiteMembershipDialogFilters.AllSites; }\r\n            };\r\n            $scope.needsAssignedSitesRefresh = false;\r\n            $scope.siteNames = this.siteNamesResource.all();\r\n            $scope.sliceable = $scope.siteNames;\r\n            $scope.columnWidths = {\r\n                getActual: this.getColumnWidths,\r\n                getMin: this.getColumnWidths,\r\n                hasPreferredWidths: function () { return true; }\r\n            };\r\n            $scope.adminCheckboxClicked = function () {\r\n                var newState = VizPortal.CheckboxState.toggle(_this.$scope.adminCheckboxState());\r\n                if ($scope.siteFilter.selection === VizPortal.SiteMembershipDialogFilters.AssignedSites) {\r\n                    //all selected -> empty. Use each checkbox's state without admin information to determine what should be in the new slice.\r\n                    if (newState === VizPortal.CheckboxState.empty) {\r\n                        _this.getAssignedSitesList().then(function (slice) {\r\n                            $scope.sliceable = slice;\r\n                            _this.updateAdminState(newState);\r\n                        });\r\n                    }\r\n                    else {\r\n                        _this.updateAdminState(newState);\r\n                        $scope.refreshAssignedSites();\r\n                    }\r\n                }\r\n                else {\r\n                    _this.updateAdminState(newState);\r\n                }\r\n            };\r\n            $scope.adminCheckboxState = function () {\r\n                if ($scope.changes.serverAdmin) {\r\n                    return $scope.changes.serverAdmin;\r\n                }\r\n                return _this.originalAdminState;\r\n            };\r\n            $scope.checkboxState = function (site) {\r\n                // if server admin is checked, all sites should be checked\r\n                if ($scope.adminCheckboxState() === VizPortal.CheckboxState.checked) {\r\n                    return VizPortal.CheckboxState.checked;\r\n                }\r\n                // if some of the selected users are server admins, site role is always mixed\r\n                if ($scope.adminCheckboxState() === VizPortal.CheckboxState.mixed) {\r\n                    return VizPortal.CheckboxState.mixed;\r\n                }\r\n                return _this.checkboxStateWithoutAdmin(site);\r\n            };\r\n            $scope.siteRole = function (site) {\r\n                // if server admin is checked, all site roles should be server admin\r\n                if ($scope.adminCheckboxState() === VizPortal.CheckboxState.checked) {\r\n                    return VizPortal.ServerApi.SiteRoles.ServerAdministrator;\r\n                }\r\n                // if some of the selected users are server admins, site role is always mixed\r\n                if ($scope.adminCheckboxState() === VizPortal.CheckboxState.mixed) {\r\n                    return VizPortal.SiteRoles.Mixed;\r\n                }\r\n                // local changes override what we have from the server\r\n                if ($scope.changes.siteRoles[site.id] &&\r\n                    $scope.changes.siteRoles[site.id].siteRole) {\r\n                    return $scope.changes.siteRoles[site.id].siteRole;\r\n                }\r\n                var siteInfo = _this.userCountsAndRolesBySiteId[site.id];\r\n                var numSelectedSiteMembers = siteInfo ? siteInfo.count : 0;\r\n                if (numSelectedSiteMembers === _this.numSelectedUsers) {\r\n                    // if all of the selected users are in all the sites, use the aggregated role\r\n                    return siteInfo.siteRole;\r\n                }\r\n                else if (numSelectedSiteMembers > 0) {\r\n                    // some of the selected users are site members.\r\n                    return VizPortal.SiteRoles.Mixed;\r\n                }\r\n                else {\r\n                    // numSelectedSiteMembers === 0\r\n                    return VizPortal.ServerApi.SiteRoles.Unlicensed;\r\n                }\r\n            };\r\n            //$scope.siteRoleOptions = SiteRoles.WithoutGuestOrServerAdmin;\r\n            // TODO: Replace siteRoleOptions back once a tb:select component is added back to siteRolesPicker.jade\r\n            $scope.selectCtrl = {\r\n                options: VizPortal.SiteRoles.WithoutGuestOrServerAdmin\r\n            };\r\n            $scope.checkboxClicked = function (site, colIndex) {\r\n                //if the site role select menu is visible, clicking on the column should not toggle the row.\r\n                var roleSelectColumnIndex = 2;\r\n                if ((colIndex === roleSelectColumnIndex && $scope.checkboxState(site) !== VizPortal.CheckboxState.empty) || $scope.modifySiteRolesDisabled()) {\r\n                    return;\r\n                }\r\n                var siteId = site.id;\r\n                if (!$scope.changes.siteRoles[siteId]) {\r\n                    $scope.changes.siteRoles[siteId] = { siteName: site.name };\r\n                }\r\n                var siteRoleChange = $scope.changes.siteRoles[siteId];\r\n                if ($scope.siteFilter.selection === VizPortal.SiteMembershipDialogFilters.AssignedSites) {\r\n                    if (_this.$scope.checkboxState(site) === VizPortal.CheckboxState.empty) {\r\n                        _this.uncheckedAssignedSites--;\r\n                    }\r\n                    else if (_this.$scope.checkboxState(site) === VizPortal.CheckboxState.checked) {\r\n                        _this.uncheckedAssignedSites++;\r\n                    }\r\n                    $scope.needsAssignedSitesRefresh = _this.uncheckedAssignedSites > 0;\r\n                }\r\n                siteRoleChange.checkboxState = VizPortal.CheckboxState.toggle(_this.$scope.checkboxState(site));\r\n                // if the user has unchecked the checkbox, or if the user is adding the user to the site but hasn't picked a role yet,\r\n                // set the site role to Interactor\r\n                if (siteRoleChange.checkboxState === VizPortal.CheckboxState.empty || !siteRoleChange.siteRole) {\r\n                    siteRoleChange.siteRole = VizPortal.ServerApi.SiteRoles.Interactor;\r\n                }\r\n                // we only want to keep changes that differ from the original state (server state).\r\n                // if the checkbox-click returned the checkbox to its original state, remove the locally stored change.\r\n                // otherwise leave the change.\r\n                if (_this.getOriginalCheckboxStateForSite(siteId) === _this.$scope.checkboxState(site)) {\r\n                    delete $scope.changes.siteRoles[siteId];\r\n                }\r\n            };\r\n            $scope.setSiteRole = function (site, role) {\r\n                var siteId = site.id;\r\n                $scope.changes.siteRoles[siteId] = {\r\n                    siteRole: role,\r\n                    checkboxState: VizPortal.CheckboxState.checked,\r\n                    siteName: site.name\r\n                };\r\n            };\r\n            // $note-ltan-2014-2-23:\r\n            // Even though we no longer allow changing user selection while the panel is open,\r\n            // this watch is still needed to give the parent of the SiteRolesPicker some time\r\n            // to compute the site roles. This watch will then be able to pick them up.\r\n            $scope.$watch('usersWithSiteRoles', function () {\r\n                _this.updateModel();\r\n            });\r\n            $scope.refreshAssignedSites = function () {\r\n                $scope.needsAssignedSitesRefresh = false;\r\n                if (_this.$scope.adminCheckboxState() !== VizPortal.CheckboxState.empty) {\r\n                    _this.$scope.sliceable = $scope.siteNames;\r\n                }\r\n                else {\r\n                    _this.getAssignedSitesList().then(function (slice) {\r\n                        _this.$scope.sliceable = slice;\r\n                    });\r\n                }\r\n            };\r\n            $scope.$watch('siteFilter.selection', function (newFilter) {\r\n                _this.updateSiteFilters();\r\n                if (newFilter === VizPortal.SiteMembershipDialogFilters.AssignedSites) {\r\n                    $scope.refreshAssignedSites();\r\n                }\r\n                if (newFilter === VizPortal.SiteMembershipDialogFilters.AllSites) {\r\n                    $scope.sliceable = $scope.siteNames;\r\n                }\r\n                if (newFilter !== VizPortal.SiteMembershipDialogFilters.SearchResults) {\r\n                    $scope.lastSiteFilter = newFilter;\r\n                    $scope.searchInput.text = '';\r\n                }\r\n                $scope.needsAssignedSitesRefresh = false;\r\n            });\r\n            $scope.isRowDirty = function (site) {\r\n                return !!$scope.changes.siteRoles[site.id] && ($scope.adminCheckboxState() === VizPortal.CheckboxState.empty);\r\n            };\r\n            $scope.modifySiteRolesDisabled = function () {\r\n                return ($scope.adminCheckboxState() !== VizPortal.CheckboxState.empty);\r\n            };\r\n            $scope.submitSearch = function (searchText, $event) {\r\n                $scope.emptyTemplateModel.title = 'noMatchingResults';\r\n                if (!searchText) {\r\n                    $scope.siteFilter.selection = $scope.lastSiteFilter;\r\n                }\r\n                else {\r\n                    if ($scope.siteFilter.selection !== VizPortal.SiteMembershipDialogFilters.SearchResults) {\r\n                        $scope.siteFilter.selection = VizPortal.SiteMembershipDialogFilters.SearchResults;\r\n                    }\r\n                    $scope.sliceable = siteNamesResource.all().withFilters([VizPortal.Filter.search(searchText)]);\r\n                }\r\n                if (BrowserSupportService.isTouch() && $event) {\r\n                    // blur to retract the keyboard when search is explicitly submitted\r\n                    $($event.target).blur();\r\n                }\r\n            };\r\n            // This call is important. It computes the initial state of things.\r\n            this.updateModel();\r\n        }\r\n        // Get the original/current state of server admins of the users.\r\n        SiteRolesPickerCtrl.adminStateFromUsers = function (adminCount, totalUsersCount) {\r\n            if (adminCount === 0) {\r\n                return VizPortal.CheckboxState.empty;\r\n            }\r\n            else if (adminCount < totalUsersCount) {\r\n                return VizPortal.CheckboxState.mixed;\r\n            }\r\n            else {\r\n                return VizPortal.CheckboxState.checked;\r\n            }\r\n        };\r\n        SiteRolesPickerCtrl.prototype.updateAdminState = function (newState) {\r\n            if (newState === this.originalAdminState) {\r\n                this.$scope.changes.serverAdmin = undefined;\r\n            }\r\n            else {\r\n                this.$scope.changes.serverAdmin = newState;\r\n            }\r\n        };\r\n        SiteRolesPickerCtrl.prototype.checkboxStateWithoutAdmin = function (site) {\r\n            // local changes override what we have from the server\r\n            if (this.$scope.changes.siteRoles[site.id] &&\r\n                this.$scope.changes.siteRoles[site.id].checkboxState) {\r\n                return this.$scope.changes.siteRoles[site.id].checkboxState;\r\n            }\r\n            var siteInfo = this.userCountsAndRolesBySiteId[site.id];\r\n            var numSelectedSiteMembers = siteInfo ? siteInfo.count : 0;\r\n            if (numSelectedSiteMembers === this.numSelectedUsers) {\r\n                // all selected users are members of this site.\r\n                return VizPortal.CheckboxState.checked;\r\n            }\r\n            else if (numSelectedSiteMembers > 0) {\r\n                // some users are members of the site.\r\n                return VizPortal.CheckboxState.mixed;\r\n            }\r\n            else {\r\n                // numSelectedSiteMembers === 0\r\n                return VizPortal.CheckboxState.empty;\r\n            }\r\n        };\r\n        //The second column's width is dependent on whether or not the scroll bar is visible.\r\n        SiteRolesPickerCtrl.prototype.getColumnWidths = function (index) {\r\n            var resizeableColumnIndex = 2;\r\n            //checkbox column and group name column are constant. These should be kept in sync with the design spec for the dialog.\r\n            var widths = [27, 185];\r\n            var calcMemberCountWidth = $('.tb-picker-container .tb-data-grid-body-background').width() - widths[0] - widths[1];\r\n            return index === resizeableColumnIndex ? calcMemberCountWidth : widths[index];\r\n        };\r\n        SiteRolesPickerCtrl.prototype.updateSiteFilters = function () {\r\n            var filters = [\r\n                VizPortal.SiteMembershipDialogFilters.AllSites,\r\n                VizPortal.SiteMembershipDialogFilters.AssignedSites\r\n            ];\r\n            if (this.$scope.siteFilter.selection === VizPortal.SiteMembershipDialogFilters.SearchResults) {\r\n                filters.push(VizPortal.SiteMembershipDialogFilters.SearchResults);\r\n            }\r\n            this.$scope.siteFilters = filters;\r\n        };\r\n        SiteRolesPickerCtrl.prototype.getAssignedSitesList = function () {\r\n            var _this = this;\r\n            return VizPortal.SliceableHelper.fetchAll(this.siteNamesResource.all())\r\n                .then(function (sites) {\r\n                var assignedList = _.filter(sites.items, function (site) { return _this.checkboxStateWithoutAdmin(site) !== VizPortal.CheckboxState.empty; });\r\n                _this.uncheckedAssignedSites = 0;\r\n                _this.$scope.emptyTemplateModel.title = 'noAssignedSites';\r\n                return _this.sliceableFactory.fromArray(assignedList);\r\n            });\r\n        };\r\n        SiteRolesPickerCtrl.prototype.updateModel = function () {\r\n            if (this.$scope.usersWithSiteRoles) {\r\n                this.updateSelectedUserCounts();\r\n                this.userCountsAndRolesBySiteId =\r\n                    SiteRolesPickerCtrl.calculateUserCountsAndRolesBySite(this.$scope.usersWithSiteRoles.userRoles);\r\n            }\r\n            else {\r\n                this.numSelectedUsers = 1;\r\n                this.numSelectedServerAdmins = 0;\r\n                this.userCountsAndRolesBySiteId = {};\r\n            }\r\n            // If server admin change state is the same as that of the current user(s),\r\n            // it really means there is no change.\r\n            this.originalAdminState = SiteRolesPickerCtrl.adminStateFromUsers(this.numSelectedServerAdmins, this.numSelectedUsers);\r\n            if (this.originalAdminState === this.$scope.changes.serverAdmin) {\r\n                this.$scope.changes.serverAdmin = undefined;\r\n            }\r\n        };\r\n        SiteRolesPickerCtrl.calculateUserCountsAndRolesBySite = function (userRoles) {\r\n            var userCountsAndRolesBySiteId = {};\r\n            _.each(userRoles, function (userRole) {\r\n                _.each(userRole.sites, function (site) {\r\n                    var siteUserInfo = userCountsAndRolesBySiteId[site.siteId];\r\n                    if (siteUserInfo) {\r\n                        ++siteUserInfo.count;\r\n                        if (siteUserInfo.siteRole !== site.siteRole) {\r\n                            siteUserInfo.siteRole = VizPortal.SiteRoles.Mixed;\r\n                        }\r\n                    }\r\n                    else {\r\n                        userCountsAndRolesBySiteId[site.siteId] = {\r\n                            count: 1,\r\n                            siteRole: site.siteRole\r\n                        };\r\n                    }\r\n                });\r\n            });\r\n            return userCountsAndRolesBySiteId;\r\n        };\r\n        SiteRolesPickerCtrl.prototype.updateSelectedUserCounts = function () {\r\n            this.numSelectedUsers = this.$scope.usersWithSiteRoles.users.size();\r\n            this.numSelectedServerAdmins = this.$scope.usersWithSiteRoles.serverAdmins.length;\r\n        };\r\n        // input a site ID, returns the initial checkbox state for the given site (checked, empty, or mixed)\r\n        SiteRolesPickerCtrl.prototype.getOriginalCheckboxStateForSite = function (siteId) {\r\n            if (!this.userCountsAndRolesBySiteId[siteId]) {\r\n                return VizPortal.CheckboxState.empty;\r\n            }\r\n            else if (this.userCountsAndRolesBySiteId[siteId].count === this.$scope.usersWithSiteRoles.users.size()) {\r\n                return VizPortal.CheckboxState.checked;\r\n            }\r\n            else {\r\n                return VizPortal.CheckboxState.mixed;\r\n            }\r\n        };\r\n        SiteRolesPickerCtrl.$inject = [\r\n            '$scope',\r\n            'ServerService',\r\n            'SiteNames',\r\n            'BrowserSupportService',\r\n            'SliceableFactory'];\r\n        return SiteRolesPickerCtrl;\r\n    })();\r\n    VizPortal.SiteRolesPickerCtrl = SiteRolesPickerCtrl;\r\n    // controller\r\n    VizPortal.Module.instance().controller('SiteRolesPickerCtrl', SiteRolesPickerCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../../common/components/checkboxes/CheckboxState.ts\" />\r\n/// <reference path=\"../controllers/SiteRolesPickerCtrl.ts\" />\r\n/// <reference path=\"../helpers/UsernameHelpers.ts\" />\r\n/// <reference path=\"../models/IUserInfo.ts\" />\r\n/// <reference path=\"../models/Set.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../resources/ServerUsers.ts\" />\r\n/// <reference path=\"../resources/SiteRoles.ts\" />\r\n/// <reference path=\"../ServerApi/requests/ImportUsersFromActiveDirectoryRequest.ts\" />\r\n/// <reference path=\"../services/AddUsersOptionsAction.ts\" />\r\n/// <reference path=\"../services/SiteRolesPickerClientService.ts\" />\r\n/// <reference path=\"../services/ToasterService.ts\" />\r\n/// <reference path=\"../services/UserActionNotification.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var AddActiveDirectoryServerUsersDialogCtrl = (function () {\r\n        function AddActiveDirectoryServerUsersDialogCtrl($scope, $q, $translate, toaster, serverAdminUpdateActionNotification, siteMembershipUpdateActionNotification, siteRoles, rolesPickerClient, serverUsers, userActionNotification) {\r\n            var _this = this;\r\n            this.$scope = $scope;\r\n            this.$q = $q;\r\n            this.$translate = $translate;\r\n            this.toaster = toaster;\r\n            this.serverAdminUpdateActionNotification = serverAdminUpdateActionNotification;\r\n            this.siteMembershipUpdateActionNotification = siteMembershipUpdateActionNotification;\r\n            this.rolesPickerClient = rolesPickerClient;\r\n            this.serverUsers = serverUsers;\r\n            this.userActionNotification = userActionNotification;\r\n            // site role changes will be stored here\r\n            this.$scope.siteRoleChanges = {\r\n                siteRoles: {},\r\n                serverAdmin: undefined\r\n            };\r\n            this.$scope.addActiveDirectoryUsers = function (userTextInput) { return _this.importUsers(userTextInput); };\r\n        }\r\n        AddActiveDirectoryServerUsersDialogCtrl.prototype.importUsers = function (userTextInput) {\r\n            var _this = this;\r\n            this.$scope.busy = true;\r\n            this.$scope.usersToAdd = VizPortal.UsernameHelpers.splitUsernames(userTextInput); // match strings delimited by semicolons & commas\r\n            return this.serverUsers.importUsersFromActiveDirectory(this.$scope.usersToAdd).then(function (result) {\r\n                var users = VizPortal.Set.fromIdItemArray(result.users);\r\n                var promise = _this.$q.when({});\r\n                if (!_this.$scope.siteRoleChanges.serverAdmin && _.isEmpty(_this.$scope.siteRoleChanges.siteRoles)) {\r\n                    // if no site membership or server admin has been selected, toast for adding the users to the server\r\n                    _this.userActionNotification.notify({\r\n                        users: users,\r\n                        results: result.results,\r\n                        errors: result.errors,\r\n                        successCode: '10'\r\n                    });\r\n                }\r\n                else {\r\n                    // otherwise, we will toast based on the site membership results\r\n                    promise = _this.setRoles(users).then(function () {\r\n                        if (result.errors && result.errors.length > 0) {\r\n                            // if there were any errors creating the users on the server, we need to notify about those.\r\n                            _this.userActionNotification.notifyErrors({\r\n                                users: users,\r\n                                errors: result.errors\r\n                            });\r\n                        }\r\n                        return {};\r\n                    });\r\n                }\r\n                return promise.then(function () { return _this.$scope.$emit(VizPortal.UserAddedEvent); });\r\n            })\r\n                .then(function () { return _this.$scope.close({}); });\r\n        };\r\n        /**\r\n        * adds the users that were sucessfully created on the server to any sites and roles (including server admin)\r\n        * that were selected in the site roles picker.\r\n        */\r\n        AddActiveDirectoryServerUsersDialogCtrl.prototype.setRoles = function (users) {\r\n            if (users.isEmpty()) {\r\n                return this.$q.when({});\r\n            }\r\n            else if (!!this.$scope.siteRoleChanges.serverAdmin) {\r\n                return this.updateServerAdmin(users);\r\n            }\r\n            else if (!_.isEmpty(this.$scope.siteRoleChanges.siteRoles)) {\r\n                return this.updateSiteMembership(users);\r\n            }\r\n        };\r\n        // section: update server admin\r\n        AddActiveDirectoryServerUsersDialogCtrl.prototype.updateServerAdmin = function (users) {\r\n            var newAdminState = (this.$scope.siteRoleChanges.serverAdmin === VizPortal.CheckboxState.checked);\r\n            return this.rolesPickerClient.updateServerAdmin(users, newAdminState);\r\n        };\r\n        // section: update site membership or roles\r\n        AddActiveDirectoryServerUsersDialogCtrl.prototype.updateSiteMembership = function (users) {\r\n            var _this = this;\r\n            var userIds = users.keys();\r\n            var params = this.rolesPickerClient.siteRoleChangesToParams(userIds, this.$scope.siteRoleChanges.siteRoles);\r\n            return this.rolesPickerClient.updateServerUsersSiteMembership(params).then(function (result) {\r\n                var addedToSiteName = (params.addToSiteRoles.length > 0) ?\r\n                    _this.$scope.siteRoleChanges.siteRoles[params.addToSiteRoles[0].siteId].siteName : \"\";\r\n                var removedFromSiteName = (params.removeFromSiteIds.length > 0) ?\r\n                    _this.$scope.siteRoleChanges.siteRoles[params.removeFromSiteIds[0]].siteName : \"\";\r\n                // show toast\r\n                _this.siteMembershipUpdateActionNotification.notify(result, users, userIds.length, users.get(userIds[0]), params.addToSiteRoles.length, addedToSiteName, params.removeFromSiteIds.length, removedFromSiteName);\r\n            });\r\n        };\r\n        AddActiveDirectoryServerUsersDialogCtrl.$inject = [\r\n            '$scope',\r\n            '$q',\r\n            '$translate',\r\n            'ToasterService',\r\n            'ServerAdminUpdateActionNotification',\r\n            'SiteMembershipUpdateActionNotification',\r\n            'SiteRoles',\r\n            'SiteRolesPickerClientService',\r\n            'ServerUsers',\r\n            'UserActionNotification'\r\n        ];\r\n        return AddActiveDirectoryServerUsersDialogCtrl;\r\n    })();\r\n    VizPortal.AddActiveDirectoryServerUsersDialogCtrl = AddActiveDirectoryServerUsersDialogCtrl;\r\n    VizPortal.Module.instance().controller('AddActiveDirectoryServerUsersDialogCtrl', AddActiveDirectoryServerUsersDialogCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../controllers/AddActiveDirectorySiteUsersDialogCtrl.ts\" />\r\n/// <reference path=\"../controllers/AddActiveDirectoryServerUsersDialogCtrl.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var AddActiveDirectoryUsersAction = (function () {\r\n        function AddActiveDirectoryUsersAction($translate, ConfirmActionDialog, modal, siteUsers) {\r\n            this.$translate = $translate;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.modal = modal;\r\n            this.siteUsers = siteUsers;\r\n        }\r\n        AddActiveDirectoryUsersAction.prototype.showAddActiveDirectoryUsersToSiteDialog = function (dialogScope) {\r\n            var _this = this;\r\n            var dialogInstance = this.modal.open({\r\n                scope: dialogScope,\r\n                templateUrl: 'addActiveDirectorySiteUsersDialog.html',\r\n                size: VizPortal.ModalSize.fitToContent,\r\n                controller: VizPortal.AddActiveDirectorySiteUsersDialogCtrl,\r\n                resolve: {\r\n                    availableQuota: function () { return _this.siteUsers.getRemainingUserQuota(); }\r\n                }\r\n            });\r\n            return dialogInstance.result;\r\n        };\r\n        AddActiveDirectoryUsersAction.prototype.showAddActiveDirectoryUsersToServerDialog = function (dialogScope) {\r\n            var dialogInstance = this.modal.open({\r\n                scope: dialogScope,\r\n                templateUrl: 'addActiveDirectoryServerUsersDialog.html',\r\n                size: VizPortal.ModalSize.fitToContent,\r\n                controller: VizPortal.AddActiveDirectoryServerUsersDialogCtrl\r\n            });\r\n            return dialogInstance.result;\r\n        };\r\n        AddActiveDirectoryUsersAction.$inject = ['$translate',\r\n            'ConfirmActionDialog',\r\n            'ModalService',\r\n            'SiteUsers'];\r\n        return AddActiveDirectoryUsersAction;\r\n    })();\r\n    VizPortal.AddActiveDirectoryUsersAction = AddActiveDirectoryUsersAction;\r\n    VizPortal.Module.instance().service('AddActiveDirectoryUsersAction', AddActiveDirectoryUsersAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var EMAIL_REGEXP = /^[^@ ]+@[^@ ]+$/;\r\n    var EmailValidationHelper;\r\n    (function (EmailValidationHelper) {\r\n        function isValidEmail(email) {\r\n            return EMAIL_REGEXP.test(email);\r\n        }\r\n        EmailValidationHelper.isValidEmail = isValidEmail;\r\n        function getInvalidEmails(emails) {\r\n            return _.reject(emails, isValidEmail);\r\n        }\r\n        EmailValidationHelper.getInvalidEmails = getInvalidEmails;\r\n    })(EmailValidationHelper = VizPortal.EmailValidationHelper || (VizPortal.EmailValidationHelper = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../helpers/EmailValidationHelper.ts\" />\r\n/// <reference path=\"../resources/SiteRoles.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var splitEmails = function (emailText) { return _.chain(emailText.split(/[;,\\r\\n]+/))\r\n        .map(function (email) { return email.trim(); })\r\n        .compact() // Remove empty strings\r\n        .unique() // Remove dupes\r\n        .value(); };\r\n    var AddExternalUsersAction = (function () {\r\n        function AddExternalUsersAction($translate, $q, ConfirmActionDialog, Toaster, SiteUsers, SiteRolesUpdateActionNotification, Server) {\r\n            this.$translate = $translate;\r\n            this.$q = $q;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.Toaster = Toaster;\r\n            this.SiteUsers = SiteUsers;\r\n            this.SiteRolesUpdateActionNotification = SiteRolesUpdateActionNotification;\r\n            this.Server = Server;\r\n        }\r\n        AddExternalUsersAction.prototype.showAddExternalUsersToSiteDialog = function (dialogScope) {\r\n            var _this = this;\r\n            var addUserScope = this.configureScope(dialogScope);\r\n            var dialogInstance = this.ConfirmActionDialog.open({\r\n                scope: addUserScope,\r\n                bodyTemplateUrl: 'confirmActionDialogAddExternalUsers.html',\r\n                title: this.$translate.instant('addExternalUsersTitle'),\r\n                actionName: this.$translate.instant('addUsersDialogSubmit'),\r\n                action: function () {\r\n                    var emails = splitEmails(addUserScope.input.text);\r\n                    addUserScope.invalidEmails = VizPortal.EmailValidationHelper.getInvalidEmails(emails);\r\n                    if (addUserScope.invalidEmails.length > 0)\r\n                        return _this.$q.reject();\r\n                    if (addUserScope.input.thirdPartyUsers) {\r\n                        return _this.SiteUsers.importThirdPartyUsers(emails, addUserScope.siteRoleSelect.model);\r\n                    }\r\n                    else {\r\n                        return _this.SiteUsers.importExternalUsers(emails, addUserScope.siteRoleSelect.model);\r\n                    }\r\n                },\r\n                size: VizPortal.ModalSize.fitToContent\r\n            });\r\n            dialogInstance.result.then(function (result) {\r\n                _this.handleImportResult(result, addUserScope);\r\n            })\r\n                .fin(function () { return addUserScope.$destroy(); });\r\n            return dialogInstance.result;\r\n        };\r\n        AddExternalUsersAction.prototype.configureScope = function (dialogScope) {\r\n            var _this = this;\r\n            var addUserScope = dialogScope.$new();\r\n            addUserScope.showAuthenticationSelector = this.Server.isThirdPartyAuthEnabled();\r\n            addUserScope.input = {\r\n                text: '',\r\n                thirdPartyUsers: this.Server.isThirdPartyAuthEnabled()\r\n            };\r\n            addUserScope.siteRoleSelect = {\r\n                // possible site roles settings for the imported group include everything except guest & admin.\r\n                options: VizPortal.SiteRoles.WithoutGuestOrServerAdmin,\r\n                model: VizPortal.ServerApi.SiteRoles.Interactor\r\n            };\r\n            this.SiteUsers.getRemainingUserQuota().then(function (quota) {\r\n                addUserScope.userQuotaMessage = _.isNumber(quota)\r\n                    ? _this.$translate.instant('availableQuota', { NUM_USERS: quota }, VizPortal.L10n.Interpolations.Count)\r\n                    : null;\r\n            });\r\n            return addUserScope;\r\n        };\r\n        AddExternalUsersAction.prototype.handleImportResult = function (result, addUserScope) {\r\n            //TODO: Replace with generic user error result handling\r\n            // Both error AND success can occur in the same response\r\n            if (result.errors.length > 0) {\r\n                this.Toaster.pop({ type: VizPortal.ToastType.Error, text: this.$translate.instant('addUsersFailed') });\r\n            }\r\n            if (result.users.length > 0) {\r\n                var newUsers = VizPortal.Set.fromIdItemArray(result.users);\r\n                this.Toaster.pop({\r\n                    type: VizPortal.ToastType.Info,\r\n                    text: this.$translate.instant('usersAdded', {\r\n                        USER_NAME: VizPortal.L10n.elideIfLong(newUsers.first().displayName),\r\n                        USER_COUNT: newUsers.size()\r\n                    }, VizPortal.L10n.Interpolations.Count)\r\n                });\r\n                addUserScope.$emit(VizPortal.UserAddedEvent);\r\n            }\r\n        };\r\n        AddExternalUsersAction.$inject = ['$translate', '$q', 'ConfirmActionDialog', 'ToasterService', 'SiteUsers', 'SiteRolesUpdateActionNotification', 'ServerService'];\r\n        return AddExternalUsersAction;\r\n    })();\r\n    VizPortal.AddExternalUsersAction = AddExternalUsersAction;\r\n    VizPortal.Module.instance().service('AddExternalUsersAction', AddExternalUsersAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../../ts/libs.ts\" />\r\n/// <reference path=\"CheckboxState.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    /*\r\n     * Tri-state version of custom checkbox control.  See tbCheckbox.ts for the dual-state checkbox.\r\n     */\r\n    VizPortal.Module.instance().directive('tbCheckboxTristate', function () {\r\n        return {\r\n            restrict: 'E',\r\n            replace: true,\r\n            require: '?ngModel',\r\n            templateUrl: 'checkboxTristate.html',\r\n            scope: {\r\n                state: '&',\r\n                click: '&'\r\n            },\r\n            link: function (scope, elm, attrs, ctrl) {\r\n                scope.toggle = function () {\r\n                    // do nothing if disabled\r\n                    if (elm.hasClass('tb-disabled'))\r\n                        return;\r\n                    if (ctrl) {\r\n                        ctrl.$setViewValue(VizPortal.CheckboxState.toggle(ctrl.$viewValue));\r\n                        ctrl.$render();\r\n                    }\r\n                    scope.click();\r\n                };\r\n                if (ctrl) {\r\n                    scope.state = function () { return ctrl.$viewValue; };\r\n                }\r\n            }\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"IUserInfo.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../../common/components/checkboxes/tbCheckboxTristate.ts\" />\r\n/// <reference path=\"../controllers/SiteRolesPickerCtrl.ts\" />\r\n/// <reference path=\"../fetchers/ListResult.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../models/IApplyCancelButtons.ts\" />\r\n/// <reference path=\"../models/IServerUserInfo.ts\" />\r\n/// <reference path=\"../models/Set.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../resources/ServerUsers.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetUsersSiteRolesRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/UpdateServerUsersSiteMembershipRequest.ts\" />\r\n/// <reference path=\"../ServerApi/types/IServerUser.ts\" />\r\n/// <reference path=\"../ServerApi/types/ISiteRole.ts\" />\r\n/// <reference path=\"../services/SiteRolesPickerClientService.ts\" />\r\n/// <reference path=\"../services/ToasterService.ts\" />\r\n/// <reference path=\"../services/UserActionNotification.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.SiteRolesEvent = {\r\n        SiteRolesChanged: \"SiteRolesChanged\"\r\n    };\r\n    var SiteMembershipDialogCtrl = (function () {\r\n        function SiteMembershipDialogCtrl($scope, $q, $translate, serverUsers, siteMembershipUpdateActionNotification, rolesPickerClient, toaster) {\r\n            var _this = this;\r\n            this.$scope = $scope;\r\n            this.$q = $q;\r\n            this.$translate = $translate;\r\n            this.serverUsers = serverUsers;\r\n            this.siteMembershipUpdateActionNotification = siteMembershipUpdateActionNotification;\r\n            this.rolesPickerClient = rolesPickerClient;\r\n            this.toaster = toaster;\r\n            // IApplyCancelButtons\r\n            $scope.applyCancelButtons = {\r\n                applyString: $translate.instant(\"save\"),\r\n                cancelString: $translate.instant(\"cancel\"),\r\n                apply: function () { return _this.apply(); },\r\n                cancel: function () { return $scope.dismiss(); },\r\n                disableApply: function () { return (!_this.isDirty() || $scope.busy); },\r\n                disableCancel: function () { return $scope.busy; },\r\n                isBusy: function () { return $scope.busy; }\r\n            };\r\n            var displayName = ($scope.users.size() > 0) ? $scope.users.first().displayName : '';\r\n            $scope.editSiteMembershipDescription =\r\n                $translate.instant('editSiteMembershipDescription', { USER_COUNT: $scope.users.size(), USER_NAME: VizPortal.L10n.elideIfLong(displayName) }, VizPortal.L10n.Interpolations.Count);\r\n            $scope.changes = {\r\n                siteRoles: {},\r\n                serverAdmin: undefined\r\n            };\r\n            $scope.usersWithSiteRoles = null;\r\n            $scope.busy = false;\r\n            $scope.haveSelectedUsers = function () { return $scope.users.size() > 0; };\r\n            // get data for initial state\r\n            this.getSiteRolesForSelectedUsers();\r\n        }\r\n        SiteMembershipDialogCtrl.prototype.apply = function () {\r\n            var _this = this;\r\n            var scope = this.$scope;\r\n            scope.busy = true;\r\n            var users = _.clone(scope.users); // clone for independence from further selection\r\n            var promise;\r\n            if (scope.changes.serverAdmin !== undefined) {\r\n                // server admin changed\r\n                promise = this.updateServerAdmin(users).then(function () {\r\n                    if (scope.changes.serverAdmin === VizPortal.CheckboxState.empty && !_.isEmpty(scope.changes.siteRoles)) {\r\n                        // server admin got unchecked, site roles changed\r\n                        return _this.updateSiteMembership(users);\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                // server admin did not change\r\n                var originalAdminState = VizPortal.SiteRolesPickerCtrl.adminStateFromUsers(this.getServerAdminCount(), scope.users.size());\r\n                if (originalAdminState === VizPortal.CheckboxState.empty && !_.isEmpty(scope.changes.siteRoles)) {\r\n                    // server is not checked, site roles changed\r\n                    promise = this.updateSiteMembership(users);\r\n                }\r\n            }\r\n            // After all the requests dance, fire events and close the dialog, we're done here.\r\n            return promise.then(function (result) {\r\n                scope.$emit(VizPortal.SiteRolesEvent.SiteRolesChanged);\r\n                scope.close(result);\r\n            });\r\n        };\r\n        SiteMembershipDialogCtrl.prototype.getServerAdminCount = function () {\r\n            return this.$scope.usersWithSiteRoles ? this.$scope.usersWithSiteRoles.serverAdmins.length : 0;\r\n        };\r\n        SiteMembershipDialogCtrl.prototype.isDirty = function () {\r\n            var scope = this.$scope;\r\n            var originalAdminState = VizPortal.SiteRolesPickerCtrl.adminStateFromUsers(this.getServerAdminCount(), scope.users.size());\r\n            var serverAdminChanged = scope.changes.serverAdmin && (scope.changes.serverAdmin !== originalAdminState);\r\n            var siteRolesChanged = (originalAdminState === VizPortal.CheckboxState.empty && !_.isEmpty(scope.changes.siteRoles));\r\n            return serverAdminChanged || siteRolesChanged;\r\n        };\r\n        // section: update server admin\r\n        SiteMembershipDialogCtrl.prototype.updateServerAdmin = function (users) {\r\n            var _this = this;\r\n            // users in the set might be stale, so ask the server for the latest admin status\r\n            return this.getServerAdmins(users.keys()).then(function (serverAdmins) {\r\n                var filteredServerUsers;\r\n                var newAdminState = (_this.$scope.changes.serverAdmin === VizPortal.CheckboxState.checked);\r\n                if (newAdminState) {\r\n                    // promote non admin users only\r\n                    filteredServerUsers = users.filter(function (user) { return !_.contains(serverAdmins, user.id); });\r\n                }\r\n                else {\r\n                    // demote admin users only\r\n                    filteredServerUsers = users.filter(function (user) { return _.contains(serverAdmins, user.id); });\r\n                }\r\n                return _this.rolesPickerClient.updateServerAdmin(filteredServerUsers, newAdminState);\r\n            });\r\n        };\r\n        // section: update site membership or roles\r\n        SiteMembershipDialogCtrl.prototype.updateSiteMembership = function (users) {\r\n            var _this = this;\r\n            var userIds = users.keys();\r\n            var params = this.rolesPickerClient.siteRoleChangesToParams(userIds, this.$scope.changes.siteRoles);\r\n            return this.rolesPickerClient.updateServerUsersSiteMembership(params).then(function (result) {\r\n                var addedToSiteName = (params.addToSiteRoles.length > 0) ?\r\n                    _this.$scope.changes.siteRoles[params.addToSiteRoles[0].siteId].siteName : \"\";\r\n                var removedFromSiteName = (params.removeFromSiteIds.length > 0) ?\r\n                    _this.$scope.changes.siteRoles[params.removeFromSiteIds[0]].siteName : \"\";\r\n                // show toast\r\n                _this.siteMembershipUpdateActionNotification.notify(result, users, userIds.length, users.get(userIds[0]), params.addToSiteRoles.length, addedToSiteName, params.removeFromSiteIds.length, removedFromSiteName);\r\n            });\r\n        };\r\n        // triggered by watch on the users object\r\n        SiteMembershipDialogCtrl.prototype.getSiteRolesForSelectedUsers = function () {\r\n            var _this = this;\r\n            // return if there are no selected users.\r\n            if (this.$scope.users.size() === 0) {\r\n                return this.$q.when({});\r\n            }\r\n            // get site role data for the selected users.\r\n            var userIds = this.$scope.users.keys();\r\n            return this.serverUsers.getSiteRoles(userIds).then(function (result) {\r\n                var newState = {\r\n                    users: _this.$scope.users,\r\n                    userRoles: result.users,\r\n                    serverAdmins: []\r\n                };\r\n                // now get server admin data\r\n                // $todo: right now we have to use getServerUsers, ideally we'll have a getServerAdmins API\r\n                return _this.getServerAdmins(userIds).then(function (serverAdmins) {\r\n                    // now calculate number of server admins since it is not included in getSiteRoles\r\n                    newState.serverAdmins = serverAdmins;\r\n                    // update this watched model only when we are absolutely ready (ie. server admin state also updated)\r\n                    _this.$scope.usersWithSiteRoles = newState;\r\n                });\r\n            });\r\n        };\r\n        SiteMembershipDialogCtrl.prototype.getServerAdmins = function (userIds) {\r\n            var _this = this;\r\n            var serverAdmins = [];\r\n            return this.serverUsers.getByUserIds(userIds).then(function (usersList) {\r\n                // now calculate number of server admins since it is not included in the results\r\n                _.each(usersList.items, function (user) {\r\n                    if (user.maxSiteRole === VizPortal.ServerApi.SiteRoles.ServerAdministrator) {\r\n                        serverAdmins.push(user.id);\r\n                    }\r\n                });\r\n                return _this.$q.when(serverAdmins);\r\n            });\r\n        };\r\n        SiteMembershipDialogCtrl.$inject = [\r\n            '$scope',\r\n            '$q',\r\n            '$translate',\r\n            'ServerUsers',\r\n            'SiteMembershipUpdateActionNotification',\r\n            'SiteRolesPickerClientService',\r\n            'ToasterService'\r\n        ];\r\n        return SiteMembershipDialogCtrl;\r\n    })();\r\n    VizPortal.SiteMembershipDialogCtrl = SiteMembershipDialogCtrl;\r\n    VizPortal.Module.instance().controller('SiteMembershipDialogCtrl', SiteMembershipDialogCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SetOfUsers = (function (_super) {\r\n        __extends(SetOfUsers, _super);\r\n        function SetOfUsers() {\r\n            _super.call(this, SetOfUsers.usernameSelector);\r\n        }\r\n        SetOfUsers.singleton = function (user) {\r\n            return VizPortal.Set.singleton(user, SetOfUsers.usernameSelector);\r\n        };\r\n        SetOfUsers.usernameSelector = function (user) { return user.username + (user.domainName ? user.domainName : ''); };\r\n        return SetOfUsers;\r\n    })(VizPortal.Set);\r\n    VizPortal.SetOfUsers = SetOfUsers;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var CheckUserNamesRequest = (function (_super) {\r\n            __extends(CheckUserNamesRequest, _super);\r\n            function CheckUserNamesRequest(params) {\r\n                _super.call(this, 'checkUserNames', params);\r\n            }\r\n            return CheckUserNamesRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.CheckUserNamesRequest = CheckUserNamesRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/RequestHelper.ts\" />\r\n/// <reference path=\"../helpers/ResultHelper.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../resources/SiteRoles.ts\" />\r\n/// <reference path=\"../ServerApi/requests/CheckUserNamesRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetUsersRequest.ts\" />\r\n/// <reference path=\"../ServerApi/types/IUser.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\n/// <reference path=\"Resource.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var Users = (function (_super) {\r\n        __extends(Users, _super);\r\n        function Users(server, FetcherFactory) {\r\n            _super.call(this, FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetUsersRequest, function (result) { return result.users; }));\r\n            this.server = server;\r\n        }\r\n        Users.prototype.checkUserNames = function (usernames) {\r\n            var params = {\r\n                usernames: usernames\r\n            };\r\n            return this.server.sendRequests(VizPortal.RequestHelper.buildRequests(usernames, function (usernamesBlock) { return new VizPortal.ServerApi.CheckUserNamesRequest({ usernames: usernamesBlock }); }), function (results) {\r\n                return {\r\n                    errors: VizPortal.ResultHelper.combineErrors(results),\r\n                    users: VizPortal.ResultHelper.combine(results, function (result) { return result.users; })\r\n                };\r\n            });\r\n        };\r\n        // gets the user with the specified username & domainName.\r\n        Users.prototype.getUserByUsernameAndDomain = function (username, domainName) {\r\n            return this.all()\r\n                .addFilter(VizPortal.Filter.stringFieldEq('username', username))\r\n                .addFilter(VizPortal.Filter.stringFieldEq('domainName', domainName))\r\n                .getFirst();\r\n        };\r\n        Users.AdminsOnlyFilter = VizPortal.Filter.stringFieldInArray(VizPortal.ServerApi.FilterFieldNames.siteRole, [\r\n            VizPortal.ServerApi.SiteRoles.ServerAdministrator,\r\n            VizPortal.ServerApi.SiteRoles.SiteAdministrator\r\n        ]);\r\n        Users.WithoutGuestFilter = VizPortal.Filter.stringFieldInArray(VizPortal.ServerApi.FilterFieldNames.siteRole, _.without(VizPortal.SiteRoles.All, VizPortal.ServerApi.SiteRoles.Guest, VizPortal.ServerApi.SiteRoles.Unlicensed));\r\n        Users.$inject = ['ServerService', 'FetcherFactory'];\r\n        return Users;\r\n    })(VizPortal.Resource);\r\n    VizPortal.Users = Users;\r\n    VizPortal.Module.instance().service('Users', Users);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../../common/components/checkboxes/CheckboxState.ts\" />\r\n/// <reference path=\"../controllers/SiteMembershipDialogCtrl.ts\" />\r\n/// <reference path=\"../controllers/SiteRolesPickerCtrl.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../models/IUserInfo.ts\" />\r\n/// <reference path=\"../models/SetOfUsers.ts\" />\r\n/// <reference path=\"../resources/ServerUsers.ts\" />\r\n/// <reference path=\"../resources/SiteUsers.ts\" />\r\n/// <reference path=\"../resources/Users.ts\" />\r\n/// <reference path=\"../services/AddUsersOptionsAction.ts\" />\r\n/// <reference path=\"../services/SiteRolesPickerClientService.ts\" />\r\n/// <reference path=\"../services/UserActionNotification.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    // Possible states that the form can get into.\r\n    // Aside from the initial state, the form has 3 other different flows\r\n    // depending on availability of the specified username.\r\n    VizPortal.AddLocalUserFormState = {\r\n        Initial: \"initial\",\r\n        NewUser: \"newUser\",\r\n        OtherSite: \"otherSite\",\r\n        NotAvailable: \"notAvailable\"\r\n    };\r\n    var AddLocalUserDialogCtrl = (function () {\r\n        function AddLocalUserDialogCtrl($scope, $q, $translate, addUserToSiteActionNotification, userActionNotification, mode, ServerUsers, serverAdminUpdateActionNotification, siteMembershipUpdateActionNotification, siteRoles, rolesPickerClient, siteRolesUpdateActionNotification, SiteUsers, toaster, Users, \r\n            // resolved in AddLocalUsersAction\r\n            availableQuota) {\r\n            var _this = this;\r\n            this.$scope = $scope;\r\n            this.$q = $q;\r\n            this.$translate = $translate;\r\n            this.addUserToSiteActionNotification = addUserToSiteActionNotification;\r\n            this.userActionNotification = userActionNotification;\r\n            this.mode = mode;\r\n            this.ServerUsers = ServerUsers;\r\n            this.serverAdminUpdateActionNotification = serverAdminUpdateActionNotification;\r\n            this.siteMembershipUpdateActionNotification = siteMembershipUpdateActionNotification;\r\n            this.siteRoles = siteRoles;\r\n            this.rolesPickerClient = rolesPickerClient;\r\n            this.siteRolesUpdateActionNotification = siteRolesUpdateActionNotification;\r\n            this.SiteUsers = SiteUsers;\r\n            this.toaster = toaster;\r\n            this.Users = Users;\r\n            this.availableQuota = availableQuota;\r\n            // site or server\r\n            $scope.mode = mode;\r\n            $scope.isServerMode = function () {\r\n                return $scope.mode === 'server';\r\n            };\r\n            $scope.isSiteMode = function () {\r\n                return $scope.mode === 'site';\r\n            };\r\n            // setup site role stuff\r\n            if ($scope.isServerMode()) {\r\n                // site role changes will be stored here\r\n                $scope.siteRoleChanges = {\r\n                    siteRoles: {},\r\n                    serverAdmin: undefined\r\n                };\r\n            }\r\n            else if ($scope.isSiteMode()) {\r\n                // possible site roles settings for the imported group include everything except guest & admin.\r\n                $scope.siteRoleOptions = siteRoles.optionsForCurrentUser();\r\n                $scope.siteRole = availableQuota <= 0 ? VizPortal.ServerApi.SiteRoles.Unlicensed : VizPortal.ServerApi.SiteRoles.Interactor;\r\n                $scope.setSiteRole = function (role) {\r\n                    $scope.siteRole = role;\r\n                };\r\n            }\r\n            else {\r\n                throw new Error('Unknown mode, it is neither \"site\" or \"server\"');\r\n            }\r\n            // initial state of the form\r\n            $scope.formModel = {\r\n                username: \"\",\r\n                formState: VizPortal.AddLocalUserFormState.Initial,\r\n                errorText: \"\",\r\n                newUserFlowModel: {\r\n                    authId: \"\",\r\n                    displayName: \"\",\r\n                    password: \"\",\r\n                    confirmPassword: \"\",\r\n                    email: \"\",\r\n                    usernameInfo: \"\"\r\n                },\r\n                otherSiteFlowModel: {\r\n                    displayName: \"\",\r\n                    warningText: \"\",\r\n                    proceedClicked: false\r\n                },\r\n                notAvailableFlowModel: {\r\n                    displayName: \"\",\r\n                    errorText: \"\"\r\n                }\r\n            };\r\n            // proceed button on Flow #2 (username exist on another site)\r\n            $scope.proceed = function () {\r\n                _this.getOtherSiteFlowModel().proceedClicked = true;\r\n            };\r\n            // returns true when the proceed button has been clicked on Flow #2.\r\n            $scope.proceedClicked = function () {\r\n                return _this.getOtherSiteFlowModel().proceedClicked;\r\n            };\r\n            // called when \"Add User\" button gets clicked\r\n            $scope.confirm = function () {\r\n                _this.confirm();\r\n            };\r\n            // determines whether the \"Add User\" button is disabled\r\n            $scope.isConfirmDisabled = function () {\r\n                return _this.isConfirmDisabled();\r\n            };\r\n            // called everytime the username field changes\r\n            $scope.checkDoesUsernameExists = function (username) {\r\n                Users.checkUserNames([username]).then(function (results) {\r\n                    if (results.users.length === 0) {\r\n                        $scope.formModel.formState = VizPortal.AddLocalUserFormState.Initial;\r\n                        return;\r\n                    }\r\n                    var result = results.users[0];\r\n                    // $note-ltan:\r\n                    // We can not assume we are dealing with site users even when existsOnSite is true.\r\n                    // Thus the explicity mode check.\r\n                    if ($scope.isSiteMode() && result.existsOnSite) {\r\n                        _this.setupFormForNotAvailable(result.displayName, \"usernameExistsOnCurrentSite\");\r\n                    }\r\n                    else if (result.existsOnServer) {\r\n                        if ($scope.isSiteMode()) {\r\n                            _this.setupFormForAddUserToSite(result.displayName);\r\n                        }\r\n                        else {\r\n                            _this.setupFormForNotAvailable(result.displayName, \"usernameExistsOnServer\");\r\n                        }\r\n                    }\r\n                    else {\r\n                        _this.setupFormForAvailable();\r\n                    }\r\n                });\r\n            };\r\n            // true if the passwords & confirm password fields are both non-empty\r\n            $scope.passwordFieldsAreNonEmpty = function () {\r\n                var model = $scope.formModel.newUserFlowModel;\r\n                return model.password &&\r\n                    model.confirmPassword &&\r\n                    model.password.length > 0 &&\r\n                    model.confirmPassword.length > 0;\r\n            };\r\n            // TODO: dry this out. Duplicated in AddActiveDirectorySiteUsersDialogCtrl\r\n            $scope.availableQuota = availableQuota;\r\n            $scope.isSiteRoleOptionDisabled = function (siteRole) {\r\n                // when available quota is 0, only allow Unlicensed and UnlicensedWithPublish users to be added.\r\n                return availableQuota <= 0 && siteRole !== VizPortal.ServerApi.SiteRoles.Unlicensed && siteRole !== VizPortal.ServerApi.SiteRoles.UnlicensedWithPublish;\r\n            };\r\n            $scope.isQuotaEnabledForSite = _.isNumber(availableQuota);\r\n        }\r\n        AddLocalUserDialogCtrl.prototype.setupFormForAddUserToSite = function (displayName) {\r\n            this.$scope.formModel.formState = VizPortal.AddLocalUserFormState.OtherSite;\r\n            this.getOtherSiteFlowModel().displayName = displayName;\r\n            this.getOtherSiteFlowModel().warningText = this.$translate.instant('usernameExistsOnAnotherSite', { USER_NAME: VizPortal.L10n.elideIfLong(displayName) });\r\n            this.getOtherSiteFlowModel().proceedClicked = false;\r\n        };\r\n        AddLocalUserDialogCtrl.prototype.setupFormForNotAvailable = function (displayName, errorStringId) {\r\n            this.$scope.formModel.formState = VizPortal.AddLocalUserFormState.NotAvailable;\r\n            this.getNotAvailableFlowModel().displayName = displayName;\r\n            this.getNotAvailableFlowModel().errorText = this.$translate.instant(errorStringId, { USER_NAME: VizPortal.L10n.elideIfLong(displayName) });\r\n        };\r\n        AddLocalUserDialogCtrl.prototype.setupFormForAvailable = function () {\r\n            this.$scope.formModel.formState = VizPortal.AddLocalUserFormState.NewUser;\r\n            this.getNewUserFlowModel().usernameInfo = this.$translate.instant('usernameAvailable');\r\n        };\r\n        // various logic that depends on the state of the form\r\n        AddLocalUserDialogCtrl.prototype.confirm = function () {\r\n            this.$scope.busy = true;\r\n            var username = this.$scope.formModel.username;\r\n            switch (this.getFormState()) {\r\n                case VizPortal.AddLocalUserFormState.NewUser:\r\n                    if (this.$scope.isSiteMode()) {\r\n                        this.createLocalSiteUser(username, this.getNewUserFlowModel());\r\n                    }\r\n                    else if (this.$scope.isServerMode()) {\r\n                        this.createLocalServerUser(username, this.getNewUserFlowModel());\r\n                    }\r\n                    break;\r\n                case VizPortal.AddLocalUserFormState.OtherSite:\r\n                    this.addUserToSite(username, this.getOtherSiteFlowModel());\r\n                    break;\r\n            }\r\n        };\r\n        AddLocalUserDialogCtrl.prototype.isConfirmDisabled = function () {\r\n            if (this.$scope.busy) {\r\n                return true;\r\n            }\r\n            if (this.$scope.addLocalUserForm.$invalid) {\r\n                return true;\r\n            }\r\n            switch (this.getFormState()) {\r\n                case VizPortal.AddLocalUserFormState.Initial:\r\n                case VizPortal.AddLocalUserFormState.NewUser:\r\n                    return false;\r\n                case VizPortal.AddLocalUserFormState.OtherSite:\r\n                    return !this.getOtherSiteFlowModel().proceedClicked;\r\n                case VizPortal.AddLocalUserFormState.NotAvailable:\r\n                    return true;\r\n            }\r\n            return false;\r\n        };\r\n        // section: create local user\r\n        AddLocalUserDialogCtrl.prototype.createLocalSiteUser = function (username, model) {\r\n            var _this = this;\r\n            // get the currently selected site role off the scope\r\n            var siteRoleToGiveNewUser = this.$scope.siteRole;\r\n            // set a flag to true if the currently selected role is Server Admin\r\n            var makeServerAdmin = (siteRoleToGiveNewUser === VizPortal.ServerApi.SiteRoles.ServerAdministrator) || null;\r\n            // if setting to server admin, we don't pass the role to the backend.\r\n            // because the server admin flag & the site role string are mutually exclusive.\r\n            if (makeServerAdmin) {\r\n                siteRoleToGiveNewUser = null;\r\n            }\r\n            this.SiteUsers.createLocalUser(username, model.displayName, model.email, model.password, makeServerAdmin, siteRoleToGiveNewUser).then(function (result) {\r\n                _this.showNotificationForCreateUser(result);\r\n                if (!!result.errors && result.errors.length > 0) {\r\n                    _this.reenableButtons();\r\n                }\r\n                else {\r\n                    _this.$scope.$emit(VizPortal.UserAddedEvent);\r\n                    _this.$scope.close(result);\r\n                }\r\n            });\r\n        };\r\n        AddLocalUserDialogCtrl.prototype.createLocalServerUser = function (username, model) {\r\n            var _this = this;\r\n            this.ServerUsers.createLocalServerUser(username, model.displayName, model.email, model.password)\r\n                .then(function (result) {\r\n                _this.showNotificationForCreateUser(result);\r\n                if (!!result.errors && result.errors.length > 0) {\r\n                    _this.reenableButtons();\r\n                }\r\n                else {\r\n                    _this.onServerUserCreateSuccess(result);\r\n                }\r\n            });\r\n        };\r\n        AddLocalUserDialogCtrl.prototype.onServerUserCreateSuccess = function (result) {\r\n            this.$scope.$emit(VizPortal.UserAddedEvent);\r\n            // create an interfaced object for the created user\r\n            var addedUser = {\r\n                id: result.users[0].id,\r\n                authId: result.users[0].authId,\r\n                username: result.users[0].username,\r\n                displayName: result.users[0].displayName\r\n            };\r\n            // update site membership\r\n            if (!!this.$scope.siteRoleChanges.serverAdmin) {\r\n                this.updateServerAdmin(addedUser);\r\n            }\r\n            else if (!_.isEmpty(this.$scope.siteRoleChanges.siteRoles)) {\r\n                this.updateSiteMembership(addedUser.id, addedUser.authId, addedUser.username, addedUser.displayName);\r\n            }\r\n            this.$scope.close(result);\r\n        };\r\n        // section: update server admin\r\n        AddLocalUserDialogCtrl.prototype.updateServerAdmin = function (user) {\r\n            var _this = this;\r\n            var users = VizPortal.SetOfUsers.singleton(user);\r\n            var newAdminState = (this.$scope.siteRoleChanges.serverAdmin === VizPortal.CheckboxState.checked);\r\n            this.rolesPickerClient.updateServerAdmin(users, newAdminState).then(function () {\r\n                _this.$scope.$emit(VizPortal.SiteRolesEvent.SiteRolesChanged);\r\n            });\r\n        };\r\n        // section: update site membership or roles\r\n        AddLocalUserDialogCtrl.prototype.updateSiteMembership = function (userId, authUserId, username, userDisplayName) {\r\n            var _this = this;\r\n            var params = this.rolesPickerClient.siteRoleChangesToParams([userId], this.$scope.siteRoleChanges.siteRoles);\r\n            this.rolesPickerClient.updateServerUsersSiteMembership(params)\r\n                .then(function (result) {\r\n                var addedToSiteName = (params.addToSiteRoles.length > 0) ?\r\n                    _this.$scope.siteRoleChanges.siteRoles[params.addToSiteRoles[0].siteId].siteName : \"\";\r\n                // create a Set<T> object for the result notification system\r\n                var addedUser = {\r\n                    id: userId,\r\n                    authId: authUserId,\r\n                    username: username,\r\n                    displayName: userDisplayName\r\n                };\r\n                var users = VizPortal.SetOfUsers.singleton(addedUser);\r\n                _this.siteMembershipUpdateActionNotification.notify(result, users, 1, addedUser, params.addToSiteRoles.length, addedToSiteName, 0, \"\");\r\n                _this.$scope.$emit(VizPortal.SiteRolesEvent.SiteRolesChanged);\r\n            });\r\n        };\r\n        // section: update site role\r\n        AddLocalUserDialogCtrl.prototype.updateSiteRole = function (user) {\r\n            var _this = this;\r\n            var siteRole = this.$scope.siteRole;\r\n            var userIds = [user.id];\r\n            var userSet = VizPortal.SetOfUsers.singleton(user);\r\n            if (siteRole === VizPortal.ServerApi.SiteRoles.ServerAdministrator) {\r\n                this.SiteUsers.updateServerAdminStatusAndDelay(userIds, true).then(function (result) {\r\n                    _this.serverAdminUpdateActionNotification.notify(result, userSet, true);\r\n                    _this.$scope.$emit(VizPortal.SiteRolesEvent.SiteRolesChanged);\r\n                });\r\n            }\r\n            else {\r\n                this.SiteUsers.updateUsersSiteRole(userIds, siteRole).then(function (result) {\r\n                    _this.siteRolesUpdateActionNotification.notify(result, userSet, siteRole);\r\n                    _this.$scope.$emit(VizPortal.SiteRolesEvent.SiteRolesChanged);\r\n                });\r\n            }\r\n        };\r\n        // section: add user to site\r\n        AddLocalUserDialogCtrl.prototype.addUserToSite = function (username, model) {\r\n            var _this = this;\r\n            var selectedSiteRole = this.$scope.siteRole;\r\n            var promoteToServerAdmin = false;\r\n            if (selectedSiteRole === VizPortal.ServerApi.SiteRoles.ServerAdministrator) {\r\n                promoteToServerAdmin = true;\r\n                // ServerAdmin isn't a real site role.\r\n                // We will add the user with no site role and then promote them to Server Admin.\r\n                selectedSiteRole = VizPortal.ServerApi.SiteRoles.Unlicensed;\r\n            }\r\n            this.SiteUsers.addUsersToSite([username], selectedSiteRole)\r\n                .then(function (result) {\r\n                _this.showNotificationForAddUserToSite(result, username, selectedSiteRole);\r\n                if (!!result.errors && result.errors.length > 0) {\r\n                    _this.reenableButtons();\r\n                }\r\n                else {\r\n                    var promoteAdminPromise = promoteToServerAdmin ? _this.promoteToServerAdmin(username) : _this.$q.when({});\r\n                    promoteAdminPromise.then(function (promoteAdminResult) {\r\n                        if (!!promoteAdminResult.errors && promoteAdminResult.errors.length > 0) {\r\n                            _this.reenableButtons();\r\n                        }\r\n                        else {\r\n                            _this.$scope.$emit(VizPortal.UserAddedEvent);\r\n                            _this.$scope.close(result);\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        };\r\n        AddLocalUserDialogCtrl.prototype.promoteToServerAdmin = function (username) {\r\n            var _this = this;\r\n            // TODO: if the backend can give us the IServerUser info (id is all we need) in the IUserNameAvailability result,\r\n            //       we won't have to make this first request to get the Server User.\r\n            var serverUser;\r\n            return this.ServerUsers.getUserByUsernameAndDomain(username, 'local')\r\n                .then(function (user) {\r\n                serverUser = user;\r\n                return _this.ServerUsers.updateServerAdminStatus([user.id], true);\r\n            })\r\n                .then(function (result) {\r\n                _this.serverAdminUpdateActionNotification.notify(result, VizPortal.SetOfUsers.singleton(serverUser), true);\r\n                return result;\r\n            });\r\n        };\r\n        // helpers\r\n        AddLocalUserDialogCtrl.prototype.reenableButtons = function () {\r\n            this.$scope.busy = false;\r\n        };\r\n        AddLocalUserDialogCtrl.prototype.getFormState = function () {\r\n            return this.$scope.formModel.formState;\r\n        };\r\n        AddLocalUserDialogCtrl.prototype.showNotificationForCreateUser = function (result) {\r\n            var _this = this;\r\n            var params = {\r\n                users: VizPortal.Set.fromIdItemArray(result.users),\r\n                results: result.results,\r\n                errors: result.errors,\r\n                successCode: '30',\r\n                showErrorMsgFunc: function (errorMsg) {\r\n                    _this.$scope.formModel.errorText = errorMsg;\r\n                }\r\n            };\r\n            this.userActionNotification.notify(params);\r\n        };\r\n        AddLocalUserDialogCtrl.prototype.showNotificationForAddUserToSite = function (result, username, siteRole) {\r\n            var _this = this;\r\n            this.addUserToSiteActionNotification.notify(function (errorMsg) {\r\n                _this.$scope.formModel.errorText = errorMsg;\r\n            }, result, username, siteRole);\r\n        };\r\n        // for UX FLOW #1 -- username is available\r\n        AddLocalUserDialogCtrl.prototype.isNewUserFlow = function () {\r\n            return this.getFormState() === VizPortal.AddLocalUserFormState.NewUser;\r\n        };\r\n        AddLocalUserDialogCtrl.prototype.getNewUserFlowModel = function () {\r\n            return this.$scope.formModel.newUserFlowModel;\r\n        };\r\n        // for UX FLOW #2 -- username exists on another site\r\n        AddLocalUserDialogCtrl.prototype.isOtherSiteFlow = function () {\r\n            return this.getFormState() === VizPortal.AddLocalUserFormState.OtherSite;\r\n        };\r\n        AddLocalUserDialogCtrl.prototype.getOtherSiteFlowModel = function () {\r\n            return this.$scope.formModel.otherSiteFlowModel;\r\n        };\r\n        // for UX FLOW #3 -- username exists on current site, thus not available\r\n        AddLocalUserDialogCtrl.prototype.getNotAvailableFlowModel = function () {\r\n            return this.$scope.formModel.notAvailableFlowModel;\r\n        };\r\n        AddLocalUserDialogCtrl.$inject = [\r\n            '$scope',\r\n            '$q',\r\n            '$translate',\r\n            'AddUserToSiteActionNotification',\r\n            'UserActionNotification',\r\n            'mode',\r\n            'ServerUsers',\r\n            'ServerAdminUpdateActionNotification',\r\n            'SiteMembershipUpdateActionNotification',\r\n            'SiteRoles',\r\n            'SiteRolesPickerClientService',\r\n            'SiteRolesUpdateActionNotification',\r\n            'SiteUsers',\r\n            'ToasterService',\r\n            'Users',\r\n            'availableQuota'\r\n        ];\r\n        return AddLocalUserDialogCtrl;\r\n    })();\r\n    VizPortal.AddLocalUserDialogCtrl = AddLocalUserDialogCtrl;\r\n    VizPortal.Module.instance().controller('AddLocalUserDialogCtrl', AddLocalUserDialogCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../controllers/AddLocalUserDialogCtrl.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var AddLocalUserAction = (function () {\r\n        function AddLocalUserAction(modal, siteUsers) {\r\n            this.modal = modal;\r\n            this.siteUsers = siteUsers;\r\n        }\r\n        AddLocalUserAction.prototype.showAddLocalUserDialogForSite = function (dialogScope) {\r\n            var _this = this;\r\n            var dialogInstance = this.modal.open({\r\n                scope: dialogScope,\r\n                templateUrl: 'addLocalUserDialog.html',\r\n                size: VizPortal.ModalSize.fitToContent,\r\n                controller: VizPortal.AddLocalUserDialogCtrl,\r\n                resolve: {\r\n                    mode: function () { return \"site\"; },\r\n                    availableQuota: function () { return _this.siteUsers.getRemainingUserQuota(); }\r\n                }\r\n            });\r\n            return dialogInstance.result;\r\n        };\r\n        AddLocalUserAction.prototype.showAddLocalUserDialogForServer = function (dialogScope) {\r\n            var dialogInstance = this.modal.open({\r\n                scope: dialogScope,\r\n                templateUrl: 'addLocalUserDialog.html',\r\n                size: VizPortal.ModalSize.fitToContent,\r\n                controller: VizPortal.AddLocalUserDialogCtrl,\r\n                resolve: {\r\n                    mode: function () { return \"server\"; },\r\n                    availableQuota: function () { return undefined; } // no quota on server\r\n                }\r\n            });\r\n            return dialogInstance.result;\r\n        };\r\n        AddLocalUserAction.$inject = ['ModalService', 'SiteUsers'];\r\n        return AddLocalUserAction;\r\n    })();\r\n    VizPortal.AddLocalUserAction = AddLocalUserAction;\r\n    VizPortal.Module.instance().service('AddLocalUserAction', AddLocalUserAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/AddActiveDirectoryUsersAction.ts\" />\r\n/// <reference path=\"../services/ActiveDirectoryGroupAction.ts\" />\r\n/// <reference path=\"../services/AddExternalUsersAction.ts\" />\r\n/// <reference path=\"../services/AddLocalUserAction.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    // triggered by sub-dialogs when one or more users have been added to the site or server\r\n    VizPortal.UserAddedEvent = 'UserAddedEvent';\r\n    var AddUsersOptionsAction = (function () {\r\n        function AddUsersOptionsAction(modal, serverService) {\r\n            this.modal = modal;\r\n            this.serverService = serverService;\r\n        }\r\n        AddUsersOptionsAction.prototype.showAddSiteUsersOptionsDialog = function (context) {\r\n            var dialogInstance = this.createDialogInstance(context, AddSiteUsersOptionsDialogCtrl);\r\n            return dialogInstance.result;\r\n        };\r\n        AddUsersOptionsAction.prototype.showAddServerUsersOptionsDialog = function (context) {\r\n            var dialogInstance = this.createDialogInstance(context, AddServerUsersOptionsDialogCtrl);\r\n            return dialogInstance.result;\r\n        };\r\n        AddUsersOptionsAction.prototype.createDialogInstance = function (context, controller) {\r\n            var _this = this;\r\n            return this.modal.open({\r\n                scope: context.scope,\r\n                templateUrl: 'addUsersOptionsDialog.html',\r\n                size: VizPortal.ModalSize.fitToContent,\r\n                position: _.extend(VizPortal.ModalService.anchoredTo(context.targetElement)),\r\n                controller: controller,\r\n                resolve: {\r\n                    domainFamily: function () { return _this.serverService.domainFamily(); }\r\n                }\r\n            });\r\n        };\r\n        AddUsersOptionsAction.$inject = ['ModalService', 'ServerService'];\r\n        return AddUsersOptionsAction;\r\n    })();\r\n    VizPortal.AddUsersOptionsAction = AddUsersOptionsAction;\r\n    VizPortal.Module.instance().service('AddUsersOptionsAction', AddUsersOptionsAction);\r\n    var AddSiteUsersOptionsDialogCtrl = (function () {\r\n        function AddSiteUsersOptionsDialogCtrl($scope, addLocalUserAction, activeDirectoryGroupAction, addActiveDirectoryUsersAction, addExternalUsersAction, bulkImportUsersAction, domainFamily) {\r\n            $scope.title = 'addUsersToSite';\r\n            if (domainFamily === VizPortal.ServerApi.DomainFamily.Local) {\r\n                $scope.addLocalUser = function () {\r\n                    // Note: The order here is important, because $scope.close() will destroy the scope.\r\n                    addLocalUserAction.showAddLocalUserDialogForSite($scope.$parent);\r\n                    $scope.close({});\r\n                };\r\n            }\r\n            if (domainFamily === VizPortal.ServerApi.DomainFamily.ActiveDirectory) {\r\n                $scope.importAdUser = function () {\r\n                    // Note: The order here is important, because $scope.close() will destroy the scope.\r\n                    addActiveDirectoryUsersAction.showAddActiveDirectoryUsersToSiteDialog($scope.$parent);\r\n                    $scope.close({});\r\n                };\r\n                $scope.importAdGroup = function () {\r\n                    // Note: The order here is important, because $scope.close() will destroy the scope.\r\n                    activeDirectoryGroupAction.showAddAdGroupDialog($scope.$parent);\r\n                    $scope.close({});\r\n                };\r\n            }\r\n            if (domainFamily === VizPortal.ServerApi.DomainFamily.External) {\r\n                $scope.importExternalUser = function () {\r\n                    // Note: The order here is important, because $scope.close() will destroy the scope.\r\n                    addExternalUsersAction.showAddExternalUsersToSiteDialog($scope.$parent);\r\n                    $scope.close({});\r\n                };\r\n            }\r\n            $scope.importFromBulk = function () {\r\n                // Note: The order here is important, because $scope.close() will destroy the scope.\r\n                bulkImportUsersAction.showBulkImportSiteUsersDialog($scope.$parent);\r\n                $scope.close({});\r\n            };\r\n        }\r\n        AddSiteUsersOptionsDialogCtrl.$inject = [\r\n            '$scope',\r\n            'AddLocalUserAction',\r\n            'ActiveDirectoryGroupAction',\r\n            'AddActiveDirectoryUsersAction',\r\n            'AddExternalUsersAction',\r\n            'BulkImportUsersAction',\r\n            'domainFamily'];\r\n        return AddSiteUsersOptionsDialogCtrl;\r\n    })();\r\n    VizPortal.AddSiteUsersOptionsDialogCtrl = AddSiteUsersOptionsDialogCtrl;\r\n    var AddServerUsersOptionsDialogCtrl = (function () {\r\n        function AddServerUsersOptionsDialogCtrl($scope, addLocalUserAction, addActiveDirectoryUsersAction, bulkImportUsersAction, domainFamily) {\r\n            $scope.title = 'addUsersToServer';\r\n            if (domainFamily === VizPortal.ServerApi.DomainFamily.Local) {\r\n                $scope.addLocalUser = function () {\r\n                    // Note: The order here is important, because $scope.close() will destroy the scope.\r\n                    addLocalUserAction.showAddLocalUserDialogForServer($scope.$parent);\r\n                    $scope.close({});\r\n                };\r\n            }\r\n            if (domainFamily === VizPortal.ServerApi.DomainFamily.ActiveDirectory) {\r\n                $scope.importAdUser = function () {\r\n                    // Note: The order here is important, because $scope.close() will destroy the scope.\r\n                    addActiveDirectoryUsersAction.showAddActiveDirectoryUsersToServerDialog($scope.$parent);\r\n                    $scope.close({});\r\n                };\r\n            }\r\n            $scope.importFromBulk = function () {\r\n                // Note: The order here is important, because $scope.close() will destroy the scope.\r\n                bulkImportUsersAction.showBulkImportServerUsersDialog($scope.$parent);\r\n                $scope.close({});\r\n            };\r\n        }\r\n        AddServerUsersOptionsDialogCtrl.$inject = [\r\n            '$scope',\r\n            'AddLocalUserAction',\r\n            'AddActiveDirectoryUsersAction',\r\n            'BulkImportUsersAction',\r\n            'domainFamily'];\r\n        return AddServerUsersOptionsDialogCtrl;\r\n    })();\r\n    VizPortal.AddServerUsersOptionsDialogCtrl = AddServerUsersOptionsDialogCtrl;\r\n    VizPortal.Module.instance().controller('AddSiteUsersOptionsDialogCtrl', AddSiteUsersOptionsDialogCtrl);\r\n    VizPortal.Module.instance().controller('AddServerUsersOptionsDialogCtrl', AddServerUsersOptionsDialogCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../controllers/SiteMembershipDialogCtrl.ts\" />\r\n/// <reference path=\"../ServerApi/types/ISiteUser.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var EditSiteMembershipAction = (function () {\r\n        function EditSiteMembershipAction(modalService) {\r\n            this.modalService = modalService;\r\n        }\r\n        // TODO: use ConfimActionDialog\r\n        EditSiteMembershipAction.prototype.showEditSiteMembershipDialog = function (users, context) {\r\n            var scope = context.scope.$new(true);\r\n            scope.users = users;\r\n            var dialogInstance = this.modalService.open({\r\n                scope: scope,\r\n                templateUrl: 'siteMembershipDialog.html',\r\n                size: VizPortal.ModalSize.fitToContent,\r\n                controller: VizPortal.SiteMembershipDialogCtrl\r\n            });\r\n            return dialogInstance.result.fin(function () { return scope.$destroy(); });\r\n        };\r\n        EditSiteMembershipAction.$inject = ['ModalService'];\r\n        return EditSiteMembershipAction;\r\n    })();\r\n    VizPortal.EditSiteMembershipAction = EditSiteMembershipAction;\r\n    VizPortal.Module.instance().service('EditSiteMembershipAction', EditSiteMembershipAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/ActionHelpers.ts\" />\r\n/// <reference path=\"../services/EditSiteMembershipAction.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerUsersActions = (function () {\r\n        function ServerUsersActions(DeleteUsersFromServerAction, EditSiteMembershipAction, serverService) {\r\n            this.DeleteUsersFromServerAction = DeleteUsersFromServerAction;\r\n            this.EditSiteMembershipAction = EditSiteMembershipAction;\r\n            this.serverService = serverService;\r\n            this.serverUsersActionDefinition = [\r\n                this.editSiteMembershipAction(),\r\n                this.deleteUsersFromServerAction()\r\n            ];\r\n        }\r\n        // public API\r\n        ServerUsersActions.prototype.getServerUsersActionsButtons = function () {\r\n            return this.serverUsersActionDefinition;\r\n        };\r\n        // action button factory\r\n        ServerUsersActions.prototype.editSiteMembershipAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'siteMembership',\r\n                isAvailable: function (items) { return _this.canEditSiteMembership(items); },\r\n                execute: function (items, context) {\r\n                    var scope = context.scope;\r\n                    _this.EditSiteMembershipAction.showEditSiteMembershipDialog(items, context)\r\n                        .then(function (result) {\r\n                        if (result) {\r\n                            VizPortal.ActionHelpers.deselectNotFound(scope.selectedItems, result, VizPortal.CommonErrorCode.SystemUserNotFound);\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        ServerUsersActions.prototype.canEditSiteMembership = function (serverUsers) {\r\n            return (serverUsers.size() > 0) && !ServerUsersActions.isSingleSelectAndGuest(serverUsers);\r\n        };\r\n        ServerUsersActions.prototype.deleteUsersFromServerAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'delete',\r\n                isAvailable: function (items) { return _this.canDelete(items); },\r\n                execute: function (items, context) {\r\n                    var scope = context.scope;\r\n                    _this.DeleteUsersFromServerAction.showDeleteUsersFromServerDialog(items, context)\r\n                        .then(function (result) {\r\n                        if (result) {\r\n                            VizPortal.ActionHelpers.deselectAllExceptErrors(scope.selectedItems, result, VizPortal.CommonErrorCode.SystemUserNotFound);\r\n                            scope.refreshItems();\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        ServerUsersActions.prototype.canDelete = function (serverUsers) {\r\n            return (serverUsers.size() > 0) && !ServerUsersActions.isSingleSelectAndGuest(serverUsers);\r\n        };\r\n        ServerUsersActions.isSingleSelectAndGuest = function (serverUsers) {\r\n            return (serverUsers.size() === 1 && serverUsers.first().maxSiteRole === VizPortal.ServerApi.SiteRoles.Guest);\r\n        };\r\n        ServerUsersActions.$inject = [\r\n            'DeleteUsersFromServerAction',\r\n            'EditSiteMembershipAction',\r\n            'ServerService'];\r\n        return ServerUsersActions;\r\n    })();\r\n    VizPortal.ServerUsersActions = ServerUsersActions;\r\n    VizPortal.Module.instance().service('ServerUsersActions', ServerUsersActions);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../../app/content/ServerUsersGrid.ts\" />\r\n/// <reference path=\"../../common/react/components/dataGrid/AngularToReactDataGridBridge.ts\" />\r\n/// <reference path=\"../controllers/ContentPlaceCtrl.ts\" />\r\n/// <reference path=\"../controllers/FilterPanelCtrl.ts\" />\r\n/// <reference path=\"../helpers/ActionButtonsHelper.ts\" />\r\n/// <reference path=\"../helpers/SiteRoleFilterHelper.ts\" />\r\n/// <reference path=\"../models/ContentTypes.ts\" />\r\n/// <reference path=\"../models/ISliceable.ts\" />\r\n/// <reference path=\"../models/ITabsBannerModel.ts\" />\r\n/// <reference path=\"../models/ITemplate.ts\" />\r\n/// <reference path=\"../models/Set.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../resources/ServerUsers.ts\" />\r\n/// <reference path=\"../ServerApi/types/IServerUser.ts\" />\r\n/// <reference path=\"../services/AddUsersOptionsAction.ts\" />\r\n/// <reference path=\"../services/BrowserTitleService.ts\" />\r\n/// <reference path=\"../services/QueryService.ts\" />\r\n/// <reference path=\"../services/SelectionService.ts\" />\r\n/// <reference path=\"../services/ServerUsersActions.ts\" />\r\n/// <reference path=\"../services/SorterFactory.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerUsersPlaceCtrl = (function () {\r\n        function ServerUsersPlaceCtrl($scope, $translate, AngularToReactDataGridBridge, siteRoleFilter, addUsersOptionsAction, BrowserTitleService, queryService, selectionService, serverService, users, serverUsersActions, sorterFactory, filterPanelService) {\r\n            var _this = this;\r\n            this.$scope = $scope;\r\n            this.$translate = $translate;\r\n            this.AngularToReactDataGridBridge = AngularToReactDataGridBridge;\r\n            this.siteRoleFilter = siteRoleFilter;\r\n            this.serverService = serverService;\r\n            this.users = users;\r\n            var actions = serverUsersActions.getServerUsersActionsButtons();\r\n            if (VizPortal.FeatureFlags.reactServerUsersGrid) {\r\n                this.configureForReactDataGrid(actions);\r\n            }\r\n            BrowserTitleService.setTitle('serverUsers');\r\n            $scope.server = serverService;\r\n            $scope.selectedItems = new VizPortal.Set(function (user) { return user.id; });\r\n            $scope.availableAction = function (action) { return action.isAvailable($scope.selectedItems); };\r\n            VizPortal.ActionButtonsHelper.setupActionButtons($scope, actions);\r\n            $scope.listActions = [{\r\n                    name: 'add-users',\r\n                    translate: 'addUsers',\r\n                    isAvailable: function () { return true; },\r\n                    execute: function ($event) {\r\n                        addUsersOptionsAction.showAddServerUsersOptionsDialog(VizPortal.ActionContext.fromEvent($event));\r\n                    }\r\n                }];\r\n            $scope.availableListAction = function (listAction) { return listAction.isAvailable(); };\r\n            $scope.rowClicked = function (row, colIndex) {\r\n                selectionService.rowClicked($scope.selectedItems, row, colIndex);\r\n            };\r\n            $scope.filterControls = {};\r\n            $scope.filterDefinitions = filterPanelService.getFilterDefinitions(['maxSiteRole']);\r\n            this.maxSiteRoleFilterDefinition = $scope.filterDefinitions[0];\r\n            $scope.sorter = sorterFactory.create(VizPortal.ServerUserContentType.defaultOrder);\r\n            var queryUpdater = queryService.createQueryUpdater($scope, VizPortal.ServerUserContentType, users, function (resourceQuery) {\r\n                if (VizPortal.FeatureFlags.reactServerUsersGrid) {\r\n                    _this.AngularToReactDataGridBridge.updateReactDataGridRowStore({ scope: _this.$scope, sliceable: resourceQuery });\r\n                }\r\n                $scope.sliceable = resourceQuery;\r\n                $scope.sorter.setOrder(resourceQuery.getOrder());\r\n                _this.updateMaxSiteRoleCounts(resourceQuery);\r\n                resourceQuery.getCount().then(function (result) {\r\n                    _this.$scope.model.itemsCount = result;\r\n                });\r\n            }, {});\r\n            $scope.sliceChanged = function (newSlice) {\r\n                $scope.selectedItems.updateItems(newSlice.items);\r\n                $scope.model.itemsCount = newSlice.total;\r\n            };\r\n            $scope.refreshItems = function () {\r\n                queryUpdater.refresh();\r\n            };\r\n            $scope.refreshItems();\r\n            $scope.placeTitleClicked = function () {\r\n                $scope.refreshItems();\r\n            };\r\n            $scope.$on(VizPortal.UserAddedEvent, function () {\r\n                $scope.refreshItems();\r\n            });\r\n            $scope.$on(VizPortal.SiteRolesEvent.SiteRolesChanged, function () {\r\n                $scope.refreshItems();\r\n            });\r\n            $scope.headerClicked = function (header) { return $scope.sorter.setPrimary(header.attrs['key'], header.attrs['direction']); };\r\n            $scope.model = { itemsCount: 0 };\r\n            $scope.emptyTemplateModel = ServerUsersPlaceCtrl.emptyTemplateModel;\r\n        }\r\n        ServerUsersPlaceCtrl.prototype.configureForReactDataGrid = function (actions) {\r\n            var _this = this;\r\n            this.$scope.useReactDataGrid = true;\r\n            var columns = VizPortalReact.ServerUsersGrid.columns(function (id) { return _this.$translate.instant(id); }, this.$scope, new VizPortalReact.ServerUrls(window.location.search), this.siteRoleFilter, actions, this.serverService.isServerDomainFamilyActiveDirectory());\r\n            this.AngularToReactDataGridBridge.attachReactDataGridToScope(this.$scope, columns, ServerUsersPlaceCtrl.emptyTemplateModel);\r\n        };\r\n        ServerUsersPlaceCtrl.prototype.updateMaxSiteRoleCounts = function (baseQuery) {\r\n            var _this = this;\r\n            this.users.getUserCountsByMaxSiteRole(baseQuery).then(function (userCountsByRole) {\r\n                _this.maxSiteRoleFilterDefinition.options =\r\n                    VizPortal.SiteRoleFilterHelper.siteRoleOptions(VizPortal.SiteRoles.WithoutGuest, userCountsByRole);\r\n            });\r\n        };\r\n        ServerUsersPlaceCtrl.$inject = [\r\n            '$scope',\r\n            '$translate',\r\n            'AngularToReactDataGridBridge',\r\n            'siteRoleFilter',\r\n            'AddUsersOptionsAction',\r\n            'BrowserTitleService',\r\n            'QueryService',\r\n            'SelectionService',\r\n            'ServerService',\r\n            'ServerUsers',\r\n            'ServerUsersActions',\r\n            'SorterFactory',\r\n            'FilterPanelService'\r\n        ];\r\n        ServerUsersPlaceCtrl.emptyTemplateModel = { title: 'usersEmptyMessage' };\r\n        return ServerUsersPlaceCtrl;\r\n    })();\r\n    VizPortal.ServerUsersPlaceCtrl = ServerUsersPlaceCtrl;\r\n    VizPortal.Module.instance().controller('ServerUsersPlaceCtrl', ServerUsersPlaceCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerSettings = (function () {\r\n        function ServerSettings(server) {\r\n            this.server = server;\r\n        }\r\n        ServerSettings.prototype.fetch = function () {\r\n            return this.server.sendRequest(new VizPortal.ServerApi.GetServerSettingsRequest({}))\r\n                .then(function (result) { return result.serverSettings; });\r\n        };\r\n        ServerSettings.prototype.updateBoolean = function (setting, value) {\r\n            var request = new VizPortal.ServerApi.UpdateBooleanServerSettingRequest({\r\n                setting: setting,\r\n                value: value\r\n            });\r\n            return this.server.sendRequest(request);\r\n        };\r\n        ServerSettings.prototype.updateString = function (setting, value) {\r\n            var request = new VizPortal.ServerApi.UpdateStringServerSettingRequest({\r\n                setting: setting,\r\n                value: value\r\n            });\r\n            return this.server.sendRequest(request);\r\n        };\r\n        ServerSettings.prototype.updateScheduleFrequency = function (setting, value) {\r\n            var request = new VizPortal.ServerApi.UpdateScheduleFrequencyServerSettingRequest({\r\n                setting: setting,\r\n                value: value\r\n            });\r\n            return this.server.sendRequest(request);\r\n        };\r\n        ServerSettings.$inject = ['ServerService'];\r\n        return ServerSettings;\r\n    })();\r\n    VizPortal.ServerSettings = ServerSettings;\r\n    VizPortal.Module.instance().service('ServerSettings', ServerSettings);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var ClearConnectedDevicesRequest = (function (_super) {\r\n            __extends(ClearConnectedDevicesRequest, _super);\r\n            function ClearConnectedDevicesRequest(params) {\r\n                _super.call(this, 'deleteUserRefreshTokens', params);\r\n            }\r\n            return ClearConnectedDevicesRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.ClearConnectedDevicesRequest = ClearConnectedDevicesRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/ClearConnectedDevicesRequest.ts\" />\r\n/// <reference path=\"../services/ConfirmActionDialog.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\n/// <reference path=\"../services/ToasterService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ClearConnectedDevicesAction = (function () {\r\n        function ClearConnectedDevicesAction($translate, $q, ConfirmActionDialog, serverService, ToasterService) {\r\n            this.$translate = $translate;\r\n            this.$q = $q;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.serverService = serverService;\r\n            this.ToasterService = ToasterService;\r\n        }\r\n        ClearConnectedDevicesAction.prototype.showConfirmationDialog = function (userId, userRefreshTokenCount) {\r\n            var _this = this;\r\n            var confirmActionDialogInstance = this.ConfirmActionDialog.open({\r\n                title: this.$translate.instant('clearConnectedDevices'),\r\n                bodyText: this.$translate.instant('clearConnectedDevicesConfirmMessage', { TOKEN_COUNT: userRefreshTokenCount }, VizPortal.L10n.Interpolations.Count),\r\n                actionName: this.$translate.instant('clearConnectedDevicesConfirmButton'),\r\n                isDeleteAction: true,\r\n                action: function (confirmActionDialogInstance) {\r\n                    var ClearConnectedDevicesParams = {\r\n                        userId: userId\r\n                    };\r\n                    return _this.serverService.sendRequest(new VizPortal.ServerApi.ClearConnectedDevicesRequest(ClearConnectedDevicesParams))\r\n                        .then(VizPortal.ResultHelper.rejectResultOnError(_this.$q))\r\n                        .then(_.identity, function () { return confirmActionDialogInstance.showErrorMessage(_this.$translate.instant('clearConnectedDevicesError')); });\r\n                }\r\n            });\r\n            confirmActionDialogInstance.result.then(function (result) {\r\n                _this.ToasterService.pop({ type: VizPortal.ToastType.Info, text: _this.$translate.instant('clearConnectedDevicesSuccess') });\r\n            });\r\n            return confirmActionDialogInstance.result;\r\n        };\r\n        ClearConnectedDevicesAction.$inject = ['$translate', '$q', 'ConfirmActionDialog', 'ServerService', 'ToasterService'];\r\n        return ClearConnectedDevicesAction;\r\n    })();\r\n    VizPortal.ClearConnectedDevicesAction = ClearConnectedDevicesAction;\r\n    VizPortal.Module.instance().service('ClearConnectedDevicesAction', ClearConnectedDevicesAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var ChangeUserPasswordRequest = (function (_super) {\r\n            __extends(ChangeUserPasswordRequest, _super);\r\n            function ChangeUserPasswordRequest(params) {\r\n                _super.call(this, 'changeUserPassword', params);\r\n            }\r\n            return ChangeUserPasswordRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.ChangeUserPasswordRequest = ChangeUserPasswordRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var UpdateUserEmailRequest = (function (_super) {\r\n            __extends(UpdateUserEmailRequest, _super);\r\n            function UpdateUserEmailRequest(params) {\r\n                _super.call(this, 'updateUserEmail', params);\r\n            }\r\n            return UpdateUserEmailRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.UpdateUserEmailRequest = UpdateUserEmailRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var UpdateUserDisplayNameRequest = (function (_super) {\r\n            __extends(UpdateUserDisplayNameRequest, _super);\r\n            function UpdateUserDisplayNameRequest(params) {\r\n                _super.call(this, 'updateUserDisplayName', params);\r\n            }\r\n            return UpdateUserDisplayNameRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.UpdateUserDisplayNameRequest = UpdateUserDisplayNameRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var UpdateUserLanguageRequest = (function (_super) {\r\n            __extends(UpdateUserLanguageRequest, _super);\r\n            function UpdateUserLanguageRequest(params) {\r\n                _super.call(this, 'updateUserLanguage', params);\r\n            }\r\n            return UpdateUserLanguageRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.UpdateUserLanguageRequest = UpdateUserLanguageRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var UpdateUserLocaleRequest = (function (_super) {\r\n            __extends(UpdateUserLocaleRequest, _super);\r\n            function UpdateUserLocaleRequest(params) {\r\n                _super.call(this, 'updateUserLocale', params);\r\n            }\r\n            return UpdateUserLocaleRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.UpdateUserLocaleRequest = UpdateUserLocaleRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var UpdateUserStartPageRequest = (function (_super) {\r\n            __extends(UpdateUserStartPageRequest, _super);\r\n            function UpdateUserStartPageRequest(params) {\r\n                _super.call(this, 'updateUserStartPage', params);\r\n            }\r\n            return UpdateUserStartPageRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.UpdateUserStartPageRequest = UpdateUserStartPageRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\n/// <reference path=\"../ServerApi/requests/ChangeUserPasswordRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/UpdateUserEmailRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/UpdateUserDisplayNameRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/UpdateUserLanguageRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/UpdateUserLocaleRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/UpdateUserStartPageRequest.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var UserSettings = (function () {\r\n        function UserSettings(ErrorNotifyingServer) {\r\n            this.ErrorNotifyingServer = ErrorNotifyingServer;\r\n            this.server = ErrorNotifyingServer.getServerService();\r\n        }\r\n        UserSettings.prototype.updateUserDisplayName = function (userId, displayName) {\r\n            var params = {\r\n                userId: userId,\r\n                displayName: displayName\r\n            };\r\n            return this.ErrorNotifyingServer.sendRequestAndDelay(new VizPortal.ServerApi.UpdateUserDisplayNameRequest(params));\r\n        };\r\n        UserSettings.prototype.updateUserEmail = function (userId, email) {\r\n            var params = {\r\n                userId: userId,\r\n                email: email\r\n            };\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.UpdateUserEmailRequest(params));\r\n        };\r\n        UserSettings.prototype.updateUserEmailAndDelay = function (userId, email) {\r\n            var params = {\r\n                userId: userId,\r\n                email: email\r\n            };\r\n            return this.ErrorNotifyingServer.sendRequestAndDelay(new VizPortal.ServerApi.UpdateUserEmailRequest(params));\r\n        };\r\n        UserSettings.prototype.updateUserLanguage = function (userId, language) {\r\n            var params = {\r\n                userId: userId,\r\n                language: language\r\n            };\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.UpdateUserLanguageRequest(params));\r\n        };\r\n        UserSettings.prototype.updateUserLocale = function (userId, locale) {\r\n            var params = {\r\n                userId: userId,\r\n                locale: locale\r\n            };\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.UpdateUserLocaleRequest(params));\r\n        };\r\n        UserSettings.prototype.updateUserStartPage = function (userId, startPage) {\r\n            var params = {\r\n                startPage: startPage\r\n            };\r\n            if (userId !== UserSettings.SameUserId) {\r\n                params.userId = userId;\r\n            }\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.UpdateUserStartPageRequest(params));\r\n        };\r\n        UserSettings.prototype.updateCurrentUsersStartPage = function (startPage) {\r\n            var params = {\r\n                startPage: startPage\r\n            };\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.UpdateUserStartPageRequest(params));\r\n        };\r\n        UserSettings.prototype.resetUserStartPage = function (userId) {\r\n            return this.updateUserStartPage(userId, UserSettings.ResetStartPage);\r\n        };\r\n        UserSettings.prototype.changeUserPassword = function (userId, newPassword, oldPassword) {\r\n            var _this = this;\r\n            return this.server.sendRequest(new VizPortal.ServerApi.GeneratePublicKeyRequest()).\r\n                then(function (generatePublicKeyResult) {\r\n                var key = generatePublicKeyResult.key;\r\n                var keyId = generatePublicKeyResult.keyId;\r\n                // server admin does not need to enter old password to change a user's password\r\n                var oldEncryptedPassword;\r\n                if (oldPassword && oldPassword.length > 0) {\r\n                    oldEncryptedPassword = rsa.encrypt(oldPassword, key);\r\n                }\r\n                var newEncryptedPassword = rsa.encrypt(newPassword, key);\r\n                var changePasswordRequest = new VizPortal.ServerApi.ChangeUserPasswordRequest({\r\n                    userId: userId,\r\n                    oldEncryptedPassword: oldEncryptedPassword,\r\n                    newEncryptedPassword: newEncryptedPassword,\r\n                    keyId: keyId\r\n                });\r\n                return _this.ErrorNotifyingServer.sendRequest(changePasswordRequest);\r\n            });\r\n        };\r\n        UserSettings.$inject = ['ErrorNotifyingServer'];\r\n        // Const\r\n        UserSettings.ResetStartPage = 'unspecified';\r\n        // Note: This is used as sentinel value. It should not be mutated.\r\n        UserSettings.SameUserId = null;\r\n        return UserSettings;\r\n    })();\r\n    VizPortal.UserSettings = UserSettings;\r\n    VizPortal.Module.instance().service('UserSettings', UserSettings);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../../common/react/Dispatcher.ts\" />\r\n/// <reference path=\"../models/IUserInfo.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/types/IResponse.ts\" />\r\n/// <reference path=\"../resources/UserSettings.ts\" />\r\n/// <reference path=\"../services/ConfirmActionDialog.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\n/// <reference path=\"../services/StartPageService.ts\" />\r\n/// <reference path=\"../services/ToasterService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var UserSettingsActions = (function () {\r\n        function UserSettingsActions($translate, toaster, userSettings, confirmActionDialog, startPageService, server) {\r\n            this.$translate = $translate;\r\n            this.toaster = toaster;\r\n            this.userSettings = userSettings;\r\n            this.confirmActionDialog = confirmActionDialog;\r\n            this.startPageService = startPageService;\r\n            this.server = server;\r\n        }\r\n        UserSettingsActions.prototype.updateStartPage = function (userInfo, startPage) {\r\n            var _this = this;\r\n            // TODO: error handling for this action is still handled by callers. Fix that. Then there will be no need to return this promise.\r\n            return this.userSettings.updateUserStartPage(userInfo.id, startPage)\r\n                .then(function (result) {\r\n                if (result && !result.errors) {\r\n                    _this.toaster.pop({ type: VizPortal.ToastType.Info, text: _this.$translate.instant('userStartPageSuccess') });\r\n                    _this.fetchUserSettings(userInfo.username, userInfo.domainName);\r\n                }\r\n                return result;\r\n            });\r\n        };\r\n        UserSettingsActions.prototype.confirmChangeUserStartPage = function () {\r\n            var _this = this;\r\n            this.confirmActionDialog.open({\r\n                title: this.$translate.instant('userStartPageChange'),\r\n                bodyText: this.$translate.instant('userStartPageConfirm'),\r\n                actionName: this.$translate.instant('userStartPageButton'),\r\n                action: function (dialogInstance) {\r\n                    return _this.updateCurrentUsersStartPage(_this.startPageService.getCurrentUrlAsStartPage())\r\n                        .then(function (result) {\r\n                        if (!result || result.errors) {\r\n                            dialogInstance.showErrorMessage(_this.$translate.instant('userStartPageError'));\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        };\r\n        UserSettingsActions.prototype.confirmChangeDefaultStartPage = function () {\r\n            var _this = this;\r\n            this.confirmActionDialog.open({\r\n                title: this.$translate.instant('defaultStartPageChange'),\r\n                bodyText: this.$translate.instant('defaultStartPageConfirm'),\r\n                actionName: this.$translate.instant('defaultStartPageButton'),\r\n                action: function (dialogInstance) {\r\n                    return _this.server.sendRequest(new VizPortal.ServerApi.UpdateStringServerSettingRequest({\r\n                        setting: 'defaultStartPage',\r\n                        value: _this.startPageService.getCurrentUrlAsStartPage()\r\n                    })).then(function (result) {\r\n                        if (!result || result.errors) {\r\n                            dialogInstance.showErrorMessage(_this.$translate.instant('defaultStartPageError'));\r\n                        }\r\n                        else {\r\n                            _this.server.refreshSessionInfo().then(function () {\r\n                                _this.toaster.pop({ type: VizPortal.ToastType.Info, text: _this.$translate.instant('defaultStartPageSuccess') });\r\n                            });\r\n                        }\r\n                    });\r\n                }\r\n            });\r\n        };\r\n        UserSettingsActions.prototype.updateCurrentUsersStartPage = function (startPage) {\r\n            var _this = this;\r\n            // TODO: error handling for this action is still handled by callers. Fix that. Then there will be no need to return this promise.\r\n            return this.userSettings.updateCurrentUsersStartPage(startPage)\r\n                .then(function (result) {\r\n                if (result && !result.errors) {\r\n                    _this.toaster.pop({ type: VizPortal.ToastType.Info, text: _this.$translate.instant('userStartPageSuccess') });\r\n                    _this.fetchCurrentUsersUserSettings();\r\n                }\r\n                return result;\r\n            });\r\n        };\r\n        UserSettingsActions.prototype.resetStartPage = function (user) {\r\n            var _this = this;\r\n            // TODO: error handling for this action is still handled by callers. Fix that. Then there will be no need to return this promise.\r\n            return this.userSettings.resetUserStartPage(user.id).then(function (result) {\r\n                if (result && !result.errors) {\r\n                    _this.toaster.pop({ type: VizPortal.ToastType.Info, text: _this.$translate.instant('resetStartPageSuccess') });\r\n                    _this.fetchUserSettings(user.username, user.domainName);\r\n                }\r\n                return result;\r\n            });\r\n        };\r\n        UserSettingsActions.prototype.fetchUserSettings = function (username, domain) {\r\n            VizPortalReact.Dispatcher.instance.dispatch({\r\n                actionType: UserSettingsActions.FetchUserSettingsActionType,\r\n                username: username,\r\n                domain: domain\r\n            });\r\n        };\r\n        UserSettingsActions.prototype.fetchCurrentUsersUserSettings = function () {\r\n            VizPortalReact.Dispatcher.instance.dispatch({\r\n                actionType: UserSettingsActions.FetchUserSettingsActionType,\r\n                username: this.server.sessionUsername(),\r\n                domain: this.server.sessionUserDomainName()\r\n            });\r\n        };\r\n        UserSettingsActions.FetchUserSettingsActionType = 'fetch-user-settings';\r\n        UserSettingsActions.$inject = ['$translate', 'ToasterService', 'UserSettings', 'ConfirmActionDialog', 'StartPageService', 'ServerService'];\r\n        return UserSettingsActions;\r\n    })();\r\n    VizPortal.UserSettingsActions = UserSettingsActions;\r\n    VizPortal.Module.instance().service('UserSettingsActions', UserSettingsActions);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../../common/react/Dispatcher.ts\" />\r\n/// <reference path=\"../../common/react/Store.ts\" />\r\n/// <reference path=\"../actions/UserSettingsActions.ts\" />\r\n/// <reference path=\"../models/IUserSettings.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../resources/ServerUsers.ts\" />\r\n/// <reference path=\"../resources/UserSettings.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    /**\r\n     * Store to interact with user settings. At this time, most part of the application still depend on\r\n     * {@link VizPortal.UserSettings}.\r\n     *\r\n     * NOTE:  The long term goal is that the store should be the only one interacting with that service.\r\n     *        Other components would simply listen for the 'user-settings-change' event and take action accordingly.\r\n     */\r\n    var UserSettingsStore = (function (_super) {\r\n        __extends(UserSettingsStore, _super);\r\n        function UserSettingsStore($q, serverService, serverUsers, userSettings) {\r\n            _super.call(this);\r\n            this.$q = $q;\r\n            this.serverService = serverService;\r\n            this.serverUsers = serverUsers;\r\n            this.userSettings = userSettings;\r\n            VizPortalReact.Dispatcher.instance.register(this.handleAction.bind(this));\r\n        }\r\n        UserSettingsStore.prototype.getUserSettings = function (username, domain) {\r\n            return this.fetchUserSettings(username, domain);\r\n        };\r\n        UserSettingsStore.prototype.fetchUserSettings = function (username, domain) {\r\n            var _this = this;\r\n            return this.serverUsers.getUserSettings(username, domain)\r\n                .then(function (userSettings) {\r\n                _this.maybeRefreshSessionInfo(username, domain);\r\n                _this.broadcast(UserSettingsStore.ChangeEvent, {\r\n                    username: username,\r\n                    domain: domain,\r\n                    userSettings: userSettings\r\n                });\r\n                return userSettings;\r\n            });\r\n        };\r\n        UserSettingsStore.prototype.handleAction = function (action) {\r\n            switch (action.actionType) {\r\n                case VizPortal.UserSettingsActions.FetchUserSettingsActionType:\r\n                    this.fetchUserSettings(action.username, action.domain);\r\n                    break;\r\n            }\r\n        };\r\n        // TODO: this logic should ultimately live in the SessionInfoStore.\r\n        // ServerService itself can't listen for 'user-settings-changed' because that would\r\n        // cause a circular dependency between ServerService and UserSettingsStore.\r\n        UserSettingsStore.prototype.maybeRefreshSessionInfo = function (username, domain) {\r\n            if (username === this.serverService.sessionUsername() && domain === this.serverService.sessionUserDomainName()) {\r\n                this.serverService.refreshSessionInfo();\r\n            }\r\n        };\r\n        UserSettingsStore.ChangeEvent = 'user-settings-changed';\r\n        UserSettingsStore.$inject = [\r\n            '$q',\r\n            'ServerService',\r\n            'ServerUsers',\r\n            'UserSettings'\r\n        ];\r\n        return UserSettingsStore;\r\n    })(VizPortalReact.Store);\r\n    VizPortal.UserSettingsStore = UserSettingsStore;\r\n    VizPortal.Module.instance().service('UserSettingsStore', UserSettingsStore);\r\n    VizPortal.Module.registerEagerService('UserSettingsStore');\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../models/IServerUserInfo.ts\" />\r\n/// <reference path=\"../models/ISiteUserInfo.ts\" />\r\n/// <reference path=\"../models/IUserSettings.ts\" />\r\n/// <reference path=\"../resources/ServerSettings.ts\" />\r\n/// <reference path=\"../ServerApi/types/IEditableServerSettings.ts\" />\r\n/// <reference path=\"../ServerApi/types/ISiteUser.ts\" />\r\n/// <reference path=\"../services/ClearConnectedDevicesAction.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\n/// <reference path=\"../services/StartPageService.ts\" />\r\n/// <reference path=\"../stores/UserSettingsStore.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var UserSettingsCtrlCommon = (function () {\r\n        function UserSettingsCtrlCommon($q, $state, $translate, clearConnectedDevicesAction, serverService, startPageService, serverSettings, userSettingsStore) {\r\n            this.$q = $q;\r\n            this.$state = $state;\r\n            this.$translate = $translate;\r\n            this.clearConnectedDevicesAction = clearConnectedDevicesAction;\r\n            this.serverService = serverService;\r\n            this.startPageService = startPageService;\r\n            this.serverSettings = serverSettings;\r\n            this.userSettingsStore = userSettingsStore;\r\n        }\r\n        UserSettingsCtrlCommon.prototype.initScope = function (scope, isViewerSelf, serverUser, siteUser, userSettings, userRefreshTokenCount) {\r\n            var _this = this;\r\n            this.scope = scope;\r\n            // setup change listener for user settings\r\n            this.setupUserSettingsChangeListener();\r\n            scope.isDomainFamilyAD = this.serverService.isServerDomainFamilyActiveDirectory();\r\n            scope.isDomainFamilyExternal = this.serverService.isServerDomainFamilyExternal();\r\n            scope.isDomainFamilyLocal = this.serverService.isServerDomainFamilyLocal();\r\n            scope.isViewerSelf = isViewerSelf;\r\n            scope.isViewerServerAdmin = this.serverService.isSessionServerAdmin();\r\n            scope.changePasswordUrl = this.serverService.changePasswordUrl(); // might be undefined\r\n            scope.updateDisplayNameAllowed = this.serverService.updateDisplayNameAllowed();\r\n            scope.controls = {\r\n                editDisplayNameControls: null,\r\n                editEmailControls: null\r\n            };\r\n            scope.userSettings = userSettings;\r\n            scope.serverUser = serverUser;\r\n            // section: username, display name, email\r\n            scope.disableNameAndEmailSaveButton = function () {\r\n                var displayCtrl = scope.controls.editDisplayNameControls;\r\n                var emailCtrl = scope.controls.editEmailControls;\r\n                // if neither exists, disable\r\n                if (!displayCtrl && !emailCtrl) {\r\n                    return true;\r\n                }\r\n                // if any controls is busy, disable\r\n                if (displayCtrl && displayCtrl.isBusy()) {\r\n                    return true;\r\n                }\r\n                if (emailCtrl && emailCtrl.isBusy()) {\r\n                    return true;\r\n                }\r\n                // if no control is dirty, disable\r\n                if (!emailCtrl && displayCtrl && !displayCtrl.isDirty()) {\r\n                    return true;\r\n                }\r\n                if (!displayCtrl && emailCtrl && !emailCtrl.isDirty()) {\r\n                    return true;\r\n                }\r\n                if (displayCtrl && !displayCtrl.isDirty() && emailCtrl && !emailCtrl.isDirty()) {\r\n                    return true;\r\n                }\r\n                // if any control is dirty but invalid, disable\r\n                if (displayCtrl && displayCtrl.isDirty() && !displayCtrl.isValid()) {\r\n                    return true;\r\n                }\r\n                if (emailCtrl && emailCtrl.isDirty() && !emailCtrl.isValid()) {\r\n                    return true;\r\n                }\r\n                // no reason to disable the button\r\n                return false;\r\n            };\r\n            scope.saveChangesToEmailAndDisplayName = function () {\r\n                var displayCtrl = scope.controls.editDisplayNameControls;\r\n                var emailCtrl = scope.controls.editEmailControls;\r\n                // When the site user auth setting is SAML, the username is the email address\r\n                var userNameIsSameAsEmail = !!siteUser && siteUser.authSetting === VizPortal.ServerApi.SiteUserAuthSetting.Saml;\r\n                var displayPromise = _this.$q.when({});\r\n                if (displayCtrl && displayCtrl.isDirty()) {\r\n                    displayPromise = displayCtrl.submit(serverUser.id, serverUser.username);\r\n                }\r\n                var emailPromise = _this.$q.when({});\r\n                if (emailCtrl && emailCtrl.isDirty()) {\r\n                    emailPromise = emailCtrl.submit(serverUser.id, serverUser.username);\r\n                    // If username is tied to email address, update the username in the application state to allow proper page\r\n                    // refresh/reload\r\n                    if (userNameIsSameAsEmail) {\r\n                        emailPromise = emailPromise.then(function (result) {\r\n                            _this.$state.params['username'] = result;\r\n                        });\r\n                    }\r\n                }\r\n                // reload state once display name and email update requests are done\r\n                _this.$q.all([displayPromise, emailPromise]).then(function () { return _this.$state.hardReload(); });\r\n            };\r\n            // TODO: most of this logic should be encapsulated elsewhere, like in the StartPageService\r\n            scope.updateUserStartPage = function (startPage) {\r\n                // Show server default start page if not set by user\r\n                if (!startPage) {\r\n                    if (scope.isViewerServerAdmin) {\r\n                        _this.serverSettings.fetch().then(function (serverSettings) {\r\n                            var serverDefaultStartPage = serverSettings.defaultStartPage || '/';\r\n                            scope.updateUserStartPage(serverDefaultStartPage);\r\n                        });\r\n                        return;\r\n                    }\r\n                    else {\r\n                        // Start page from sessionInfo\r\n                        startPage = _this.serverService.getStartPage();\r\n                    }\r\n                }\r\n                var currentSiteUrlName = _this.serverService.sessionSiteUrlName();\r\n                scope.startPageText = startPage;\r\n                scope.startPageHref = _this.startPageService.getStartPageForSite(startPage, currentSiteUrlName);\r\n            };\r\n            scope.updateUserStartPage(scope.userSettings.startPage);\r\n            // Connected Devices\r\n            scope.clearConnectedDevices = function () {\r\n                return _this.clearConnectedDevicesAction.showConfirmationDialog(serverUser.id, userRefreshTokenCount);\r\n            };\r\n        };\r\n        UserSettingsCtrlCommon.prototype.updateUserSettingsOnScope = function (userSettings) {\r\n            this.scope.userSettings = userSettings;\r\n            this.scope.updateUserStartPage(userSettings.startPage);\r\n        };\r\n        UserSettingsCtrlCommon.prototype.isSameUser = function (userSettingsChange) {\r\n            var username = userSettingsChange.username;\r\n            var domain = userSettingsChange.domain;\r\n            return this.scope.serverUser.username === username\r\n                && this.scope.serverUser.domainName === domain;\r\n        };\r\n        UserSettingsCtrlCommon.prototype.setupUserSettingsChangeListener = function () {\r\n            var _this = this;\r\n            var onUserSettingsChanged = function (changeEvent, userSettingsChange) {\r\n                if (changeEvent === VizPortal.UserSettingsStore.ChangeEvent && _this.isSameUser(userSettingsChange)) {\r\n                    _this.updateUserSettingsOnScope(userSettingsChange.userSettings);\r\n                }\r\n            };\r\n            this.userSettingsStore.addChangeListener(onUserSettingsChanged);\r\n            this.scope.$on('$destroy', function () {\r\n                _this.userSettingsStore.removeChangeListener(onUserSettingsChanged);\r\n            });\r\n        };\r\n        UserSettingsCtrlCommon.$inject = [\r\n            '$q',\r\n            '$state',\r\n            '$translate',\r\n            'ClearConnectedDevicesAction',\r\n            'ServerService',\r\n            'StartPageService',\r\n            'ServerSettings',\r\n            'UserSettingsStore'];\r\n        return UserSettingsCtrlCommon;\r\n    })();\r\n    VizPortal.UserSettingsCtrlCommon = UserSettingsCtrlCommon;\r\n    VizPortal.Module.instance().service('UserSettingsCtrlCommon', UserSettingsCtrlCommon);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/IServerUserInfo.ts\" />\r\n/// <reference path=\"../models/ISiteUserInfo.ts\" />\r\n/// <reference path=\"../models/IUserSettings.ts\" />\r\n/// <reference path=\"../services/BrowserTitleService.ts\" />\r\n/// <reference path=\"../services/UserSettingsCtrlCommon.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerUserSettingsSubplaceCtrl = (function () {\r\n        function ServerUserSettingsSubplaceCtrl($scope, BrowserTitleService, userSettingsCtrlCommon, isSessionUserSelf, userSettings, userRefreshTokenCount, serverUser) {\r\n            this.$scope = $scope;\r\n            this.userSettingsCtrlCommon = userSettingsCtrlCommon;\r\n            BrowserTitleService.setTitle('serverSettings', serverUser.displayName);\r\n            userSettingsCtrlCommon.initScope($scope, isSessionUserSelf, serverUser, null, userSettings, userRefreshTokenCount);\r\n        }\r\n        ServerUserSettingsSubplaceCtrl.$inject = [\r\n            '$scope',\r\n            'BrowserTitleService',\r\n            'UserSettingsCtrlCommon',\r\n            // resolved in state router\r\n            'isSessionUserSelf',\r\n            'userSettings',\r\n            'userRefreshTokenCount',\r\n            'serverUser'\r\n        ];\r\n        return ServerUserSettingsSubplaceCtrl;\r\n    })();\r\n    VizPortal.ServerUserSettingsSubplaceCtrl = ServerUserSettingsSubplaceCtrl;\r\n    VizPortal.Module.instance().controller('ServerUserSettingsSubplaceCtrl', ServerUserSettingsSubplaceCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../services/BrowserTitleService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    function setBrowserTitleCtrl(place) {\r\n        return [\r\n            '$scope',\r\n            'BrowserTitleService',\r\n            function ($scope, BrowserTitleService) {\r\n                BrowserTitleService.setTitle(place, $scope.objectName);\r\n            }\r\n        ];\r\n    }\r\n    VizPortal.setBrowserTitleCtrl = setBrowserTitleCtrl;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\n/// <reference path=\"../services/ExternalAuthService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SignedOutCtrl = (function () {\r\n        function SignedOutCtrl($scope, $state, externalAuthService, server) {\r\n            $scope.tryAgainLink = server.isAuthenticationExternal() ? externalAuthService.getLoginUrl() : $state.href('login.authenticate');\r\n        }\r\n        SignedOutCtrl.$inject = [\r\n            '$scope',\r\n            '$state',\r\n            'ExternalAuthService',\r\n            'ServerService'\r\n        ];\r\n        return SignedOutCtrl;\r\n    })();\r\n    VizPortal.SignedOutCtrl = SignedOutCtrl;\r\n    VizPortal.Module.instance().controller('SignedOutCtrl', SignedOutCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var LinkTargetAttributes = (function () {\r\n        function LinkTargetAttributes() {\r\n        }\r\n        LinkTargetAttributes.Blank = '_blank';\r\n        LinkTargetAttributes.Self = '_self';\r\n        LinkTargetAttributes.Parent = '_parent';\r\n        LinkTargetAttributes.Top = '_top';\r\n        return LinkTargetAttributes;\r\n    })();\r\n    VizPortal.LinkTargetAttributes = LinkTargetAttributes;\r\n    // Linkify a loc string. Use ng-bind-html. Samples:\r\n    //\r\n    // Jade where linkifyMe is an ILocLinkifierModel on the scope.\r\n    // span(ng-bind-html=\"linkifyMe | locLinkifier\")\r\n    //\r\n    // Input without any links.\r\n    //{\r\n    //  localizedStatement: 'Literal string without any links.',\r\n    //}\r\n    //\r\n    // Linkify an entire statement. Localized statement and link key for the one link is undefined.\r\n    //{\r\n    //  links: [{\r\n    //    localizedValueKey: 'linkLocKey',\r\n    //    url: 'http://www.abc.com'\r\n    //  }]\r\n    //}\r\n    //\r\n    // Input with two links.\r\n    //{\r\n    //  localizedStatementKey: 'locKeyForStringWithTwoLinks'\r\n    //  links: [\r\n    //    {\r\n    //      key: '{LINK_A_TOKEN}',\r\n    //      localizedValueKey: 'linkALocKey',\r\n    //      url: 'http://www.a.com'\r\n    //    },{\r\n    //      key: '{LINK_B_TOKEN}',\r\n    //      localizedValue: 'Link b literal string.',\r\n    //      url: 'http://www.b.com'\r\n    //    }\r\n    //  ]\r\n    //}\r\n    VizPortal.Module.instance().filter('locLinkifier', [\r\n        '$translate',\r\n        function ($translate) {\r\n            return function (model) {\r\n                var buildInterpolationValuesFn = function (links) {\r\n                    var result = {};\r\n                    for (var i = 0; i < links.length; i++) {\r\n                        // remove the wrapping braces\r\n                        var key = links[i].key;\r\n                        var prop = key.substring(1, key.length - 1);\r\n                        result[prop] = links[i].key;\r\n                    }\r\n                    return result;\r\n                };\r\n                var linkifyFn = function (value, url, target) {\r\n                    target = target || LinkTargetAttributes.Blank;\r\n                    return '<a href=\"' + url + '\" target=\"' + target + '\">' + value + '</a>';\r\n                };\r\n                // If localized statement is empty/null the entire value is linkified. Assumes there is one link available.\r\n                if (!model.localizedStatement && !model.localizedStatementKey) {\r\n                    var link = model.links[0];\r\n                    var value = link.localizedValue || $translate.instant(link.localizedValueKey);\r\n                    return linkifyFn(value, link.url, link.target);\r\n                }\r\n                // Otherwise, replace all link keys with linkified values.\r\n                var result = '';\r\n                if (!model.links) {\r\n                    result = model.localizedStatement || $translate.instant(model.localizedStatementKey);\r\n                }\r\n                else {\r\n                    result = model.localizedStatement || $translate.instant(model.localizedStatementKey, buildInterpolationValuesFn(model.links));\r\n                    for (var i = 0; i < model.links.length; i++) {\r\n                        var link = model.links[i];\r\n                        var value = link.localizedValue || $translate.instant(link.localizedValueKey);\r\n                        result = result.replace(link.key, linkifyFn(value, link.url, link.target));\r\n                    }\r\n                }\r\n                return result;\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.CookieKeys = {\r\n        XsrfToken: 'XSRF-TOKEN'\r\n    };\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"resourceParts.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/ISiteSAMLConfiguration.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetSiteSAMLConfigurationRequest = (function (_super) {\r\n            __extends(GetSiteSAMLConfigurationRequest, _super);\r\n            function GetSiteSAMLConfigurationRequest() {\r\n                _super.call(this, 'getSiteSAMLConfiguration', null);\r\n            }\r\n            return GetSiteSAMLConfigurationRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetSiteSAMLConfigurationRequest = GetSiteSAMLConfigurationRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/ISiteSAMLConfiguration.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var SetSiteSAMLEnabledRequest = (function (_super) {\r\n            __extends(SetSiteSAMLEnabledRequest, _super);\r\n            function SetSiteSAMLEnabledRequest(params) {\r\n                _super.call(this, 'setSiteSAMLEnabled', params);\r\n            }\r\n            return SetSiteSAMLEnabledRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.SetSiteSAMLEnabledRequest = SetSiteSAMLEnabledRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/ISiteSAMLConfiguration.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var RemoveIdentityProviderRequest = (function (_super) {\r\n            __extends(RemoveIdentityProviderRequest, _super);\r\n            function RemoveIdentityProviderRequest() {\r\n                _super.call(this, 'removeIdentityProvider', {});\r\n            }\r\n            return RemoveIdentityProviderRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.RemoveIdentityProviderRequest = RemoveIdentityProviderRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/ISiteSAMLConfiguration.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var SetSiteAttributeMappingRequest = (function (_super) {\r\n            __extends(SetSiteAttributeMappingRequest, _super);\r\n            function SetSiteAttributeMappingRequest(mapping) {\r\n                _super.call(this, 'setSiteAttributeMapping', mapping);\r\n            }\r\n            return SetSiteAttributeMappingRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.SetSiteAttributeMappingRequest = SetSiteAttributeMappingRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var UpdateSiteSettingsForSiteAdminRequest = (function (_super) {\r\n            __extends(UpdateSiteSettingsForSiteAdminRequest, _super);\r\n            function UpdateSiteSettingsForSiteAdminRequest(params) {\r\n                _super.call(this, 'updateSiteSettingsForSiteAdmin', params);\r\n            }\r\n            return UpdateSiteSettingsForSiteAdminRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.UpdateSiteSettingsForSiteAdminRequest = UpdateSiteSettingsForSiteAdminRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../filters/LocLinkifierFilter.ts\" />\r\n/// <reference path=\"../helpers/ActionContext.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\n/// <reference path=\"../models/IVizPortalCookies.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetSiteSAMLConfigurationRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/SetSiteSAMLEnabledRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/RemoveIdentityProviderRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/SetSiteAttributeMapping.ts\" />\r\n/// <reference path=\"../ServerApi/requests/UpdateSiteSettingsForSiteAdminRequest.ts\" />\r\n/// <reference path=\"../services/AddUsersOptionsAction.ts\" />\r\n/// <reference path=\"../services/WindowLocationService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SiteAuthenticationCtrl = (function () {\r\n        function SiteAuthenticationCtrl($scope, $translate, $cookies, windowLocation, server, configuration, siteSettingsForSiteAdmin, toaster, addUsersOptionsAction, restApiPrefix) {\r\n            $scope.siteSettingsForSiteAdmin = siteSettingsForSiteAdmin;\r\n            $scope.$watch('siteSettingsForSiteAdmin.siteAdminSettings.refreshTokenEnabled', function (newVal, oldVal) {\r\n                if (newVal !== oldVal) {\r\n                    server.sendRequest(new VizPortal.ServerApi.UpdateSiteSettingsForSiteAdminRequest($scope.siteSettingsForSiteAdmin));\r\n                }\r\n            });\r\n            // TODO: if server.thirdPartyAuthState.isAllowed === false, don't show anything.\r\n            $scope.configuration = configuration;\r\n            $scope.$watch('configuration.enabled', function (newVal, oldVal) {\r\n                if (newVal !== oldVal) {\r\n                    $scope.setEnabled(newVal);\r\n                }\r\n            });\r\n            $scope.isEnabled = function () {\r\n                return $scope.configuration.enabled;\r\n            };\r\n            $scope.isIdentityProviderConfigured = function () {\r\n                return ($scope.isEnabled()\r\n                    && !!$scope.configuration.identityProviderEntityId);\r\n            };\r\n            $scope.download = function (evt, url) {\r\n                evt.preventDefault();\r\n                windowLocation.download(url);\r\n            };\r\n            $scope.downloadLogUrl = function () { return restApiPrefix + configuration.downloadLogEndpoint; };\r\n            $scope.openAddExternalUsersDialog = function ($event) {\r\n                addUsersOptionsAction.showAddSiteUsersOptionsDialog(VizPortal.ActionContext.fromEvent($event));\r\n            };\r\n            $scope.testLogin = function () {\r\n                if (!$scope.isIdentityProviderConfigured()) {\r\n                    return;\r\n                }\r\n                windowLocation.open(configuration.testLoginUrl, 'testLogin', 'left=20,top=20,width=500,height=600,toolbar=1,resizable=1');\r\n            };\r\n            $scope.entityIdFormUrl = function () {\r\n                if (server.sessionSiteUrlName() === '') {\r\n                    return '/admin/site_saml';\r\n                }\r\n                return '/t/' + server.sessionSiteUrlName() + '/admin/site_saml';\r\n            };\r\n            $scope.returnUrl = function () {\r\n                return windowLocation.getPathQueryFragment();\r\n            };\r\n            $scope.setEnabled = function (enable) {\r\n                server.sendRequest(new VizPortal.ServerApi.SetSiteSAMLEnabledRequest({ enable: enable })).then(function (result) {\r\n                    $scope.configuration = result;\r\n                    server.refreshSessionInfo();\r\n                    toaster.pop({ type: VizPortal.ToastType.Info, text: $translate.instant(enable ? 'siteAuthenticationSAMLEnabled' : 'siteAuthenticationSAMLDisabled') });\r\n                });\r\n            };\r\n            $scope.removeIdentityProvider = function () {\r\n                server.sendRequest(new VizPortal.ServerApi.RemoveIdentityProviderRequest()).then(function (result) {\r\n                    $scope.configuration = result;\r\n                    server.refreshSessionInfo();\r\n                });\r\n            };\r\n            $scope.setSiteAttributeMapping = function () {\r\n                server.sendRequest(new VizPortal.ServerApi.SetSiteAttributeMappingRequest($scope.configuration.siteSAMLAttributeMapping)).then(function () {\r\n                    toaster.pop({ type: VizPortal.ToastType.Info, text: $translate.instant('siteAuthenticationAttributesSaved') });\r\n                });\r\n            };\r\n            $scope.endpoint = restApiPrefix + \"updateIdentityProvider\";\r\n            $scope.handleFormSubmitResult = function (result) {\r\n                //if result is a number, it represents an error code\r\n                if (typeof (result) == 'number') {\r\n                    switch (result) {\r\n                        case VizPortal.CommonErrorCode.InsecureSAMLEndpoint:\r\n                            toaster.pop({ type: VizPortal.ToastType.Error, text: $translate.instant('siteAuthenticationIdPImportFailureInsecureEndpoint') });\r\n                            break;\r\n                        default:\r\n                            toaster.pop({ type: VizPortal.ToastType.Error, text: $translate.instant('unexpectedError') });\r\n                    }\r\n                }\r\n                else {\r\n                    $scope.configuration = result;\r\n                    toaster.pop({ type: VizPortal.ToastType.Info, text: $translate.instant('siteAuthenticationIdPImportSuccess') });\r\n                }\r\n                server.refreshSessionInfo();\r\n            };\r\n            $scope.xsrfToken = $cookies[VizPortal.CookieKeys.XsrfToken];\r\n            $scope.allowed = server.isThirdPartyAuthAllowed();\r\n            var customerSupportLink = \"mailto:customerservice@tableau.com?Subject=Tableau%20Online%20Single%20Sign-on%20request&Body=Site%20Name%3A%20\" + server.sessionSiteName() + \"%0ASite%20Admin%20email%3A%20\" + server.sessionUsername() + \"%0AIdentity%20Provider%3A%20%28e.g.%20Ping%2C%20Okta%2C%20OneLogin%2C%20Shibboleth%2C%20Salesforce%2C%20other%3F%29\";\r\n            $scope.contactCustomerSupport = function () {\r\n                return {\r\n                    localizedStatementKey: 'siteAuthenticationFunctionalityInfo',\r\n                    links: [{\r\n                            key: '{CUSTOMER_SUPPORT_MAILTO_LINK}',\r\n                            localizedValueKey: 'tableauSupport',\r\n                            url: customerSupportLink\r\n                        }]\r\n                };\r\n            };\r\n        }\r\n        SiteAuthenticationCtrl.$inject = [\r\n            '$scope',\r\n            '$translate',\r\n            '$cookies',\r\n            'WindowLocationService',\r\n            'ServerService',\r\n            'configuration',\r\n            'siteSettingsForSiteAdmin',\r\n            'ToasterService',\r\n            'AddUsersOptionsAction',\r\n            'RestApiPrefix'\r\n        ];\r\n        return SiteAuthenticationCtrl;\r\n    })();\r\n    VizPortal.SiteAuthenticationCtrl = SiteAuthenticationCtrl;\r\n    VizPortal.Module.instance().controller('SiteAuthenticationCtrl', SiteAuthenticationCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../controllers/ContentPlaceCtrl.ts\" />\r\n/// <reference path=\"../helpers/SubplaceCountsHelper.ts\" />\r\n/// <reference path=\"../models/IPlace.ts\" />\r\n/// <reference path=\"../services/CreateSiteAction.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SitesPlaceCtrl = (function () {\r\n        function SitesPlaceCtrl($location, $scope, $state, CreateSiteAction, place) {\r\n            VizPortal.SubplaceCountsHelper.keepSubplaceCountsUpdated($scope, place);\r\n            $scope.placeTitleClicked = function () {\r\n                $scope.$broadcast(VizPortal.SubplaceEvents.Refresh);\r\n            };\r\n        }\r\n        SitesPlaceCtrl.$inject = [\r\n            '$location',\r\n            '$scope',\r\n            '$state',\r\n            'CreateSiteAction',\r\n            'place'\r\n        ];\r\n        return SitesPlaceCtrl;\r\n    })();\r\n    VizPortal.SitesPlaceCtrl = SitesPlaceCtrl;\r\n    VizPortal.Module.instance().controller('SitesPlaceCtrl', SitesPlaceCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../controllers/ContentPlaceCtrl.ts\" />\r\n/// <reference path=\"../helpers/ActionButtonsHelper.ts\" />\r\n/// <reference path=\"../helpers/SiteRoleFilterHelper.ts\" />\r\n/// <reference path=\"../models/ContentTypes.ts\" />\r\n/// <reference path=\"../models/ISliceable.ts\" />\r\n/// <reference path=\"../models/ITabsBannerModel.ts\" />\r\n/// <reference path=\"../models/ITemplate.ts\" />\r\n/// <reference path=\"../models/Set.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../resources/SiteUsers.ts\" />\r\n/// <reference path=\"../ServerApi/types/ISiteUser.ts\" />\r\n/// <reference path=\"../services/AddUsersOptionsAction.ts\" />\r\n/// <reference path=\"../services/BrowserTitleService.ts\" />\r\n/// <reference path=\"../services/QueryService.ts\" />\r\n/// <reference path=\"../services/SelectionService.ts\" />\r\n/// <reference path=\"../services/SiteUsersActions.ts\" />\r\n/// <reference path=\"../services/SorterFactory.ts\" />\r\n/// <reference path=\"../../common/react/components/dataGrid/DataGridCells.ts\" />\r\n/// <reference path=\"../../common/react/components/dataGrid/DataGrid.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../../ts/FeatureFlags.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SiteUsersPlaceCtrl = (function () {\r\n        function SiteUsersPlaceCtrl($scope, $translate, AngularToReactDataGridBridge, addUsersOptionsAction, BrowserTitleService, queryService, selectionService, serverService, canSessionUserManageUsers, users, siteUsersActions, sorterFactory, angularContextFactory, filterPanelService) {\r\n            this.$scope = $scope;\r\n            this.$translate = $translate;\r\n            this.AngularToReactDataGridBridge = AngularToReactDataGridBridge;\r\n            this.queryService = queryService;\r\n            this.serverService = serverService;\r\n            this.users = users;\r\n            this.angularContextFactory = angularContextFactory;\r\n            $scope.multisite = serverService.isSessionMultiSite();\r\n            $scope.reactDataGridInSiteUsersPlace = VizPortal.FeatureFlags.reactDataGridInSiteUsersPlace;\r\n            BrowserTitleService.setTitle($scope.multisite ? 'siteUsers' : 'users');\r\n            $scope.model = { itemsCount: 0 };\r\n            $scope.server = serverService;\r\n            $scope.sorter = sorterFactory.create(VizPortal.SiteUserContentType.defaultOrder);\r\n            $scope.selectedItems = new VizPortal.Set(function (user) { return user.id; });\r\n            if (VizPortal.FeatureFlags.reactDataGridInSiteUsersPlace) {\r\n                this.configureForReactDataGrid();\r\n            }\r\n            $scope.availableAction = function (action) {\r\n                return action.isAvailable($scope.selectedItems);\r\n            };\r\n            VizPortal.ActionButtonsHelper.setupActionButtons($scope, siteUsersActions.getSiteUsersActionsButtons());\r\n            $scope.listActions = [{\r\n                    name: 'add-users',\r\n                    translate: 'addUsers',\r\n                    isAvailable: function () { return canSessionUserManageUsers; },\r\n                    execute: function ($event) {\r\n                        addUsersOptionsAction.showAddSiteUsersOptionsDialog(VizPortal.ActionContext.fromEvent($event));\r\n                    }\r\n                }];\r\n            $scope.availableListAction = function (listAction) { return listAction.isAvailable(); };\r\n            $scope.rowClicked = function (row, colIndex) {\r\n                selectionService.rowClicked($scope.selectedItems, row, colIndex);\r\n            };\r\n            $scope.filterControls = {};\r\n            $scope.filterDefinitions = filterPanelService.getFilterDefinitions(['siteRole']);\r\n            this.siteRoleFilterDefinition = $scope.filterDefinitions[0];\r\n            var queryUpdater = this.createQueryUpdater();\r\n            $scope.sliceChanged = function (newSlice) {\r\n                $scope.selectedItems.updateItems(newSlice.items);\r\n                $scope.model.itemsCount = newSlice.total;\r\n            };\r\n            $scope.refreshItems = function () {\r\n                queryUpdater.refresh();\r\n            };\r\n            $scope.refreshItems();\r\n            $scope.placeTitleClicked = function () {\r\n                $scope.refreshItems();\r\n            };\r\n            $scope.$on(VizPortal.UserAddedEvent, function () {\r\n                $scope.refreshItems();\r\n            });\r\n            $scope.$on(VizPortal.SiteRolesEvent.SiteRolesChanged, function () {\r\n                $scope.refreshItems();\r\n            });\r\n            $scope.$on(VizPortal.SyncGroupEvent.groupSynced, function () {\r\n                $scope.refreshItems();\r\n            });\r\n            $scope.headerClicked = function (header) { return $scope.sorter.setPrimary(header.attrs['key'], header.attrs['direction']); };\r\n            $scope.thirdPartyAuthEditable = serverService.isThirdPartyAuthEditable();\r\n            $scope.emptyTemplateModel = { title: 'usersEmptyMessage' };\r\n        }\r\n        SiteUsersPlaceCtrl.prototype.updateSiteRoleCounts = function (baseQuery) {\r\n            var _this = this;\r\n            this.users.getUserCountsBySiteRole(baseQuery).then(function (userCountsByRole) {\r\n                _this.siteRoleFilterDefinition.options =\r\n                    VizPortal.SiteRoleFilterHelper.siteRoleOptions(VizPortal.SiteRoles.WithoutGuest, userCountsByRole);\r\n            });\r\n        };\r\n        SiteUsersPlaceCtrl.prototype.configureForReactDataGrid = function () {\r\n            var _this = this;\r\n            this.$scope.dataGridProps = {\r\n                translate: this.$translate.instant,\r\n                cols: this.dataGridColumns(this.$scope),\r\n                data: null,\r\n                emptyChild: React.DOM.div({\r\n                    className: 'tb-data-grid-empty'\r\n                }, React.DOM.div({ className: 'tb-data-grid-empty-title' }, this.$translate.instant('usersEmptyMessage'))),\r\n                update: 0,\r\n                onHeaderClicked: function (columnKey, direction) {\r\n                    _this.$scope.$apply(function () {\r\n                        _this.$scope.sorter.setPrimary(columnKey, direction);\r\n                    });\r\n                },\r\n                onCellClick: function (item, columnKey) {\r\n                    _this.$scope.$apply(function () {\r\n                        if (VizPortal.FeatureFlags.toggleSelectableRow) {\r\n                            var onlySelectedRow = _this.$scope.selectedItems.size() === 1 && _this.$scope.selectedItems.contains(item);\r\n                            var isActionMenu = columnKey === 'actions';\r\n                            if (onlySelectedRow && !isActionMenu) {\r\n                                _this.$scope.selectedItems.toggle(item);\r\n                            }\r\n                            else {\r\n                                _this.$scope.selectedItems.clear();\r\n                                _this.$scope.selectedItems.add(item);\r\n                            }\r\n                        }\r\n                        else {\r\n                            _this.$scope.selectedItems.clear();\r\n                            _this.$scope.selectedItems.add(item);\r\n                        }\r\n                        var keys = _this.$scope.selectedItems.keys();\r\n                        _this.$scope.dataGridProps.selectedKeys = _.object(keys, keys);\r\n                        _this.$scope.dataGridProps.update++;\r\n                    });\r\n                }\r\n            };\r\n            this.$scope.$watch(function () { return _this.$scope.sorter.selectedColumnKey() + ';' + _this.$scope.sorter.isSortAscending(); }, function () {\r\n                _this.$scope.dataGridProps.sortKey = _this.$scope.sorter.selectedColumnKey();\r\n                _this.$scope.dataGridProps.sortAscending = _this.$scope.sorter.isSortAscending();\r\n                _this.$scope.dataGridProps.update++;\r\n            });\r\n            // TODO: find a better way to monitor changes in selected items\r\n            this.$scope.$watch(function () { return _this.$scope.selectedItems.size(); }, function () {\r\n                var keys = _this.$scope.selectedItems.keys();\r\n                _this.$scope.dataGridProps.selectedKeys = _.object(keys, keys);\r\n                _this.$scope.dataGridProps.update++;\r\n            });\r\n        };\r\n        SiteUsersPlaceCtrl.prototype.createQueryUpdater = function () {\r\n            var _this = this;\r\n            if (VizPortal.FeatureFlags.reactDataGridInSiteUsersPlace) {\r\n                return this.queryService.createQueryUpdater(this.$scope, VizPortal.SiteUserContentType, this.users, function (resourceQuery) {\r\n                    _this.AngularToReactDataGridBridge.updateReactDataGridRowStore({ scope: _this.$scope, sliceable: resourceQuery });\r\n                    _this.$scope.sliceable = resourceQuery;\r\n                    _this.$scope.sorter.setOrder(resourceQuery.getOrder());\r\n                    resourceQuery.getCount().then(function (result) {\r\n                        _this.$scope.model.itemsCount = result;\r\n                    });\r\n                }, {});\r\n            }\r\n            else {\r\n                return this.queryService.createQueryUpdater(this.$scope, VizPortal.SiteUserContentType, this.users, function (resourceQuery) {\r\n                    _this.$scope.sliceable = resourceQuery;\r\n                    _this.$scope.sorter.setOrder(resourceQuery.getOrder());\r\n                    _this.updateSiteRoleCounts(resourceQuery);\r\n                    resourceQuery.getCount().then(function (result) {\r\n                        _this.$scope.model.itemsCount = result;\r\n                    });\r\n                }, {});\r\n            }\r\n        };\r\n        SiteUsersPlaceCtrl.prototype.dataGridColumns = function ($scope) {\r\n            var translate = this.$translate.instant;\r\n            var SiteRoleCell = React.createFactory(React.createClass({\r\n                render: function () {\r\n                    return React.DOM.span({}, translate('siteRole_' + this.props.value));\r\n                }\r\n            }));\r\n            var LastSignInCell = React.createFactory(React.createClass({\r\n                render: function () {\r\n                    var props = this.props;\r\n                    var lastSignIn = props.row.data.lastSignIn;\r\n                    return React.DOM.span({}, VizPortal.L10n.localizedDateTime(lastSignIn));\r\n                }\r\n            }));\r\n            var angularContext = this.angularContextFactory.create($scope);\r\n            var columns = [\r\n                VizPortalReact.CommonDataGridColumns.selected($scope),\r\n                {\r\n                    name: 'display-name-col',\r\n                    dataKey: 'displayName',\r\n                    text: this.$translate.instant('column_fullName'),\r\n                    direction: 'asc',\r\n                    cellFormatter: VizPortalReact.DataGridCells.UserDisplayNameCell()\r\n                },\r\n                {\r\n                    name: 'actions-col',\r\n                    dataKey: 'actions',\r\n                    text: '',\r\n                    cellFormatter: VizPortalReact.DataGridCells.AngularActionsCell(angularContext),\r\n                    resizable: false,\r\n                    sortable: false,\r\n                    cellStyle: {\r\n                        padding: 0\r\n                    }\r\n                },\r\n                {\r\n                    name: 'username-col',\r\n                    dataKey: 'username',\r\n                    text: this.$translate.instant('column_username'),\r\n                    direction: 'asc'\r\n                },\r\n                {\r\n                    name: 'site-role-col',\r\n                    dataKey: 'siteRole',\r\n                    text: this.$translate.instant('column_site_role'),\r\n                    direction: 'asc',\r\n                    cellFormatter: SiteRoleCell\r\n                },\r\n                {\r\n                    name: 'group-count-col',\r\n                    dataKey: 'groupCount',\r\n                    text: this.$translate.instant('column_groupCount'),\r\n                    direction: 'asc',\r\n                    headerStyle: { textAlign: 'right' },\r\n                    cellStyle: { textAlign: 'right' }\r\n                }\r\n            ];\r\n            if (this.serverService.isServerDomainFamilyActiveDirectory()) {\r\n                columns.push({\r\n                    name: 'domain-name-col',\r\n                    dataKey: 'domainName',\r\n                    direction: 'asc',\r\n                    text: this.$translate.instant('column_domainName')\r\n                });\r\n            }\r\n            if ($scope.thirdPartyAuthEditable) {\r\n                columns.push({\r\n                    name: 'authentication-col',\r\n                    dataKey: 'authentication',\r\n                    direction: 'asc',\r\n                    text: this.$translate.instant('column_authentication')\r\n                });\r\n            }\r\n            columns.push({\r\n                name: 'last-sign-in-col',\r\n                dataKey: 'lastSignIn',\r\n                text: this.$translate.instant('column_last_sign_in'),\r\n                direction: 'desc',\r\n                cellFormatter: LastSignInCell\r\n            });\r\n            return columns;\r\n        };\r\n        SiteUsersPlaceCtrl.$inject = [\r\n            '$scope',\r\n            '$translate',\r\n            'AngularToReactDataGridBridge',\r\n            'AddUsersOptionsAction',\r\n            'BrowserTitleService',\r\n            'QueryService',\r\n            'SelectionService',\r\n            'ServerService',\r\n            'canSessionUserManageUsers',\r\n            'SiteUsers',\r\n            'SiteUsersActions',\r\n            'SorterFactory',\r\n            'AngularContextFactory',\r\n            'FilterPanelService'\r\n        ];\r\n        return SiteUsersPlaceCtrl;\r\n    })();\r\n    VizPortal.SiteUsersPlaceCtrl = SiteUsersPlaceCtrl;\r\n    VizPortal.Module.instance().controller('SiteUsersPlaceCtrl', SiteUsersPlaceCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/CommonDataGridColumns.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var SubscriptionGrid;\r\n    (function (SubscriptionGrid) {\r\n        function columns(translate, scope, actions, isServerPage, serverUrls, siteUrls, scheduleFrequencyDescriptionFilter, showUserNameColumn, showHasSubscriptionColumn, showWorkbookViewColumn, showScheduleColumn, showSiteColumn) {\r\n            var columns = [\r\n                VizPortalReact.CommonDataGridColumns.selected(scope)\r\n            ];\r\n            if (showUserNameColumn) {\r\n                columns.push({\r\n                    name: 'user-col',\r\n                    dataKey: 'userName',\r\n                    text: translate('column_task_user'),\r\n                    cellFormatter: VizPortalReact.DataGridCells.Link(function (row) {\r\n                        var subscription = row.data;\r\n                        return {\r\n                            text: subscription.user.displayName,\r\n                            url: siteUrls.forSiteUrlName(subscription.site.urlName).userContentUrl(subscription.user),\r\n                            iconClassName: 'tb-grid-icon-user',\r\n                            iconTitle: translate('user')\r\n                        };\r\n                    })\r\n                });\r\n            }\r\n            if (showHasSubscriptionColumn) {\r\n                columns.push({\r\n                    name: 'subscription-col',\r\n                    dataKey: 'targetName',\r\n                    text: translate('column_task_subscription'),\r\n                    direction: 'asc',\r\n                    cellFormatter: targetLinkFormatter(siteUrls, translate)\r\n                });\r\n            }\r\n            if (showWorkbookViewColumn) {\r\n                columns.push({\r\n                    name: 'workbook-view-col',\r\n                    dataKey: 'targetName',\r\n                    text: translate('column_task_workbook_view'),\r\n                    direction: 'asc',\r\n                    cellFormatter: targetLinkFormatter(siteUrls, translate)\r\n                });\r\n            }\r\n            columns.push({\r\n                name: 'subject-col',\r\n                dataKey: 'subject',\r\n                text: translate('column_task_subject'),\r\n                direction: 'asc'\r\n            });\r\n            if (showScheduleColumn) {\r\n                columns.push({\r\n                    name: 'schedule-name-col',\r\n                    dataKey: 'scheduleName',\r\n                    direction: 'asc',\r\n                    text: translate('column_task_schedule'),\r\n                    cellFormatter: VizPortalReact.DataGridCells.ScheduleDescriptionCell(function (row) {\r\n                        var subscription = row.data;\r\n                        // This cast to ISchedule shouldn't be necessary, but for some reason\r\n                        // subscription.schedule is of type INamedItemInfo.\r\n                        // TODO: figure out why this is the case and refactor the types accordingly.\r\n                        var schedule = subscription.schedule;\r\n                        return isServerPage\r\n                            ? serverUrls.schedule(schedule.id, schedule.scheduledAction)\r\n                            : siteUrls.forSiteUrlName(subscription.site.urlName).schedule(schedule.id, schedule.scheduledAction);\r\n                    }, scheduleFrequencyDescriptionFilter)\r\n                });\r\n            }\r\n            if (showSiteColumn) {\r\n                columns.push({\r\n                    name: 'site-name-col',\r\n                    dataKey: 'siteName',\r\n                    direction: 'asc',\r\n                    text: translate('column_task_site'),\r\n                    cellFormatter: VizPortalReact.DataGridCells.PlainTextCellWithTransform('site', function (site) { return site.name; })\r\n                });\r\n            }\r\n            columns.push({\r\n                name: 'last-sent-at-col',\r\n                dataKey: 'lastSentAt',\r\n                text: translate('column_task_last_update'),\r\n                direction: 'desc',\r\n                cellFormatter: VizPortalReact.DataGridCells.DateTimeCell('lastSentAt', translate('never'))\r\n            });\r\n            columns.push({\r\n                name: 'next-run-at-col',\r\n                dataKey: 'runNextAt',\r\n                text: translate('column_task_next_update'),\r\n                direction: 'asc',\r\n                cellFormatter: VizPortalReact.DataGridCells.DateTimeCell('runNextAt', translate('disabled'))\r\n            });\r\n            // Add the actions menu to whichever column was first (not including the 'selected' column)\r\n            columns[1] = VizPortalReact.CommonDataGridColumns.withActions(columns[1], {\r\n                actions: actions,\r\n                getActionTarget: function () {\r\n                    return {\r\n                        items: scope.selectedItems,\r\n                        actionContext: { scope: scope }\r\n                    };\r\n                },\r\n                translate: translate\r\n            });\r\n            return columns;\r\n        }\r\n        SubscriptionGrid.columns = columns;\r\n        function targetLinkFormatter(siteUrls, translate) {\r\n            return VizPortalReact.DataGridCells.Link(function (row) {\r\n                var subscription = row.data;\r\n                var siteUrlsForRow = siteUrls.forSiteUrlName(subscription.site.urlName);\r\n                if (subscription.targetType === VizPortal.SubscriptionTargetTypes.view) {\r\n                    return {\r\n                        text: subscription.targetName,\r\n                        url: siteUrlsForRow.viewUrl(subscription.targetPath),\r\n                        iconClassName: 'tb-grid-icon-view',\r\n                        iconTitle: translate('view')\r\n                    };\r\n                }\r\n                else {\r\n                    return {\r\n                        text: subscription.targetName,\r\n                        url: siteUrlsForRow.workbookUrl(subscription.targetId),\r\n                        iconClassName: 'tb-grid-icon-workbook',\r\n                        iconTitle: translate('workbook')\r\n                    };\r\n                }\r\n            });\r\n        }\r\n    })(SubscriptionGrid = VizPortalReact.SubscriptionGrid || (VizPortalReact.SubscriptionGrid = {}));\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DeleteSubscriptionsAction = (function () {\r\n        function DeleteSubscriptionsAction(ConfirmActionDialog, ContentActionNotification, $translate, Subscriptions) {\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.ContentActionNotification = ContentActionNotification;\r\n            this.$translate = $translate;\r\n            this.Subscriptions = Subscriptions;\r\n        }\r\n        DeleteSubscriptionsAction.prototype.deleteSubscriptions = function (subscriptions, context) {\r\n            var _this = this;\r\n            var description;\r\n            if (subscriptions.size() === 1) {\r\n                var sub = subscriptions.first();\r\n                if (sub.targetType === VizPortal.SubscriptionTargetTypes.view) {\r\n                    description = this.$translate.instant('confirmDeleteSubscriptionView', { TARGET_NAME: VizPortal.L10n.elideIfLong(sub.targetName) });\r\n                }\r\n                else if (sub.targetType === VizPortal.SubscriptionTargetTypes.workbook) {\r\n                    description = this.$translate.instant('confirmDeleteSubscriptionWorkbook', { TARGET_NAME: VizPortal.L10n.elideIfLong(sub.targetName) });\r\n                }\r\n            }\r\n            else {\r\n                description = this.$translate.instant('confirmDeleteSubscriptions', { SUBSCRIPTION_COUNT: subscriptions.size() }, VizPortal.L10n.Interpolations.Count);\r\n            }\r\n            return this.ConfirmActionDialog.open({\r\n                scope: context.scope,\r\n                title: this.$translate.instant('delete'),\r\n                bodyText: description,\r\n                actionName: this.$translate.instant('confirmDeleteButton', { ITEM_COUNT: subscriptions.size() }, VizPortal.L10n.Interpolations.Count),\r\n                isDeleteAction: true,\r\n                action: function (dialogInstance) {\r\n                    return _this.Subscriptions.del(subscriptions.keys()).then(function (result) {\r\n                        var notification = VizPortal.MultipleResultNotificationOptions.create(new VizPortal.MultipleItemResult(subscriptions, result), {\r\n                            describeSuccessSummary: function (successCount) {\r\n                                return _this.$translate.instant('deleteSubscriptionsSuccess', { ITEM_COUNT: successCount }, VizPortal.L10n.Interpolations.Count);\r\n                            },\r\n                            describeErrorSummary: function (errorCount) {\r\n                                return _this.$translate.instant('deleteSubscriptionsError', { ERROR_COUNT: errorCount }, VizPortal.L10n.Interpolations.Count);\r\n                            },\r\n                            describeErrorDetail: function (errorItem) {\r\n                                return {\r\n                                    itemName: errorItem.item.subject,\r\n                                    errorMessage: _this.errorMessageFor(errorItem)\r\n                                };\r\n                            }\r\n                        });\r\n                        _this.ContentActionNotification.notify(notification);\r\n                    });\r\n                }\r\n            }).result;\r\n        };\r\n        DeleteSubscriptionsAction.prototype.errorMessageFor = function (errorItem) {\r\n            switch (errorItem.error.code) {\r\n                case VizPortal.CommonErrorCode.SubscriptionNotFound:\r\n                    return this.$translate.instant('errorSubscriptionNotFound', { SUBSCRIPTION_NAME: VizPortal.L10n.elideIfLong(errorItem.item.subject) });\r\n                default:\r\n                    return this.$translate.instant('errorUnknown');\r\n            }\r\n        };\r\n        DeleteSubscriptionsAction.$inject = ['ConfirmActionDialog', 'ContentActionNotification', '$translate', 'Subscriptions'];\r\n        return DeleteSubscriptionsAction;\r\n    })();\r\n    VizPortal.DeleteSubscriptionsAction = DeleteSubscriptionsAction;\r\n    VizPortal.Module.instance().service('DeleteSubscriptionsAction', DeleteSubscriptionsAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\n/// <reference path=\"ContentActionNotification.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ChangeSubscriptionSubjectAction = (function () {\r\n        function ChangeSubscriptionSubjectAction(ConfirmActionDialog, $translate, toaster, Subscriptions) {\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.$translate = $translate;\r\n            this.toaster = toaster;\r\n            this.Subscriptions = Subscriptions;\r\n        }\r\n        ChangeSubscriptionSubjectAction.prototype.changeSubject = function (subscription, context) {\r\n            var _this = this;\r\n            var scope = context.scope.$new();\r\n            scope.description = ''; // This should only be used if the server returns bad data.\r\n            switch (subscription.targetType) {\r\n                case VizPortal.SubscriptionTargetTypes.view:\r\n                    scope.description = this.$translate.instant('confirmChangeViewSubscriptionSubject', { VIEW_NAME: VizPortal.L10n.elideIfLong(subscription.targetName) });\r\n                    break;\r\n                case VizPortal.SubscriptionTargetTypes.workbook:\r\n                    scope.description = this.$translate.instant('confirmChangeWorkbookSubscriptionSubject', { WORKBOOK_NAME: VizPortal.L10n.elideIfLong(subscription.targetName) });\r\n                    break;\r\n            }\r\n            scope.input = {\r\n                text: subscription.subject,\r\n                maxLength: 255\r\n            };\r\n            return this.ConfirmActionDialog.open({\r\n                title: this.$translate.instant('changeSubject'),\r\n                bodyTemplateUrl: 'confirmActionDialogInput.html',\r\n                scope: scope,\r\n                actionName: this.$translate.instant('changeSubject'),\r\n                action: function (dialogInstance) {\r\n                    return _this.Subscriptions.changeSubject(subscription.id, scope.input.text).then(function (result) {\r\n                        if (result.errors && result.errors.length) {\r\n                            dialogInstance.showErrorMessage(_this.$translate.instant('changeSubjectFailure', {\r\n                                SUBJECT: subscription.subject\r\n                            }));\r\n                        }\r\n                        else {\r\n                            _this.toaster.pop({\r\n                                type: VizPortal.ToastType.Info,\r\n                                text: _this.$translate.instant('changeSubjectSuccess', {\r\n                                    SUBJECT: scope.input.text\r\n                                })\r\n                            });\r\n                            subscription.subject = scope.input.text;\r\n                        }\r\n                        return result;\r\n                    });\r\n                }\r\n            }).result.fin(function () { return scope.$destroy(); });\r\n        };\r\n        ChangeSubscriptionSubjectAction.$inject = ['ConfirmActionDialog', '$translate', 'ToasterService', 'Subscriptions'];\r\n        return ChangeSubscriptionSubjectAction;\r\n    })();\r\n    VizPortal.ChangeSubscriptionSubjectAction = ChangeSubscriptionSubjectAction;\r\n    VizPortal.Module.instance().service('ChangeSubscriptionSubjectAction', ChangeSubscriptionSubjectAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../../app/content/SubscriptionGrid.ts\" />\r\n/// <reference path=\"../../common/react/components/dataGrid/AngularToReactDataGridBridge.ts\" />\r\n/// <reference path=\"../helpers/ActionButtonsHelper.ts\" />\r\n/// <reference path=\"../helpers/SubplaceCountsHelper.ts\" />\r\n/// <reference path=\"../models/IEmptyTemplate.ts\" />\r\n/// <reference path=\"../models/ITemplate.ts\" />\r\n/// <reference path=\"../resources/Schedules.ts\" />\r\n/// <reference path=\"../resources/Subscriptions.ts\" />\r\n/// <reference path=\"../services/BrowserTitleService.ts\" />\r\n/// <reference path=\"../services/SorterFactory.ts\" />\r\n/// <reference path=\"../services/DeleteSubscriptionsAction.ts\" />\r\n/// <reference path=\"../services/ChangeScheduleAction.ts\" />\r\n/// <reference path=\"../services/ChangeSubscriptionSubjectAction.ts\" />\r\n/// <reference path=\"../services/QueryService.ts\" />\r\n/// <reference path=\"../services/SelectionService.ts\" />\r\n/// <reference path=\"TasksCtrl.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SubscriptionsCtrl = (function () {\r\n        function SubscriptionsCtrl($scope, $translate, AngularToReactDataGridBridge, $state, $filter, BrowserTitleService, subplace, queryService, selectionService, sorterFactory, ServerService, DeleteSubscriptionsAction, changeScheduleAction, ChangeSubscriptionSubjectAction) {\r\n            var _this = this;\r\n            this.$scope = $scope;\r\n            this.$translate = $translate;\r\n            this.AngularToReactDataGridBridge = AngularToReactDataGridBridge;\r\n            this.$state = $state;\r\n            this.$filter = $filter;\r\n            this.ServerService = ServerService;\r\n            this.DeleteSubscriptionsAction = DeleteSubscriptionsAction;\r\n            this.changeScheduleAction = changeScheduleAction;\r\n            this.ChangeSubscriptionSubjectAction = ChangeSubscriptionSubjectAction;\r\n            BrowserTitleService.setTitle('subscriptions', $scope.objectName);\r\n            var selectedItems = new VizPortal.Set(function (subscription) { return subscription.id; });\r\n            $scope.selectedItems = selectedItems;\r\n            var actions = this.createActions(selectedItems);\r\n            $scope.useReactDataGrid = VizPortal.FeatureFlags.reactSubscriptionsGrid;\r\n            if (VizPortal.FeatureFlags.reactSubscriptionsGrid) {\r\n                this.configureForReactDataGrid(actions);\r\n            }\r\n            $scope.rowClicked = function (row, colIndex) {\r\n                selectionService.rowClicked($scope.selectedItems, row, colIndex);\r\n            };\r\n            $scope.sorter = sorterFactory.create(VizPortal.SubscriptionContentType.defaultOrder);\r\n            this.query = queryService.createQueryUpdaterFromSubplace($scope, subplace, function (resourceQuery) {\r\n                if (VizPortal.FeatureFlags.reactSubscriptionsGrid) {\r\n                    _this.AngularToReactDataGridBridge.updateReactDataGridRowStore({ scope: _this.$scope, sliceable: resourceQuery });\r\n                }\r\n                $scope.sliceable = resourceQuery;\r\n                $scope.sorter.setOrder(resourceQuery.getOrder());\r\n            });\r\n            this.refreshSubscriptions();\r\n            $scope.$on(VizPortal.SubplaceEvents.Refresh, function () {\r\n                _this.refreshSubscriptions();\r\n            });\r\n            $scope.showUserNameColumn = this.showUserNameColumn();\r\n            $scope.showWorkbookViewColumn = this.showWorkbookViewColumn();\r\n            $scope.showHasSubscriptionColumn = this.showHasSubscriptionColumn();\r\n            $scope.availableAction = function (action) { return action.isAvailable($scope.selectedItems); };\r\n            VizPortal.ActionButtonsHelper.setupActionButtons($scope, actions);\r\n            $scope.headerClicked = function (header) { return $scope.sorter.setPrimary(header.attrs['key'], header.attrs['direction']); };\r\n            $scope.sliceChanged = function (newSlice) {\r\n                $scope.selectedItems.updateItems(newSlice.items);\r\n                VizPortal.SubplaceCountsHelper.updateCountsFromSubplace($scope, subplace, newSlice.total);\r\n            };\r\n            $scope.emptyTemplateModel = SubscriptionsCtrl.emptyTemplateModel;\r\n        }\r\n        SubscriptionsCtrl.prototype.isServerPage = function () {\r\n            return this.$state.includes(\"main.server.**\");\r\n        };\r\n        SubscriptionsCtrl.prototype.showUserNameColumn = function () {\r\n            return !this.$state.includes(\"**.user.**\");\r\n        };\r\n        SubscriptionsCtrl.prototype.showHasSubscriptionColumn = function () {\r\n            return !this.$state.includes(\"**.workbook.**\") && !this.$state.includes(\"**.user.**\");\r\n        };\r\n        SubscriptionsCtrl.prototype.showWorkbookViewColumn = function () {\r\n            return this.$state.includes(\"**.user.**\");\r\n        };\r\n        SubscriptionsCtrl.prototype.showScheduleColumn = function () {\r\n            return !this.$state.includes(\"**.schedule.**\");\r\n        };\r\n        SubscriptionsCtrl.prototype.showSiteColumn = function () {\r\n            return this.isServerPage();\r\n        };\r\n        SubscriptionsCtrl.prototype.configureForReactDataGrid = function (actions) {\r\n            var _this = this;\r\n            var queryString = window.location.search;\r\n            var columns = VizPortalReact.SubscriptionGrid.columns(function (id) { return _this.$translate.instant(id); }, this.$scope, actions, this.isServerPage(), new VizPortalReact.ServerUrls(queryString), new VizPortalReact.SiteUrls({ siteUrlName: this.ServerService.sessionSiteUrlName(), queryString: queryString }), this.$filter('scheduleFrequencyDescription'), this.showUserNameColumn(), this.showHasSubscriptionColumn(), this.showWorkbookViewColumn(), this.showScheduleColumn(), this.showSiteColumn());\r\n            this.AngularToReactDataGridBridge.attachReactDataGridToScope(this.$scope, columns, SubscriptionsCtrl.emptyTemplateModel);\r\n        };\r\n        SubscriptionsCtrl.prototype.createActions = function (selectedItems) {\r\n            var _this = this;\r\n            return [\r\n                {\r\n                    name: 'tasks-change-schedule',\r\n                    translate: 'changeSchedule_action',\r\n                    isAvailable: function (subscriptions) { return !subscriptions.isEmpty(); },\r\n                    isDisabled: function (subscriptions) {\r\n                        return subscriptions.size() === 1 && _this.isCreatorOrAdminOnly(subscriptions.first());\r\n                    },\r\n                    execute: function (items, context) {\r\n                        _this.changeScheduleAction.forSubscriptions(items, context)\r\n                            .then(function (result) {\r\n                            VizPortal.ActionHelpers.deselectNotFound(selectedItems, result, VizPortal.CommonErrorCode.SubscriptionNotFound);\r\n                            _this.refreshSubscriptions();\r\n                        });\r\n                    }\r\n                },\r\n                {\r\n                    name: 'tasks-change-subject',\r\n                    translate: 'changeSubject_action',\r\n                    isAvailable: function (subscriptions) { return !subscriptions.isEmpty(); },\r\n                    isDisabled: function (subscriptions) {\r\n                        return subscriptions.size() !== 1 || _this.isCreatorOrAdminOnly(subscriptions.first());\r\n                    },\r\n                    execute: function (subscriptions, context) {\r\n                        _this.ChangeSubscriptionSubjectAction.changeSubject(subscriptions.first(), context)\r\n                            .then(function (result) {\r\n                            VizPortal.ActionHelpers.deselectNotFound(selectedItems, result, VizPortal.CommonErrorCode.SubscriptionNotFound);\r\n                            _this.refreshSubscriptions();\r\n                        });\r\n                    }\r\n                },\r\n                {\r\n                    name: 'delete-subscriptions',\r\n                    translate: 'delete_action',\r\n                    isAvailable: function (subscriptions) { return !subscriptions.isEmpty(); },\r\n                    isDisabled: function (subscriptions) {\r\n                        return subscriptions.size() === 1 && _this.isCreatorOrAdminOnly(subscriptions.first());\r\n                    },\r\n                    execute: function (subscriptions, context) {\r\n                        _this.DeleteSubscriptionsAction.deleteSubscriptions(subscriptions, context)\r\n                            .then(function (result) {\r\n                            VizPortal.ActionHelpers.deselectAllExceptErrors(selectedItems, result, VizPortal.CommonErrorCode.SubscriptionNotFound);\r\n                            _this.refreshSubscriptions();\r\n                        });\r\n                    }\r\n                }\r\n            ];\r\n        };\r\n        SubscriptionsCtrl.prototype.isCreatorOrAdminOnly = function (subscription) {\r\n            return subscription.user.id !== this.ServerService.sessionUserId()\r\n                && !this.ServerService.isSessionSiteOrServerAdmin();\r\n        };\r\n        SubscriptionsCtrl.prototype.refreshSubscriptions = function () {\r\n            this.query.refresh();\r\n        };\r\n        SubscriptionsCtrl.$inject = [\r\n            '$scope',\r\n            '$translate',\r\n            'AngularToReactDataGridBridge',\r\n            '$state',\r\n            '$filter',\r\n            'BrowserTitleService',\r\n            'subplace',\r\n            'QueryService',\r\n            'SelectionService',\r\n            'SorterFactory',\r\n            'ServerService',\r\n            'DeleteSubscriptionsAction',\r\n            'ChangeScheduleAction',\r\n            'ChangeSubscriptionSubjectAction'\r\n        ];\r\n        SubscriptionsCtrl.emptyTemplateModel = { title: 'subscriptionsEmptyMessage' };\r\n        return SubscriptionsCtrl;\r\n    })();\r\n    VizPortal.SubscriptionsCtrl = SubscriptionsCtrl;\r\n    VizPortal.Module.instance().controller('SubscriptionsCtrl', SubscriptionsCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../ts/libs.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    /*\r\n     * Constructs urls for server pages, given a query string.\r\n     *\r\n     * e.g.\r\n     *\r\n     *   var serverUrls = new ServerUrls('foo=bar');\r\n     *\r\n     *   serverUrls.sitesUrl();    // returns '/?foo=bar#/server/sites'\r\n     *\r\n     */\r\n    var ServerUrls = (function () {\r\n        function ServerUrls(queryString) {\r\n            // Sanitize inputs and calculate prefix\r\n            queryString = _.isString(queryString) ? queryString : '';\r\n            // Insert a '?' if necessary\r\n            if (queryString && queryString.length > 0 && queryString[0] !== '?') {\r\n                queryString = '?' + queryString;\r\n            }\r\n            this.prefix = '/' + queryString + '#';\r\n        }\r\n        ServerUrls.prototype.sitesUrl = function () {\r\n            return this.prefix + '/server/sites';\r\n        };\r\n        ServerUrls.prototype.usersUrl = function () {\r\n            return this.prefix + '/server/users';\r\n        };\r\n        ServerUrls.prototype.schedule = function (scheduleId, scheduledAction) {\r\n            return this.prefix + '/server/schedules/' + scheduleId + '/' +\r\n                (scheduledAction === VizPortal.ServerApi.ScheduleActions.Extract ? 'extractRefreshes' : 'subscriptions');\r\n        };\r\n        ServerUrls.prototype.schedules = function () {\r\n            return this.prefix + '/server/schedules';\r\n        };\r\n        ServerUrls.prototype.tasks = function () {\r\n            return this.prefix + '/server/tasks';\r\n        };\r\n        ServerUrls.prototype.status = function () {\r\n            return this.prefix + '/server/status';\r\n        };\r\n        ServerUrls.prototype.settings = function () {\r\n            return this.prefix + '/server/settings';\r\n        };\r\n        ServerUrls.prototype.userSettingsUrl = function (user) {\r\n            return this.prefix + '/server/user/' + user.domainName + '/' + user.username + '/settings';\r\n        };\r\n        return ServerUrls;\r\n    })();\r\n    VizPortalReact.ServerUrls = ServerUrls;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var HeaderStyles;\r\n    (function (HeaderStyles) {\r\n        HeaderStyles.bluePalette = !VizPortal.FeatureFlags.reactTopBarDark;\r\n        HeaderStyles.LetterSpacing = '0.08em';\r\n        HeaderStyles.MenuPanelStyle = {\r\n            width: 240,\r\n            height: 308,\r\n            backgroundColor: VizPortalReact.CommonStyles.Colors.White,\r\n            borderWidth: VizPortalReact.CommonStyles.Sizes.LineWidth,\r\n            borderColor: VizPortalReact.CommonStyles.Colors.BorderColor,\r\n            borderStyle: 'solid',\r\n            fontSize: VizPortalReact.CommonStyles.Sizes.NormalFontSize,\r\n            position: 'relative' // Ensure absolutely positioned elements are relative to the parent menu panel\r\n        };\r\n        HeaderStyles.AlertsCountFontSize = VizPortal.FeatureFlags.useUpdatedFontStyles ? '10px' : 'inherit';\r\n        // Images\r\n        HeaderStyles.HeaderDividerImage = HeaderStyles.bluePalette ? 'header_divider.png' : 'header_divider_black.png';\r\n        HeaderStyles.SiteSwitcherDropdownRestImage = HeaderStyles.bluePalette ? 'signature_dropdown_small_white_normal.png' : 'signature_dropdown_small_normal.png';\r\n        HeaderStyles.SiteSwitcherDropdownHoverImage = HeaderStyles.bluePalette ? 'signature_dropdown_small_white_normal.png' : 'signature_dropdown_small_hover.png';\r\n        // Colors\r\n        HeaderStyles.HeaderBackgroundColor = HeaderStyles.bluePalette ? 'rgb(55,102,129)' : VizPortalReact.CommonStyles.Colors.Grey40;\r\n        HeaderStyles.HeaderLinkSelectedColor = HeaderStyles.bluePalette ? VizPortalReact.CommonStyles.Colors.White : VizPortalReact.CommonStyles.Colors.ActionOrange;\r\n        HeaderStyles.HeaderLinkSelectedBackgroundColor = HeaderStyles.bluePalette ? 'rgb(36,68,87)' : 'inherit';\r\n        HeaderStyles.HeaderLinkHoverBackgroundColor = HeaderStyles.bluePalette ? 'rgb(45,85,108)' : 'inherit';\r\n        HeaderStyles.SiteSwitcherRestColor = HeaderStyles.bluePalette ? VizPortalReact.CommonStyles.Colors.White : VizPortalReact.CommonStyles.Colors.ActionOrange;\r\n        HeaderStyles.SiteSwitcherHoverColor = HeaderStyles.bluePalette ? VizPortalReact.CommonStyles.Colors.White : VizPortalReact.CommonStyles.Colors.ActionOrangeDark;\r\n        // Opacity\r\n        HeaderStyles.HoverOpacity = 1.0;\r\n        HeaderStyles.RestOpacity = HeaderStyles.bluePalette ? 0.85 : 0.50;\r\n        HeaderStyles.SiteSwitcherHoverOpacity = HeaderStyles.bluePalette ? HeaderStyles.HoverOpacity : 1.0;\r\n        HeaderStyles.SiteSwitcherRestOpacity = HeaderStyles.bluePalette ? HeaderStyles.RestOpacity : 1.0;\r\n    })(HeaderStyles = VizPortalReact.HeaderStyles || (VizPortalReact.HeaderStyles = {}));\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/CommonStyles.ts\" />\r\n/// <reference path=\"HeaderStyles.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var HeaderLink = (function (_super) {\r\n        __extends(HeaderLink, _super);\r\n        function HeaderLink(props) {\r\n            var _this = this;\r\n            _super.call(this, props);\r\n            this.state = {\r\n                hovered: false\r\n            };\r\n            this.boundMouseEnter = function () { return _this.setState({ hovered: true }); };\r\n            this.boundMouseLeave = function () { return _this.setState({ hovered: false }); };\r\n        }\r\n        HeaderLink.prototype.render = function () {\r\n            var backgroundColor = 'inherit';\r\n            var color = VizPortalReact.CommonStyles.Colors.White;\r\n            var opacity = VizPortalReact.HeaderStyles.RestOpacity;\r\n            if (this.props.isSelected) {\r\n                color = VizPortalReact.HeaderStyles.HeaderLinkSelectedColor;\r\n                backgroundColor = VizPortalReact.HeaderStyles.HeaderLinkSelectedBackgroundColor;\r\n                opacity = VizPortalReact.HeaderStyles.HoverOpacity;\r\n            }\r\n            else if (this.state.hovered) {\r\n                backgroundColor = VizPortalReact.HeaderStyles.HeaderLinkHoverBackgroundColor;\r\n                opacity = VizPortalReact.HeaderStyles.HoverOpacity;\r\n            }\r\n            var style = _.extend({}, HeaderLink.linkStyle, {\r\n                color: color,\r\n                backgroundColor: backgroundColor\r\n            }, this.props.style);\r\n            return React.DOM.a({\r\n                href: this.props.url,\r\n                style: style,\r\n                onMouseEnter: this.boundMouseEnter,\r\n                onMouseLeave: this.boundMouseLeave\r\n            }, React.DOM.span({ style: { opacity: opacity } }, this.props.label));\r\n        };\r\n        HeaderLink.displayName = 'HeaderLink';\r\n        HeaderLink.element = React.createFactory(HeaderLink);\r\n        HeaderLink.linkStyle = {\r\n            textDecoration: 'none',\r\n            display: 'inline-block',\r\n            fontFamily: VizPortalReact.CommonStyles.Fonts.HeaderFont,\r\n            fontSize: VizPortalReact.CommonStyles.Sizes.HeaderFontSize,\r\n            letterSpacing: VizPortalReact.HeaderStyles.LetterSpacing\r\n        };\r\n        return HeaderLink;\r\n    })(React.Component);\r\n    VizPortalReact.HeaderLink = HeaderLink;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/CommonStyles.ts\" />\r\n/// <reference path=\"../ServerUrls.ts\" />\r\n/// <reference path=\"../SiteUrls.ts\" />\r\n/// <reference path=\"HeaderLink.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var Navigation = (function (_super) {\r\n        __extends(Navigation, _super);\r\n        function Navigation() {\r\n            _super.apply(this, arguments);\r\n        }\r\n        Navigation.prototype.render = function () {\r\n            var _this = this;\r\n            var navLinks = Navigation.isServerLocation(this.props.currentLocation)\r\n                ? this.serverLinks()\r\n                : this.siteLinks();\r\n            var links = _.map(navLinks, function (link) {\r\n                return VizPortalReact.HeaderLink.element({\r\n                    key: link.label,\r\n                    label: link.label,\r\n                    url: link.url,\r\n                    isSelected: _this.props.currentLocation === link.location,\r\n                    style: Navigation.linkStyle\r\n                });\r\n            });\r\n            // The dividers at the left and right of the navigation links are implemented\r\n            // with background images on nested divs. The reason for this is so when the far\r\n            // left and right links are selected or hovered, their background color covers\r\n            // up the divider.\r\n            var linksWrapper = React.DOM.div({\r\n                style: {\r\n                    background: this.props.hideRightDivider ? 'inherit' : 'url(img/' + VizPortalReact.HeaderStyles.HeaderDividerImage + ') right center no-repeat'\r\n                }\r\n            }, links);\r\n            return React.DOM.div({ style: Navigation.containerStyle }, linksWrapper);\r\n        };\r\n        Navigation.prototype.siteLinks = function () {\r\n            var siteLinks = [];\r\n            if (VizPortal.FeatureFlags.homePlaceEnabled) {\r\n                siteLinks.push({\r\n                    label: this.props.translate('home'),\r\n                    location: Navigation.Location.SiteHome,\r\n                    url: this.props.siteUrls.home()\r\n                });\r\n            }\r\n            siteLinks = siteLinks.concat([\r\n                {\r\n                    label: this.props.translate('content'),\r\n                    location: Navigation.Location.SiteContent,\r\n                    url: this.props.siteUrls.projectsUrl()\r\n                },\r\n                {\r\n                    label: this.props.translate('users'),\r\n                    location: Navigation.Location.SiteUsers,\r\n                    url: this.props.siteUrls.usersUrl()\r\n                },\r\n                {\r\n                    label: this.props.translate('groups'),\r\n                    location: Navigation.Location.SiteGroups,\r\n                    url: this.props.siteUrls.groupsUrl()\r\n                },\r\n                {\r\n                    label: this.props.translate('schedules'),\r\n                    location: Navigation.Location.SiteSchedules,\r\n                    url: this.props.siteUrls.schedulesUrl()\r\n                },\r\n                {\r\n                    label: this.props.translate('tasks'),\r\n                    location: Navigation.Location.SiteTasks,\r\n                    url: this.props.siteUrls.tasksUrl()\r\n                },\r\n                {\r\n                    label: this.props.translate('status'),\r\n                    location: Navigation.Location.SiteStatus,\r\n                    url: this.props.siteUrls.statusUrl()\r\n                },\r\n                {\r\n                    label: this.props.translate('settings'),\r\n                    location: Navigation.Location.SiteSettings,\r\n                    url: this.props.siteUrls.settingsUrl()\r\n                }\r\n            ]);\r\n            return siteLinks;\r\n        };\r\n        Navigation.prototype.serverLinks = function () {\r\n            return [\r\n                {\r\n                    label: this.props.translate('sites'),\r\n                    location: Navigation.Location.ServerSites,\r\n                    url: this.props.serverUrls.sitesUrl()\r\n                },\r\n                {\r\n                    label: this.props.translate('users'),\r\n                    location: Navigation.Location.ServerUsers,\r\n                    url: this.props.serverUrls.usersUrl()\r\n                },\r\n                {\r\n                    label: this.props.translate('schedules'),\r\n                    location: Navigation.Location.ServerSchedules,\r\n                    url: this.props.serverUrls.schedules()\r\n                },\r\n                {\r\n                    label: this.props.translate('tasks'),\r\n                    location: Navigation.Location.ServerTasks,\r\n                    url: this.props.serverUrls.tasks()\r\n                },\r\n                {\r\n                    label: this.props.translate('status'),\r\n                    location: Navigation.Location.ServerStatus,\r\n                    url: this.props.serverUrls.status()\r\n                },\r\n                {\r\n                    label: this.props.translate('settings'),\r\n                    location: Navigation.Location.ServerSettings,\r\n                    url: this.props.serverUrls.settings()\r\n                }\r\n            ];\r\n        };\r\n        Navigation.displayName = 'Navigation';\r\n        Navigation.element = React.createFactory(Navigation);\r\n        Navigation.linkPadding = 15;\r\n        Navigation.linkStyle = {\r\n            paddingLeft: Navigation.linkPadding,\r\n            paddingRight: Navigation.linkPadding\r\n        };\r\n        Navigation.containerStyle = {\r\n            background: 'url(img/' + VizPortalReact.HeaderStyles.HeaderDividerImage + ') left center no-repeat',\r\n            marginLeft: Navigation.linkPadding,\r\n            marginRight: Navigation.linkPadding,\r\n            lineHeight: '45px'\r\n        };\r\n        return Navigation;\r\n    })(React.Component);\r\n    VizPortalReact.Navigation = Navigation;\r\n    var Navigation;\r\n    (function (Navigation) {\r\n        // CAREFUL: if the Location enum values are re-ordered, be sure to update this function.\r\n        function isServerLocation(location) {\r\n            return location >= Location.ServerSites;\r\n        }\r\n        Navigation.isServerLocation = isServerLocation;\r\n        (function (Location) {\r\n            // If the Location is ever Unknown, we have a bug: a missing entry in\r\n            // TopBarCtrl.stateNameToNavigationLocationMap.\r\n            Location[Location[\"Unknown\"] = 0] = \"Unknown\";\r\n            // Site locations\r\n            Location[Location[\"SiteHome\"] = 1] = \"SiteHome\";\r\n            Location[Location[\"SiteContent\"] = 2] = \"SiteContent\";\r\n            Location[Location[\"SiteUsers\"] = 3] = \"SiteUsers\";\r\n            Location[Location[\"SiteGroups\"] = 4] = \"SiteGroups\";\r\n            Location[Location[\"SiteSchedules\"] = 5] = \"SiteSchedules\";\r\n            Location[Location[\"SiteTasks\"] = 6] = \"SiteTasks\";\r\n            Location[Location[\"SiteStatus\"] = 7] = \"SiteStatus\";\r\n            Location[Location[\"SiteSettings\"] = 8] = \"SiteSettings\";\r\n            // Server locations\r\n            Location[Location[\"ServerSites\"] = 9] = \"ServerSites\";\r\n            Location[Location[\"ServerUsers\"] = 10] = \"ServerUsers\";\r\n            Location[Location[\"ServerSchedules\"] = 11] = \"ServerSchedules\";\r\n            Location[Location[\"ServerTasks\"] = 12] = \"ServerTasks\";\r\n            Location[Location[\"ServerStatus\"] = 13] = \"ServerStatus\";\r\n            Location[Location[\"ServerSettings\"] = 14] = \"ServerSettings\";\r\n        })(Navigation.Location || (Navigation.Location = {}));\r\n        var Location = Navigation.Location;\r\n    })(Navigation = VizPortalReact.Navigation || (VizPortalReact.Navigation = {}));\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"resourceParts.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/IAlert.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        ServerApi.AlertTarget = {\r\n            datasource: 'datasource',\r\n            workbook: 'workbook'\r\n        };\r\n        var GetAlertRequest = (function (_super) {\r\n            __extends(GetAlertRequest, _super);\r\n            function GetAlertRequest(params) {\r\n                _super.call(this, 'getAlert', params);\r\n            }\r\n            return GetAlertRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetAlertRequest = GetAlertRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/IAlert.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetUserAlertListRequest = (function (_super) {\r\n            __extends(GetUserAlertListRequest, _super);\r\n            function GetUserAlertListRequest(params) {\r\n                if (params === void 0) { params = {}; }\r\n                _super.call(this, 'getUserAlertList', params);\r\n            }\r\n            return GetUserAlertListRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetUserAlertListRequest = GetUserAlertListRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/ServerModelHelper.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetAlertRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetUserAlertListRequest.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var Alerts = (function () {\r\n        function Alerts(ServerService) {\r\n            this.ServerService = ServerService;\r\n        }\r\n        Alerts.prototype.getCount = function () {\r\n            return this.ServerService.sendRequest(new VizPortal.ServerApi.GetUserAlertCountRequest())\r\n                .then(function (result) {\r\n                return result.totalCount;\r\n            });\r\n        };\r\n        Alerts.prototype.getList = function () {\r\n            return this.ServerService.sendRequest(new VizPortal.ServerApi.GetUserAlertListRequest())\r\n                .then(function (result) {\r\n                return VizPortal.ServerApiMapper.alertList(result);\r\n            });\r\n        };\r\n        Alerts.prototype.getForDatasource = function (id) {\r\n            return this.getForType(VizPortal.ServerApi.AlertTarget.datasource, id);\r\n        };\r\n        Alerts.prototype.getForWorkbook = function (id) {\r\n            return this.getForType(VizPortal.ServerApi.AlertTarget.workbook, id);\r\n        };\r\n        Alerts.prototype.getForType = function (type, id) {\r\n            return this.ServerService.sendRequest(new VizPortal.ServerApi.GetAlertRequest({\r\n                targetType: type,\r\n                targetId: id\r\n            })).then(function (result) {\r\n                return VizPortal.ServerApiMapper.alertList(result);\r\n            });\r\n        };\r\n        Alerts.$inject = [\r\n            'ServerService'\r\n        ];\r\n        return Alerts;\r\n    })();\r\n    VizPortal.Alerts = Alerts;\r\n    VizPortal.Module.instance().service('Alerts', Alerts);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetGettingStartedNotificationsRequest = (function (_super) {\r\n            __extends(GetGettingStartedNotificationsRequest, _super);\r\n            function GetGettingStartedNotificationsRequest(params) {\r\n                _super.call(this, 'getGettingStartedNotifications', params);\r\n            }\r\n            return GetGettingStartedNotificationsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetGettingStartedNotificationsRequest = GetGettingStartedNotificationsRequest;\r\n        var SetSuppressGettingStartedNotification = (function (_super) {\r\n            __extends(SetSuppressGettingStartedNotification, _super);\r\n            function SetSuppressGettingStartedNotification(params) {\r\n                _super.call(this, 'setSuppressGettingStartedNotifications', params);\r\n            }\r\n            return SetSuppressGettingStartedNotification;\r\n        })(ServerApi.Request);\r\n        ServerApi.SetSuppressGettingStartedNotification = SetSuppressGettingStartedNotification;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetGettingStartedNotificationsRequest.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var GettingStartedNotifications = (function () {\r\n        function GettingStartedNotifications($sce, $q, $window, $rootScope, $state, modal, ServerService) {\r\n            this.$sce = $sce;\r\n            this.$q = $q;\r\n            this.$window = $window;\r\n            this.$rootScope = $rootScope;\r\n            this.$state = $state;\r\n            this.modal = modal;\r\n            this.ServerService = ServerService;\r\n            this.notificationsShown = false;\r\n            this.notificationsEnabled = false;\r\n        }\r\n        GettingStartedNotifications.prototype.enableNotifications = function () {\r\n            this.notificationsEnabled = true;\r\n        };\r\n        GettingStartedNotifications.prototype.forceShowNotifications = function () {\r\n            return this.showNotifications({ checkUserPrefs: false });\r\n        };\r\n        GettingStartedNotifications.prototype.showNotificationsIfEnabled = function () {\r\n            var _this = this;\r\n            // Don't show notifications if we're going to a viz state\r\n            if (!this.notificationsEnabled || this.notificationsShown || this.$state.is('main.site.viz')) {\r\n                return this.$q.when(null);\r\n            }\r\n            return this.showNotifications({ checkUserPrefs: true })\r\n                .fin(function () { return _this.notificationsShown = true; }); // Suppress in case of future $state.hardReload()\r\n        };\r\n        GettingStartedNotifications.prototype.shouldShowGettingStartedLink = function () {\r\n            return this.fetchNotificationsUrl({ checkUserPrefs: false }).then(function (url) { return !!url; });\r\n        };\r\n        GettingStartedNotifications.prototype.showNotifications = function (params) {\r\n            var _this = this;\r\n            return this.fetchNotificationsUrl(params).then(function (url) {\r\n                if (!url) {\r\n                    return;\r\n                }\r\n                var templateUrl = 'gettingStartedNotifications.html';\r\n                var scope = _this.$rootScope.$new();\r\n                var eventNamespace = '.gettingStartedNotification' + scope.$id;\r\n                var host = _this.getHostName(url);\r\n                url += '?' + $.param({ __displayName: _this.ServerService.sessionUserDisplayName() });\r\n                scope.notificationsUrl = _this.$sce.trustAsResourceUrl(url);\r\n                scope.dialog = {\r\n                    showNotificationsOnLogIn: true\r\n                };\r\n                var modalInstance = _this.modal.open({\r\n                    scope: scope,\r\n                    templateUrl: templateUrl,\r\n                    size: VizPortal.ModalSize.fitToContent,\r\n                    classes: 'tb-modal-external-content',\r\n                    backdropClasses: 'tb-backdrop-dark',\r\n                    closeX: false,\r\n                    resolve: {\r\n                        // Pre-load the dialog body template to avoid flickering/re-layout\r\n                        bodyTemplate: ['$http', '$templateCache',\r\n                            function ($http, $templateCache) {\r\n                                return $http.get(templateUrl, { cache: $templateCache });\r\n                            }]\r\n                    },\r\n                    tbTestId: 'getting-started-notifications-modal'\r\n                });\r\n                $(_this.$window).on('message' + eventNamespace, function (evt) {\r\n                    var originalEvt = evt.originalEvent;\r\n                    var originHost = _this.getHostName(originalEvt.origin);\r\n                    if (originHost && originHost === host &&\r\n                        originalEvt.data === GettingStartedNotifications.CloseModalMessage) {\r\n                        modalInstance.dismiss();\r\n                    }\r\n                });\r\n                scope.$on('$destroy', function () {\r\n                    $(_this.$window).off(eventNamespace);\r\n                });\r\n                return modalInstance.result\r\n                    .fin(function () { return _this.updateUserPreference(scope); })\r\n                    .fin(function () { return scope.$destroy(); });\r\n            });\r\n        };\r\n        GettingStartedNotifications.prototype.getHostName = function (url) {\r\n            var urlParsingNode = document.createElement('a');\r\n            urlParsingNode.setAttribute('href', url);\r\n            return urlParsingNode.hostname;\r\n        };\r\n        GettingStartedNotifications.prototype.fetchNotificationsUrl = function (params) {\r\n            return this.ServerService.sendRequest(new VizPortal.ServerApi.GetGettingStartedNotificationsRequest(params))\r\n                .then(function (result) { return result.contentUrl; });\r\n        };\r\n        GettingStartedNotifications.prototype.updateUserPreference = function (scope) {\r\n            return this.ServerService.sendRequest(new VizPortal.ServerApi.SetSuppressGettingStartedNotification({\r\n                suppressGettingStartedNotifications: !scope.dialog.showNotificationsOnLogIn\r\n            }));\r\n        };\r\n        GettingStartedNotifications.CloseModalMessage = 'tableau.closeModal';\r\n        GettingStartedNotifications.$inject = ['$sce', '$q', '$window', '$rootScope', '$state', 'ModalService', 'ServerService'];\r\n        return GettingStartedNotifications;\r\n    })();\r\n    VizPortal.GettingStartedNotifications = GettingStartedNotifications;\r\n    VizPortal.Module.instance().service('GettingStartedNotifications', GettingStartedNotifications);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var LogoService = (function () {\r\n        function LogoService(server, startPageService) {\r\n            this.server = server;\r\n            this.startPageService = startPageService;\r\n            this.serverCustomization = server.serverCustomization();\r\n            this.siteCustomization = function () { return server.siteLogo(); };\r\n            this.isSiteCustomizationEnabled = server.isSiteCustomizationEnabled();\r\n        }\r\n        LogoService.prototype.resetSiteLogoToDefault = function () {\r\n            return this.server.updateSiteLogo(undefined, true);\r\n        };\r\n        LogoService.prototype.uploadSiteLogo = function (file) {\r\n            return this.server.updateSiteLogo(file, false);\r\n        };\r\n        LogoService.prototype.isUsingCustomSiteLogo = function () {\r\n            return this.siteCustomization() && this.siteCustomization().useCustomLogo && this.isSiteCustomizationEnabled;\r\n        };\r\n        LogoService.prototype.getTopBarLogo = function () {\r\n            if (this.isUsingCustomSiteLogo()) {\r\n                return this.getSiteCustomLogo();\r\n            }\r\n            else {\r\n                return this.getServerTopBarLogo();\r\n            }\r\n        };\r\n        LogoService.prototype.getServerTopBarLogo = function () {\r\n            if (this.serverCustomization && this.serverCustomization.useCustomLogo) {\r\n                return this.getServerCustomLogo();\r\n            }\r\n            else {\r\n                return {\r\n                    image: LogoService.DefaultTopBarLogoImage + '?' + VizPortal.BuildId,\r\n                    width: LogoService.DefaultTopBarLogoWidth,\r\n                    height: LogoService.DefaultTopBarLogoHeight,\r\n                    href: this.getStartPageHref(),\r\n                    title: this.server.serverName()\r\n                };\r\n            }\r\n        };\r\n        LogoService.prototype.getSignInLogo = function () {\r\n            if (this.serverCustomization && this.serverCustomization.useCustomLogo) {\r\n                return this.getServerCustomLogo();\r\n            }\r\n            else {\r\n                return {\r\n                    image: LogoService.DefaultSignInLogoImage + '?' + VizPortal.BuildId,\r\n                    width: LogoService.DefaultSignInLogoWidth,\r\n                    height: LogoService.DefaultSignInLogoHeight,\r\n                    href: '',\r\n                    title: this.server.serverName()\r\n                };\r\n            }\r\n        };\r\n        LogoService.prototype.getStartPageHref = function () {\r\n            return '#' + this.startPageService.getCurrentUserStartPageForCurrentSite();\r\n        };\r\n        LogoService.prototype.getServerCustomLogo = function () {\r\n            return {\r\n                image: this.serverCustomization.customLogoPath,\r\n                width: Math.min(Math.max(this.serverCustomization.customLogoWidth, 0), LogoService.MaximumLogoWidth),\r\n                height: Math.min(Math.max(this.serverCustomization.customLogoHeight, 0), LogoService.MaximumLogoHeight),\r\n                href: this.serverCustomization.customLogoLink || this.getStartPageHref(),\r\n                title: this.server.serverName()\r\n            };\r\n        };\r\n        LogoService.prototype.getSiteCustomLogo = function () {\r\n            var siteCustomization = this.siteCustomization();\r\n            return {\r\n                image: siteCustomization.customLogoPath,\r\n                width: Math.min(Math.max(siteCustomization.customLogoWidth, 0), LogoService.MaximumLogoWidth),\r\n                height: Math.min(Math.max(siteCustomization.customLogoHeight, 0), LogoService.MaximumLogoHeight),\r\n                href: siteCustomization.customLogoLink || this.getStartPageHref(),\r\n                title: this.server.sessionSiteName()\r\n            };\r\n        };\r\n        LogoService.DefaultSignInLogoImage = 'img/tableau_sign_in_logo.png';\r\n        LogoService.DefaultSignInLogoWidth = 277;\r\n        LogoService.DefaultSignInLogoHeight = 58;\r\n        LogoService.DefaultTopBarLogoImage = 'img/tableau_mono_logo.png';\r\n        LogoService.DefaultTopBarLogoWidth = 132;\r\n        LogoService.DefaultTopBarLogoHeight = 27;\r\n        // These maximums are known by tabadmin.\r\n        LogoService.MaximumLogoWidth = 160;\r\n        LogoService.MaximumLogoHeight = 160;\r\n        LogoService.$inject = [\r\n            'ServerService',\r\n            'StartPageService'\r\n        ];\r\n        return LogoService;\r\n    })();\r\n    VizPortal.LogoService = LogoService;\r\n    VizPortal.Module.instance().service('LogoService', LogoService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../../app/header/Navigation.ts\" />\r\n/// <reference path=\"../actions/UserSettingsActions.ts\" />\r\n/// <reference path=\"../controllers/AngularCtrl.ts\" />\r\n/// <reference path=\"../resources/Alerts.ts\" />\r\n/// <reference path=\"../resources/Favorites.ts\" />\r\n/// <reference path=\"../resources/SiteNameSansIds.ts\" />\r\n/// <reference path=\"../services/DisplaySettingsService.ts\" />\r\n/// <reference path=\"../services/GettingStartedNotifications.ts\" />\r\n/// <reference path=\"../services/HelpService.ts\" />\r\n/// <reference path=\"../services/LogoService.ts\" />\r\n/// <reference path=\"../services/ModalService.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\n/// <reference path=\"../services/SiteSwitchService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.TopBarEvents = {\r\n        HeightChanged: 'HeightChanged'\r\n    };\r\n    var TopBarCtrl = (function () {\r\n        function TopBarCtrl($rootScope, $scope, $state, $timeout, server, SiteSwitchService, LogoService, $translate, siteNames, favorites, angularContextFactory, alerts, extractTasks, userSettingsActions, help, gettingStartedNotifications, modalService, logoService, datasources, workbooks) {\r\n            this.$scope = $scope;\r\n            this.$state = $state;\r\n            this.server = server;\r\n            this.$translate = $translate;\r\n            this.siteNames = siteNames;\r\n            this.favorites = favorites;\r\n            this.angularContextFactory = angularContextFactory;\r\n            this.alerts = alerts;\r\n            this.extractTasks = extractTasks;\r\n            this.userSettingsActions = userSettingsActions;\r\n            this.help = help;\r\n            this.gettingStartedNotifications = gettingStartedNotifications;\r\n            this.modalService = modalService;\r\n            this.logoService = logoService;\r\n            this.datasources = datasources;\r\n            this.workbooks = workbooks;\r\n            $scope.logo = function () { return LogoService.getTopBarLogo(); };\r\n            $scope.inServerArea = function () { return $state.includes('main.server.**'); };\r\n            $scope.showServerSiteButtons = function () { return server.isSessionMultiSite() && server.isSessionServerAdmin(); };\r\n            $scope.showSiteSwitcher = function () { return server.isSessionMultiSite() && !$scope.inServerArea(); };\r\n            $scope.showSiteControls = function () { return !(server.isSessionMultiSite() && $scope.inServerArea()); };\r\n            $scope.showNav = function () { return server.isSessionSiteOrServerAdmin(); };\r\n            var updateHeight = function (showNav) {\r\n                var newHeight = 0;\r\n                if (!$scope.settings.collapsed) {\r\n                    var logo = $scope.logo();\r\n                    var logoHeight = (logo && logo.height) ? logo.height : 0;\r\n                    newHeight = _.max([TopBarCtrl.MinTopBarHeight, logoHeight]) + 2 * TopBarCtrl.VerticalPadding;\r\n                    // Note that the React TopBar does not increase height when showNav is true\r\n                    if (showNav && !VizPortal.FeatureFlags.reactTopBar) {\r\n                        newHeight += TopBarCtrl.NavHeight;\r\n                    }\r\n                }\r\n                if ($scope.settings.height !== newHeight) {\r\n                    $scope.settings.height = newHeight;\r\n                    // Allow time for the elements to render and change size before triggering the event.\r\n                    $timeout(function () { return $rootScope.$broadcast(VizPortal.TopBarEvents.HeightChanged); });\r\n                }\r\n            };\r\n            $scope.$watch(function () { return $scope.settings.collapsed; }, function () { return updateHeight($scope.showNav()); });\r\n            $scope.$watch(function () { return $scope.showNav(); }, updateHeight);\r\n            // Watch for custom logo updates\r\n            $scope.$watch(function () { return $scope.logo().height; }, function () { return updateHeight($scope.showNav()); });\r\n            $scope.serverUrl = function () { return SiteSwitchService.serverUrl(); };\r\n            $scope.siteUrl = function () { return SiteSwitchService.siteUrl(); };\r\n            $scope.siteSelected = function (urlName) {\r\n                SiteSwitchService.switchToSite(urlName);\r\n            };\r\n            $scope.toggleCollapsed = function () {\r\n                $scope.settings.collapsed = !$scope.settings.collapsed;\r\n            };\r\n            $scope.server = server;\r\n            // Configure React TopBar\r\n            if (VizPortal.FeatureFlags.reactTopBar) {\r\n                this.configureReactTopBar();\r\n            }\r\n        }\r\n        TopBarCtrl.prototype.configureReactTopBar = function () {\r\n            var _this = this;\r\n            this.$scope.topBarProps = {\r\n                logo: this.logoService.getTopBarLogo(),\r\n                angularContext: this.angularContextFactory.create(this.$scope),\r\n                translate: this.$translate.instant,\r\n                siteStore: new VizPortalReact.SiteStore(this.siteNames),\r\n                favoritesStore: new VizPortalReact.FavoritesStore(this.favorites),\r\n                alertsStore: new VizPortalReact.AlertsStore(),\r\n                alertActions: new VizPortalReact.AlertActions(this.alerts, this.extractTasks, this.datasources, this.workbooks),\r\n                userActions: new VizPortalReact.UserActions(this.server, this.userSettingsActions),\r\n                user: this.server.sessionUserInfo(),\r\n                serverUrls: new VizPortalReact.ServerUrls(window.location.search),\r\n                navLocation: this.topBarLocationFromState(this.$state),\r\n                isLogoutEnabled: this.server.isLogoutEnabled(),\r\n                isSessionMultiSite: this.server.isSessionMultiSite(),\r\n                isSessionServerAdmin: this.server.isSessionServerAdmin(),\r\n                authenticationType: this.server.authenticationType(),\r\n                // Help menu\r\n                helpActions: new VizPortalReact.HelpActions(this.help, this.server, this.$scope, this.gettingStartedNotifications, this.modalService),\r\n                isOfflineHelpEnabled: this.server.offlineHelpEnabled(),\r\n                serverHelpLabel: this.$translate.instant(this.help.getHelpLinkLocKey()),\r\n                serverHelpUrl: this.help.getServerHelpUrlByCategory(),\r\n                supportUrl: this.help.getGeneralSupportUrl(),\r\n                serverName: this.server.serverName(),\r\n                showGettingStartedLink: false,\r\n                // Site is updated in updateSite() function below\r\n                currentSite: null,\r\n                siteUrls: null\r\n            };\r\n            // Update show/hide Getting Started menu item when user's admin status changes (e.g., site switch)\r\n            this.$scope.$watch(function () { return _this.server.isSessionSiteOrServerAdmin(); }, function () {\r\n                // $watch listener fn will always run (async) when first registered\r\n                _this.gettingStartedNotifications.shouldShowGettingStartedLink()\r\n                    .then(function (shouldShowLink) {\r\n                    _this.$scope.topBarProps = _.extend({}, _this.$scope.topBarProps, {\r\n                        showGettingStartedLink: shouldShowLink\r\n                    });\r\n                });\r\n            });\r\n            var updateSite = function () {\r\n                _this.$scope.topBarProps = _.extend({}, _this.$scope.topBarProps, {\r\n                    currentSite: _this.server.sessionSite(),\r\n                    siteUrls: new VizPortalReact.SiteUrls({\r\n                        siteUrlName: _this.server.sessionSiteUrlName(),\r\n                        queryString: window.location.search\r\n                    })\r\n                });\r\n            };\r\n            updateSite();\r\n            this.$scope.$watch(function () { return _this.server.sessionSiteUrlName(); }, updateSite);\r\n            // Update the navLocation when the state changes\r\n            this.$scope.$watch(function () { return _this.$state.current.name; }, function () {\r\n                _this.$scope.topBarProps = _.extend({}, _this.$scope.topBarProps, {\r\n                    navLocation: _this.topBarLocationFromState(_this.$state)\r\n                });\r\n            });\r\n        };\r\n        TopBarCtrl.prototype.topBarLocationFromState = function ($state) {\r\n            var matchingStateName = _.find(_.keys(TopBarCtrl.stateNameToNavigationLocationMap), function (stateName) { return $state.includes(stateName); });\r\n            if (!matchingStateName) {\r\n                console.error('Unexpected state: ' + $state.current.name);\r\n                return VizPortalReact.Navigation.Location.Unknown;\r\n            }\r\n            return TopBarCtrl.stateNameToNavigationLocationMap[matchingStateName];\r\n        };\r\n        // Should match $topBarVerticalPadding in topBar.styl.\r\n        TopBarCtrl.VerticalPadding = 9;\r\n        // Should match $topBarNavHeight in topBar.styl.\r\n        TopBarCtrl.NavHeight = 30;\r\n        // Should match $minimumPreviewBarHeight in updateSiteLogoForm.styl.\r\n        TopBarCtrl.MinTopBarHeight = 27;\r\n        TopBarCtrl.stateNameToNavigationLocationMap = {\r\n            'main.error': VizPortalReact.Navigation.Location.Unknown,\r\n            'main.site.content': VizPortalReact.Navigation.Location.SiteContent,\r\n            'main.site.home': VizPortalReact.Navigation.Location.SiteHome,\r\n            'main.site.group': VizPortalReact.Navigation.Location.SiteGroups,\r\n            'main.site.groups': VizPortalReact.Navigation.Location.SiteGroups,\r\n            'main.site.schedule': VizPortalReact.Navigation.Location.SiteSchedules,\r\n            'main.site.schedules': VizPortalReact.Navigation.Location.SiteSchedules,\r\n            'main.site.settings': VizPortalReact.Navigation.Location.SiteSettings,\r\n            'main.site.status': VizPortalReact.Navigation.Location.SiteStatus,\r\n            'main.site.tasks': VizPortalReact.Navigation.Location.SiteTasks,\r\n            'main.site.user': VizPortalReact.Navigation.Location.SiteUsers,\r\n            'main.site.users': VizPortalReact.Navigation.Location.SiteUsers,\r\n            'main.site.viz': VizPortalReact.Navigation.Location.SiteContent,\r\n            'main.server.analysis': VizPortalReact.Navigation.Location.ServerStatus,\r\n            'main.server.schedule': VizPortalReact.Navigation.Location.ServerSchedules,\r\n            'main.server.schedules': VizPortalReact.Navigation.Location.ServerSchedules,\r\n            'main.server.settings': VizPortalReact.Navigation.Location.ServerSettings,\r\n            'main.server.sites': VizPortalReact.Navigation.Location.ServerSites,\r\n            'main.server.status': VizPortalReact.Navigation.Location.ServerStatus,\r\n            'main.server.tasks': VizPortalReact.Navigation.Location.ServerTasks,\r\n            'main.server.user': VizPortalReact.Navigation.Location.ServerUsers,\r\n            'main.server.users': VizPortalReact.Navigation.Location.ServerUsers\r\n        };\r\n        TopBarCtrl.$inject = [\r\n            '$rootScope',\r\n            '$scope',\r\n            '$state',\r\n            '$timeout',\r\n            'ServerService',\r\n            'SiteSwitchService',\r\n            'LogoService',\r\n            '$translate',\r\n            'SiteNamesAcrossAllPods',\r\n            'Favorites',\r\n            'AngularContextFactory',\r\n            'Alerts',\r\n            'ExtractTasks',\r\n            'UserSettingsActions',\r\n            'HelpService',\r\n            'GettingStartedNotifications',\r\n            'ModalService',\r\n            'LogoService',\r\n            'DataSources',\r\n            'Workbooks'\r\n        ];\r\n        return TopBarCtrl;\r\n    })();\r\n    VizPortal.TopBarCtrl = TopBarCtrl;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../controllers/TopBarCtrl.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var hasMaxCssValue = function (maxCssValue) { return (maxCssValue !== 'none'); };\r\n    var hasMinCssValue = function (minCssValue) { return (parseInt(minCssValue, 10) !== 0 && minCssValue !== 'auto'); };\r\n    // Usage: tb:viz(viz=\"viz\"), where  $scope.viz is an IViz\r\n    //\r\n    // $scope.viz.path will be changed to reflect viz changes. You can $watch it\r\n    VizPortal.Module.instance().directive('tbViz', ['VizService', '$timeout',\r\n        function (VizService, $timeout) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'viz.html',\r\n                scope: {\r\n                    viz: '=',\r\n                    onVizSized: '&'\r\n                },\r\n                link: function ($scope, elm) {\r\n                    // Toolbar should always be on top in VizPortal\r\n                    var vizCreateOptions = {\r\n                        toolbarPosition: tableau.ToolbarPosition.TOP,\r\n                        instanceIdToClone: $scope.viz.instanceId,\r\n                        onFirstVizSizeKnown: function (evt) {\r\n                            // Set the viz size limits on the tbViz element\r\n                            var vizSize = evt.getVizSize();\r\n                            var sheetSize = vizSize.sheetSize;\r\n                            // Note: Don't overwrite styles imposed from the outside\r\n                            if (sheetSize.minSize) {\r\n                                if (_.isNumber(sheetSize.minSize.height) && !hasMinCssValue(elm.css('minHeight'))) {\r\n                                    elm.css('minHeight', sheetSize.minSize.height + (vizSize.chromeHeight || 0));\r\n                                }\r\n                                if (_.isNumber(sheetSize.minSize.width) && !hasMinCssValue(elm.css('minWidth'))) {\r\n                                    elm.css('minWidth', sheetSize.minSize.width);\r\n                                }\r\n                            }\r\n                            if (sheetSize.maxSize) {\r\n                                if (_.isNumber(sheetSize.maxSize.height) && !hasMaxCssValue(elm.css('maxHeight'))) {\r\n                                    elm.css('maxHeight', sheetSize.maxSize.height + (vizSize.chromeHeight || 0));\r\n                                }\r\n                                if (_.isNumber(sheetSize.maxSize.width) && !hasMaxCssValue(elm.css('maxWidth'))) {\r\n                                    elm.css('maxWidth', sheetSize.maxSize.width);\r\n                                }\r\n                            }\r\n                            $scope.$apply($scope.onVizSized);\r\n                        },\r\n                        onFirstInteractive: function () {\r\n                            $scope.$apply(function () {\r\n                                $scope.viz.instanceId = viz.getInstanceId();\r\n                            });\r\n                        }\r\n                    };\r\n                    // Include any custom viz parameters in the viz create options\r\n                    var params = _.extend(vizCreateOptions, $scope.viz.params);\r\n                    params[':openAuthoringInTopWindow'] = true;\r\n                    params[':browserBackButtonUndo'] = true;\r\n                    params[':reloadOnCustomViewSave'] = true;\r\n                    params[':showShareOptions'] = true;\r\n                    var uri = VizService.getUri($scope.viz);\r\n                    var viz = new tableau.Viz(elm.get(0), uri, params);\r\n                    $scope.$on(VizPortal.TopBarEvents.HeightChanged, function () {\r\n                        viz.refreshSize();\r\n                    });\r\n                    // Ensure we remove the viz when navigating away\r\n                    $scope.$on('$destroy', function () { return viz.dispose(); });\r\n                    // note: The event handlers below are to update the url from changes in the viz, such as tab\r\n                    // switches or custom view loads. Ideally the JS API would tell us when the url changes in a\r\n                    // URL_CHANGED event, but we didn't have enough time to do that for 9.0.\r\n                    // warning: the custom view events fire at very strange times, for example see BUGZID: 132554\r\n                    var urlChangeEvents = [\r\n                        tableau.TableauEventName.CUSTOM_VIEW_LOAD,\r\n                        tableau.TableauEventName.CUSTOM_VIEW_SAVE,\r\n                        tableau.TableauEventName.TAB_SWITCH\r\n                    ];\r\n                    _.each(urlChangeEvents, function (eventName) {\r\n                        viz.addEventListener(eventName, function (e) {\r\n                            viz.getCurrentUrlAsync().then(function (url) {\r\n                                $scope.$apply(function () {\r\n                                    $scope.viz.instanceId = viz.getInstanceId();\r\n                                    $scope.viz.path = VizService.getPath(url);\r\n                                    $scope.viz.isExplicitOriginalViz = VizService.getIsExplicitOriginalVizFromUrl(url);\r\n                                });\r\n                            });\r\n                        });\r\n                    });\r\n                }\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/IExtractTask.ts\" />\r\n/// <reference path=\"../types/IResponse.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var UpdateCommentRequest = (function (_super) {\r\n            __extends(UpdateCommentRequest, _super);\r\n            function UpdateCommentRequest(params) {\r\n                _super.call(this, 'updateComment', params);\r\n            }\r\n            return UpdateCommentRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.UpdateCommentRequest = UpdateCommentRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/IExtractTask.ts\" />\r\n/// <reference path=\"../types/IResponse.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var DeleteCommentRequest = (function (_super) {\r\n            __extends(DeleteCommentRequest, _super);\r\n            function DeleteCommentRequest(params) {\r\n                _super.call(this, 'deleteComment', params);\r\n            }\r\n            return DeleteCommentRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.DeleteCommentRequest = DeleteCommentRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/IExtractTask.ts\" />\r\n/// <reference path=\"../types/IResponse.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var CreateCommentRequest = (function (_super) {\r\n            __extends(CreateCommentRequest, _super);\r\n            function CreateCommentRequest(params) {\r\n                _super.call(this, 'createComment', params);\r\n            }\r\n            return CreateCommentRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.CreateCommentRequest = CreateCommentRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../fetchers/IListFetcher.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetCommentsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/UpdateCommentRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/DeleteCommentRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/CreateCommentRequest.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\n/// <reference path=\"Resource.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var Comments = (function (_super) {\r\n        __extends(Comments, _super);\r\n        function Comments(ErrorNotifyingServer, FetcherFactory) {\r\n            _super.call(this, FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetCommentsRequest, VizPortal.ServerApiMapper.comments));\r\n            this.ErrorNotifyingServer = ErrorNotifyingServer;\r\n            this.commentFetcher = FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetCommentsRequest, VizPortal.ServerApiMapper.comments);\r\n        }\r\n        Comments.prototype.createComment = function (viewId, text) {\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.CreateCommentRequest({\r\n                viewId: viewId,\r\n                text: text\r\n            }));\r\n        };\r\n        Comments.prototype.getSliceableCommentsForViz = function (viewId) {\r\n            var _this = this;\r\n            return {\r\n                getSlice: function (start, size) { return _this.commentFetcher.fetchList({\r\n                    viewId: viewId, page: VizPortal.ResourceQuery.getPage(start, size)\r\n                }); }\r\n            };\r\n        };\r\n        Comments.prototype.editComment = function (commentId, commentText) {\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.UpdateCommentRequest({\r\n                id: commentId,\r\n                text: commentText\r\n            }));\r\n        };\r\n        Comments.prototype.deleteComment = function (commentId) {\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.DeleteCommentRequest({\r\n                id: commentId\r\n            }));\r\n        };\r\n        Comments.$inject = ['ErrorNotifyingServer', 'FetcherFactory'];\r\n        return Comments;\r\n    })(VizPortal.Resource);\r\n    VizPortal.Comments = Comments;\r\n    VizPortal.Module.instance().service('Comments', Comments);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../models/ICommentInfo.ts\" />\r\n/// <reference path=\"../resources/Comments.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DeleteCommentActions = (function () {\r\n        function DeleteCommentActions($translate, ConfirmActionDialog, Comments, toaster) {\r\n            this.$translate = $translate;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.Comments = Comments;\r\n            this.toaster = toaster;\r\n        }\r\n        DeleteCommentActions.prototype.deleteComment = function (commentToDelete, $event) {\r\n            return this.showDeleteCommentDialog(commentToDelete, VizPortal.ActionContext.fromEvent($event));\r\n        };\r\n        DeleteCommentActions.prototype.showDeleteCommentDialog = function (comment, context) {\r\n            var _this = this;\r\n            var dialogInstance = this.ConfirmActionDialog.open({\r\n                scope: context.scope,\r\n                title: this.$translate.instant('delete'),\r\n                bodyText: this.$translate.instant('confirmDeleteComment'),\r\n                actionName: this.$translate.instant('confirmDeleteButton', { ITEM_COUNT: 1 }, VizPortal.L10n.Interpolations.Count),\r\n                isDeleteAction: true,\r\n                action: function () { return _this.Comments.deleteComment(comment.id); }\r\n            });\r\n            dialogInstance.result.then(function (result) {\r\n                if (!!result.errors) {\r\n                    _this.toaster.pop({ type: VizPortal.ToastType.Error, text: _this.$translate.instant('deleteFailed') });\r\n                }\r\n                else {\r\n                    _this.toaster.pop({ type: VizPortal.ToastType.Info, text: _this.$translate.instant('commentDeleted') });\r\n                }\r\n            });\r\n            return dialogInstance.result;\r\n        };\r\n        DeleteCommentActions.$inject = ['$translate',\r\n            'ConfirmActionDialog',\r\n            'Comments',\r\n            'ToasterService'];\r\n        return DeleteCommentActions;\r\n    })();\r\n    VizPortal.DeleteCommentActions = DeleteCommentActions;\r\n    VizPortal.Module.instance().service('DeleteCommentActions', DeleteCommentActions);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../controllers/ErrorCtrl.ts\" />\r\n/// <reference path=\"../directives/tbViz.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\n/// <reference path=\"../models/IViewInfo.ts\" />\r\n/// <reference path=\"../models/Viz.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../resources/Comments.ts\" />\r\n/// <reference path=\"../resources/Favorites.ts\" />\r\n/// <reference path=\"../resources/Views.ts\" />\r\n/// <reference path=\"../services/BreadcrumbsService.ts\" />\r\n/// <reference path=\"../services/BrowserTitleService.ts\" />\r\n/// <reference path=\"../services/ContentActions.ts\" />\r\n/// <reference path=\"../services/DeleteCommentActions.ts\" />\r\n/// <reference path=\"../services/VizService.ts\" />\r\n/// <reference path=\"../services/WindowLocationService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var VizViewerCtrl = (function () {\r\n        function VizViewerCtrl($scope, $state, $q, $stateParams, breadcrumbs, BrowserTitleService, comments, contentActions, deleteCommentActions, views, server, vizService, Favorites, BrowserSupportService, windowLocationService) {\r\n            var _this = this;\r\n            this.$scope = $scope;\r\n            this.$q = $q;\r\n            this.breadcrumbs = breadcrumbs;\r\n            this.BrowserTitleService = BrowserTitleService;\r\n            this.comments = comments;\r\n            this.contentActions = contentActions;\r\n            this.views = views;\r\n            this.server = server;\r\n            // Initial viz state\r\n            $scope.viz = {\r\n                path: $stateParams.path,\r\n                isAdminViz: false,\r\n                params: vizService.getVizParams(),\r\n                siteUrlName: server.sessionSiteUrlName(),\r\n                instanceId: vizService.getInstanceId(),\r\n                isExplicitOriginalViz: vizService.getIsExplicitOriginalViz()\r\n            };\r\n            $scope.onVizSized = function () { return $scope.vizInitialized = true; };\r\n            $scope.vizProps = {};\r\n            $scope.commentsAndTagsInitialized = false;\r\n            $scope.contentBreadcrumbUrl = function () { return breadcrumbs.siteUrl\r\n                ? '#' + breadcrumbs.siteUrl\r\n                : $state.href('main.site.content.site.projects'); };\r\n            $scope.projectBreadcrumbUrl = function () { return breadcrumbs.projectUrl\r\n                ? '#' + breadcrumbs.projectUrl\r\n                : $state.href('main.site.content.project.workbooks', { id: $scope.vizProps.view.workbook.project.id }); };\r\n            $scope.workbookBreadcrumbUrl = function () { return breadcrumbs.workbookUrl\r\n                ? '#' + breadcrumbs.workbookUrl\r\n                : $state.href('main.site.content.workbook.views', { id: $scope.vizProps.view.workbook.id }); };\r\n            $scope.addFavorite = function () { return Favorites.addView($scope.vizProps.view); };\r\n            $scope.removeFavorite = function () { return Favorites.removeView($scope.vizProps.view); };\r\n            function getByPathError() {\r\n                var vizErrorState = {\r\n                    detailsLocKey: 'viewCannotBeAccessed',\r\n                    redirectState: 'main.site.content.site.views',\r\n                    redirectLocKey: 'backToViews'\r\n                };\r\n                $state.go('main.error', vizErrorState);\r\n            }\r\n            $scope.$watch('viz.path', function (newPath) {\r\n                if (!newPath) {\r\n                    getByPathError();\r\n                    return;\r\n                }\r\n                vizService.updatePath($scope, { path: newPath });\r\n                _this.hasError = false;\r\n                views.getByPath(newPath)\r\n                    .then(function (viewInfo) { return _this.loadNewViewInfo(viewInfo); })\r\n                    .then(function () { return _this.$scope.commentsAndTagsInitialized = true; })\r\n                    .fail(function (errorCode) {\r\n                    // B153202 - If user does not have permission to view the viz they will get ViewNotFound error even if Guest does\r\n                    // have permission to view. So, if ViewNotFound error, Guest is enabled for the server, and user is not site or\r\n                    // server admin, automatically redirect to the embedded view in case Guest can view it (might still get a 404 page)\r\n                    if (errorCode === VizPortal.CommonErrorCode.ViewNotFound && server.isGuestEnabled() && !server.isSessionSiteOrServerAdmin()) {\r\n                        windowLocationService.navigateToWithoutAddingToHistory(vizService.getEmbeddedVizqlUrl());\r\n                    }\r\n                    else {\r\n                        getByPathError();\r\n                    }\r\n                });\r\n            });\r\n            $scope.$watch('viz.instanceId', function (newInstanceId) {\r\n                if (newInstanceId) {\r\n                    vizService.updateInstanceId($scope, newInstanceId);\r\n                }\r\n            });\r\n            $scope.$watch('viz.isExplicitOriginalViz', function (isExplicitOriginalViz) {\r\n                vizService.updateExplicitOriginalViz($scope, isExplicitOriginalViz);\r\n            });\r\n            // TODO: comments and tags should be broken out of here into there own views and controllers\r\n            $scope.changeTags = function (newTagsList) { return (_this.contentActions.setTagsOnView($scope.vizProps.view, newTagsList)\r\n                .then(function (result) {\r\n                return (result.errors && result.errors.length)\r\n                    ? $q.reject(result)\r\n                    : $q.when(result);\r\n            })\r\n                .then(function () { return views.getById($scope.vizProps.view.id).then(function (viewInfo) { return _this.loadNewViewInfo(viewInfo); }); })); };\r\n            $scope.increaseCommentList = function () {\r\n                _this.loadNewCommentInfo(VizViewerCtrl.COMMENT_PAGE_SIZE);\r\n            };\r\n            $scope.deleteComment = function (event, comment) {\r\n                $scope.deletingCommentId = comment.id;\r\n                deleteCommentActions.deleteComment(comment, event)\r\n                    .then(function () {\r\n                    $scope.comments.items = _.filter($scope.comments.items, function (item) { return (item.id !== comment.id); });\r\n                    _this.loadNewCommentInfo();\r\n                }).fin(function () { return $scope.deletingCommentId = \"\"; });\r\n            };\r\n            $scope.editComment = function (commentText, commentId) { return _this.comments.editComment(commentId, commentText)\r\n                .then(function () { return _this.loadNewCommentInfo(); }); };\r\n            $scope.createComment = function (newText) { return _this.comments.createComment($scope.vizProps.view.id, newText)\r\n                .then(function () { return _this.loadNewCommentInfo(1); }); };\r\n            $scope.canCurrentUserModifyComment = function (comment) {\r\n                return server.isSessionSiteOrServerAdmin() || _this.isCurrentUserId(comment.owner.id);\r\n            };\r\n            $scope.isTouch = function () { return BrowserSupportService.isTouch(); };\r\n            $scope.shouldShowWhoHasSeenThisView = function () {\r\n                return $scope.vizProps.view && (server.isSessionSiteOrServerAdmin() ||\r\n                    _this.isCurrentUserId($scope.vizProps.view.workbook.owner.id));\r\n            };\r\n            vizService.reloadOnLocationChange($scope);\r\n        }\r\n        VizViewerCtrl.prototype.isCurrentUserId = function (id) {\r\n            // TODO: figure out what this parseInt is for. It shouldn't be necessary.\r\n            return parseInt(this.server.sessionUserId(), 10) === parseInt(id, 10);\r\n        };\r\n        VizViewerCtrl.prototype.loadNewCommentInfo = function (numberOfAdditionalCommentToRequest) {\r\n            var _this = this;\r\n            if (numberOfAdditionalCommentToRequest === void 0) { numberOfAdditionalCommentToRequest = 0; }\r\n            return this.comments.getSliceableCommentsForViz(this.$scope.vizProps.view.id)\r\n                .getSlice(0, this.$scope.comments.items.length + numberOfAdditionalCommentToRequest)\r\n                .then(function (comments) {\r\n                _this.$scope.comments = comments;\r\n            });\r\n        };\r\n        VizViewerCtrl.prototype.loadNewViewInfo = function (viewInfo) {\r\n            var _this = this;\r\n            //TODO: Update viz meta data like comments and tags\r\n            this.BrowserTitleService.setVizTitle(viewInfo.name, viewInfo.workbook.name);\r\n            this.$scope.vizProps.view = viewInfo;\r\n            this.$scope.comments = new VizPortal.ListResult([]);\r\n            this.breadcrumbs.workbookChanged(viewInfo.workbook);\r\n            this.views.markRecentlyViewed(viewInfo.id);\r\n            return this.$q.all([\r\n                this.loadNewCommentInfo(VizViewerCtrl.COMMENT_PAGE_SIZE),\r\n                this.views.actions(viewInfo.id).then(function (actions) {\r\n                    _this.$scope.canSetTags = function () { return (actions.setTags); };\r\n                    _this.$scope.allowedAction = actions;\r\n                })\r\n            ]);\r\n        };\r\n        VizViewerCtrl.$inject = [\r\n            '$scope',\r\n            '$state',\r\n            '$q',\r\n            '$stateParams',\r\n            'BreadcrumbsService',\r\n            'BrowserTitleService',\r\n            'Comments',\r\n            'ContentActions',\r\n            'DeleteCommentActions',\r\n            'Views',\r\n            'ServerService',\r\n            'VizService',\r\n            'Favorites',\r\n            'BrowserSupportService',\r\n            'WindowLocationService'\r\n        ];\r\n        VizViewerCtrl.COMMENT_PAGE_SIZE = 10;\r\n        return VizViewerCtrl;\r\n    })();\r\n    VizPortal.VizViewerCtrl = VizViewerCtrl;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SettingsCoordinatorCtrl = (function () {\r\n        function SettingsCoordinatorCtrl(scope, $q, $translate, $state, toaster, server) {\r\n            var _this = this;\r\n            this.forms = [];\r\n            scope.server = server;\r\n            scope.forms = {\r\n                save: function () {\r\n                    var savePromises = _.map(_this.forms, function (form) { return form.save(); });\r\n                    var onSavePromises = _.map(_this.forms, function (form) {\r\n                        if (form.onSave)\r\n                            return form.onSave();\r\n                    });\r\n                    return $q.all(savePromises)\r\n                        .then(\r\n                    // Save success\r\n                    // Save success\r\n                    function () { return $q.all(onSavePromises).then(function () { return toaster.pop({ type: VizPortal.ToastType.Info, text: $translate.instant('settingsUpdateSuccess') }); }); }, \r\n                    // At least one save failed\r\n                    // At least one save failed\r\n                    function (error) { return toaster.pop({ type: VizPortal.ToastType.Error, text: $translate.instant('settingsUpdateFailure') }); });\r\n                },\r\n                cancel: function () {\r\n                    _.each(_this.forms, function (form) { return form.cancel(); });\r\n                    toaster.pop({ type: VizPortal.ToastType.Info, text: $translate.instant('settingsReverted') });\r\n                },\r\n                isBusy: function () { return _.some(_this.forms, function (form) { return form.isBusy(); }); },\r\n                isValid: function () { return _.every(_this.forms, function (form) { return form.isValid ? form.isValid() : true; }); },\r\n                isFormUnchanged: function () { return _.every(_this.forms, function (form) { return form.isFormUnchanged(); }); },\r\n                resetSettings: function () {\r\n                    _.each(_this.forms, function (form) {\r\n                        if (form.resetSettings)\r\n                            form.resetSettings();\r\n                    });\r\n                }\r\n            };\r\n            scope.showResetSettingsBtn = function () { return _.some(_this.forms, function (form) { return !!form.resetSettings; }); };\r\n        }\r\n        SettingsCoordinatorCtrl.prototype.registerFormState = function (state) {\r\n            this.forms.push(state);\r\n        };\r\n        SettingsCoordinatorCtrl.$inject = [\r\n            '$scope',\r\n            '$q',\r\n            '$translate',\r\n            '$state',\r\n            'ToasterService',\r\n            'ServerService'\r\n        ];\r\n        return SettingsCoordinatorCtrl;\r\n    })();\r\n    VizPortal.SettingsCoordinatorCtrl = SettingsCoordinatorCtrl;\r\n    VizPortal.Module.instance().directive('tbSettingsCoordinator', function () {\r\n        return {\r\n            restrict: 'E',\r\n            replace: true,\r\n            transclude: true,\r\n            templateUrl: 'settingsCoordinator.html',\r\n            controller: SettingsCoordinatorCtrl\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../controllers/ExtractTasksCtrl.ts\" />\r\n/// <reference path=\"../controllers/SubscriptionsCtrl.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ConfigHelper;\r\n    (function (ConfigHelper) {\r\n        var defaultResolveExtractTasksContext = ['ServerService', function (ServerService) {\r\n                return {\r\n                    modifyExtractTasksPermission: ServerService.isSessionSiteOrServerAdmin(),\r\n                    createExtractTaskFn: undefined\r\n                };\r\n            }];\r\n        function addExtractTasksState($stateProvider, parentName, resolveExtractTasksContext) {\r\n            $stateProvider\r\n                .state(parentName + '.extractTasks', {\r\n                url: '/extractRefreshes',\r\n                templateUrl: 'extractTasks.html',\r\n                resolve: {\r\n                    subplace: ['place', function (place) { return place.subplace('extractTasks'); }],\r\n                    extractTasksContext: resolveExtractTasksContext || defaultResolveExtractTasksContext\r\n                },\r\n                controller: VizPortal.ExtractTasksCtrl\r\n            });\r\n        }\r\n        ConfigHelper.addExtractTasksState = addExtractTasksState;\r\n        function addSubscriptionsState($stateProvider, parentName) {\r\n            $stateProvider\r\n                .state(parentName + '.subscriptions', {\r\n                url: '/subscriptions',\r\n                templateUrl: 'subscriptions.html',\r\n                resolve: {\r\n                    subplace: ['place', function (place) { return place.subplace('subscriptions'); }]\r\n                },\r\n                controller: VizPortal.SubscriptionsCtrl\r\n            });\r\n        }\r\n        ConfigHelper.addSubscriptionsState = addSubscriptionsState;\r\n        function addTaskSubstates($stateProvider, parentName) {\r\n            addExtractTasksState($stateProvider, parentName);\r\n            addSubscriptionsState($stateProvider, parentName);\r\n        }\r\n        ConfigHelper.addTaskSubstates = addTaskSubstates;\r\n    })(ConfigHelper = VizPortal.ConfigHelper || (VizPortal.ConfigHelper = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var CreateSiteRequest = (function (_super) {\r\n            __extends(CreateSiteRequest, _super);\r\n            function CreateSiteRequest(params) {\r\n                _super.call(this, 'createSite', params);\r\n            }\r\n            return CreateSiteRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.CreateSiteRequest = CreateSiteRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var DeleteSitesRequest = (function (_super) {\r\n            __extends(DeleteSitesRequest, _super);\r\n            function DeleteSitesRequest(params) {\r\n                _super.call(this, 'deleteSites', params);\r\n            }\r\n            return DeleteSitesRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.DeleteSitesRequest = DeleteSitesRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/IGetItemsParams.ts\" />\r\n/// <reference path=\"../types/IGetItemsResult.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetSitesRequest = (function (_super) {\r\n            __extends(GetSitesRequest, _super);\r\n            function GetSitesRequest(params) {\r\n                _super.call(this, 'getSites', params);\r\n            }\r\n            return GetSitesRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetSitesRequest = GetSitesRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var UpdateSiteAvailabilityRequest = (function (_super) {\r\n            __extends(UpdateSiteAvailabilityRequest, _super);\r\n            function UpdateSiteAvailabilityRequest(params) {\r\n                _super.call(this, 'updateSiteAvailability', params);\r\n            }\r\n            return UpdateSiteAvailabilityRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.UpdateSiteAvailabilityRequest = UpdateSiteAvailabilityRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var UpdateSiteSettingsForServerAdminRequest = (function (_super) {\r\n            __extends(UpdateSiteSettingsForServerAdminRequest, _super);\r\n            function UpdateSiteSettingsForServerAdminRequest(params) {\r\n                _super.call(this, 'updateSiteSettingsForServerAdmin', params);\r\n            }\r\n            return UpdateSiteSettingsForServerAdminRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.UpdateSiteSettingsForServerAdminRequest = UpdateSiteSettingsForServerAdminRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    (function (LongRunningActionState) {\r\n        LongRunningActionState[LongRunningActionState[\"Queued\"] = 0] = \"Queued\";\r\n        LongRunningActionState[LongRunningActionState[\"InProgress\"] = 1] = \"InProgress\";\r\n        LongRunningActionState[LongRunningActionState[\"Complete\"] = 2] = \"Complete\";\r\n    })(VizPortal.LongRunningActionState || (VizPortal.LongRunningActionState = {}));\r\n    var LongRunningActionState = VizPortal.LongRunningActionState;\r\n    ;\r\n    (function (LongRunningActionType) {\r\n        LongRunningActionType[LongRunningActionType[\"RebuildSearchIndex\"] = 0] = \"RebuildSearchIndex\";\r\n        LongRunningActionType[LongRunningActionType[\"DeleteSites\"] = 1] = \"DeleteSites\";\r\n        LongRunningActionType[LongRunningActionType[\"AssignPermissionsToContents\"] = 2] = \"AssignPermissionsToContents\";\r\n    })(VizPortal.LongRunningActionType || (VizPortal.LongRunningActionType = {}));\r\n    var LongRunningActionType = VizPortal.LongRunningActionType;\r\n    ;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/IActionInfo.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetActionInfoRequest = (function (_super) {\r\n            __extends(GetActionInfoRequest, _super);\r\n            function GetActionInfoRequest(params) {\r\n                _super.call(this, 'getActionInfo', params);\r\n            }\r\n            return GetActionInfoRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetActionInfoRequest = GetActionInfoRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../models/ILongRunningAction.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetActionInfoRequest.ts\" />\r\n/// <reference path=\"../ServerApi/types/IActionResult.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var LongRunningActionService = (function () {\r\n        function LongRunningActionService(server, pollService, $q, $timeout) {\r\n            this.server = server;\r\n            this.pollService = pollService;\r\n            this.$q = $q;\r\n            this.$timeout = $timeout;\r\n            this.StringToStateDict = {\r\n                queued: VizPortal.LongRunningActionState.Queued,\r\n                inProgress: VizPortal.LongRunningActionState.InProgress,\r\n                completed: VizPortal.LongRunningActionState.Complete\r\n            };\r\n            this.StringToTypeDict = {\r\n                rebuildSearchIndex: VizPortal.LongRunningActionType.RebuildSearchIndex,\r\n                deleteSites: VizPortal.LongRunningActionType.DeleteSites\r\n            };\r\n            // Inverted StringToTypeDict\r\n            this.TypeToStringDict = Helpers.swapDict(this.StringToTypeDict);\r\n        }\r\n        /**\r\n         * Get the last LongRunningAction of a type.\r\n         * Clients should handle promise rejection.\r\n         */\r\n        LongRunningActionService.prototype.getLastByType = function (type) {\r\n            var _this = this;\r\n            var stringType = this.TypeToStringDict[type];\r\n            return this.server.sendRequest(new VizPortal.ServerApi.GetActionInfoRequest({ actionType: stringType }))\r\n                .then(function (result) {\r\n                if (!result.actions || !result.actions.length) {\r\n                    return null;\r\n                }\r\n                return _this.toLongRunningAction(result.actions[0]);\r\n            });\r\n        };\r\n        /**\r\n         * Track the progress of a LongRunningAction\r\n         * The promise will be fullfilled with the LongRunningAction when it is complete\r\n         * The promise will be rejected with ResourceNotFound if there is no action of given id\r\n         */\r\n        LongRunningActionService.prototype.trackProgress = function (id) {\r\n            var _this = this;\r\n            var isComplete = function (result) {\r\n                if (!result.actions || !result.actions.length) {\r\n                    return true;\r\n                }\r\n                else {\r\n                    return _this.StringToStateDict[result.actions[0].state] === VizPortal.LongRunningActionState.Complete;\r\n                }\r\n            };\r\n            var actionInfoPoller = this.pollService.poll(new VizPortal.ServerApi.GetActionInfoRequest({ actionId: id }), isComplete);\r\n            var lrActionPromise = actionInfoPoller.promise\r\n                .then(function (result) {\r\n                if (!result.actions || !result.actions.length) {\r\n                    return _this.$q.reject(VizPortal.ErrorReason.ResourceNotFound);\r\n                }\r\n                return _this.$q.when(_this.toLongRunningAction(result.actions[0]));\r\n            })\r\n                .progress(function (result) {\r\n                return _this.toLongRunningAction(result.actions[0]);\r\n            });\r\n            // We have to return a new IPoller because type of the promise changes\r\n            var lrActionPoller = {\r\n                promise: lrActionPromise,\r\n                cancel: actionInfoPoller.cancel\r\n            };\r\n            return lrActionPoller;\r\n        };\r\n        // Pass in an optional method to catch the poller if it's needed to cancel the request\r\n        LongRunningActionService.prototype.startProgressTrackingForResult = function (getPoller) {\r\n            var _this = this;\r\n            if (getPoller === void 0) { getPoller = angular.noop; }\r\n            return function (result) {\r\n                if (!result.actionId) {\r\n                    return _this.$q.reject(result);\r\n                }\r\n                var poller = _this.trackProgress(result.actionId);\r\n                getPoller(poller);\r\n                return poller.promise.then(function (longRunningAction) {\r\n                    return _this.getLongRunningActionResult(longRunningAction);\r\n                });\r\n            };\r\n        };\r\n        //TODO: Remove this type hack, change ILongRunningAction to ITypedLongRunningAction\r\n        LongRunningActionService.prototype.getLongRunningActionResult = function (action) {\r\n            var typedAction = action;\r\n            return typedAction.response;\r\n        };\r\n        // TODO: This is temporary to get this method to work with the current APIs\r\n        //       This method should be removed once there are consistent responses for long running actions.\r\n        LongRunningActionService.prototype.startProgressTrackingForResponse = function (getPoller) {\r\n            var _this = this;\r\n            if (getPoller === void 0) { getPoller = angular.noop; }\r\n            return function (result) {\r\n                var poller = _this.trackProgress(result.actionId);\r\n                getPoller(poller);\r\n                return poller.promise.then(function (longRunningAction) {\r\n                    var response = _this.getLongRunningActionResult(longRunningAction);\r\n                    return response ? response.result : undefined;\r\n                });\r\n            };\r\n        };\r\n        // Convert a server result to an ILongRunningAction\r\n        LongRunningActionService.prototype.toLongRunningAction = function (actionInfo) {\r\n            var action = {\r\n                id: actionInfo.id,\r\n                type: this.StringToTypeDict[actionInfo.type],\r\n                state: this.StringToStateDict[actionInfo.state],\r\n                percentComplete: actionInfo.percentComplete,\r\n                response: actionInfo.response,\r\n                succeeded: actionInfo.succeeded\r\n            };\r\n            return action;\r\n        };\r\n        // Used if a list is refreshed.  This is needed\r\n        LongRunningActionService.prototype.delayResultForSolr = function () {\r\n            var _this = this;\r\n            return function (result) {\r\n                return _this.$timeout(function () { return result; }, VizPortal.ErrorNotifyingServer.ResponseDelay);\r\n            };\r\n        };\r\n        LongRunningActionService.$inject = ['ServerService', 'PollService', '$q', '$timeout'];\r\n        return LongRunningActionService;\r\n    })();\r\n    VizPortal.LongRunningActionService = LongRunningActionService;\r\n    VizPortal.Module.instance().service('LongRunningActionService', LongRunningActionService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/RequestHelper.ts\" />\r\n/// <reference path=\"../helpers/ResultHelper.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/CreateSiteRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/DeleteSitesRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetSitesRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/UpdateSiteAvailabilityRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/UpdateSiteSettingsForServerAdminRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/UpdateSiteSettingsForSiteAdminRequest.ts\" />\r\n/// <reference path=\"../ServerApi/types/ISite.ts\" />\r\n/// <reference path=\"../ServerApi/types/ISiteSettingsForSiteAdmin.ts\" />\r\n/// <reference path=\"../services/LongRunningActionService.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\n/// <reference path=\"Resource.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SiteAvailabilityState = (function () {\r\n        function SiteAvailabilityState() {\r\n        }\r\n        SiteAvailabilityState.ACTIVE = 'active';\r\n        SiteAvailabilityState.SUSPENDED = 'suspended';\r\n        SiteAvailabilityState.LOCKED = 'locked'; // importing or exporting\r\n        return SiteAvailabilityState;\r\n    })();\r\n    VizPortal.SiteAvailabilityState = SiteAvailabilityState;\r\n    var Sites = (function (_super) {\r\n        __extends(Sites, _super);\r\n        function Sites($q, $translate, $timeout, LongRunningActionService, errorNotifyingServer, sizeFilter, FetcherFactory) {\r\n            _super.call(this, FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetSitesRequest, function (result) { return result.sites; }));\r\n            this.$q = $q;\r\n            this.$translate = $translate;\r\n            this.$timeout = $timeout;\r\n            this.LongRunningActionService = LongRunningActionService;\r\n            this.errorNotifyingServer = errorNotifyingServer;\r\n            this.sizeFilter = sizeFilter;\r\n        }\r\n        Sites.prototype.getSiteSettingsForServerAdminById = function (id) {\r\n            return this.errorNotifyingServer.sendRequest(new VizPortal.ServerApi.GetDetailRequest('getSiteSettingsForServerAdmin', id));\r\n        };\r\n        Sites.prototype.getSiteSettingsForSiteAdminById = function (id) {\r\n            return this.errorNotifyingServer.sendRequest(new VizPortal.ServerApi.GetDetailRequest('getSiteSettingsForSiteAdmin', id));\r\n        };\r\n        Sites.prototype.getCurrentSiteSettingsForServerAdmin = function () {\r\n            return this.getSiteSettingsForServerAdminById(this.errorNotifyingServer.getServerService().sessionSiteId());\r\n        };\r\n        Sites.prototype.getCurrentSiteSettingsForSiteAdmin = function () {\r\n            return this.getSiteSettingsForSiteAdminById(this.errorNotifyingServer.getServerService().sessionSiteId());\r\n        };\r\n        Sites.prototype.updateSiteAvailability = function (ids, availability) {\r\n            return this.errorNotifyingServer.sendRequests(VizPortal.RequestHelper.buildRequests(ids, function (idsBlock) { return new VizPortal.ServerApi.UpdateSiteAvailabilityRequest({\r\n                ids: idsBlock,\r\n                availability: availability\r\n            }); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        Sites.prototype.suspend = function (ids) {\r\n            return this.updateSiteAvailability(ids, SiteAvailabilityState.SUSPENDED);\r\n        };\r\n        Sites.prototype.activate = function (ids) {\r\n            return this.updateSiteAvailability(ids, SiteAvailabilityState.ACTIVE);\r\n        };\r\n        Sites.prototype.updateSiteSettingsForServerAdmin = function (id, settings, subscriptionSettings) {\r\n            var params = {\r\n                id: id,\r\n                settings: settings\r\n            };\r\n            if (subscriptionSettings) {\r\n                params.subscriptionSettings = subscriptionSettings;\r\n            }\r\n            return this.errorNotifyingServer.sendRequest(new VizPortal.ServerApi.UpdateSiteSettingsForServerAdminRequest(params));\r\n        };\r\n        Sites.prototype.updateSiteSettingsForSiteAdmin = function (id, siteAdminSettings) {\r\n            var params = {\r\n                id: id,\r\n                siteAdminSettings: siteAdminSettings\r\n            };\r\n            return this.errorNotifyingServer.sendRequest(new VizPortal.ServerApi.UpdateSiteSettingsForSiteAdminRequest(params));\r\n        };\r\n        Sites.prototype.createSite = function (settings, siteAdminSettings, subscriptionSettings) {\r\n            var _this = this;\r\n            var params = {\r\n                settings: settings\r\n            };\r\n            if (siteAdminSettings) {\r\n                params.siteAdminSettings = siteAdminSettings;\r\n            }\r\n            if (subscriptionSettings) {\r\n                params.subscriptionSettings = subscriptionSettings;\r\n            }\r\n            return this.errorNotifyingServer.sendRequestAndDelay(new VizPortal.ServerApi.CreateSiteRequest(params))\r\n                .then(function (result) {\r\n                if (result.errors) {\r\n                    return _this.$q.reject(result.errors);\r\n                }\r\n            });\r\n        };\r\n        Sites.prototype.del = function (ids) {\r\n            var _this = this;\r\n            // Note: We don't send multiple \"delete sites\" requests because the result is a long running action,\r\n            // and tracking more than one long running action at once would be complicated.\r\n            // Since we don't, attempts to delete more than the server-allowed maximum will fail.\r\n            // This isn't so bad, because the maximum is 1000, and that's a *lot* of sites\r\n            // to try to delete all at once.  It's likely the server can't handle that anyway.\r\n            return this.errorNotifyingServer.sendRequest(new VizPortal.ServerApi.DeleteSitesRequest({\r\n                ids: ids\r\n            })).then(function (result) {\r\n                if (result.actionId) {\r\n                    return _this.LongRunningActionService.trackProgress(result.actionId).promise;\r\n                }\r\n                else {\r\n                    return _this.$q.reject(VizPortal.ErrorReason.Unknown);\r\n                }\r\n            }).then(function (action) { return _this.$timeout(function () { return action; }, VizPortal.ErrorNotifyingServer.ResponseDelay); });\r\n        };\r\n        Sites.prototype.errorMessage = function (code, site) {\r\n            switch (code) {\r\n                case VizPortal.SiteSettingsErrorCode.SiteNotFound:\r\n                    return this.$translate.instant('siteSettingsFailedSiteNotFound');\r\n                case VizPortal.SiteSettingsErrorCode.SiteNameIsEmptyOrNull:\r\n                    return this.$translate.instant('siteSettingsFailedSiteNameIsEmptyOrNull');\r\n                case VizPortal.SiteSettingsErrorCode.SiteAdminCannotAddUsersButUserQuotaIsSet:\r\n                    return this.$translate.instant('siteSettingsFailedSiteAdminCannotAddUsersButUserQuotaIsSet');\r\n                case VizPortal.SiteSettingsErrorCode.InvalidUserQuotaOrStorageQuota:\r\n                    return this.$translate.instant('siteSettingsFailedInvalidUserQuotaOrStorageQuota');\r\n                case VizPortal.SiteSettingsErrorCode.UserQuotaGreaterThanServerLicenseLimit:\r\n                    return this.$translate.instant('siteSettingsFailedUserQuotaGreaterThanServerLicenseLimit');\r\n                case VizPortal.SiteSettingsErrorCode.InvalidCustomEmailAddress:\r\n                    return this.$translate.instant('siteSettingsFailedInvalidCustomEmailAddress');\r\n                case VizPortal.SiteSettingsErrorCode.SiteNameOrUrlNameAlreadyExists:\r\n                    return this.$translate.instant('siteSettingsFailedSiteNameOrUrlNameAlreadyExists');\r\n                case VizPortal.SiteSettingsErrorCode.SiteSubscriptionsSetWithDisabledServerSubscriptions:\r\n                    return this.$translate.instant('siteSettingsFailedSiteSubscriptionsSetWithDisabledServerSubscriptions');\r\n                case VizPortal.SiteSettingsErrorCode.AttemptedToUpdateDefaultSiteUrlName:\r\n                    return this.$translate.instant('siteSettingsFailedAttemptedToUpdateDefaultSiteUrlName');\r\n                case VizPortal.SiteSettingsErrorCode.AttemptedToSuspendDefaultSite:\r\n                    return this.$translate.instant('siteSettingsFailedAttemptedToSuspendDefaultSite');\r\n                case VizPortal.SiteSettingsErrorCode.SiteNameTooLong:\r\n                    return this.$translate.instant('siteSettingsFailedSiteNameTooLong');\r\n                case VizPortal.SiteSettingsErrorCode.SiteUrlNameTooLong:\r\n                    return this.$translate.instant('siteSettingsFailedSiteUrlNameTooLong');\r\n                case VizPortal.SiteSettingsErrorCode.StorageQuotaLessThanStorageUsed:\r\n                    return this.$translate.instant('siteSettingsFailedStorageQuotaLessThanStorageUsed', {\r\n                        STORAGE_USED: this.sizeFilter(site.storageUsedBytes)\r\n                    });\r\n                default:\r\n                    return this.$translate.instant('settingsUpdateFailure');\r\n            }\r\n        };\r\n        Sites.$inject = [\r\n            '$q',\r\n            '$translate',\r\n            '$timeout',\r\n            'LongRunningActionService',\r\n            'ErrorNotifyingServer',\r\n            'sizeFilter',\r\n            'FetcherFactory'\r\n        ];\r\n        return Sites;\r\n    })(VizPortal.Resource);\r\n    VizPortal.Sites = Sites;\r\n    VizPortal.Module.instance().service('Sites', Sites);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/Order.ts\" />\r\n/// <reference path=\"../models/ContentTypes.ts\" />\r\n/// <reference path=\"../models/IPlace.ts\" />\r\n/// <reference path=\"../resources/Sites.ts\" />\r\n/// <reference path=\"../ServerApi/types/IOrderClause.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SitesPlace = (function () {\r\n        function SitesPlace($location, Sites) {\r\n            var _this = this;\r\n            this.$location = $location;\r\n            this.Sites = Sites;\r\n            this.urlParamsFn = function () { return _this.$location.search(); };\r\n        }\r\n        SitesPlace.prototype.create = function () {\r\n            var place = new VizPortal.Place();\r\n            place.addSubplace(VizPortal.Subplace.create('sites', VizPortal.SitesContentType, this.Sites, this.urlParamsFn));\r\n            return place;\r\n        };\r\n        SitesPlace.$inject = [\r\n            '$location',\r\n            'Sites'\r\n        ];\r\n        return SitesPlace;\r\n    })();\r\n    VizPortal.SitesPlace = SitesPlace;\r\n    VizPortal.Module.instance().service('SitesPlace', SitesPlace);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetMastheadNotificationsRequest = (function (_super) {\r\n            __extends(GetMastheadNotificationsRequest, _super);\r\n            function GetMastheadNotificationsRequest() {\r\n                _super.call(this, 'getMastheadNotifications', {});\r\n            }\r\n            return GetMastheadNotificationsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetMastheadNotificationsRequest = GetMastheadNotificationsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetMastheadNotificationsRequest.ts\" />\r\n/// <reference path=\"../FeatureFlags.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var MastheadNotifications = (function () {\r\n        function MastheadNotifications($sce, $q, toaster, ServerService) {\r\n            this.$sce = $sce;\r\n            this.$q = $q;\r\n            this.toaster = toaster;\r\n            this.ServerService = ServerService;\r\n            this.notificationsShown = false;\r\n        }\r\n        MastheadNotifications.prototype.showNotificationsIfEnabled = function () {\r\n            var _this = this;\r\n            if (this.notificationsShown) {\r\n                return this.$q.when(null);\r\n            }\r\n            return this.fetchNotificationsUrl().then(function (url) {\r\n                if (url) {\r\n                    if (VizPortal.FeatureFlags.reactToasts) {\r\n                        var contentComponent = React.createClass({\r\n                            render: function () {\r\n                                return React.DOM.iframe({\r\n                                    src: this.$sce.trustAsResourceUrl(url),\r\n                                    style: {\r\n                                        verticalAlign: 'top',\r\n                                        width: '100%',\r\n                                        height: '36px',\r\n                                        frameborder: '0',\r\n                                        scrolling: 'no'\r\n                                    }\r\n                                });\r\n                            }\r\n                        });\r\n                        _this.toaster.pop({\r\n                            type: VizPortal.ToastType.External,\r\n                            content: React.createElement(contentComponent, {}),\r\n                            timeoutDelay: VizPortal.ToasterService.NoTimeout\r\n                        });\r\n                    }\r\n                    else {\r\n                        _this.toaster.pop({\r\n                            type: VizPortal.ToastType.External,\r\n                            templateUrl: 'mastheadNotificationToast.html',\r\n                            data: {\r\n                                contentUrl: _this.$sce.trustAsResourceUrl(url)\r\n                            },\r\n                            timeout: VizPortal.ToasterService.NoTimeout\r\n                        });\r\n                    }\r\n                }\r\n            }).fin(function () { return _this.notificationsShown = true; }); // Suppress in case of future $state.hardReload()\r\n        };\r\n        MastheadNotifications.prototype.fetchNotificationsUrl = function () {\r\n            return this.ServerService.sendRequest(new VizPortal.ServerApi.GetMastheadNotificationsRequest())\r\n                .then(function (result) { return result.contentUrl; });\r\n        };\r\n        MastheadNotifications.$inject = ['$sce', '$q', 'ToasterService', 'ServerService'];\r\n        return MastheadNotifications;\r\n    })();\r\n    VizPortal.MastheadNotifications = MastheadNotifications;\r\n    VizPortal.Module.instance().service('MastheadNotifications', MastheadNotifications);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetPostLoginNotificationsRequest = (function (_super) {\r\n            __extends(GetPostLoginNotificationsRequest, _super);\r\n            function GetPostLoginNotificationsRequest() {\r\n                _super.call(this, 'getPostLoginNotifications', {});\r\n            }\r\n            return GetPostLoginNotificationsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetPostLoginNotificationsRequest = GetPostLoginNotificationsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetPostLoginNotificationsRequest.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var PostLoginNotifications = (function () {\r\n        function PostLoginNotifications($sce, $q, modal, $rootScope, ServerService) {\r\n            this.$sce = $sce;\r\n            this.$q = $q;\r\n            this.modal = modal;\r\n            this.$rootScope = $rootScope;\r\n            this.ServerService = ServerService;\r\n            this.notificationsShown = false;\r\n            this.notificationsEnabled = false;\r\n        }\r\n        PostLoginNotifications.prototype.enableNotifications = function () {\r\n            this.notificationsEnabled = true;\r\n        };\r\n        PostLoginNotifications.prototype.showNotificationsIfEnabled = function () {\r\n            var _this = this;\r\n            if (!this.notificationsEnabled || this.notificationsShown) {\r\n                return this.$q.when(null);\r\n            }\r\n            return this.fetchNotificationsUrl().then(function (url) {\r\n                if (url) {\r\n                    var scope = _this.$rootScope.$new();\r\n                    scope.notificationsUrl = _this.$sce.trustAsResourceUrl(url);\r\n                    return _this.modal.open({\r\n                        scope: scope,\r\n                        templateUrl: 'postLoginNotifications.html',\r\n                        size: VizPortal.ModalSize.fitToContent\r\n                    }).result.fin(function () { return scope.$destroy(); });\r\n                }\r\n            }).fin(function () { return _this.notificationsShown = true; }); // Suppress in case of future $state.hardReload()\r\n        };\r\n        PostLoginNotifications.prototype.fetchNotificationsUrl = function () {\r\n            return this.ServerService.sendRequest(new VizPortal.ServerApi.GetPostLoginNotificationsRequest())\r\n                .then(function (result) { return result.contentUrl; });\r\n        };\r\n        PostLoginNotifications.$inject = ['$sce', '$q', 'ModalService', '$rootScope', 'ServerService'];\r\n        return PostLoginNotifications;\r\n    })();\r\n    VizPortal.PostLoginNotifications = PostLoginNotifications;\r\n    VizPortal.Module.instance().service('PostLoginNotifications', PostLoginNotifications);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.SiteUrlNameCapturingRegex = /^\\/site\\/([^\\/]+)/;\r\n    /**\r\n     * A wrapper around UI-Router's UrlMatcher. UI-Router doesn't have built-in functionality\r\n     * to support site prefixes in the way that we'd like, so we need this custom UrlMatcher.\r\n     *\r\n     * This enables:\r\n     *\r\n     *     $state.go('sitestate', {siteUrlName: 'blah'}) to create url '/site/blah/...'\r\n     *     url '/site/blah/...' to make $stateParams.siteUrlName === 'blah'\r\n     *\r\n     * For more detailed documentation on this class and its methods, see:\r\n     * http://angular-ui.github.io/ui-router/site/#/api/ui.router.util.type:UrlMatcher\r\n     */\r\n    var SiteUrlMatcher = (function () {\r\n        function SiteUrlMatcher(matcher) {\r\n            this.matcher = matcher;\r\n        }\r\n        /**\r\n         * Add a pattern to the end of this pattern, returning a new SiteUrlMatcher\r\n         */\r\n        SiteUrlMatcher.prototype.concat = function (pattern) {\r\n            return new SiteUrlMatcher(this.matcher.concat(pattern));\r\n        };\r\n        /**\r\n         * Extracts site into siteUrlName if the site is present\r\n         */\r\n        SiteUrlMatcher.prototype.exec = function (path, searchParams) {\r\n            var siteUrlName = '';\r\n            var match = path.match(VizPortal.SiteUrlNameCapturingRegex);\r\n            // If site is present, extract it\r\n            if (match) {\r\n                siteUrlName = match[1];\r\n                // Get rest of the string without the site part\r\n                path = path.split(match[0])[1];\r\n            }\r\n            var urlParams = this.matcher.exec(path, searchParams);\r\n            if (urlParams !== null) {\r\n                urlParams[VizPortal.UrlParamKeys.SiteUrlName] = siteUrlName;\r\n            }\r\n            return urlParams;\r\n        };\r\n        /**\r\n         * Return unsorted array of parameter names\r\n         */\r\n        SiteUrlMatcher.prototype.parameters = function () {\r\n            var params = this.matcher.parameters();\r\n            params.push(VizPortal.UrlParamKeys.SiteUrlName);\r\n            return params;\r\n        };\r\n        /**\r\n         * Create a url with the site, if a site is given\r\n         */\r\n        SiteUrlMatcher.prototype.format = function (values) {\r\n            var prefix = '';\r\n            // If a truthy value, add to site prefix\r\n            if (values[VizPortal.UrlParamKeys.SiteUrlName]) {\r\n                prefix = '/site/' + values[VizPortal.UrlParamKeys.SiteUrlName];\r\n            }\r\n            // Remove property so matcher.format doesn't add a query string param\r\n            if (_.has(values, VizPortal.UrlParamKeys.SiteUrlName)) {\r\n                values = angular.copy(values);\r\n                delete values[VizPortal.UrlParamKeys.SiteUrlName];\r\n            }\r\n            return prefix + this.matcher.format(values);\r\n        };\r\n        return SiteUrlMatcher;\r\n    })();\r\n    VizPortal.SiteUrlMatcher = SiteUrlMatcher;\r\n    /**\r\n     * Can be used in config block or by other providers under the\r\n     * name \"SiteUrlMatcherFactoryProvider\".\r\n     */\r\n    var SiteUrlMatcherFactory = (function () {\r\n        function SiteUrlMatcherFactory($urlMatcherFactory) {\r\n            this.$urlMatcherFactory = $urlMatcherFactory;\r\n        }\r\n        SiteUrlMatcherFactory.prototype.compile = function (pattern) {\r\n            return new SiteUrlMatcher(this.$urlMatcherFactory.compile(pattern));\r\n        };\r\n        SiteUrlMatcherFactory.prototype.$get = function () {\r\n            return this;\r\n        };\r\n        SiteUrlMatcherFactory.$inject = ['$urlMatcherFactoryProvider'];\r\n        return SiteUrlMatcherFactory;\r\n    })();\r\n    VizPortal.SiteUrlMatcherFactory = SiteUrlMatcherFactory;\r\n    // Register as a provider to be available to other providers.\r\n    VizPortal.Module.instance().provider('SiteUrlMatcherFactory', SiteUrlMatcherFactory);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/IDataConnectionAuthInfo.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetDataConnectionAuthInfoRequest = (function (_super) {\r\n            __extends(GetDataConnectionAuthInfoRequest, _super);\r\n            function GetDataConnectionAuthInfoRequest(params) {\r\n                _super.call(this, 'getDataConnectionAuthInfo', params);\r\n            }\r\n            return GetDataConnectionAuthInfoRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetDataConnectionAuthInfoRequest = GetDataConnectionAuthInfoRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetLastActiveDirectoryGroupsSyncTimeRequest = (function (_super) {\r\n            __extends(GetLastActiveDirectoryGroupsSyncTimeRequest, _super);\r\n            function GetLastActiveDirectoryGroupsSyncTimeRequest(params) {\r\n                if (params === void 0) { params = {}; }\r\n                _super.call(this, 'getLastActiveDirectoryGroupsSyncTime', params);\r\n            }\r\n            return GetLastActiveDirectoryGroupsSyncTimeRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetLastActiveDirectoryGroupsSyncTimeRequest = GetLastActiveDirectoryGroupsSyncTimeRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"libs.ts\" />\r\n/// <reference path=\"../app/IMainScope.ts\" />\r\n/// <reference path=\"../app/IPlaceTitleScope.ts\" />\r\n/// <reference path=\"../app/UrlParamKeys.ts\" />\r\n/// <reference path=\"controllers/AddSiteCtrl.ts\" />\r\n/// <reference path=\"controllers/AdminVizViewerCtrl.ts\" />\r\n/// <reference path=\"controllers/AuthenticateConnectionCtrl.ts\" />\r\n/// <reference path=\"controllers/ContentSubplaceCtrl.ts\" />\r\n/// <reference path=\"controllers/ErrorCtrl.ts\" />\r\n/// <reference path=\"controllers/ExtractTasksCtrl.ts\" />\r\n/// <reference path=\"controllers/GroupDetailsCtrl.ts\" />\r\n/// <reference path=\"controllers/GroupPlaceCtrl.ts\" />\r\n/// <reference path=\"controllers/GroupsPlaceCtrl.ts\" />\r\n/// <reference path=\"controllers/GroupUsersSubplaceCtrl.ts\" />\r\n/// <reference path=\"controllers/HomeCtrl.ts\" />\r\n/// <reference path=\"controllers/InitializationCtrl.ts\" />\r\n/// <reference path=\"controllers/LicensesCtrl.ts\" />\r\n/// <reference path=\"controllers/LoginCtrl.ts\" />\r\n/// <reference path=\"controllers/LoginSitePickerCtrl.ts\" />\r\n/// <reference path=\"controllers/RevisionHistoryDialogCtrl.ts\" />\r\n/// <reference path=\"controllers/SigninErrorCtrl.ts\" />\r\n/// <reference path=\"controllers/ScheduleCtrl.ts\" />\r\n/// <reference path=\"controllers/SchedulesCtrl.ts\" />\r\n/// <reference path=\"controllers/ServerStatusCtrl.ts\" />\r\n/// <reference path=\"controllers/ServerUserPlaceCtrl.ts\" />\r\n/// <reference path=\"controllers/ServerUsersPlaceCtrl.ts\" />\r\n/// <reference path=\"controllers/ServerUserSettingsSubplaceCtrl.ts\" />\r\n/// <reference path=\"controllers/SetBrowserTitleCtrl.ts\" />\r\n/// <reference path=\"controllers/SignedOutCtrl.ts\" />\r\n/// <reference path=\"controllers/SiteAuthenticationCtrl.ts\" />\r\n/// <reference path=\"controllers/SitesPlaceCtrl.ts\" />\r\n/// <reference path=\"controllers/SiteUsersPlaceCtrl.ts\" />\r\n/// <reference path=\"controllers/SubscriptionsCtrl.ts\" />\r\n/// <reference path=\"controllers/TasksCtrl.ts\" />\r\n/// <reference path=\"controllers/VizViewerCtrl.ts\" />\r\n/// <reference path=\"directives/tbSettingsCoordinator.ts\" />\r\n/// <reference path=\"FeatureFlags.ts\" />\r\n/// <reference path=\"helpers/ConfigHelper.ts\" />\r\n/// <reference path=\"helpers/SubplaceCountsHelper.ts\" />\r\n/// <reference path=\"models/ContentFilters.ts\" />\r\n/// <reference path=\"models/SitesPlace.ts\" />\r\n/// <reference path=\"Module.ts\" />\r\n/// <reference path=\"services/DisplaySettingsService.ts\" />\r\n/// <reference path=\"services/GettingStartedNotifications.ts\" />\r\n/// <reference path=\"services/LicensesService.ts\" />\r\n/// <reference path=\"services/MastheadNotifications.ts\" />\r\n/// <reference path=\"services/PostLoginNotifications.ts\" />\r\n/// <reference path=\"services/RebuildSearchIndexService.ts\" />\r\n/// <reference path=\"services/ServerInfoService.ts\" />\r\n/// <reference path=\"services/ServerService.ts\" />\r\n/// <reference path=\"services/SiteUrlMatcherFactory.ts\" />\r\n/// <reference path=\"ServerApi/requests/GetDataConnectionAuthInfoRequest.ts\" />\r\n/// <reference path=\"ServerApi/requests/getLastActiveDirectoryGroupsSyncTimeRequest.ts\" />\r\n/// <reference path=\"ServerApi/requests/GetSiteSAMLConfigurationRequest.ts\" />\r\n/// <reference path=\"ServerApi/requests/UpdateDisplayModeRequest.ts\" />\r\n/// <reference path=\"ServerApi/types/ISessionInfo.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().config([\r\n        '$httpProvider',\r\n        '$sceProvider',\r\n        '$stateProvider',\r\n        '$urlRouterProvider',\r\n        'SiteUrlMatcherFactoryProvider',\r\n        'ApiPrefix',\r\n        function ($httpProvider, $sceProvider, $stateProvider, $urlRouterProvider, siteUrlMatcherFactory, ApiPrefix) {\r\n            // Make ui-router's internal state object accessible on the state config.\r\n            // This is hackery, but community endorsed hackery. To limit our dependence\r\n            // on this, the $$state object should never be accessed by anything outside\r\n            // of the StateWrapperService, so it should not be added to the typescript\r\n            // definition\r\n            $stateProvider.decorator('parent', function (state, parent) {\r\n                state.self.$$state = state;\r\n                // B147816. This adds a resolve to every state that waits for all pending session info requests (like a\r\n                // switch site) to finish before continuing with the state transition. We don't want to let the\r\n                // controllers act on stale session data.\r\n                var getSessionInfoPromise = ['ServerService', function (server) {\r\n                        // Swallow any errors. We just want to know when it's done.\r\n                        return server.getSessionInfoPromise().fail(angular.noop);\r\n                    }];\r\n                var resolve = _.extend({ getSessionInfoPromise: getSessionInfoPromise }, state.self.resolve);\r\n                state.self.resolve = resolve;\r\n                state.resolve = state.self.resolve;\r\n                return parent(state);\r\n            });\r\n            $httpProvider.interceptors.push(function () {\r\n                var apiRequestRegex = new RegExp('^' + ApiPrefix);\r\n                return {\r\n                    request: function (config) {\r\n                        var isGet = config.method === 'GET';\r\n                        var isInline = /^inline_/.test(config.url);\r\n                        var isApi = apiRequestRegex.test(config.url);\r\n                        if (isGet && !isInline && !isApi) {\r\n                            var isHtml = /\\.html$/.test(config.url);\r\n                            var separator = (config.url.indexOf('?') >= 0) ? '&' : '?';\r\n                            config.url = config.url + separator + VizPortal.BuildId;\r\n                            if (VizPortal.L10n.language && isHtml) {\r\n                                // Only prefix the request with the language if:\r\n                                // - We have a valid language.\r\n                                // - The request is a GET for an html file.\r\n                                // - It's not a request for an inlined template.\r\n                                config.url = VizPortal.L10n.language + '/' + config.url;\r\n                            }\r\n                        }\r\n                        return config;\r\n                    }\r\n                };\r\n            });\r\n            // Angular does not support SCE on IE7-.\r\n            // This browser detection matches the check that Angular performs internally.\r\n            if (navigator.userAgent.match(/msie/i) && document.documentMode > 0 && document.documentMode < 8) {\r\n                $sceProvider.enabled(false);\r\n            }\r\n            var siteUrl = function (url) { return siteUrlMatcherFactory.compile(url); };\r\n            // Create a redirect handler for a site url. See $urlRouterProvider documentation for details\r\n            var siteUrlRedirect = function (url) { return ['$match', function ($match) { return siteUrl(url).format($match); }]; };\r\n            $urlRouterProvider\r\n                .when(siteUrl('/groups/{id}'), siteUrlRedirect('/groups/{id}/users'))\r\n                .when(siteUrl('/user/{domainName}/{username}'), siteUrlRedirect('/user/{domainName}/{username}/workbooks'))\r\n                .when(siteUrl('/user/{domainName}/{username}/'), siteUrlRedirect('/user/{domainName}/{username}/workbooks'))\r\n                .when(siteUrl('/tasks'), siteUrlRedirect('/tasks/extractRefreshes'))\r\n                .when('/server', '/server/status')\r\n                .when('/server/user/{domain}/{username}', '/server/user/{domain}/{username}/settings')\r\n                .when('/server/user/{domain}/{username}/', '/server/user/{domain}/{username}/settings')\r\n                .when('/server/tasks', '/server/tasks/extractRefreshes')\r\n                .otherwise(function ($injector) {\r\n                // Handle nonsensical URLs\r\n                if ($injector.get('ServerService').inSession()) {\r\n                    $injector.get('$state').go('main.error');\r\n                }\r\n                else {\r\n                    // If not signed in, remember the redirect so they get an error page after sign in\r\n                    var redirect = $injector.get('$location').url();\r\n                    $injector.get('$state').go('login.authenticate', { redirect: redirect });\r\n                }\r\n            });\r\n            /**\r\n             * State Configurations\r\n             */\r\n            // B147151. Ideally we would process and remove the saml query param earlier in the flow (i.e. run.ts), but\r\n            // we can't change the url through angular's $location object then because that disrupts the bootstrapping\r\n            // process. We would have to parse and modify the window.location directly, and that's a non-trivial task.\r\n            var processAndRemoveSamlQueryParam = ['$location', 'GettingStartedNotifications', 'PostLoginNotifications', function ($location, GettingStartedNotifications, PostLoginNotifications) {\r\n                    var search = $location.search();\r\n                    if (_.has(search, VizPortal.UrlParamKeys.IsFromSaml)) {\r\n                        if (Helpers.BooleanQueryParamRegex.test(search[VizPortal.UrlParamKeys.IsFromSaml])) {\r\n                            GettingStartedNotifications.enableNotifications();\r\n                            PostLoginNotifications.enableNotifications();\r\n                        }\r\n                        $location.search(VizPortal.UrlParamKeys.IsFromSaml, null);\r\n                    }\r\n                }];\r\n            // Login\r\n            $stateProvider\r\n                .state('login', {\r\n                abstract: true,\r\n                template: '<div ui-view></div>',\r\n                data: {\r\n                    authLevel: VizPortal.AuthLevel.Anonymous\r\n                },\r\n                onEnter: processAndRemoveSamlQueryParam\r\n            })\r\n                .state('login.interstitial', {\r\n                template: '<tb:signing-in></tb:signing-in>'\r\n            })\r\n                .state('login.authenticate', {\r\n                url: '/signin?redirect&error&externalRedirect&site&closePopupWhenDone&disableAutoSignin',\r\n                templateUrl: 'login.html',\r\n                controller: VizPortal.LoginCtrl\r\n            })\r\n                .state('login.signedOut', {\r\n                url: '/signedOut',\r\n                templateUrl: 'signedOut.html',\r\n                controller: VizPortal.SignedOutCtrl\r\n            })\r\n                .state('login.site', {\r\n                url: '/site',\r\n                templateUrl: 'loginSitePicker.html',\r\n                data: {\r\n                    authLevel: VizPortal.AuthLevel.Authenticated\r\n                },\r\n                controller: VizPortal.LoginSitePickerCtrl\r\n            })\r\n                .state('login.init', {\r\n                templateUrl: 'initialization.html',\r\n                controller: VizPortal.InitializationCtrl\r\n            })\r\n                .state('login.untrusted', {\r\n                templateUrl: 'untrusted.html'\r\n            })\r\n                .state('login.error', {\r\n                url: '/error',\r\n                templateUrl: 'errorNoSite.html'\r\n            })\r\n                .state('login.error.errorCode', {\r\n                url: '/{errorCode}',\r\n                templateUrl: 'error.html',\r\n                controller: VizPortal.ErrorCtrl\r\n            })\r\n                .state('login.error.noSite', {\r\n                templateUrl: 'error.html',\r\n                params: [\r\n                    VizPortal.ErrorCtrl.StateParamKeys.DetailsLocKey,\r\n                    VizPortal.ErrorCtrl.StateParamKeys.RedirectState,\r\n                    VizPortal.ErrorCtrl.StateParamKeys.RedirectLocKey\r\n                ],\r\n                controller: VizPortal.ErrorCtrl\r\n            })\r\n                .state('login.error.auth', {\r\n                url: '/signin/{errorCode}?redirectPath',\r\n                templateUrl: 'errorSignIn.html',\r\n                controller: VizPortal.SignInErrorCtrl\r\n            });\r\n            // Connection Authentication\r\n            $stateProvider\r\n                .state('authenticate', {\r\n                url: '/authenticate?path&attributes&sessionId&isPreview&closePopupWhenDone',\r\n                templateUrl: 'authenticateConnection.html',\r\n                resolve: {\r\n                    authInfo: [\r\n                        '$stateParams', 'ServerService',\r\n                        function ($stateParams, serverService) {\r\n                            return serverService.sendRequest(new VizPortal.ServerApi.GetDataConnectionAuthInfoRequest($stateParams));\r\n                        }\r\n                    ]\r\n                },\r\n                controller: VizPortal.AuthenticateConnectionCtrl,\r\n                data: {\r\n                    authLevel: VizPortal.AuthLevel.Anonymous\r\n                }\r\n            });\r\n            // Main\r\n            $stateProvider\r\n                .state('main', {\r\n                abstract: true,\r\n                url: '',\r\n                templateUrl: 'main.html',\r\n                data: {\r\n                    authLevel: VizPortal.AuthLevel.Authenticated\r\n                },\r\n                onEnter: processAndRemoveSamlQueryParam,\r\n                controller: ['$scope', 'DisplaySettingsService', function ($scope, DisplaySettingsService) {\r\n                        DisplaySettingsService.updateDisplayModeFromUrl();\r\n                        DisplaySettingsService.maybeUpdateDisplayModeFromSession();\r\n                        $scope.displaySettings = DisplaySettingsService;\r\n                        $scope.$on('$locationChangeSuccess', function () {\r\n                            DisplaySettingsService.updateDisplayModeFromUrl();\r\n                            DisplaySettingsService.updateShowFilterPanel();\r\n                        });\r\n                        $scope.$watch(function () { return $scope.displaySettings.displayMode; }, function (newValue, oldValue) {\r\n                            if (newValue !== oldValue) {\r\n                                DisplaySettingsService.saveDisplayMode();\r\n                            }\r\n                        });\r\n                    }]\r\n            });\r\n            $stateProvider\r\n                .state('main.site', {\r\n                abstract: true,\r\n                // site url is optional. Grab it if it's there.\r\n                url: siteUrlMatcherFactory.compile(''),\r\n                template: '<div ui-view></div>',\r\n                onEnter: ['PostLoginNotifications', 'GettingStartedNotifications', 'MastheadNotifications', function (PostLoginNotifications, GettingStartedNotifications, MastheadNotifications) {\r\n                        // See http://mytableau/display/devft/Vizportal+Online+Notifications+Spec\r\n                        PostLoginNotifications.showNotificationsIfEnabled()\r\n                            .fin(function () { return GettingStartedNotifications.showNotificationsIfEnabled(); })\r\n                            .fin(function () { return MastheadNotifications.showNotificationsIfEnabled(); });\r\n                    }]\r\n            });\r\n            $stateProvider\r\n                .state('main.server', {\r\n                abstract: true,\r\n                url: '/server',\r\n                template: '<div ui-view></div>',\r\n                data: {\r\n                    authLevel: VizPortal.AuthLevel.ServerAdmin\r\n                }\r\n            })\r\n                .state('main.server.status', {\r\n                url: '/status',\r\n                templateUrl: 'serverStatus.html',\r\n                resolve: {\r\n                    hosts: ['ServerInfoService', function (serverInfo) { return serverInfo.fetch(); }],\r\n                    rebuildSearchIndexCurrentJob: ['RebuildSearchIndexService', function (rebuildSearchIndexService) {\r\n                            return rebuildSearchIndexService.handleCurrentJob();\r\n                        }]\r\n                },\r\n                controller: VizPortal.ServerStatusCtrl\r\n            })\r\n                .state('main.server.settings', {\r\n                templateUrl: 'serverSettingsTabs.html',\r\n                abstract: true,\r\n                controller: ['$scope', 'ServerService',\r\n                    function ($scope, server) {\r\n                        $scope.server = server;\r\n                    }]\r\n            })\r\n                .state('main.server.settings.serverSettings', {\r\n                url: '/settings',\r\n                templateUrl: 'serverSettings.html',\r\n                data: {\r\n                    authLevel: VizPortal.AuthLevel.ServerAdmin\r\n                },\r\n                resolve: {\r\n                    serverSettings: ['ServerSettings', function (ServerSettings) { return ServerSettings.fetch(); }],\r\n                    lastActiveDirectoryGroupsSyncTime: ['ServerService', function (serverService) {\r\n                            return serverService.sendRequest(new VizPortal.ServerApi.GetLastActiveDirectoryGroupsSyncTimeRequest())\r\n                                .then(function (result) { return result.time; });\r\n                        }],\r\n                    siteSettingsForServerAdmin: ['ServerService', 'Sites', function (ServerService, Sites) {\r\n                            // Resolve the sessionInfoPromise in case we are coming from a state\r\n                            // where the sessionInfo might be stale (e.g., logged into an arbitrary site on login)\r\n                            return ServerService.getSessionInfoPromise().then(function () { return Sites.getCurrentSiteSettingsForServerAdmin(); });\r\n                        }],\r\n                    siteSettingsForSiteAdmin: ['ServerService', 'Sites', function (ServerService, Sites) {\r\n                            // Resolve the sessionInfoPromise in case we are coming from a state\r\n                            // where the sessionInfo might be stale (e.g., logged into an arbitrary site on login)\r\n                            return ServerService.getSessionInfoPromise().then(function () { return Sites.getCurrentSiteSettingsForSiteAdmin(); });\r\n                        }]\r\n                },\r\n                controller: ['$scope',\r\n                    'BrowserTitleService',\r\n                    'ServerService',\r\n                    'siteSettingsForServerAdmin',\r\n                    'siteSettingsForSiteAdmin',\r\n                    'serverSettings',\r\n                    'lastActiveDirectoryGroupsSyncTime',\r\n                    function ($scope, BrowserTitleService, server, siteSettingsForServerAdmin, siteSettingsForSiteAdmin, serverSettings, lastActiveDirectoryGroupsSyncTime) {\r\n                        BrowserTitleService.setTitle('serverSettings_general');\r\n                        $scope.server = server;\r\n                        $scope.siteSettingsForServerAdmin = siteSettingsForServerAdmin;\r\n                        $scope.siteSettingsForSiteAdmin = siteSettingsForSiteAdmin;\r\n                        $scope.isDefaultSite = siteSettingsForServerAdmin.settings && siteSettingsForServerAdmin.settings.urlName === '';\r\n                        $scope.hideNameAndId = !server.isSessionMultiSite();\r\n                        $scope.serverSettings = serverSettings;\r\n                        $scope.liveDBAvailable = server.isLiveDBAvailable();\r\n                        $scope.lastActiveDirectoryGroupsSyncTime = lastActiveDirectoryGroupsSyncTime;\r\n                    }]\r\n            })\r\n                .state('main.server.settings.licenses', {\r\n                url: '/licenses',\r\n                templateUrl: 'licenses.html',\r\n                resolve: {\r\n                    licensingInfo: ['LicensesService', function (licenses) { return licenses.fetch(); }]\r\n                },\r\n                controller: VizPortal.LicensesCtrl\r\n            })\r\n                .state('main.server.settings.addSite', {\r\n                url: '/addSite',\r\n                templateUrl: 'addSite.html',\r\n                controller: VizPortal.AddSiteCtrl\r\n            })\r\n                .state('main.server.analysis', {\r\n                url: '/analysis/{sheetUrlId}',\r\n                templateUrl: 'adminVizViewer.html',\r\n                resolve: {\r\n                    workbookUrlId: function () { return 'tabbed_admin_views'; }\r\n                },\r\n                controller: VizPortal.AdminVizViewerCtrl\r\n            })\r\n                .state('main.server.sites', {\r\n                abstract: true,\r\n                templateUrl: 'sites.html',\r\n                resolve: {\r\n                    place: ['SitesPlace', function (SitesPlace) { return SitesPlace.create(); }]\r\n                },\r\n                controller: VizPortal.SitesPlaceCtrl\r\n            });\r\n            var contentSubplaceResolve = {\r\n                subplace: ['place', function (place) { return place.subplace('sites'); }],\r\n                resource: 'Sites',\r\n                detailsUrl: function () { return ''; },\r\n                projectUrl: function () { return ''; },\r\n                workbookUrl: function () { return ''; },\r\n                defaultOrder: function () { return VizPortal.SitesContentType.defaultOrder; },\r\n                shouldFetchDetails: function () { return (function () { return true; }); } // Fetches details by default\r\n            };\r\n            $stateProvider\r\n                .state('main.server.sites.sites', {\r\n                url: '/sites',\r\n                templateUrl: 'contentSubplace.html',\r\n                controller: VizPortal.ContentSubplaceCtrl,\r\n                resolve: contentSubplaceResolve\r\n            });\r\n            // Content: see contentConfig.ts\r\n            // Users\r\n            $stateProvider\r\n                .state('main.server.users', {\r\n                url: '/users',\r\n                templateUrl: 'serverUsersPlace.html',\r\n                data: {\r\n                    authLevel: VizPortal.AuthLevel.ServerAdmin\r\n                },\r\n                controller: VizPortal.ServerUsersPlaceCtrl\r\n            });\r\n            $stateProvider\r\n                .state('main.site.users', {\r\n                url: '/users',\r\n                templateUrl: 'siteUsersPlace.html',\r\n                data: {\r\n                    authLevel: VizPortal.AuthLevel.SiteAdmin\r\n                },\r\n                resolve: {\r\n                    canSessionUserManageUsers: ['ServerService', function (serverService) { return serverService.canSessionUserManageUsers(); }]\r\n                },\r\n                controller: VizPortal.SiteUsersPlaceCtrl\r\n            });\r\n            // Server User\r\n            // Looking for Site User? It's in contentConfig.ts.\r\n            // !!! ATTENTION !!!\r\n            // If you changed the url scheme of user or user setting,\r\n            // make sure to also update the user setting url generation code in:\r\n            // \\workgroup\\vqlweb\\scriptsharp\\src\\Authoring\\ViewModels\\AuthoringMastheadViewModel.cs\r\n            $stateProvider\r\n                .state('main.server.user', {\r\n                abstract: true,\r\n                url: '/user/:domainName/{username:.*}',\r\n                templateUrl: 'serverUserPlace.html',\r\n                controller: VizPortal.ServerUserPlaceCtrl,\r\n                resolve: {\r\n                    isSessionUserSelf: ['ServerService', function (serverService) {\r\n                            return serverService.isSessionUserSelf();\r\n                        }],\r\n                    serverUser: ['ServerUsers', '$stateParams', function (serverUsers, $stateParams) {\r\n                            return serverUsers.getUserByUsernameAndDomain($stateParams['username'], $stateParams['domainName']);\r\n                        }],\r\n                    userSettings: ['UserSettingsStore', '$stateParams', function (userSettingsStore, $stateParams) {\r\n                            return userSettingsStore.getUserSettings($stateParams['username'], $stateParams['domainName']);\r\n                        }],\r\n                    userDoesNotExist: ['$state', 'serverUser', 'ServerService', function ($state, serverUser, server) {\r\n                            if (!serverUser) {\r\n                                if (server.canSessionUserManageUsers()) {\r\n                                    var usersErrorState = {\r\n                                        detailsLocKey: 'userCannotBeAccessed',\r\n                                        redirectState: 'main.server.users',\r\n                                        redirectLocKey: 'backToUsers'\r\n                                    };\r\n                                    $state.go('main.error', usersErrorState);\r\n                                }\r\n                                else {\r\n                                    $state.go('main.error');\r\n                                }\r\n                            }\r\n                        }]\r\n                }\r\n            })\r\n                .state('main.server.user.settings', {\r\n                url: '/settings',\r\n                templateUrl: 'serverUserSettingsSubplace.html',\r\n                controller: VizPortal.ServerUserSettingsSubplaceCtrl,\r\n                resolve: {\r\n                    serverUser: ['ServerUsers', '$stateParams', function (serverUsers, $stateParams) {\r\n                            return serverUsers.getUserByUsernameAndDomain($stateParams['username'], $stateParams['domainName']);\r\n                        }\r\n                    ],\r\n                    userRefreshTokenCount: ['ServerUsers', '$stateParams', function (serverUsers, $stateParams) {\r\n                            return serverUsers.getUserRefreshTokenCount($stateParams['username'], $stateParams['domainName']);\r\n                        }\r\n                    ]\r\n                }\r\n            });\r\n            // Groups\r\n            $stateProvider\r\n                .state('main.site.groups', {\r\n                url: '/groups',\r\n                templateUrl: 'groupsPlace.html',\r\n                data: {\r\n                    authLevel: VizPortal.AuthLevel.SiteAdmin\r\n                },\r\n                controller: VizPortal.GroupsPlaceCtrl\r\n            });\r\n            // Group\r\n            $stateProvider\r\n                .state('main.site.group', {\r\n                abstract: true,\r\n                url: '/groups/:id',\r\n                templateUrl: 'group.html',\r\n                data: {\r\n                    authLevel: VizPortal.AuthLevel.SiteAdmin\r\n                },\r\n                resolve: {\r\n                    group: ['Groups', '$stateParams', function (Groups, $stateParams) {\r\n                            return Groups.getById($stateParams['id']);\r\n                        }],\r\n                    groupDoesNotExist: ['$state', 'group', 'ServerService',\r\n                        function ($state, group, server) {\r\n                            if (!group) {\r\n                                $state.go('main.error', {\r\n                                    detailsLocKey: 'groupCannotBeAccessed',\r\n                                    redirectState: 'main.site.groups',\r\n                                    redirectLocKey: 'backToGroups'\r\n                                });\r\n                            }\r\n                        }]\r\n                },\r\n                controller: VizPortal.GroupPlaceCtrl\r\n            })\r\n                .state('main.site.group.users', {\r\n                url: '/users',\r\n                templateUrl: 'groupUsersSubplace.html',\r\n                controller: VizPortal.GroupUsersSubplaceCtrl\r\n            })\r\n                .state('main.site.group.details', {\r\n                url: '/details',\r\n                templateUrl: 'groupDetails.html',\r\n                resolve: {\r\n                    groupDetails: [\r\n                        'Groups', 'group', function (Groups, group) {\r\n                            return Groups.getGroupDetails(group.id);\r\n                        }],\r\n                    canSessionUserManageUsers: ['ServerService', function (serverService) { return serverService.canSessionUserManageUsers(); }]\r\n                },\r\n                controller: VizPortal.GroupDetailsCtrl\r\n            });\r\n            // Schedules\r\n            var serverStateProperties = {\r\n                data: {\r\n                    authLevel: VizPortal.AuthLevel.ServerAdmin\r\n                },\r\n                resolve: {\r\n                    siteId: function () { return null; }\r\n                }\r\n            };\r\n            var siteStateProperties = {\r\n                data: {\r\n                    authLevel: VizPortal.AuthLevel.SiteAdmin\r\n                },\r\n                resolve: {\r\n                    siteId: ['ServerService', function (serverService) { return serverService.waitForSession().then(function () { return serverService.sessionSiteId(); }); }]\r\n                }\r\n            };\r\n            var scheduleStates = function (stateName, extraStateProperties) {\r\n                // List state\r\n                var scheduleListState = {\r\n                    url: '/schedules',\r\n                    templateUrl: 'schedules.html',\r\n                    controller: VizPortal.SchedulesCtrl\r\n                };\r\n                $.extend(true, scheduleListState, extraStateProperties);\r\n                $stateProvider.state(stateName + 's', scheduleListState);\r\n                // Place state\r\n                var scheduleState = {\r\n                    abstract: true,\r\n                    resolve: {\r\n                        schedule: [\r\n                            'Schedules', '$stateParams', 'siteId',\r\n                            function (Schedules, $stateParams, siteId) {\r\n                                return Schedules.getByIdForSite($stateParams['id'], siteId);\r\n                            }\r\n                        ],\r\n                        place: [\r\n                            'TaskPlace', 'siteId', 'schedule',\r\n                            function (TaskPlace, siteId, schedule) {\r\n                                return TaskPlace.create(siteId, { schedule: schedule.id });\r\n                            }\r\n                        ]\r\n                    },\r\n                    url: '/schedules/:id',\r\n                    templateUrl: 'schedule.html',\r\n                    controller: VizPortal.ScheduleCtrl\r\n                };\r\n                $.extend(true, scheduleState, extraStateProperties);\r\n                $stateProvider.state(stateName, scheduleState);\r\n                // Subplace states\r\n                $stateProvider\r\n                    .state(stateName + '.details', {\r\n                    url: '/details',\r\n                    templateUrl: 'scheduleDetails.html',\r\n                    controller: VizPortal.setBrowserTitleCtrl('details')\r\n                });\r\n                VizPortal.ConfigHelper.addTaskSubstates($stateProvider, stateName);\r\n            };\r\n            scheduleStates('main.server.schedule', serverStateProperties);\r\n            scheduleStates('main.site.schedule', siteStateProperties);\r\n            // Tasks\r\n            var taskState = function (stateName, extraStateProperties) {\r\n                var taskState = {\r\n                    abstract: true,\r\n                    url: '/tasks',\r\n                    templateUrl: 'tasks.html',\r\n                    controller: VizPortal.TasksCtrl,\r\n                    resolve: {\r\n                        place: ['TaskPlace', 'siteId', function (TaskPlace, siteId) { return TaskPlace.create(siteId); }]\r\n                    }\r\n                };\r\n                $.extend(true, taskState, extraStateProperties);\r\n                $stateProvider.state(stateName, taskState);\r\n                VizPortal.ConfigHelper.addTaskSubstates($stateProvider, stateName);\r\n            };\r\n            taskState('main.server.tasks', serverStateProperties);\r\n            taskState('main.site.tasks', siteStateProperties);\r\n            // Viz\r\n            $stateProvider\r\n                .state('main.site.viz', {\r\n                url: '/views/*path',\r\n                templateUrl: 'vizViewer.html',\r\n                controller: VizPortal.VizViewerCtrl\r\n            });\r\n            // Site Status/Analysis\r\n            $stateProvider\r\n                .state('main.site.status', {\r\n                url: '/status',\r\n                templateUrl: 'siteStatus.html',\r\n                data: {\r\n                    authLevel: VizPortal.AuthLevel.SiteAdmin\r\n                },\r\n                controller: VizPortal.setBrowserTitleCtrl('siteStatus')\r\n            })\r\n                .state('main.site.analysis', {\r\n                url: '/analysis/{sheetUrlId}',\r\n                templateUrl: 'adminVizViewer.html',\r\n                data: {\r\n                    authLevel: VizPortal.AuthLevel.SiteAdmin\r\n                },\r\n                resolve: {\r\n                    workbookUrlId: function () { return 'tabbed_site_views'; }\r\n                },\r\n                controller: VizPortal.AdminVizViewerCtrl\r\n            });\r\n            // Site Settings\r\n            $stateProvider\r\n                .state('main.site.settings', {\r\n                templateUrl: 'siteSettingsTabs.html',\r\n                abstract: true,\r\n                controller: ['$scope', 'ServerService',\r\n                    function ($scope, server) {\r\n                        $scope.server = server;\r\n                    }]\r\n            })\r\n                .state('main.site.settings.siteSettings', {\r\n                url: '/settings',\r\n                templateUrl: 'siteSettings.html',\r\n                data: {\r\n                    authLevel: VizPortal.AuthLevel.SiteAdmin\r\n                },\r\n                resolve: {\r\n                    siteSettingsForServerAdmin: ['ServerService', 'Sites', function (ServerService, Sites) {\r\n                            // Resolve the sessionInfoPromise in case we are coming from a state\r\n                            // where the sessionInfo might be stale (e.g., logged into an arbitrary site on login)\r\n                            if (ServerService.isSessionServerAdmin()) {\r\n                                return ServerService.getSessionInfoPromise().then(function () { return Sites.getCurrentSiteSettingsForServerAdmin(); });\r\n                            }\r\n                            else {\r\n                                return null;\r\n                            }\r\n                        }],\r\n                    siteSettingsForSiteAdmin: ['ServerService', 'Sites', function (ServerService, Sites) {\r\n                            // Resolve the sessionInfoPromise in case we are coming from a state\r\n                            // where the sessionInfo might be stale (e.g., logged into an arbitrary site on login)\r\n                            return ServerService.getSessionInfoPromise().then(function () { return Sites.getCurrentSiteSettingsForSiteAdmin(); });\r\n                        }]\r\n                },\r\n                controller: ['$scope', 'BrowserTitleService', 'ServerService', 'siteSettingsForServerAdmin', 'siteSettingsForSiteAdmin',\r\n                    function ($scope, BrowserTitleService, server, siteSettingsForServerAdmin, siteSettingsForSiteAdmin) {\r\n                        var multisite = server.isSessionMultiSite();\r\n                        $scope.server = server;\r\n                        $scope.siteSettingsForServerAdmin = siteSettingsForServerAdmin;\r\n                        $scope.siteSettingsForSiteAdmin = siteSettingsForSiteAdmin;\r\n                        $scope.liveDBAvailable = server.isLiveDBAvailable();\r\n                        if ($scope.siteSettingsForServerAdmin !== null) {\r\n                            $scope.isDefaultSite = $scope.siteSettingsForServerAdmin.settings && $scope.siteSettingsForServerAdmin.settings.urlName === '';\r\n                        }\r\n                        $scope.hideNameAndId = !multisite;\r\n                        BrowserTitleService.setTitle(multisite ? 'siteSettings' : 'settings');\r\n                    }]\r\n            })\r\n                .state('main.site.settings.authentication', {\r\n                url: '/authentication',\r\n                templateUrl: 'siteAuthenticationSettings.html',\r\n                controller: VizPortal.SiteAuthenticationCtrl,\r\n                resolve: {\r\n                    siteSettingsForSiteAdmin: ['ServerService', 'Sites', function (ServerService, Sites) {\r\n                            // Resolve the sessionInfoPromise in case we are coming from a state\r\n                            // where the sessionInfo might be stale (e.g., logged into an arbitrary site on login)\r\n                            return ServerService.getSessionInfoPromise().then(function () { return Sites.getCurrentSiteSettingsForSiteAdmin(); });\r\n                        }],\r\n                    configuration: ['ServerService', function (server) {\r\n                            return server.sendRequest(new VizPortal.ServerApi.GetSiteSAMLConfigurationRequest());\r\n                        }],\r\n                    allowTransition: ['ServerService', function (server, $q) {\r\n                            if (!server.isThirdPartyAuthConfiguredForServer()) {\r\n                                return $q.reject(); // Trigger a $stateChangeError\r\n                            }\r\n                        }]\r\n                },\r\n                data: {\r\n                    authLevel: VizPortal.AuthLevel.SiteAdmin\r\n                }\r\n            });\r\n            // Error pages\r\n            $stateProvider\r\n                .state('main.error', {\r\n                templateUrl: 'error.html',\r\n                params: [\r\n                    VizPortal.ErrorCtrl.StateParamKeys.DetailsLocKey,\r\n                    VizPortal.ErrorCtrl.StateParamKeys.RedirectState,\r\n                    VizPortal.ErrorCtrl.StateParamKeys.RedirectLocKey,\r\n                    VizPortal.ErrorCtrl.StateParamKeys.RedirectSiteUrlName\r\n                ],\r\n                controller: VizPortal.ErrorCtrl\r\n            });\r\n            // Home Place\r\n            if (VizPortal.FeatureFlags.homePlaceEnabled) {\r\n                $stateProvider\r\n                    .state('main.site.home', {\r\n                    url: '/home',\r\n                    templateUrl: 'home.html',\r\n                    controller: VizPortal.HomeCtrl\r\n                });\r\n            }\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../controllers/ContentPlaceCtrl.ts\" />\r\n/// <reference path=\"../helpers/ActionContext.ts\" />\r\n/// <reference path=\"../models/IDataSourceInfo.ts\" />\r\n/// <reference path=\"../models/Set.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/types/IDataSource.ts\" />\r\n/// <reference path=\"../ServerApi/types/IRemoteRefreshProperties.ts\" />\r\n/// <reference path=\"../ServerApi/types/IResponse.ts\" />\r\n/// <reference path=\"../services/BrowserTitleService.ts\" />\r\n/// <reference path=\"../services/CreateExtractTasksAction.ts\" />\r\n/// <reference path=\"../services/EditConnectionAction.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DatasourceDataConnectionCtrl = (function () {\r\n        function DatasourceDataConnectionCtrl($scope, $state, BrowserTitleService, EditConnectionAction, CreateExtractTasksAction, ServerService) {\r\n            var _this = this;\r\n            this.$scope = $scope;\r\n            this.$state = $state;\r\n            this.EditConnectionAction = EditConnectionAction;\r\n            this.CreateExtractTasksAction = CreateExtractTasksAction;\r\n            this.ServerService = ServerService;\r\n            BrowserTitleService.setTitle('dataConnection', $scope.objectName);\r\n            this.isEditing = false;\r\n            this.datasource = $scope.datasource;\r\n            var datasourceSet = VizPortal.Set.singleton(this.datasource, function (ds) { return ds.id; });\r\n            $scope.isOAuth = this.isOAuth();\r\n            $scope.canEditConnection = this.canEditConnection();\r\n            $scope.dataConnectionIsReading = function () {\r\n                return !$scope.dataConnectionIsEditing();\r\n            };\r\n            $scope.dataConnectionIsEditing = function () {\r\n                return _this.isEditing && _this.canEditConnection();\r\n            };\r\n            $scope.refreshNow = function ($event) {\r\n                _this.CreateExtractTasksAction.forDatasource(_this.datasource, VizPortal.ActionContext.fromEvent($event), VizPortal.CreateExtractTasksMode.AllowRefreshNow)\r\n                    .then(function () { return _this.$state.hardReload(); });\r\n            };\r\n            $scope.requestRefreshNowIsDisabled = function () {\r\n                return _this.currentRefreshModeIsRemote();\r\n            };\r\n            $scope.editOAuth = function ($event) {\r\n                $scope.oauthEditModel = _this.EditConnectionAction.createOAuthEditModel(datasourceSet);\r\n                $scope.testConnectionResult = { isPending: false };\r\n                _this.isEditing = true;\r\n            };\r\n            $scope.beginEdit = function () {\r\n                _this.isEditing = true;\r\n                $scope.editModel = {\r\n                    serverName: _this.datasource.connectionDetails.serverName,\r\n                    serverPort: _this.datasource.connectionDetails.serverPort,\r\n                    username: _this.datasource.connectionDetails.databaseUsername,\r\n                    password: {\r\n                        isEmbedded: _this.datasource.connectionDetails.hasEmbeddedPassword,\r\n                        newPassword: VizPortal.PasswordUnchanged\r\n                    }\r\n                };\r\n            };\r\n            $scope.save = function () {\r\n                $scope.isSaving = true;\r\n                var savePromise;\r\n                if ($scope.canEditConnection && !$scope.isOAuth) {\r\n                    savePromise = EditConnectionAction.applyConnectionEdits(datasourceSet, $scope.editModel);\r\n                }\r\n                else if ($scope.canEditConnection && $scope.isOAuth) {\r\n                    savePromise = EditConnectionAction.updateOAuthConnections(datasourceSet, $scope.oauthEditModel);\r\n                }\r\n                savePromise.then(function () { return _this.$state.hardReload(); });\r\n            };\r\n            $scope.cancel = function () {\r\n                _this.isEditing = false;\r\n                $scope.testConnectionResult = { isPending: false };\r\n                // Clear modified oauthEditModel, needed for testConnection to work properly\r\n                $scope.oauthEditModel = _this.$scope.oauthInitialEditModel;\r\n            };\r\n            $scope.requestTestConnectionIsDisabled = function () {\r\n                return _this.currentRefreshModeIsRemote();\r\n            };\r\n            if ($scope.isOAuth) {\r\n                // testConnection will be set by configureEditOAuthScope\r\n                this.EditConnectionAction.configureEditOAuthScope(this.$scope, datasourceSet);\r\n                this.$scope.oauthInitialEditModel = this.$scope.oauthEditModel;\r\n            }\r\n            else {\r\n                $scope.testConnection = function () { return _this.testConnection(); };\r\n            }\r\n        }\r\n        DatasourceDataConnectionCtrl.prototype.testConnection = function () {\r\n            this.$scope.testConnectionResult = this.isEditing\r\n                ? this.EditConnectionAction.checkEditedConnection(this.datasource.id, this.$scope.editModel)\r\n                : this.EditConnectionAction.checkExistingConnection(this.datasource.id);\r\n        };\r\n        DatasourceDataConnectionCtrl.prototype.isOAuth = function () {\r\n            return this.datasource.connectionOAuth && (this.datasource.connectionDetails.type === VizPortal.ServerApi.ConnectionDetailType.Database);\r\n        };\r\n        DatasourceDataConnectionCtrl.prototype.currentUserAllowedToEdit = function () {\r\n            return this.ServerService.isSessionSiteOrServerAdmin() || this.datasource.owner.id === this.ServerService.sessionUserId();\r\n        };\r\n        DatasourceDataConnectionCtrl.prototype.canEditConnection = function () {\r\n            return this.datasource.connectionTypeEditable && this.currentUserAllowedToEdit();\r\n        };\r\n        DatasourceDataConnectionCtrl.prototype.hasRemoteRefreshProperties = function () {\r\n            return this.ServerService.featureFlags().dataSyncEnabled && this.datasource.hasExtracts && !this.isOAuth();\r\n        };\r\n        DatasourceDataConnectionCtrl.prototype.currentRefreshModeIsRemote = function () {\r\n            return this.hasRemoteRefreshProperties() && this.datasource.refreshMode === VizPortal.ServerApi.RefreshModeTypes.Remote;\r\n        };\r\n        DatasourceDataConnectionCtrl.$inject = [\r\n            '$scope',\r\n            '$state',\r\n            'BrowserTitleService',\r\n            'EditConnectionAction',\r\n            'CreateExtractTasksAction',\r\n            'ServerService'\r\n        ];\r\n        return DatasourceDataConnectionCtrl;\r\n    })();\r\n    VizPortal.DatasourceDataConnectionCtrl = DatasourceDataConnectionCtrl;\r\n    VizPortal.Module.instance().controller('DatasourceDataConnectionCtrl', DatasourceDataConnectionCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../controllers/ContentPlaceCtrl.ts\" />\r\n/// <reference path=\"../helpers/ResultHelper.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SiteUserPlaceCtrl = (function () {\r\n        function SiteUserPlaceCtrl($scope, $state, ServerService, \r\n            // resolved in ui router\r\n            isSessionServerAdmin, isSessionSiteAdmin, isSessionUserSelf, place, siteUser, userSettings, serverUser) {\r\n            $scope.multisite = ServerService.isSessionMultiSite();\r\n            if (siteUser) {\r\n                $scope.siteRole = siteUser.siteRole;\r\n                $scope.user = siteUser;\r\n                $scope.objectName = siteUser.displayName;\r\n            }\r\n            else if (isSessionServerAdmin) {\r\n                $scope.siteRole = VizPortal.ServerApi.SiteRoles.ServerAdministrator;\r\n                $scope.user = _.omit(serverUser, 'lastSignIn');\r\n                $scope.objectName = serverUser.displayName;\r\n            }\r\n            else {\r\n                // UI Router should redirect to 'pageDoesNotExist' before we get here.\r\n                throw new Error('User does not exist on this site');\r\n            }\r\n            $scope.userSettings = userSettings;\r\n            $scope.hasUserSettings = !VizPortal.ResultHelper.hasErrors(userSettings);\r\n            $scope.isSessionServerAdmin = isSessionServerAdmin;\r\n            $scope.isSessionSiteOrServerAdmin = isSessionServerAdmin || isSessionSiteAdmin;\r\n            $scope.isSessionUserSelf = isSessionUserSelf;\r\n            VizPortal.SubplaceCountsHelper.keepSubplaceCountsUpdated($scope, place);\r\n            VizPortal.SubplaceTabsHelper.refreshWhenCurrentTabClicked($scope, $state);\r\n        }\r\n        SiteUserPlaceCtrl.$inject = [\r\n            '$scope',\r\n            '$state',\r\n            'ServerService',\r\n            // resolved in ui router\r\n            'isSessionServerAdmin',\r\n            'isSessionSiteAdmin',\r\n            'isSessionUserSelf',\r\n            'place',\r\n            'siteUser',\r\n            'userSettings',\r\n            // injected by ui router when user is a server admin and not a site member\r\n            'serverUser'\r\n        ];\r\n        return SiteUserPlaceCtrl;\r\n    })();\r\n    VizPortal.SiteUserPlaceCtrl = SiteUserPlaceCtrl;\r\n    VizPortal.Module.instance().controller('SiteUserPlaceCtrl', SiteUserPlaceCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var AssociateOAuthCredentialRequest = (function (_super) {\r\n            __extends(AssociateOAuthCredentialRequest, _super);\r\n            function AssociateOAuthCredentialRequest(params) {\r\n                _super.call(this, 'associateOAuthCredential', params);\r\n            }\r\n            return AssociateOAuthCredentialRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.AssociateOAuthCredentialRequest = AssociateOAuthCredentialRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var DeleteOAuthCredentialsRequest = (function (_super) {\r\n            __extends(DeleteOAuthCredentialsRequest, _super);\r\n            function DeleteOAuthCredentialsRequest(ids) {\r\n                _super.call(this, 'deleteOAuthCredentials', { ids: ids });\r\n            }\r\n            return DeleteOAuthCredentialsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.DeleteOAuthCredentialsRequest = DeleteOAuthCredentialsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var DisassociateOAuthCredentialRequest = (function (_super) {\r\n            __extends(DisassociateOAuthCredentialRequest, _super);\r\n            function DisassociateOAuthCredentialRequest(params) {\r\n                _super.call(this, 'disassociateOAuthCredential', params);\r\n            }\r\n            return DisassociateOAuthCredentialRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.DisassociateOAuthCredentialRequest = DisassociateOAuthCredentialRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetCommonUserOAuthCredentialRequest = (function (_super) {\r\n            __extends(GetCommonUserOAuthCredentialRequest, _super);\r\n            function GetCommonUserOAuthCredentialRequest(params) {\r\n                _super.call(this, 'getCommonUserOAuthCredential', params);\r\n            }\r\n            return GetCommonUserOAuthCredentialRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetCommonUserOAuthCredentialRequest = GetCommonUserOAuthCredentialRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        ServerApi.OAuthCredentialTypes = {\r\n            Salesforce: 'salesforce',\r\n            BigQuery: 'bigquery',\r\n            GoogleAnalytics: 'google-analytics'\r\n        };\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/IOAuthCredential.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetOAuthCredentialAssociatedWithResourceRequest = (function (_super) {\r\n            __extends(GetOAuthCredentialAssociatedWithResourceRequest, _super);\r\n            function GetOAuthCredentialAssociatedWithResourceRequest(params) {\r\n                _super.call(this, 'getOAuthCredentialAssociatedWithResource', params);\r\n            }\r\n            return GetOAuthCredentialAssociatedWithResourceRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetOAuthCredentialAssociatedWithResourceRequest = GetOAuthCredentialAssociatedWithResourceRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/IOAuthCredential.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetOAuthCredentialsRequest = (function (_super) {\r\n            __extends(GetOAuthCredentialsRequest, _super);\r\n            function GetOAuthCredentialsRequest(params) {\r\n                _super.call(this, 'getOAuthCredentials', params);\r\n            }\r\n            return GetOAuthCredentialsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetOAuthCredentialsRequest = GetOAuthCredentialsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var TestOAuthCredentialRequest = (function (_super) {\r\n            __extends(TestOAuthCredentialRequest, _super);\r\n            function TestOAuthCredentialRequest(id) {\r\n                _super.call(this, 'testOAuthCredential', { id: id });\r\n            }\r\n            return TestOAuthCredentialRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.TestOAuthCredentialRequest = TestOAuthCredentialRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/AssociateOAuthCredentialRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/DeleteOAuthCredentialsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/DisassociateOAuthCredentialRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetCommonUserOAuthCredentialRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetOAuthCredentialAssociatedWithResourceRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetOAuthCredentialsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/TestOAuthCredentialRequest.ts\" />\r\n/// <reference path=\"Resource.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var OAuthCredentials = (function (_super) {\r\n        __extends(OAuthCredentials, _super);\r\n        function OAuthCredentials(ErrorNotifyingServer, serverService, FetcherFactory) {\r\n            _super.call(this, FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetOAuthCredentialsRequest, function (result) { return result.credentials; }));\r\n            this.ErrorNotifyingServer = ErrorNotifyingServer;\r\n            this.serverService = serverService;\r\n        }\r\n        OAuthCredentials.prototype.del = function (ids) {\r\n            return this.ErrorNotifyingServer.sendRequests(VizPortal.RequestHelper.buildRequests(ids, function (idsBlock) { return new VizPortal.ServerApi.DeleteOAuthCredentialsRequest(idsBlock); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        OAuthCredentials.prototype.test = function (id) {\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.TestOAuthCredentialRequest(id));\r\n        };\r\n        OAuthCredentials.prototype.associateWithDatasource = function (datasourceId, credentialId) {\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.AssociateOAuthCredentialRequest({\r\n                credentialId: credentialId,\r\n                resourceId: datasourceId,\r\n                resourceType: 'Datasource'\r\n            }));\r\n        };\r\n        OAuthCredentials.prototype.disassociateFromDatasource = function (datasourceId) {\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.DisassociateOAuthCredentialRequest({\r\n                resourceId: datasourceId,\r\n                resourceType: 'Datasource'\r\n            }));\r\n        };\r\n        OAuthCredentials.prototype.credentialForDatasource = function (datasourceId) {\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.GetOAuthCredentialAssociatedWithResourceRequest({\r\n                resourceId: datasourceId,\r\n                resourceType: 'Datasource'\r\n            }));\r\n        };\r\n        OAuthCredentials.prototype.commonCredentialForDatasources = function (datasourceIds) {\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.GetCommonUserOAuthCredentialRequest({\r\n                ids: datasourceIds\r\n            }));\r\n        };\r\n        OAuthCredentials.prototype.canAddForConnectionType = function (connectionType) {\r\n            switch (connectionType) {\r\n                case VizPortal.ServerApi.OAuthCredentialTypes.Salesforce:\r\n                    return this.serverService.oauthSalesforceEnabled();\r\n                case VizPortal.ServerApi.OAuthCredentialTypes.BigQuery:\r\n                case VizPortal.ServerApi.OAuthCredentialTypes.GoogleAnalytics:\r\n                    return this.serverService.oauthGoogleEnabled();\r\n                default:\r\n                    return false;\r\n            }\r\n        };\r\n        OAuthCredentials.$inject = ['ErrorNotifyingServer', 'ServerService', 'FetcherFactory'];\r\n        return OAuthCredentials;\r\n    })(VizPortal.Resource);\r\n    VizPortal.OAuthCredentials = OAuthCredentials;\r\n    VizPortal.Module.instance().service('OAuthCredentials', OAuthCredentials);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/WindowLocationService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    // NOTE: Keep this in sync with the code in embeddedCommon.jade\r\n    var AddOAuthCredentialAction = (function () {\r\n        function AddOAuthCredentialAction($window, $rootScope, $q, WindowLocationService) {\r\n            var _this = this;\r\n            this.$window = $window;\r\n            this.$rootScope = $rootScope;\r\n            this.$q = $q;\r\n            this.WindowLocationService = WindowLocationService;\r\n            this.deferred = $q.defer(); // Noop deferred to remove null checking logic\r\n            // SET UP GLOBAL LISTENERS\r\n            $window.tableauPopupComplete = function (response) { return _this.handleResponse(response); };\r\n            $($window).on('message', function (jqEvent) {\r\n                // casted to <any> because JQueryEvent originalEvent is expected to be a PopStateEvent which is not compatible with MessageEvent\r\n                var originalEvent = jqEvent.originalEvent;\r\n                // Ignore messages that don't come from the open window, use == for checking window equivalence in IE8\r\n                if (originalEvent.source != _this.openWindow)\r\n                    return;\r\n                var response = originalEvent.data;\r\n                if (!_.isString(response))\r\n                    return;\r\n                _this.handleResponse(response);\r\n            });\r\n            // The user is navigating away from this page so the popup is no longer needed, let's try to remove it for them.\r\n            $($window).on('unload', function () { return _this.removeOpenWindow(); });\r\n        }\r\n        AddOAuthCredentialAction.prototype.handleResponse = function (response) {\r\n            if (response === void 0) { response = ''; }\r\n            var errorCodeMatch = response.match(/errorCode=([^&]*)/);\r\n            if (errorCodeMatch) {\r\n                var errorCode = parseInt(errorCodeMatch[1], 10) || 0;\r\n                this.notifyError(errorCode);\r\n                return;\r\n            }\r\n            var newCredentialIdMatch = response.match(/id=([^&]*)/);\r\n            if (newCredentialIdMatch) {\r\n                this.notifySuccess(newCredentialIdMatch[1]);\r\n                return;\r\n            }\r\n            this.notifySuccess('');\r\n        };\r\n        AddOAuthCredentialAction.prototype.removeOpenWindow = function () {\r\n            try {\r\n                this.openWindow.close();\r\n            }\r\n            catch (e) {\r\n            } // Closing the window is best effort so there's nothing to do if it fails\r\n            this.openWindow = null;\r\n        };\r\n        AddOAuthCredentialAction.prototype.notifySuccess = function (credentialId) {\r\n            this.deferred.resolve(credentialId);\r\n            this.removeOpenWindow();\r\n        };\r\n        AddOAuthCredentialAction.prototype.notifyError = function (errorCode) {\r\n            this.deferred.reject(errorCode);\r\n            this.removeOpenWindow();\r\n        };\r\n        AddOAuthCredentialAction.prototype.getPopupSpecs = function () {\r\n            var popupOptions = {\r\n                width: 800,\r\n                height: 600,\r\n                toolbar: 1,\r\n                resizable: 1\r\n            };\r\n            // IE8 polyfills. Note that outer* ones are not quite right for IE8, but good enough. B147312\r\n            var screenLeft = this.$window.screenLeft || this.$window.screenX;\r\n            var outerWidth = this.$window.outerWidth || this.$window.innerWidth;\r\n            var screenTop = this.$window.screenTop || this.$window.screenY;\r\n            var outerHeight = this.$window.outerHeight || this.$window.innerHeight;\r\n            // Open horizontally centered on current window\r\n            popupOptions.left = screenLeft + (outerWidth - popupOptions.width) / 2;\r\n            // Open a small amount from the top\r\n            popupOptions.top = screenTop + (outerHeight - popupOptions.height) / 8;\r\n            return popupOptions;\r\n        };\r\n        // Public methods\r\n        AddOAuthCredentialAction.prototype.href = function (type) {\r\n            return AddOAuthCredentialAction.OAuthPath + '?' + $.param({ 'data_class': type });\r\n        };\r\n        AddOAuthCredentialAction.prototype.attemptAuth = function (type) {\r\n            this.cancelPendingAuthAttempt();\r\n            this.deferred = this.$q.defer();\r\n            this.openWindow = this.WindowLocationService.open(this.href(type), AddOAuthCredentialAction.WindowName, this.getPopupSpecs());\r\n            try {\r\n                this.openWindow.focus(); // Bring the newly opened window to the front\r\n            }\r\n            catch (e) { }\r\n            return this.deferred.promise;\r\n        };\r\n        AddOAuthCredentialAction.prototype.cancelPendingAuthAttempt = function () {\r\n            return this.notifyError();\r\n        };\r\n        AddOAuthCredentialAction.OAuthPath = '/auth/request_oauth';\r\n        AddOAuthCredentialAction.WindowName = 'TableauAuth';\r\n        AddOAuthCredentialAction.$inject = ['$window', '$rootScope', '$q', 'WindowLocationService'];\r\n        return AddOAuthCredentialAction;\r\n    })();\r\n    VizPortal.AddOAuthCredentialAction = AddOAuthCredentialAction;\r\n    VizPortal.Module.instance().service('AddOAuthCredentialAction', AddOAuthCredentialAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        // Given a user id, get their remote refresh agents.\r\n        var GetRemoteRefreshAgentsRequest = (function (_super) {\r\n            __extends(GetRemoteRefreshAgentsRequest, _super);\r\n            function GetRemoteRefreshAgentsRequest(params) {\r\n                _super.call(this, 'getRemoteRefreshAgents', params);\r\n            }\r\n            return GetRemoteRefreshAgentsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetRemoteRefreshAgentsRequest = GetRemoteRefreshAgentsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var DeleteRemoteRefreshAgentsRequest = (function (_super) {\r\n            __extends(DeleteRemoteRefreshAgentsRequest, _super);\r\n            function DeleteRemoteRefreshAgentsRequest(params) {\r\n                _super.call(this, 'deleteRemoteRefreshAgents', params);\r\n            }\r\n            return DeleteRemoteRefreshAgentsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.DeleteRemoteRefreshAgentsRequest = DeleteRemoteRefreshAgentsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../fetchers/ServerResourceFetcher.ts\" />\r\n/// <reference path=\"../helpers/ServerModelHelper.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetRemoteRefreshAgentsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/DeleteRemoteRefreshAgentsRequest.ts\" />\r\n/// <reference path=\"../services/ErrorNotifyingServer.ts\" />\r\n/// <reference path=\"Resource.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var RemoteRefreshAgents = (function (_super) {\r\n        __extends(RemoteRefreshAgents, _super);\r\n        function RemoteRefreshAgents(ErrorNotifyingServer, FetcherFactory) {\r\n            _super.call(this, FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetRemoteRefreshAgentsRequest, VizPortal.ServerApiMapper.remoteRefreshAgents));\r\n            this.ErrorNotifyingServer = ErrorNotifyingServer;\r\n        }\r\n        RemoteRefreshAgents.prototype.get = function () {\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.GetRemoteRefreshAgentsRequest({\r\n                withContent: false\r\n            }));\r\n        };\r\n        RemoteRefreshAgents.prototype.getWithContent = function () {\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.GetRemoteRefreshAgentsRequest({\r\n                withContent: true\r\n            }));\r\n        };\r\n        RemoteRefreshAgents.prototype.del = function (agents) {\r\n            var agentNames = _.map(agents.toArray(), function (agent) { return agent.name; });\r\n            return this.ErrorNotifyingServer.sendRequests(VizPortal.RequestHelper.buildRequests(agentNames, function (agentNamesBlock) {\r\n                return new VizPortal.ServerApi.DeleteRemoteRefreshAgentsRequest({ agentNames: agentNamesBlock });\r\n            }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        RemoteRefreshAgents.$inject = ['ErrorNotifyingServer', 'FetcherFactory'];\r\n        return RemoteRefreshAgents;\r\n    })(VizPortal.Resource);\r\n    VizPortal.RemoteRefreshAgents = RemoteRefreshAgents;\r\n    VizPortal.Module.instance().service('RemoteRefreshAgents', RemoteRefreshAgents);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../resources/RemoteRefreshAgents.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DeleteRemoteRefreshAgentsAction = (function () {\r\n        function DeleteRemoteRefreshAgentsAction($translate, ConfirmActionDialog, ContentActionNotification, RemoteRefreshAgents) {\r\n            this.$translate = $translate;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.ContentActionNotification = ContentActionNotification;\r\n            this.RemoteRefreshAgents = RemoteRefreshAgents;\r\n        }\r\n        DeleteRemoteRefreshAgentsAction.prototype.execute = function (agents, context) {\r\n            var _this = this;\r\n            return this.ConfirmActionDialog.open({\r\n                scope: context.scope.$new(),\r\n                title: this.$translate.instant('delete'),\r\n                bodyText: this.$translate.instant('confirmDeleteRemoteRefreshAgents', { COUNT: agents.size() }, VizPortal.L10n.Interpolations.Count),\r\n                position: VizPortal.ModalService.anchoredTo(context.targetElement),\r\n                actionName: this.$translate.instant('confirmDeleteButton', { ITEM_COUNT: agents.size() }, VizPortal.L10n.Interpolations.Count),\r\n                action: function (dialogInstance) {\r\n                    return _this.RemoteRefreshAgents.del(agents)\r\n                        .then(function (result) {\r\n                        if (result.errors && result.errors.length) {\r\n                            var errorMessage = _this.errorMessageFor(result.errors[0]);\r\n                            dialogInstance.showErrorMessage(errorMessage);\r\n                        }\r\n                        else {\r\n                            _this.ContentActionNotification.notifySuccess(_this.$translate.instant('deleteRemoteRefreshAgentsSuccess', { ITEM_COUNT: agents.size() }, VizPortal.L10n.Interpolations.Count));\r\n                        }\r\n                        return result;\r\n                    });\r\n                }\r\n            }).result;\r\n        };\r\n        DeleteRemoteRefreshAgentsAction.prototype.errorMessageFor = function (error) {\r\n            return this.$translate.instant('errorUnknown');\r\n        };\r\n        DeleteRemoteRefreshAgentsAction.$inject = [\r\n            '$translate',\r\n            'ConfirmActionDialog',\r\n            'ContentActionNotification',\r\n            'RemoteRefreshAgents'\r\n        ];\r\n        return DeleteRemoteRefreshAgentsAction;\r\n    })();\r\n    VizPortal.DeleteRemoteRefreshAgentsAction = DeleteRemoteRefreshAgentsAction;\r\n    VizPortal.Module.instance().service('DeleteRemoteRefreshAgentsAction', DeleteRemoteRefreshAgentsAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var DeleteMySavedPasswordsAndCredentialsRequest = (function (_super) {\r\n            __extends(DeleteMySavedPasswordsAndCredentialsRequest, _super);\r\n            function DeleteMySavedPasswordsAndCredentialsRequest(params) {\r\n                if (params === void 0) { params = {}; }\r\n                _super.call(this, 'deleteMySavedPasswordsAndCredentials', params);\r\n            }\r\n            return DeleteMySavedPasswordsAndCredentialsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.DeleteMySavedPasswordsAndCredentialsRequest = DeleteMySavedPasswordsAndCredentialsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/DeleteMySavedPasswordsAndCredentialsRequest.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DeleteMyCredentialsAction = (function () {\r\n        function DeleteMyCredentialsAction($translate, $q, ConfirmActionDialog, serverService, ToasterService) {\r\n            this.$translate = $translate;\r\n            this.$q = $q;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.serverService = serverService;\r\n            this.ToasterService = ToasterService;\r\n        }\r\n        DeleteMyCredentialsAction.prototype.executeFromEvent = function ($event) {\r\n            var _this = this;\r\n            var actionContext = VizPortal.ActionContext.fromEvent($event);\r\n            var confirmActionDialogInstance = this.ConfirmActionDialog.open({\r\n                scope: actionContext.scope,\r\n                title: this.$translate.instant('clearSavedCredentials'),\r\n                bodyText: this.$translate.instant('clearUserSavedCredentialsConfirmMessage'),\r\n                actionName: this.$translate.instant('clearSavedCredentialsConfirmButton'),\r\n                isDeleteAction: true,\r\n                action: function (confirmActionDialogInstance) {\r\n                    return _this.serverService.sendRequest(new VizPortal.ServerApi.DeleteMySavedPasswordsAndCredentialsRequest())\r\n                        .then(VizPortal.ResultHelper.rejectResultOnError(_this.$q))\r\n                        .then(_.identity, function () { return confirmActionDialogInstance.showErrorMessage(_this.$translate.instant('clearSavedCredentialsError')); });\r\n                }\r\n            });\r\n            confirmActionDialogInstance.result.then(function (result) {\r\n                _this.ToasterService.pop({ type: VizPortal.ToastType.Info, text: _this.$translate.instant('clearSavedCredentialsSuccess') });\r\n            });\r\n            return confirmActionDialogInstance.result;\r\n        };\r\n        DeleteMyCredentialsAction.$inject = ['$translate', '$q', 'ConfirmActionDialog', 'ServerService', 'ToasterService'];\r\n        return DeleteMyCredentialsAction;\r\n    })();\r\n    VizPortal.DeleteMyCredentialsAction = DeleteMyCredentialsAction;\r\n    VizPortal.Module.instance().service('DeleteMyCredentialsAction', DeleteMyCredentialsAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"AbstractContentAction.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DeleteOAuthCredentialsAction = (function (_super) {\r\n        __extends(DeleteOAuthCredentialsAction, _super);\r\n        function DeleteOAuthCredentialsAction(ConfirmActionDialog, ContentActionNotification, $translate, $filter, OAuthCredentials) {\r\n            _super.call(this, ConfirmActionDialog, ContentActionNotification);\r\n            this.$translate = $translate;\r\n            this.$filter = $filter;\r\n            this.OAuthCredentials = OAuthCredentials;\r\n        }\r\n        DeleteOAuthCredentialsAction.prototype.configureDialog = function (dialogConfig, oauthCredentials) {\r\n            var _this = this;\r\n            var dialogBody = oauthCredentials.size() === 1\r\n                ? this.$translate.instant('confirmDeleteOAuthCredential', {\r\n                    USERNAME: VizPortal.L10n.elideIfLong(oauthCredentials.first().username),\r\n                    TRANSLATED_TYPE: this.$filter('credentialType')(oauthCredentials.first().type)\r\n                })\r\n                : this.$translate.instant('confirmDeleteOAuthCredentials', { CREDENTIAL_COUNT: oauthCredentials.size() }, VizPortal.L10n.Interpolations.Count);\r\n            dialogConfig.bodyText = dialogBody;\r\n            dialogConfig.title = this.$translate.instant('delete');\r\n            dialogConfig.actionName = this.$translate.instant('confirmDeleteButton', { ITEM_COUNT: oauthCredentials.size() }, VizPortal.L10n.Interpolations.Count);\r\n            dialogConfig.isDeleteAction = true;\r\n            dialogConfig.action = function () { return _this.OAuthCredentials.del(oauthCredentials.keys()); };\r\n        };\r\n        DeleteOAuthCredentialsAction.prototype.notificationTranslationIds = function () {\r\n            return {\r\n                successId: 'deleteOAuthCredentialsSuccess',\r\n                errorId: 'deleteOAuthCredentialsError'\r\n            };\r\n        };\r\n        DeleteOAuthCredentialsAction.$inject = ['ConfirmActionDialog', 'ContentActionNotification', '$translate', '$filter', 'OAuthCredentials'];\r\n        return DeleteOAuthCredentialsAction;\r\n    })(VizPortal.AbstractContentAction);\r\n    VizPortal.DeleteOAuthCredentialsAction = DeleteOAuthCredentialsAction;\r\n    VizPortal.Module.instance().service('DeleteOAuthCredentialsAction', DeleteOAuthCredentialsAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../resources/ServerUsers.ts\" />\r\n/// <reference path=\"../ServerApi/types/IConnectedDevice.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DeleteConnectedDeviceAction = (function () {\r\n        function DeleteConnectedDeviceAction($translate, ConfirmActionDialog, ContentActionNotification, ServerUsers) {\r\n            this.$translate = $translate;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.ContentActionNotification = ContentActionNotification;\r\n            this.ServerUsers = ServerUsers;\r\n        }\r\n        DeleteConnectedDeviceAction.prototype.execute = function (device, userId, context) {\r\n            var _this = this;\r\n            return this.ConfirmActionDialog.open({\r\n                scope: context.scope.$new(),\r\n                title: this.$translate.instant('delete'),\r\n                bodyText: this.$translate.instant('confirmDeleteConnectedDevice', { NAME: VizPortal.L10n.elideIfLong(device.displayName) }),\r\n                position: VizPortal.ModalService.anchoredTo(context.targetElement),\r\n                actionName: this.$translate.instant('delete'),\r\n                action: function (dialogInstance) {\r\n                    return _this.ServerUsers.deleteUserConnectedDevices(userId, [device.id])\r\n                        .then(function (result) {\r\n                        if (result.errors && result.errors.length) {\r\n                            var errorMessage = _this.errorMessageFor(result.errors[0]);\r\n                            dialogInstance.showErrorMessage(errorMessage);\r\n                        }\r\n                        else {\r\n                            _this.ContentActionNotification.notifySuccess(_this.$translate.instant('deleteConnectedDeviceSuccess', { NAME: VizPortal.L10n.elideIfLong(device.displayName) }));\r\n                        }\r\n                        return result;\r\n                    });\r\n                }\r\n            }).result;\r\n        };\r\n        DeleteConnectedDeviceAction.prototype.errorMessageFor = function (error) {\r\n            return this.$translate.instant('errorUnknown');\r\n        };\r\n        DeleteConnectedDeviceAction.$inject = [\r\n            '$translate',\r\n            'ConfirmActionDialog',\r\n            'ContentActionNotification',\r\n            'ServerUsers'\r\n        ];\r\n        return DeleteConnectedDeviceAction;\r\n    })();\r\n    VizPortal.DeleteConnectedDeviceAction = DeleteConnectedDeviceAction;\r\n    VizPortal.Module.instance().service('DeleteConnectedDeviceAction', DeleteConnectedDeviceAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/ResultHelper.ts\" />\r\n/// <reference path=\"../helpers/SliceableHelper.ts\" />\r\n/// <reference path=\"../resources/OAuthCredentials.ts\" />\r\n/// <reference path=\"../ServerApi/types/ISiteUser.ts\" />\r\n/// <reference path=\"../ServerApi/types/IConnectedDevice.ts\" />\r\n/// <reference path=\"../services/AddOAuthCredentialAction.ts\" />\r\n/// <reference path=\"../services/BrowserTitleService.ts\" />\r\n/// <reference path=\"../services/DeleteRemoteRefreshAgentsAction.ts\" />\r\n/// <reference path=\"../services/DeleteMyCredentialsAction.ts\" />\r\n/// <reference path=\"../services/DeleteOAuthCredentialsAction.ts\" />\r\n/// <reference path=\"../services/DeleteConnectedDeviceAction.ts\" />\r\n/// <reference path=\"../services/UserSettingsCtrlCommon.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SiteUserSettingsSubplaceCtrl = (function () {\r\n        function SiteUserSettingsSubplaceCtrl($scope, $state, userSettingsCtrlCommon, isSessionUserSelf, userSettings, userRefreshTokenCount, serverUser, siteUser, serverService, oAuthCredentials, addOAuthCredentialAction, BrowserTitleService, deleteOAuthCredentialsAction, deleteMyCredentialsAction, remoteRefreshAgents, deleteRemoteRefreshAgentsAction, serverUsers, deleteConnectedDeviceAction) {\r\n            var _this = this;\r\n            this.serverService = serverService;\r\n            this.oAuthCredentials = oAuthCredentials;\r\n            // redirect to main.error if we don't have the user's settings.\r\n            if (VizPortal.ResultHelper.hasErrors(userSettings)) {\r\n                $state.go('main.error', {\r\n                    detailsLocKey: 'userCannotBeAccessed',\r\n                    redirectState: 'main.site.users',\r\n                    redirectLocKey: 'backToUsers'\r\n                });\r\n            }\r\n            BrowserTitleService.setTitle('settings', $scope.objectName);\r\n            userSettingsCtrlCommon.initScope($scope, isSessionUserSelf, serverUser, siteUser, userSettings, userRefreshTokenCount);\r\n            // TODO: Replace with a session variable check.  See the fix from http://fogbugz/default.asp?142850 for more details\r\n            $scope.canManageCredentials = true;\r\n            $scope.remoteRefreshAgents = [];\r\n            $scope.isSAMLUser = !!siteUser && siteUser.authSetting === VizPortal.ServerApi.SiteUserAuthSetting.Saml;\r\n            // Remote Refresh Agents aka \"Sync Clients\"\r\n            // Older UI, to be deleted after the new UX has been tested (TFS 419851)\r\n            $scope.remoteAgentManagerEnabled = VizPortal.FeatureFlags.dataSyncEnabled &&\r\n                !VizPortal.FeatureFlags.connectedClientsTableEnabled;\r\n            if ($scope.remoteAgentManagerEnabled) {\r\n                var refreshAgents = function () {\r\n                    remoteRefreshAgents.getWithContent().then(function (result) {\r\n                        if (result) {\r\n                            $scope.remoteRefreshAgents = VizPortal.RemoteRefreshAgentMapper.mapToResource(result.agents);\r\n                        }\r\n                    });\r\n                };\r\n                refreshAgents();\r\n                $scope.deleteRemoteRefreshAgent = function (agent, $event) {\r\n                    return deleteRemoteRefreshAgentsAction.execute(VizPortal.Set.fromIdItemArray([agent]), VizPortal.ActionContext.fromEvent($event))\r\n                        .then(refreshAgents);\r\n                };\r\n            }\r\n            // Connected devices\r\n            $scope.oneByOneConnectedDeviceManagement = VizPortal.FeatureFlags.connectedClientsTableEnabled;\r\n            if ($scope.oneByOneConnectedDeviceManagement) {\r\n                var refreshConnectedDevices = function () { return serverUsers.getUserConnectedDevices(serverUser.id)\r\n                    .then(function (devices) { return $scope.connectedDevices = devices; }); };\r\n                refreshConnectedDevices();\r\n                $scope.deleteConnectedDevice = function (device, $event) {\r\n                    return deleteConnectedDeviceAction.execute(device, serverUser.id, VizPortal.ActionContext.fromEvent($event))\r\n                        .then(refreshConnectedDevices);\r\n                };\r\n            }\r\n            // Credentials list\r\n            // TODO: Filter out invalid credentials, needs server support\r\n            $scope.credentialsLists = this.createOAuthCredentialLists();\r\n            var refreshCredentials = function () {\r\n                VizPortal.SliceableHelper.fetchAll(oAuthCredentials.all())\r\n                    .then(function (credentialsListResult) {\r\n                    $scope.credentialsLists = _this.createOAuthCredentialLists(credentialsListResult.items);\r\n                });\r\n            };\r\n            refreshCredentials();\r\n            // Initialize credential actions\r\n            $scope.deleteAllCredentials = function ($event) {\r\n                return deleteMyCredentialsAction.executeFromEvent($event).then(refreshCredentials);\r\n            };\r\n            $scope.addCredentialHref = function (type) { return addOAuthCredentialAction.href(type); };\r\n            $scope.addCredential = function (type) {\r\n                addOAuthCredentialAction.attemptAuth(type).then(refreshCredentials);\r\n            };\r\n            $scope.deleteCredential = function (oauthCredential, $event) {\r\n                return deleteOAuthCredentialsAction.executeFromEvent(VizPortal.Set.fromIdItemArray([oauthCredential.credential]), $event)\r\n                    .then(refreshCredentials);\r\n            };\r\n            $scope.testCredential = function (oauthCredential) { return _this.testCredential(oauthCredential); };\r\n            $scope.$on('$destroy', function () { return addOAuthCredentialAction.cancelPendingAuthAttempt(); });\r\n        }\r\n        SiteUserSettingsSubplaceCtrl.prototype.testCredential = function (oauthCredential) {\r\n            oauthCredential.test = { inProgress: true };\r\n            var handleTestResult = function (success) {\r\n                oauthCredential.test = {\r\n                    success: success\r\n                };\r\n            };\r\n            this.oAuthCredentials.test(oauthCredential.credential.id)\r\n                .then(handleTestResult, function () { return handleTestResult(false); });\r\n        };\r\n        SiteUserSettingsSubplaceCtrl.prototype.oauthEnabledForCredentialType = function (type) {\r\n            switch (type) {\r\n                case VizPortal.ServerApi.OAuthCredentialTypes.Salesforce:\r\n                    return this.serverService.oauthSalesforceEnabled();\r\n                case VizPortal.ServerApi.OAuthCredentialTypes.BigQuery:\r\n                case VizPortal.ServerApi.OAuthCredentialTypes.GoogleAnalytics:\r\n                    return this.serverService.oauthGoogleEnabled();\r\n            }\r\n        };\r\n        SiteUserSettingsSubplaceCtrl.prototype.createOAuthCredentialLists = function (credentials) {\r\n            var _this = this;\r\n            var convertToCredentialViewModel = function (credential) {\r\n                return { credential: credential, test: {} };\r\n            };\r\n            var credentialVMGroupsMap = _.groupBy(credentials, function (credential) { return credential.type; });\r\n            return _.compact(_.map(SiteUserSettingsSubplaceCtrl.OAuthListOrder, function (type) {\r\n                var oauthCredentialsList = {\r\n                    type: type,\r\n                    addEnabled: _this.oauthEnabledForCredentialType(type),\r\n                    credentials: _.map(credentialVMGroupsMap[type], convertToCredentialViewModel)\r\n                };\r\n                return (oauthCredentialsList.addEnabled || oauthCredentialsList.credentials.length > 0) ? oauthCredentialsList : null;\r\n            }));\r\n        };\r\n        SiteUserSettingsSubplaceCtrl.OAuthListOrder = [\r\n            VizPortal.ServerApi.OAuthCredentialTypes.Salesforce,\r\n            VizPortal.ServerApi.OAuthCredentialTypes.BigQuery,\r\n            VizPortal.ServerApi.OAuthCredentialTypes.GoogleAnalytics\r\n        ];\r\n        SiteUserSettingsSubplaceCtrl.$inject = [\r\n            '$scope',\r\n            '$state',\r\n            'UserSettingsCtrlCommon',\r\n            // resolved in state router\r\n            'isSessionUserSelf',\r\n            'userSettings',\r\n            'userRefreshTokenCount',\r\n            'serverUser',\r\n            'siteUser',\r\n            // Local Services\r\n            'ServerService',\r\n            'OAuthCredentials',\r\n            'AddOAuthCredentialAction',\r\n            'BrowserTitleService',\r\n            'DeleteOAuthCredentialsAction',\r\n            'DeleteMyCredentialsAction',\r\n            'RemoteRefreshAgents',\r\n            'DeleteRemoteRefreshAgentsAction',\r\n            'ServerUsers',\r\n            'DeleteConnectedDeviceAction'\r\n        ];\r\n        return SiteUserSettingsSubplaceCtrl;\r\n    })();\r\n    VizPortal.SiteUserSettingsSubplaceCtrl = SiteUserSettingsSubplaceCtrl;\r\n    VizPortal.Module.instance().controller('SiteUserSettingsSubplaceCtrl', SiteUserSettingsSubplaceCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/Order.ts\" />\r\n/// <reference path=\"../models/ContentFilters.ts\" />\r\n/// <reference path=\"../models/ContentTypes.ts\" />\r\n/// <reference path=\"../models/IPlace.ts\" />\r\n/// <reference path=\"../resources/Workbooks.ts\"  />\r\n/// <reference path=\"../ServerApi/types/IOrderClause.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DatasourcePlace = (function () {\r\n        function DatasourcePlace($location, Workbooks, ExtractTasks, RemoteRefreshSchedules) {\r\n            var _this = this;\r\n            this.$location = $location;\r\n            this.Workbooks = Workbooks;\r\n            this.ExtractTasks = ExtractTasks;\r\n            this.RemoteRefreshSchedules = RemoteRefreshSchedules;\r\n            this.urlParamsFn = function () { return _this.$location.search(); };\r\n        }\r\n        DatasourcePlace.prototype.create = function (datasourceId) {\r\n            var place = new VizPortal.Place();\r\n            place.addSubplace(VizPortal.Subplace.create('connectedWorkbooks', VizPortal.WorkbookContentType, this.Workbooks, this.urlParamsFn, { hasDatasource: datasourceId }, DatasourcePlace.ExcludeFilterKeys));\r\n            place.addSubplace(VizPortal.Subplace.create('extractTasks', VizPortal.ExtractTaskContentType, this.ExtractTasks, this.urlParamsFn, { datasource: datasourceId }, DatasourcePlace.ExcludeFilterKeys));\r\n            place.addSubplace(VizPortal.Subplace.create('remoteRefreshSchedules', VizPortal.RemoteRefreshScheduleContentType, this.RemoteRefreshSchedules, this.urlParamsFn, { datasource: datasourceId }, DatasourcePlace.ExcludeFilterKeys));\r\n            return place;\r\n        };\r\n        DatasourcePlace.ExcludeFilterKeys = [\r\n            VizPortal.ContentFiltersKeys.datasource,\r\n            VizPortal.ContentFiltersKeys.hasDatasource,\r\n        ];\r\n        DatasourcePlace.$inject = [\r\n            '$location',\r\n            'Workbooks',\r\n            'ExtractTasks',\r\n            'RemoteRefreshSchedules'\r\n        ];\r\n        return DatasourcePlace;\r\n    })();\r\n    VizPortal.DatasourcePlace = DatasourcePlace;\r\n    VizPortal.Module.instance().service('DatasourcePlace', DatasourcePlace);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var AddTagsToDatasourcesRequest = (function (_super) {\r\n            __extends(AddTagsToDatasourcesRequest, _super);\r\n            function AddTagsToDatasourcesRequest(ids, tags) {\r\n                _super.call(this, 'addTagsToDatasources', {\r\n                    ids: ids,\r\n                    tags: tags\r\n                });\r\n            }\r\n            return AddTagsToDatasourcesRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.AddTagsToDatasourcesRequest = AddTagsToDatasourcesRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var DeleteDatasourcesRequest = (function (_super) {\r\n            __extends(DeleteDatasourcesRequest, _super);\r\n            function DeleteDatasourcesRequest(ids) {\r\n                _super.call(this, 'deleteDatasources', { ids: ids });\r\n            }\r\n            return DeleteDatasourcesRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.DeleteDatasourcesRequest = DeleteDatasourcesRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"actionNames.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\n/// <reference path=\"../types/IDatasourceActions.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetDatasourceActionsRequest = (function (_super) {\r\n            __extends(GetDatasourceActionsRequest, _super);\r\n            function GetDatasourceActionsRequest(id) {\r\n                _super.call(this, 'getDatasourceActions', { id: id });\r\n            }\r\n            return GetDatasourceActionsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetDatasourceActionsRequest = GetDatasourceActionsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\"/>\r\n/// <reference path=\"../types/IMoveToProjectParams.ts\"/>\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var MoveDatasourcesToProjectRequest = (function (_super) {\r\n            __extends(MoveDatasourcesToProjectRequest, _super);\r\n            function MoveDatasourcesToProjectRequest(params) {\r\n                _super.call(this, 'moveDatasourcesToProject', params);\r\n            }\r\n            return MoveDatasourcesToProjectRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.MoveDatasourcesToProjectRequest = MoveDatasourcesToProjectRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var RemoveTagsFromDatasourcesRequest = (function (_super) {\r\n            __extends(RemoveTagsFromDatasourcesRequest, _super);\r\n            function RemoveTagsFromDatasourcesRequest(ids, tags) {\r\n                // The server returns quoted tags unquoted.  This re-adds the double quotes if needed\r\n                var tagsList = _.map(tags, function (tag) { return VizPortal.TagsHelper.quote(tag); });\r\n                _super.call(this, 'removeTagsFromDatasources', {\r\n                    ids: ids,\r\n                    tags: tagsList\r\n                });\r\n            }\r\n            return RemoveTagsFromDatasourcesRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.RemoveTagsFromDatasourcesRequest = RemoveTagsFromDatasourcesRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var RunExtractRefreshesOnDatasourcesRequest = (function (_super) {\r\n            __extends(RunExtractRefreshesOnDatasourcesRequest, _super);\r\n            // type must be from ServerApi.ExtractTaskType\r\n            function RunExtractRefreshesOnDatasourcesRequest(ids, type) {\r\n                _super.call(this, 'runExtractRefreshesOnDatasources', {\r\n                    ids: ids,\r\n                    type: type\r\n                });\r\n            }\r\n            return RunExtractRefreshesOnDatasourcesRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.RunExtractRefreshesOnDatasourcesRequest = RunExtractRefreshesOnDatasourcesRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\n/// <reference path=\"../types/IResponse.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var SetDatasourceDescriptionRequest = (function (_super) {\r\n            __extends(SetDatasourceDescriptionRequest, _super);\r\n            function SetDatasourceDescriptionRequest(id, description) {\r\n                _super.call(this, 'setDatasourceDescription', {\r\n                    id: id,\r\n                    description: description\r\n                });\r\n            }\r\n            return SetDatasourceDescriptionRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.SetDatasourceDescriptionRequest = SetDatasourceDescriptionRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/IResponse.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var SetDatasourceRefreshModeRequest = (function (_super) {\r\n            __extends(SetDatasourceRefreshModeRequest, _super);\r\n            function SetDatasourceRefreshModeRequest(params) {\r\n                _super.call(this, 'setDatasourceRefreshMode', params);\r\n            }\r\n            return SetDatasourceRefreshModeRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.SetDatasourceRefreshModeRequest = SetDatasourceRefreshModeRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/IResponse.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var SetDatasourceRemoteAgentRequest = (function (_super) {\r\n            __extends(SetDatasourceRemoteAgentRequest, _super);\r\n            function SetDatasourceRemoteAgentRequest(params) {\r\n                _super.call(this, 'setDatasourceRemoteAgent', params);\r\n            }\r\n            return SetDatasourceRemoteAgentRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.SetDatasourceRemoteAgentRequest = SetDatasourceRemoteAgentRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var SetDatasourcesOwnerRequest = (function (_super) {\r\n            __extends(SetDatasourcesOwnerRequest, _super);\r\n            function SetDatasourcesOwnerRequest(ids, ownerId) {\r\n                _super.call(this, 'setDatasourcesOwner', {\r\n                    ids: ids,\r\n                    ownerId: ownerId\r\n                });\r\n            }\r\n            return SetDatasourcesOwnerRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.SetDatasourcesOwnerRequest = SetDatasourcesOwnerRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/RequestHelper.ts\" />\r\n/// <reference path=\"../helpers/ResourceHelper.ts\" />\r\n/// <reference path=\"../helpers/ResultHelper.ts\" />\r\n/// <reference path=\"../helpers/ServerModelHelper.ts\" />\r\n/// <reference path=\"../models/IDataSourceInfo.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/AddTagsToDatasourcesRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/DeleteDatasourcesRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetDatasourceActionsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetDatasourcesRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/MoveDatasourcesToProjectRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/RemoveTagsFromDatasourcesRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/RunExtractRefreshesOnDatasourcesRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/SetDatasourceDescriptionRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/SetDatasourceRefreshModeRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/SetDatasourceRemoteAgentRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/SetDatasourcesOwnerRequest.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DataSources = (function () {\r\n        function DataSources($q, ErrorNotifyingServer, FetcherFactory) {\r\n            this.$q = $q;\r\n            this.ErrorNotifyingServer = ErrorNotifyingServer;\r\n            this.FetcherFactory = FetcherFactory;\r\n            this.server = ErrorNotifyingServer.getServerService();\r\n            this.listFetcher = FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetDatasourcesRequest, VizPortal.ServerApiMapper.dataSources);\r\n            this.allQuery = new VizPortal.ResourceQuery(this.listFetcher);\r\n            this.detailFetcher = this.FetcherFactory.getServerDetailFetcher('getDatasource', VizPortal.DatasourceMapper.mapDetail);\r\n            this.fieldValuesFetcher = FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetFieldValuesRequest, VizPortal.ServerApiMapper.fieldValues);\r\n        }\r\n        DataSources.isPublished = function (datasource) {\r\n            return !datasource.workbook;\r\n        };\r\n        DataSources.isEmbedded = function (datasource) {\r\n            return !DataSources.isPublished(datasource);\r\n        };\r\n        DataSources.prototype.all = function () {\r\n            return this.allQuery;\r\n        };\r\n        DataSources.prototype.published = function () {\r\n            return this.all().addFilter(VizPortal.Filter.fieldEq(VizPortal.ServerApi.FilterFieldNames.isPublished, true));\r\n        };\r\n        DataSources.prototype.getById = function (id) {\r\n            return this.detailFetcher.fetchById(id);\r\n        };\r\n        DataSources.prototype.valuesForField = function (field) {\r\n            return new VizPortal.FieldValuesQuery(this.fieldValuesFetcher, field, VizPortal.ServerApi.FieldValueResourceType.datasource);\r\n        };\r\n        // Actions\r\n        DataSources.prototype.actions = function (id) {\r\n            return this.server.sendRequest(new VizPortal.ServerApi.GetDatasourceActionsRequest(id));\r\n        };\r\n        DataSources.prototype.del = function (ids) {\r\n            return this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests(ids, function (idsBlock) { return new VizPortal.ServerApi.DeleteDatasourcesRequest(idsBlock); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        DataSources.prototype.setDescription = function (id, description) {\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.SetDatasourceDescriptionRequest(id, description));\r\n        };\r\n        DataSources.prototype.setOwner = function (ids, ownerId) {\r\n            return this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests(ids, function (idsBlock) { return new VizPortal.ServerApi.SetDatasourcesOwnerRequest(idsBlock, ownerId); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        DataSources.prototype.setRefreshMode = function (id, refreshMode) {\r\n            var params = {\r\n                id: id,\r\n                refreshMode: refreshMode\r\n            };\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.SetDatasourceRefreshModeRequest(params));\r\n        };\r\n        DataSources.prototype.setRemoteAgent = function (id, remoteAgentName) {\r\n            var params = {\r\n                id: id,\r\n                remoteAgentName: remoteAgentName\r\n            };\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.SetDatasourceRemoteAgentRequest(params));\r\n        };\r\n        DataSources.prototype.moveToProject = function (targetProjectId, datasourceIds) {\r\n            return this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests(datasourceIds, function (idsBlock) { return new VizPortal.ServerApi.MoveDatasourcesToProjectRequest({\r\n                ids: idsBlock,\r\n                projectId: targetProjectId\r\n            }); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        DataSources.prototype.addTags = function (ids, tags) {\r\n            return (tags.length > 0)\r\n                ? this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests2(ids, tags, function (idsBlock, tagsBlock) { return new VizPortal.ServerApi.AddTagsToDatasourcesRequest(idsBlock, tagsBlock); }), VizPortal.ResultHelper.combineResults)\r\n                : this.$q.when({});\r\n        };\r\n        DataSources.prototype.removeTags = function (ids, tags) {\r\n            return (tags.length > 0)\r\n                ? this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests2(ids, tags, function (idsBlock, tagsBlock) { return new VizPortal.ServerApi.RemoveTagsFromDatasourcesRequest(idsBlock, tagsBlock); }), VizPortal.ResultHelper.combineResults)\r\n                : this.$q.when({});\r\n        };\r\n        DataSources.prototype.changeTags = function (ids, tagsToAdd, tagsToRemove) {\r\n            var _this = this;\r\n            return this.removeTags(ids, tagsToRemove)\r\n                .then(function (result) { return (VizPortal.ResultHelper.hasErrors(result) ? result : _this.addTags(ids, tagsToAdd)); });\r\n        };\r\n        DataSources.prototype.createExtractTask = function (ids, scheduleId, extractType) {\r\n            return this.ErrorNotifyingServer.sendRequests(VizPortal.RequestHelper.buildRequests(ids, function (idsBlock) { return new VizPortal.ServerApi.CreateExtractTasksRequest({\r\n                targetType: VizPortal.ServerApi.ExtractTaskTargetType.Datasource,\r\n                targetIds: idsBlock,\r\n                scheduleId: scheduleId,\r\n                type: extractType // ServerApi.ExtractTaskType\r\n            }); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        DataSources.prototype.refreshExtracts = function (ids, extractType) {\r\n            return this.ErrorNotifyingServer.sendRequests(VizPortal.RequestHelper.buildRequests(ids, function (idsBlock) {\r\n                return new VizPortal.ServerApi.RunExtractRefreshesOnDatasourcesRequest(idsBlock, extractType);\r\n            }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        DataSources.$inject = [\r\n            '$q',\r\n            'ErrorNotifyingServer',\r\n            'FetcherFactory'\r\n        ];\r\n        return DataSources;\r\n    })();\r\n    VizPortal.DataSources = DataSources;\r\n    VizPortal.Module.instance().service('DataSources', DataSources);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/Order.ts\" />\r\n/// <reference path=\"../models/ContentFilters.ts\" />\r\n/// <reference path=\"../models/ContentTypes.ts\" />\r\n/// <reference path=\"../models/IPlace.ts\" />\r\n/// <reference path=\"../resources/Datasources.ts\" />\r\n/// <reference path=\"../resources/Views.ts\" />\r\n/// <reference path=\"../resources/Workbooks.ts\" />\r\n/// <reference path=\"../ServerApi/types/IOrderClause.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ProjectPlace = (function () {\r\n        function ProjectPlace($location, DataSources, Views, Workbooks) {\r\n            var _this = this;\r\n            this.$location = $location;\r\n            this.DataSources = DataSources;\r\n            this.Views = Views;\r\n            this.Workbooks = Workbooks;\r\n            this.urlParamsFn = function () { return _this.$location.search(); };\r\n        }\r\n        ProjectPlace.prototype.create = function (projectId) {\r\n            var place = new VizPortal.Place();\r\n            place.addSubplace(VizPortal.Subplace.create('workbooks', VizPortal.WorkbookContentType, this.Workbooks, this.urlParamsFn, { project: projectId }, ProjectPlace.ExcludeFilterKeys));\r\n            place.addSubplace(VizPortal.Subplace.create('views', VizPortal.ViewContentType, this.Views, this.urlParamsFn, { project: projectId }, ProjectPlace.ExcludeFilterKeys));\r\n            place.addSubplace(VizPortal.Subplace.create('datasources', VizPortal.DatasourceContentType, this.DataSources, this.urlParamsFn, { project: projectId, showEmbedded: 'false' }, ProjectPlace.ExcludeFilterKeys));\r\n            return place;\r\n        };\r\n        ProjectPlace.ExcludeFilterKeys = [\r\n            VizPortal.ContentFiltersKeys.project\r\n        ];\r\n        ProjectPlace.$inject = [\r\n            '$location',\r\n            'DataSources',\r\n            'Views',\r\n            'Workbooks'\r\n        ];\r\n        return ProjectPlace;\r\n    })();\r\n    VizPortal.ProjectPlace = ProjectPlace;\r\n    VizPortal.Module.instance().service('ProjectPlace', ProjectPlace);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/Order.ts\" />\r\n/// <reference path=\"../models/ContentFilters.ts\" />\r\n/// <reference path=\"../models/ContentTypes.ts\" />\r\n/// <reference path=\"../models/IPlace.ts\" />\r\n/// <reference path=\"../resources/Datasources.ts\" />\r\n/// <reference path=\"../resources/Views.ts\" />\r\n/// <reference path=\"../resources/Workbooks.ts\" />\r\n/// <reference path=\"../ServerApi/types/IOrderClause.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SiteUserPlace = (function () {\r\n        function SiteUserPlace($location, $q, DataSources, Views, Workbooks, Subscriptions) {\r\n            var _this = this;\r\n            this.$location = $location;\r\n            this.$q = $q;\r\n            this.DataSources = DataSources;\r\n            this.Views = Views;\r\n            this.Workbooks = Workbooks;\r\n            this.Subscriptions = Subscriptions;\r\n            this.urlParamsFn = function () { return _this.$location.search(); };\r\n        }\r\n        SiteUserPlace.prototype.create = function (ownerId) {\r\n            var place = new VizPortal.Place();\r\n            place.addSubplace(VizPortal.Subplace.create('workbooks', VizPortal.WorkbookContentType, this.Workbooks, this.urlParamsFn, { owner: ownerId }, SiteUserPlace.ExcludeFilterKeys));\r\n            place.addSubplace(VizPortal.Subplace.create('views', VizPortal.ViewContentType, this.Views, this.urlParamsFn, { owner: ownerId }, SiteUserPlace.ExcludeFilterKeys));\r\n            place.addSubplace(VizPortal.Subplace.create('datasources', VizPortal.DatasourceContentType, this.DataSources, this.urlParamsFn, { owner: ownerId, showEmbedded: \"false\" }, SiteUserPlace.ExcludeFilterKeys));\r\n            place.addSubplace(VizPortal.Subplace.create('subscriptions', VizPortal.SubscriptionContentType, this.Subscriptions, this.urlParamsFn, { owner: ownerId }, SiteUserPlace.ExcludeFilterKeys));\r\n            return place;\r\n        };\r\n        SiteUserPlace.prototype.empty = function () {\r\n            var place = new VizPortal.Place();\r\n            // Filters are omitted because it would be extra work to make them work\r\n            // and they serve no purpose because the subplaces are always empty.\r\n            place.addSubplace(VizPortal.Subplace.empty('workbooks', _.omit(VizPortal.WorkbookContentType, 'filterKeys'), this.$q));\r\n            place.addSubplace(VizPortal.Subplace.empty('views', _.omit(VizPortal.ViewContentType, 'filterKeys'), this.$q));\r\n            place.addSubplace(VizPortal.Subplace.empty('datasources', _.omit(VizPortal.DatasourceContentType, 'filterKeys'), this.$q));\r\n            place.addSubplace(VizPortal.Subplace.empty('subscriptions', _.omit(VizPortal.SubscriptionContentType, 'filterKeys'), this.$q));\r\n            return place;\r\n        };\r\n        SiteUserPlace.ExcludeFilterKeys = [\r\n            VizPortal.ContentFiltersKeys.owner\r\n        ];\r\n        SiteUserPlace.$inject = [\r\n            '$location',\r\n            '$q',\r\n            'DataSources',\r\n            'Views',\r\n            'Workbooks',\r\n            'Subscriptions'\r\n        ];\r\n        return SiteUserPlace;\r\n    })();\r\n    VizPortal.SiteUserPlace = SiteUserPlace;\r\n    VizPortal.Module.instance().service('SiteUserPlace', SiteUserPlace);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var CreateProjectRequest = (function (_super) {\r\n            __extends(CreateProjectRequest, _super);\r\n            function CreateProjectRequest(params) {\r\n                _super.call(this, 'createProject', params);\r\n            }\r\n            return CreateProjectRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.CreateProjectRequest = CreateProjectRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var DeleteProjectsRequest = (function (_super) {\r\n            __extends(DeleteProjectsRequest, _super);\r\n            function DeleteProjectsRequest(ids) {\r\n                _super.call(this, 'deleteProjects', { ids: ids });\r\n            }\r\n            return DeleteProjectsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.DeleteProjectsRequest = DeleteProjectsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"actionNames.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\n/// <reference path=\"../types/IProjectActions.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetProjectActionsRequest = (function (_super) {\r\n            __extends(GetProjectActionsRequest, _super);\r\n            function GetProjectActionsRequest(id) {\r\n                _super.call(this, 'getProjectActions', { id: id });\r\n            }\r\n            return GetProjectActionsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetProjectActionsRequest = GetProjectActionsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\n/// <reference path=\"../types/IResponse.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var SetProjectNameRequest = (function (_super) {\r\n            __extends(SetProjectNameRequest, _super);\r\n            function SetProjectNameRequest(id, name) {\r\n                _super.call(this, 'setProjectName', {\r\n                    id: id,\r\n                    name: name\r\n                });\r\n            }\r\n            return SetProjectNameRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.SetProjectNameRequest = SetProjectNameRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\n/// <reference path=\"../types/IResponse.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var SetProjectControlledPermissionsRequest = (function (_super) {\r\n            __extends(SetProjectControlledPermissionsRequest, _super);\r\n            function SetProjectControlledPermissionsRequest(ids) {\r\n                _super.call(this, 'setProjectControlledPermissions', {\r\n                    ids: ids\r\n                });\r\n            }\r\n            return SetProjectControlledPermissionsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.SetProjectControlledPermissionsRequest = SetProjectControlledPermissionsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\n/// <reference path=\"../../models/ILongRunningAction.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var SetContentControlledPermissionsRequest = (function (_super) {\r\n            __extends(SetContentControlledPermissionsRequest, _super);\r\n            function SetContentControlledPermissionsRequest(ids) {\r\n                _super.call(this, 'setContentControlledPermissions', {\r\n                    ids: ids\r\n                });\r\n            }\r\n            return SetContentControlledPermissionsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.SetContentControlledPermissionsRequest = SetContentControlledPermissionsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\n/// <reference path=\"../types/IResponse.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var SetProjectDescriptionRequest = (function (_super) {\r\n            __extends(SetProjectDescriptionRequest, _super);\r\n            function SetProjectDescriptionRequest(id, description) {\r\n                _super.call(this, 'setProjectDescription', {\r\n                    id: id,\r\n                    description: description\r\n                });\r\n            }\r\n            return SetProjectDescriptionRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.SetProjectDescriptionRequest = SetProjectDescriptionRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/actionParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var SetProjectsOwnerRequest = (function (_super) {\r\n            __extends(SetProjectsOwnerRequest, _super);\r\n            function SetProjectsOwnerRequest(ids, ownerId) {\r\n                _super.call(this, 'setProjectsOwner', {\r\n                    ids: ids,\r\n                    ownerId: ownerId\r\n                });\r\n            }\r\n            return SetProjectsOwnerRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.SetProjectsOwnerRequest = SetProjectsOwnerRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/RequestHelper.ts\" />\r\n/// <reference path=\"../helpers/ResourceHelper.ts\" />\r\n/// <reference path=\"../helpers/ResultHelper.ts\" />\r\n/// <reference path=\"../helpers/ServerModelHelper.ts\" />\r\n/// <reference path=\"../models/IProjectInfo.ts\" />\r\n/// <reference path=\"../models/ILongRunningAction.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/CreateProjectRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/DeleteProjectsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetProjectsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetProjectActionsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/SetProjectNameRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/SetProjectControlledPermissionsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/SetContentControlledPermissionsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/SetProjectDescriptionRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/SetProjectsOwnerRequest.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\n/// <reference path=\"../services/ErrorNotifyingServer.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var Projects = (function () {\r\n        function Projects($q, ErrorNotifyingServer, FetcherFactory) {\r\n            this.$q = $q;\r\n            this.ErrorNotifyingServer = ErrorNotifyingServer;\r\n            this.server = ErrorNotifyingServer.getServerService();\r\n            this.listFetcher = FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetProjectsRequest, VizPortal.ServerApiMapper.projects);\r\n            this.allQuery = new VizPortal.ResourceQuery(this.listFetcher);\r\n            this.detailFetcher = FetcherFactory.getServerDetailFetcher('getProject', VizPortal.ProjectMapper.mapDetail);\r\n            this.fieldValuesFetcher = FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetFieldValuesRequest, VizPortal.ServerApiMapper.fieldValues);\r\n        }\r\n        Projects.prototype.all = function () {\r\n            return this.allQuery;\r\n        };\r\n        Projects.prototype.getById = function (id) {\r\n            return this.detailFetcher.fetchById(id);\r\n        };\r\n        Projects.prototype.valuesForField = function (field) {\r\n            return new VizPortal.FieldValuesQuery(this.fieldValuesFetcher, field, VizPortal.ServerApi.FieldValueResourceType.project);\r\n        };\r\n        // Actions\r\n        Projects.prototype.actions = function (id) {\r\n            return this.server.sendRequest(new VizPortal.ServerApi.GetProjectActionsRequest(id));\r\n        };\r\n        Projects.prototype.del = function (ids) {\r\n            return this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests(ids, function (idsBlock) { return new VizPortal.ServerApi.DeleteProjectsRequest(idsBlock); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        Projects.prototype.rename = function (id, name) {\r\n            return this.ErrorNotifyingServer.sendRequestAndDelay(new VizPortal.ServerApi.SetProjectNameRequest(id, name));\r\n        };\r\n        Projects.prototype.setDescription = function (id, description) {\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.SetProjectDescriptionRequest(id, description));\r\n        };\r\n        Projects.prototype.setProjectControlledPermissions = function (ids) {\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.SetProjectControlledPermissionsRequest(ids));\r\n        };\r\n        Projects.prototype.setContentControlledPermissions = function (ids) {\r\n            return this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.SetContentControlledPermissionsRequest(ids));\r\n        };\r\n        Projects.prototype.setOwner = function (ids, ownerId) {\r\n            return this.ErrorNotifyingServer.sendRequestsAndDelay(VizPortal.RequestHelper.buildRequests(ids, function (idsBlock) { return new VizPortal.ServerApi.SetProjectsOwnerRequest(idsBlock, ownerId); }), VizPortal.ResultHelper.combineResults);\r\n        };\r\n        Projects.prototype.create = function (name, description) {\r\n            // Sanitize description\r\n            if (_.isString(description)) {\r\n                description = description.trim();\r\n                if (description.length === 0) {\r\n                    description = undefined;\r\n                }\r\n            }\r\n            else {\r\n                description = undefined;\r\n            }\r\n            return this.ErrorNotifyingServer.sendRequestAndDelay(new VizPortal.ServerApi.CreateProjectRequest({\r\n                name: name,\r\n                description: description\r\n            }));\r\n        };\r\n        Projects.$inject = [\r\n            '$q',\r\n            'ErrorNotifyingServer',\r\n            'FetcherFactory'\r\n        ];\r\n        return Projects;\r\n    })();\r\n    VizPortal.Projects = Projects;\r\n    VizPortal.Module.instance().service('Projects', Projects);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/Order.ts\" />\r\n/// <reference path=\"../models/ContentTypes.ts\" />\r\n/// <reference path=\"../models/IPlace.ts\" />\r\n/// <reference path=\"../resources/Datasources.ts\" />\r\n/// <reference path=\"../resources/Projects.ts\" />\r\n/// <reference path=\"../resources/Views.ts\" />\r\n/// <reference path=\"../resources/Workbooks.ts\" />\r\n/// <reference path=\"../ServerApi/types/IOrderClause.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SitePlace = (function () {\r\n        function SitePlace($location, DataSources, Projects, Views, Workbooks) {\r\n            var _this = this;\r\n            this.$location = $location;\r\n            this.DataSources = DataSources;\r\n            this.Projects = Projects;\r\n            this.Views = Views;\r\n            this.Workbooks = Workbooks;\r\n            this.urlParamsFn = function () { return _this.$location.search(); };\r\n        }\r\n        SitePlace.prototype.create = function () {\r\n            var place = new VizPortal.Place();\r\n            place.addSubplace(VizPortal.Subplace.create('projects', VizPortal.ProjectContentType, this.Projects, this.urlParamsFn));\r\n            place.addSubplace(VizPortal.Subplace.create('workbooks', VizPortal.WorkbookContentType, this.Workbooks, this.urlParamsFn));\r\n            place.addSubplace(VizPortal.Subplace.create('views', VizPortal.ViewContentType, this.Views, this.urlParamsFn));\r\n            place.addSubplace(VizPortal.Subplace.create('datasources', VizPortal.DatasourceContentType, this.DataSources, this.urlParamsFn, { showEmbedded: 'false' }));\r\n            return place;\r\n        };\r\n        SitePlace.$inject = [\r\n            '$location',\r\n            'DataSources',\r\n            'Projects',\r\n            'Views',\r\n            'Workbooks'\r\n        ];\r\n        return SitePlace;\r\n    })();\r\n    VizPortal.SitePlace = SitePlace;\r\n    VizPortal.Module.instance().service('SitePlace', SitePlace);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/Order.ts\" />\r\n/// <reference path=\"../models/ContentFilters.ts\" />\r\n/// <reference path=\"../models/ContentTypes.ts\" />\r\n/// <reference path=\"../models/IPlace.ts\" />\r\n/// <reference path=\"../resources/Views.ts\" />\r\n/// <reference path=\"../ServerApi/types/IOrderClause.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var WorkbookPlace = (function () {\r\n        function WorkbookPlace($location, DataSources, Views, Subscriptions, ExtractTasks) {\r\n            var _this = this;\r\n            this.$location = $location;\r\n            this.DataSources = DataSources;\r\n            this.Views = Views;\r\n            this.Subscriptions = Subscriptions;\r\n            this.ExtractTasks = ExtractTasks;\r\n            this.urlParamsFn = function () { return _this.$location.search(); };\r\n        }\r\n        WorkbookPlace.prototype.create = function (workbookId) {\r\n            var place = new VizPortal.Place();\r\n            place.addSubplace(VizPortal.Subplace.create('views', VizPortal.ViewInWorkbookContentType, this.Views, this.urlParamsFn, { workbook: workbookId }, WorkbookPlace.ExcludeFilterKeys));\r\n            place.addSubplace(VizPortal.Subplace.create('datasources', VizPortal.DatasourceContentType, this.DataSources, this.urlParamsFn, { workbook: workbookId }, WorkbookPlace.DataSourceExcludeFilterKeys));\r\n            place.addSubplace(VizPortal.Subplace.create('subscriptions', VizPortal.SubscriptionContentType, this.Subscriptions, this.urlParamsFn, { workbook: workbookId }, WorkbookPlace.ExcludeFilterKeys));\r\n            place.addSubplace(VizPortal.Subplace.create('extractTasks', VizPortal.ExtractTaskContentType, this.ExtractTasks, this.urlParamsFn, { workbook: workbookId }, WorkbookPlace.ExcludeFilterKeys));\r\n            return place;\r\n        };\r\n        WorkbookPlace.ExcludeFilterKeys = [\r\n            VizPortal.ContentFiltersKeys.workbook,\r\n            VizPortal.ContentFiltersKeys.project,\r\n            VizPortal.ContentFiltersKeys.owner,\r\n            VizPortal.ContentFiltersKeys.modifiedAfter,\r\n            VizPortal.ContentFiltersKeys.modifiedBefore\r\n        ];\r\n        WorkbookPlace.DataSourceExcludeFilterKeys = WorkbookPlace.ExcludeFilterKeys.concat([\r\n            VizPortal.ContentFiltersKeys.hasAlert,\r\n            VizPortal.ContentFiltersKeys.tag,\r\n            VizPortal.ContentFiltersKeys.showEmbedded\r\n        ]);\r\n        WorkbookPlace.$inject = [\r\n            '$location',\r\n            'DataSources',\r\n            'Views',\r\n            'Subscriptions',\r\n            'ExtractTasks'\r\n        ];\r\n        return WorkbookPlace;\r\n    })();\r\n    VizPortal.WorkbookPlace = WorkbookPlace;\r\n    VizPortal.Module.instance().service('WorkbookPlace', WorkbookPlace);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ContentUrl = (function () {\r\n        function ContentUrl($state) {\r\n            this.$state = $state;\r\n            this.itemDetailsStateNames = {};\r\n            this.itemDetailsStateNames[VizPortal.ProjectContentType.name] = 'main.site.content.project';\r\n            this.itemDetailsStateNames[VizPortal.DatasourceContentType.name] = 'main.site.content.datasource.connectedWorkbooks';\r\n            this.itemDetailsStateNames[VizPortal.WorkbookContentType.name] = 'main.site.content.workbook.views';\r\n            this.itemSubplaceStateNames = {};\r\n            this.itemSubplaceStateNames[VizPortal.ViewContentType.name] = '.views';\r\n            this.itemSubplaceStateNames[VizPortal.WorkbookContentType.name] = '.workbooks';\r\n            this.itemSubplaceStateNames[VizPortal.DatasourceContentType.name] = '.datasources';\r\n            this.itemSubplaceStateNames['details'] = '.details';\r\n        }\r\n        ContentUrl.prototype.forItem = function (item, itemType, subplaceName) {\r\n            if (itemType.name === VizPortal.ViewContentType.name) {\r\n                return this.$state.href('main.site.viz', { path: item.path });\r\n            }\r\n            var stateName = this.itemDetailsStateNames[itemType.name];\r\n            var subplaceStateName = this.itemSubplaceStateNames[subplaceName];\r\n            if (stateName) {\r\n                if (subplaceStateName) {\r\n                    stateName += subplaceStateName;\r\n                }\r\n                return this.$state.href(stateName, { id: item.id });\r\n            }\r\n            throw \"No URL for item type '\" + itemType.name + \"'\";\r\n        };\r\n        ContentUrl.$inject = ['$state'];\r\n        return ContentUrl;\r\n    })();\r\n    VizPortal.ContentUrl = ContentUrl;\r\n    VizPortal.Module.instance().service('ContentUrl', ContentUrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"libs.ts\" />\r\n/// <reference path=\"controllers/ContentPlaceCtrl.ts\" />\r\n/// <reference path=\"controllers/ContentSubplaceCtrl.ts\" />\r\n/// <reference path=\"controllers/DatasourceDataConnectionCtrl.ts\" />\r\n/// <reference path=\"controllers/ErrorCtrl.ts\" />\r\n/// <reference path=\"controllers/ExtractTasksCtrl.ts\" />\r\n/// <reference path=\"controllers/RemoteRefreshSchedulesCtrl.ts\" />\r\n/// <reference path=\"controllers/SetBrowserTitleCtrl.ts\" />\r\n/// <reference path=\"controllers/SiteUserPlaceCtrl.ts\" />\r\n/// <reference path=\"controllers/SiteUserSettingsSubplaceCtrl.ts\" />\r\n/// <reference path=\"controllers/SubscriptionsCtrl.ts\" />\r\n/// <reference path=\"helpers/ActionContext.ts\" />\r\n/// <reference path=\"helpers/ConfigHelper.ts\" />\r\n/// <reference path=\"Module.ts\" />\r\n/// <reference path=\"models/Content.ts\" />\r\n/// <reference path=\"models/DatasourcePlace.ts\" />\r\n/// <reference path=\"models/IDataSourceInfo.ts\" />\r\n/// <reference path=\"models/IProjectInfo.ts\" />\r\n/// <reference path=\"models/IWorkbookInfo.ts\" />\r\n/// <reference path=\"models/ProjectPlace.ts\" />\r\n/// <reference path=\"models/SiteUserPlace.ts\" />\r\n/// <reference path=\"models/SitePlace.ts\" />\r\n/// <reference path=\"models/WorkbookPlace.ts\" />\r\n/// <reference path=\"resources/Datasources.ts\" />\r\n/// <reference path=\"resources/Projects.ts\" />\r\n/// <reference path=\"resources/Query.ts\" />\r\n/// <reference path=\"resources/ServerUsers.ts\" />\r\n/// <reference path=\"resources/SiteUsers.ts\" />\r\n/// <reference path=\"resources/Users.ts\" />\r\n/// <reference path=\"resources/Workbooks.ts\" />\r\n/// <reference path=\"ServerApi/types/resourceParts.ts\" />\r\n/// <reference path=\"ServerApi/types/IView.ts\" />\r\n/// <reference path=\"services/ContentUrl.ts\" />\r\n/// <reference path=\"services/CreateExtractTasksAction.ts\" />\r\n/// <reference path=\"services/SiteUrlMatcherFactory.ts\" />\r\n/// <reference path=\"stores/UserSettingsStore.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().config([\r\n        '$stateProvider',\r\n        '$urlRouterProvider',\r\n        'SiteUrlMatcherFactoryProvider',\r\n        function ($stateProvider, $urlRouterProvider, siteUrlMatcherFactory) {\r\n            var siteUrl = function (url) { return siteUrlMatcherFactory.compile(url); };\r\n            // Create a redirect handler for a site url. See $urlRouterProvider documentation for details\r\n            var siteUrlRedirect = function (url) { return ['$match', function ($match) { return siteUrl(url).format($match); }]; };\r\n            var rootSiteUrlRedirect = ['$match', 'StartPageService', '$location',\r\n                function ($match, startPageService, $location) {\r\n                    var noSiteInUrl = !$match.siteUrlName;\r\n                    var params = $.param($location.search());\r\n                    var startPage = (noSiteInUrl)\r\n                        ? startPageService.getCurrentUserStartPageForCurrentSite()\r\n                        : startPageService.getCurrentUserStartPageForSite($match.siteUrlName);\r\n                    return startPage + (params ? (/\\?/.test(startPage) ? '&' : '?') + params : '');\r\n                }\r\n            ];\r\n            // Redirects for default related content types\r\n            // TODO: perhaps add these as part of state creation helper methods\r\n            $urlRouterProvider\r\n                .when(siteUrl(''), rootSiteUrlRedirect)\r\n                .when(siteUrl('/'), rootSiteUrlRedirect)\r\n                .when(siteUrl('/{type}/'), siteUrlRedirect('/{type}'))\r\n                .when(siteUrl('/{type}/{id}/'), siteUrlRedirect('/{type}/{id}'))\r\n                .when(siteUrl('/projects/{id}'), siteUrlRedirect('/projects/{id}/workbooks'))\r\n                .when(siteUrl('/workbooks/{id}'), siteUrlRedirect('/workbooks/{id}/views'))\r\n                .when(siteUrl('/datasources/{id}'), siteUrlRedirect('/datasources/{id}/connectedWorkbooks'));\r\n            // The url /redirect_to_view is currently required by the React favorites menu.\r\n            // TODO: perhaps expose the view's path on the IFavorite data structure to avoid this redirect.\r\n            if (VizPortal.FeatureFlags.reactFavoritesMenu || VizPortal.FeatureFlags.reactTopBar) {\r\n                $urlRouterProvider\r\n                    .when(siteUrl('/redirect_to_view/{id}'), ['$match', '$state', 'Views', function ($match, $state, views) {\r\n                        views.getById($match.id).then(function (viewInfo) {\r\n                            $state.transitionTo('main.site.viz', { path: viewInfo.path }, { location: \"replace\" });\r\n                        });\r\n                        return true;\r\n                    }]);\r\n            }\r\n            var ResourceNames = {\r\n                'project': 'Projects',\r\n                'datasource': 'DataSources',\r\n                'workbook': 'Workbooks',\r\n                'view': 'Views'\r\n            };\r\n            function subplaceState(name, contentType, customResolve, templateUrl) {\r\n                if (templateUrl === void 0) { templateUrl = 'contentSubplace.html'; }\r\n                var resolve = {\r\n                    subplace: ['place', function (place) { return place.subplace(name); }],\r\n                    resource: ResourceNames[contentType.name],\r\n                    detailsUrl: ['ContentUrl', function (ContentUrl) {\r\n                            return function (item, subplaceName) { return ContentUrl.forItem(item, contentType, subplaceName); };\r\n                        }],\r\n                    projectUrl: ['ContentUrl', function (ContentUrl) {\r\n                            return function (item, subplaceName) { return ContentUrl.forItem(item, VizPortal.ProjectContentType, subplaceName); };\r\n                        }],\r\n                    workbookUrl: ['ContentUrl', function (ContentUrl) {\r\n                            return function (item, subplaceName) { return ContentUrl.forItem(item, VizPortal.WorkbookContentType, subplaceName); };\r\n                        }],\r\n                    defaultOrder: function () { return contentType.defaultOrder; },\r\n                    shouldFetchDetails: function () { return (function () { return true; }); } // Fetches details by default\r\n                };\r\n                _.extend(resolve, customResolve);\r\n                return {\r\n                    url: '/' + name,\r\n                    templateUrl: templateUrl,\r\n                    controller: VizPortal.ContentSubplaceCtrl,\r\n                    resolve: resolve\r\n                };\r\n            }\r\n            // Site User\r\n            // !!! ATTENTION !!!\r\n            // If you changed the url scheme of user or user setting,\r\n            // make sure to also update the user setting url generation code in:\r\n            // \\workgroup\\vqlweb\\scriptsharp\\src\\Authoring\\ViewModels\\AuthoringMastheadViewModel.cs\r\n            $stateProvider\r\n                .state('main.site.user', {\r\n                abstract: true,\r\n                url: '/user/:domainName/{username:.*}',\r\n                templateUrl: 'siteUserPlace.html',\r\n                controller: VizPortal.SiteUserPlaceCtrl,\r\n                resolve: {\r\n                    isSessionUserSelf: ['$stateParams',\r\n                        'ServerService',\r\n                        function ($stateParams, serverService) {\r\n                            return serverService.isSessionUserEqualTo($stateParams['username'], $stateParams['domainName']);\r\n                        }],\r\n                    isSessionServerAdmin: ['ServerService',\r\n                        function (serverService) {\r\n                            return serverService.isSessionServerAdmin();\r\n                        }],\r\n                    isSessionSiteAdmin: ['ServerService',\r\n                        function (serverService) { return serverService.isSessionSiteAdmin(); }\r\n                    ],\r\n                    siteUser: ['SiteUsers',\r\n                        'Users',\r\n                        '$stateParams',\r\n                        'isSessionUserSelf',\r\n                        'isSessionServerAdmin',\r\n                        'isSessionSiteAdmin',\r\n                        function (siteUsers, users, $stateParams, isSessionUserSelf, isSessionServerAdmin, isSessionSiteAdmin) {\r\n                            var username = $stateParams['username'];\r\n                            var domainName = $stateParams['domainName'];\r\n                            if (isSessionUserSelf || isSessionServerAdmin || isSessionSiteAdmin) {\r\n                                // user is admin or viewing their own profile; fetch the data from getSiteUser\r\n                                return siteUsers.getUserByUsernameAndDomain(username, domainName);\r\n                            }\r\n                            else {\r\n                                // non-admin, non-self; fetch the data from getUser instead of getSiteUser.\r\n                                return users.getUserByUsernameAndDomain(username, domainName);\r\n                            }\r\n                        }],\r\n                    userSettings: ['UserSettingsStore',\r\n                        '$stateParams',\r\n                        'isSessionUserSelf',\r\n                        'isSessionServerAdmin',\r\n                        'isSessionSiteAdmin',\r\n                        function (userSettingsStore, $stateParams, isSessionUserSelf, isSessionServerAdmin, isSessionSiteAdmin) {\r\n                            if (isSessionUserSelf || isSessionServerAdmin || isSessionSiteAdmin) {\r\n                                // user is admin or viewing their own profile; get the user's settings\r\n                                return userSettingsStore.getUserSettings($stateParams['username'], $stateParams['domainName']);\r\n                            }\r\n                            else {\r\n                                // non-admin, non-self; don't get settings.\r\n                                return null;\r\n                            }\r\n                        }],\r\n                    place: ['$state', 'siteUser', 'SiteUserPlace', 'isSessionServerAdmin', 'isSessionUserSelf', 'ServerService',\r\n                        function ($state, siteUser, SiteUserPlace, isSessionServerAdmin, isSessionUserSelf, server) {\r\n                            if (siteUser) {\r\n                                // user exists on site\r\n                                return SiteUserPlace.create(siteUser.id);\r\n                            }\r\n                            else if (isSessionServerAdmin && isSessionUserSelf) {\r\n                                // Server admin who is not a member of the site\r\n                                return SiteUserPlace.empty();\r\n                            }\r\n                            else {\r\n                                // user doesn't exist on this site\r\n                                if (server.canSessionUserManageUsers()) {\r\n                                    var usersErrorState = {\r\n                                        detailsLocKey: 'userCannotBeAccessed',\r\n                                        redirectState: 'main.site.users',\r\n                                        redirectLocKey: 'backToUsers'\r\n                                    };\r\n                                    $state.go('main.error', usersErrorState);\r\n                                }\r\n                                else {\r\n                                    $state.go('main.error');\r\n                                }\r\n                            }\r\n                        }],\r\n                    serverUser: ['isSessionServerAdmin',\r\n                        '$stateParams',\r\n                        'siteUser',\r\n                        'ServerUsers',\r\n                        function (isSessionServerAdmin, $stateParams, siteUser, serverUsers) {\r\n                            // we need to get the server user if the current user is a serverAdmin and not a site member\r\n                            if (!siteUser && isSessionServerAdmin) {\r\n                                return serverUsers.getUserByUsernameAndDomain($stateParams['username'], $stateParams['domainName']);\r\n                            }\r\n                            else {\r\n                                return null;\r\n                            }\r\n                        }]\r\n                }\r\n            })\r\n                .state('main.site.user.workbooks', subplaceState('workbooks', VizPortal.WorkbookContentType))\r\n                .state('main.site.user.views', subplaceState('views', VizPortal.ViewContentType))\r\n                .state('main.site.user.datasources', subplaceState('datasources', VizPortal.DatasourceContentType, {\r\n                shouldFetchDetails: function () { return VizPortal.DataSources.isPublished; }\r\n            }))\r\n                .state('main.site.user.settings', {\r\n                url: '/settings',\r\n                templateUrl: 'siteUserSettingsSubplace.html',\r\n                controller: VizPortal.SiteUserSettingsSubplaceCtrl,\r\n                resolve: {\r\n                    serverUser: ['ServerUsers', '$stateParams', function (serverUsers, $stateParams) {\r\n                            return serverUsers.getUserByUsernameAndDomain($stateParams['username'], $stateParams['domainName']);\r\n                        }\r\n                    ],\r\n                    userRefreshTokenCount: ['ServerUsers', '$stateParams', function (serverUsers, $stateParams) {\r\n                            return serverUsers.getUserRefreshTokenCount($stateParams['username'], $stateParams['domainName']);\r\n                        }\r\n                    ]\r\n                },\r\n                data: {\r\n                    authLevel: VizPortal.AuthLevel.SelfOrAdmin\r\n                }\r\n            })\r\n                .state('main.site.user.subscriptions', {\r\n                url: '/subscriptions',\r\n                templateUrl: 'subscriptions.html',\r\n                controller: VizPortal.SubscriptionsCtrl,\r\n                resolve: {\r\n                    subplace: ['place', function (place) { return place.subplace('subscriptions'); }]\r\n                },\r\n                data: {\r\n                    authLevel: VizPortal.AuthLevel.SelfOrAdmin\r\n                }\r\n            });\r\n            // This state no longer serves any purpose and should be removed.\r\n            $stateProvider\r\n                .state('main.site.content', {\r\n                url: '',\r\n                template: '<div class=\"tb-fill\" ui-view></div>',\r\n                abstract: true\r\n            });\r\n            // Site content (aka All Content)\r\n            $stateProvider\r\n                .state('main.site.content.site', {\r\n                abstract: true,\r\n                templateUrl: 'site.html',\r\n                resolve: {\r\n                    place: ['SitePlace', function (SitePlace) { return SitePlace.create(); }]\r\n                },\r\n                controller: VizPortal.SitePlaceCtrl\r\n            })\r\n                .state('main.site.content.site.projects', subplaceState('projects', VizPortal.ProjectContentType))\r\n                .state('main.site.content.site.workbooks', subplaceState('workbooks', VizPortal.WorkbookContentType))\r\n                .state('main.site.content.site.views', subplaceState('views', VizPortal.ViewContentType))\r\n                .state('main.site.content.site.datasources', subplaceState('datasources', VizPortal.DatasourceContentType, {\r\n                shouldFetchDetails: function () { return VizPortal.DataSources.isPublished; }\r\n            }));\r\n            // Project details\r\n            $stateProvider\r\n                .state('main.site.content.project', {\r\n                url: '/projects/:id',\r\n                templateUrl: 'project.html',\r\n                abstract: true,\r\n                resolve: {\r\n                    project: ['Projects', '$stateParams', function (Projects, $stateParams) {\r\n                            return Projects.getById($stateParams.id);\r\n                        }],\r\n                    projectActions: ['Projects', '$stateParams', function (Projects, $stateParams) {\r\n                            return Projects.actions($stateParams.id);\r\n                        }],\r\n                    place: ['project', 'ProjectPlace', function (project, ProjectPlace) {\r\n                            return ProjectPlace.create(project.id);\r\n                        }]\r\n                },\r\n                controller: VizPortal.ProjectPlaceCtrl,\r\n                data: {\r\n                    errorState: {\r\n                        detailsLocKey: 'projectCannotBeAccessed',\r\n                        redirectState: 'main.site.content.site.projects',\r\n                        redirectLocKey: 'backToProjects'\r\n                    }\r\n                }\r\n            })\r\n                .state('main.site.content.project.datasources', subplaceState('datasources', VizPortal.DatasourceContentType, {\r\n                shouldFetchDetails: function () { return VizPortal.DataSources.isPublished; }\r\n            }))\r\n                .state('main.site.content.project.workbooks', subplaceState('workbooks', VizPortal.WorkbookContentType))\r\n                .state('main.site.content.project.views', subplaceState('views', VizPortal.ViewContentType))\r\n                .state('main.site.content.project.permissions', {\r\n                url: '/permissions',\r\n                templateUrl: 'projectPermissions.html',\r\n                controller: VizPortal.setBrowserTitleCtrl('permissions')\r\n            })\r\n                .state('main.site.content.project.details', {\r\n                url: '/details',\r\n                templateUrl: 'projectSettings.html',\r\n                controller: VizPortal.setBrowserTitleCtrl('details')\r\n            });\r\n            // Workbook details\r\n            $stateProvider\r\n                .state('main.site.content.workbook', {\r\n                url: '/workbooks/:id',\r\n                templateUrl: 'workbook.html',\r\n                abstract: true,\r\n                resolve: {\r\n                    workbook: ['Workbooks', '$stateParams', function (Workbooks, $stateParams) {\r\n                            return Workbooks.getById($stateParams.id);\r\n                        }],\r\n                    workbookActions: ['Workbooks', '$stateParams', function (Workbooks, $stateParams) {\r\n                            return Workbooks.actions($stateParams.id);\r\n                        }],\r\n                    place: ['workbook', 'WorkbookPlace', function (workbook, WorkbookPlace) { return WorkbookPlace.create(workbook.id); }]\r\n                },\r\n                controller: VizPortal.WorkbookPlaceCtrl,\r\n                data: {\r\n                    errorState: {\r\n                        detailsLocKey: 'workbookCannotBeAccessed',\r\n                        redirectState: 'main.site.content.site.workbooks',\r\n                        redirectLocKey: 'backToWorkbooks'\r\n                    }\r\n                }\r\n            })\r\n                .state('main.site.content.workbook.datasources', subplaceState('datasources', VizPortal.DatasourceContentType, {\r\n                shouldFetchDetails: function () { return VizPortal.DataSources.isPublished; }\r\n            }, 'workbookDatasourceSubplace.html'))\r\n                .state('main.site.content.workbook.views', subplaceState('views', VizPortal.ViewInWorkbookContentType))\r\n                .state('main.site.content.workbook.permissions', {\r\n                url: '/permissions',\r\n                templateUrl: 'workbookPermissions.html',\r\n                controller: VizPortal.setBrowserTitleCtrl('permissions')\r\n            })\r\n                .state('main.site.content.workbook.details', {\r\n                url: '/details',\r\n                templateUrl: 'workbookSettings.html',\r\n                controller: VizPortal.setBrowserTitleCtrl('details')\r\n            });\r\n            VizPortal.ConfigHelper.addSubscriptionsState($stateProvider, 'main.site.content.workbook');\r\n            VizPortal.ConfigHelper.addExtractTasksState($stateProvider, 'main.site.content.workbook', ['workbook', 'ServerService', 'CreateExtractTasksAction',\r\n                function (workbook, ServerService, CreateExtractTasksAction) {\r\n                    return {\r\n                        modifyExtractTasksPermission: ServerService.isSessionSiteOrServerAdmin() || workbook.owner.id === ServerService.sessionUserId(),\r\n                        createExtractTaskFn: function (context) { return CreateExtractTasksAction.forWorkbook(workbook, context, VizPortal.CreateExtractTasksMode.AllowSchedule); }\r\n                    };\r\n                }\r\n            ]);\r\n            // Datasource details\r\n            $stateProvider\r\n                .state('main.site.content.datasource', {\r\n                url: '/datasources/:id',\r\n                templateUrl: 'datasource.html',\r\n                abstract: true,\r\n                resolve: {\r\n                    datasource: ['DataSources', '$stateParams', function (DataSources, $stateParams) {\r\n                            return DataSources.getById($stateParams.id);\r\n                        }],\r\n                    datasourceActions: ['DataSources', '$stateParams', function (DataSources, $stateParams) {\r\n                            return DataSources.actions($stateParams.id);\r\n                        }],\r\n                    place: ['datasource', 'DatasourcePlace', function (datasource, DatasourcePlace) {\r\n                            return DatasourcePlace.create(datasource.id);\r\n                        }]\r\n                },\r\n                controller: VizPortal.DatasourcePlaceCtrl,\r\n                data: {\r\n                    errorState: {\r\n                        detailsLocKey: 'datasourceCannotBeAccessed',\r\n                        redirectState: 'main.site.content.datasource',\r\n                        redirectLocKey: 'backToDatasources'\r\n                    }\r\n                }\r\n            })\r\n                .state('main.site.content.datasource.connectedWorkbooks', subplaceState('connectedWorkbooks', VizPortal.WorkbookContentType))\r\n                .state('main.site.content.datasource.dataConnection', {\r\n                url: '/dataConnection',\r\n                templateUrl: 'datasourceDataConnection.html',\r\n                controller: VizPortal.DatasourceDataConnectionCtrl\r\n            })\r\n                .state('main.site.content.datasource.permissions', {\r\n                url: '/permissions',\r\n                templateUrl: 'datasourcePermissions.html',\r\n                controller: VizPortal.setBrowserTitleCtrl('permissions')\r\n            })\r\n                .state('main.site.content.datasource.details', {\r\n                url: '/details',\r\n                templateUrl: 'datasourceSettings.html',\r\n                controller: VizPortal.setBrowserTitleCtrl('details')\r\n            })\r\n                .state('main.site.content.datasource.remoteRefreshSchedules', {\r\n                url: '/localExtractRefreshes',\r\n                templateUrl: 'remoteRefreshSchedules.html',\r\n                controller: VizPortal.RemoteRefreshSchedulesCtrl,\r\n                resolve: {\r\n                    datasource: ['DataSources', '$stateParams', function (DataSources, $stateParams) {\r\n                            return DataSources.getById($stateParams.id);\r\n                        }],\r\n                    subplace: ['place', function (place) { return place.subplace('remoteRefreshSchedules'); }]\r\n                }\r\n            });\r\n            VizPortal.ConfigHelper.addExtractTasksState($stateProvider, 'main.site.content.datasource', ['datasource', 'ServerService', 'CreateExtractTasksAction',\r\n                function (datasource, ServerService, CreateExtractTasksAction) {\r\n                    return {\r\n                        modifyExtractTasksPermission: ServerService.isSessionSiteOrServerAdmin() || datasource.owner.id === ServerService.sessionUserId(),\r\n                        createExtractTaskFn: function (context) { return CreateExtractTasksAction.forDatasource(datasource, context, VizPortal.CreateExtractTasksMode.AllowSchedule); },\r\n                        datasource: datasource\r\n                    };\r\n                }\r\n            ]);\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().config(['$provide', function ($provide) {\r\n            $provide.decorator('$q', ['$delegate', function ($delegate) {\r\n                    // Decorate all promises\r\n                    function decoratedThen() {\r\n                        return decoratePromise(this.originalThen.apply(this, arguments));\r\n                    }\r\n                    function decoratedCatch() {\r\n                        return decoratePromise(this.originalCatch.apply(this, arguments));\r\n                    }\r\n                    function decoratedFinally() {\r\n                        return decoratePromise(this.originalFinally.apply(this, arguments));\r\n                    }\r\n                    function progress(cb) {\r\n                        return this.then(null, null, cb);\r\n                    }\r\n                    function decoratePromise(promise) {\r\n                        promise.fin = promise['finally'];\r\n                        promise.fail = promise['catch'];\r\n                        promise.progress = progress;\r\n                        promise.originalThen = promise.then;\r\n                        promise.originalCatch = promise['catch'];\r\n                        promise.originalFinally = promise['finally'];\r\n                        promise.then = decoratedThen;\r\n                        promise['catch'] = decoratedCatch;\r\n                        promise['finally'] = decoratedFinally;\r\n                        return promise;\r\n                    }\r\n                    // Decorate all functions on $q\r\n                    function decoratedWhen() {\r\n                        return decoratePromise(this.originalWhen.apply(this, arguments));\r\n                    }\r\n                    function decoratedReject() {\r\n                        return decoratePromise(this.originalReject.apply(this, arguments));\r\n                    }\r\n                    function decoratedAll() {\r\n                        return decoratePromise(this.originalAll.apply(this, arguments));\r\n                    }\r\n                    function decoratedDefer() {\r\n                        var deferred = this.originalDefer.apply(this, arguments);\r\n                        deferred.promise = decoratePromise(deferred.promise);\r\n                        return deferred;\r\n                    }\r\n                    $delegate.originalWhen = $delegate.when;\r\n                    $delegate.originalReject = $delegate.reject;\r\n                    $delegate.originalAll = $delegate.all;\r\n                    $delegate.originalDefer = $delegate.defer;\r\n                    $delegate.when = decoratedWhen;\r\n                    $delegate.reject = decoratedReject;\r\n                    $delegate.all = decoratedAll;\r\n                    $delegate.defer = decoratedDefer;\r\n                    return $delegate;\r\n                }]);\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().config(['$provide', function ($provide) {\r\n            $provide.decorator('$state', ['$delegate', function ($delegate) {\r\n                    $delegate.hardReload = function () {\r\n                        $delegate.transitionTo($delegate.current.name, $delegate.params, { reload: true, notify: true, inherit: false });\r\n                    };\r\n                    return $delegate;\r\n                }]);\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ImagePreloadService = (function () {\r\n        function ImagePreloadService() {\r\n        }\r\n        ImagePreloadService.prototype.preloadDynamicIconImages = function () {\r\n            _.each(ImagePreloadService.DynamicIconImages, function (image) {\r\n                new Image().src = 'img/' + image + '?' + VizPortal.BuildId;\r\n            });\r\n        };\r\n        ImagePreloadService.DynamicIconImages = [\r\n            'actions_hover.png',\r\n            'busy_large.gif',\r\n            'checkbox_empty_hover.png',\r\n            'checkbox_mixed_hover.png',\r\n            'checkbox_selected_hover.png',\r\n            'checkbox_selected_normal.png',\r\n            'close_x_hover.png',\r\n            'column_dropdown_arrow_hover.png',\r\n            'data_source_content_type_hover_small.png',\r\n            'down_arrow_hover.png',\r\n            'download_small_hover.png',\r\n            'edit_small_hover.png',\r\n            'expand_close_hover.png',\r\n            'expand_open_hover.png',\r\n            'grid_checkbox_corner_normal_hover.png',\r\n            'info_hover.png',\r\n            'magnifying_glass_large_hover.png',\r\n            'magnifying_glass_small_hover.png',\r\n            'new_workbook_small_hover.png',\r\n            'panel_hide_hover.png',\r\n            'panel_show_hover.png',\r\n            'radio_button_empty_disabled.png',\r\n            'radio_button_empty_hover.png',\r\n            'radio_button_empty_normal.png',\r\n            'radio_button_selected_disabled.png',\r\n            'radio_button_selected_hover.png',\r\n            'radio_button_selected_normal.png',\r\n            'refresh_small_hover.png',\r\n            'rename_small_hover.png',\r\n            'run_now_small_hover.png',\r\n            'signature_dropdown_small_hover.png',\r\n            'star_empty_small_hover.png',\r\n            'star_selected_small_normal.png',\r\n            'star_selected_small_hover.png',\r\n            'up_arrow_header_hover.png',\r\n            'view_content_type_hover_small.png',\r\n            'workbook_content_type_hover_small.png'\r\n        ];\r\n        return ImagePreloadService;\r\n    })();\r\n    VizPortal.ImagePreloadService = ImagePreloadService;\r\n    VizPortal.Module.instance().service('ImagePreloadService', ImagePreloadService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    /**\r\n     * Facade on ui-router's $state\r\n     * Use this when you're trying to learn things about a state that is not the current state, otherwise use $state directly.\r\n     */\r\n    var StateWrapperService = (function () {\r\n        function StateWrapperService($state) {\r\n            this.$state = $state;\r\n        }\r\n        StateWrapperService.prototype.t = function (state) {\r\n            return state.$$state;\r\n        };\r\n        /**\r\n         * Returns the first state found that matches the path and the search parameters.\r\n         * If no state is found, returns undefined\r\n         * Normal usage: getMatchingState($location.path(), $location.search())\r\n         */\r\n        StateWrapperService.prototype.getMatchingState = function (path, searchParams) {\r\n            var _this = this;\r\n            return _.find(this.$state.get(), function (state) {\r\n                var internalState = _this.t(state);\r\n                return internalState && internalState.url &&\r\n                    !!internalState.url.exec(path, searchParams);\r\n            });\r\n        };\r\n        /**\r\n         * Return the stateParams that match the path and the searchParams.\r\n         * If no state is found, returns undefined\r\n         * Normal usage: getStateParams($location.path(), $location.search())\r\n         */\r\n        StateWrapperService.prototype.getStateParams = function (path, searchParams) {\r\n            var state = this.getMatchingState(path, searchParams);\r\n            if (!state)\r\n                return undefined;\r\n            return this.t(state).url.exec(path, searchParams);\r\n        };\r\n        /**\r\n         * Gets the site urlName from the current url if it is the login state\r\n         */\r\n        StateWrapperService.prototype.getSiteUrlNameIfLoginState = function (path, searchParams) {\r\n            var state = this.getMatchingState(path, searchParams);\r\n            if (!state)\r\n                return null;\r\n            var stateParams = this.t(state).url.exec(path, searchParams);\r\n            if (state.name === 'login.authenticate') {\r\n                return stateParams['site'];\r\n            }\r\n            return null;\r\n        };\r\n        StateWrapperService.prototype.isDescendantOf = function (descendant, ancestorName) {\r\n            if (!descendant)\r\n                return undefined;\r\n            return this.t(descendant).includes[ancestorName] && descendant.name !== ancestorName;\r\n        };\r\n        StateWrapperService.$inject = ['$state'];\r\n        return StateWrapperService;\r\n    })();\r\n    VizPortal.StateWrapperService = StateWrapperService;\r\n    VizPortal.Module.instance().service('StateWrapperService', StateWrapperService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"libs.ts\" />\r\n/// <reference path=\"../app/UrlParamKeys.ts\" />\r\n/// <reference path=\"helpers/ErrorCodes.ts\" />\r\n/// <reference path=\"L10n/L10n.ts\" />\r\n/// <reference path=\"Module.ts\" />\r\n/// <reference path=\"services/BrowserTitleService.ts\" />\r\n/// <reference path=\"services/ImagePreloadService.ts\" />\r\n/// <reference path=\"services/ModalService.ts\" />\r\n/// <reference path=\"services/ServerService.ts\" />\r\n/// <reference path=\"services/SiteSwitchService.ts\" />\r\n/// <reference path=\"services/StateWrapperService.ts\" />\r\n/// <reference path=\"services/VizService.ts\" />\r\n/// <reference path=\"services/WindowLocationService.ts\" />\r\n/// <reference path=\"services/WindowPopupService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    /**\r\n     * This is the run block for VizPortal. It is run once when the app is loaded.\r\n     * We declare it in an isolated module for the reasons mentioned in Angular's\r\n     * documentation (https://docs.angularjs.org/guide/module#run-blocks):\r\n     *\r\n     *    Run blocks are the closest thing in Angular to the main method.\r\n     *    A run block is the code which needs to run to kickstart the application.\r\n     *    It is executed after all of the service have been configured and the\r\n     *    injector has been created. Run blocks typically contain code which is\r\n     *    hard to unit-test, and for this reason should be declared in isolated\r\n     *    modules, so that they can be ignored in the unit-tests.\r\n     */\r\n    angular.module('VizPortalRun', ['VizPortal']).run([\r\n        '$injector',\r\n        '$rootScope',\r\n        '$state',\r\n        '$window',\r\n        '$document',\r\n        '$interval',\r\n        '$location',\r\n        '$urlRouter',\r\n        '$translate',\r\n        'ServerService',\r\n        'ModalService',\r\n        'ToasterService',\r\n        'SiteSwitchService',\r\n        'StateWrapperService',\r\n        'WindowLocationService',\r\n        'VizService',\r\n        'WindowPopupService',\r\n        'BrowserTitleService',\r\n        'ImagePreloadService',\r\n        'BrowserSupportService',\r\n        function ($injector, $rootScope, $state, $window, $document, $interval, $location, $urlRouter, $translate, server, modal, toaster, SiteSwitchService, StateWrapperService, WindowLocationService, VizService, WindowPopupService, BrowserTitleService, ImagePreloadService, BrowserSupportService) {\r\n            // Initialize service which require eager instantiation\r\n            VizPortal.Module.initializeEagerServices($injector);\r\n            // Defer prefetching until after the first stateChangeSuccess so\r\n            // we don't do any extra work before the page is first rendered\r\n            var removeImagePreloadListener = $rootScope.$on('$stateChangeSuccess', function () {\r\n                $interval(function () { return ImagePreloadService.preloadDynamicIconImages(); }, 1000, 1);\r\n                removeImagePreloadListener();\r\n            });\r\n            // TFSID:408905 Disable Android Chrome's native magnifier\r\n            if (BrowserSupportService.isAndroidChrome()) {\r\n                BrowserSupportService.setViewport(VizPortal.ViewportContent.deviceWidth);\r\n            }\r\n            function redirectToLogin(errorCode) {\r\n                var params = {\r\n                    redirect: $location.url() || null,\r\n                    error: errorCode === VizPortal.CommonErrorCode.InvalidSession ? null : errorCode\r\n                };\r\n                if (server.isAuthenticationAutoLogin()) {\r\n                    // The signin state will attempt to auto-login by default. We don't want it to here.\r\n                    params.disableAutoSignin = true;\r\n                }\r\n                var siteUrlName = StateWrapperService.getSiteUrlNameIfLoginState($location.path(), $location.search());\r\n                if (siteUrlName) {\r\n                    params.site = siteUrlName;\r\n                }\r\n                $state.go('login.authenticate', params);\r\n            }\r\n            function shouldRedirectToLogin(nextState) {\r\n                if (!nextState) {\r\n                    return false;\r\n                }\r\n                var isNextStateAnonymous = nextState.data && nextState.data.authLevel === VizPortal.AuthLevel.Anonymous;\r\n                return !server.inSession() && !isNextStateAnonymous;\r\n            }\r\n            function shouldAutoLogin(nextState) {\r\n                var isNextStateAnonymous = nextState && nextState.data && nextState.data.authLevel === VizPortal.AuthLevel.Anonymous;\r\n                return !server.inSession() && !isNextStateAnonymous && server.isAuthenticationAutoLogin();\r\n            }\r\n            function shouldRedirectToEmbeddedViz(nextState) {\r\n                return nextState && nextState.name === 'main.site.viz' && (VizService.isEmbedParamOn() ||\r\n                    server.isSessionRestrictedTrustedTicket());\r\n            }\r\n            function shouldRedirectToGuestViz(nextState) {\r\n                return nextState && nextState.name === 'main.site.viz' && !server.inSession() && server.isGuestEnabled();\r\n            }\r\n            function shouldRedirectToVizExport(nextState) {\r\n                return nextState && nextState.name === 'main.site.viz' && VizService.pathHasExportableFileType();\r\n            }\r\n            $rootScope.$on('$stateChangeSuccess', function (event, toState, toStateParams) {\r\n                var authLevel = toState.data ? toState.data.authLevel : VizPortal.AuthLevel.Anonymous;\r\n                if (!server.isUserAuthorized(authLevel)) {\r\n                    if (server.inSession()) {\r\n                        $state.go('main.error', {\r\n                            redirectSiteUrlName: toStateParams.siteUrlName // This may not be the current site\r\n                        });\r\n                    }\r\n                    else {\r\n                        $state.go('login.authenticate');\r\n                    }\r\n                }\r\n            });\r\n            $rootScope.$on('$stateChangeStart', function (event, toState, toStateParams, fromState, fromStateParams) {\r\n                // Reset the title to just the server name.\r\n                BrowserTitleService.setTitle();\r\n                // If we are moving to a site area\r\n                if (_.isString(toStateParams.siteUrlName)) {\r\n                    // switchIfNeeded() handles site-switch error routing\r\n                    // $location.url() is used in redirectToOtherPod to figure out the destination URL. This works well\r\n                    // in the case where the user changes the site portion of the URL by editing the address bar.\r\n                    // However, this does not work in the case when this code is called when a server admin clicks on a\r\n                    // site-name in the sites list. Matt York has agreed to fix this when he replaces UIRouter.\r\n                    SiteSwitchService.switchIfNeeded(toStateParams.siteUrlName, '/#' + $location.url());\r\n                }\r\n            });\r\n            function maybeVizRedirect(nextState) {\r\n                if (shouldRedirectToVizExport(nextState)) {\r\n                    WindowLocationService.navigateToWithoutAddingToHistory(VizService.getVizqlUrl());\r\n                    return true;\r\n                }\r\n                else if (shouldRedirectToEmbeddedViz(nextState)) {\r\n                    WindowLocationService.navigateToWithoutAddingToHistory(VizService.getEmbeddedVizqlUrl());\r\n                    return true;\r\n                }\r\n                else if (shouldRedirectToGuestViz(nextState)) {\r\n                    WindowLocationService.navigateToWithoutAddingToHistory(VizService.getEmbeddedVizqlUrl({ isFromGuest: true }));\r\n                    return true;\r\n                }\r\n                return false;\r\n            }\r\n            function shouldRedirectToSitePicker(props) {\r\n                return props.isSuccessfulSamlLogin && server.isSessionMultiSite() && isRootUrl();\r\n            }\r\n            function isRootUrl() {\r\n                return $location.path() === '' || $location.path() === '/';\r\n            }\r\n            // VizPortal 9.0 Session Expiration Solution - B144748\r\n            // 1) Only the getActionInfo and getSessionInfo requests will extend your session\r\n            // 2) As long as the user is interacting , getSessionInfo will be requested once every 5 minutes or half\r\n            //    the configured idle time limit (wgserver.session.idle_limit), whichever is less\r\n            // 3) We determine if the user is interacting by listening to mousemove and keydown events in the browser\r\n            function initializeSessionPing() {\r\n                // If the browser tab comes into focus we want to refresh the session info.\r\n                // Do this at most once every 15 seconds\r\n                $($window).focus(_.throttle(function () { return server.refreshSessionInfo(); }, 15000, { trailing: false }));\r\n                var fiveMinutesInMilliseconds = 5 * 60 * 1000;\r\n                var halfSessionIdleLimitInMilliseconds = server.getSessionIdleLimitSeconds() * 1000;\r\n                var sessionPingPeriodWhileUserIsInteracting = Math.min(fiveMinutesInMilliseconds, halfSessionIdleLimitInMilliseconds);\r\n                // Don't let the period fall below 15 seconds, because that's absurdly short\r\n                sessionPingPeriodWhileUserIsInteracting = Math.max(sessionPingPeriodWhileUserIsInteracting, 15 * 1000);\r\n                var listenForInteractionAfterSessionPingPeriod = function () {\r\n                    // timeout for session ping period, then listen to interaction events\r\n                    $interval(function () {\r\n                        // $.one will bind to the event once per element per event type. In this case the handler will\r\n                        // be fired twice if mousemove and keydown both fire, so ensure the handler is only called once\r\n                        $($document).one('keydown mousemove touchstart', _.once(function () {\r\n                            // User is alive! ping the server, then sleep on it\r\n                            server.refreshSessionInfo();\r\n                            listenForInteractionAfterSessionPingPeriod();\r\n                        }));\r\n                    }, sessionPingPeriodWhileUserIsInteracting, 1, false);\r\n                };\r\n                // Kick it off\r\n                listenForInteractionAfterSessionPingPeriod();\r\n            }\r\n            // The client is hidden initially. We should show it once we know we will be displaying UI\r\n            // (as opposed to navigating away from vizportal client).\r\n            function showClient() {\r\n                $($window.document.body).show();\r\n            }\r\n            // Overrides the server authentication type with the uppercased \"auth\" param from the url\r\n            // Example: http://localhost/#/signin?auth=external -> EXTERNAL\r\n            // TFS:373719 Reimplement the allow_direct_access scenario for 9.0\r\n            function overrideAuthenticationTypeBasedOnUrl() {\r\n                var override = $location.search()[VizPortal.UrlParamKeys.AuthenticationType];\r\n                $location.search(VizPortal.UrlParamKeys.AuthenticationType, null);\r\n                server.overrideAuthenticationType(override ? override.toUpperCase() : null);\r\n            }\r\n            function bootstrapCheckInitialAdmin(code, nextState) {\r\n                initializeSessionPing();\r\n                overrideAuthenticationTypeBasedOnUrl();\r\n                // Need to know if the user already authenticated or not\r\n                if (code === VizPortal.UninitializedServerErrorCode.UntrustedMachine) {\r\n                    showClient();\r\n                    $state.go('login.untrusted');\r\n                }\r\n                else if (code === VizPortal.UninitializedServerErrorCode.ReadyToInitialize) {\r\n                    showClient();\r\n                    $state.go('login.init');\r\n                }\r\n                else {\r\n                    bootstrapCheckAutoLogin(code, nextState);\r\n                }\r\n            }\r\n            function bootstrapCheckAutoLogin(code, nextState) {\r\n                if (shouldAutoLogin(nextState)) {\r\n                    // Go to interstitial page that may be showing 'Signing In' spinner\r\n                    $state.go('login.interstitial').then(function () { return showClient(); });\r\n                    server.autoLogin().then(function () {\r\n                        // Go to site picker if destination site is ambiguous\r\n                        if (isRootUrl() && server.isSessionMultiSite()) {\r\n                            $state.go('login.site');\r\n                        }\r\n                        else {\r\n                            bootstrapCheckRedirects(code, nextState);\r\n                        }\r\n                    }, function (errorCode) {\r\n                        bootstrapCheckRedirects(errorCode, nextState);\r\n                    });\r\n                }\r\n                else {\r\n                    bootstrapCheckRedirects(code, nextState);\r\n                }\r\n            }\r\n            function bootstrapCheckRedirects(code, nextState) {\r\n                if (maybeVizRedirect(nextState)) {\r\n                }\r\n                else if (shouldRedirectToLogin(nextState)) {\r\n                    showClient();\r\n                    redirectToLogin(code);\r\n                }\r\n                else if (shouldRedirectToSitePicker({\r\n                    isSuccessfulSamlLogin: Helpers.BooleanQueryParamRegex.test($location.search()[VizPortal.UrlParamKeys.IsFromSaml])\r\n                })) {\r\n                    showClient();\r\n                    $state.go('login.site');\r\n                }\r\n                else {\r\n                    // Retry $locationChange\r\n                    showClient();\r\n                    $urlRouter.sync();\r\n                }\r\n            }\r\n            $rootScope.$on('$locationChangeStart', function (event) {\r\n                var nextState = StateWrapperService.getMatchingState($location.path(), $location.search());\r\n                if (server.isSessionStateUnknown()) {\r\n                    // We've just loaded the app and session state is unknown. We can't decide what\r\n                    // to do until we know the session state, so prevent the location change. This\r\n                    // will prevent the app from entering the ui router state machine.\r\n                    event.preventDefault();\r\n                    server.bootstrapSession().then(function (code) { return bootstrapCheckInitialAdmin(code, nextState); });\r\n                }\r\n                else if (maybeVizRedirect(nextState)) {\r\n                    event.preventDefault();\r\n                }\r\n                else if (shouldRedirectToLogin(nextState)) {\r\n                    event.preventDefault();\r\n                    redirectToLogin(null);\r\n                }\r\n            });\r\n            // Dismiss modal dialogs on location change e.g. if the user clicks the back button\r\n            $rootScope.$on('$locationChangeSuccess', function () {\r\n                modal.dismissAll();\r\n            });\r\n            // Some very basic error handling\r\n            $rootScope.$on('$stateChangeError', function (event, toState, toStateParams, fromState, fromStateParams, error) {\r\n                if (toState.data['errorState']) {\r\n                    $state.go('main.error', toState.data['errorState']);\r\n                }\r\n                else {\r\n                    $state.go('main.error');\r\n                }\r\n            });\r\n            // Keep html lang attribute synchronized with the current language\r\n            $rootScope.$watch(function () { return VizPortal.L10n.language; }, function () {\r\n                if (VizPortal.L10n.language) {\r\n                    angular.element(\"html\")\r\n                        .attr(\"lang\", VizPortal.L10n.language)\r\n                        .attr(\"xml:lang\", VizPortal.L10n.language);\r\n                }\r\n            });\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/ISliceable.ts\" />\r\n/// <reference path=\"../models/Set.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../resources/ActiveDirectoryGroups.ts\" />\r\n/// <reference path=\"../resources/SiteRoles.ts\" />\r\n/// <reference path=\"../ServerApi/requests/SearchActiveDirectoryGroupNameRequest.ts\" />\r\n/// <reference path=\"../ServerApi/types/IGroup.ts\" />\r\n/// <reference path=\"../services/ActiveDirectoryGroupAction.ts\" />\r\n/// <reference path=\"../services/SliceableFactory.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var AddActiveDirectoryGroupDialogCtrl = (function () {\r\n        function AddActiveDirectoryGroupDialogCtrl($scope, $translate, activeDirectoryGroups, sliceableFactory) {\r\n            var _this = this;\r\n            this.$scope = $scope;\r\n            this.$translate = $translate;\r\n            this.activeDirectoryGroups = activeDirectoryGroups;\r\n            this.sliceableFactory = sliceableFactory;\r\n            // initialize search stuff\r\n            $scope.groupSearchValue = { text: \"\" };\r\n            $scope.isSearchStringEmpty = function () { return ($scope.groupSearchValue.text !== ''); };\r\n            var debouncedUpdate = _.debounce(function (newValue) {\r\n                _this.$scope.$evalAsync(function () {\r\n                    _this.onSearchTextChanged(newValue);\r\n                });\r\n            }, 200);\r\n            $scope.$watch('groupSearchValue.text', function (newSearchText) {\r\n                _this.resetSelection();\r\n                _this.$scope.sliceable = _this.sliceableFactory.fromArray();\r\n                if (_.isString(newSearchText) && newSearchText.length > 0) {\r\n                    // input is a non-empty string\r\n                    _this.$scope.hasResults = false;\r\n                    _this.$scope.statusMessage = _this.$translate.instant('addUsersImportAdGroupSearching');\r\n                    debouncedUpdate(newSearchText);\r\n                }\r\n                else {\r\n                    // input is empty\r\n                    _this.$scope.hasResults = false;\r\n                    $scope.statusMessage = \"\";\r\n                }\r\n            });\r\n            // initialize state\r\n            $scope.hasResults = false;\r\n            $scope.statusMessage = \"\";\r\n            $scope.sliceable = this.sliceableFactory.fromArray(); // list of groups, initially empty.\r\n            $scope.selectedItems = new VizPortal.Set(function (group) { return group.id; });\r\n            $scope.disabledItems = new VizPortal.Set(function (group) { return group.id; });\r\n            $scope.groupsToImport = new VizPortal.Set(function (group) { return group.id; });\r\n            // possible site roles settings for the imported group include everything except guest & admin.\r\n            $scope.siteRoleOptions = VizPortal.SiteRoles.WithoutGuestOrServerAdmin;\r\n            // link some private functions to this scope\r\n            $scope.rowClicked = function (row, colIndex) {\r\n                _this.onRowClicked(row, colIndex);\r\n            };\r\n            $scope.isRowSelected = function (locals) {\r\n                return $scope.groupsToImport.contains(locals.row);\r\n            };\r\n        }\r\n        // whenever a row is clicked, add it to the list of groups to import & selected items.\r\n        AddActiveDirectoryGroupDialogCtrl.prototype.onRowClicked = function (row, colIndex) {\r\n            if (!this.$scope.disabledItems.contains(row)) {\r\n                // row is enabled.\r\n                if (!this.$scope.selectedItems.contains(row)) {\r\n                    // the clicked row isn't selected.  reset selection before selecting it (to force single-select).\r\n                    this.resetSelection();\r\n                }\r\n                this.$scope.selectedItems.toggle(row);\r\n                this.$scope.groupsToImport.toggle(row);\r\n                this.$scope.group.model = row;\r\n            }\r\n        };\r\n        // whenever a user searches, fetch the groups and set the sliceable.\r\n        AddActiveDirectoryGroupDialogCtrl.prototype.onSearchTextChanged = function (newSearchText) {\r\n            var _this = this;\r\n            if (_.isString(newSearchText)\r\n                && newSearchText.length > 0) {\r\n                var searchInput = AddActiveDirectoryGroupDialogCtrl.prepareSearchTextInput(newSearchText);\r\n                this.activeDirectoryGroups.searchActiveDirectoryGroupName(searchInput).then(function (result) {\r\n                    if (newSearchText === _this.$scope.groupSearchValue.text) {\r\n                        _this.$scope.sliceable = _this.sliceableFactory.fromArray(result.groups);\r\n                        // checking newSearchText against the groupSearchValue is to make sure this result isn't stale.\r\n                        // if the result is stale now, skip all this because we know a later result will be handled.\r\n                        // TODO: how should we handle LDAP errors when searching?\r\n                        if (result.hasMoreItems) {\r\n                            // received a partial list of the search results (truncated by server).\r\n                            _this.$scope.hasResults = true;\r\n                            _this.$scope.statusMessage = _this.$translate.instant('addUsersImportAdGroupLimit');\r\n                        }\r\n                        else if (!result.groups || result.groups.length == 0) {\r\n                            // received no results.\r\n                            _this.$scope.hasResults = false;\r\n                            _this.$scope.statusMessage = _this.$translate.instant('addUsersImportAdGroupNoResults');\r\n                        }\r\n                        else {\r\n                            // default case: received at least one result, not truncated.\r\n                            _this.$scope.hasResults = true;\r\n                            _this.$scope.statusMessage = \"\";\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n            }\r\n        };\r\n        // helpers\r\n        AddActiveDirectoryGroupDialogCtrl.prototype.resetSelection = function () {\r\n            this.$scope.selectedItems.clear();\r\n            this.$scope.groupsToImport.clear();\r\n            this.$scope.group.model = null;\r\n            this.$scope.group.siteRole = null;\r\n        };\r\n        AddActiveDirectoryGroupDialogCtrl.prepareSearchTextInput = function (searchText) {\r\n            // regex for exact search terms: begins & ends with \", with at least one char between.\r\n            var exactSearchTermRegexp = /^[\"].+[\"]$/;\r\n            // regex for wildcard search terms: anything containing an asterisk.\r\n            var wildSearchTermRegexp = /.*[*]+.*/;\r\n            // change the search text if needed, in preparation for searchActiveDirectoryGroupName.\r\n            var result;\r\n            if (exactSearchTermRegexp.test(searchText)) {\r\n                // exact search: return the string with the \" marks removed from the ends.\r\n                result = searchText.substring(1, searchText.length - 1);\r\n            }\r\n            else if (wildSearchTermRegexp.test(searchText)) {\r\n                // wildcard search: don't change the string.\r\n                result = searchText;\r\n            }\r\n            else {\r\n                // fuzzy search: return the string with * prepended and appended around the group name.\r\n                if (searchText.search(/\\\\/) > 0) {\r\n                    // input includes a backslash, which indicates domainName\\groupName format;\r\n                    // append & prepend * to the input after the slash.\r\n                    result = searchText.replace(/([^\\\\]+)\\\\([^\\\\]+)/g, \"$1\\\\*$2*\");\r\n                }\r\n                else {\r\n                    // append & prepend * to the text input.\r\n                    result = searchText.replace(/(.+)/g, \"*$1*\");\r\n                }\r\n            }\r\n            return result;\r\n        };\r\n        AddActiveDirectoryGroupDialogCtrl.$inject = [\r\n            '$scope',\r\n            '$translate',\r\n            'ActiveDirectoryGroups',\r\n            'SliceableFactory'\r\n        ];\r\n        return AddActiveDirectoryGroupDialogCtrl;\r\n    })();\r\n    VizPortal.AddActiveDirectoryGroupDialogCtrl = AddActiveDirectoryGroupDialogCtrl;\r\n    VizPortal.Module.instance().controller('AddActiveDirectoryGroupDialogCtrl', AddActiveDirectoryGroupDialogCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../fetchers/ListResult.ts\" />\r\n/// <reference path=\"../helpers/Filter.ts\" />\r\n/// <reference path=\"../helpers/Helpers.ts\" />\r\n/// <reference path=\"../helpers/Order.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../models/IGroupInfo.ts\" />\r\n/// <reference path=\"../models/ISliceable.ts\" />\r\n/// <reference path=\"../models/OrderKeys.ts\" />\r\n/// <reference path=\"../models/Set.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../resources/Query.ts\" />\r\n/// <reference path=\"../resources/SiteUsers.ts\" />\r\n/// <reference path=\"../ServerApi/types/IUser.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\n/// <reference path=\"../services/ToasterService.ts\" />\r\n/// <reference path=\"../services/UserActionNotification.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var AddUsersToGroupDialogCtrl = (function () {\r\n        function AddUsersToGroupDialogCtrl($scope, users, group, groupMembershipUpdateActionNotification, $translate, toaster, server) {\r\n            // search stuff\r\n            var _this = this;\r\n            this.$scope = $scope;\r\n            this.users = users;\r\n            this.group = group;\r\n            this.groupMembershipUpdateActionNotification = groupMembershipUpdateActionNotification;\r\n            this.$translate = $translate;\r\n            this.toaster = toaster;\r\n            this.server = server;\r\n            this.isGroupMembershipPrecomputed = false;\r\n            $scope.userSearchValue = { text: '' };\r\n            $scope.$watch('userSearchValue.text', function (newValue) {\r\n                _this.onSearchTextChanged(newValue);\r\n            });\r\n            // site users list stuff\r\n            $scope.sliceable = this.users.all().withOrder(AddUsersToGroupDialogCtrl.ListOrder);\r\n            $scope.selectedItems = new VizPortal.Set(function (user) { return user.id; });\r\n            $scope.disabledItems = new VizPortal.Set(function (user) { return user.id; });\r\n            $scope.usersToBeAdded = new VizPortal.Set(function (user) { return user.id; });\r\n            this.tryPrecomputeGroupMembership();\r\n            $scope.usersSliceChanged = function (newSlice) {\r\n                _this.onUsersSliceChanged(newSlice);\r\n            };\r\n            $scope.rowClicked = function (row, colIndex) {\r\n                _this.onRowClicked(row, colIndex);\r\n            };\r\n            $scope.isRowSelected = function (locals) {\r\n                return $scope.usersToBeAdded.contains(locals.row);\r\n            };\r\n            // dialog stuff\r\n            $scope.addUsersToGroupDescription = this.$translate.instant('addUsersToGroupDescription', { GROUP_NAME: VizPortal.L10n.elideIfLong(group.name) });\r\n            $scope.confirmLabel = function () {\r\n                return _this.$translate.instant('confirmAddUsersToGroup', {\r\n                    ADD_USER_COUNT: $scope.usersToBeAdded.size()\r\n                }, VizPortal.L10n.Interpolations.Count);\r\n            };\r\n            $scope.busy = false;\r\n            $scope.confirm = function () {\r\n                _this.onConfirmAdd();\r\n            };\r\n            $scope.confirmDisabled = function () {\r\n                return ($scope.usersToBeAdded.size() === 0);\r\n            };\r\n        }\r\n        AddUsersToGroupDialogCtrl.prototype.onSearchTextChanged = function (newSearchText) {\r\n            var query = this.users.all().withOrder(AddUsersToGroupDialogCtrl.ListOrder);\r\n            if (_.isString(newSearchText) && newSearchText.length > 0) {\r\n                query = query.withFilters([VizPortal.Filter.search(newSearchText)]);\r\n            }\r\n            this.$scope.sliceable = query;\r\n        };\r\n        AddUsersToGroupDialogCtrl.prototype.onConfirmAdd = function () {\r\n            var _this = this;\r\n            this.$scope.busy = true;\r\n            var users = _.clone(this.$scope.usersToBeAdded); // clone for independence from further selection\r\n            var userIds = users.keys();\r\n            this.users.addToGroups(users.keys(), [this.group.id]).then(function (result) {\r\n                // show toast\r\n                _this.groupMembershipUpdateActionNotification.notify(result, users, 1, _this.group.name, 0, \"\");\r\n                _this.$scope.close(result);\r\n            });\r\n        };\r\n        // Try precompute selection for users already in the group.\r\n        // If there are not that many items in group membership it might make more sense to just\r\n        // precompute the whole group membership. That way, we don't have to issue an extra request\r\n        // everytime the slice changes.\r\n        AddUsersToGroupDialogCtrl.prototype.tryPrecomputeGroupMembership = function () {\r\n            var _this = this;\r\n            var filters = [VizPortal.Filter.stringArrayFieldHas(\"groupIds\", this.group.id)];\r\n            var res = this.users.all().withFilters(filters);\r\n            res.getCount().then(function (countResult) {\r\n                // only precompute if total group membership is under 100\r\n                if (countResult <= 100) {\r\n                    res.getSlice(0, countResult).then(function (result) {\r\n                        _this.isGroupMembershipPrecomputed = true;\r\n                        _.each(result.items, function (item) {\r\n                            _this.$scope.selectedItems.add(item);\r\n                            _this.$scope.disabledItems.add(item);\r\n                        });\r\n                    });\r\n                }\r\n                else {\r\n                    _this.isGroupMembershipPrecomputed = false;\r\n                }\r\n            });\r\n        };\r\n        AddUsersToGroupDialogCtrl.prototype.onRowClicked = function (row, colIndex) {\r\n            if (this.$scope.disabledItems.contains(row)) {\r\n                return;\r\n            }\r\n            this.$scope.selectedItems.toggle(row);\r\n            this.$scope.usersToBeAdded.toggle(row);\r\n        };\r\n        // slice changes when the users scrolls down the list\r\n        AddUsersToGroupDialogCtrl.prototype.onUsersSliceChanged = function (newSlice) {\r\n            var _this = this;\r\n            // only do this if we have not already computed the whole group membership upfront\r\n            if (!this.isGroupMembershipPrecomputed) {\r\n                var userIds = _.map(newSlice.items, function (item) { return item.id; });\r\n                var usersByIdMap = Helpers.dictFromArray(newSlice.items, VizPortal.ServerApi.UserKeys.id);\r\n                if (userIds.length > 0) {\r\n                    this.server.sendRequest(new VizPortal.ServerApi.GetUsersGroupMembershipRequest({ userIds: userIds }))\r\n                        .then(function (result) {\r\n                        _.each(result.members, function (member) {\r\n                            if (member.groupId === _this.group.id) {\r\n                                _this.$scope.selectedItems.add(usersByIdMap[member.userId]);\r\n                                _this.$scope.disabledItems.add(usersByIdMap[member.userId]);\r\n                            }\r\n                        });\r\n                    });\r\n                }\r\n            }\r\n        };\r\n        AddUsersToGroupDialogCtrl.ListOrder = [VizPortal.Order.asc(VizPortal.OrderKeys.displayName)];\r\n        AddUsersToGroupDialogCtrl.$inject = [\r\n            '$scope',\r\n            'SiteUsers',\r\n            // Resolved on ui-router state config\r\n            'group',\r\n            'GroupMembershipUpdateActionNotification',\r\n            '$translate',\r\n            'ToasterService',\r\n            'ServerService'\r\n        ];\r\n        return AddUsersToGroupDialogCtrl;\r\n    })();\r\n    VizPortal.AddUsersToGroupDialogCtrl = AddUsersToGroupDialogCtrl;\r\n    VizPortal.Module.instance().controller('AddUsersToGroupDialogCtrl', AddUsersToGroupDialogCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var PollService = (function () {\r\n        function PollService(server, $q, $interval) {\r\n            this.server = server;\r\n            this.$q = $q;\r\n            this.$interval = $interval;\r\n        }\r\n        /**\r\n         * Poll the request until isComplete callback returns true.\r\n         *\r\n         * Clients of poll() are responsible for calling poller.cancel() to prevent zombie polls\r\n         * from hanging around. For example, if called directly from a controller the poller\r\n         * should be canceled on $scope destruction:\r\n         *\r\n         *     $scope.$on('$destroy', () => {\r\n         *       poller.cancel()\r\n         *     });\r\n         */\r\n        PollService.prototype.poll = function (request, isComplete, customPollPeriod) {\r\n            var _this = this;\r\n            var deferred = this.$q.defer();\r\n            var pollFulfilledFn = function (result) {\r\n                if (isComplete(result)) {\r\n                    deferred.resolve(result);\r\n                }\r\n                else {\r\n                    deferred.notify(result);\r\n                    pollPeriod = (customPollPeriod) ? customPollPeriod : Math.min(PollService.PollPeriodMultiplier * pollPeriod, PollService.MaxPollPeriodMS);\r\n                    timeoutPromise = _this.$interval(poll, pollPeriod, 1);\r\n                }\r\n            };\r\n            var pollRejectedFn = function (reason) {\r\n                deferred.reject(reason);\r\n            };\r\n            var poll = function () {\r\n                _this.server.sendRequest(request).then(pollFulfilledFn, pollRejectedFn);\r\n            };\r\n            var pollPeriod = PollService.InitialPollPeriodMS;\r\n            var timeoutPromise = this.$interval(poll, pollPeriod, 1);\r\n            return {\r\n                promise: deferred.promise,\r\n                cancel: function () {\r\n                    deferred.reject(VizPortal.ErrorReason.Canceled);\r\n                    _this.$interval.cancel(timeoutPromise);\r\n                }\r\n            };\r\n        };\r\n        PollService.$inject = ['ServerService', '$q', '$interval'];\r\n        PollService.MaxPollPeriodMS = 3000;\r\n        PollService.InitialPollPeriodMS = 300;\r\n        PollService.PollPeriodMultiplier = 1.3;\r\n        return PollService;\r\n    })();\r\n    VizPortal.PollService = PollService;\r\n    VizPortal.Module.instance().service('PollService', PollService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetUserAlertCountRequest = (function (_super) {\r\n            __extends(GetUserAlertCountRequest, _super);\r\n            function GetUserAlertCountRequest(params) {\r\n                if (params === void 0) { params = {}; }\r\n                _super.call(this, 'getUserAlertCount', params);\r\n            }\r\n            return GetUserAlertCountRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetUserAlertCountRequest = GetUserAlertCountRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../models/IAlertInfo.ts\" />\r\n/// <reference path=\"../models/IViewInfo.ts\" />\r\n/// <reference path=\"../resources/Alerts.ts\" />\r\n/// <reference path=\"../resources/Datasources.ts\" />\r\n/// <reference path=\"../resources/ExtractTasks.ts\" />\r\n/// <reference path=\"../resources/Workbooks.ts\" />\r\n/// <reference path=\"../services/PollService.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetUserAlertListRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetUserAlertCountRequest.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var AlertMenuCtrl = (function () {\r\n        function AlertMenuCtrl($scope, $translate, alerts, datasources, extractTasks, pollService, workbooks, server) {\r\n            $scope.totalAlerts = 0;\r\n            var pollFunction = function (result) {\r\n                $scope.totalAlerts = result.totalCount;\r\n                return false;\r\n            };\r\n            var poll = pollService.poll(new VizPortal.ServerApi.GetUserAlertCountRequest(), pollFunction, AlertMenuCtrl.POLL_DURATION);\r\n            $scope.getAlertList = function () { return alerts.getList().then(function (alertList) {\r\n                // Alert list is set\r\n                var count = alertList.total;\r\n                $scope.alertList = alertList.alerts;\r\n                $scope.totalAlerts = count;\r\n                // Since data is not sliceable this determines the count at the bottom of the alert list.\r\n                // The number indicates all unshown alerts\r\n                $scope.showRemainingAlerts = $translate.instant('moreAlerts', {\r\n                    ITEM: (count - $scope.alertList.length)\r\n                }, VizPortal.L10n.Interpolations.Count);\r\n            }); };\r\n            $scope.$on('$destroy', function () {\r\n                poll.cancel();\r\n            });\r\n            // These methods on the scope are duplicates of those in tbAlertInfo.ts.\r\n            // TODO: Remove this duplication.\r\n            // Simple formatting so the number of effected workbooks shown in the list of\r\n            // alerts does not get too long\r\n            $scope.workbooksAffectedString = function (workbookList) {\r\n                if (workbookList) {\r\n                    var length = workbookList.length;\r\n                    if (length === 1) {\r\n                        return $translate.instant('outOfDateWithName', {\r\n                            NAME: VizPortal.L10n.elideIfLong(workbookList[0].name)\r\n                        });\r\n                    }\r\n                    else if (length > 1) {\r\n                        return $translate.instant('outOfDateWorkbooksWithCount', {\r\n                            LIST_COUNT: length\r\n                        }, VizPortal.L10n.Interpolations.Count);\r\n                    }\r\n                }\r\n                return $translate.instant('outOfDateWorkbookNone');\r\n            };\r\n            $scope.tryAgainClick = function (alert, index) {\r\n                $scope.alertList.splice(index, 1);\r\n                $scope.totalAlerts--;\r\n                var taskId = alert.taskId;\r\n                var extractType = alert.alertType; // either 'IncrementExtract' or 'RefreshExtract'.\r\n                if (taskId) {\r\n                    // run extract task by ID\r\n                    extractTasks.run([taskId]).then(function () { return $scope.getAlertList(); });\r\n                }\r\n                else if (extractType) {\r\n                    // if we don't have a task ID,\r\n                    // we may need to run a datasource or workbook refresh by the item ID & refresh type.\r\n                    // if datasourceId is present, the alert item is a datasource.\r\n                    // if datasourceId is not present, the alert item is a workbook with ID affectedWorkbookIds[0].\r\n                    var datasourceId = alert.datasource && alert.datasource.id;\r\n                    var workbookId = alert.workbooks && alert.workbooks[0] && alert.workbooks[0].id;\r\n                    if (datasourceId) {\r\n                        // refresh datasource\r\n                        datasources.refreshExtracts([datasourceId], extractType).then(function () { return $scope.getAlertList(); });\r\n                    }\r\n                    else if (workbookId) {\r\n                        // refresh workbook\r\n                        workbooks.refreshExtracts([workbookId], extractType).then(function () { return $scope.getAlertList(); });\r\n                    }\r\n                }\r\n            };\r\n            // Maps to the string version of the error code\r\n            $scope.getFailureType = function (alert) {\r\n                var translated = \"\";\r\n                switch (alert.statusCode) {\r\n                    case VizPortal.AlertErrorCode.AlertSignInFailed:\r\n                    case VizPortal.AlertErrorCode.AlertRemoteSignInFailed:\r\n                        translated = $translate.instant('signInFailedUnknownReason');\r\n                        break;\r\n                    case VizPortal.AlertErrorCode.AlertExpiredPassword:\r\n                    case VizPortal.AlertErrorCode.AlertRemoteExpiredPassword:\r\n                        translated = $translate.instant('expiredPassword');\r\n                        break;\r\n                    case VizPortal.AlertErrorCode.AlertAccessTokenValidation:\r\n                        translated = $translate.instant('accessTokenValidation');\r\n                        break;\r\n                    case VizPortal.AlertErrorCode.AlertAuthConfiguration:\r\n                        translated = $translate.instant('authConfiguration');\r\n                        break;\r\n                    case VizPortal.AlertErrorCode.AlertConnectionFailure:\r\n                    case VizPortal.AlertErrorCode.AlertRemoteConnectionFailure:\r\n                        translated = $translate.instant('connectionFailure');\r\n                        break;\r\n                    case VizPortal.AlertErrorCode.AlertOverlappingSchedules:\r\n                        translated = $translate.instant('overlappingSchedules');\r\n                        break;\r\n                    case VizPortal.AlertErrorCode.AlertFullRefreshRequired:\r\n                        translated = $translate.instant('fullRefreshRequired');\r\n                        break;\r\n                    case VizPortal.AlertErrorCode.AlertConnectionlessFailure:\r\n                        translated = $translate.instant('connectionlessFailure');\r\n                        break;\r\n                    default:\r\n                        // AlertErrorCode.AlertUnknownFailure or AlertErrorCode.AlertRemoteUnknownFailure\r\n                        translated = $translate.instant('unknownFailure');\r\n                }\r\n                if (alert.suspended || server.isAlertFailureCountEnabled()) {\r\n                    return $translate.instant('failureNote', { COUNT: alert.consecutiveFailureCount }, VizPortal.L10n.Interpolations.Count) + translated;\r\n                }\r\n                else {\r\n                    return translated;\r\n                }\r\n            };\r\n            // One type of alert cannot be fixed by editing a data connection. Therefore the edit connection\r\n            // feature is disabled for this one\r\n            $scope.editableFailure = function (statusCode) {\r\n                return statusCode !== VizPortal.AlertErrorCode.AlertOverlappingSchedules;\r\n            };\r\n            $scope.isRemoteRefresh = function (statusCode) {\r\n                return _.contains(AlertMenuCtrl.REMOTE_REFRESH_STATUS_CODES, statusCode);\r\n            };\r\n            $scope.hasSuspended = function (alertList) {\r\n                if (alertList) {\r\n                    for (var i = 0, l = alertList.length; i < l; i++) {\r\n                        if (alertList[i].suspended) {\r\n                            return true;\r\n                        }\r\n                    }\r\n                    return false;\r\n                }\r\n            };\r\n        }\r\n        AlertMenuCtrl.POLL_DURATION = 150000;\r\n        AlertMenuCtrl.REMOTE_REFRESH_STATUS_CODES = [\r\n            VizPortal.AlertErrorCode.AlertRemoteUnknownFailure,\r\n            VizPortal.AlertErrorCode.AlertRemoteSignInFailed,\r\n            VizPortal.AlertErrorCode.AlertRemoteExpiredPassword,\r\n            VizPortal.AlertErrorCode.AlertRemoteConnectionFailure,\r\n        ];\r\n        AlertMenuCtrl.$inject = [\r\n            '$scope',\r\n            '$translate',\r\n            'Alerts',\r\n            'DataSources',\r\n            'ExtractTasks',\r\n            'PollService',\r\n            'Workbooks',\r\n            'ServerService'\r\n        ];\r\n        return AlertMenuCtrl;\r\n    })();\r\n    VizPortal.AlertMenuCtrl = AlertMenuCtrl;\r\n    VizPortal.Module.instance().controller('AlertMenuCtrl', AlertMenuCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../models/IVizPortalCookies.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    // TODO: 'preview' is probably more accurate than 'validate'\r\n    VizPortal.uploadCsvAction = {\r\n        importFile: 'import',\r\n        validateFile: 'validate'\r\n    };\r\n    VizPortal.Module.instance().directive('tbBulkImportUsersForm', [\r\n        '$cookies',\r\n        '$q',\r\n        '$timeout',\r\n        'LongRunningActionService',\r\n        'ServerService',\r\n        function ($cookies, $q, $timeout, longRunningActionService, server) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'bulkImportUsersForm.html',\r\n                scope: {\r\n                    endpoint: '=',\r\n                    formControls: '=?'\r\n                },\r\n                link: function (scope, form, attr) {\r\n                    var requestInProgress = false;\r\n                    // Get the XSRF-TOKEN which is sent to the server in a hidden input element.\r\n                    // This should be the only place we need to do this.\r\n                    // If this in needed elsewhere, move this logic to a common place.\r\n                    scope.xsrfToken = $cookies[VizPortal.CookieKeys.XsrfToken];\r\n                    scope.authenticationSelector = {\r\n                        visible: server.isThirdPartyAuthEnabled(),\r\n                        selectionValue: server.isThirdPartyAuthEnabled() // even if the form is not visible,\r\n                    };\r\n                    var deferred;\r\n                    scope.formControls = {\r\n                        canSubmitForm: function () { return scope.bulkImportForm.$valid && !requestInProgress; },\r\n                        submitFormForAction: function (action) {\r\n                            scope.action = action;\r\n                            deferred = $q.defer();\r\n                            submit();\r\n                            return deferred.promise;\r\n                        }\r\n                    };\r\n                    scope.handleFormSubmitResult = function (result) {\r\n                        // the initial form submit result gives us an actionId that we use to poll for the real import results\r\n                        // we don't resolve the promise until we get import results or failure from the completed action.\r\n                        if (result.actionId) {\r\n                            var progressTracker = longRunningActionService.trackProgress(result.actionId);\r\n                            progressTracker.promise.then(importComplete, importFailed, notifyProgress);\r\n                        }\r\n                        else {\r\n                            importFailed(VizPortal.ErrorReason.Unknown);\r\n                        }\r\n                    };\r\n                    var importComplete = function (result) {\r\n                        if (result && result.succeeded === false) {\r\n                            importFailed(VizPortal.ErrorReason.Unknown);\r\n                        }\r\n                        else {\r\n                            // Add a delay to allow solr to index\r\n                            $timeout(function () {\r\n                                requestInProgress = false;\r\n                                deferred.resolve(result);\r\n                            }, VizPortal.ErrorNotifyingServer.ResponseDelay);\r\n                        }\r\n                    };\r\n                    var importFailed = function (reason) {\r\n                        requestInProgress = false;\r\n                        deferred.reject(reason);\r\n                    };\r\n                    var notifyProgress = function (action) {\r\n                        deferred.notify(action);\r\n                    };\r\n                    var submit = function () {\r\n                        requestInProgress = true;\r\n                        // Do the submit after a timeout so that $digest has time to run and\r\n                        // update the value of the action on the form\r\n                        $timeout(function () { return form.submit(); });\r\n                    };\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../directives/tbBulkImportUsersForm.ts\" />\r\n/// <reference path=\"../models/ILongRunningAction.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/AddUsersOptionsAction.ts\" />\r\n/// <reference path=\"../services/HelpService.ts\" />\r\n/// <reference path=\"../services/ModalService.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\n/// <reference path=\"../services/ToasterService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    (function (BulkImportUsersDialogState) {\r\n        BulkImportUsersDialogState[BulkImportUsersDialogState[\"SelectFile\"] = 0] = \"SelectFile\";\r\n        BulkImportUsersDialogState[BulkImportUsersDialogState[\"ImportInProgress\"] = 1] = \"ImportInProgress\";\r\n        BulkImportUsersDialogState[BulkImportUsersDialogState[\"PreviewComplete\"] = 2] = \"PreviewComplete\";\r\n        BulkImportUsersDialogState[BulkImportUsersDialogState[\"ImportComplete\"] = 3] = \"ImportComplete\";\r\n    })(VizPortal.BulkImportUsersDialogState || (VizPortal.BulkImportUsersDialogState = {}));\r\n    var BulkImportUsersDialogState = VizPortal.BulkImportUsersDialogState;\r\n    var BulkImportUsersDialogCtrl = (function () {\r\n        function BulkImportUsersDialogCtrl($scope, $translate, apiPrefix, method, // BulkImportUsersDialogCtrl.Method\r\n            HelpService, toaster) {\r\n            var _this = this;\r\n            this.$scope = $scope;\r\n            this.$translate = $translate;\r\n            this.toaster = toaster;\r\n            $scope.form = { controls: null };\r\n            $scope.currentState = BulkImportUsersDialogState.SelectFile;\r\n            $scope.dialogState = BulkImportUsersDialogState;\r\n            // This is the url that the form is submitted to\r\n            $scope.endpoint = apiPrefix + method;\r\n            $scope.importFile = function () {\r\n                $scope.currentState = BulkImportUsersDialogState.ImportInProgress;\r\n                $scope.percentComplete = 0;\r\n                $scope.form.controls.submitFormForAction(VizPortal.uploadCsvAction.importFile)\r\n                    .then(importComplete, importFailed, notifyProgress);\r\n            };\r\n            // TODO: validate is off until server support is done.\r\n            //       this should set the dialog state to PreviewComplete instead of ImportComplete\r\n            $scope.validateFile = function () {\r\n                $scope.form.controls.submitFormForAction(VizPortal.uploadCsvAction.validateFile)\r\n                    .then(importComplete, importFailed, notifyProgress);\r\n            };\r\n            $scope.canSubmitForm = function () {\r\n                return $scope.form.controls && $scope.form.controls.canSubmitForm();\r\n            };\r\n            $scope.closeButtonText = function () {\r\n                return $scope.currentState === BulkImportUsersDialogState.ImportComplete\r\n                    ? 'done'\r\n                    : 'cancel';\r\n            };\r\n            // TODO This token should be in a common contextual help data structure in HelpService\r\n            $scope.csvHelpHref = HelpService.getServerHelpUrlByCategory('adminusers2');\r\n            var notifyProgress = function (action) {\r\n                _this.$scope.percentComplete = action.percentComplete;\r\n            };\r\n            var importFailed = function (reason) {\r\n                _this.$scope.close({});\r\n                _this.toaster.pop({ type: VizPortal.ToastType.Error, text: _this.$translate.instant('addUsersFailed') });\r\n            };\r\n            var importComplete = function (longRunningAction) {\r\n                $scope.currentState = BulkImportUsersDialogState.ImportComplete;\r\n                _this.$scope.percentComplete = longRunningAction.percentComplete;\r\n                _this.$scope.importResults = longRunningAction.response;\r\n                _this.$scope.$emit(VizPortal.UserAddedEvent);\r\n            };\r\n        }\r\n        BulkImportUsersDialogCtrl.Method = {\r\n            ImportUsersFromCsv: 'importUsersFromCsv',\r\n            ImportServerUsersFromCsv: 'importServerUsersFromCsv'\r\n        };\r\n        BulkImportUsersDialogCtrl.$inject = [\r\n            '$scope',\r\n            '$translate',\r\n            'RestApiPrefix',\r\n            'method',\r\n            'HelpService',\r\n            'ToasterService'\r\n        ];\r\n        return BulkImportUsersDialogCtrl;\r\n    })();\r\n    VizPortal.BulkImportUsersDialogCtrl = BulkImportUsersDialogCtrl;\r\n    VizPortal.Module.instance().controller('BulkImportUsersDialogCtrl', BulkImportUsersDialogCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../controllers/ContentSubplaceCtrl.ts\" />\r\n/// <reference path=\"../models/ITemplate.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/types/resourceParts.ts\" />\r\n/// <reference path=\"../services/SelectionService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ContentGridCtrl = (function () {\r\n        function ContentGridCtrl($scope, SelectionService) {\r\n            // Sorting\r\n            $scope.headerClicked = function (header) { return $scope.sorter.setPrimary(header.attrs['key'], header.attrs['direction']); };\r\n            // Row selection\r\n            $scope.rowClicked = function (row, colIndex) {\r\n                if ($scope.anyActionsAllowed()) {\r\n                    SelectionService.rowClicked($scope.selectedItems, row, colIndex);\r\n                }\r\n            };\r\n        }\r\n        ContentGridCtrl.$inject = [\r\n            '$scope',\r\n            'SelectionService'\r\n        ];\r\n        return ContentGridCtrl;\r\n    })();\r\n    VizPortal.ContentGridCtrl = ContentGridCtrl;\r\n    VizPortal.Module.instance().controller('ContentGridCtrl', ContentGridCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    /**\r\n     * Popover directive\r\n     *\r\n     * Adds overlays of content to any element for housing secondary information.\r\n     * (very similar to Bootstrap's Popover)\r\n     *\r\n     * Usage:\r\n     *\r\n     *  div(tb-popover=\"'popoverTemplate.html'\")\r\n     *\r\n     * An optional 'tb-popover-class' attribute can be used to specify a class to apply to\r\n     * the popover container.\r\n     *\r\n     * The overlay's scope will inherit from the target element's scope.\r\n     * Also, a 'visible' boolean property is available on the overlay's scope. This\r\n     * is useful for lazy-loading the overlay content e.g. see ContentItemPopoverCtrl.ts.\r\n     *\r\n     */\r\n    VizPortal.Module.instance().directive('tbPopover', [\r\n        '$window',\r\n        '$compile',\r\n        '$timeout',\r\n        '$parse',\r\n        'StackedElementsService',\r\n        function ($window, $compile, $timeout, $parse, StackedElementsService) {\r\n            return {\r\n                restrict: 'A',\r\n                link: function (scope, element, attributes) {\r\n                    var DisplayPopoverDelay = 350; // milliseconds\r\n                    var RemovePopoverDelay = 50; // milliseconds\r\n                    var PreferOpenLeft = false;\r\n                    var templateUrl = attributes['tbPopover'];\r\n                    var popover;\r\n                    var popoverStackedElement;\r\n                    var displayPopoverTimeout;\r\n                    var removePopoverTimeout;\r\n                    if ($parse(attributes['tbPopoverSuppress'])(scope)) {\r\n                        return;\r\n                    }\r\n                    // Create and compile the popover\r\n                    popover = $('<div>').addClass('tb-padded-wide')\r\n                        .append($('<div tb-arrow=\"arrow\">').addClass('tb-popover')\r\n                        .append($('<div>').attr('ng-include', templateUrl)));\r\n                    if (attributes['tbPopoverClass']) {\r\n                        popover.addClass(attributes['tbPopoverClass']);\r\n                    }\r\n                    if (attributes['tbPopoverDelay']) {\r\n                        DisplayPopoverDelay = parseInt(attributes['tbPopoverDelay'], 10);\r\n                    }\r\n                    if (attributes['tbPopoverPreferOpenLeft']) {\r\n                        PreferOpenLeft = true;\r\n                    }\r\n                    if (attributes['tbPopoverHide']) {\r\n                        scope.$watch(attributes['tbPopoverHide'], function (hide) {\r\n                            popover.css({ display: hide ? 'none' : 'block' });\r\n                        });\r\n                    }\r\n                    var popoverScope = scope.$new();\r\n                    popoverScope.visible = false;\r\n                    $compile(popover)(popoverScope);\r\n                    var scrollElement = element.parents('.tb-scroll');\r\n                    // Bind mouse events\r\n                    element.on('mouseenter', function () {\r\n                        var buildPopoverStackedElement = function () {\r\n                            popoverStackedElement = StackedElementsService.addStackedElement({\r\n                                contentElement: popover,\r\n                                getContentElementPosition: function () {\r\n                                    var popoverWidth = popover.outerWidth();\r\n                                    var windowWidth = angular.element($window).width();\r\n                                    var elementWidth = element.outerWidth();\r\n                                    var elementOffset = element.offset();\r\n                                    var openLeftLeft = elementOffset.left - popoverWidth;\r\n                                    var openRightLeft = elementOffset.left + elementWidth;\r\n                                    var openRightRight = openRightLeft + popoverWidth;\r\n                                    var openLeft = PreferOpenLeft;\r\n                                    if (openLeft) {\r\n                                        if (openLeftLeft < 0 && openRightRight <= windowWidth) {\r\n                                            openLeft = false;\r\n                                        }\r\n                                    }\r\n                                    else {\r\n                                        if (openRightRight > windowWidth && openLeftLeft >= 0) {\r\n                                            openLeft = true;\r\n                                        }\r\n                                    }\r\n                                    popoverScope.arrow = openLeft ? 'right' : 'left';\r\n                                    // TODO: a more sophisticated positioning function to account for\r\n                                    // top and bottom edges of window.\r\n                                    return { left: openLeft ? openLeftLeft : openRightLeft, top: elementOffset.top };\r\n                                }\r\n                            });\r\n                            popoverScope.visible = true;\r\n                            scrollElement.on('scroll.popover_events', function () {\r\n                                scope.$apply(function () {\r\n                                    removePopover();\r\n                                    buildPopoverStackedElement();\r\n                                });\r\n                            });\r\n                        };\r\n                        displayPopoverTimeout = $timeout(buildPopoverStackedElement, DisplayPopoverDelay);\r\n                        popover\r\n                            .on('mouseenter.popover_events', function () {\r\n                            $timeout.cancel(removePopoverTimeout);\r\n                        })\r\n                            .on('mouseleave.popover_events', function () {\r\n                            scope.$apply(removePopover);\r\n                        });\r\n                    });\r\n                    element.on('mouseleave', function () {\r\n                        scrollElement.off('.popover_events');\r\n                        $timeout.cancel(displayPopoverTimeout);\r\n                        removePopoverTimeout = $timeout(removePopover, RemovePopoverDelay);\r\n                    });\r\n                    function removePopover() {\r\n                        scrollElement.off('.popover_events');\r\n                        if (popoverStackedElement) {\r\n                            StackedElementsService.removeStackedElement(popoverStackedElement);\r\n                            popoverStackedElement = null;\r\n                        }\r\n                        if (popover) {\r\n                            popover.off('.popover_events');\r\n                        }\r\n                        popoverScope.visible = false;\r\n                        popover.remove();\r\n                    }\r\n                    scope.$on('$destroy', function () {\r\n                        popoverScope.$destroy();\r\n                        removePopover();\r\n                        $timeout.cancel(displayPopoverTimeout);\r\n                        $timeout.cancel(removePopoverTimeout);\r\n                    });\r\n                }\r\n            };\r\n        }]);\r\n    VizPortal.Module.instance().directive('tbArrow', function () {\r\n        return {\r\n            restrict: 'A',\r\n            link: function (scope, element, attributes) {\r\n                var popoverArrow = $('<div></div>');\r\n                element.append(popoverArrow);\r\n                scope.$watch(attributes['tbArrow'], function (arrow) {\r\n                    popoverArrow.removeClass();\r\n                    if (arrow === 'right') {\r\n                        popoverArrow.addClass('tb-modal-arrow-right');\r\n                    }\r\n                    else {\r\n                        popoverArrow.addClass('tb-modal-arrow-left');\r\n                    }\r\n                });\r\n            }\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../controllers/ContentSubplaceCtrl.ts\" />\r\n/// <reference path=\"../directives/tbPopover.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ContentItemPopoverCtrl = (function () {\r\n        function ContentItemPopoverCtrl($scope, $location, $translate) {\r\n            $scope.$location = $location;\r\n            var visibleWatch = $scope.$watch('visible', function (visible) {\r\n                if (visible) {\r\n                    $scope.getItemDetails($scope.item).then(function (itemDetails) {\r\n                        $scope.itemDetails = itemDetails;\r\n                        if (VizPortal.FeatureFlags.contentAnalyticsEnabled) {\r\n                            if ($scope.contentType !== VizPortal.ViewContentType.name) {\r\n                                $scope.sparklineWithTitleProps = {\r\n                                    title: $translate.instant('metric_hitsTotal_sparklineTitle', {\r\n                                        COUNT: $scope.item.hitsTotal\r\n                                    }, VizPortal.L10n.Interpolations.Count),\r\n                                    caption: $translate.instant('metric_hitsTotal_sparklineCaption'),\r\n                                    sparklineProps: {\r\n                                        dataPoints: itemDetails.hitsTimeSeries,\r\n                                        width: 274,\r\n                                        height: 66\r\n                                    }\r\n                                };\r\n                            }\r\n                        }\r\n                    });\r\n                    // Deregister the 'visible' watch, since we only want to fetch\r\n                    // the item details once.\r\n                    visibleWatch();\r\n                }\r\n            });\r\n        }\r\n        ContentItemPopoverCtrl.$inject = ['$scope', '$location', '$translate'];\r\n        return ContentItemPopoverCtrl;\r\n    })();\r\n    VizPortal.ContentItemPopoverCtrl = ContentItemPopoverCtrl;\r\n    VizPortal.Module.instance().controller('ContentItemPopoverCtrl', ContentItemPopoverCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../fetchers/ListResult.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../models/ColumnWidths.ts\" />\r\n/// <reference path=\"../models/ISliceable.ts\" />\r\n/// <reference path=\"../models/ITemplate.ts\" />\r\n/// <reference path=\"../services/SliceableFactory.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DataGridCtrl = (function () {\r\n        function DataGridCtrl($scope, $element, SliceableFactory) {\r\n            if (!$scope.columnWidths) {\r\n                $scope.columnWidths = new VizPortal.ColumnWidths();\r\n            }\r\n            $scope.scrollLeftChanged = function (scrollLeft) {\r\n                $element.find('.tb-data-grid-headers').css({ 'margin-left': -scrollLeft + 'px' });\r\n            };\r\n        }\r\n        DataGridCtrl.$inject = ['$scope', '$element', 'SliceableFactory'];\r\n        return DataGridCtrl;\r\n    })();\r\n    VizPortal.DataGridCtrl = DataGridCtrl;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../controllers/FilterPanelCtrl.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DateFilterCtrl = (function () {\r\n        function DateFilterCtrl($scope) {\r\n            $scope.editMode = false;\r\n            $scope.clear = function () {\r\n                $scope.filter.value = null;\r\n            };\r\n            $scope.open = function () {\r\n                $scope.editMode = true;\r\n            };\r\n            $scope.close = function () {\r\n                $scope.editMode = false;\r\n            };\r\n        }\r\n        DateFilterCtrl.$inject = ['$scope'];\r\n        return DateFilterCtrl;\r\n    })();\r\n    VizPortal.DateFilterCtrl = DateFilterCtrl;\r\n    VizPortal.Module.instance().controller('DateFilterCtrl', DateFilterCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/ISliceable.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/ContentActionNotification.ts\" />\r\n/// <reference path=\"../services/ModalService.ts\" />\r\n/// <reference path=\"../services/SliceableFactory.ts\" />\r\n/// <reference path=\"../services/ToasterService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ErrorDetailsToastCtrl = (function () {\r\n        function ErrorDetailsToastCtrl($scope, modal, SliceableFactory) {\r\n            var _this = this;\r\n            this.$scope = $scope;\r\n            this.modal = modal;\r\n            this.SliceableFactory = SliceableFactory;\r\n            $scope.showDetails = function ($event) {\r\n                var notification = $scope.toast.data;\r\n                $scope.errorDetailsSliceable = _this.SliceableFactory.fromArray(notification.errorDetails);\r\n                _this.modal.open({\r\n                    scope: $scope,\r\n                    templateUrl: 'errorDetailsDialog.html',\r\n                    size: VizPortal.ModalSize.fitToContent,\r\n                    position: VizPortal.ModalService.anchoredTo(angular.element($event.target))\r\n                });\r\n            };\r\n        }\r\n        ErrorDetailsToastCtrl.$inject = [\r\n            '$scope',\r\n            'ModalService',\r\n            'SliceableFactory'\r\n        ];\r\n        return ErrorDetailsToastCtrl;\r\n    })();\r\n    VizPortal.ErrorDetailsToastCtrl = ErrorDetailsToastCtrl;\r\n    VizPortal.Module.instance().controller('ErrorDetailsToastCtrl', ErrorDetailsToastCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../resources/Users.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SearchSuggestionsService = (function () {\r\n        function SearchSuggestionsService(SliceableFactory, ProjectNames, UserNames, Groups, Tags, DataConnectionTypes, SiteNamesAcrossAllPods, Favorites, Schedules) {\r\n            this.SliceableFactory = SliceableFactory;\r\n            this.ProjectNames = ProjectNames;\r\n            this.UserNames = UserNames;\r\n            this.Groups = Groups;\r\n            this.Tags = Tags;\r\n            this.DataConnectionTypes = DataConnectionTypes;\r\n            this.SiteNamesAcrossAllPods = SiteNamesAcrossAllPods;\r\n            this.Favorites = Favorites;\r\n            this.Schedules = Schedules;\r\n        }\r\n        SearchSuggestionsService.prototype.projects = function (matchText) {\r\n            return this.ProjectNames.all()\r\n                .withFiltersAndOrder([VizPortal.Filter.search(matchText)], [VizPortal.Order.asc(VizPortal.ServerApi.NamedItemKeys.name)]);\r\n        };\r\n        SearchSuggestionsService.prototype.project = function (id) {\r\n            return this.ProjectNames.getById(id).then(function (projectName) {\r\n                return {\r\n                    value: projectName ? projectName.id : id,\r\n                    label: projectName ? projectName.name : '',\r\n                    count: 0\r\n                };\r\n            });\r\n        };\r\n        SearchSuggestionsService.prototype.sites = function (matchText) {\r\n            return this.SiteNamesAcrossAllPods.all().withFilters([VizPortal.Filter.search(matchText)]);\r\n        };\r\n        SearchSuggestionsService.prototype.favorites = function (matchText) {\r\n            return this.Favorites.all().withFilters([VizPortal.Filter.search(matchText)]);\r\n        };\r\n        SearchSuggestionsService.prototype.users = function (matchText) {\r\n            return this.UserNames.all()\r\n                .withFiltersAndOrder([VizPortal.Filter.search(matchText)], [VizPortal.Order.asc(VizPortal.ServerApi.UserKeys.displayName)]);\r\n        };\r\n        SearchSuggestionsService.prototype.usersWithoutGuest = function (matchText) {\r\n            return this.users(matchText).addFilter(VizPortal.Users.WithoutGuestFilter);\r\n        };\r\n        SearchSuggestionsService.prototype.adminUsers = function (matchText) {\r\n            return this.users(matchText).addFilter(VizPortal.Users.AdminsOnlyFilter);\r\n        };\r\n        SearchSuggestionsService.prototype.user = function (id) {\r\n            return this.UserNames.getById(id).then(function (userName) {\r\n                return {\r\n                    value: userName ? userName.id : id,\r\n                    label: userName ? userName.displayName : '',\r\n                    count: 0\r\n                };\r\n            });\r\n        };\r\n        SearchSuggestionsService.prototype.groups = function (matchText) {\r\n            return this.Groups.all()\r\n                .withFiltersAndOrder([VizPortal.Filter.search(matchText)], [VizPortal.Order.asc(VizPortal.ServerApi.GroupKeys.name)]);\r\n        };\r\n        SearchSuggestionsService.prototype.group = function (id) {\r\n            return this.Groups.getById(id);\r\n        };\r\n        SearchSuggestionsService.prototype.tags = function (matchText) {\r\n            return this.Tags.all()\r\n                .withFiltersAndOrder([VizPortal.Filter.search(matchText)], [VizPortal.Order.asc(VizPortal.ServerApi.NamedItemKeys.name)]);\r\n        };\r\n        SearchSuggestionsService.prototype.dataConnectionType = function (dataConnectionType) {\r\n            return this.DataConnectionTypes.getByDataConnectionType(dataConnectionType).then(function (connectionType) {\r\n                return {\r\n                    value: connectionType ? connectionType.connectionType : dataConnectionType,\r\n                    label: connectionType ? connectionType.connectionTypeDisplayName : '',\r\n                    count: 0\r\n                };\r\n            });\r\n        };\r\n        SearchSuggestionsService.prototype.dataConnectionTypes = function (matchText) {\r\n            return this.DataConnectionTypes.all()\r\n                .withFiltersAndOrder([VizPortal.Filter.search(matchText)], [VizPortal.Order.asc(VizPortal.ServerApi.DataConnectionTypeKeys.connectionTypeDisplayName)]);\r\n        };\r\n        SearchSuggestionsService.prototype.schedulesSource = function (scheduledActionType) {\r\n            var searchFilterFn = function (schedule, search) {\r\n                if (!search)\r\n                    return true;\r\n                var scheduleName = schedule.name.toLowerCase();\r\n                return _.all(search.toLowerCase().split(' '), function (searchPart) { return (scheduleName.indexOf(searchPart) >= 0); });\r\n            };\r\n            var scheduleResourceQuery = this.Schedules.all().withOrder(VizPortal.ScheduleContentType.defaultOrder);\r\n            if (scheduledActionType) {\r\n                scheduleResourceQuery = scheduleResourceQuery.addFilter(VizPortal.Schedules.filterByActionType(scheduledActionType));\r\n            }\r\n            var scheduleListPromise = VizPortal.SliceableHelper.fetchAll(scheduleResourceQuery).then(function (schedulesList) { return schedulesList.items; });\r\n            return this.SliceableFactory.searchArray(searchFilterFn, scheduleListPromise);\r\n        };\r\n        SearchSuggestionsService.$inject = ['SliceableFactory', 'ProjectNames', 'UserNames', 'Groups', 'Tags', 'DataConnectionTypes', 'SiteNamesAcrossAllPods', 'Favorites', 'Schedules'];\r\n        return SearchSuggestionsService;\r\n    })();\r\n    VizPortal.SearchSuggestionsService = SearchSuggestionsService;\r\n    VizPortal.Module.instance().service('SearchSuggestionsService', SearchSuggestionsService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\n/// <reference path=\"../models/ISliceable.ts\" />\r\n/// <reference path=\"../models/IViewInfo.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../resources/Favorites.ts\" />\r\n/// <reference path=\"../resources/Views.ts\" />\r\n/// <reference path=\"../resources/Workbooks.ts\" />\r\n/// <reference path=\"../services/SearchSuggestionsService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var FavoritesMenuCtrl = (function () {\r\n        function FavoritesMenuCtrl($scope, $state, favorites, views, workbooks, searchSuggestions) {\r\n            var _this = this;\r\n            this.$state = $state;\r\n            this.favorites = favorites;\r\n            $scope.filteringList = { chosenFavorite: null };\r\n            $scope.getFavorites = function (query) { return searchSuggestions.favorites(query); };\r\n            $scope.goToFavorite = function () {\r\n                var id = $scope.filteringList.chosenFavorite.objectId;\r\n                var type = $scope.filteringList.chosenFavorite.objectType;\r\n                if (type === VizPortal.FavoriteObjectType.VIEW) {\r\n                    views.getById(id).then(function (result) { return _this.$state.go('main.site.viz', { path: result.path }); }, function (reason) { return _this.handleGoToDeletedFavorite(id, reason); });\r\n                }\r\n                else if (type === VizPortal.FavoriteObjectType.WORKBOOK) {\r\n                    workbooks.getById(id).then(function () { return _this.$state.go('main.site.content.workbook.views', { id: id }); }, function (reason) { return _this.handleGoToDeletedFavorite(id, reason); });\r\n                }\r\n            };\r\n        }\r\n        FavoritesMenuCtrl.prototype.handleGoToDeletedFavorite = function (id, reason) {\r\n            var _this = this;\r\n            if (reason === VizPortal.CommonErrorCode.ViewNotFound) {\r\n                this.favorites.removeViewById(id)\r\n                    .then(function () { return _this.$state.go('main.error', { detailsLocKey: 'favoriteViewCouldNotBeFound' }); });\r\n            }\r\n            else if (reason === VizPortal.CommonErrorCode.WorkbookNotFound) {\r\n                this.favorites.removeWorkbookById(id)\r\n                    .then(function () { return _this.$state.go('main.error', { detailsLocKey: 'favoriteWorkbookCouldNotBeFound' }); });\r\n            }\r\n            else {\r\n                this.$state.go('main.error');\r\n            }\r\n        };\r\n        FavoritesMenuCtrl.$inject = [\r\n            '$scope',\r\n            '$state',\r\n            'Favorites',\r\n            'Views',\r\n            'Workbooks',\r\n            'SearchSuggestionsService'\r\n        ];\r\n        return FavoritesMenuCtrl;\r\n    })();\r\n    VizPortal.FavoritesMenuCtrl = FavoritesMenuCtrl;\r\n    VizPortal.Module.instance().controller('FavoritesMenuCtrl', FavoritesMenuCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../../ts/libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var FocusCtrl = (function () {\r\n        function FocusCtrl() {\r\n        }\r\n        FocusCtrl.prototype.setFocusElement = function (elm) {\r\n            this.$element = elm;\r\n        };\r\n        FocusCtrl.prototype.focus = function () {\r\n            this.$element.focus();\r\n        };\r\n        FocusCtrl.prototype.hasFocusElement = function () {\r\n            return !!this.$element;\r\n        };\r\n        return FocusCtrl;\r\n    })();\r\n    VizPortal.FocusCtrl = FocusCtrl;\r\n    VizPortal.Module.instance().controller('FocusCtrl', FocusCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var HelpActions = (function () {\r\n        function HelpActions(help, server, $scope, gettingStartedNotifications, modalService) {\r\n            this.help = help;\r\n            this.server = server;\r\n            this.$scope = $scope;\r\n            this.gettingStartedNotifications = gettingStartedNotifications;\r\n            this.modalService = modalService;\r\n        }\r\n        HelpActions.prototype.showAbout = function () {\r\n            var _this = this;\r\n            var aboutScope = this.$scope.$new();\r\n            aboutScope.version = this.server.sessionServerVersion();\r\n            aboutScope.serverName = function () { return _this.server.serverName(); };\r\n            this.modalService.open({\r\n                templateUrl: 'aboutServer.html',\r\n                scope: aboutScope\r\n            }).result.fin(function () { return aboutScope.$destroy(); });\r\n        };\r\n        HelpActions.prototype.showGettingStarted = function () {\r\n            this.gettingStartedNotifications.forceShowNotifications();\r\n        };\r\n        HelpActions.prototype.searchHelp = function (searchTerm) {\r\n            this.help.search(searchTerm);\r\n        };\r\n        return HelpActions;\r\n    })();\r\n    VizPortalReact.HelpActions = HelpActions;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../../common/react/HelpActions.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/GettingStartedNotifications.ts\" />\r\n/// <reference path=\"../services/HelpService.ts\" />\r\n/// <reference path=\"../services/ModalService.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var HelpMenuCtrl = (function () {\r\n        function HelpMenuCtrl($scope, server, modalService, help, gettingStartedNotifications) {\r\n            var helpActions = new VizPortalReact.HelpActions(help, server, $scope, gettingStartedNotifications, modalService);\r\n            $scope.showAbout = function () { return helpActions.showAbout(); };\r\n            $scope.launchGettingStarted = function () { return helpActions.showGettingStarted(); };\r\n            $scope.searchHelp = function () { return helpActions.searchHelp($scope.searchForm.searchText); };\r\n            $scope.isOfflineHelpEnabled = server.offlineHelpEnabled();\r\n            $scope.searchForm = { searchText: '' };\r\n            $scope.supportUrl = function () { return help.getGeneralSupportUrl(); };\r\n            $scope.serverHelpUrl = help.getServerHelpUrlByCategory();\r\n            $scope.helpLocKey = help.getHelpLinkLocKey();\r\n            $scope.reset = function () { return $scope.searchForm.searchText = ''; };\r\n            $scope.serverName = function () { return server.serverName(); };\r\n            // Update show/hide Getting Started menu item when user's admin status changes (e.g., site switch)\r\n            $scope.$watch(function () { return server.isSessionSiteOrServerAdmin(); }, function () {\r\n                // $watch listener fn will always run (async) when first registered\r\n                gettingStartedNotifications.shouldShowGettingStartedLink()\r\n                    .then(function (showLink) { return $scope.showGettingStartedLink = showLink; });\r\n            });\r\n        }\r\n        HelpMenuCtrl.$inject = [\r\n            '$scope',\r\n            'ServerService',\r\n            'ModalService',\r\n            'HelpService',\r\n            'GettingStartedNotifications'\r\n        ];\r\n        return HelpMenuCtrl;\r\n    })();\r\n    VizPortal.HelpMenuCtrl = HelpMenuCtrl;\r\n    VizPortal.Module.instance().controller('HelpMenuCtrl', HelpMenuCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/ILayout.ts\" />\r\n/// <reference path=\"../models/ISize.ts\" />\r\n/// <reference path=\"../models/ISliceable.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ScrollCtrl = (function () {\r\n        function ScrollCtrl($scope, $element, $q, $transclude) {\r\n            var _this = this;\r\n            this.scope = $scope;\r\n            this.viewport = $element;\r\n            this.$q = $q;\r\n            this.currentPage = 0;\r\n            this.currentItemsPerPage = 0;\r\n            this.currentTotal = 0;\r\n            $scope.scroller = this;\r\n            $scope.transcludeFn = $transclude;\r\n            $scope.slice = VizPortal.ListResult.empty();\r\n            $scope.scrollControls = {\r\n                scrollIntoView: function (itemIndex) {\r\n                    // TODO: make this work for thumbnail view\r\n                    var firstVisibleIndex = Math.ceil(_this.viewport.scrollTop() / _this.metrics.heightOfRowInPx);\r\n                    var lastVisibleIndex = Math.floor((_this.viewport.scrollTop() + _this.viewport.height()) / _this.metrics.heightOfRowInPx) - 1;\r\n                    var numberOfVisibleItems = lastVisibleIndex - firstVisibleIndex + 1;\r\n                    if (itemIndex > lastVisibleIndex) {\r\n                        _this.viewport.scrollTop((itemIndex - numberOfVisibleItems + 1) * _this.metrics.heightOfRowInPx);\r\n                    }\r\n                    else if (itemIndex < firstVisibleIndex) {\r\n                        _this.viewport.scrollTop(itemIndex * _this.metrics.heightOfRowInPx);\r\n                    }\r\n                },\r\n                setScrollLeft: function (scrollLeft) {\r\n                    _this.viewport.scrollLeft(scrollLeft);\r\n                },\r\n                getScrollLeft: function () {\r\n                    return _this.viewport.scrollLeft();\r\n                }\r\n            };\r\n            var currentScrollLeft = 0;\r\n            var updateScrollLeft = function () {\r\n                var newScrollLeft = _this.viewport.scrollLeft();\r\n                if (newScrollLeft !== currentScrollLeft) {\r\n                    currentScrollLeft = newScrollLeft;\r\n                    $scope.scrollLeftChanged({ scrollLeft: currentScrollLeft });\r\n                }\r\n            };\r\n            $element.on('scroll', function () {\r\n                updateScrollLeft();\r\n                _this.fetchItems();\r\n            });\r\n            // $note-ltan-2014-9-16:\r\n            // Beware, watch does not know anything about the actual data. So even if the actual data changed,\r\n            // but 'items' aka sliceable did not, watch callback won't get triggered and you don't get the update.\r\n            // The trick is to create and assign a new instance of sliceable to the watched reference.\r\n            $scope.$watch('items', function (newItems, oldItems) {\r\n                // Both this watch and the viewport dimensions watch will trigger a fetch on initial load.\r\n                // To avoid two fetches, we only trigger this one on subsequent changes.\r\n                if (newItems !== oldItems) {\r\n                    _this.onItemsChanged();\r\n                }\r\n            });\r\n            $scope.getViewportDimensions = function () { return _this.getViewportDimensions(); };\r\n            $scope.$watch($scope.getViewportDimensions, function (dimensions) {\r\n                _this.resize(dimensions);\r\n            }, true);\r\n        }\r\n        ScrollCtrl.prototype.fetchItems = function () {\r\n            if (!this.metrics)\r\n                return;\r\n            if (this.viewport.scrollTop() < 0)\r\n                return; // Handle iOS momentum scrolling beyond the top of container\r\n            var pageHeight = ScrollCtrl.pageHeightInPx(this.metrics);\r\n            if (pageHeight > 0) {\r\n                var request = {\r\n                    page: Math.floor(this.viewport.scrollTop() / pageHeight),\r\n                    itemsPerPage: ScrollCtrl.itemsPerPage(this.metrics)\r\n                };\r\n                if ((request.page !== this.currentPage || request.itemsPerPage !== this.currentItemsPerPage)\r\n                    && !this.isInProgress(request)) {\r\n                    this.getSlice(request);\r\n                }\r\n            }\r\n        };\r\n        ScrollCtrl.prototype.onItemsChanged = function () {\r\n            var _this = this;\r\n            if (!this.metrics && !this.updateLayoutMetrics())\r\n                return;\r\n            var request = {\r\n                page: 0,\r\n                itemsPerPage: ScrollCtrl.itemsPerPage(this.metrics)\r\n            };\r\n            this.getSlice(request).then(function (result) {\r\n                if (result) {\r\n                    // Scroll to the top because we are displaying a new set of results.\r\n                    _this.viewport.scrollTop(0);\r\n                    _this.scope.$emit(ScrollCtrl.ItemsChangeEvent);\r\n                }\r\n            });\r\n        };\r\n        ScrollCtrl.prototype.resize = function (dimensions) {\r\n            // Don't bother to fetch anything if it won't be visible.\r\n            // (This can happen on initial load.)\r\n            if (dimensions.width === 0 || dimensions.height === 0)\r\n                return;\r\n            this.metrics = this.getLayoutMetrics(dimensions);\r\n            this.fetchItems();\r\n        };\r\n        ScrollCtrl.prototype.contentAreaHeight = function () {\r\n            if (!this.metrics)\r\n                return 0;\r\n            return this.totalNumberOfRows(this.metrics) * this.metrics.heightOfRowInPx;\r\n        };\r\n        ScrollCtrl.prototype.contentTop = function () {\r\n            if (!this.metrics)\r\n                return 0;\r\n            return this.currentPage * ScrollCtrl.pageHeightInPx(this.metrics);\r\n        };\r\n        ScrollCtrl.prototype.getSlice = function (request) {\r\n            var _this = this;\r\n            if (this.scope.items) {\r\n                this.mostRecentInProgressRequest = request;\r\n                // get two pages worth of items\r\n                return this.scope.items.getSlice(request.page * request.itemsPerPage, request.itemsPerPage * 2).then(function (result) {\r\n                    if (request === _this.mostRecentInProgressRequest) {\r\n                        _this.mostRecentInProgressRequest = null;\r\n                        _this.currentPage = request.page;\r\n                        _this.currentItemsPerPage = request.itemsPerPage;\r\n                        _this.currentTotal = result.total;\r\n                        _this.scope.slice.items = result.items;\r\n                        _this.scope.slice.index = result.index;\r\n                        _this.scope.slice.total = result.total;\r\n                        if (_this.scope.sliceChanged) {\r\n                            _this.scope.sliceChanged({ newSlice: result });\r\n                        }\r\n                        return result;\r\n                    }\r\n                    else {\r\n                        return null;\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                return this.$q.when(null);\r\n            }\r\n        };\r\n        ScrollCtrl.prototype.isInProgress = function (request) {\r\n            return !!this.mostRecentInProgressRequest\r\n                && request.page === this.mostRecentInProgressRequest.page\r\n                && request.itemsPerPage === this.mostRecentInProgressRequest.itemsPerPage;\r\n        };\r\n        ScrollCtrl.prototype.getViewportDimensions = function () {\r\n            return {\r\n                height: this.viewport.height(),\r\n                width: this.contentArea.width()\r\n            };\r\n        };\r\n        ScrollCtrl.prototype.getLayoutMetrics = function (dimensions) {\r\n            if (!this.scope.layout)\r\n                return null;\r\n            return this.scope.layout.metrics(dimensions);\r\n        };\r\n        ScrollCtrl.prototype.updateLayoutMetrics = function () {\r\n            var dimensions = this.getViewportDimensions();\r\n            this.metrics = this.getLayoutMetrics(dimensions);\r\n            return !!this.metrics;\r\n        };\r\n        ScrollCtrl.prototype.totalNumberOfRows = function (metrics) {\r\n            return metrics.numberOfCols > 0 ? Math.ceil(this.currentTotal / metrics.numberOfCols) : 0;\r\n        };\r\n        ScrollCtrl.pageHeightInPx = function (metrics) {\r\n            return metrics.numberOfRows * metrics.heightOfRowInPx;\r\n        };\r\n        ScrollCtrl.itemsPerPage = function (metrics) {\r\n            return metrics.numberOfCols * metrics.numberOfRows;\r\n        };\r\n        ScrollCtrl.ItemsChangeEvent = 'scrollItemsChanged';\r\n        ScrollCtrl.$inject = [\r\n            '$scope', '$element', '$q', '$transclude'\r\n        ];\r\n        return ScrollCtrl;\r\n    })();\r\n    VizPortal.ScrollCtrl = ScrollCtrl;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    (function (Permission) {\r\n        Permission[Permission[\"Unspecified\"] = 0] = \"Unspecified\";\r\n        Permission[Permission[\"Allowed\"] = 1] = \"Allowed\";\r\n        Permission[Permission[\"Denied\"] = 2] = \"Denied\";\r\n        Permission[Permission[\"Mixed\"] = 3] = \"Mixed\";\r\n    })(VizPortal.Permission || (VizPortal.Permission = {}));\r\n    var Permission = VizPortal.Permission;\r\n    // larger reasons take precedence\r\n    (function (PermissionReason) {\r\n        PermissionReason[PermissionReason[\"Unspecified\"] = 0] = \"Unspecified\";\r\n        PermissionReason[PermissionReason[\"ImplicitDeny\"] = 1] = \"ImplicitDeny\";\r\n        PermissionReason[PermissionReason[\"GroupAllow\"] = 2] = \"GroupAllow\";\r\n        PermissionReason[PermissionReason[\"GroupDeny\"] = 3] = \"GroupDeny\";\r\n        PermissionReason[PermissionReason[\"UserAllow\"] = 4] = \"UserAllow\";\r\n        PermissionReason[PermissionReason[\"UserDeny\"] = 5] = \"UserDeny\";\r\n        PermissionReason[PermissionReason[\"UserLicensingDeny\"] = 6] = \"UserLicensingDeny\";\r\n        PermissionReason[PermissionReason[\"GuestAllow\"] = 7] = \"GuestAllow\";\r\n        PermissionReason[PermissionReason[\"UserAuthorizableOwnerAllow\"] = 8] = \"UserAuthorizableOwnerAllow\";\r\n        PermissionReason[PermissionReason[\"GroupProjectLeaderAllow\"] = 9] = \"GroupProjectLeaderAllow\";\r\n        PermissionReason[PermissionReason[\"UserProjectLeaderAllow\"] = 10] = \"UserProjectLeaderAllow\";\r\n        PermissionReason[PermissionReason[\"UserProjectOwnerAllow\"] = 11] = \"UserProjectOwnerAllow\";\r\n        PermissionReason[PermissionReason[\"UserAdminAllow\"] = 12] = \"UserAdminAllow\";\r\n        PermissionReason[PermissionReason[\"Mixed\"] = 13] = \"Mixed\";\r\n    })(VizPortal.PermissionReason || (VizPortal.PermissionReason = {}));\r\n    var PermissionReason = VizPortal.PermissionReason;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/Permission.ts\" />\r\n/// <reference path=\"../ServerApi/types/IGroup.ts\" />\r\n/// <reference path=\"../ServerApi/types/IUser.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"ICapabilityValue.ts\" />\r\n/// <reference path=\"ITypedId.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/Helpers.ts\" />\r\n/// <reference path=\"../models/IGranteePermissions.ts\" />\r\n/// <reference path=\"../models/Permission.ts\" />\r\n/// <reference path=\"../ServerApi/types/IAuthorizableGranteePermissions.ts\" />\r\n/// <reference path=\"../ServerApi/types/ICapabilityValue.ts\" />\r\n/// <reference path=\"../ServerApi/types/IGroup.ts\" />\r\n/// <reference path=\"../ServerApi/types/IUser.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var PermissionsMerger;\r\n    (function (PermissionsMerger) {\r\n        /**\r\n         * Converts a list of IAuthorizableGranteePermissions from the server into an equivalent list of\r\n         * IGranteePermissions for use by the client. The input array can contain AGPs for multiple\r\n         * authorizables and multiple users, but their client-side authorizable type must be the same.\r\n         */\r\n        function makeGranteePermissionsList(agps, authorizableIds, groups, users) {\r\n            var groupDict = Helpers.dictFromArray(groups, VizPortal.ServerApi.GroupKeys.id);\r\n            var userDict = Helpers.dictFromArray(users, VizPortal.ServerApi.UserKeys.id);\r\n            var agpListByGrantee = _.groupBy(agps, function (agp) { return agp.grantee.type + agp.grantee.id; });\r\n            var permissionsList = _.map(agpListByGrantee, function (granteeAgpList) {\r\n                return createGranteePermissions(granteeAgpList, authorizableIds, groupDict, userDict);\r\n            });\r\n            var allUsersGroup = _.findWhere(groups, { isAllUsersGroup: true });\r\n            if (allUsersGroup) {\r\n                // there exists an All Users group\r\n                var allUsersGroupGP = _.find(permissionsList, function (gp) { return (gp.group && gp.group.id === allUsersGroup.id); });\r\n                if (!allUsersGroupGP) {\r\n                    // the All Users group doesn't have any explicit permissions,\r\n                    // add it to the permissions list with unspecified permissions:\r\n                    allUsersGroupGP = { group: allUsersGroup, permissions: {}, permissionsByContentType: {} };\r\n                    permissionsList.push(allUsersGroupGP);\r\n                }\r\n            }\r\n            return permissionsList;\r\n        }\r\n        PermissionsMerger.makeGranteePermissionsList = makeGranteePermissionsList;\r\n        function createGranteePermissions(granteeAgpList, authorizableIds, groupDict, userDict) {\r\n            // we know all grantees in this list are the same because of the groupBy\r\n            var grantee = granteeAgpList[0].grantee;\r\n            if (VizPortal.FeatureFlags.projectPermissionsTemplatesEnabled) {\r\n                var granteePermissions = {\r\n                    permissionsByContentType: mergePermissionListByContentType(granteeAgpList, authorizableIds)\r\n                };\r\n            }\r\n            else {\r\n                var granteePermissions = {\r\n                    permissions: mergePermissionList(granteeAgpList, authorizableIds)\r\n                };\r\n            }\r\n            switch (grantee.type) {\r\n                case 'group':\r\n                    granteePermissions.group = groupDict[grantee.id];\r\n                    break;\r\n                case 'user':\r\n                    granteePermissions.user = userDict[grantee.id];\r\n                    break;\r\n            }\r\n            return granteePermissions;\r\n        }\r\n        /**\r\n         * TODO: Delete this function when the projectPermissionsTemplatesEnabled feature flag is\r\n         * permanently on. It is replaced by mergePermissionListByContentType().\r\n         */\r\n        function mergePermissionList(agpList, authorizableIds) {\r\n            var agpByAuthorizable = _.indexBy(agpList, function (agp) { return agp.authorizable.id; });\r\n            return _.reduce(authorizableIds, function (permissions, authorizableId) {\r\n                var agp = agpByAuthorizable[authorizableId];\r\n                if (agp) {\r\n                    var inputPermissions = permissionsFromCapabilityValues(agp.permissions);\r\n                    if (permissions) {\r\n                        mergePermissions(permissions, inputPermissions);\r\n                        return permissions;\r\n                    }\r\n                    else {\r\n                        return inputPermissions;\r\n                    }\r\n                }\r\n                else {\r\n                    if (permissions) {\r\n                        mergePermissionsWithUnspecified(permissions);\r\n                        return permissions;\r\n                    }\r\n                    else {\r\n                        return {};\r\n                    }\r\n                }\r\n            }, null);\r\n        }\r\n        /**\r\n         * Merges a list of IAuthorizableGranteePermissions to a single dictionary that maps from\r\n         * capability to permission. Ignores the grantee (assumes all the items in the input list are\r\n         * for a single grantee).\r\n         */\r\n        function mergePermissionListByContentType(granteeAgpList, authorizableIds) {\r\n            // The permissions for each authorizable type will end up as a separate section\r\n            // in the IGranteePermissions, so we process each individually.\r\n            var agpsByContentType = _.groupBy(granteeAgpList, function (agp) { return agp.authorizable.type; });\r\n            var permissionsByContentType = {};\r\n            _.each(agpsByContentType, function (agps, contentType) {\r\n                var permissions = aggregatePermissionsForAuthorizables(agps, authorizableIds);\r\n                permissionsByContentType[contentType] = permissions;\r\n            });\r\n            return permissionsByContentType;\r\n        }\r\n        function aggregatePermissionsForAuthorizables(agpsForAuthorizable, authorizableIds) {\r\n            // There may not be an agp for every authorizable we care about, so we have to merge the\r\n            // permissions by authorizable ID, rather than by agp.\r\n            var agpByAuthorizable = _.indexBy(agpsForAuthorizable, function (agp) { return agp.authorizable.id; });\r\n            var aggregatedPermissions = null;\r\n            authorizableIds.forEach(function (authorizableId) {\r\n                var agp = agpByAuthorizable[authorizableId];\r\n                var inputPermissions = agp ? permissionsFromCapabilityValues(agp.permissions) : {};\r\n                if (aggregatedPermissions) {\r\n                    mergePermissions(aggregatedPermissions, inputPermissions);\r\n                }\r\n                else {\r\n                    aggregatedPermissions = inputPermissions;\r\n                }\r\n            });\r\n            return aggregatedPermissions;\r\n        }\r\n        function permissionsFromCapabilityValues(capabilityValues) {\r\n            var permissions = {};\r\n            _.each(capabilityValues, function (capabilityValue) {\r\n                var capability = capabilityValue.capability;\r\n                var permission = permissionFromCapabilityValue(capabilityValue);\r\n                var reason = reasonFromCapabilityValue(capabilityValue);\r\n                if (permissions[capability]) {\r\n                    permissions[capability].permission = permission;\r\n                    permissions[capability].reason = reason;\r\n                }\r\n                else {\r\n                    permissions[capability] = { permission: permission, reason: reason };\r\n                }\r\n            });\r\n            return permissions;\r\n        }\r\n        function permissionFromCapabilityValue(capability) {\r\n            var capabilityValue = capability.value;\r\n            switch (capabilityValue) {\r\n                case 'allowed': return VizPortal.Permission.Allowed;\r\n                case 'denied': return VizPortal.Permission.Denied;\r\n                // A single capability value from the server is never \"mixed\".\r\n                default: return VizPortal.Permission.Unspecified;\r\n            }\r\n        }\r\n        function reasonFromCapabilityValue(capability) {\r\n            var capabilityReason = capability.reason;\r\n            switch (capabilityReason) {\r\n                case 'GROUP_ALLOW': return VizPortal.PermissionReason.GroupAllow;\r\n                case 'GROUP_DISALLOW': return VizPortal.PermissionReason.GroupDeny;\r\n                case 'GROUP_PROJECT_LEADER': return VizPortal.PermissionReason.GroupProjectLeaderAllow;\r\n                case 'GUEST_ALLOWED': return VizPortal.PermissionReason.GuestAllow;\r\n                case 'IMPLICIT_DENY': return VizPortal.PermissionReason.ImplicitDeny;\r\n                case 'USER_ADMIN': return VizPortal.PermissionReason.UserAdminAllow;\r\n                case 'USER_ALLOW': return VizPortal.PermissionReason.UserAllow;\r\n                case 'USER_AUTHORIZABLE_OWNER': return VizPortal.PermissionReason.UserAuthorizableOwnerAllow;\r\n                case 'USER_DISALLOW': return VizPortal.PermissionReason.UserDeny;\r\n                case 'USER_LICENSING': return VizPortal.PermissionReason.UserLicensingDeny;\r\n                case 'USER_PROJECT_LEADER': return VizPortal.PermissionReason.UserProjectLeaderAllow;\r\n                case 'USER_PROJECT_OWNER': return VizPortal.PermissionReason.UserProjectOwnerAllow;\r\n                default: return VizPortal.PermissionReason.Unspecified;\r\n            }\r\n        }\r\n        function mergePermissions(current, input) {\r\n            _.each(_.union(_.keys(current), _.keys(input)), function (capability) {\r\n                // some vars just to improve readability\r\n                var curr = current[capability];\r\n                var inpt = input[capability];\r\n                if (curr && inpt) {\r\n                    if (curr.permission !== inpt.permission) {\r\n                        // the values explicitly differ\r\n                        current[capability].permission = VizPortal.Permission.Mixed;\r\n                        current[capability].reason = VizPortal.PermissionReason.Mixed;\r\n                    }\r\n                    else {\r\n                        // the values are explicitly equal\r\n                        if (curr.reason != inpt.reason) {\r\n                            // the reasons explicitly differ\r\n                            current[capability].reason = VizPortal.PermissionReason.Mixed;\r\n                        }\r\n                    }\r\n                }\r\n                else if (curr) {\r\n                    if (curr.permission !== VizPortal.Permission.Unspecified) {\r\n                        // input is implicitly unspecified, current is explicitly specified\r\n                        current[capability].permission = VizPortal.Permission.Mixed;\r\n                        current[capability].reason = VizPortal.PermissionReason.Mixed;\r\n                    }\r\n                }\r\n                else if (inpt) {\r\n                    if (inpt.permission !== VizPortal.Permission.Unspecified) {\r\n                        // input is explicitly specified, current is implicitly unspecified\r\n                        current[capability] = { permission: VizPortal.Permission.Mixed, reason: VizPortal.PermissionReason.Mixed };\r\n                    }\r\n                    else {\r\n                        // input is explicitly unspecified, current is implicitly unspecified\r\n                        current[capability] = { permission: inpt.permission, reason: inpt.reason };\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        // TODO: Delete this function when projectPermissionsTemplatesEnabled feature flag is on\r\n        function mergePermissionsWithUnspecified(current) {\r\n            _.each(_.keys(current), function (capability) {\r\n                if (current[capability].permission !== VizPortal.Permission.Unspecified) {\r\n                    current[capability].permission = VizPortal.Permission.Mixed;\r\n                    current[capability].reason = VizPortal.PermissionReason.Mixed;\r\n                }\r\n            });\r\n        }\r\n    })(PermissionsMerger = VizPortal.PermissionsMerger || (VizPortal.PermissionsMerger = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/IAuthorizableGranteePermissions.ts\" />\r\n/// <reference path=\"../types/ITypedIds.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetEffectivePermissionsRequest = (function (_super) {\r\n            __extends(GetEffectivePermissionsRequest, _super);\r\n            function GetEffectivePermissionsRequest(params) {\r\n                _super.call(this, 'getEffectivePermissions', params);\r\n            }\r\n            return GetEffectivePermissionsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetEffectivePermissionsRequest = GetEffectivePermissionsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../fetchers/ListResult.ts\" />\r\n/// <reference path=\"../helpers/PermissionsMerger.ts\" />\r\n/// <reference path=\"../models/IGranteePermissions.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetEffectivePermissionsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetUsersRequest.ts\" />\r\n/// <reference path=\"../ServerApi/types/IGetItemsParams.ts\" />\r\n/// <reference path=\"../ServerApi/types/ITypedIds.ts\" />\r\n/// <reference path=\"../ServerApi/types/IUser.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var EffectivePermissionsService = (function () {\r\n        function EffectivePermissionsService($q, server, FetcherFactory) {\r\n            this.$q = $q;\r\n            this.server = server;\r\n            this.usersFetcher = FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetUsersRequest, function (result) { return result.users; });\r\n        }\r\n        EffectivePermissionsService.prototype.getEffectivePermissions = function (usersParams, authorizables) {\r\n            var _this = this;\r\n            return this.usersFetcher.fetchList(usersParams)\r\n                .then(function (users) {\r\n                if (users.items.length === 0) {\r\n                    // no users; return an empty ListResult\r\n                    return _this.$q.when(new VizPortal.ListResult([]));\r\n                }\r\n                else {\r\n                    // we have users; request & return the effective permissions\r\n                    var userIds = _.pluck(users.items, VizPortal.ServerApi.UserKeys.id);\r\n                    if (VizPortal.FeatureFlags.projectPermissionsTemplatesEnabled) {\r\n                        var requests = VizPortal.PermissionsHelper.effectivePermissionsRequestsForAuthorizables(userIds, authorizables);\r\n                    }\r\n                    else {\r\n                        var requests = [new VizPortal.ServerApi.GetEffectivePermissionsRequest({ userIds: userIds, authorizables: authorizables })];\r\n                    }\r\n                    var combineResultsFn = function (results) {\r\n                        return { permissions: VizPortal.ResultHelper.combine(results, function (result) { return result.permissions; }) };\r\n                    };\r\n                    return _this.server.sendRequestsParallel(requests, combineResultsFn)\r\n                        .then(function (result) {\r\n                        var list = VizPortal.PermissionsMerger.makeGranteePermissionsList(result.permissions, authorizables.ids, [], users.items);\r\n                        return new VizPortal.ListResult(list, users.index, users.total);\r\n                    });\r\n                }\r\n            });\r\n        };\r\n        EffectivePermissionsService.$inject = ['$q', 'ServerService', 'FetcherFactory'];\r\n        return EffectivePermissionsService;\r\n    })();\r\n    VizPortal.EffectivePermissionsService = EffectivePermissionsService;\r\n    VizPortal.Module.instance().service('EffectivePermissionsService', EffectivePermissionsService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"IListFetcher.ts\" />\r\n/// <reference path=\"../services/EffectivePermissionsService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var EffectivePermissionsFetcher = (function () {\r\n        function EffectivePermissionsFetcher(effectivePermissionsService, authorizables) {\r\n            this.effectivePermissionsService = effectivePermissionsService;\r\n            this.authorizables = authorizables;\r\n        }\r\n        EffectivePermissionsFetcher.prototype.setAuthorizables = function (authorizables) {\r\n            this.authorizables = authorizables;\r\n        };\r\n        EffectivePermissionsFetcher.prototype.fetchList = function (params) {\r\n            return this.effectivePermissionsService.getEffectivePermissions(params, this.authorizables);\r\n        };\r\n        return EffectivePermissionsFetcher;\r\n    })();\r\n    VizPortal.EffectivePermissionsFetcher = EffectivePermissionsFetcher;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    /**\r\n     * Utility class that manages the state of collapsible sections. The different section divs in a\r\n     * view layer can hook into these methods to determine if they should show or hide themselves.\r\n     *\r\n     * This implementation allows at most one section to be open at any time. Sections may be\r\n     * numbered in any fashion. Upon construction, all sections are assumed to be closed.\r\n     */\r\n    var SingleSectionAccordion = (function () {\r\n        function SingleSectionAccordion() {\r\n            this.currentOpenSection = null;\r\n        }\r\n        /**\r\n         * Returns true iff the accordion can be used.\r\n         * @returns {boolean}\r\n         */\r\n        SingleSectionAccordion.prototype.isEnabled = function () {\r\n            return true;\r\n        };\r\n        /**\r\n         * Toggles the state of the given section. If the given section is closed, it will open\r\n         * that section and close the others; if it is already open, it will close that section,\r\n         * leaving them all closed.\r\n         * @param section The section number to toggle\r\n         */\r\n        SingleSectionAccordion.prototype.toggleSection = function (section) {\r\n            if (section === this.currentOpenSection) {\r\n                this.currentOpenSection = null;\r\n            }\r\n            else {\r\n                this.currentOpenSection = section;\r\n            }\r\n        };\r\n        /**\r\n         * Returns true if the given section is open, false if it is closed.\r\n         * @param section The section to check\r\n         */\r\n        SingleSectionAccordion.prototype.isSectionOpen = function (section) {\r\n            return (this.currentOpenSection === section);\r\n        };\r\n        return SingleSectionAccordion;\r\n    })();\r\n    VizPortal.SingleSectionAccordion = SingleSectionAccordion;\r\n    /**\r\n     * Alternative implementation of AccordionState that has all the sections open and doesn't allow\r\n     * any of them to close.\r\n     */\r\n    VizPortal.StaticAccordion = {\r\n        isEnabled: function () { return false; },\r\n        toggleSection: function () { },\r\n        isSectionOpen: function () { return true; }\r\n    };\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    (function (LockUnlockProjectPermissionsState) {\r\n        LockUnlockProjectPermissionsState[LockUnlockProjectPermissionsState[\"Locked\"] = 0] = \"Locked\";\r\n        LockUnlockProjectPermissionsState[LockUnlockProjectPermissionsState[\"Unlocked\"] = 1] = \"Unlocked\";\r\n        LockUnlockProjectPermissionsState[LockUnlockProjectPermissionsState[\"Mixed\"] = 2] = \"Mixed\";\r\n    })(VizPortal.LockUnlockProjectPermissionsState || (VizPortal.LockUnlockProjectPermissionsState = {}));\r\n    var LockUnlockProjectPermissionsState = VizPortal.LockUnlockProjectPermissionsState;\r\n    var LockStatusHelper;\r\n    (function (LockStatusHelper) {\r\n        var whiteLockIconClasses = {\r\n            'Locked': 'tb-white-icon-permissions-locked',\r\n            'Unlocked': 'tb-white-icon-permissions-unlocked',\r\n            'Mixed': 'tb-white-icon-permissions-mixed'\r\n        };\r\n        var grayLockIconClasses = {\r\n            'Locked': 'tb-gray-icon-permissions-locked',\r\n            'Unlocked': 'tb-gray-icon-permissions-unlocked',\r\n            'Mixed': 'tb-gray-icon-permissions-mixed'\r\n        };\r\n        var sectionHeaderText = {\r\n            'Locked': 'lockProjectPermissions_locked',\r\n            'Unlocked': 'lockProjectPermissions_unlocked',\r\n            'Mixed': 'lockProjectPermissions_mixed'\r\n        };\r\n        var lockButtonText = {\r\n            'Locked': 'lockProjectPermissions_lockedEllipsis',\r\n            'Unlocked': 'lockProjectPermissions_unlockedEllipsis',\r\n            'Mixed': 'lockProjectPermissions_mixedEllipsis'\r\n        };\r\n        function getCombinedStatusOfAllItems(projectStates) {\r\n            var mixedProjectLockedState = projectStates.some(function (state) { return projectStates[0] !== state; });\r\n            return mixedProjectLockedState ? LockUnlockProjectPermissionsState.Mixed : projectStates[0];\r\n        }\r\n        LockStatusHelper.getCombinedStatusOfAllItems = getCombinedStatusOfAllItems;\r\n        function getLockStatusOfAllProjects(projects) {\r\n            return projects.map(function (proj) {\r\n                return proj.controlledPermissionsEnabled\r\n                    ? LockUnlockProjectPermissionsState.Locked\r\n                    : LockUnlockProjectPermissionsState.Unlocked;\r\n            });\r\n        }\r\n        LockStatusHelper.getLockStatusOfAllProjects = getLockStatusOfAllProjects;\r\n        function getWhiteLockIconClass(lockState) {\r\n            return whiteLockIconClasses[LockUnlockProjectPermissionsState[lockState]];\r\n        }\r\n        LockStatusHelper.getWhiteLockIconClass = getWhiteLockIconClass;\r\n        function getGrayLockIconClass(lockState) {\r\n            return grayLockIconClasses[LockUnlockProjectPermissionsState[lockState]];\r\n        }\r\n        LockStatusHelper.getGrayLockIconClass = getGrayLockIconClass;\r\n        function getSectionHeaderText(lockState) {\r\n            return sectionHeaderText[LockUnlockProjectPermissionsState[lockState]];\r\n        }\r\n        LockStatusHelper.getSectionHeaderText = getSectionHeaderText;\r\n        function getLockButtonText(lockState) {\r\n            return lockButtonText[LockUnlockProjectPermissionsState[lockState]];\r\n        }\r\n        LockStatusHelper.getLockButtonText = getLockButtonText;\r\n        function getLockState(projects) {\r\n            return getCombinedStatusOfAllItems(getLockStatusOfAllProjects(projects));\r\n        }\r\n        LockStatusHelper.getLockState = getLockState;\r\n    })(LockStatusHelper = VizPortal.LockStatusHelper || (VizPortal.LockStatusHelper = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../L10n/L10n.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var PermissionsEditabilityLogicBase = (function () {\r\n        function PermissionsEditabilityLogicBase(authorizables, authorizableType, sourceAuthorizables, $translate) {\r\n            this.authorizables = authorizables;\r\n            this.authorizableType = authorizableType;\r\n            this.sourceAuthorizables = sourceAuthorizables;\r\n            this.$translate = $translate;\r\n            this.editable = this.allAuthorizablesMatchSource();\r\n        }\r\n        PermissionsEditabilityLogicBase.prototype.getEditabilityWithMessages = function () {\r\n            var messages = this.getMessages();\r\n            return {\r\n                editable: this.editable,\r\n                prompt: this.getPrompt(),\r\n                shortMessage: messages[0],\r\n                longMessage: messages[1]\r\n            };\r\n        };\r\n        PermissionsEditabilityLogicBase.prototype.allAuthorizablesMatchSource = function () {\r\n            var _this = this;\r\n            return this.authorizables.all(function (authorizable) {\r\n                var source = _this.sourceAuthorizables[authorizable.id];\r\n                return _this.authorizableType === source.type && authorizable.id === source.id;\r\n            });\r\n        };\r\n        PermissionsEditabilityLogicBase.prototype.allAuthorizablesLocked = function () {\r\n            var _this = this;\r\n            return this.authorizables.all(function (authorizable) {\r\n                var source = _this.sourceAuthorizables[authorizable.id];\r\n                return _this.authorizableType !== source.type || authorizable.id !== source.id;\r\n            });\r\n        };\r\n        // These functions are re-implemented in most of the subclasses\r\n        PermissionsEditabilityLogicBase.prototype.getPromptId = function () { return ''; };\r\n        PermissionsEditabilityLogicBase.prototype.getMessages = function () { return ['', '']; };\r\n        PermissionsEditabilityLogicBase.prototype.getPrompt = function () {\r\n            return this.$translate.instant(this.getPromptId(), {\r\n                ITEM_NAME: VizPortal.L10n.elideIfLong(this.authorizables.first().name),\r\n                ITEM_COUNT: this.authorizables.size()\r\n            }, VizPortal.L10n.Interpolations.Count) || '';\r\n        };\r\n        return PermissionsEditabilityLogicBase;\r\n    })();\r\n    VizPortal.PermissionsEditabilityLogicBase = PermissionsEditabilityLogicBase;\r\n    var ProjectPermissionsEditabilityLogic = (function (_super) {\r\n        __extends(ProjectPermissionsEditabilityLogic, _super);\r\n        function ProjectPermissionsEditabilityLogic(authorizables, sourceAuthorizables, $translate) {\r\n            _super.call(this, authorizables, VizPortal.ProjectContentType.name, sourceAuthorizables, $translate);\r\n        }\r\n        ProjectPermissionsEditabilityLogic.prototype.getPromptId = function () {\r\n            return this.editable ? 'editProjectPermissionsDescription' : '';\r\n        };\r\n        return ProjectPermissionsEditabilityLogic;\r\n    })(PermissionsEditabilityLogicBase);\r\n    VizPortal.ProjectPermissionsEditabilityLogic = ProjectPermissionsEditabilityLogic;\r\n    var WorkbookPermissionsEditabilityLogic = (function (_super) {\r\n        __extends(WorkbookPermissionsEditabilityLogic, _super);\r\n        function WorkbookPermissionsEditabilityLogic(authorizables, sourceAuthorizables, $translate) {\r\n            _super.call(this, authorizables, VizPortal.WorkbookContentType.name, sourceAuthorizables, $translate);\r\n        }\r\n        WorkbookPermissionsEditabilityLogic.prototype.getPromptId = function () {\r\n            return this.editable ? 'editWorkbookPermissionsDescription' : 'readonlyWorkbookPermissionsDescription';\r\n        };\r\n        WorkbookPermissionsEditabilityLogic.prototype.getMessages = function () {\r\n            var _this = this;\r\n            var stringIds = this.editable ? this.messageIdsForEditable() : this.messageIdsForReadOnly();\r\n            return stringIds.map(function (stringId) { return _this.$translate.instant(stringId, {\r\n                ITEM_COUNT: _this.authorizables.size(),\r\n                // SOURCE_NAME is only used in the string when there's a single locked workbook,\r\n                // so we can safely take the first source without knowing what type it is\r\n                SOURCE_NAME: VizPortal.L10n.elideIfLong(_this.sourceAuthorizables[_this.authorizables.first().id].name)\r\n            }, VizPortal.L10n.Interpolations.Count); });\r\n        };\r\n        WorkbookPermissionsEditabilityLogic.prototype.messageIdsForEditable = function () {\r\n            var workbooks = this.authorizables;\r\n            var displayTabs = workbooks.first().displayTabs;\r\n            var allTheSame = workbooks.all(function (workbook) { return workbook.displayTabs === displayTabs; });\r\n            var singleWorkbook = workbooks.size() === 1;\r\n            if (!allTheSame) {\r\n                var shortMessage = 'permissionsShortMessage_workbooksSomeWithIndependentViews';\r\n                var longMessage = 'permissionsLongMessage_workbooksSomeWithIndependentViews';\r\n            }\r\n            else if (displayTabs) {\r\n                var shortMessage = 'permissionsShortMessage_workbooksAllWithInheritedViews';\r\n                var longMessage = singleWorkbook ? 'permissionsLongMessage_workbooksSingleWithInheritedViews'\r\n                    : 'permissionsLongMessage_workbooksAllWithInheritedViews';\r\n            }\r\n            else {\r\n                var shortMessage = 'permissionsShortMessage_workbooksAllWithIndependentViews';\r\n                var longMessage = singleWorkbook ? 'permissionsLongMessage_workbooksSingleWithIndependentViews'\r\n                    : 'permissionsLongMessage_workbooksAllWithIndependentViews';\r\n            }\r\n            return [shortMessage, longMessage];\r\n        };\r\n        WorkbookPermissionsEditabilityLogic.prototype.messageIdsForReadOnly = function () {\r\n            if (this.authorizables.size() === 1) {\r\n                var shortMessage = 'permissionsShortMessage_locked';\r\n                var longMessage = 'permissionsLongMessage_workbooksSingleInLockedProject';\r\n            }\r\n            else if (this.allAuthorizablesLocked()) {\r\n                var shortMessage = 'permissionsShortMessage_locked';\r\n                var longMessage = 'permissionsLongMessage_workbooksAllInLockedProjects';\r\n            }\r\n            else {\r\n                var shortMessage = 'permissionsShortMessage_workbooksSomeInLockedProjects';\r\n                var longMessage = 'permissionsLongMessage_workbooksSomeInLockedProjects';\r\n            }\r\n            return [shortMessage, longMessage];\r\n        };\r\n        return WorkbookPermissionsEditabilityLogic;\r\n    })(PermissionsEditabilityLogicBase);\r\n    VizPortal.WorkbookPermissionsEditabilityLogic = WorkbookPermissionsEditabilityLogic;\r\n    var DatasourcePermissionsEditabilityLogic = (function (_super) {\r\n        __extends(DatasourcePermissionsEditabilityLogic, _super);\r\n        function DatasourcePermissionsEditabilityLogic(authorizables, sourceAuthorizables, $translate) {\r\n            _super.call(this, authorizables, VizPortal.DatasourceContentType.name, sourceAuthorizables, $translate);\r\n        }\r\n        DatasourcePermissionsEditabilityLogic.prototype.getPromptId = function () {\r\n            return this.editable ? 'editDatasourcePermissionsDescription' : 'readonlyDatasourcePermissionsDescription';\r\n        };\r\n        DatasourcePermissionsEditabilityLogic.prototype.getMessages = function () {\r\n            var _this = this;\r\n            if (this.editable) {\r\n                return ['', ''];\r\n            }\r\n            if (this.allAuthorizablesLocked()) {\r\n                var shortMessage = 'permissionsShortMessage_locked';\r\n                var longMessage = 'permissionsLongMessage_datasourcesAllInLockedProjects';\r\n            }\r\n            else {\r\n                var shortMessage = 'permissionsShortMessage_datasourcesSomeInLockedProjects';\r\n                var longMessage = 'permissionsLongMessage_datasourcesSomeInLockedProjects';\r\n            }\r\n            var stringIds = [shortMessage, longMessage];\r\n            return stringIds.map(function (stringId) { return _this.$translate.instant(stringId, { ITEM_COUNT: _this.authorizables.size() }, VizPortal.L10n.Interpolations.Count); });\r\n        };\r\n        return DatasourcePermissionsEditabilityLogic;\r\n    })(PermissionsEditabilityLogicBase);\r\n    VizPortal.DatasourcePermissionsEditabilityLogic = DatasourcePermissionsEditabilityLogic;\r\n    var ViewPermissionsEditabilityLogic = (function (_super) {\r\n        __extends(ViewPermissionsEditabilityLogic, _super);\r\n        function ViewPermissionsEditabilityLogic(authorizables, sourceAuthorizables, $translate) {\r\n            _super.call(this, authorizables, VizPortal.ViewContentType.name, sourceAuthorizables, $translate);\r\n        }\r\n        ViewPermissionsEditabilityLogic.prototype.getPromptId = function () {\r\n            return this.editable ? 'editViewPermissionsDescription' : 'readonlyViewPermissionsDescription';\r\n        };\r\n        ViewPermissionsEditabilityLogic.prototype.getMessages = function () {\r\n            var _this = this;\r\n            if (this.editable) {\r\n                return ['', ''];\r\n            }\r\n            // If any permissions are sourced from projects, we use the locked-to-the-project messaging.\r\n            var numSourcedFromProject = this.authorizables.map(function (authorizable) {\r\n                return (_this.sourceAuthorizables[authorizable.id].type === VizPortal.ProjectContentType.name) ? 1 : 0;\r\n            }).reduce(function (memo, next) { return memo + next; });\r\n            var stringIds = (numSourcedFromProject > 0)\r\n                ? this.messageIdsForLockedViews(numSourcedFromProject)\r\n                : this.messageIdsForUnlockedViews();\r\n            // SOURCE_NAME and SOURCE_COUNT are only referenced in the messages where all the sources are\r\n            // workbooks, so we only count the workbook sources here.\r\n            var sourceWorkbooks = _.uniq(_.filter(this.sourceAuthorizables, function (source) { return source.type === VizPortal.WorkbookContentType.name; }), function (item) { return item.type + item.id; });\r\n            return stringIds.map(function (stringId) { return _this.$translate.instant(stringId, {\r\n                ITEM_COUNT: _this.authorizables.size(),\r\n                SOURCE_COUNT: sourceWorkbooks.length,\r\n                SOURCE_NAME: VizPortal.L10n.elideIfLong(_.first(sourceWorkbooks) && _.first(sourceWorkbooks).name)\r\n            }, VizPortal.L10n.Interpolations.Count); });\r\n        };\r\n        ViewPermissionsEditabilityLogic.prototype.messageIdsForLockedViews = function (numSourcedFromProject) {\r\n            if (numSourcedFromProject === this.authorizables.size()) {\r\n                var shortMessage = 'permissionsShortMessage_locked';\r\n                var longMessage = 'permissionsLongMessage_viewsAllInLockedProjects';\r\n            }\r\n            else {\r\n                var shortMessage = 'permissionsShortMessage_viewsSomeInLockedProjects';\r\n                var longMessage = 'permissionsLongMessage_viewsSomeInLockedProjects';\r\n            }\r\n            return [shortMessage, longMessage];\r\n        };\r\n        ViewPermissionsEditabilityLogic.prototype.messageIdsForUnlockedViews = function () {\r\n            if (this.authorizables.size() === 1) {\r\n                var shortMessage = 'permissionsShortMessage_viewsAllInheritedFromWorkbooks';\r\n                var longMessage = 'permissionsLongMessage_viewsSingleInheritedFromWorkbook';\r\n            }\r\n            else if (this.allAuthorizablesLocked()) {\r\n                var shortMessage = 'permissionsShortMessage_viewsAllInheritedFromWorkbooks';\r\n                var longMessage = 'permissionsLongMessage_viewsAllInheritedFromWorkbooks';\r\n            }\r\n            else {\r\n                var shortMessage = 'permissionsShortMessage_viewsSomeInheritedFromWorkbooks';\r\n                var longMessage = 'permissionsLongMessage_viewsSomeInheritedFromWorkbooks';\r\n            }\r\n            return [shortMessage, longMessage];\r\n        };\r\n        return ViewPermissionsEditabilityLogic;\r\n    })(PermissionsEditabilityLogicBase);\r\n    VizPortal.ViewPermissionsEditabilityLogic = ViewPermissionsEditabilityLogic;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"PermissionsEditabilityLogic.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var PermissionsEditabilityLogicFactory = (function () {\r\n        function PermissionsEditabilityLogicFactory($translate) {\r\n            this.$translate = $translate;\r\n        }\r\n        PermissionsEditabilityLogicFactory.prototype.logicForAuthorizables = function (authorizables, authorizableType, sourceAuthorizables) {\r\n            var impl = PermissionsEditabilityLogicFactory.ImplForContentType[authorizableType];\r\n            return new impl(authorizables, sourceAuthorizables, this.$translate);\r\n        };\r\n        PermissionsEditabilityLogicFactory.$inject = ['$translate'];\r\n        PermissionsEditabilityLogicFactory.ImplForContentType = {\r\n            project: VizPortal.ProjectPermissionsEditabilityLogic,\r\n            workbook: VizPortal.WorkbookPermissionsEditabilityLogic,\r\n            datasource: VizPortal.DatasourcePermissionsEditabilityLogic,\r\n            view: VizPortal.ViewPermissionsEditabilityLogic\r\n        };\r\n        return PermissionsEditabilityLogicFactory;\r\n    })();\r\n    VizPortal.PermissionsEditabilityLogicFactory = PermissionsEditabilityLogicFactory;\r\n    VizPortal.Module.instance().service('PermissionsEditabilityLogicFactory', PermissionsEditabilityLogicFactory);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/Permission.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var PermissionsHasher = (function () {\r\n        function PermissionsHasher(capabilities) {\r\n            this.capabilities = capabilities;\r\n        }\r\n        // A permissions hash is a string of characters, one per capability,\r\n        // in the order they were passed in the constructor.\r\n        // Each character is either A (allowed), D (denied), M (mixed), or - (unspecified).\r\n        PermissionsHasher.prototype.hash = function (permissions) {\r\n            return _.map(this.capabilities, function (capability) {\r\n                switch (permissions[capability]) {\r\n                    case VizPortal.Permission.Allowed: return 'A';\r\n                    case VizPortal.Permission.Denied: return 'D';\r\n                    case VizPortal.Permission.Mixed: return 'M';\r\n                    default: return '-';\r\n                }\r\n                ;\r\n            }).join('');\r\n        };\r\n        return PermissionsHasher;\r\n    })();\r\n    VizPortal.PermissionsHasher = PermissionsHasher;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../FeatureFlags.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        ServerApi.Capabilities = {\r\n            // common\r\n            read: 'read',\r\n            write: 'write',\r\n            deleteItem: 'delete',\r\n            changePermissions: 'change_permissions',\r\n            // view (and workbook and project)\r\n            filter: 'filter',\r\n            addComment: 'add_comment',\r\n            viewComments: 'view_comments',\r\n            exportData: 'export_data',\r\n            vud: 'vud',\r\n            exportImage: 'export_image',\r\n            shareView: 'share_view',\r\n            webAuthoring: 'web_authoring',\r\n            // workbook and datasource\r\n            exportXml: 'export_xml',\r\n            changeHierarchy: 'change_hierarchy',\r\n            // datasource only\r\n            connect: 'connect',\r\n            // project only\r\n            projectLeader: 'project_leader'\r\n        };\r\n        // Today, projects have every capability, but they should only have the smaller set below.\r\n        // The other capabilities should not be on the project, but instead on \"templates\" for data sources and workbooks.\r\n        var ProjectCapabilitiesDeprecated = [\r\n            ServerApi.Capabilities.addComment,\r\n            ServerApi.Capabilities.changeHierarchy,\r\n            ServerApi.Capabilities.changePermissions,\r\n            ServerApi.Capabilities.connect,\r\n            ServerApi.Capabilities.deleteItem,\r\n            ServerApi.Capabilities.exportData,\r\n            ServerApi.Capabilities.exportImage,\r\n            ServerApi.Capabilities.exportXml,\r\n            ServerApi.Capabilities.filter,\r\n            ServerApi.Capabilities.projectLeader,\r\n            ServerApi.Capabilities.read,\r\n            ServerApi.Capabilities.shareView,\r\n            ServerApi.Capabilities.viewComments,\r\n            ServerApi.Capabilities.vud,\r\n            ServerApi.Capabilities.webAuthoring,\r\n            ServerApi.Capabilities.write\r\n        ];\r\n        var ProjectCapabilities = [\r\n            ServerApi.Capabilities.projectLeader,\r\n            ServerApi.Capabilities.read,\r\n            ServerApi.Capabilities.write\r\n        ];\r\n        var WorkbookCapabilities = [\r\n            ServerApi.Capabilities.addComment,\r\n            ServerApi.Capabilities.changeHierarchy,\r\n            ServerApi.Capabilities.changePermissions,\r\n            ServerApi.Capabilities.deleteItem,\r\n            ServerApi.Capabilities.exportData,\r\n            ServerApi.Capabilities.exportImage,\r\n            ServerApi.Capabilities.exportXml,\r\n            ServerApi.Capabilities.filter,\r\n            ServerApi.Capabilities.read,\r\n            ServerApi.Capabilities.shareView,\r\n            ServerApi.Capabilities.viewComments,\r\n            ServerApi.Capabilities.vud,\r\n            ServerApi.Capabilities.webAuthoring,\r\n            ServerApi.Capabilities.write\r\n        ];\r\n        var DatasourceCapabilities = [\r\n            ServerApi.Capabilities.changePermissions,\r\n            ServerApi.Capabilities.connect,\r\n            ServerApi.Capabilities.deleteItem,\r\n            ServerApi.Capabilities.exportXml,\r\n            ServerApi.Capabilities.read,\r\n            ServerApi.Capabilities.write\r\n        ];\r\n        var ViewCapabilities = [\r\n            ServerApi.Capabilities.addComment,\r\n            ServerApi.Capabilities.changePermissions,\r\n            ServerApi.Capabilities.deleteItem,\r\n            ServerApi.Capabilities.exportData,\r\n            ServerApi.Capabilities.exportImage,\r\n            ServerApi.Capabilities.filter,\r\n            ServerApi.Capabilities.read,\r\n            ServerApi.Capabilities.shareView,\r\n            ServerApi.Capabilities.viewComments,\r\n            ServerApi.Capabilities.vud,\r\n            ServerApi.Capabilities.webAuthoring\r\n        ];\r\n        ServerApi.CapabilitiesByContentType = {\r\n            project: ProjectCapabilities,\r\n            projectWorkbookTemplate: WorkbookCapabilities,\r\n            projectDatasourceTemplate: DatasourceCapabilities,\r\n            workbook: WorkbookCapabilities,\r\n            datasource: DatasourceCapabilities,\r\n            view: ViewCapabilities\r\n        };\r\n        ServerApi.CapabilitiesByContentTypeDeprecated = {\r\n            project: ProjectCapabilitiesDeprecated,\r\n            workbook: WorkbookCapabilities,\r\n            datasource: DatasourceCapabilities,\r\n            view: ViewCapabilities\r\n        };\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var Role = (function () {\r\n        function Role() {\r\n        }\r\n        /*\r\n         * Creates a role where all the capabilities have the given permission\r\n         */\r\n        Role.create = function (locKey, capabilities, permission) {\r\n            var permissions = {};\r\n            _.each(capabilities, function (capability) {\r\n                permissions[capability] = permission;\r\n            });\r\n            return { locKey: locKey, permissions: permissions };\r\n        };\r\n        return Role;\r\n    })();\r\n    VizPortal.Role = Role;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"Role.ts\" />\r\n/// <reference path=\"../ServerApi/types/Capabilities.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var PermissionRoleDefinitions;\r\n    (function (PermissionRoleDefinitions) {\r\n        // Project\r\n        var projectRoles = [];\r\n        var ProjectViewerAllowedCapabilities = [\r\n            VizPortal.ServerApi.Capabilities.read,\r\n            VizPortal.ServerApi.Capabilities.viewComments,\r\n            VizPortal.ServerApi.Capabilities.addComment,\r\n            VizPortal.ServerApi.Capabilities.exportData,\r\n            VizPortal.ServerApi.Capabilities.exportImage\r\n        ];\r\n        PermissionRoleDefinitions.ProjectViewer = VizPortal.Role.create(VizPortal.L10n.Keys.viewer, ProjectViewerAllowedCapabilities, VizPortal.Permission.Allowed);\r\n        projectRoles.push(PermissionRoleDefinitions.ProjectViewer);\r\n        var ProjectInteractorAllowedCapabilities = ProjectViewerAllowedCapabilities.concat([\r\n            VizPortal.ServerApi.Capabilities.filter,\r\n            VizPortal.ServerApi.Capabilities.vud,\r\n            VizPortal.ServerApi.Capabilities.shareView,\r\n            VizPortal.ServerApi.Capabilities.webAuthoring\r\n        ]);\r\n        PermissionRoleDefinitions.ProjectInteractor = VizPortal.Role.create(VizPortal.L10n.Keys.interactor, ProjectInteractorAllowedCapabilities, VizPortal.Permission.Allowed);\r\n        projectRoles.push(PermissionRoleDefinitions.ProjectInteractor);\r\n        var ProjectEditorAllowedCapabilities = ProjectInteractorAllowedCapabilities.concat([\r\n            VizPortal.ServerApi.Capabilities.write,\r\n            VizPortal.ServerApi.Capabilities.deleteItem,\r\n            VizPortal.ServerApi.Capabilities.exportXml,\r\n            VizPortal.ServerApi.Capabilities.changeHierarchy,\r\n            VizPortal.ServerApi.Capabilities.changePermissions\r\n        ]);\r\n        PermissionRoleDefinitions.ProjectEditor = VizPortal.Role.create(VizPortal.L10n.Keys.editor, ProjectEditorAllowedCapabilities, VizPortal.Permission.Allowed);\r\n        projectRoles.push(PermissionRoleDefinitions.ProjectEditor);\r\n        var DataSourceConnectorAllowedCapabilities = [\r\n            VizPortal.ServerApi.Capabilities.read,\r\n            VizPortal.ServerApi.Capabilities.connect\r\n        ];\r\n        PermissionRoleDefinitions.DataSourceConnector = VizPortal.Role.create(VizPortal.L10n.Keys.datasourceConnector, DataSourceConnectorAllowedCapabilities, VizPortal.Permission.Allowed);\r\n        projectRoles.push(PermissionRoleDefinitions.DataSourceConnector);\r\n        var DataSourceEditorAllowedCapabilities = DataSourceConnectorAllowedCapabilities.concat([\r\n            VizPortal.ServerApi.Capabilities.write,\r\n            VizPortal.ServerApi.Capabilities.deleteItem,\r\n            VizPortal.ServerApi.Capabilities.exportXml,\r\n            VizPortal.ServerApi.Capabilities.changePermissions,\r\n        ]);\r\n        PermissionRoleDefinitions.DataSourceEditor = VizPortal.Role.create(VizPortal.L10n.Keys.datasourceEditor, DataSourceEditorAllowedCapabilities, VizPortal.Permission.Allowed);\r\n        projectRoles.push(PermissionRoleDefinitions.DataSourceEditor);\r\n        var ProjectPublisherAllowedCapabilities = ProjectInteractorAllowedCapabilities.concat([\r\n            VizPortal.ServerApi.Capabilities.write\r\n        ]);\r\n        PermissionRoleDefinitions.ProjectPublisher = VizPortal.Role.create(VizPortal.L10n.Keys.publisher, ProjectPublisherAllowedCapabilities, VizPortal.Permission.Allowed);\r\n        projectRoles.push(PermissionRoleDefinitions.ProjectPublisher);\r\n        var ProjectLeaderAllowedCapabilities = [\r\n            VizPortal.ServerApi.Capabilities.projectLeader\r\n        ];\r\n        PermissionRoleDefinitions.ProjectLeader = VizPortal.Role.create(VizPortal.L10n.Keys.projectLeader, ProjectLeaderAllowedCapabilities, VizPortal.Permission.Allowed);\r\n        projectRoles.push(PermissionRoleDefinitions.ProjectLeader);\r\n        // Data Source\r\n        var datasourceRoles = [];\r\n        datasourceRoles.push(PermissionRoleDefinitions.DataSourceConnector);\r\n        datasourceRoles.push(PermissionRoleDefinitions.DataSourceEditor);\r\n        // Workbook\r\n        var workbookRoles = [];\r\n        var WorkbookViewerAllowedCapabilities = [\r\n            VizPortal.ServerApi.Capabilities.addComment,\r\n            VizPortal.ServerApi.Capabilities.exportData,\r\n            VizPortal.ServerApi.Capabilities.exportImage,\r\n            VizPortal.ServerApi.Capabilities.read,\r\n            VizPortal.ServerApi.Capabilities.viewComments\r\n        ];\r\n        PermissionRoleDefinitions.WorkbookViewer = VizPortal.Role.create(VizPortal.L10n.Keys.viewer, WorkbookViewerAllowedCapabilities, VizPortal.Permission.Allowed);\r\n        workbookRoles.push(PermissionRoleDefinitions.WorkbookViewer);\r\n        var WorkbookInteractorAllowedCapabilities = WorkbookViewerAllowedCapabilities.concat([\r\n            VizPortal.ServerApi.Capabilities.filter,\r\n            VizPortal.ServerApi.Capabilities.shareView,\r\n            VizPortal.ServerApi.Capabilities.vud,\r\n            VizPortal.ServerApi.Capabilities.webAuthoring\r\n        ]);\r\n        PermissionRoleDefinitions.WorkbookInteractor = VizPortal.Role.create(VizPortal.L10n.Keys.interactor, WorkbookInteractorAllowedCapabilities, VizPortal.Permission.Allowed);\r\n        workbookRoles.push(PermissionRoleDefinitions.WorkbookInteractor);\r\n        var WorkbookEditorAllowedCapabilities = WorkbookInteractorAllowedCapabilities.concat([\r\n            VizPortal.ServerApi.Capabilities.changeHierarchy,\r\n            VizPortal.ServerApi.Capabilities.changePermissions,\r\n            VizPortal.ServerApi.Capabilities.deleteItem,\r\n            VizPortal.ServerApi.Capabilities.exportXml,\r\n            VizPortal.ServerApi.Capabilities.write\r\n        ]);\r\n        PermissionRoleDefinitions.WorkbookEditor = VizPortal.Role.create(VizPortal.L10n.Keys.editor, WorkbookEditorAllowedCapabilities, VizPortal.Permission.Allowed);\r\n        workbookRoles.push(PermissionRoleDefinitions.WorkbookEditor);\r\n        // View\r\n        var viewRoles = [];\r\n        var ViewViewerAllowedCapabilities = [\r\n            VizPortal.ServerApi.Capabilities.addComment,\r\n            VizPortal.ServerApi.Capabilities.exportData,\r\n            VizPortal.ServerApi.Capabilities.exportImage,\r\n            VizPortal.ServerApi.Capabilities.read,\r\n            VizPortal.ServerApi.Capabilities.viewComments\r\n        ];\r\n        PermissionRoleDefinitions.ViewViewer = VizPortal.Role.create(VizPortal.L10n.Keys.viewer, ViewViewerAllowedCapabilities, VizPortal.Permission.Allowed);\r\n        viewRoles.push(PermissionRoleDefinitions.ViewViewer);\r\n        var ViewInteractorAllowedCapabilities = ViewViewerAllowedCapabilities.concat([\r\n            VizPortal.ServerApi.Capabilities.filter,\r\n            VizPortal.ServerApi.Capabilities.shareView,\r\n            VizPortal.ServerApi.Capabilities.vud,\r\n            VizPortal.ServerApi.Capabilities.webAuthoring\r\n        ]);\r\n        PermissionRoleDefinitions.ViewInteractor = VizPortal.Role.create(VizPortal.L10n.Keys.interactor, ViewInteractorAllowedCapabilities, VizPortal.Permission.Allowed);\r\n        viewRoles.push(PermissionRoleDefinitions.ViewInteractor);\r\n        var ViewEditorAllowedCapabilities = ViewInteractorAllowedCapabilities.concat([\r\n            VizPortal.ServerApi.Capabilities.changePermissions,\r\n            VizPortal.ServerApi.Capabilities.deleteItem\r\n        ]);\r\n        PermissionRoleDefinitions.ViewEditor = VizPortal.Role.create(VizPortal.L10n.Keys.editor, ViewEditorAllowedCapabilities, VizPortal.Permission.Allowed);\r\n        viewRoles.push(PermissionRoleDefinitions.ViewEditor);\r\n        // All the roles get added onto this object\r\n        PermissionRoleDefinitions.explicitRolesByContentType = {\r\n            project: projectRoles,\r\n            workbook: workbookRoles,\r\n            datasource: datasourceRoles,\r\n            view: viewRoles\r\n        };\r\n    })(PermissionRoleDefinitions = VizPortal.PermissionRoleDefinitions || (VizPortal.PermissionRoleDefinitions = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"Role.ts\" />\r\n/// <reference path=\"../ServerApi/types/Capabilities.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var PermissionTemplateRoleDefinitions;\r\n    (function (PermissionTemplateRoleDefinitions) {\r\n        // Project\r\n        var projectRoles = [];\r\n        var ProjectViewerAllowedCapabilities = [\r\n            VizPortal.ServerApi.Capabilities.read\r\n        ];\r\n        PermissionTemplateRoleDefinitions.ProjectViewer = VizPortal.Role.create(VizPortal.L10n.Keys.viewer, ProjectViewerAllowedCapabilities, VizPortal.Permission.Allowed);\r\n        projectRoles.push(PermissionTemplateRoleDefinitions.ProjectViewer);\r\n        var ProjectPublisherAllowedCapabilities = ProjectViewerAllowedCapabilities.concat([\r\n            VizPortal.ServerApi.Capabilities.write\r\n        ]);\r\n        PermissionTemplateRoleDefinitions.ProjectPublisher = VizPortal.Role.create(VizPortal.L10n.Keys.publisher, ProjectPublisherAllowedCapabilities, VizPortal.Permission.Allowed);\r\n        projectRoles.push(PermissionTemplateRoleDefinitions.ProjectPublisher);\r\n        var ProjectLeaderAllowedCapabilities = [\r\n            VizPortal.ServerApi.Capabilities.projectLeader\r\n        ];\r\n        PermissionTemplateRoleDefinitions.ProjectLeader = VizPortal.Role.create(VizPortal.L10n.Keys.projectLeader, ProjectLeaderAllowedCapabilities, VizPortal.Permission.Allowed);\r\n        projectRoles.push(PermissionTemplateRoleDefinitions.ProjectLeader);\r\n        // Data Source\r\n        var datasourceRoles = [];\r\n        var DataSourceConnectorAllowedCapabilities = [\r\n            VizPortal.ServerApi.Capabilities.read,\r\n            VizPortal.ServerApi.Capabilities.connect\r\n        ];\r\n        PermissionTemplateRoleDefinitions.DataSourceConnector = VizPortal.Role.create(VizPortal.L10n.Keys.datasourceConnector, DataSourceConnectorAllowedCapabilities, VizPortal.Permission.Allowed);\r\n        datasourceRoles.push(PermissionTemplateRoleDefinitions.DataSourceConnector);\r\n        var DataSourceEditorAllowedCapabilities = DataSourceConnectorAllowedCapabilities.concat([\r\n            VizPortal.ServerApi.Capabilities.write,\r\n            VizPortal.ServerApi.Capabilities.deleteItem,\r\n            VizPortal.ServerApi.Capabilities.exportXml,\r\n            VizPortal.ServerApi.Capabilities.changePermissions,\r\n        ]);\r\n        PermissionTemplateRoleDefinitions.DataSourceEditor = VizPortal.Role.create(VizPortal.L10n.Keys.datasourceEditor, DataSourceEditorAllowedCapabilities, VizPortal.Permission.Allowed);\r\n        datasourceRoles.push(PermissionTemplateRoleDefinitions.DataSourceEditor);\r\n        // Workbook\r\n        var workbookRoles = [];\r\n        var WorkbookViewerAllowedCapabilities = [\r\n            VizPortal.ServerApi.Capabilities.addComment,\r\n            VizPortal.ServerApi.Capabilities.exportData,\r\n            VizPortal.ServerApi.Capabilities.exportImage,\r\n            VizPortal.ServerApi.Capabilities.read,\r\n            VizPortal.ServerApi.Capabilities.viewComments\r\n        ];\r\n        PermissionTemplateRoleDefinitions.WorkbookViewer = VizPortal.Role.create(VizPortal.L10n.Keys.viewer, WorkbookViewerAllowedCapabilities, VizPortal.Permission.Allowed);\r\n        workbookRoles.push(PermissionTemplateRoleDefinitions.WorkbookViewer);\r\n        var WorkbookInteractorAllowedCapabilities = WorkbookViewerAllowedCapabilities.concat([\r\n            VizPortal.ServerApi.Capabilities.filter,\r\n            VizPortal.ServerApi.Capabilities.shareView,\r\n            VizPortal.ServerApi.Capabilities.vud,\r\n            VizPortal.ServerApi.Capabilities.webAuthoring\r\n        ]);\r\n        PermissionTemplateRoleDefinitions.WorkbookInteractor = VizPortal.Role.create(VizPortal.L10n.Keys.interactor, WorkbookInteractorAllowedCapabilities, VizPortal.Permission.Allowed);\r\n        workbookRoles.push(PermissionTemplateRoleDefinitions.WorkbookInteractor);\r\n        var WorkbookEditorAllowedCapabilities = WorkbookInteractorAllowedCapabilities.concat([\r\n            VizPortal.ServerApi.Capabilities.changeHierarchy,\r\n            VizPortal.ServerApi.Capabilities.changePermissions,\r\n            VizPortal.ServerApi.Capabilities.deleteItem,\r\n            VizPortal.ServerApi.Capabilities.exportXml,\r\n            VizPortal.ServerApi.Capabilities.write\r\n        ]);\r\n        PermissionTemplateRoleDefinitions.WorkbookEditor = VizPortal.Role.create(VizPortal.L10n.Keys.editor, WorkbookEditorAllowedCapabilities, VizPortal.Permission.Allowed);\r\n        workbookRoles.push(PermissionTemplateRoleDefinitions.WorkbookEditor);\r\n        // View\r\n        var viewRoles = [];\r\n        var ViewViewerAllowedCapabilities = [\r\n            VizPortal.ServerApi.Capabilities.addComment,\r\n            VizPortal.ServerApi.Capabilities.exportData,\r\n            VizPortal.ServerApi.Capabilities.exportImage,\r\n            VizPortal.ServerApi.Capabilities.read,\r\n            VizPortal.ServerApi.Capabilities.viewComments\r\n        ];\r\n        PermissionTemplateRoleDefinitions.ViewViewer = VizPortal.Role.create(VizPortal.L10n.Keys.viewer, ViewViewerAllowedCapabilities, VizPortal.Permission.Allowed);\r\n        viewRoles.push(PermissionTemplateRoleDefinitions.ViewViewer);\r\n        var ViewInteractorAllowedCapabilities = ViewViewerAllowedCapabilities.concat([\r\n            VizPortal.ServerApi.Capabilities.filter,\r\n            VizPortal.ServerApi.Capabilities.shareView,\r\n            VizPortal.ServerApi.Capabilities.vud,\r\n            VizPortal.ServerApi.Capabilities.webAuthoring\r\n        ]);\r\n        PermissionTemplateRoleDefinitions.ViewInteractor = VizPortal.Role.create(VizPortal.L10n.Keys.interactor, ViewInteractorAllowedCapabilities, VizPortal.Permission.Allowed);\r\n        viewRoles.push(PermissionTemplateRoleDefinitions.ViewInteractor);\r\n        var ViewEditorAllowedCapabilities = ViewInteractorAllowedCapabilities.concat([\r\n            VizPortal.ServerApi.Capabilities.changePermissions,\r\n            VizPortal.ServerApi.Capabilities.deleteItem\r\n        ]);\r\n        PermissionTemplateRoleDefinitions.ViewEditor = VizPortal.Role.create(VizPortal.L10n.Keys.editor, ViewEditorAllowedCapabilities, VizPortal.Permission.Allowed);\r\n        viewRoles.push(PermissionTemplateRoleDefinitions.ViewEditor);\r\n        // All the roles get added onto this object\r\n        PermissionTemplateRoleDefinitions.explicitRolesByContentType = {\r\n            project: projectRoles,\r\n            projectWorkbookTemplate: workbookRoles,\r\n            projectDatasourceTemplate: datasourceRoles,\r\n            workbook: workbookRoles,\r\n            datasource: datasourceRoles,\r\n            view: viewRoles\r\n        };\r\n    })(PermissionTemplateRoleDefinitions = VizPortal.PermissionTemplateRoleDefinitions || (VizPortal.PermissionTemplateRoleDefinitions = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../FeatureFlags.ts\" />\r\n/// <reference path=\"../helpers/PermissionsHasher.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../models/Permission.ts\" />\r\n/// <reference path=\"../ServerApi/types/Capabilities.ts\" />\r\n/// <reference path=\"PermissionRoleDefinitions.ts\" />\r\n/// <reference path=\"PermissionTemplateRoleDefinitions.ts\" />\r\n/// <reference path=\"Role.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var PermissionRoles = (function () {\r\n        function PermissionRoles(explicitRolesByContentType, capabilitiesByContentType) {\r\n            var _this = this;\r\n            this.permissionsAndRolesByType = {};\r\n            this.capabilitiesByContentType = capabilitiesByContentType;\r\n            var allCapabilities = _.uniq(_.flatten(_.values(capabilitiesByContentType)));\r\n            this.permissionsHasher = new VizPortal.PermissionsHasher(allCapabilities);\r\n            _.each(explicitRolesByContentType, function (roles, contentType) {\r\n                _.each(roles, function (role) {\r\n                    _this.addRoleForContentType(contentType, role);\r\n                });\r\n                // Add the 'unspecified' and 'denied' roles\r\n                var unspecifiedRole = {};\r\n                var deniedRole = {};\r\n                _.each(capabilitiesByContentType[contentType], function (capability) {\r\n                    unspecifiedRole[capability] = VizPortal.Permission.Unspecified;\r\n                    deniedRole[capability] = VizPortal.Permission.Denied;\r\n                });\r\n                _this.addExplicitRole(contentType, unspecifiedRole, VizPortal.L10n.Keys.none);\r\n                _this.addExplicitRole(contentType, deniedRole, VizPortal.L10n.Keys.denied);\r\n                _this.addEffectiveRole(contentType, deniedRole, VizPortal.L10n.Keys.none);\r\n            });\r\n        }\r\n        /*\r\n         * Gets the single explicit role that describes this set of permissions on an authorizable type.\r\n         * Returns 'custom' if there is no applicable role.\r\n         */\r\n        PermissionRoles.prototype.getExplicitRoleForTypeAndPermissions = function (contentType, permissions) {\r\n            return this.getRoleForPermissions(this.getExplicitRolesForType(contentType), permissions);\r\n        };\r\n        /*\r\n         * Gets the single effective role that describes this set of permissions on an authorizable type.\r\n         * Returns 'custom' if there is no applicable role.\r\n         */\r\n        PermissionRoles.prototype.getEffectiveRoleForTypeAndPermissions = function (contentType, permissions) {\r\n            return this.getRoleForPermissions(this.getEffectiveRolesForType(contentType), permissions);\r\n        };\r\n        /*\r\n         * Gets the set of explicit permissions for this role.\r\n         */\r\n        PermissionRoles.prototype.getPermissionsForTypeAndRole = function (contentType, role) {\r\n            return this.getPermissionsByRoleForType(contentType)[role];\r\n        };\r\n        /*\r\n         * Gets the list of roles for this authorizable type\r\n         */\r\n        PermissionRoles.prototype.getAvailableRolesForType = function (contentType) {\r\n            return _.values(this.getExplicitRolesForType(contentType));\r\n        };\r\n        PermissionRoles.prototype.getPermissionsAndRolesForType = function (type) {\r\n            var permissionsAndRoles = this.permissionsAndRolesByType[type];\r\n            if (!permissionsAndRoles) {\r\n                permissionsAndRoles = {\r\n                    permissionsByRole: {},\r\n                    explicitRolesByPermissionsHash: {},\r\n                    effectiveRolesByPermissionsHash: {}\r\n                };\r\n                this.permissionsAndRolesByType[type] = permissionsAndRoles;\r\n            }\r\n            return permissionsAndRoles;\r\n        };\r\n        PermissionRoles.prototype.getPermissionsByRoleForType = function (type) {\r\n            return this.getPermissionsAndRolesForType(type).permissionsByRole;\r\n        };\r\n        PermissionRoles.prototype.getExplicitRolesForType = function (type) {\r\n            return this.getPermissionsAndRolesForType(type).explicitRolesByPermissionsHash;\r\n        };\r\n        PermissionRoles.prototype.getEffectiveRolesForType = function (type) {\r\n            return this.getPermissionsAndRolesForType(type).effectiveRolesByPermissionsHash;\r\n        };\r\n        PermissionRoles.prototype.getRoleForPermissions = function (roles, permissions) {\r\n            return roles[this.permissionsHasher.hash(permissions)] || VizPortal.L10n.Keys.custom;\r\n        };\r\n        PermissionRoles.prototype.setRoleForPermissions = function (roles, permissions, role) {\r\n            roles[this.permissionsHasher.hash(permissions)] = role;\r\n        };\r\n        PermissionRoles.prototype.addRoleForContentType = function (type, role) {\r\n            var allCapabilities = this.capabilitiesByContentType[type];\r\n            var explicitPermissions = {};\r\n            var effectivePermissions = {};\r\n            _.each(allCapabilities, function (capability) {\r\n                var permission = role.permissions[capability] || VizPortal.Permission.Unspecified;\r\n                explicitPermissions[capability] = permission;\r\n                // Unspecified permissions are effectively denied\r\n                effectivePermissions[capability] =\r\n                    (permission === VizPortal.Permission.Unspecified) ? VizPortal.Permission.Denied : permission;\r\n            });\r\n            this.addExplicitRole(type, explicitPermissions, role.locKey);\r\n            this.addEffectiveRole(type, effectivePermissions, role.locKey);\r\n        };\r\n        PermissionRoles.prototype.addExplicitRole = function (type, permissions, role) {\r\n            var permissionRoles = this.getPermissionsAndRolesForType(type);\r\n            permissionRoles.permissionsByRole[role] = permissions;\r\n            this.setRoleForPermissions(permissionRoles.explicitRolesByPermissionsHash, permissions, role);\r\n        };\r\n        PermissionRoles.prototype.addEffectiveRole = function (type, permissions, role) {\r\n            // NOTE: effective permissions aren't stored in the permissionsByRole map because this map\r\n            // is only used when setting explicit permissions for a grantee.\r\n            var permissionRoles = this.getPermissionsAndRolesForType(type);\r\n            this.setRoleForPermissions(permissionRoles.effectiveRolesByPermissionsHash, permissions, role);\r\n        };\r\n        return PermissionRoles;\r\n    })();\r\n    VizPortal.PermissionRoles = PermissionRoles;\r\n    VizPortal.Module.instance().factory('PermissionRoles', function () {\r\n        if (VizPortal.FeatureFlags.projectPermissionsTemplatesEnabled) {\r\n            var rolesByContentType = VizPortal.PermissionTemplateRoleDefinitions.explicitRolesByContentType;\r\n            var capabilitiesByContentType = VizPortal.ServerApi.CapabilitiesByContentType;\r\n        }\r\n        else {\r\n            var rolesByContentType = VizPortal.PermissionRoleDefinitions.explicitRolesByContentType;\r\n            var capabilitiesByContentType = VizPortal.ServerApi.CapabilitiesByContentTypeDeprecated;\r\n        }\r\n        return new PermissionRoles(rolesByContentType, capabilitiesByContentType);\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"RequestHelper.ts\" />\r\n/// <reference path=\"../models/IGranteePermissions.ts\" />\r\n/// <reference path=\"../models/PermissionRoles.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetEffectivePermissionsRequest.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var PermissionsHelper;\r\n    (function (PermissionsHelper) {\r\n        function granteeType(row) {\r\n            if (row.group) {\r\n                return 'group';\r\n            }\r\n            else if (row.user) {\r\n                return 'user';\r\n            }\r\n            else {\r\n                return '';\r\n            }\r\n        }\r\n        PermissionsHelper.granteeType = granteeType;\r\n        function granteeName(row) {\r\n            if (row.group) {\r\n                if (row.group.userCount >= 0) {\r\n                    // TODO: It would be better if this was a localized string replacement,\r\n                    // but that would require some minor refactoring, because this static\r\n                    // method doesn't have easy access to $translate.\r\n                    return row.group.name + ' (' + row.group.userCount + ')';\r\n                }\r\n                else {\r\n                    return row.group.name;\r\n                }\r\n            }\r\n            else if (row.user) {\r\n                return row.user.displayName;\r\n            }\r\n            else {\r\n                return '';\r\n            }\r\n        }\r\n        PermissionsHelper.granteeName = granteeName;\r\n        function hasSameGrantee(a, b) {\r\n            if (a && b) {\r\n                if (a.group && b.group) {\r\n                    return a.group.id === b.group.id;\r\n                }\r\n                else if (a.user && b.user) {\r\n                    return a.user.id === b.user.id;\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n        PermissionsHelper.hasSameGrantee = hasSameGrantee;\r\n        function compareGrantees(a, b) {\r\n            if (a.group) {\r\n                if (b.group) {\r\n                    if (a.group.isAllUsersGroup) {\r\n                        if (b.group.isAllUsersGroup) {\r\n                            return 0;\r\n                        }\r\n                        else {\r\n                            return -1;\r\n                        }\r\n                    }\r\n                    else if (b.group.isAllUsersGroup) {\r\n                        return 1;\r\n                    }\r\n                    else {\r\n                        return compareStrings(a.group.name, b.group.name);\r\n                    }\r\n                }\r\n                else {\r\n                    return -1;\r\n                }\r\n            }\r\n            else {\r\n                if (b.group) {\r\n                    return 1;\r\n                }\r\n                else {\r\n                    return compareStrings(a.user.displayName, b.user.displayName);\r\n                }\r\n            }\r\n        }\r\n        PermissionsHelper.compareGrantees = compareGrantees;\r\n        function compareStrings(a, b) {\r\n            return a.localeCompare(b, VizPortal.L10n.language);\r\n        }\r\n        // Gets the permission with the specified capability from the IGranteePermissions. This function\r\n        // contains logic that is dependent on the ProjectPermissionsTemplatesEnabled feature flag.\r\n        // TODO: When the flag is removed, simplify/remove this function.\r\n        function permissionFromIGranteePermission(igp, contentType, capability) {\r\n            var permissions = permissionsFromIGranteePermission(igp, contentType);\r\n            return permissions ? permissions[capability] : undefined;\r\n        }\r\n        PermissionsHelper.permissionFromIGranteePermission = permissionFromIGranteePermission;\r\n        // This function contains logic that is dependent on the ProjectPermissionsTemplatesEnabled\r\n        // feature flag. TODO: When the flag is removed, simplify/remove this function.\r\n        function permissionsFromIGranteePermission(igp, contentType) {\r\n            if (!igp)\r\n                return undefined;\r\n            return (VizPortal.FeatureFlags.projectPermissionsTemplatesEnabled)\r\n                ? igp.permissionsByContentType && igp.permissionsByContentType[contentType]\r\n                : igp.permissions;\r\n        }\r\n        PermissionsHelper.permissionsFromIGranteePermission = permissionsFromIGranteePermission;\r\n        function capabilityReason(row, contentType, capability, defaultValue) {\r\n            var permission = permissionFromIGranteePermission(row, contentType, capability);\r\n            if (permission) {\r\n                switch (permission.reason) {\r\n                    case VizPortal.PermissionReason.GroupAllow: return 'group_allow';\r\n                    case VizPortal.PermissionReason.GroupDeny: return 'group_disallow';\r\n                    case VizPortal.PermissionReason.GroupProjectLeaderAllow: return 'group_project_leader';\r\n                    case VizPortal.PermissionReason.GuestAllow: return 'guest_allowed';\r\n                    case VizPortal.PermissionReason.ImplicitDeny: return 'implicit_deny';\r\n                    case VizPortal.PermissionReason.Mixed: return 'mixed';\r\n                    case VizPortal.PermissionReason.Unspecified: return 'unspecified';\r\n                    case VizPortal.PermissionReason.UserAdminAllow: return 'user_admin';\r\n                    case VizPortal.PermissionReason.UserAllow: return 'user_allow';\r\n                    case VizPortal.PermissionReason.UserAuthorizableOwnerAllow: return 'user_authorizable_owner';\r\n                    case VizPortal.PermissionReason.UserDeny: return 'user_disallow';\r\n                    case VizPortal.PermissionReason.UserLicensingDeny: return 'user_licensing';\r\n                    case VizPortal.PermissionReason.UserProjectLeaderAllow: return 'user_project_leader';\r\n                    case VizPortal.PermissionReason.UserProjectOwnerAllow: return 'user_project_owner';\r\n                    default: return defaultValue;\r\n                }\r\n            }\r\n            else {\r\n                return defaultValue;\r\n            }\r\n        }\r\n        PermissionsHelper.capabilityReason = capabilityReason;\r\n        function capabilityValue(row, contentType, capability, defaultValue) {\r\n            var permission = permissionFromIGranteePermission(row, contentType, capability);\r\n            if (permission) {\r\n                switch (permission.permission) {\r\n                    case VizPortal.Permission.Allowed: return 'allowed';\r\n                    case VizPortal.Permission.Denied: return 'denied';\r\n                    case VizPortal.Permission.Mixed: return 'mixed';\r\n                    default: return defaultValue;\r\n                }\r\n            }\r\n            else {\r\n                return defaultValue;\r\n            }\r\n        }\r\n        PermissionsHelper.capabilityValue = capabilityValue;\r\n        function capabilityTitleKey(row, contentType, capability, defaultValue) {\r\n            var curr = permissionFromIGranteePermission(row, contentType, capability);\r\n            if (curr && curr.reason != VizPortal.PermissionReason.Mixed && curr.reason != VizPortal.PermissionReason.Unspecified) {\r\n                // we have a reason for this capability; it's neither mixed nor unspecified, display the reason\r\n                return 'permission_reason_' + capabilityReason(row, contentType, capability, defaultValue);\r\n            }\r\n            else {\r\n                // we either don't have a reason, or the reason is mixed or unspecified, display only the value\r\n                return 'permission_value_' + capabilityValue(row, contentType, capability, defaultValue);\r\n            }\r\n        }\r\n        PermissionsHelper.capabilityTitleKey = capabilityTitleKey;\r\n        function pluckPermissionsFromDictionary(input) {\r\n            var result = {};\r\n            _.each(input, function (value, key) {\r\n                result[key] = value.permission;\r\n            });\r\n            return result;\r\n        }\r\n        PermissionsHelper.pluckPermissionsFromDictionary = pluckPermissionsFromDictionary;\r\n        function explicitGranteeRole(row, contentType, permissionRoles) {\r\n            var permissions = permissionsFromIGranteePermission(row, contentType);\r\n            var permissionValues = pluckPermissionsFromDictionary(permissions);\r\n            return permissionRoles.getExplicitRoleForTypeAndPermissions(contentType, permissionValues);\r\n        }\r\n        PermissionsHelper.explicitGranteeRole = explicitGranteeRole;\r\n        function effectiveGranteeRole(row, contentType, permissionRoles) {\r\n            var permissions = permissionsFromIGranteePermission(row, contentType);\r\n            var permissionValues = pluckPermissionsFromDictionary(permissions);\r\n            return permissionRoles.getEffectiveRoleForTypeAndPermissions(contentType, permissionValues);\r\n        }\r\n        PermissionsHelper.effectiveGranteeRole = effectiveGranteeRole;\r\n        // returns a new dictionary of IPermissions with all reasons set to 'unspecified'\r\n        function IPermissionsFromPermissions(permissions) {\r\n            var permissionsWithUnspecifiedReasons = {};\r\n            _.each(permissions, function (permission, key) {\r\n                permissionsWithUnspecifiedReasons[key] = {\r\n                    permission: permission,\r\n                    reason: VizPortal.PermissionReason.Unspecified\r\n                };\r\n            });\r\n            return permissionsWithUnspecifiedReasons;\r\n        }\r\n        PermissionsHelper.IPermissionsFromPermissions = IPermissionsFromPermissions;\r\n        // returns a new dictionary of Permissions\r\n        function PermissionsFromIPermissions(ipermissions) {\r\n            var permissions = {};\r\n            _.each(ipermissions, function (permission, key) {\r\n                permissions[key] = permission.permission;\r\n            });\r\n            return permissions;\r\n        }\r\n        PermissionsHelper.PermissionsFromIPermissions = PermissionsFromIPermissions;\r\n        var contentTypesForAuthorizableType = {\r\n            project: ['project', 'projectWorkbookTemplate', 'projectDatasourceTemplate'],\r\n            workbook: ['workbook'],\r\n            datasource: ['datasource'],\r\n            view: ['view']\r\n        };\r\n        function getPermissionsContentTypes(authorizableType) {\r\n            return contentTypesForAuthorizableType[authorizableType];\r\n        }\r\n        PermissionsHelper.getPermissionsContentTypes = getPermissionsContentTypes;\r\n        function explicitPermissionsRequestsForAuthorizables(authorizables) {\r\n            var buildRequestFn = function (authorizableIds) {\r\n                return new VizPortal.ServerApi.GetExplicitPermissionsRequest({ authorizables: { type: authorizables.type, ids: authorizableIds } });\r\n            };\r\n            return VizPortal.RequestHelper.buildRequests(authorizables.ids, buildRequestFn);\r\n        }\r\n        PermissionsHelper.explicitPermissionsRequestsForAuthorizables = explicitPermissionsRequestsForAuthorizables;\r\n        function effectivePermissionsRequestsForAuthorizables(userIds, authorizables) {\r\n            var buildRequestFn = function (authorizableIds) {\r\n                return new VizPortal.ServerApi.GetEffectivePermissionsRequest({ userIds: userIds, authorizables: { type: authorizables.type, ids: authorizableIds } });\r\n            };\r\n            return VizPortal.RequestHelper.buildRequests(authorizables.ids, buildRequestFn);\r\n        }\r\n        PermissionsHelper.effectivePermissionsRequestsForAuthorizables = effectivePermissionsRequestsForAuthorizables;\r\n        function setExplicitPermissionsRequestsForAuthorizables(authorizables, granteePermissions) {\r\n            var buildRequest = function (authorizableIds) {\r\n                var agps = [];\r\n                _.each(authorizableIds, function (authorizableId) {\r\n                    _.each(granteePermissions.permissionsByContentType, function (permissions, contentType) {\r\n                        // Don't create a request when no permissions have changed\r\n                        if (_.isEqual(permissions, {}))\r\n                            return;\r\n                        var agp = {\r\n                            authorizable: { type: contentType, id: authorizableId },\r\n                            grantee: getGrantee(granteePermissions),\r\n                            permissions: capabilityValuesFromPermissions(permissions)\r\n                        };\r\n                        agps.push(agp);\r\n                    });\r\n                });\r\n                return new VizPortal.ServerApi.SetExplicitPermissionsRequest({\r\n                    permissions: agps\r\n                });\r\n            };\r\n            return VizPortal.RequestHelper.buildRequests(authorizables.ids, buildRequest);\r\n        }\r\n        PermissionsHelper.setExplicitPermissionsRequestsForAuthorizables = setExplicitPermissionsRequestsForAuthorizables;\r\n        function getGrantee(granteePermissions) {\r\n            if (granteePermissions.group) {\r\n                return {\r\n                    type: 'group',\r\n                    id: granteePermissions.group.id\r\n                };\r\n            }\r\n            else if (granteePermissions.user) {\r\n                return {\r\n                    type: 'user',\r\n                    id: granteePermissions.user.id\r\n                };\r\n            }\r\n            else {\r\n                return null;\r\n            }\r\n        }\r\n        PermissionsHelper.getGrantee = getGrantee;\r\n        function capabilityValuesFromPermissions(permissions) {\r\n            return _.map(permissions, function (permission, capability) {\r\n                var capabilityValue = {\r\n                    capability: capability,\r\n                    value: capabilityValueFromPermission(permission.permission)\r\n                };\r\n                return capabilityValue;\r\n            });\r\n        }\r\n        PermissionsHelper.capabilityValuesFromPermissions = capabilityValuesFromPermissions;\r\n        function capabilityValueFromPermission(permission) {\r\n            switch (permission) {\r\n                case VizPortal.Permission.Allowed: return 'allowed';\r\n                case VizPortal.Permission.Denied: return 'denied';\r\n                case VizPortal.Permission.Mixed: return 'mixed';\r\n                case VizPortal.Permission.Unspecified: return 'unspecified';\r\n                default: return null;\r\n            }\r\n        }\r\n        PermissionsHelper.capabilityValueFromPermission = capabilityValueFromPermission;\r\n    })(PermissionsHelper = VizPortal.PermissionsHelper || (VizPortal.PermissionsHelper = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var PermissionsPanelResizer = (function () {\r\n        function PermissionsPanelResizer(permissionsPanel) {\r\n            this.permissionsPanel = permissionsPanel;\r\n        }\r\n        PermissionsPanelResizer.prototype.startResize = function (yPos) {\r\n            this.topPanel = this.permissionsPanel.find('.tb-permissions-top');\r\n            this.bottomPanel = this.permissionsPanel.find('.tb-permissions-bottom');\r\n            this.startY = yPos;\r\n            this.startTopHeight = this.topPanel.height();\r\n            var explicitPermissionsBody = this.permissionsPanel.find('.tb-explicit-permissions-body');\r\n            var divider = this.permissionsPanel.find('.tb-permissions-panel-divider');\r\n            var explicitPermissionsBodyHeight = explicitPermissionsBody.height();\r\n            var startBottomHeight = this.bottomPanel.height();\r\n            var dividerHeight = divider.height();\r\n            this.minTopHeight = this.startTopHeight - explicitPermissionsBodyHeight + dividerHeight;\r\n            this.maxTopHeight = this.startTopHeight + startBottomHeight - dividerHeight * 2;\r\n        };\r\n        PermissionsPanelResizer.prototype.continueResize = function (yPos) {\r\n            var dy = yPos - this.startY;\r\n            var newTopHeight = dy + this.startTopHeight;\r\n            newTopHeight = Math.min(Math.max(newTopHeight, this.minTopHeight), this.maxTopHeight);\r\n            this.topPanel.css({ height: newTopHeight });\r\n            this.bottomPanel.css({ top: newTopHeight });\r\n        };\r\n        return PermissionsPanelResizer;\r\n    })();\r\n    VizPortal.PermissionsPanelResizer = PermissionsPanelResizer;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../fetchers/IListFetcher.ts\" />\r\n/// <reference path=\"../fetchers/ListResult.ts\" />\r\n/// <reference path=\"../models/ISliceable.ts\" />\r\n/// <reference path=\"../ServerApi/types/IGetItemsParams.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var PagedList = (function () {\r\n        function PagedList(fetcher, fetchParams) {\r\n            this.fetcher = fetcher;\r\n            this.fetchParams = fetchParams;\r\n        }\r\n        PagedList.prototype.getSlice = function (start, size) {\r\n            return this.fetchItems({\r\n                filter: this.fetchParams.filter,\r\n                order: this.fetchParams.order,\r\n                page: {\r\n                    startIndex: start,\r\n                    maxItems: size\r\n                }\r\n            });\r\n        };\r\n        PagedList.prototype.fetchItems = function (params) {\r\n            var _this = this;\r\n            return this.fetcher.fetchList(params).then(function (result) {\r\n                if (result) {\r\n                    _this.fetchParams = params;\r\n                }\r\n                return result;\r\n            });\r\n        };\r\n        return PagedList;\r\n    })();\r\n    VizPortal.PagedList = PagedList;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/IAuthorizableGranteePermissions.ts\" />\r\n/// <reference path=\"../types/IGroup.ts\" />\r\n/// <reference path=\"../types/ITypedIds.ts\" />\r\n/// <reference path=\"../types/IUser.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetExplicitPermissionsRequest = (function (_super) {\r\n            __extends(GetExplicitPermissionsRequest, _super);\r\n            function GetExplicitPermissionsRequest(params) {\r\n                _super.call(this, 'getExplicitPermissions', params);\r\n            }\r\n            return GetExplicitPermissionsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetExplicitPermissionsRequest = GetExplicitPermissionsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/IAuthorizableGranteePermissions.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var SetExplicitPermissionsRequest = (function (_super) {\r\n            __extends(SetExplicitPermissionsRequest, _super);\r\n            function SetExplicitPermissionsRequest(params) {\r\n                _super.call(this, 'setExplicitPermissions', params);\r\n            }\r\n            return SetExplicitPermissionsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.SetExplicitPermissionsRequest = SetExplicitPermissionsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../FeatureFlags.ts\" />\r\n/// <reference path=\"../fetchers/ListResult.ts\" />\r\n/// <reference path=\"../helpers/PermissionsMerger.ts\" />\r\n/// <reference path=\"../helpers/RequestHelper.ts\" />\r\n/// <reference path=\"../helpers/ResultHelper.ts\" />\r\n/// <reference path=\"../models/IGranteePermissions.ts\" />\r\n/// <reference path=\"../models/Permission.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetExplicitPermissionsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/SetExplicitPermissionsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/types/IAuthorizableGranteePermissions.ts\" />\r\n/// <reference path=\"../ServerApi/types/ICapabilityValue.ts\" />\r\n/// <reference path=\"../ServerApi/types/ITypedIds.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ExplicitPermissions = (function () {\r\n        function ExplicitPermissions(server) {\r\n            this.server = server;\r\n        }\r\n        ExplicitPermissions.prototype.forAuthorizables = function (authorizables) {\r\n            if (VizPortal.FeatureFlags.projectPermissionsTemplatesEnabled) {\r\n                var requests = VizPortal.PermissionsHelper.explicitPermissionsRequestsForAuthorizables(authorizables);\r\n            }\r\n            else {\r\n                var requests = VizPortal.RequestHelper.buildRequests(authorizables.ids, function (idsBlock) { return new VizPortal.ServerApi.GetExplicitPermissionsRequest({ authorizables: { type: authorizables.type, ids: idsBlock } }); });\r\n            }\r\n            var combineResultsFn = function (results) {\r\n                return {\r\n                    permissions: VizPortal.ResultHelper.combine(results, function (result) { return result.permissions; }),\r\n                    groups: VizPortal.ResultHelper.combine(results, function (result) { return result.groups; }),\r\n                    users: VizPortal.ResultHelper.combine(results, function (result) { return result.users; }),\r\n                    sourceAuthorizableById: VizPortal.ResultHelper.combineByKey(results, function (result) { return result.sourceAuthorizableById; })\r\n                };\r\n            };\r\n            return this.server.sendRequestsParallel(requests, combineResultsFn)\r\n                .then(function (result) {\r\n                var list = VizPortal.PermissionsMerger.makeGranteePermissionsList(result.permissions, authorizables.ids, result.groups, result.users);\r\n                return {\r\n                    permissionsList: new VizPortal.ListResult(list),\r\n                    sourceAuthorizablesById: result.sourceAuthorizableById\r\n                };\r\n            });\r\n        };\r\n        ExplicitPermissions.prototype.setForAuthorizables = function (authorizables, granteePermissions) {\r\n            if (VizPortal.FeatureFlags.projectPermissionsTemplatesEnabled) {\r\n                var requests = VizPortal.PermissionsHelper.setExplicitPermissionsRequestsForAuthorizables(authorizables, granteePermissions);\r\n            }\r\n            else {\r\n                var agps = _.map(authorizables.ids, function (authorizableId) {\r\n                    var agp = {\r\n                        authorizable: { type: authorizables.type, id: authorizableId },\r\n                        grantee: VizPortal.PermissionsHelper.getGrantee(granteePermissions),\r\n                        permissions: VizPortal.PermissionsHelper.capabilityValuesFromPermissions(granteePermissions.permissions)\r\n                    };\r\n                    return agp;\r\n                });\r\n                var requests = VizPortal.RequestHelper.buildRequests(agps, function (agpsBlock) { return new VizPortal.ServerApi.SetExplicitPermissionsRequest({ permissions: agpsBlock }); });\r\n            }\r\n            return this.server.sendRequestsParallel(requests, VizPortal.ResultHelper.combineResults);\r\n        };\r\n        ExplicitPermissions.$inject = ['ServerService'];\r\n        return ExplicitPermissions;\r\n    })();\r\n    VizPortal.ExplicitPermissions = ExplicitPermissions;\r\n    VizPortal.Module.instance().service('ExplicitPermissions', ExplicitPermissions);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/PermissionsHelper.ts\" />\r\n/// <reference path=\"../models/PermissionRoles.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var GranteePermissionsFactory = (function () {\r\n        function GranteePermissionsFactory(permissionRoles) {\r\n            this.permissionRoles = permissionRoles;\r\n        }\r\n        GranteePermissionsFactory.prototype.createForUserWithUnspecifiedPermissions = function (user, authorizableType) {\r\n            var gp = { user: user };\r\n            return this.addUnspecifiedPermissions(gp, authorizableType);\r\n        };\r\n        GranteePermissionsFactory.prototype.createForGroupWithUnspecifiedPermissions = function (group, authorizableType) {\r\n            var gp = { group: group };\r\n            return this.addUnspecifiedPermissions(gp, authorizableType);\r\n        };\r\n        GranteePermissionsFactory.prototype.addUnspecifiedPermissions = function (gp, authorizableType) {\r\n            var _this = this;\r\n            if (VizPortal.FeatureFlags.projectPermissionsTemplatesEnabled) {\r\n                var contentTypes = VizPortal.PermissionsHelper.getPermissionsContentTypes(authorizableType);\r\n                var pct = _.reduce(contentTypes, function (permissionsByContentType, contentType) {\r\n                    permissionsByContentType[contentType] = VizPortal.PermissionsHelper.IPermissionsFromPermissions(_this.permissionRoles.getPermissionsForTypeAndRole(contentType, VizPortal.L10n.Keys.none));\r\n                    return permissionsByContentType;\r\n                }, {});\r\n                _.defaults(gp, {\r\n                    permissionsByContentType: pct\r\n                });\r\n            }\r\n            else {\r\n                var permissions = VizPortal.PermissionsHelper.IPermissionsFromPermissions(this.permissionRoles.getPermissionsForTypeAndRole(authorizableType, VizPortal.L10n.Keys.none));\r\n                _.defaults(gp, {\r\n                    permissions: permissions\r\n                });\r\n            }\r\n            return gp;\r\n        };\r\n        GranteePermissionsFactory.$inject = ['PermissionRoles'];\r\n        return GranteePermissionsFactory;\r\n    })();\r\n    VizPortal.GranteePermissionsFactory = GranteePermissionsFactory;\r\n    VizPortal.Module.instance().service('GranteePermissionsFactory', GranteePermissionsFactory);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"ActionPanelService.ts\" />\r\n/// <reference path=\"../controllers/PermissionsPanelCtrl.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var PermissionsPanelActions = (function () {\r\n        function PermissionsPanelActions() {\r\n            this.actionDefinition = [\r\n                this.editPermissionRuleAction(),\r\n                this.deletePermissionRuleAction()\r\n            ];\r\n        }\r\n        // TODO: refactor the way the permission rule editor is launched so that we don't need to depend on the scope.\r\n        PermissionsPanelActions.prototype.getActionButtons = function ($scope) {\r\n            this.$scope = $scope;\r\n            return this.actionDefinition;\r\n        };\r\n        // Action button factories\r\n        PermissionsPanelActions.prototype.editPermissionRuleAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'edit',\r\n                isDisabled: function (rule) {\r\n                    return !rule;\r\n                },\r\n                execute: function (rule) {\r\n                    _this.showPermissionRuleEditor(VizPortal.PermissionRuleEditorCommands.edit);\r\n                }\r\n            };\r\n        };\r\n        PermissionsPanelActions.prototype.deletePermissionRuleAction = function () {\r\n            var _this = this;\r\n            return {\r\n                name: 'delete',\r\n                isDisabled: function (rule) {\r\n                    return _this.isAllUsersGroup(rule);\r\n                },\r\n                execute: function (rule) {\r\n                    _this.showPermissionRuleEditor(VizPortal.PermissionRuleEditorCommands.delete_);\r\n                }\r\n            };\r\n        };\r\n        PermissionsPanelActions.prototype.isAllUsersGroup = function (rule) {\r\n            return rule && rule.group && rule.group.isAllUsersGroup;\r\n        };\r\n        PermissionsPanelActions.prototype.showPermissionRuleEditor = function (action) {\r\n            this.$scope.permissionRuleEditorParams.action = action;\r\n            this.$scope.permissionRuleEditorParams.show = true;\r\n        };\r\n        return PermissionsPanelActions;\r\n    })();\r\n    VizPortal.PermissionsPanelActions = PermissionsPanelActions;\r\n    VizPortal.Module.instance().service('PermissionsPanelActions', PermissionsPanelActions);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../controllers/PermissionRuleEditorCtrl.ts\" />\r\n/// <reference path=\"../controllers/ScrollCtrl.ts\" />\r\n/// <reference path=\"../fetchers/EffectivePermissionsFetcher.ts\" />\r\n/// <reference path=\"../fetchers/ListResult.ts\" />\r\n/// <reference path=\"../helpers/AccordionState.ts\" />\r\n/// <reference path=\"../helpers/Filter.ts\" />\r\n/// <reference path=\"../helpers/LockStatusHelper.ts\" />\r\n/// <reference path=\"../helpers/permissions/PermissionsEditabilityLogic.ts\" />\r\n/// <reference path=\"../helpers/permissions/PermissionsEditabilityLogicFactory.ts\" />\r\n/// <reference path=\"../helpers/PermissionsHasher.ts\" />\r\n/// <reference path=\"../helpers/PermissionsHelper.ts\" />\r\n/// <reference path=\"../helpers/PermissionsPanelResizer.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../models/ColumnWidths.ts\" />\r\n/// <reference path=\"../models/Content.ts\" />\r\n/// <reference path=\"../models/ISliceable.ts\" />\r\n/// <reference path=\"../models/IGranteePermissions.ts\" />\r\n/// <reference path=\"../models/IProjectInfo.ts\" />\r\n/// <reference path=\"../models/ListLayout.ts\" />\r\n/// <reference path=\"../models/PagedList.ts\" />\r\n/// <reference path=\"../models/Permission.ts\" />\r\n/// <reference path=\"../models/PermissionRoles.ts\" />\r\n/// <reference path=\"../models/PermissionsPanelColumnWidths.ts\" />\r\n/// <reference path=\"../models/resourceInfoParts.ts\" />\r\n/// <reference path=\"../models/Set.ts\" />\r\n/// <reference path=\"../resources/ExplicitPermissions.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetUsersGroupMembershipRequest.ts\" />\r\n/// <reference path=\"../ServerApi/types/IFilterClause.ts\" />\r\n/// <reference path=\"../ServerApi/types/IGetItemsParams.ts\" />\r\n/// <reference path=\"../ServerApi/types/resourceParts.ts\" />\r\n/// <reference path=\"../services/GranteePermissionsFactory.ts\" />\r\n/// <reference path=\"../services/PermissionsPanelActions.ts\" />\r\n/// <reference path=\"../services/SliceableFactory.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var PermissionsTemplateUrl = (function () {\r\n        function PermissionsTemplateUrl() {\r\n        }\r\n        PermissionsTemplateUrl.forTemplateType = function (templateType) {\r\n            return (!VizPortal.FeatureFlags.projectPermissionsTemplatesEnabled) ?\r\n                templateType + 'PermissionsPanelWithoutPermissionsTemplates.html' :\r\n                templateType + 'PermissionsPanel.html';\r\n        };\r\n        return PermissionsTemplateUrl;\r\n    })();\r\n    var PermissionsPanelCtrl = (function () {\r\n        function PermissionsPanelCtrl($scope, $element, $q, $timeout, $translate, permissionsPanelActions, sliceableFactory, server, explicitPermissions, effectivePermissionsService, permissionRoles, permissionsEditabilityLogicFactory, BrowserSupportService, granteePermissionsFactory) {\r\n            var _this = this;\r\n            this.$scope = $scope;\r\n            this.$q = $q;\r\n            this.$timeout = $timeout;\r\n            this.sliceableFactory = sliceableFactory;\r\n            this.server = server;\r\n            this.explicitPermissions = explicitPermissions;\r\n            this.permissionRoles = permissionRoles;\r\n            this.permissionsEditabilityLogicFactory = permissionsEditabilityLogicFactory;\r\n            this.granteePermissionsFactory = granteePermissionsFactory;\r\n            this.hoveredCapabilityValue = null;\r\n            this.updateCurrentAuthorizables();\r\n            this.effectivePermissionsFetcher = new VizPortal.EffectivePermissionsFetcher(effectivePermissionsService, this.$scope.currentAuthorizables);\r\n            this.$scope.currentExplicitPermission = null;\r\n            this.hoveredEffectivePermission = null;\r\n            this.hoveredExplicitPermission = null;\r\n            this.$scope.isLoadingEffectivePermissions = false;\r\n            this.permissionsPanelResizer = new VizPortal.PermissionsPanelResizer($element);\r\n            $scope.permissionsTemplateUrl = PermissionsTemplateUrl.forTemplateType($scope.templateType);\r\n            // Because we use the \"editable\" boolean in the templates HTML instead of \"readOnly\",\r\n            // give it a value if it won't be populated from the lockdown feature. Otherwise, it would be\r\n            // undefined and thus fasy, causing all permissions to render as read-only.\r\n            if (VizPortal.FeatureFlags.projectPermissionsTemplatesEnabled\r\n                && !VizPortal.FeatureFlags.projectControlledPermissionsEnabled) {\r\n                $scope.editability = {\r\n                    editable: !$scope.readOnly(),\r\n                    prompt: '',\r\n                    shortMessage: '',\r\n                    longMessage: ''\r\n                };\r\n            }\r\n            $scope.columnWidths = VizPortal.getPermissionsPanelColumnWidths($scope.authorizableType);\r\n            $scope.resize = function (xPos) {\r\n                $scope.$apply(function () {\r\n                    $scope.columnWidths.resizer.continueResize(xPos);\r\n                });\r\n            };\r\n            $scope.granteeType = VizPortal.PermissionsHelper.granteeType;\r\n            $scope.granteeName = VizPortal.PermissionsHelper.granteeName;\r\n            $scope.explicitGranteeRole = function (row, contentType) {\r\n                return VizPortal.PermissionsHelper.explicitGranteeRole(row, contentType, _this.permissionRoles);\r\n            };\r\n            $scope.userStatusForRow = function (row, contentType) {\r\n                return _this.userStatusForRow(row, contentType);\r\n            };\r\n            $scope.capabilityValue = VizPortal.PermissionsHelper.capabilityValue;\r\n            $scope.capabilityReason = VizPortal.PermissionsHelper.capabilityReason;\r\n            $scope.capabilityTitleKey = VizPortal.PermissionsHelper.capabilityTitleKey;\r\n            $scope.explicitPermissionsPanelControls = {};\r\n            $scope.effectivePermissionsPanelControls = {};\r\n            $scope.toggleCurrentExplicitPermission = function (explicitPermission) {\r\n                if ($scope.permissionRuleEditorParams.show) {\r\n                    // if the editor is open, don't change the selected explicit permission\r\n                    return;\r\n                }\r\n                $scope.currentExplicitPermission === explicitPermission ?\r\n                    _this.setCurrentExplicitPermission(null) :\r\n                    _this.setCurrentExplicitPermission(explicitPermission);\r\n            };\r\n            $scope.setCurrentExplicitPermission = function (explicitPermission) { return _this.setCurrentExplicitPermission(explicitPermission); };\r\n            $scope.haveCurrentExplicitPermission = function () { return !!_this.$scope.currentExplicitPermission; };\r\n            $scope.isCurrentExplicitPermission = function (explicitPermission) {\r\n                return _this.$scope.currentExplicitPermission === explicitPermission;\r\n            };\r\n            $scope.isHoveredExplicitPermission = function (explicitPermission) {\r\n                return _this.hoveredExplicitPermission === explicitPermission;\r\n            };\r\n            $scope.isHoveredEffectivePermission = function (effectivePermission) {\r\n                return _this.hoveredEffectivePermission === effectivePermission;\r\n            };\r\n            $scope.showEditButtonForRow = function (row) {\r\n                if (_this.hoveredExplicitPermission) {\r\n                    return _this.hoveredExplicitPermission === row;\r\n                }\r\n                else {\r\n                    // TODO: Check for current (selected) row on mobile,\r\n                    // because otherwise the edit/delete buttons will never show,\r\n                    // since mobile doesn't support hover.\r\n                    // if (mobile) {\r\n                    //   return this.$scope.currentExplicitPermission === row;\r\n                    // } else {\r\n                    return false;\r\n                }\r\n            };\r\n            $scope.showDeleteButtonForRow = function (row) {\r\n                if (_this.hoveredExplicitPermission\r\n                    && _this.hoveredExplicitPermission.group\r\n                    && _this.hoveredExplicitPermission.group.isAllUsersGroup) {\r\n                    // don't show the delete button for the All Users group.\r\n                    return false;\r\n                }\r\n                else {\r\n                    // if not the All Users group, logic for showing Delete is the same as for Edit.\r\n                    return _this.$scope.showEditButtonForRow(row);\r\n                }\r\n            };\r\n            $scope.isRelevantExplicitPermission = function (explicitPermission) { return _this.isRelevantExplicitPermission(explicitPermission); };\r\n            $scope.isNotRelevantExplicitPermission = function (explicitPermission) { return _this.isNotRelevantExplicitPermission(explicitPermission); };\r\n            $scope.relevantCapabilityClass = function (explicitPermission, contentType, capability, capabilityName) {\r\n                return _this.relevantCapabilityClass(explicitPermission, contentType, capability, capabilityName);\r\n            };\r\n            $scope.isRelevantHeader = function (name) {\r\n                return _this.hoveredCapabilityValue === name;\r\n            };\r\n            $scope.setHoveredCapabilityValue = function (capabilityCell) {\r\n                var name = capabilityCell.attr('data-capability-name');\r\n                _this.hoveredCapabilityValue = name;\r\n                // We don't usually digest on mouseenter and mouseleave, so force it\r\n                _this.$scope.$digest();\r\n            };\r\n            $scope.clearHoveredCapabilityValue = function () {\r\n                _this.hoveredCapabilityValue = null;\r\n                // We don't usually digest on mouseenter and mouseleave, so force it\r\n                _this.$scope.$digest();\r\n            };\r\n            $scope.isCurrentEffectivePermission = function (row) {\r\n                return _this.hoveredEffectivePermission === row;\r\n            };\r\n            $scope.hasCurrentEffectivePermission = function () { return !!_this.hoveredEffectivePermission; };\r\n            $scope.effectiveRowHovered = function (row) {\r\n                _this.hoveredEffectivePermission = row;\r\n                // We don't usually digest on mouseenter and mouseleave, so force it\r\n                _this.$scope.$digest();\r\n            };\r\n            $scope.explicitRowHovered = function (row) {\r\n                _this.hoveredExplicitPermission = row;\r\n                // We don't usually digest on mouseenter and mouseleave, so force it\r\n                _this.$scope.$digest();\r\n            };\r\n            $scope.startResize = function (yPos) {\r\n                return _this.permissionsPanelResizer.startResize(yPos);\r\n            };\r\n            $scope.continueResize = function (yPos) {\r\n                return _this.permissionsPanelResizer.continueResize(yPos);\r\n            };\r\n            $scope.effectivePermissionsSliceChanged = function (newSlice) {\r\n                var userIds = _.map(newSlice.items, function (item) { return item.user.id; });\r\n                _this.updateGroupMembership(userIds);\r\n                _this.$timeout(function () {\r\n                    if (_this.$scope.effectivePermissionsPanelControls.scrollControls) {\r\n                        var scrollLeft = _this.$scope.explicitPermissionsPanelControls.scrollControls.getScrollLeft();\r\n                        _this.$scope.effectivePermissionsPanelControls.scrollControls.setScrollLeft(scrollLeft);\r\n                    }\r\n                });\r\n            };\r\n            // TODO: This is only used by the inline edit button and can be removed when the\r\n            //       projectPermissionsTemplatesEnabled feature flag is removed.\r\n            $scope.deletePermissionRule = function (explicitPermission) {\r\n                _this.setCurrentExplicitPermission(explicitPermission);\r\n                _this.showPermissionRuleEditor(VizPortal.PermissionRuleEditorCommands.delete_);\r\n            };\r\n            // TODO: This is only used by the inline delete button and can be removed when the\r\n            //       projectPermissionsTemplatesEnabled feature flag is removed.\r\n            $scope.editPermissionRule = function (explicitPermission) {\r\n                _this.setCurrentExplicitPermission(explicitPermission);\r\n                _this.showPermissionRuleEditor(VizPortal.PermissionRuleEditorCommands.edit);\r\n            };\r\n            $scope.hideRowMenu = function () {\r\n                _this.hidePermissionRuleEditor();\r\n            };\r\n            $scope.submitSearch = function (searchText, $event) {\r\n                if (_this.$scope.currentExplicitPermission !== _this.explicitPermissionsList.items[0]) {\r\n                    // the All Users group is not selected.  Select it.\r\n                    _this.setCurrentExplicitPermission(_this.explicitPermissionsList.items[0]);\r\n                }\r\n                _this.updateEffectivePermissions(searchText);\r\n                if (BrowserSupportService.isTouch() && $event) {\r\n                    $($event.target).blur();\r\n                }\r\n            };\r\n            $scope.permissionRuleEditorParams = {\r\n                show: false,\r\n                action: null\r\n            };\r\n            $scope.refresh = function () {\r\n                _this.updateCurrentAuthorizables();\r\n                return _this.updateExplicitPermissions(_this.$scope.currentAuthorizables);\r\n            };\r\n            $scope.addUserOrGroupSelector = {\r\n                isShown: false\r\n            };\r\n            $scope.addNewUserPermission = function (user) {\r\n                if (!user) {\r\n                    return;\r\n                }\r\n                _this.addNewGranteePermissions(_this.granteePermissionsFactory.createForUserWithUnspecifiedPermissions(user, _this.$scope.authorizableType));\r\n            };\r\n            $scope.addNewGroupPermission = function (group) {\r\n                if (!group) {\r\n                    return;\r\n                }\r\n                _this.addNewGranteePermissions(_this.granteePermissionsFactory.createForGroupWithUnspecifiedPermissions(group, _this.$scope.authorizableType));\r\n            };\r\n            $scope.haveCurrentAuthorizable = function () {\r\n                return (_this.$scope.authorizables.size() > 0);\r\n            };\r\n            $scope.getTooltipText = function ($event) {\r\n                return $($event.target)\r\n                    .closest('.tb-capability-value-cell')\r\n                    .find('.tb-capability-value')\r\n                    .attr('data-tooltip');\r\n            };\r\n            $scope.getHeaderTooltipText = function ($event) {\r\n                if ($scope.headerTextAccordion.isSectionOpen(0))\r\n                    return null;\r\n                return $($event.target)\r\n                    .closest('.tb-permissions-capability-header-icon-cell')\r\n                    .find('.tb-permissions-capability-icon')\r\n                    .attr('data-tooltip');\r\n            };\r\n            // synchronize x-scrolling of the effective and explicit permissions panels.\r\n            $scope.scrollLeftChanged = function (scrollLeft) {\r\n                // position the headers correctly relative to the explicit permissions body\r\n                $element.find('.tb-explicit-permissions-headers-line').css({ 'left': -scrollLeft + 'px' });\r\n                // make sure the background rows in both panels are rendered wide enough.\r\n                // right: 0 isn't far enough when .tb-data-grid-body-columns is overflowing.\r\n                $element.find('.tb-data-grid-body-background').css({ 'right': -scrollLeft + 'px' });\r\n                _this.$scope.explicitPermissionsPanelControls.scrollControls.setScrollLeft(scrollLeft);\r\n                if (_this.$scope.effectivePermissionsPanelControls.scrollControls) {\r\n                    _this.$scope.effectivePermissionsPanelControls.scrollControls.setScrollLeft(scrollLeft);\r\n                }\r\n            };\r\n            $scope.sectionGroupAccordion = ($scope.authorizableType === VizPortal.ContentTypes.project)\r\n                ? new VizPortal.SingleSectionAccordion() : VizPortal.StaticAccordion;\r\n            $scope.headerTextAccordion = new VizPortal.SingleSectionAccordion();\r\n            $scope.shortHeaderText = function () {\r\n                switch (VizPortal.L10n.language) {\r\n                    case 'de': return false;\r\n                    case 'en': return true;\r\n                    case 'es': return false;\r\n                    case 'fr': return false;\r\n                    case 'ja': return true;\r\n                    case 'ko': return true;\r\n                    case 'pt': return false;\r\n                    case 'zh': return true;\r\n                }\r\n                return false;\r\n            };\r\n            $scope.menuActions = permissionsPanelActions.getActionButtons($scope);\r\n            // to hide/unhide the \"assign...\" button\r\n            $scope.projectControlledPermissionsEnabled = VizPortal.FeatureFlags.projectControlledPermissionsEnabled;\r\n            $scope.permissionsLockStatusProps = {\r\n                lockState: VizPortal.LockStatusHelper.getLockState(this.$scope.authorizables),\r\n                translate: $translate.instant\r\n            };\r\n            $scope.refresh();\r\n        }\r\n        PermissionsPanelCtrl.prototype.setCurrentExplicitPermission = function (explicitPermission) {\r\n            if (this.$scope.currentExplicitPermission !== explicitPermission) {\r\n                this.$scope.currentExplicitPermission = explicitPermission;\r\n                this.updateEffectivePermissions();\r\n            }\r\n        };\r\n        PermissionsPanelCtrl.prototype.addNewGranteePermissions = function (newGranteePermissions) {\r\n            var _this = this;\r\n            this.$scope.addUserOrGroupSelector.isShown = false;\r\n            var explicitPermissions = this.explicitPermissionsList.items;\r\n            var index = this.getGranteeIndex(newGranteePermissions);\r\n            if (VizPortal.PermissionsHelper.hasSameGrantee(newGranteePermissions, explicitPermissions[index])) {\r\n                this.startEditingRule(index, VizPortal.PermissionRuleEditorCommands.edit);\r\n            }\r\n            else {\r\n                explicitPermissions.splice(index, 0, newGranteePermissions);\r\n                this.$scope.explicitPermissions = this.sliceableFactory.fromArray(explicitPermissions);\r\n                // Wait for the scroll control to see the new list before proceeding.\r\n                var stopListening = this.$scope.$on(VizPortal.ScrollCtrl.ItemsChangeEvent, function () {\r\n                    stopListening();\r\n                    _this.startEditingRule(index, VizPortal.PermissionRuleEditorCommands.add);\r\n                });\r\n            }\r\n        };\r\n        PermissionsPanelCtrl.prototype.getGranteeIndex = function (granteePermissions) {\r\n            return _.sortedIndex(this.explicitPermissionsList.items, granteePermissions, function (gp) {\r\n                return VizPortal.PermissionsHelper.compareGrantees(gp, granteePermissions);\r\n            });\r\n        };\r\n        PermissionsPanelCtrl.prototype.startEditingRule = function (index, action) {\r\n            var _this = this;\r\n            this.setCurrentExplicitPermission(this.explicitPermissionsList.items[index]);\r\n            this.$scope.explicitPermissionsPanelControls.scrollControls.scrollIntoView(index);\r\n            this.$timeout(function () {\r\n                _this.$scope.permissionRuleEditorParams.action = action;\r\n                _this.$scope.permissionRuleEditorParams.show = true;\r\n            });\r\n        };\r\n        PermissionsPanelCtrl.prototype.showPermissionRuleEditor = function (action) {\r\n            this.$scope.permissionRuleEditorParams.action = action;\r\n            this.$scope.permissionRuleEditorParams.show = true;\r\n        };\r\n        PermissionsPanelCtrl.prototype.hidePermissionRuleEditor = function () {\r\n            this.$scope.permissionRuleEditorParams.show = false;\r\n        };\r\n        PermissionsPanelCtrl.prototype.updateCurrentAuthorizables = function () {\r\n            this.$scope.currentAuthorizables = {\r\n                type: this.$scope.authorizableType,\r\n                ids: this.$scope.authorizables.keys()\r\n            };\r\n        };\r\n        PermissionsPanelCtrl.prototype.updateExplicitPermissions = function (authorizables) {\r\n            var _this = this;\r\n            return this.explicitPermissions.forAuthorizables(authorizables)\r\n                .then(function (result) {\r\n                if (result) {\r\n                    _this.explicitPermissionsList = result.permissionsList;\r\n                    if (VizPortal.FeatureFlags.projectControlledPermissionsEnabled) {\r\n                        var editabilityLogic = _this.permissionsEditabilityLogicFactory.logicForAuthorizables(_this.$scope.authorizables, _this.$scope.authorizableType, result.sourceAuthorizablesById);\r\n                        _this.$scope.editability = editabilityLogic.getEditabilityWithMessages();\r\n                    }\r\n                    _this.explicitPermissionsList.items.sort(VizPortal.PermissionsHelper.compareGrantees);\r\n                    _this.effectivePermissionsFetcher.setAuthorizables(authorizables);\r\n                    _this.updateExplicitPermissionsSlice();\r\n                    _this.updateEffectivePermissions();\r\n                }\r\n            });\r\n        };\r\n        // TODO: This is the legacy implementation pre-feature-flag. Delete it when the flag is gone.\r\n        PermissionsPanelCtrl.prototype.setMissingCapabilitiesToUnspecified = function (items) {\r\n            var capabilities = _.keys(this.permissionRoles.getPermissionsForTypeAndRole(this.$scope.authorizableType, VizPortal.L10n.Keys.none));\r\n            _.each(items, function (gp) {\r\n                _.each(capabilities, function (capability) {\r\n                    if (!_.has(gp.permissions, capability)) {\r\n                        gp.permissions[capability] = { permission: VizPortal.Permission.Unspecified, reason: VizPortal.PermissionReason.Unspecified };\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        PermissionsPanelCtrl.prototype.setMissingCapabilitiesForSectionsToUnspecified = function (items) {\r\n            var _this = this;\r\n            _.each(VizPortal.PermissionsHelper.getPermissionsContentTypes(this.$scope.authorizableType), function (contentType) {\r\n                var capabilities = _.keys(_this.permissionRoles.getPermissionsForTypeAndRole(contentType, VizPortal.L10n.Keys.none));\r\n                _.each(items, function (gp) {\r\n                    if (!_.has(gp.permissionsByContentType, contentType)) {\r\n                        gp.permissionsByContentType[contentType] = {};\r\n                    }\r\n                    var permissionsForContentType = gp.permissionsByContentType[contentType];\r\n                    _.each(capabilities, function (capability) {\r\n                        if (!_.has(permissionsForContentType, capability)) {\r\n                            permissionsForContentType[capability] = {\r\n                                permission: VizPortal.Permission.Unspecified,\r\n                                reason: VizPortal.PermissionReason.Unspecified\r\n                            };\r\n                        }\r\n                    });\r\n                });\r\n            });\r\n        };\r\n        PermissionsPanelCtrl.prototype.updateExplicitPermissionsSlice = function () {\r\n            var items = this.explicitPermissionsList.items;\r\n            if (!VizPortal.FeatureFlags.projectPermissionsTemplatesEnabled) {\r\n                this.setMissingCapabilitiesToUnspecified(items);\r\n            }\r\n            else {\r\n                this.setMissingCapabilitiesForSectionsToUnspecified(items);\r\n            }\r\n            this.$scope.explicitPermissions = this.sliceableFactory.fromArray(items);\r\n            var current = this.$scope.currentExplicitPermission;\r\n            if (current) {\r\n                this.$scope.currentExplicitPermission =\r\n                    _.find(items, function (item) { return VizPortal.PermissionsHelper.hasSameGrantee(item, current); });\r\n            }\r\n        };\r\n        PermissionsPanelCtrl.prototype.updateEffectivePermissions = function (searchText) {\r\n            this.$scope.isLoadingEffectivePermissions = true;\r\n            this.hoveredEffectivePermission = null;\r\n            var current = this.$scope.currentExplicitPermission;\r\n            if (current) {\r\n                var filterClauses = [];\r\n                // add a filter clause for the current group or user\r\n                if (current.group) {\r\n                    filterClauses.push(VizPortal.Filter.stringArrayFieldHas('groupIds', current.group.id));\r\n                }\r\n                else if (current.user) {\r\n                    filterClauses.push(VizPortal.Filter.stringFieldEq('id', current.user.id));\r\n                }\r\n                // add a filter clause for the current search text\r\n                if (searchText) {\r\n                    filterClauses.push(VizPortal.Filter.search(searchText));\r\n                }\r\n                // fetch the effective permissions\r\n                var effectivePermissionsFetchParams = {\r\n                    filter: VizPortal.Filter.and(filterClauses),\r\n                    order: [{ field: VizPortal.ServerApi.UserKeys.displayName, ascending: true }]\r\n                };\r\n                this.$scope.effectivePermissions = new VizPortal.PagedList(this.effectivePermissionsFetcher, effectivePermissionsFetchParams);\r\n            }\r\n            else {\r\n                this.$scope.effectivePermissions = this.sliceableFactory.fromArray();\r\n            }\r\n            this.$scope.isLoadingEffectivePermissions = false;\r\n        };\r\n        PermissionsPanelCtrl.prototype.updateGroupMembership = function (userIds) {\r\n            var _this = this;\r\n            if (userIds && userIds.length > 0) {\r\n                this.server.sendRequest(new VizPortal.ServerApi.GetUsersGroupMembershipRequest({ userIds: userIds }))\r\n                    .then(function (result) {\r\n                    _this.groupMembership = {};\r\n                    _.each(result.members, function (member) {\r\n                        var userGroups = _this.groupMembership[member.userId];\r\n                        if (!userGroups) {\r\n                            userGroups = {};\r\n                            _this.groupMembership[member.userId] = userGroups;\r\n                        }\r\n                        userGroups[member.groupId] = true;\r\n                    });\r\n                });\r\n            }\r\n            else {\r\n                this.groupMembership = {};\r\n            }\r\n        };\r\n        PermissionsPanelCtrl.prototype.isRelevantExplicitPermission = function (explicitPermission) {\r\n            if (this.hoveredEffectivePermission && !this.$scope.permissionRuleEditorParams.show) {\r\n                var currentUser = this.hoveredEffectivePermission.user;\r\n                if (currentUser) {\r\n                    if (explicitPermission.group) {\r\n                        // group rule\r\n                        if (this.groupMembership) {\r\n                            // is the user a member of this group?\r\n                            var userGroups = this.groupMembership[currentUser.id];\r\n                            return userGroups && _.has(userGroups, explicitPermission.group.id);\r\n                        }\r\n                    }\r\n                    else {\r\n                        // user rule\r\n                        return explicitPermission.user && (explicitPermission.user.id === currentUser.id);\r\n                    }\r\n                }\r\n            }\r\n            return false;\r\n        };\r\n        /**\r\n         * Tests if the current explicit permission is not relevant and thus should be visually greyed out.\r\n         */\r\n        PermissionsPanelCtrl.prototype.isNotRelevantExplicitPermission = function (explicitPermission) {\r\n            return this.hoveredEffectivePermission && !this.isRelevantExplicitPermission(explicitPermission);\r\n        };\r\n        /**\r\n         * returns the string 'relevant', 'normal', or 'not', which is used as a suffix to the class tb-relevant-capability-\r\n         */\r\n        PermissionsPanelCtrl.prototype.relevantCapabilityClass = function (explicitPermission, contentType, capability, capabilityName) {\r\n            if (!this.hoveredEffectivePermission || this.$scope.permissionRuleEditorParams.show) {\r\n                return 'normal';\r\n            }\r\n            if (explicitPermission && this.isRelevantExplicitPermission(explicitPermission)) {\r\n                if (!this.hoveredCapabilityValue) {\r\n                    // When the user is hovering on an effective permissions row but not any capability value cell, we show all the cells as 'normal'\r\n                    return 'normal';\r\n                }\r\n                else if (this.hoveredCapabilityValue === capabilityName) {\r\n                    var currEffectivePermission = VizPortal.PermissionsHelper.permissionFromIGranteePermission(this.hoveredEffectivePermission, contentType, capability);\r\n                    var currExplicitPermission = VizPortal.PermissionsHelper.permissionFromIGranteePermission(explicitPermission, contentType, capability);\r\n                    if (currEffectivePermission && currExplicitPermission) {\r\n                        if (explicitPermission.group) {\r\n                            // group rule\r\n                            switch (currExplicitPermission.permission) {\r\n                                case VizPortal.Permission.Allowed: return (VizPortal.PermissionReason.GroupAllow === currEffectivePermission.reason) ? 'relevant' : 'not';\r\n                                case VizPortal.Permission.Denied: return (VizPortal.PermissionReason.GroupDeny === currEffectivePermission.reason) ? 'relevant' : 'not';\r\n                            }\r\n                        }\r\n                        else if (explicitPermission.user) {\r\n                            // user rule\r\n                            switch (currExplicitPermission.permission) {\r\n                                case VizPortal.Permission.Allowed: return (VizPortal.PermissionReason.UserAllow === currEffectivePermission.reason) ? 'relevant' : 'not';\r\n                                case VizPortal.Permission.Denied: return (VizPortal.PermissionReason.UserDeny === currEffectivePermission.reason) ? 'relevant' : 'not';\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return 'not';\r\n        };\r\n        PermissionsPanelCtrl.prototype.userStatusForRow = function (row, contentType) {\r\n            // In the PermissionReasons enum, superuser allows are the highest precedence\r\n            // (except for 'mixed', but a superuser's permission reasons shouldn't be mixed.)\r\n            // So we can ignore mixed, and infer superuser status from the highest-precedence reason.\r\n            var maxReason = VizPortal.PermissionReason.Unspecified;\r\n            var permissions = VizPortal.PermissionsHelper.permissionsFromIGranteePermission(row, contentType);\r\n            _.each(permissions, function (permission) {\r\n                if (permission.reason < VizPortal.PermissionReason.Mixed) {\r\n                    maxReason = Math.max(maxReason, permission.reason);\r\n                }\r\n            });\r\n            switch (maxReason) {\r\n                case VizPortal.PermissionReason.UserAuthorizableOwnerAllow: return 'owner';\r\n                case VizPortal.PermissionReason.GroupProjectLeaderAllow: return 'project_leader';\r\n                case VizPortal.PermissionReason.UserProjectLeaderAllow: return 'project_leader';\r\n                case VizPortal.PermissionReason.UserProjectOwnerAllow: return 'project_owner';\r\n                case VizPortal.PermissionReason.UserAdminAllow: return 'admin';\r\n                default:\r\n                    return VizPortal.PermissionsHelper.effectiveGranteeRole(row, contentType, this.permissionRoles);\r\n            }\r\n        };\r\n        PermissionsPanelCtrl.$inject = [\r\n            '$scope',\r\n            '$element',\r\n            '$q',\r\n            '$timeout',\r\n            '$translate',\r\n            'PermissionsPanelActions',\r\n            'SliceableFactory',\r\n            'ServerService',\r\n            'ExplicitPermissions',\r\n            'EffectivePermissionsService',\r\n            'PermissionRoles',\r\n            'PermissionsEditabilityLogicFactory',\r\n            'BrowserSupportService',\r\n            'GranteePermissionsFactory'\r\n        ];\r\n        return PermissionsPanelCtrl;\r\n    })();\r\n    VizPortal.PermissionsPanelCtrl = PermissionsPanelCtrl;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../FeatureFlags.ts\" />\r\n/// <reference path=\"../controllers/PermissionsPanelCtrl.ts\" />\r\n/// <reference path=\"../helpers/AccordionState.ts\" />\r\n/// <reference path=\"../helpers/PermissionsHelper.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../models/ColumnWidths.ts\" />\r\n/// <reference path=\"../models/IGranteePermissions.ts\" />\r\n/// <reference path=\"../models/ITemplate.ts\" />\r\n/// <reference path=\"../models/Permission.ts\" />\r\n/// <reference path=\"../models/PermissionRoles.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../resources/ExplicitPermissions.ts\" />\r\n/// <reference path=\"../services/ToasterService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.PermissionRuleEditorCommands = {\r\n        add: 'add',\r\n        edit: 'edit',\r\n        delete_: 'delete'\r\n    };\r\n    var PermissionEditorTemplateUrl = (function () {\r\n        function PermissionEditorTemplateUrl() {\r\n        }\r\n        PermissionEditorTemplateUrl.forAuthorizableType = function (authorizableType) {\r\n            return (VizPortal.FeatureFlags.projectPermissionsTemplatesEnabled) ?\r\n                authorizableType + 'PermissionsEditor.html' :\r\n                authorizableType + 'PermissionsEditorWithoutPermissionsTemplates.html';\r\n        };\r\n        return PermissionEditorTemplateUrl;\r\n    })();\r\n    var PermissionRuleEditorCtrl = (function () {\r\n        function PermissionRuleEditorCtrl($scope, explicitPermissions, permissionRoles, $translate, toaster) {\r\n            var _this = this;\r\n            this.scope = $scope;\r\n            this.explicitPermissions = explicitPermissions;\r\n            this.permissionRoles = permissionRoles;\r\n            this.$translate = $translate;\r\n            this.toaster = toaster;\r\n            this.scope.explicitGranteeRole = function (row, contentType) {\r\n                return VizPortal.PermissionsHelper.explicitGranteeRole(row, contentType, _this.permissionRoles);\r\n            };\r\n            this.scope.granteeType = VizPortal.PermissionsHelper.granteeType;\r\n            this.scope.granteeName = VizPortal.PermissionsHelper.granteeName;\r\n            this.scope.capabilityValue = VizPortal.PermissionsHelper.capabilityValue;\r\n            this.scope.capabilityTitleKey = VizPortal.PermissionsHelper.capabilityTitleKey;\r\n            this.scope.busy = false;\r\n            this.updateColumnWidths();\r\n            this.authorizableType = $scope.authorizables.type;\r\n            this.scope.permissionsEditorTemplates = PermissionEditorTemplateUrl.forAuthorizableType($scope.authorizables.type);\r\n            // The row needs to be nested inside the data object so that when a different row is selected, the new row is\r\n            // seen by the editor templates. This is because tbTranscludeFn doesn't watch tbTranscludeScope for new data.\r\n            this.scope.data = { row: null };\r\n            this.initializeFromSelectedRow();\r\n            this.scope.resize = function (xPos) {\r\n                $scope.$apply(function () {\r\n                    $scope.columnWidths.resizer.continueResize(xPos);\r\n                });\r\n            };\r\n        }\r\n        PermissionRuleEditorCtrl.prototype.initializeFromSelectedRow = function () {\r\n            var _this = this;\r\n            // Clone the row. The editor never changes the original row. It builds a new one and saves it to the server.\r\n            this.scope.data.row = this.deepCopy(this.scope.selectedRow);\r\n            this.scope.selectedRoleByContentType = {}; // key: authorizable type, value: role\r\n            // Each content type has it's own list of available roles\r\n            if (VizPortal.FeatureFlags.projectPermissionsTemplatesEnabled) {\r\n                _.each(_.keys(this.scope.data.row.permissionsByContentType), function (contentType) {\r\n                    return _this.scope.selectedRoleByContentType[contentType] = VizPortal.PermissionsHelper.explicitGranteeRole(_this.scope.data.row, contentType, _this.permissionRoles);\r\n                });\r\n            }\r\n            else {\r\n                this.scope.selectedRoleByContentType[this.authorizableType] = VizPortal.PermissionsHelper.explicitGranteeRole(this.scope.data.row, this.authorizableType, this.permissionRoles);\r\n            }\r\n        };\r\n        PermissionRuleEditorCtrl.prototype.getTooltipText = function ($event) {\r\n            return $($event.target)\r\n                .closest('.tb-capability-value-cell')\r\n                .find('.tb-capability-value')\r\n                .attr('data-tooltip');\r\n        };\r\n        PermissionRuleEditorCtrl.prototype.savePermissionRule = function () {\r\n            var _this = this;\r\n            var granteePermissions = this.scope.data.row;\r\n            this.scope.busy = true;\r\n            // clone the permissions so that any changes aren't rendered in the UI while saving.\r\n            var newPermissions = {};\r\n            var newPermissionsByContentType = {};\r\n            var newGranteePermissions = _.clone(granteePermissions);\r\n            // TODO: refactor this block of code to remove nested if/else\r\n            if (this.scope.action === VizPortal.PermissionRuleEditorCommands.delete_) {\r\n                if (VizPortal.FeatureFlags.projectPermissionsTemplatesEnabled) {\r\n                    newPermissionsByContentType = this.cloneAllPermissionsToUnspecified(granteePermissions.permissionsByContentType);\r\n                }\r\n                else {\r\n                    // To delete a rule, set all permissions to unspecified.\r\n                    _.each(granteePermissions.permissions, function (permission, capability) {\r\n                        newPermissions[capability] = {\r\n                            permission: VizPortal.Permission.Unspecified,\r\n                            reason: VizPortal.PermissionReason.Unspecified\r\n                        };\r\n                    });\r\n                }\r\n            }\r\n            else {\r\n                // It would be incorrect to send 'mixed' permissions to the server, so 'mixed' permissions are not cloned.\r\n                // Unchanged permissions are not cloned because only changed permissions are sent to the server.\r\n                if (VizPortal.FeatureFlags.projectPermissionsTemplatesEnabled) {\r\n                    _.each(granteePermissions.permissionsByContentType, function (permissions, contentType) {\r\n                        newPermissionsByContentType[contentType] = {};\r\n                        _.each(permissions, function (permission, capability) {\r\n                            if (permission.permission !== VizPortal.Permission.Mixed && permission.permission !== _this.scope.selectedRow.permissionsByContentType[contentType][capability].permission) {\r\n                                newPermissionsByContentType[contentType][capability] = permission;\r\n                            }\r\n                        });\r\n                    });\r\n                }\r\n                else {\r\n                    _.each(granteePermissions.permissions, function (permission, capability) {\r\n                        if (permission.permission !== VizPortal.Permission.Mixed && permission.permission !== _this.scope.selectedRow.permissions[capability].permission) {\r\n                            newPermissions[capability] = permission;\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n            newGranteePermissions.permissions = newPermissions;\r\n            newGranteePermissions.permissionsByContentType = newPermissionsByContentType;\r\n            this.explicitPermissions.setForAuthorizables(this.scope.authorizables, newGranteePermissions)\r\n                .then(function () { return _this.scope.updateAuthorizables(); })\r\n                .then(function () {\r\n                _this.scope.hideRowMenu();\r\n                _this.toaster.pop({\r\n                    type: VizPortal.ToastType.Info,\r\n                    text: _this.$translate.instant('permissionRuleChangedSuccess', {\r\n                        GRANTEE_NAME: VizPortal.L10n.elideIfLong(_this.scope.granteeName(granteePermissions))\r\n                    })\r\n                });\r\n            })\r\n                .fin(function () { return _this.scope.busy = false; });\r\n        };\r\n        /**\r\n         *  Creates a copy of the permissionsByContentType dictionary which has all permissions set to unspecified. This is used to delete a permission rule.\r\n         *  TODO: push this logic into a delete permission rule method in the ExplicitPermisions resource.\r\n         */\r\n        PermissionRuleEditorCtrl.prototype.cloneAllPermissionsToUnspecified = function (permissionsByContentType) {\r\n            return _.reduce(permissionsByContentType, function (permissionsByContentType, value, index) {\r\n                permissionsByContentType[index] = _.reduce(value, function (permissions, value, index) {\r\n                    permissions[index] = {\r\n                        permission: VizPortal.Permission.Unspecified,\r\n                        reason: VizPortal.PermissionReason.Unspecified\r\n                    };\r\n                    return permissions;\r\n                }, {});\r\n                return permissionsByContentType;\r\n            }, {});\r\n        };\r\n        PermissionRuleEditorCtrl.prototype.saveDisabled = function () {\r\n            return !this.scope.isDeleteActionSelected() && _.isEqual(this.scope.data.row, this.scope.selectedRow);\r\n        };\r\n        PermissionRuleEditorCtrl.prototype.getCapabilitiesForRole = function (role) {\r\n            var permissions = this.permissionRoles.getPermissionsForTypeAndRole(this.authorizableType, role);\r\n            return VizPortal.PermissionsHelper.IPermissionsFromPermissions(permissions);\r\n        };\r\n        PermissionRuleEditorCtrl.prototype.getCapabilitiesForTypeAndRole = function (contentType, role) {\r\n            var permissions = this.permissionRoles.getPermissionsForTypeAndRole(contentType, role);\r\n            return VizPortal.PermissionsHelper.IPermissionsFromPermissions(permissions);\r\n        };\r\n        PermissionRuleEditorCtrl.prototype.updateColumnWidths = function () {\r\n            var _this = this;\r\n            if (VizPortal.FeatureFlags.projectPermissionsTemplatesEnabled) {\r\n                this.scope.columnWidths = this.scope.permissionsPanelColumnWidths;\r\n            }\r\n            else {\r\n                // This is necessary because the role dropdown needs more space than is provided for in the initial layout of the\r\n                // column widths in the underlying datagrid. To account for this, we tell it to use the space owned by the\r\n                // edit and delete buttons in the permissions panel row since those aren't rendered in the editable row anyway.\r\n                this.scope.columnWidths = {\r\n                    getActual: function (index) {\r\n                        if (index === 0) {\r\n                            return _this.scope.permissionsPanelColumnWidths.getActual(0);\r\n                        }\r\n                        else if (index === 1) {\r\n                            return _this.scope.permissionsPanelColumnWidths.getActual(1)\r\n                                + _this.scope.permissionsPanelColumnWidths.getActual(2)\r\n                                + _this.scope.permissionsPanelColumnWidths.getActual(3);\r\n                        }\r\n                        else {\r\n                            return _this.scope.permissionsPanelColumnWidths.getActual(index + 2);\r\n                        }\r\n                    }\r\n                };\r\n            }\r\n        };\r\n        PermissionRuleEditorCtrl.prototype.deepCopy = function (row) {\r\n            return jQuery.extend(true, {}, row);\r\n        };\r\n        PermissionRuleEditorCtrl.$inject = [\r\n            '$scope',\r\n            'ExplicitPermissions',\r\n            'PermissionRoles',\r\n            '$translate',\r\n            'ToasterService'\r\n        ];\r\n        return PermissionRuleEditorCtrl;\r\n    })();\r\n    VizPortal.PermissionRuleEditorCtrl = PermissionRuleEditorCtrl;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var Languages = (function () {\r\n        function Languages($translate, server) {\r\n            this.$translate = $translate;\r\n            this.server = server;\r\n        }\r\n        Languages.prototype.getAll = function () {\r\n            return this.server.sendRequest(new VizPortal.ServerApi.GetLanguagesRequest()).then(function (result) { return result.languages; });\r\n        };\r\n        // a special value for the user language that indicates that we should use the server language\r\n        Languages.prototype.unspecifiedLanguage = function () {\r\n            return {\r\n                displayName: this.$translate.instant(\"unspecified\"),\r\n                language: null,\r\n                locale: null\r\n            };\r\n        };\r\n        Languages.$inject = ['$translate', 'ServerService'];\r\n        return Languages;\r\n    })();\r\n    VizPortal.Languages = Languages;\r\n    VizPortal.Module.instance().service('Languages', Languages);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var Locales = (function () {\r\n        function Locales($translate, server) {\r\n            this.$translate = $translate;\r\n            this.server = server;\r\n        }\r\n        Locales.prototype.getAll = function () {\r\n            return this.server.sendRequest(new VizPortal.ServerApi.GetLocalesRequest()).then(function (result) { return result.locales; });\r\n        };\r\n        // a special value for the user locale that indicates that we should use the server locale\r\n        Locales.prototype.unspecifiedLocale = function () {\r\n            return {\r\n                displayName: this.$translate.instant(\"unspecified\"),\r\n                locale: null\r\n            };\r\n        };\r\n        Locales.$inject = ['$translate', 'ServerService'];\r\n        return Locales;\r\n    })();\r\n    VizPortal.Locales = Locales;\r\n    VizPortal.Module.instance().service('Locales', Locales);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var ClearSavedPasswordsRequest = (function (_super) {\r\n            __extends(ClearSavedPasswordsRequest, _super);\r\n            function ClearSavedPasswordsRequest(params) {\r\n                if (params === void 0) { params = {}; }\r\n                _super.call(this, 'clearSavedPasswords', params);\r\n            }\r\n            return ClearSavedPasswordsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.ClearSavedPasswordsRequest = ClearSavedPasswordsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/ILanguage.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetLanguagesRequest = (function (_super) {\r\n            __extends(GetLanguagesRequest, _super);\r\n            function GetLanguagesRequest(params) {\r\n                if (params === void 0) { params = {}; }\r\n                _super.call(this, 'getLanguages', params);\r\n            }\r\n            return GetLanguagesRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetLanguagesRequest = GetLanguagesRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/ILocale.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetLocalesRequest = (function (_super) {\r\n            __extends(GetLocalesRequest, _super);\r\n            function GetLocalesRequest(params) {\r\n                if (params === void 0) { params = {}; }\r\n                _super.call(this, 'getLocales', params);\r\n            }\r\n            return GetLocalesRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetLocalesRequest = GetLocalesRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\n/// <reference path=\"../types/IEditableServerSettings.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetServerSettingsRequest = (function (_super) {\r\n            __extends(GetServerSettingsRequest, _super);\r\n            function GetServerSettingsRequest(params) {\r\n                _super.call(this, 'getServerSettings', params);\r\n            }\r\n            return GetServerSettingsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetServerSettingsRequest = GetServerSettingsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetTotalRefreshTokenCountRequest = (function (_super) {\r\n            __extends(GetTotalRefreshTokenCountRequest, _super);\r\n            function GetTotalRefreshTokenCountRequest(params) {\r\n                _super.call(this, 'getTotalRefreshTokenCount', params);\r\n            }\r\n            return GetTotalRefreshTokenCountRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetTotalRefreshTokenCountRequest = GetTotalRefreshTokenCountRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var ResetServerSettingsRequest = (function (_super) {\r\n            __extends(ResetServerSettingsRequest, _super);\r\n            function ResetServerSettingsRequest(params) {\r\n                if (params === void 0) { params = {}; }\r\n                _super.call(this, 'resetServerSettings', params);\r\n            }\r\n            return ResetServerSettingsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.ResetServerSettingsRequest = ResetServerSettingsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var RunActiveDirectoryGroupsSyncRequest = (function (_super) {\r\n            __extends(RunActiveDirectoryGroupsSyncRequest, _super);\r\n            function RunActiveDirectoryGroupsSyncRequest(params) {\r\n                if (params === void 0) { params = {}; }\r\n                _super.call(this, 'runActiveDirectoryGroupsSyncTask', params);\r\n            }\r\n            return RunActiveDirectoryGroupsSyncRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.RunActiveDirectoryGroupsSyncRequest = RunActiveDirectoryGroupsSyncRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        ServerApi.UpdateBooleanServerSettingNames = {\r\n            embeddedCredentialsEnabled: 'embeddedCredentialsEnabled',\r\n            schedulingEnabled: 'schedulingEnabled',\r\n            savedPasswordsEnabled: 'savedPasswordsEnabled',\r\n            savedAccessTokensEnabled: 'savedAccessTokensEnabled',\r\n            guestEnabled: 'guestEnabled',\r\n            scheduledActiveDirectorySyncEnabled: 'scheduledActiveDirectorySyncEnabled',\r\n            refreshTokensEnabled: 'refreshTokensEnabled'\r\n        };\r\n        var UpdateBooleanServerSettingRequest = (function (_super) {\r\n            __extends(UpdateBooleanServerSettingRequest, _super);\r\n            function UpdateBooleanServerSettingRequest(params) {\r\n                _super.call(this, 'updateBooleanServerSetting', params);\r\n            }\r\n            return UpdateBooleanServerSettingRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.UpdateBooleanServerSettingRequest = UpdateBooleanServerSettingRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        ServerApi.UpdateScheduleFrequencyServerSettingName = 'activeDirectorySyncScheduleFrequency';\r\n        var UpdateScheduleFrequencyServerSettingRequest = (function (_super) {\r\n            __extends(UpdateScheduleFrequencyServerSettingRequest, _super);\r\n            function UpdateScheduleFrequencyServerSettingRequest(params) {\r\n                _super.call(this, 'updateScheduleFrequencyServerSetting', params);\r\n            }\r\n            return UpdateScheduleFrequencyServerSettingRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.UpdateScheduleFrequencyServerSettingRequest = UpdateScheduleFrequencyServerSettingRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var UpdateStringServerSettingRequest = (function (_super) {\r\n            __extends(UpdateStringServerSettingRequest, _super);\r\n            function UpdateStringServerSettingRequest(params) {\r\n                _super.call(this, 'updateStringServerSetting', params);\r\n            }\r\n            return UpdateStringServerSettingRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.UpdateStringServerSettingRequest = UpdateStringServerSettingRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../../app/IMainScope.ts\" />\r\n/// <reference path=\"../controllers/CreateOrEditScheduleCtrl.ts\" />\r\n/// <reference path=\"../controllers/CreateOrEditScheduleViewModelMapper.ts\" />\r\n/// <reference path=\"../directives/tbSettingsCoordinator.ts\" />\r\n/// <reference path=\"../helpers/ResultHelper.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../resources/Languages.ts\" />\r\n/// <reference path=\"../resources/Locales.ts\" />\r\n/// <reference path=\"../resources/ServerSettings.ts\" />\r\n/// <reference path=\"../ServerApi/requests/ClearSavedPasswordsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetLanguagesRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetLocalesRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetServerSettingsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetTotalRefreshTokenCountRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/ResetServerSettingsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/RunActiveDirectoryGroupsSyncRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/UpdateBooleanServerSettingRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/UpdateScheduleFrequencyServerSettingRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/UpdateStringServerSettingRequest.ts\" />\r\n/// <reference path=\"../ServerApi/types/IEditableServerSettings.ts\" />\r\n/// <reference path=\"../services/ConfirmActionDialog.ts\" />\r\n/// <reference path=\"../services/HelpService.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerSettingsFormCtrl = (function () {\r\n        function ServerSettingsFormCtrl(scope, $state, $q, $translate, server, ServerSettings, languages, locales, toasterService, confirmActionDialog, help) {\r\n            var _this = this;\r\n            this.scope = scope;\r\n            this.$state = $state;\r\n            this.$q = $q;\r\n            this.$translate = $translate;\r\n            this.server = server;\r\n            this.ServerSettings = ServerSettings;\r\n            this.languages = languages;\r\n            this.locales = locales;\r\n            this.toasterService = toasterService;\r\n            this.confirmActionDialog = confirmActionDialog;\r\n            this.help = help;\r\n            this.languageOrLocaleChanged = false;\r\n            this.scope.serverSettingsPending = false;\r\n            this.scope.server = this.server;\r\n            this.scope.updateDefaultLanguage = function (value) { return _this.scope.serverSettings.defaultLanguage = value; };\r\n            this.scope.updateDefaultLocale = function (value) { return _this.scope.serverSettings.defaultLocale = value; };\r\n            this.scope.clearSavedCredentials = function () { return _this.clearSavedCredentials(); };\r\n            this.scope.resetSettings = function () { return _this.resetSettings(); };\r\n            this.scope.isScheduledADSyncAllowed = this.server.isServerDomainFamilyActiveDirectory();\r\n            this.scope.runActiveDirectoryGroupsSync = function () { return _this.runActiveDirectoryGroupsSync(); };\r\n            this.scope.viewUpdateHref = $state.href('main.server.analysis', { sheetUrlId: 'BackgroundTasksforNonExtracts' });\r\n            this.scope.learnMoreHref = this.help.getServerHelpUrlByCategory('settings-adsync1');\r\n            this.scope.scheduleViewModel = VizPortal.CreateOrEditScheduleViewModelMapper.viewModelFromScheduleFrequency(this.scope.serverSettings.activeDirectorySyncScheduleFrequency);\r\n            this.scope.serverSettingsFormState = {\r\n                save: function () { return _this.save(); },\r\n                cancel: function () {\r\n                    _this.scope.serverSettings = angular.copy(_this.masterSettings);\r\n                    _this.scope.scheduleViewModel = angular.copy(_this.originalScheduleViewModel);\r\n                },\r\n                isBusy: function () { return _this.scope.serverSettingsPending; },\r\n                isFormUnchanged: function () {\r\n                    return angular.equals(_this.scope.serverSettings, _this.masterSettings)\r\n                        && angular.equals(_this.scope.scheduleViewModel, _this.originalScheduleViewModel);\r\n                },\r\n                resetSettings: function () { return _this.scope.resetSettings(); },\r\n                onSave: function () { return _this.hardReloadIfNeeded(); }\r\n            };\r\n            this.masterSettings = angular.copy(this.scope.serverSettings);\r\n            this.originalScheduleViewModel = angular.copy(this.scope.scheduleViewModel);\r\n            this.getLanguages();\r\n            this.getLocales();\r\n            this.getTotalRefreshTokenCount();\r\n        }\r\n        ServerSettingsFormCtrl.prototype.getLanguages = function () {\r\n            var _this = this;\r\n            this.languages.getAll()\r\n                .then(function (languages) {\r\n                _this.scope.languages = languages;\r\n                _this.scope.languageDisplayNames = {};\r\n                _.each(languages, function (language) {\r\n                    _this.scope.languageDisplayNames[language.language] = language.displayName;\r\n                });\r\n            });\r\n        };\r\n        ServerSettingsFormCtrl.prototype.getLocales = function () {\r\n            var _this = this;\r\n            this.locales.getAll()\r\n                .then(function (locales) {\r\n                _this.scope.locales = locales;\r\n                _this.scope.localeDisplayNames = {};\r\n                _.each(locales, function (locale) {\r\n                    _this.scope.localeDisplayNames[locale.locale] = locale.displayName;\r\n                });\r\n            });\r\n        };\r\n        ServerSettingsFormCtrl.prototype.resetSettings = function () {\r\n            var _this = this;\r\n            this.confirmActionDialog.open({\r\n                title: this.$translate.instant('resetServerSettings'),\r\n                bodyText: this.$translate.instant('resetServerSettingsConfirmMessage'),\r\n                actionName: this.$translate.instant('resetServerSettingsConfirmButton'),\r\n                isDeleteAction: true,\r\n                action: function () {\r\n                    return _this.server.sendRequest(new VizPortal.ServerApi.ResetServerSettingsRequest())\r\n                        .then(function () { return _this.ServerSettings.fetch(); })\r\n                        .then(function (settings) {\r\n                        _this.scope.serverSettings = settings;\r\n                        _this.languageOrLocaleChanged = _this.isLangOrLocaleChanged();\r\n                        _this.masterSettings = angular.copy(_this.scope.serverSettings);\r\n                    })\r\n                        .then(function () { return _this.hardReloadIfNeeded(); });\r\n                },\r\n                errorMessage: this.$translate.instant('resetServerSettingsError')\r\n            }).result.then(function () { return _this.toasterService.pop({ type: VizPortal.ToastType.Info, text: _this.$translate.instant('resetServerSettingsSuccess') }); });\r\n        };\r\n        ServerSettingsFormCtrl.prototype.getTotalRefreshTokenCount = function () {\r\n            var _this = this;\r\n            this.server.sendRequest(new VizPortal.ServerApi.GetTotalRefreshTokenCountRequest({}))\r\n                .then(function (result) {\r\n                _this.scope.totalRefreshTokenCount = result.refreshTokenCount;\r\n                _this.scope.refreshTokenUncheckedMessage = _this.$translate.instant('serverConnectedDevicesUncheckedWithCount', { TOKEN_COUNT: _this.scope.totalRefreshTokenCount }, VizPortal.L10n.Interpolations.Count);\r\n            });\r\n        };\r\n        ServerSettingsFormCtrl.prototype.clearSavedCredentials = function () {\r\n            var _this = this;\r\n            this.confirmActionDialog.open({\r\n                title: this.$translate.instant('clearSavedCredentials'),\r\n                bodyText: this.$translate.instant('clearServerSavedCredentialsConfirmMessage'),\r\n                actionName: this.$translate.instant('clearSavedCredentialsConfirmButton'),\r\n                isDeleteAction: true,\r\n                action: function () {\r\n                    return _this.server.sendRequest(new VizPortal.ServerApi.ClearSavedPasswordsRequest());\r\n                },\r\n                errorMessage: this.$translate.instant('clearSavedCredentialsError')\r\n            }).result.then(function () { return _this.toasterService.pop({ type: VizPortal.ToastType.Info, text: _this.$translate.instant('clearSavedCredentialsSuccess') }); });\r\n        };\r\n        ServerSettingsFormCtrl.prototype.save = function () {\r\n            var _this = this;\r\n            this.scope.serverSettingsPending = true;\r\n            // The settings we'll save. Copy them, because we'll want to set\r\n            // them to the masterSettings if we successfully save\r\n            var settings = angular.copy(this.scope.serverSettings);\r\n            var booleanNames = VizPortal.ServerApi.UpdateBooleanServerSettingNames;\r\n            var embeddedCredentialsAndSchedulingPromise = this.ServerSettings.updateBoolean(booleanNames.embeddedCredentialsEnabled, settings.embeddedCredentialsEnabled)\r\n                .then(function () {\r\n                // Since scheduling depends on embeddedCredentials being enabled, make sure embeddedCredentials\r\n                // saves first and only save scheduling if embeddedCredentials is enabled\r\n                if (settings.embeddedCredentialsEnabled) {\r\n                    return _this.ServerSettings.updateBoolean(booleanNames.schedulingEnabled, settings.schedulingEnabled);\r\n                }\r\n            });\r\n            var promises = [\r\n                embeddedCredentialsAndSchedulingPromise,\r\n                this.ServerSettings.updateBoolean(booleanNames.savedPasswordsEnabled, settings.savedPasswordsEnabled),\r\n                this.ServerSettings.updateBoolean(booleanNames.savedAccessTokensEnabled, settings.savedAccessTokensEnabled),\r\n                this.ServerSettings.updateString('defaultLanguage', settings.defaultLanguage),\r\n                this.ServerSettings.updateString('defaultLocale', settings.defaultLocale),\r\n                this.ServerSettings.updateBoolean(booleanNames.refreshTokensEnabled, settings.refreshTokenEnabled)\r\n            ];\r\n            promises.push(this.ServerSettings\r\n                .updateBoolean(booleanNames.scheduledActiveDirectorySyncEnabled, settings.scheduledActiveDirectorySyncEnabled));\r\n            promises.push(this.ServerSettings\r\n                .updateScheduleFrequency(VizPortal.ServerApi.UpdateScheduleFrequencyServerSettingName, VizPortal.CreateOrEditScheduleViewModelMapper.scheduleFrequencyFromViewModel(this.scope.scheduleViewModel)));\r\n            if (settings.guestEnabled !== undefined) {\r\n                promises.push(this.ServerSettings.updateBoolean(booleanNames.guestEnabled, settings.guestEnabled));\r\n            }\r\n            // Need to set before saving since we copy back the new server settings before the settingsCoordinate save resolve\r\n            this.languageOrLocaleChanged = this.isLangOrLocaleChanged();\r\n            return this.$q.all(promises)\r\n                .then(function () {\r\n                _this.masterSettings = settings;\r\n                _this.originalScheduleViewModel = angular.copy(_this.scope.scheduleViewModel);\r\n                //client update of token count to get rid of warning text\r\n                if (!settings.refreshTokenEnabled) {\r\n                    _this.scope.totalRefreshTokenCount = 0;\r\n                }\r\n            })\r\n                .fail(function (error) { return _this.$q.reject(error); })\r\n                .fin(function () { return _this.scope.serverSettingsPending = false; });\r\n        };\r\n        ServerSettingsFormCtrl.prototype.runActiveDirectoryGroupsSync = function () {\r\n            var _this = this;\r\n            this.confirmActionDialog.open({\r\n                title: this.$translate.instant('activeDirectorySyncScheduleConfirmTitle'),\r\n                bodyText: this.$translate.instant('activeDirectorySyncScheduleConfirmBody'),\r\n                actionName: this.$translate.instant('activeDirectorySyncScheduleConfirmButton'),\r\n                action: function () {\r\n                    return _this.server.sendRequest(new VizPortal.ServerApi.RunActiveDirectoryGroupsSyncRequest());\r\n                }\r\n            }).result.then(function (result) {\r\n                if (VizPortal.ResultHelper.hasErrors(result)) {\r\n                    _this.toasterService.pop({ type: VizPortal.ToastType.Error, text: _this.$translate.instant('activeDirectorySyncScheduleRunNowError') });\r\n                }\r\n                else {\r\n                    _this.toasterService.pop({ type: VizPortal.ToastType.Info, text: _this.$translate.instant('activeDirectorySyncScheduleRunNowSuccess') });\r\n                }\r\n            });\r\n        };\r\n        ServerSettingsFormCtrl.prototype.isLangOrLocaleChanged = function () {\r\n            var langChanged = this.scope.serverSettings.defaultLanguage !== this.masterSettings.defaultLanguage;\r\n            var localeChanged = this.scope.serverSettings.defaultLocale !== this.masterSettings.defaultLocale;\r\n            return langChanged || localeChanged;\r\n        };\r\n        ServerSettingsFormCtrl.prototype.hardReloadIfNeeded = function () {\r\n            var _this = this;\r\n            var hardReloadPromise;\r\n            if (this.languageOrLocaleChanged) {\r\n                this.languageOrLocaleChanged = false;\r\n                hardReloadPromise = this.server.refreshSessionInfo().then(function () { return _this.$state.hardReload(); });\r\n            }\r\n            return this.$q.when(hardReloadPromise);\r\n        };\r\n        ServerSettingsFormCtrl.$inject = [\r\n            '$scope',\r\n            '$state',\r\n            '$q',\r\n            '$translate',\r\n            'ServerService',\r\n            'ServerSettings',\r\n            'Languages',\r\n            'Locales',\r\n            'ToasterService',\r\n            'ConfirmActionDialog',\r\n            'HelpService',\r\n        ];\r\n        return ServerSettingsFormCtrl;\r\n    })();\r\n    VizPortal.ServerSettingsFormCtrl = ServerSettingsFormCtrl;\r\n    VizPortal.Module.instance().controller('ServerSettingsFormCtrl', ServerSettingsFormCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../../app/IMainScope.ts\" />\r\n/// <reference path=\"../directives/tbSettingsCoordinator.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../resources/Sites.ts\" />\r\n/// <reference path=\"../ServerApi/types/ISiteSettingsForSiteAdmin.ts\" />\r\n/// <reference path=\"../services/ToasterService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SiteSettingsForSiteAdminFormCtrl = (function () {\r\n        function SiteSettingsForSiteAdminFormCtrl(scope, $location, $q, $translate, $state, sitesResource, toaster, $timeout) {\r\n            var _this = this;\r\n            this.scope = scope;\r\n            this.$location = $location;\r\n            this.$q = $q;\r\n            this.$translate = $translate;\r\n            this.$state = $state;\r\n            this.sitesResource = sitesResource;\r\n            this.toaster = toaster;\r\n            this.scope.busy = false;\r\n            this.scope.clearInvalid = function (name) { return _this.clearInvalid(name); };\r\n            this.scope.focusByName = function (name) {\r\n                // Timeout allows field to be enabled first\r\n                $timeout(function () { return angular.element('input[name=\"' + name + '\"], textarea[name=\"' + name + '\"]').focus(); });\r\n            };\r\n            this.scope.siteSettingsForSiteAdminFormState = this.scope.siteSettingsForSiteAdminFormState || {};\r\n            this.scope.siteSettingsForSiteAdminFormState.save = function () { return _this.getSiteSettingsForSiteAdminUpdatePromise(); };\r\n            this.scope.siteSettingsForSiteAdminFormState.cancel = function () { return _this.revertSettings(); };\r\n            this.scope.siteSettingsForSiteAdminFormState.isBusy = function () { return _this.scope.busy; };\r\n            this.scope.siteSettingsForSiteAdminFormState.isFormUnchanged = function () { return angular.equals(_this.master, _this.scope.siteSettingsForSiteAdmin); };\r\n            this.scope.siteSettingsForSiteAdminFormState.isValid = function () { return _this.scope.siteSettingsForSiteAdminForm && _this.scope.siteSettingsForSiteAdminForm.$valid; };\r\n            this.master = angular.copy(this.scope.siteSettingsForSiteAdmin);\r\n        }\r\n        SiteSettingsForSiteAdminFormCtrl.prototype.clearInvalid = function (inputName) {\r\n            var ngModelCtrl = this.scope.siteSettingsForSiteAdminForm[inputName];\r\n            if (ngModelCtrl.$invalid) {\r\n                ngModelCtrl.$setViewValue(null);\r\n                ngModelCtrl.$render();\r\n                ngModelCtrl.$setPristine();\r\n                _.each(_.keys(ngModelCtrl.$error), function (error) { return ngModelCtrl.$setValidity(error, true); });\r\n            }\r\n        };\r\n        SiteSettingsForSiteAdminFormCtrl.prototype.revertSettings = function () {\r\n            this.scope.siteSettingsForSiteAdmin = angular.copy(this.master);\r\n            // TODO: Use Angular 1.3 $validators/$validate and pull validation out of $parsers/$formatters\r\n            _.each(this.scope.siteSettingsForSiteAdminForm.$error, function (error, key) {\r\n                if (error) {\r\n                    error[0].$setValidity(key, true);\r\n                }\r\n            });\r\n        };\r\n        // TODO: move the saving logic into SitesResource. Error handling should be done by users of this form\r\n        SiteSettingsForSiteAdminFormCtrl.prototype.getSiteSettingsForSiteAdminUpdatePromise = function () {\r\n            var _this = this;\r\n            var site = angular.copy(this.scope.siteSettingsForSiteAdmin);\r\n            this.scope.busy = true;\r\n            var errors = [];\r\n            return this.sitesResource.updateSiteSettingsForSiteAdmin(site.id, site.siteAdminSettings).then(function (result) {\r\n                if (result.errors && result.errors.length) {\r\n                    errors = errors.concat(result.errors);\r\n                    _this.updateFailure(errors, site);\r\n                    return _this.$q.reject();\r\n                }\r\n                else {\r\n                    _this.updateSuccess(site);\r\n                }\r\n            })\r\n                .fin(function () { return _this.scope.busy = false; });\r\n        };\r\n        // Success/Error Handlers\r\n        SiteSettingsForSiteAdminFormCtrl.prototype.updateSuccess = function (site) {\r\n            // Only need to update current view and state if we're in server or site settings\r\n            if (!this.$state.includes('**.settings.**')) {\r\n                return;\r\n            }\r\n            this.master = angular.copy(site);\r\n        };\r\n        // Handles errors in site settings coordinator and edit site modal and create site modal\r\n        SiteSettingsForSiteAdminFormCtrl.prototype.updateFailure = function (errors, site) {\r\n            var _this = this;\r\n            _.each(errors, function (error) {\r\n                _this.toaster.pop({ type: VizPortal.ToastType.Error, text: _this.sitesResource.errorMessage(error.code, site) });\r\n            });\r\n        };\r\n        SiteSettingsForSiteAdminFormCtrl.$inject = [\r\n            '$scope',\r\n            '$location',\r\n            '$q',\r\n            '$translate',\r\n            '$state',\r\n            'Sites',\r\n            'ToasterService',\r\n            '$timeout'\r\n        ];\r\n        return SiteSettingsForSiteAdminFormCtrl;\r\n    })();\r\n    VizPortal.SiteSettingsForSiteAdminFormCtrl = SiteSettingsForSiteAdminFormCtrl;\r\n    VizPortal.Module.instance().controller('SiteSettingsForSiteAdminFormCtrl', SiteSettingsForSiteAdminFormCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var NumberInputRange = (function () {\r\n        function NumberInputRange() {\r\n        }\r\n        NumberInputRange.INT = {\r\n            MIN: -2147483648,\r\n            MAX: 2147483647\r\n        };\r\n        NumberInputRange.LONG = {\r\n            MIN: -9223372036854775000,\r\n            MAX: 9223372036854775000\r\n        };\r\n        return NumberInputRange;\r\n    })();\r\n    VizPortal.NumberInputRange = NumberInputRange;\r\n    // This is needed for IE8 number and range validation.\r\n    VizPortal.Module.instance().directive('tbRangeInputValidator', function () {\r\n        return {\r\n            restrict: 'A',\r\n            require: 'ngModel',\r\n            link: function (scope, elm, attrs, ctrl) {\r\n                var NUMBER_REGEXP = /^\\s*(\\-|\\+)?(\\d+|(\\d*(\\.\\d*)))\\s*$/; // From AngularJS v1.2.12\r\n                ctrl.$parsers.push(function (inputVal) {\r\n                    // min and max are inclusive\r\n                    var isNumber = NUMBER_REGEXP.test(inputVal);\r\n                    var min = attrs['min'] ? parseFloat(attrs['min']) : -1 * Number.MAX_VALUE;\r\n                    var max = attrs['max'] ? parseFloat(attrs['max']) : Number.MAX_VALUE;\r\n                    inputVal = parseFloat(inputVal);\r\n                    ctrl.$setValidity('max', (!isNumber || inputVal <= max));\r\n                    ctrl.$setValidity('min', (!isNumber || inputVal >= min));\r\n                    return isNumber ? inputVal : undefined;\r\n                });\r\n            }\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SiteIdValidRegExp = (function () {\r\n        function SiteIdValidRegExp() {\r\n        }\r\n        SiteIdValidRegExp.Chars = 'A-Za-z0-9\\-\\_';\r\n        SiteIdValidRegExp.InvalidFind = new RegExp('[^' + SiteIdValidRegExp.Chars + ']', 'g');\r\n        SiteIdValidRegExp.InvalidTest = new RegExp('^[' + SiteIdValidRegExp.Chars + ']+$');\r\n        return SiteIdValidRegExp;\r\n    })();\r\n    VizPortal.SiteIdValidRegExp = SiteIdValidRegExp;\r\n    VizPortal.Module.instance().directive('tbSiteIdInputValidator', function () {\r\n        return {\r\n            restrict: 'A',\r\n            require: 'ngModel',\r\n            link: function (scope, elm, attrs, ctrl) {\r\n                ctrl.$parsers.push(function (inputId) {\r\n                    ctrl.$setValidity('siteId', SiteIdValidRegExp.InvalidTest.test(inputId));\r\n                    return inputId;\r\n                });\r\n            }\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../../app/IMainScope.ts\" />\r\n/// <reference path=\"../../ts/FeatureFlags.ts\" />\r\n/// <reference path=\"../controllers/SiteSettingsForSiteAdminFormCtrl.ts\" />\r\n/// <reference path=\"../directives/tbRangeInputValidator.ts\" />\r\n/// <reference path=\"../filters/SizeFilter.ts\" />\r\n/// <reference path=\"../directives/tbSettingsCoordinator.ts\" />\r\n/// <reference path=\"../directives/tbSiteIdInputValidator.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../resources/Sites.ts\" />\r\n/// <reference path=\"../services/LicensesService.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\n/// <reference path=\"../services/SiteUrlMatcherFactory.ts\" />\r\n/// <reference path=\"../services/ToasterService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SiteSettingsForServerAdminFormCtrl = (function () {\r\n        function SiteSettingsForServerAdminFormCtrl(scope, $location, $q, $translate, $state, server, sitesResource, toaster, siteUrlMatcherFactory, licenses, $timeout) {\r\n            var _this = this;\r\n            this.scope = scope;\r\n            this.$location = $location;\r\n            this.$q = $q;\r\n            this.$translate = $translate;\r\n            this.$state = $state;\r\n            this.server = server;\r\n            this.sitesResource = sitesResource;\r\n            this.toaster = toaster;\r\n            this.siteUrlMatcherFactory = siteUrlMatcherFactory;\r\n            this.licenses = licenses;\r\n            this.scope.active = VizPortal.SiteAvailabilityState.ACTIVE;\r\n            this.scope.suspended = VizPortal.SiteAvailabilityState.SUSPENDED;\r\n            this.scope.defaultSubscriptionsEmail = this.server.defaultSubscriptionsEmail();\r\n            licenses.fetch().then(function (licensingInfo) {\r\n                if (licensingInfo) {\r\n                    var noLicenses = !licensingInfo.productKeyInfos || !licensingInfo.productKeyInfos.length;\r\n                    _this.scope.userCountMax = licensingInfo.isCore || noLicenses ? VizPortal.NumberInputRange.INT.MAX : licensingInfo.totalSeatLicenses;\r\n                    _this.scope.isSeatLicensing = licensingInfo.isCore === false;\r\n                }\r\n            });\r\n            this.scope.storageQuotaMax = VizPortal.NumberInputRange.LONG.MAX / VizPortal.ByteSizeConversionFactor.ONE_GB;\r\n            this.scope.server = this.server;\r\n            this.scope.busy = false;\r\n            this.scope.save = function () { return _this.save(); };\r\n            this.scope.cancel = function () { return _this.cancel(); };\r\n            this.scope.clearInvalid = function (name) { return _this.clearInvalid(name); };\r\n            this.scope.focusByName = function (name) {\r\n                // Timeout allows field to be enabled first\r\n                $timeout(function () { return angular.element('input[name=\"' + name + '\"], textarea[name=\"' + name + '\"]').focus(); });\r\n            };\r\n            this.scope.isVersionHistoryAllowed = VizPortal.FeatureFlags.workbookVersionHistoryEnabled;\r\n            this.scope.siteSettingsForServerAdminFormState = this.scope.siteSettingsForServerAdminFormState || {};\r\n            this.scope.siteSettingsForServerAdminFormState.save = function () { return _this.getSiteSettingsForServerAdminUpdatePromise(); };\r\n            this.scope.siteSettingsForServerAdminFormState.cancel = function () { return _this.revertSettings(); };\r\n            this.scope.siteSettingsForServerAdminFormState.isBusy = function () { return _this.scope.busy; };\r\n            this.scope.siteSettingsForServerAdminFormState.isFormUnchanged = function () { return angular.equals(_this.master, _this.scope.siteSettingsForServerAdmin); };\r\n            this.scope.siteSettingsForServerAdminFormState.isValid = function () { return _this.scope.siteSettingsForServerAdminForm && _this.scope.siteSettingsForServerAdminForm.$valid; };\r\n            // Initialize unset values so angular doesn't overwrite them with empty string\r\n            // TODO: the API should be returning these. This is a bug. Tracked with BUGZID:154118\r\n            if (this.scope.siteSettingsForServerAdmin.settings) {\r\n                if (!this.scope.siteSettingsForServerAdmin.settings.userQuotaEnabled) {\r\n                    this.scope.siteSettingsForServerAdmin.settings.userQuota = null;\r\n                }\r\n                if (!this.scope.siteSettingsForServerAdmin.settings.storageQuotaEnabled) {\r\n                    this.scope.siteSettingsForServerAdmin.settings.storageQuotaBytes = null;\r\n                }\r\n                if (this.scope.siteSettingsForServerAdmin.subscriptionSettings && !this.scope.siteSettingsForServerAdmin.subscriptionSettings.customSubscriptionEmailEnabled) {\r\n                    this.scope.siteSettingsForServerAdmin.subscriptionSettings.customSubscriptionEmail = angular.copy(this.scope.defaultSubscriptionsEmail);\r\n                }\r\n            }\r\n            this.master = angular.copy(this.scope.siteSettingsForServerAdmin);\r\n            // Copy a scrubbed version of the inputted name into the ID field until the ID is edited\r\n            if (this.scope.siteSettingsForServerAdmin.settings && this.scope.siteSettingsForServerAdmin.settings.urlName === '' && !this.scope.isDefaultSite) {\r\n                this.scope.unbindNameWatcher = this.scope.$watch('siteSettingsForServerAdmin.settings.name', function (value) {\r\n                    _this.scope.siteSettingsForServerAdmin.settings.urlName = _.isString(value) ? value.replace(VizPortal.SiteIdValidRegExp.InvalidFind, '') : '';\r\n                });\r\n            }\r\n            this.scope.$watch('siteSettingsForServerAdmin.settings.urlName', function (value) {\r\n                scope.url = _this.$location.absUrl().replace(_this.$location.url(), '') +\r\n                    _this.siteUrlMatcherFactory.compile('').format({ siteUrlName: value });\r\n            });\r\n        }\r\n        SiteSettingsForServerAdminFormCtrl.prototype.clearInvalid = function (inputName) {\r\n            var ngModelCtrl = this.scope.siteSettingsForServerAdminForm[inputName];\r\n            if (ngModelCtrl.$invalid) {\r\n                ngModelCtrl.$setViewValue(null);\r\n                ngModelCtrl.$render();\r\n                ngModelCtrl.$setPristine();\r\n                _.each(_.keys(ngModelCtrl.$error), function (error) { return ngModelCtrl.$setValidity(error, true); });\r\n            }\r\n        };\r\n        SiteSettingsForServerAdminFormCtrl.prototype.revertSettings = function () {\r\n            this.scope.siteSettingsForServerAdmin = angular.copy(this.master);\r\n            // TODO: Use Angular 1.3 $validators/$validate and pull validation out of $parsers/$formatters\r\n            _.each(this.scope.siteSettingsForServerAdminForm.$error, function (error, key) {\r\n                if (error) {\r\n                    error[0].$setValidity(key, true);\r\n                }\r\n            });\r\n        };\r\n        SiteSettingsForServerAdminFormCtrl.prototype.cancel = function () {\r\n            this.revertSettings();\r\n            this.toaster.pop({ type: VizPortal.ToastType.Info, text: this.$translate.instant('settingsReverted') });\r\n        };\r\n        // Used in edit site modal\r\n        SiteSettingsForServerAdminFormCtrl.prototype.save = function () {\r\n            var _this = this;\r\n            this.getSiteSettingsForServerAdminUpdatePromise()\r\n                .then(function () { return _this.toaster.pop({ type: VizPortal.ToastType.Info, text: _this.$translate.instant('settingsUpdateSuccess') }); })\r\n                .fail(function (error) { return _this.toaster.pop({ type: VizPortal.ToastType.Error, text: _this.$translate.instant('settingsUpdateFailure') }); });\r\n        };\r\n        // TODO: move the saving logic into SitesResource. Error handling should be done by users of this form\r\n        SiteSettingsForServerAdminFormCtrl.prototype.getSiteSettingsForServerAdminUpdatePromise = function () {\r\n            var _this = this;\r\n            var updatePromises = [];\r\n            var site = angular.copy(this.scope.siteSettingsForServerAdmin);\r\n            this.scope.busy = true;\r\n            updatePromises.push(this.sitesResource.updateSiteSettingsForServerAdmin(site.id, site.settings, site.subscriptionSettings));\r\n            if (site.availability !== this.master.availability) {\r\n                if (site.availability === VizPortal.SiteAvailabilityState.ACTIVE) {\r\n                    updatePromises.push(this.sitesResource.activate([site.id]));\r\n                }\r\n                else {\r\n                    updatePromises.push(this.sitesResource.suspend([site.id]));\r\n                }\r\n            }\r\n            return this.$q.all(updatePromises)\r\n                .then(function (results) {\r\n                var errors = [];\r\n                angular.forEach(results, function (result) {\r\n                    if (result.errors && result.errors.length) {\r\n                        errors = errors.concat(result.errors);\r\n                    }\r\n                });\r\n                if (errors.length) {\r\n                    _this.updateFailure(errors, site);\r\n                    return _this.$q.reject();\r\n                }\r\n                else {\r\n                    _this.updateSuccess(site);\r\n                }\r\n            })\r\n                .fin(function () { return _this.scope.busy = false; });\r\n        };\r\n        // Success/Error Handlers\r\n        SiteSettingsForServerAdminFormCtrl.prototype.updateSuccess = function (site) {\r\n            // Only need to update current view and state if we're in server or site settings\r\n            if (!this.$state.includes('**.settings.**')) {\r\n                return;\r\n            }\r\n            // Changed site name\r\n            if (site.settings.name !== this.master.settings.name) {\r\n                this.server.refreshSessionInfo(); // Update site picker\r\n            }\r\n            // Changed site url name in site settings page\r\n            if (site.settings.urlName !== '' && site.settings.urlName !== this.master.settings.urlName) {\r\n                this.$state.go('main.site.settings.siteSettings', { siteUrlName: site.settings.urlName }); // Reload into new url\r\n            }\r\n            this.master = angular.copy(site);\r\n        };\r\n        // Handles errors in site settings coordinator and edit site modal and create site modal\r\n        SiteSettingsForServerAdminFormCtrl.prototype.updateFailure = function (errors, site) {\r\n            var _this = this;\r\n            _.each(errors, function (error) {\r\n                _this.toaster.pop({ type: VizPortal.ToastType.Error, text: _this.sitesResource.errorMessage(error.code, site) });\r\n            });\r\n        };\r\n        SiteSettingsForServerAdminFormCtrl.$inject = [\r\n            '$scope',\r\n            '$location',\r\n            '$q',\r\n            '$translate',\r\n            '$state',\r\n            'ServerService',\r\n            'Sites',\r\n            'ToasterService',\r\n            'SiteUrlMatcherFactory',\r\n            'LicensesService',\r\n            '$timeout'\r\n        ];\r\n        return SiteSettingsForServerAdminFormCtrl;\r\n    })();\r\n    VizPortal.SiteSettingsForServerAdminFormCtrl = SiteSettingsForServerAdminFormCtrl;\r\n    VizPortal.Module.instance().controller('SiteSettingsForServerAdminFormCtrl', SiteSettingsForServerAdminFormCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../models/ISliceable.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/types/ISiteNameSansId.ts\" />\r\n/// <reference path=\"../services/SearchSuggestionsService.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SiteSwitcherCtrl = (function () {\r\n        function SiteSwitcherCtrl($scope, $translate, searchSuggestions, server) {\r\n            $scope.getButtonTitle = function () { return $translate.instant('siteWithSiteName', { SITE_NAME: VizPortal.L10n.elideIfLong(server.sessionSiteName()) }); };\r\n            $scope.getSiteNamesAcrossAllPods = function (text) {\r\n                return searchSuggestions.sites(text);\r\n            };\r\n            $scope.siteSwitcher = {\r\n                chosenSiteName: null\r\n            };\r\n            $scope.isCurrentSiteName = function (siteName) {\r\n                return server.isCurrentSiteUrlName(siteName.urlName);\r\n            };\r\n            $scope.submitChangeSite = function () {\r\n                var siteName = $scope.siteSwitcher.chosenSiteName;\r\n                if (siteName) {\r\n                    $scope.siteSelected({ urlName: siteName.urlName });\r\n                }\r\n            };\r\n        }\r\n        SiteSwitcherCtrl.$inject = [\r\n            '$scope',\r\n            '$translate',\r\n            'SearchSuggestionsService',\r\n            'ServerService'\r\n        ];\r\n        return SiteSwitcherCtrl;\r\n    })();\r\n    VizPortal.SiteSwitcherCtrl = SiteSwitcherCtrl;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../controllers/SiteUserPlaceCtrl.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SiteUserDatasourcesSubplaceCtrl = (function () {\r\n        function SiteUserDatasourcesSubplaceCtrl() {\r\n        }\r\n        return SiteUserDatasourcesSubplaceCtrl;\r\n    })();\r\n    VizPortal.SiteUserDatasourcesSubplaceCtrl = SiteUserDatasourcesSubplaceCtrl;\r\n    VizPortal.Module.instance().controller('SiteUserDatasourcesSubplaceCtrl', SiteUserDatasourcesSubplaceCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../controllers/SiteUserPlaceCtrl.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SiteUserSubscriptionsSubplaceCtrl = (function () {\r\n        function SiteUserSubscriptionsSubplaceCtrl() {\r\n        }\r\n        return SiteUserSubscriptionsSubplaceCtrl;\r\n    })();\r\n    VizPortal.SiteUserSubscriptionsSubplaceCtrl = SiteUserSubscriptionsSubplaceCtrl;\r\n    VizPortal.Module.instance().controller('SiteUserSubscriptionsSubplaceCtrl', SiteUserSubscriptionsSubplaceCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../controllers/SiteUserPlaceCtrl.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SiteUserViewsSubplaceCtrl = (function () {\r\n        function SiteUserViewsSubplaceCtrl() {\r\n        }\r\n        return SiteUserViewsSubplaceCtrl;\r\n    })();\r\n    VizPortal.SiteUserViewsSubplaceCtrl = SiteUserViewsSubplaceCtrl;\r\n    VizPortal.Module.instance().controller('SiteUserViewsSubplaceCtrl', SiteUserViewsSubplaceCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../controllers/SiteUserPlaceCtrl.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SiteUserWorkbooksSubplaceCtrl = (function () {\r\n        function SiteUserWorkbooksSubplaceCtrl() {\r\n        }\r\n        return SiteUserWorkbooksSubplaceCtrl;\r\n    })();\r\n    VizPortal.SiteUserWorkbooksSubplaceCtrl = SiteUserWorkbooksSubplaceCtrl;\r\n    VizPortal.Module.instance().controller('SiteUserWorkbooksSubplaceCtrl', SiteUserWorkbooksSubplaceCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var DeleteZiplogRequest = (function (_super) {\r\n            __extends(DeleteZiplogRequest, _super);\r\n            function DeleteZiplogRequest(params) {\r\n                if (params === void 0) { params = {}; }\r\n                _super.call(this, 'deleteZiplog', params);\r\n            }\r\n            return DeleteZiplogRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.DeleteZiplogRequest = DeleteZiplogRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetZiplogInfoRequest = (function (_super) {\r\n            __extends(GetZiplogInfoRequest, _super);\r\n            function GetZiplogInfoRequest(params) {\r\n                if (params === void 0) { params = {}; }\r\n                _super.call(this, 'getZiplogInfo', params);\r\n            }\r\n            return GetZiplogInfoRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetZiplogInfoRequest = GetZiplogInfoRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetZiplogUriRequest = (function (_super) {\r\n            __extends(GetZiplogUriRequest, _super);\r\n            function GetZiplogUriRequest(params) {\r\n                if (params === void 0) { params = {}; }\r\n                _super.call(this, 'getZiplogUri', params);\r\n            }\r\n            return GetZiplogUriRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetZiplogUriRequest = GetZiplogUriRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GenerateZiplogRequest = (function (_super) {\r\n            __extends(GenerateZiplogRequest, _super);\r\n            function GenerateZiplogRequest(params) {\r\n                _super.call(this, 'generateZiplog', params);\r\n            }\r\n            return GenerateZiplogRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GenerateZiplogRequest = GenerateZiplogRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"./PollService.ts\" />\r\n/// <reference path=\"./ServerService.ts\" />\r\n/// <reference path=\"../ServerApi/requests/DeleteZiplogRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetZiplogInfoRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetZiplogUriRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GenerateZiplogRequest.ts\" />\r\n/// <reference path=\"../models/IZiplogInfo.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    /**\r\n     * NONE:        Ziplog available on the server\r\n     * INPROGRESS:  Ziplog being generated\r\n     * COMPLETE:    Ziplog available and ready for download\r\n     */\r\n    var ZiplogState = (function () {\r\n        function ZiplogState() {\r\n        }\r\n        ZiplogState.NONE = 'none';\r\n        ZiplogState.INPROGRESS = 'inprogress';\r\n        ZiplogState.COMPLETE = 'complete';\r\n        return ZiplogState;\r\n    })();\r\n    VizPortal.ZiplogState = ZiplogState;\r\n    /**\r\n     * Manage the ziplog on Server.\r\n     */\r\n    var ZiplogService = (function () {\r\n        function ZiplogService(server, $q, windowLocationService, pollService) {\r\n            this.server = server;\r\n            this.$q = $q;\r\n            this.windowLocationService = windowLocationService;\r\n            this.pollService = pollService;\r\n        }\r\n        /**\r\n         * Initiate ziplog generation. Call getInfo() after calling generate() to get a\r\n         * promise that resolves to the generated ZiplogInfo.\r\n         */\r\n        ZiplogService.prototype.generate = function (daysToGenerate) {\r\n            // Translate 'daysToGenerate' to a number that the server understands\r\n            //\r\n            //   'daysToGenerate'     logsUpToDate\r\n            //   ----------------     ------------\r\n            //   ALL_DAYS             undefined\r\n            //   1 day                0\r\n            //   2 days               1\r\n            //   3 days               2\r\n            //   etc.\r\n            //\r\n            var logsUpToDate = daysToGenerate !== ZiplogService.ALL_DAYS\r\n                ? daysToGenerate - 1\r\n                : undefined;\r\n            return this.server.sendRequest(new VizPortal.ServerApi.GenerateZiplogRequest({\r\n                logsUpToDate: logsUpToDate\r\n            })).then(angular.noop);\r\n        };\r\n        /**\r\n         * Retrieve the ZiplogInfo if it is `inprogress` or `complete`.\r\n         * If ziplog is in `inprogress`, promise will resolve when ziplog is `complete`.\r\n         * Do not call if ziplogs are `none`. The promise will never be resolved.\r\n         * Call getState() before calling getInfo() to verify that ziplogs are not `none`.\r\n         */\r\n        ZiplogService.prototype.getInfo = function () {\r\n            var _this = this;\r\n            // Resolve immediately if we already have the ZiplogInfo\r\n            if (this.ziplogInfo) {\r\n                return this.$q.when(this.ziplogInfo);\r\n            }\r\n            // If we're already polling for ZiplogInfo, return that promise\r\n            if (this.ziplogPollPromise) {\r\n                return this.ziplogPollPromise;\r\n            }\r\n            var isComplete = function (result) {\r\n                return result.status === ZiplogState.COMPLETE;\r\n            };\r\n            var ziplogPoller = this.pollService.poll(new VizPortal.ServerApi.GetZiplogInfoRequest({}), isComplete);\r\n            this.cancelPoll = function () { return ziplogPoller.cancel(); };\r\n            this.ziplogPollPromise = ziplogPoller.promise.then(function (result) {\r\n                // TODO: Ziplog error handling B154120\r\n                _this.ziplogPollPromise = null;\r\n                return _this.ziplogInfoFromResult(result);\r\n            });\r\n            return this.ziplogPollPromise;\r\n        };\r\n        /**\r\n         * Get current state of ziplog on server.\r\n         * See ZiplogState for all possible ziplogs states.\r\n         */\r\n        ZiplogService.prototype.getState = function () {\r\n            var _this = this;\r\n            return this.server.sendRequest(new VizPortal.ServerApi.GetZiplogInfoRequest())\r\n                .then(function (result) {\r\n                // TODO: Ziplog error handling B154120\r\n                // If ziplog is generated, save the ZiplogInfo\r\n                if (result.status === ZiplogState.COMPLETE) {\r\n                    _this.ziplogInfo = _this.ziplogInfoFromResult(result);\r\n                }\r\n                return result.status;\r\n            });\r\n        };\r\n        /**\r\n         * Delete ziplog from the server\r\n         */\r\n        ZiplogService.prototype.remove = function () {\r\n            var _this = this;\r\n            return this.server.sendRequest(new VizPortal.ServerApi.DeleteZiplogRequest())\r\n                .then(function () {\r\n                // TODO: Ziplog error handling B154120\r\n                _this.ziplogInfo = null;\r\n            });\r\n        };\r\n        /**\r\n         * Download the ziplog. First requests the download url, then downloads.\r\n         */\r\n        ZiplogService.prototype.download = function () {\r\n            var _this = this;\r\n            return this.server.sendRequest(new VizPortal.ServerApi.GetZiplogUriRequest())\r\n                .then(function (result) {\r\n                // TODO: Ziplog error handling\r\n                _this.windowLocationService.download(result.data);\r\n            });\r\n        };\r\n        /**\r\n         * Stop polling.\r\n         */\r\n        ZiplogService.prototype.stopPolling = function () {\r\n            if (this.ziplogPollPromise) {\r\n                this.cancelPoll();\r\n                this.ziplogPollPromise = null;\r\n            }\r\n        };\r\n        ZiplogService.prototype.ziplogInfoFromResult = function (result) {\r\n            var ziplog = {\r\n                size: result.size,\r\n                date: VizPortal.DateHelpers.fromISOString(result.date)\r\n            };\r\n            return ziplog;\r\n        };\r\n        ZiplogService.$inject = ['ServerService', '$q', 'WindowLocationService', 'PollService'];\r\n        ZiplogService.ALL_DAYS = 0;\r\n        return ZiplogService;\r\n    })();\r\n    VizPortal.ZiplogService = ZiplogService;\r\n    VizPortal.Module.instance().service('ZiplogService', ZiplogService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/ConfirmActionDialog.ts\" />\r\n/// <reference path=\"../services/ZiplogService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ZiplogCtrl = (function () {\r\n        function ZiplogCtrl($scope, $translate, ziplogService, ConfirmActionDialog) {\r\n            var _this = this;\r\n            this.$scope = $scope;\r\n            this.$translate = $translate;\r\n            this.ziplogService = ziplogService;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.state = VizPortal.ZiplogState.NONE;\r\n            ziplogService.getState().then(function (state) {\r\n                _this.state = state;\r\n                if (state !== VizPortal.ZiplogState.NONE) {\r\n                    _this.getInfo();\r\n                }\r\n            });\r\n            $scope.generate = function () { return _this.confirmGenerateSnapshot(); };\r\n            $scope.remove = function () {\r\n                _this.state = VizPortal.ZiplogState.NONE;\r\n                $scope.ziplog = null;\r\n                ziplogService.remove();\r\n            };\r\n            $scope.download = function () {\r\n                ziplogService.download();\r\n            };\r\n            $scope.isNoZiplog = function () { return _this.state === VizPortal.ZiplogState.NONE; };\r\n            $scope.isZiplogGenerating = function () { return _this.state === VizPortal.ZiplogState.INPROGRESS; };\r\n            $scope.isZiplogAvailable = function () { return _this.state === VizPortal.ZiplogState.COMPLETE; };\r\n            $scope.$on('$destroy', function () { return ziplogService.stopPolling(); });\r\n        }\r\n        ZiplogCtrl.prototype.getInfo = function () {\r\n            var _this = this;\r\n            this.ziplogService.getInfo().then(function (ziplog) {\r\n                _this.state = VizPortal.ZiplogState.COMPLETE;\r\n                _this.$scope.ziplog = ziplog;\r\n            });\r\n        };\r\n        ZiplogCtrl.prototype.confirmGenerateSnapshot = function () {\r\n            var _this = this;\r\n            this.$scope.confirmGenerateZiplogDialog = {\r\n                daysToGenerate: ZiplogCtrl.DefaultZiplogDaysToGenerate\r\n            };\r\n            this.ConfirmActionDialog.open({\r\n                scope: this.$scope,\r\n                title: this.$translate.instant('ziplog_newLogSnapshotDialog_title'),\r\n                bodyTemplateUrl: 'ziplogNewLogSnapshotDialog.html',\r\n                actionName: this.$translate.instant('ziplog_newLogSnapshotDialog_confirm'),\r\n                action: function () {\r\n                    _this.state = VizPortal.ZiplogState.INPROGRESS;\r\n                    _this.ziplogService.generate(_this.$scope.confirmGenerateZiplogDialog.daysToGenerate)\r\n                        .then(function () { return _this.getInfo(); });\r\n                }\r\n            });\r\n        };\r\n        ZiplogCtrl.DefaultZiplogDaysToGenerate = 7;\r\n        ZiplogCtrl.$inject = [\r\n            '$scope',\r\n            '$translate',\r\n            'ZiplogService',\r\n            'ConfirmActionDialog'\r\n        ];\r\n        return ZiplogCtrl;\r\n    })();\r\n    VizPortal.ZiplogCtrl = ZiplogCtrl;\r\n    VizPortal.Module.instance().controller('ZiplogCtrl', ZiplogCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var directives = [\r\n        { attrName: 'tbChildClick', eventName: 'click', digest: true },\r\n        { attrName: 'tbChildMousedown', eventName: 'mousedown', digest: true },\r\n        { attrName: 'tbChildMouseenterTouchstart', eventName: 'mouseenter touchstart', digest: false },\r\n        { attrName: 'tbChildMouseleaveTouchmove', eventName: 'mouseleave touchmove', digest: false },\r\n        { attrName: 'tbChildMouseup', eventName: 'mouseup', digest: true },\r\n        // Touch\r\n        { attrName: 'tbChildTouchend', eventName: 'touchend', digest: true }\r\n    ];\r\n    _.each(directives, function (directive) {\r\n        VizPortal.Module.instance().directive(directive.attrName, [\r\n            '$parse',\r\n            function ($parse) {\r\n                return {\r\n                    link: function (scope, element, attributes) {\r\n                        var fn = $parse(attributes[directive.attrName]);\r\n                        var selector = attributes.tbChildSelector;\r\n                        var exclusionEvents = (attributes.tbChildExclusionEvents || '').split(' ');\r\n                        var exclusionSelector = _.contains(exclusionEvents, directive.eventName) ? attributes.tbChildExclusionSelector : '';\r\n                        var digest = directive.digest;\r\n                        var callFn = function (event) {\r\n                            fn(scope, { child: $(event.target).closest(selector), $event: event });\r\n                        };\r\n                        element.on(directive.eventName, selector, function (event) {\r\n                            if (exclusionSelector && $(event.target).filter(exclusionSelector).length) {\r\n                                return;\r\n                            }\r\n                            if (digest) {\r\n                                scope.$apply(function () {\r\n                                    callFn(event);\r\n                                });\r\n                            }\r\n                            else {\r\n                                callFn(event);\r\n                            }\r\n                        });\r\n                    }\r\n                };\r\n            }\r\n        ]);\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/Keys.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    _.each(_.filter(VizPortal.Keys, _.isString), function (key) {\r\n        VizPortal.Module.instance().directive('tb' + key, [\r\n            function () {\r\n                return {\r\n                    link: function (scope, element, attrs) {\r\n                        element.bind('keydown', function (event) {\r\n                            if (event.which === VizPortal.Keys[key]) {\r\n                                scope.$apply(function () {\r\n                                    scope.$eval(attrs['tb' + key], { $event: event });\r\n                                });\r\n                            }\r\n                        });\r\n                    }\r\n                };\r\n            }\r\n        ]);\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n// NOTE: when using these directives, make sure the element is styled so that the properties will be respected\r\n// For example, make sure element is styled with \"position: absolute\"\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var directives = [\r\n        { name: 'tbBottom', style: 'bottom' },\r\n        { name: 'tbHeight', style: 'height' },\r\n        { name: 'tbLeft', style: 'left' },\r\n        { name: 'tbLineHeight', style: 'line-height' },\r\n        { name: 'tbMarginBottom', style: 'margin-bottom' },\r\n        { name: 'tbMarginLeft', style: 'margin-left' },\r\n        { name: 'tbMarginRight', style: 'margin-right' },\r\n        { name: 'tbMarginTop', style: 'margin-top' },\r\n        { name: 'tbMaxHeight', style: 'max-height' },\r\n        { name: 'tbMinHeight', style: 'min-height' },\r\n        { name: 'tbMaxWidth', style: 'max-width' },\r\n        { name: 'tbMinWidth', style: 'min-width' },\r\n        { name: 'tbRight', style: 'right' },\r\n        { name: 'tbTop', style: 'top' },\r\n        { name: 'tbWidth', style: 'width' }\r\n    ];\r\n    _.each(directives, function (directive) {\r\n        VizPortal.Module.instance().directive(directive.name, function () {\r\n            return {\r\n                restrict: 'A',\r\n                link: function (scope, element, attributes) {\r\n                    scope.$watch(attributes[directive.name], function (value) {\r\n                        element.css(directive.style, _.isNumber(value) ? (value + 'px') : _.isUndefined(value) ? null : value);\r\n                    });\r\n                }\r\n            };\r\n        });\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../controllers/AngularCtrl.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    ;\r\n    var ReactDirectiveFactory;\r\n    (function (ReactDirectiveFactory) {\r\n        ;\r\n        /**\r\n        * Registers an element directive that instantiates a React component with that component's factory function.\r\n        *\r\n        * @param name The name that the directive will be given.\r\n        * @param component The react component factory for the component you want to instantiate.\r\n        * @param customWatch A scope property to watch instead of the `props` object itself. This should be 'props.something'.\r\n        *\r\n        * Usage:\r\n        *   ReactDirectiveFactory.create('tbAwesomeReactComponent', AwesomeReactComponent, 'props.update')\r\n        *   will create a directive called tbAwesomeReactComponent that can be used in an angular template as follows:\r\n        *\r\n        *     <tb:awesome-react-component props=\"componentProps\" />\r\n        *\r\n        *     `componentProps` is an object on the scope that will be passed to the React component factory as the properties parameter.\r\n        */\r\n        function create(directiveSpec) {\r\n            var spec = _.extend({}, {\r\n                watch: 'props'\r\n            }, directiveSpec);\r\n            VizPortal.Module.instance().directive(spec.name, [\r\n                'AngularContextFactory',\r\n                function (AngularContextFactory) {\r\n                    return {\r\n                        restrict: 'E',\r\n                        replace: true,\r\n                        template: '<span></span>',\r\n                        scope: { props: '=' },\r\n                        link: function ($scope, element, attrs) {\r\n                            var angularContext = AngularContextFactory.create($scope);\r\n                            var render = function () {\r\n                                var props = _.extend({ angularContext: angularContext }, $scope.props);\r\n                                React.render(spec.componentFactory(props), element[0]);\r\n                            };\r\n                            $scope.$watch(spec.watch, render);\r\n                            $scope.$on('$destroy', function () {\r\n                                React.unmountComponentAtNode(element[0]);\r\n                            });\r\n                        }\r\n                    };\r\n                }\r\n            ]);\r\n        }\r\n        ReactDirectiveFactory.create = create;\r\n    })(ReactDirectiveFactory = VizPortal.ReactDirectiveFactory || (VizPortal.ReactDirectiveFactory = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../resources/Alerts.ts\" />\r\n/// <reference path=\"../resources/ExtractTasks.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbAlertInfo', [\r\n        '$translate',\r\n        'Alerts',\r\n        'ExtractTasks',\r\n        function ($translate, Alerts, ExtractTasks) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'alertInfo.html',\r\n                scope: {\r\n                    close: '&',\r\n                    type: '=',\r\n                    id: '='\r\n                },\r\n                link: function (scope) {\r\n                    // These methods on the scope are duplicates of those in AlertMenuCtrl.ts.\r\n                    // TODO: Remove this duplication.\r\n                    // One type of alert cannot be fixed by editing a data connection. Therefore the edit connection\r\n                    // feature is disabled for this one\r\n                    scope.editableFailure = function (statusCode) {\r\n                        return statusCode !== VizPortal.AlertErrorCode.AlertOverlappingSchedules;\r\n                    };\r\n                    // Maps to the string version of the error code\r\n                    scope.getFailureType = function (statusCode) {\r\n                        switch (statusCode) {\r\n                            case VizPortal.AlertErrorCode.AlertSignInFailed:\r\n                            case VizPortal.AlertErrorCode.AlertRemoteSignInFailed:\r\n                                return $translate.instant('signInFailedUnknownReason');\r\n                            case VizPortal.AlertErrorCode.AlertExpiredPassword:\r\n                            case VizPortal.AlertErrorCode.AlertRemoteExpiredPassword:\r\n                                return $translate.instant('expiredPassword');\r\n                            case VizPortal.AlertErrorCode.AlertAccessTokenValidation:\r\n                                return $translate.instant('accessTokenValidation');\r\n                            case VizPortal.AlertErrorCode.AlertAuthConfiguration:\r\n                                return $translate.instant('authConfiguration');\r\n                            case VizPortal.AlertErrorCode.AlertConnectionFailure:\r\n                            case VizPortal.AlertErrorCode.AlertRemoteConnectionFailure:\r\n                                return $translate.instant('connectionFailure');\r\n                            case VizPortal.AlertErrorCode.AlertOverlappingSchedules:\r\n                                return $translate.instant('overlappingSchedules');\r\n                            case VizPortal.AlertErrorCode.AlertFullRefreshRequired:\r\n                                return $translate.instant('fullRefreshRequired');\r\n                            case VizPortal.AlertErrorCode.AlertConnectionlessFailure:\r\n                                return $translate.instant('connectionlessFailure');\r\n                            default:\r\n                                // AlertErrorCode.AlertUnknownFailure or AlertErrorCode.AlertRemoteUnknownFailure\r\n                                return $translate.instant('unknownFailure');\r\n                        }\r\n                    };\r\n                    scope.tryAgainClick = function (taskId) {\r\n                        if (taskId) {\r\n                            ExtractTasks.run([taskId]);\r\n                        }\r\n                    };\r\n                    scope.isRemoteRefresh = function (statusCode) {\r\n                        return _.contains(VizPortal.AlertMenuCtrl.REMOTE_REFRESH_STATUS_CODES, statusCode);\r\n                    };\r\n                    // Simple formatting so the number of effected workbooks shown in the list of\r\n                    // alerts does not get too long\r\n                    scope.workbooksAffectedString = function (workbookList) {\r\n                        if (workbookList) {\r\n                            var length = workbookList.length;\r\n                            if (length === 1) {\r\n                                return $translate.instant('outOfDateWithName', {\r\n                                    NAME: VizPortal.L10n.elideIfLong(workbookList[0].name)\r\n                                });\r\n                            }\r\n                            else if (length > 1) {\r\n                                return $translate.instant('outOfDateWorkbooksWithCount', {\r\n                                    LIST_COUNT: length\r\n                                }, VizPortal.L10n.Interpolations.Count);\r\n                            }\r\n                        }\r\n                        return $translate.instant('outOfDateWorkbookNone');\r\n                    };\r\n                    Alerts.getForType(scope.type, scope.id)\r\n                        .then(function (alertListInfo) {\r\n                        if (alertListInfo && alertListInfo.alerts && alertListInfo.alerts.length > 0) {\r\n                            scope.alert = alertListInfo.alerts[0];\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../controllers/AlertMenuCtrl.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbAlertMenu', function () {\r\n        return {\r\n            restrict: 'E',\r\n            replace: true,\r\n            templateUrl: 'alertMenu.html',\r\n            scope: {},\r\n            controller: VizPortal.AlertMenuCtrl\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../models/OrderKeys.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbAssignPermissionsToContents', [\r\n        '$translate',\r\n        'AssignPermissionsToContentsService',\r\n        'ConfirmActionDialog',\r\n        function ($translate, assignPermissionsToContentsService, confirmActionDialog) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'assignPermissionsToContents.html',\r\n                scope: {\r\n                    authorizableType: '=',\r\n                    authorizables: '='\r\n                },\r\n                link: function (scope) {\r\n                    scope.assignPermissionsToContentsPending = function () { return assignPermissionsToContentsService.getAssignPermissionsToContentsPending(); };\r\n                    scope.assignPermissionsToContentsPercent = function () { return assignPermissionsToContentsService.getAssignPermissionsToContentsPercent(); };\r\n                    scope.assignPermissionsToContentsButtonText = (scope.authorizableType === VizPortal.WorkbookContentType.name)\r\n                        ? $translate.instant('assignPermissionsToViews')\r\n                        : $translate.instant('assignPermissionsToContents');\r\n                    // open the Confirm Action Dialog\r\n                    scope.assignPermissionsToContents = function () {\r\n                        confirmActionDialog.open({\r\n                            title: getDialogTitleFor(scope.authorizableType),\r\n                            bodyText: getDialogBodyTextFor(scope.authorizableType, scope.authorizables.keys().length),\r\n                            actionName: $translate.instant('assignPermissionsToContentsConfirmButton'),\r\n                            action: function () {\r\n                                var params = {\r\n                                    authorizables: {\r\n                                        type: scope.authorizableType,\r\n                                        ids: scope.authorizables.keys()\r\n                                    }\r\n                                };\r\n                                assignPermissionsToContentsService.assignPermissionsToContents(params);\r\n                            },\r\n                            errorMessage: $translate.instant('assignPermissionsToContentsError')\r\n                        });\r\n                    };\r\n                    // return true if this authorizableType can be used in Assign Permissions To Contents (project or workbook).\r\n                    scope.canAssignPermissionsToContents = function () {\r\n                        return (scope.authorizableType === VizPortal.ProjectContentType.name\r\n                            || scope.authorizableType === VizPortal.WorkbookContentType.name) &&\r\n                            !VizPortal.FeatureFlags.projectControlledPermissionsEnabled;\r\n                    };\r\n                    scope.$on('$destroy', function () { return assignPermissionsToContentsService.cancelPoll(); });\r\n                    // a helper fn to count set properties; e.g. the sum of multiple projects' workbooks, or multiple workbooks' views.\r\n                    function pluckAndReduceToSum(k) {\r\n                        return _.reduce(scope.authorizables.pluck(k), function (sum, el) { return (sum + el); });\r\n                    }\r\n                    ;\r\n                    // returns the dialog title for the given authorizableType.\r\n                    function getDialogTitleFor(authorizableType) {\r\n                        switch (authorizableType) {\r\n                            case VizPortal.ProjectContentType.name:\r\n                                return $translate.instant('assignPermissionsToContentsConfirmTitle');\r\n                            case VizPortal.WorkbookContentType.name:\r\n                                return $translate.instant('assignPermissionsToViewsConfirmTitle');\r\n                        }\r\n                        ;\r\n                    }\r\n                    ;\r\n                    // get the dialog body text, depending on which context we're in\r\n                    // (workbook or project, single or multi selected)\r\n                    function getDialogBodyTextFor(authorizableType, authorizableCount) {\r\n                        var dialogBodyText;\r\n                        if (scope.authorizableType === VizPortal.ProjectContentType.name) {\r\n                            // assigning permissions to project's contents\r\n                            if (authorizableCount === 1) {\r\n                                // single project case\r\n                                dialogBodyText = $translate.instant('assignPermissionsToContentsConfirmMessageSingleProject', {\r\n                                    PROJECT_NAME: VizPortal.L10n.elideIfLong(scope.authorizables.first().name),\r\n                                    WORKBOOK_COUNT: pluckAndReduceToSum(VizPortal.OrderKeys.workbookCount),\r\n                                    VIEW_COUNT: pluckAndReduceToSum(VizPortal.OrderKeys.viewCount),\r\n                                    DATASOURCE_COUNT: pluckAndReduceToSum(VizPortal.OrderKeys.datasourceCount)\r\n                                }, VizPortal.L10n.Interpolations.Count);\r\n                            }\r\n                            else {\r\n                                // multiple projects case\r\n                                dialogBodyText = $translate.instant('assignPermissionsToContentsConfirmMessageMultiProject', {\r\n                                    PROJECT_COUNT: authorizableCount,\r\n                                    WORKBOOK_COUNT: pluckAndReduceToSum(VizPortal.OrderKeys.workbookCount),\r\n                                    VIEW_COUNT: pluckAndReduceToSum(VizPortal.OrderKeys.viewCount),\r\n                                    DATASOURCE_COUNT: pluckAndReduceToSum(VizPortal.OrderKeys.datasourceCount)\r\n                                }, VizPortal.L10n.Interpolations.Count);\r\n                            }\r\n                        }\r\n                        else if (scope.authorizableType === VizPortal.WorkbookContentType.name) {\r\n                            // assigning permissions to workbook's contents\r\n                            if (authorizableCount === 1) {\r\n                                // single workbook case\r\n                                dialogBodyText = $translate.instant('assignPermissionsToContentsConfirmMessageSingleWorkbook', {\r\n                                    WORKBOOK_NAME: VizPortal.L10n.elideIfLong(scope.authorizables.first().name),\r\n                                    VIEW_COUNT: pluckAndReduceToSum(VizPortal.OrderKeys.numSheets)\r\n                                }, VizPortal.L10n.Interpolations.Count);\r\n                            }\r\n                            else {\r\n                                // multiple workbooks case\r\n                                dialogBodyText = $translate.instant('assignPermissionsToContentsConfirmMessageMultiWorkbook', {\r\n                                    WORKBOOK_COUNT: authorizableCount,\r\n                                    VIEW_COUNT: pluckAndReduceToSum(VizPortal.OrderKeys.numSheets)\r\n                                }, VizPortal.L10n.Interpolations.Count);\r\n                            }\r\n                        }\r\n                        return dialogBodyText;\r\n                    }\r\n                    ;\r\n                }\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbAutoSelect', [\r\n        '$timeout', function ($timeout) {\r\n            return {\r\n                restrict: 'A',\r\n                link: function (scope, element, attr) {\r\n                    // Timeout waits for element to render before selecting\r\n                    var select = function () { return $timeout(function () { return element.focus().select(); }); };\r\n                    if (attr.tbAutoSelect) {\r\n                        scope.$watch(attr.tbAutoSelect, function (val) {\r\n                            if (val)\r\n                                select();\r\n                        }, true);\r\n                    }\r\n                    else {\r\n                        select();\r\n                    }\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbBackgroundImage', function () {\r\n        return {\r\n            restrict: 'A',\r\n            link: function (scope, element, attributes) {\r\n                scope.$watch(attributes['tbBackgroundImage'], function (value) {\r\n                    element.css('background-image', 'url(' + value + ')');\r\n                });\r\n            }\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    /**\r\n     * Similar to ng-click, but checks for tb-disabled\r\n     *\r\n     * Usage:\r\n     *\r\n     *  a(tb-button-click=\"doAction()\")\r\n     *  a(tb-button-click=\"doAction()\" tb-disabled=\"isDisabled()\")\r\n     *\r\n     */\r\n    VizPortal.Module.instance().directive('tbButtonClick', [\r\n        '$parse',\r\n        function ($parse) {\r\n            return {\r\n                restrict: 'A',\r\n                link: function (scope, element, attr) {\r\n                    var clickFn = $parse(attr['tbButtonClick']);\r\n                    element.on('click', function (event) {\r\n                        if (!element.hasClass('tb-disabled')) {\r\n                            scope.$apply(function () {\r\n                                clickFn(scope, { $event: event });\r\n                            });\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    // This is patterned after ngMouseDown,\r\n    // with the addition of the check for tb-disabled.\r\n    VizPortal.Module.instance().directive('tbButtonDown', [\r\n        '$parse',\r\n        function ($parse) {\r\n            return {\r\n                restrict: 'A',\r\n                link: function (scope, element, attr) {\r\n                    var downFn = $parse(attr['tbButtonDown']);\r\n                    element.on('mousedown', function (event) {\r\n                        scope.$apply(function () {\r\n                            if (!element.hasClass('tb-disabled')) {\r\n                                downFn(scope, { $event: event });\r\n                            }\r\n                        });\r\n                    });\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbBytesInputConverter', function () {\r\n        return {\r\n            restrict: 'A',\r\n            require: 'ngModel',\r\n            link: function (scope, elm, attrs, ctrl) {\r\n                ctrl.$parsers.push(function (sizeInGigabytes) {\r\n                    // GB -> B\r\n                    var sizeInBytes = sizeInGigabytes * VizPortal.ByteSizeConversionFactor.ONE_GB;\r\n                    if (!isNaN(sizeInBytes) && sizeInBytes > 0 && _.isFinite(sizeInBytes)) {\r\n                        ctrl.$setValidity('bytes', true);\r\n                        return sizeInBytes;\r\n                    }\r\n                    else {\r\n                        ctrl.$setValidity('bytes', false);\r\n                        return 0;\r\n                    }\r\n                });\r\n                ctrl.$formatters.push(function (sizeInBytes) {\r\n                    // B -> GB\r\n                    if (!isNaN(sizeInBytes) && sizeInBytes > 0 && _.isFinite(sizeInBytes)) {\r\n                        return parseFloat((sizeInBytes / VizPortal.ByteSizeConversionFactor.ONE_GB).toFixed(3));\r\n                    }\r\n                    else {\r\n                        return sizeInBytes;\r\n                    }\r\n                });\r\n            }\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    ;\r\n    VizPortal.Module.instance().directive('tbBulkImportResultsSummary', [\r\n        '$translate',\r\n        'UserActionResultCode',\r\n        function ($translate, userActionResultCode) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                scope: {\r\n                    results: '='\r\n                },\r\n                templateUrl: 'bulkImportResultsSummary.html',\r\n                link: function (scope) {\r\n                    scope.$watch('results', function () {\r\n                        parseResults();\r\n                    });\r\n                    function parseResults() {\r\n                        if (!scope.results)\r\n                            return;\r\n                        scope.usersSkippedMessage = $translate.instant('userActionBulkOperationNumberSkipped', { COUNT: scope.results.skippedLineCount }, VizPortal.L10n.Interpolations.Count);\r\n                        scope.usersProcessedMessage = $translate.instant('userActionBulkOperationNumberProcessed', { COUNT: scope.results.processedLineCount }, VizPortal.L10n.Interpolations.Count);\r\n                        var successResultsByCode = aggregateByResultCode(scope.results.results);\r\n                        scope.successResults = addLocalizedResultMessage(successResultsByCode);\r\n                        var errorResultsByCode = aggregateByErrorCode(scope.results.errors);\r\n                        scope.errorResults = addLocalizedErrorMessage(errorResultsByCode);\r\n                    }\r\n                    ;\r\n                    function aggregateByResultCode(results) {\r\n                        var successResultsByCode = {};\r\n                        // aggregate success results by result code\r\n                        _.each(results, function (user) {\r\n                            _.each(user.codes, function (code) {\r\n                                if (!successResultsByCode[code]) {\r\n                                    successResultsByCode[code] = {\r\n                                        code: code,\r\n                                        usernames: user.username,\r\n                                        count: 1\r\n                                    };\r\n                                }\r\n                                else {\r\n                                    successResultsByCode[code].usernames += \", \" + user.username;\r\n                                    ++successResultsByCode[code].count;\r\n                                }\r\n                            });\r\n                        });\r\n                        return successResultsByCode;\r\n                    }\r\n                    function addLocalizedResultMessage(aggregatedResults) {\r\n                        return _.map(aggregatedResults, function (value) {\r\n                            return _.extend(value, {\r\n                                message: userActionResultCode.toLocalizedResultMessage(value.code, value.count)\r\n                            });\r\n                        });\r\n                    }\r\n                    function addLocalizedErrorMessage(aggregatedResults) {\r\n                        return _.map(aggregatedResults, function (value) {\r\n                            return _.extend(value, {\r\n                                message: userActionResultCode.toLocalizedErrorMessage(value.code, value.count)\r\n                            });\r\n                        });\r\n                    }\r\n                    function aggregateByErrorCode(errors) {\r\n                        var errorResultsByCode = {};\r\n                        _.each(errors, function (error) {\r\n                            if (!error.username) {\r\n                                // for some errors (like UsernameMissing) there is no username.\r\n                                // So, show the line number were we would usually show the username.\r\n                                error.username = $translate.instant('userActionBulkOperationErrorLineNumber', { LINE_NUMBER: error.line }, VizPortal.L10n.Interpolations.Count);\r\n                            }\r\n                            var code = error.errorCode;\r\n                            if (!errorResultsByCode[code]) {\r\n                                errorResultsByCode[code] = {\r\n                                    code: code,\r\n                                    usernames: error.username,\r\n                                    count: 1\r\n                                };\r\n                            }\r\n                            else {\r\n                                errorResultsByCode[code].usernames += \", \" + error.username;\r\n                                ++errorResultsByCode[code].count;\r\n                            }\r\n                        });\r\n                        return errorResultsByCode;\r\n                    }\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    // Notification For:\r\n    // => update display name for a single user\r\n    var UpdateUserDisplayNameNotification = (function () {\r\n        function UpdateUserDisplayNameNotification($translate, toaster) {\r\n            this.$translate = $translate;\r\n            this.toaster = toaster;\r\n        }\r\n        UpdateUserDisplayNameNotification.prototype.notify = function (result, username, displayName) {\r\n            if (!!result.errors && result.errors.length > 0) {\r\n                var errorMsg = this.errorMessageFor(result.errors[0], username);\r\n                this.toaster.pop({ type: VizPortal.ToastType.Error, text: errorMsg });\r\n            }\r\n            else {\r\n                var successMsg = this.$translate.instant('updateUserDisplayNameSuccess', { USER_NAME: VizPortal.L10n.elideIfLong(username), DISPLAY_NAME: VizPortal.L10n.elideIfLong(displayName) });\r\n                this.toaster.pop({ type: VizPortal.ToastType.Info, text: successMsg });\r\n            }\r\n        };\r\n        UpdateUserDisplayNameNotification.prototype.errorMessageFor = function (error, username) {\r\n            switch (error.code) {\r\n                case VizPortal.CommonErrorCode.SystemUserNotFound:\r\n                    return this.$translate.instant('errorSystemUserNotFound', { USER_NAME: VizPortal.L10n.elideIfLong(username) });\r\n                default:\r\n                    return this.$translate.instant('errorUnknown');\r\n            }\r\n        };\r\n        UpdateUserDisplayNameNotification.$inject = [\r\n            '$translate',\r\n            'ToasterService'];\r\n        return UpdateUserDisplayNameNotification;\r\n    })();\r\n    VizPortal.UpdateUserDisplayNameNotification = UpdateUserDisplayNameNotification;\r\n    VizPortal.Module.instance().service('UpdateUserDisplayNameNotification', UpdateUserDisplayNameNotification);\r\n    // Notification For:\r\n    // => update display name for a single user\r\n    var UpdateUserEmailNotification = (function () {\r\n        function UpdateUserEmailNotification($translate, toaster) {\r\n            this.$translate = $translate;\r\n            this.toaster = toaster;\r\n        }\r\n        UpdateUserEmailNotification.prototype.notify = function (result, username, email) {\r\n            if (!!result.errors && result.errors.length > 0) {\r\n                var errorMsg = this.errorMessageFor(result.errors[0], username);\r\n                this.toaster.pop({ type: VizPortal.ToastType.Error, text: errorMsg });\r\n            }\r\n            else {\r\n                var successMsg = this.$translate.instant('updateUserEmailSuccess', { USER_NAME: VizPortal.L10n.elideIfLong(username), EMAIL: email });\r\n                this.toaster.pop({ type: VizPortal.ToastType.Info, text: successMsg });\r\n            }\r\n        };\r\n        UpdateUserEmailNotification.prototype.errorMessageFor = function (error, username) {\r\n            switch (error.code) {\r\n                case VizPortal.CommonErrorCode.SystemUserNotFound:\r\n                    return this.$translate.instant('errorSystemUserNotFound', { USER_NAME: VizPortal.L10n.elideIfLong(username) });\r\n                default:\r\n                    return this.$translate.instant('errorUnknown');\r\n            }\r\n        };\r\n        UpdateUserEmailNotification.$inject = [\r\n            '$translate',\r\n            'ToasterService'];\r\n        return UpdateUserEmailNotification;\r\n    })();\r\n    VizPortal.UpdateUserEmailNotification = UpdateUserEmailNotification;\r\n    VizPortal.Module.instance().service('UpdateUserEmailNotification', UpdateUserEmailNotification);\r\n    // Notification For:\r\n    // => synchronize a single AD user (uses importUsersFromAD API)\r\n    var SyncUserActionNotification = (function () {\r\n        function SyncUserActionNotification($translate, toaster) {\r\n            this.$translate = $translate;\r\n            this.toaster = toaster;\r\n        }\r\n        SyncUserActionNotification.prototype.notify = function (result, username) {\r\n            if (!!result.errors && result.errors.length > 0) {\r\n                var errorMsg = this.errorMessageFor(result.errors[0], username);\r\n                this.toaster.pop({ type: VizPortal.ToastType.Error, text: errorMsg });\r\n            }\r\n            else {\r\n                var successMsg = this.$translate.instant('syncUserSuccess', { USER_NAME: VizPortal.L10n.elideIfLong(username) });\r\n                this.toaster.pop({ type: VizPortal.ToastType.Info, text: successMsg });\r\n            }\r\n        };\r\n        SyncUserActionNotification.prototype.errorMessageFor = function (error, username) {\r\n            switch (error.code) {\r\n                case VizPortal.CommonErrorCode.SystemUserNotFound:\r\n                    return this.$translate.instant('errorSystemUserNotFound', { USER_NAME: VizPortal.L10n.elideIfLong(username) });\r\n                default:\r\n                    return this.$translate.instant('errorUnknown');\r\n            }\r\n        };\r\n        SyncUserActionNotification.$inject = [\r\n            '$translate',\r\n            'ToasterService'];\r\n        return SyncUserActionNotification;\r\n    })();\r\n    VizPortal.SyncUserActionNotification = SyncUserActionNotification;\r\n    VizPortal.Module.instance().service('SyncUserActionNotification', SyncUserActionNotification);\r\n    // Notification For:\r\n    // => changing password of a user\r\n    var ChangePasswordNotification = (function () {\r\n        function ChangePasswordNotification($translate, toaster) {\r\n            this.$translate = $translate;\r\n            this.toaster = toaster;\r\n        }\r\n        ChangePasswordNotification.prototype.notify = function (result, username) {\r\n            if (!!result.errors && result.errors.length > 0) {\r\n                var errorMsg = this.errorMessageFor(result.errors[0], username);\r\n                this.toaster.pop({ type: VizPortal.ToastType.Error, text: errorMsg });\r\n            }\r\n            else {\r\n                var successMsg = this.$translate.instant('changePasswordSuccess', { USER_NAME: VizPortal.L10n.elideIfLong(username) });\r\n                this.toaster.pop({ type: VizPortal.ToastType.Info, text: successMsg });\r\n            }\r\n        };\r\n        ChangePasswordNotification.prototype.errorMessageFor = function (error, username) {\r\n            switch (error.code) {\r\n                case VizPortal.CommonErrorCode.SystemUserNotFound:\r\n                    return this.$translate.instant('errorSystemUserNotFound', { USER_NAME: VizPortal.L10n.elideIfLong(username) });\r\n                case VizPortal.UserErrorCode.UserInvalidPassword:\r\n                    return this.$translate.instant('errorUserOldPasswordIncorrect');\r\n                default:\r\n                    return this.$translate.instant('errorUnknown');\r\n            }\r\n        };\r\n        ChangePasswordNotification.$inject = [\r\n            '$translate',\r\n            'ToasterService'];\r\n        return ChangePasswordNotification;\r\n    })();\r\n    VizPortal.ChangePasswordNotification = ChangePasswordNotification;\r\n    VizPortal.Module.instance().service('ChangePasswordNotification', ChangePasswordNotification);\r\n    var ChangeLanguageNotification = (function () {\r\n        function ChangeLanguageNotification($translate, toaster) {\r\n            this.$translate = $translate;\r\n            this.toaster = toaster;\r\n        }\r\n        ChangeLanguageNotification.prototype.notify = function (result, username) {\r\n            if (!!result.errors && result.errors.length > 0) {\r\n                var errorMsg = this.errorMessageFor(result.errors[0], username);\r\n                this.toaster.pop({ type: VizPortal.ToastType.Error, text: errorMsg });\r\n            }\r\n            else {\r\n                var successMsg = this.$translate.instant('changeLanguageSuccess', { USER_NAME: VizPortal.L10n.elideIfLong(username) });\r\n                this.toaster.pop({ type: VizPortal.ToastType.Info, text: successMsg });\r\n            }\r\n        };\r\n        ChangeLanguageNotification.prototype.errorMessageFor = function (error, username) {\r\n            switch (error.code) {\r\n                case VizPortal.CommonErrorCode.SystemUserNotFound:\r\n                    return this.$translate.instant('errorSystemUserNotFound', { USER_NAME: VizPortal.L10n.elideIfLong(username) });\r\n                default:\r\n                    return this.$translate.instant('errorUnknown');\r\n            }\r\n        };\r\n        ChangeLanguageNotification.$inject = ['$translate', 'ToasterService'];\r\n        return ChangeLanguageNotification;\r\n    })();\r\n    VizPortal.ChangeLanguageNotification = ChangeLanguageNotification;\r\n    VizPortal.Module.instance().service('ChangeLanguageNotification', ChangeLanguageNotification);\r\n    var ChangeLocaleNotification = (function () {\r\n        function ChangeLocaleNotification($translate, toaster) {\r\n            this.$translate = $translate;\r\n            this.toaster = toaster;\r\n        }\r\n        ChangeLocaleNotification.prototype.notify = function (result, username) {\r\n            if (!!result.errors && result.errors.length > 0) {\r\n                var errorMsg = this.errorMessageFor(result.errors[0], username);\r\n                this.toaster.pop({ type: VizPortal.ToastType.Error, text: errorMsg });\r\n            }\r\n            else {\r\n                var successMsg = this.$translate.instant('changeLocaleSuccess', { USER_NAME: VizPortal.L10n.elideIfLong(username) });\r\n                this.toaster.pop({ type: VizPortal.ToastType.Info, text: successMsg });\r\n            }\r\n        };\r\n        ChangeLocaleNotification.prototype.errorMessageFor = function (error, username) {\r\n            switch (error.code) {\r\n                case VizPortal.CommonErrorCode.SystemUserNotFound:\r\n                    return this.$translate.instant('errorSystemUserNotFound', { USER_NAME: VizPortal.L10n.elideIfLong(username) });\r\n                default:\r\n                    return this.$translate.instant('errorUnknown');\r\n            }\r\n        };\r\n        ChangeLocaleNotification.$inject = ['$translate', 'ToasterService'];\r\n        return ChangeLocaleNotification;\r\n    })();\r\n    VizPortal.ChangeLocaleNotification = ChangeLocaleNotification;\r\n    VizPortal.Module.instance().service('ChangeLocaleNotification', ChangeLocaleNotification);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../resources/UserSettings.ts\" />\r\n/// <reference path=\"../services/UserSettingsNotification.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbChangePassword', [\r\n        'ChangePasswordNotification',\r\n        'ServerService',\r\n        'UserSettings',\r\n        function (changePasswordNotification, serverService, userSettings) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'changePassword.html',\r\n                scope: {\r\n                    userId: '&',\r\n                    username: '&'\r\n                },\r\n                link: function (scope) {\r\n                    scope.busy = false;\r\n                    scope.fields = {\r\n                        currentPassword: \"\",\r\n                        confirmPassword: \"\",\r\n                        newPassword: \"\"\r\n                    };\r\n                    scope.editMode = false;\r\n                    // Require confirming your current password to change your own password\r\n                    scope.requireCurrentPassword = serverService.isSessionUserSelf();\r\n                    scope.clearAndCollapseFields = function () {\r\n                        scope.fields.currentPassword = \"\";\r\n                        scope.fields.newPassword = \"\";\r\n                        scope.fields.confirmPassword = \"\";\r\n                        scope.editMode = false;\r\n                    };\r\n                    scope.clearAndShowFields = function () {\r\n                        scope.fields.currentPassword = \"\";\r\n                        scope.fields.newPassword = \"\";\r\n                        scope.fields.confirmPassword = \"\";\r\n                        scope.editMode = true;\r\n                    };\r\n                    scope.save = function () {\r\n                        scope.busy = true;\r\n                        var currentPassword = scope.fields.currentPassword;\r\n                        var newPassword = scope.fields.newPassword;\r\n                        var userId = scope.userId();\r\n                        return userSettings.changeUserPassword(userId, newPassword, currentPassword)\r\n                            .then(function (result) {\r\n                            // toasts\r\n                            changePasswordNotification.notify(result, scope.username());\r\n                            scope.busy = false;\r\n                            scope.clearAndCollapseFields();\r\n                        });\r\n                    };\r\n                    scope.disableSaveButton = function () {\r\n                        return scope.passwordForm.$invalid || scope.busy;\r\n                    };\r\n                }\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../../ts/libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var CheckboxGroupCtrl = (function () {\r\n        function CheckboxGroupCtrl() {\r\n        }\r\n        return CheckboxGroupCtrl;\r\n    })();\r\n    VizPortal.CheckboxGroupCtrl = CheckboxGroupCtrl;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../../ts/libs.ts\" />\r\n/// <reference path=\"../../../ts/Module.ts\" />\r\n/// <reference path=\"CheckboxGroupCtrl.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    /* Custom checkbox control. Two ways to use:\r\n    *\r\n    *  1. Two-way binding to a scope property, like in a form. Includes all the fancy Angular form\r\n    *     features: http://docs.angularjs.org/guide/forms\r\n    *\r\n    *       tb:checkbox(ng-model=\"model.bool\")\r\n    *\r\n    *     For a checkbox with a clickable label\r\n    *\r\n    *       tb:checkbox-group\r\n    *         tb:checkbox\r\n    *         tb:checkbox-label Content\r\n    *\r\n    *  2. Reflect value of expressions. You'll have to define an ng-click if you want behavior on click.\r\n    *\r\n    *       tb:checkbox(checked=\"amIAwesome()\")\r\n    *\r\n    */\r\n    VizPortal.Module.instance().directive('tbCheckbox', [\r\n        function () {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                require: ['?ngModel', '^?tbCheckboxGroup'],\r\n                templateUrl: 'checkbox.html',\r\n                scope: {\r\n                    checked: '&'\r\n                },\r\n                link: function (scope, elm, attrs, ctrls) {\r\n                    var ngModelCtrl = ctrls[0];\r\n                    var checkboxGroupCtrl = ctrls[1];\r\n                    if (!ngModelCtrl) {\r\n                        return;\r\n                    }\r\n                    var disabled = function () { return elm.hasClass('tb-disabled'); };\r\n                    scope.checked = function () { return ngModelCtrl.$viewValue; };\r\n                    scope.toggle = function () {\r\n                        if (disabled())\r\n                            return;\r\n                        ngModelCtrl.$setViewValue(!ngModelCtrl.$viewValue);\r\n                        ngModelCtrl.$render();\r\n                    };\r\n                    if (checkboxGroupCtrl) {\r\n                        checkboxGroupCtrl.toggle = scope.toggle;\r\n                        checkboxGroupCtrl.disabled = disabled;\r\n                    }\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../../ts/libs.ts\" />\r\n/// <reference path=\"../../../ts/Module.ts\" />\r\n/// <reference path=\"CheckboxGroupCtrl.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbCheckboxGroup', [\r\n        function () {\r\n            return {\r\n                restrict: 'E',\r\n                transclude: true,\r\n                replace: true,\r\n                template: '<div class=\"tb-checkbox-group\" ng-transclude></div>',\r\n                controller: VizPortal.CheckboxGroupCtrl\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../../ts/libs.ts\" />\r\n/// <reference path=\"../../../ts/Module.ts\" />\r\n/// <reference path=\"CheckboxGroupCtrl.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbCheckboxLabel', [\r\n        function () {\r\n            return {\r\n                restrict: 'E',\r\n                transclude: true,\r\n                replace: true,\r\n                require: '^tbCheckboxGroup',\r\n                templateUrl: 'checkboxLabel.html',\r\n                link: function ($scope, elm, attrs, checkboxGroupCtrl) {\r\n                    $scope.ctrl = checkboxGroupCtrl;\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var MAX_CHARACTER_LENGTH_DEFAULT = 50000;\r\n    VizPortal.Module.instance().directive('tbCreateTextarea', [\r\n        function () {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'createTextarea.html',\r\n                scope: {\r\n                    onBeforeSave: '&',\r\n                    maxCharacterLength: '=?'\r\n                },\r\n                link: function ($scope, element, attrs) {\r\n                    $scope.busy = false;\r\n                    var textarea = element.find(\"textarea\");\r\n                    if (!$scope.maxCharacterLength)\r\n                        $scope.maxCharacterLength = MAX_CHARACTER_LENGTH_DEFAULT;\r\n                    $scope.add = function () {\r\n                        if ($scope.text.length !== 0) {\r\n                            $scope.busy = true;\r\n                            $scope.onBeforeSave({ newText: $scope.text }).then(\r\n                            // Success\r\n                            // Success\r\n                            function () {\r\n                                $scope.text = \"\";\r\n                                $scope.busy = false;\r\n                                $scope.clickedInElement = false;\r\n                            }, \r\n                            // Error\r\n                            // Error\r\n                            function () {\r\n                                // TODO: show error message\r\n                                $scope.busy = false;\r\n                            });\r\n                        }\r\n                    };\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../controllers/DataGridCtrl.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    // Example usage:\r\n    //\r\n    //   tb:template-list(templates=\"headers\")\r\n    //     tb:template(key=\"name\")\r\n    //       span Name\r\n    //     tb:template(key=\"value\")\r\n    //       span Value\r\n    //\r\n    //   tb:template-list(templates=\"cells\")\r\n    //     tb:template\r\n    //       span {{row.name}}\r\n    //     tb:template\r\n    //       span {{row.value}}\r\n    //\r\n    //   tb:data-grid(\r\n    //       headers=\"headers\",\r\n    //       cells=\"cells\",\r\n    //       items=\"items\",\r\n    //       current-row-index=\"currentRowIndex\",\r\n    //       always-have-current-row=\"true\",\r\n    //       is-row-selected=\"isRowSelected(row)\",\r\n    //       header-clicked=\"headerClicked(header)\",\r\n    //       row-clicked=\"rowClicked(row, colIndex)\"\r\n    //       slice-changed=\"sliceChanged(newSlice)\")\r\n    //\r\n    // \"headers\" is an array of ITemplate objects that define the contents of the headers.\r\n    // \"cells\" is an array of ITemplate objects that define the contents of the cells.\r\n    // \"items\" is an ISliceable. The data grid will fetch the slice to populate the grid.\r\n    // \"current-row-index\" is the index of the 'current' row (the definition of 'current' depends on context).\r\n    // \"always-have-current-row\" means there will always be a current row (i.e. current-row-index will only be -1 if the grid is empty)\r\n    // \"is-row-selected\" is a callback (row => boolean) that determines whether each row is shown as selected.\r\n    // \"header-clicked\" is a callback (header => void) that is called when a header is clicked.\r\n    // \"row-clicked\" is a callback (row, colIndex? => void) that is called when a row is clicked.\r\n    // The colIndex parameter to the \"row-clicked\" callback is the index (zero-based) of the column that was clicked,\r\n    // or undefined if the click occurred outside any column.\r\n    // \"slice-changed\" is a callback (newSlice => void) that is called whenever the \"slice\" of visible rows is updated.\r\n    // The \"newSlice\" parameter is of type ListResult<any>, where the values are the rows.\r\n    //\r\n    // The cell templates' scope is extended with the following properties:\r\n    // \"row\": the row object\r\n    // \"slice\" the current slice (see slice-changed above)\r\n    VizPortal.Module.instance().directive('tbDataGrid', function () {\r\n        return {\r\n            restrict: 'E',\r\n            replace: true,\r\n            templateUrl: 'dataGrid.html',\r\n            scope: {\r\n                headers: '=',\r\n                cells: '=',\r\n                items: '=',\r\n                currentRowIndex: '=?',\r\n                currentRowObject: '=?',\r\n                columnWidths: '=?',\r\n                alwaysHaveCurrentRow: '=',\r\n                isRowSelected: '&',\r\n                headerClicked: '&',\r\n                rowClicked: '&',\r\n                rowsClickable: '=',\r\n                rowHeight: '=?',\r\n                sliceChanged: '&',\r\n                emptyTemplate: '=?',\r\n                emptyTemplateModel: '=?'\r\n            },\r\n            controller: VizPortal.DataGridCtrl\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../controllers/ScrollCtrl.ts\" />\r\n/// <reference path=\"../fetchers/ListResult.ts\" />\r\n/// <reference path=\"../models/ColumnWidths.ts\" />\r\n/// <reference path=\"../models/IEmptyTemplate.ts\" />\r\n/// <reference path=\"../models/ILayout.ts\" />\r\n/// <reference path=\"../models/ISliceable.ts\" />\r\n/// <reference path=\"../models/ITemplate.ts\" />\r\n/// <reference path=\"../models/ListLayout.ts\" />\r\n/// <reference path=\"../services/BrowserSupportService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DataGridBodyCtrl = (function () {\r\n        function DataGridBodyCtrl($scope, $element, $timeout, BrowserSupportService) {\r\n            var _this = this;\r\n            this.$scope = $scope;\r\n            this.$element = $element;\r\n            this.$timeout = $timeout;\r\n            $scope.layout = new VizPortal.ListLayout($scope.rowHeight);\r\n            if (!$scope.keepColumnWidths) {\r\n                this.$element.css('visibility', 'hidden');\r\n            }\r\n            $scope.handleSliceChanged = function (newSlice) {\r\n                var prevSlice = _this.slice;\r\n                var hadItems = prevSlice && prevSlice.items.length > 0;\r\n                _this.slice = newSlice;\r\n                var haveItems = newSlice && newSlice.items.length > 0;\r\n                $scope.empty = !haveItems;\r\n                $scope.emptyTemplateModel = $scope.emptyTemplateModel || {};\r\n                _this.ensureCurrentRowIndexInRange();\r\n                if (!$scope.keepColumnWidths) {\r\n                    if (!hadItems) {\r\n                        if (haveItems) {\r\n                            // We going from no items to some items, so reset the actual widths.\r\n                            // Otherwise, the default widths will stick, but we want to resize based on content.\r\n                            if ($scope.columnWidths && $scope.columnWidths.resetActual) {\r\n                                _this.$element.css('visibility', 'hidden');\r\n                                _this.$scope.columnWidths.resetActual();\r\n                            }\r\n                            // Once the new content has loaded, measure the new widths.\r\n                            _this.$timeout(function () {\r\n                                var contentWidths = _.map(_this.$element.find('.tb-data-grid-body-column'), function (column) {\r\n                                    var rect = column.getBoundingClientRect();\r\n                                    return Math.ceil(rect.right - rect.left); // to correct for non-integer widths\r\n                                });\r\n                                _this.$scope.contentWidthsChanged({ contentWidths: contentWidths, containerWidth: _this.getGridWidth() });\r\n                                _this.$element.css('visibility', 'visible');\r\n                            });\r\n                        }\r\n                        else {\r\n                            if (!prevSlice) {\r\n                                // We got a slice with no items on first load.\r\n                                // We need to size the columns, but we have no content to base the sizes on,\r\n                                // so pick some reasonable defaults.\r\n                                var containerWidth = _this.getGridWidth();\r\n                                var remainingSpace = containerWidth;\r\n                                var contentWidths = [];\r\n                                for (var i = 0, l = $scope.cells.length; i < l; i++) {\r\n                                    var cell = $scope.cells[i];\r\n                                    // If the column has a default width specified, prefer that.\r\n                                    var contentWidth = parseInt(cell.attrs['defaultWidth'], 10);\r\n                                    if (!(contentWidth >= 0)) {\r\n                                        // If it doesn't, give it a proportional amount of the remaining space.\r\n                                        contentWidth = remainingSpace / (l - i);\r\n                                    }\r\n                                    // Take the minimum width of the column into account.\r\n                                    if ($scope.columnWidths && $scope.columnWidths.getMin) {\r\n                                        contentWidth = Math.max(contentWidth, $scope.columnWidths.getMin(i));\r\n                                    }\r\n                                    contentWidths.push(contentWidth);\r\n                                    remainingSpace -= contentWidth;\r\n                                }\r\n                                _this.$scope.contentWidthsChanged({ contentWidths: contentWidths, containerWidth: containerWidth });\r\n                            }\r\n                            _this.$element.css('visibility', 'visible');\r\n                        }\r\n                    }\r\n                }\r\n                if (_this.$scope.sliceChanged) {\r\n                    _this.$scope.sliceChanged({ newSlice: newSlice });\r\n                }\r\n                _this.updateCurrentRowObject();\r\n            };\r\n            $scope.colIndex = function (child) {\r\n                return parseInt(child.attr('data-col-index'), 10);\r\n            };\r\n            $scope.rowIndex = function (child) {\r\n                return parseInt(child.attr('data-row-index'), 10);\r\n            };\r\n            $scope.setHoverRow = function (rowElement, locals) {\r\n                if (_this.hoverRow) {\r\n                    _this.hoverRow.removeClass('tb-data-grid-hover-row');\r\n                }\r\n                _this.hoverRow = rowElement;\r\n                if (_this.hoverRow && !BrowserSupportService.isTouch()) {\r\n                    _this.hoverRow.addClass('tb-data-grid-hover-row');\r\n                }\r\n                $scope.rowHovered(locals);\r\n            };\r\n            $scope.isCurrentRowIndex = function (rowIndex) {\r\n                return $scope.currentRowIndex === _this.slice.index + rowIndex;\r\n            };\r\n            $scope.setActiveRow = function (row) {\r\n                _this.clearActiveRow();\r\n                if (row && $scope.rowsClickable) {\r\n                    var rowIndex = $scope.rowIndex(row);\r\n                    // Set the \"current\" row to the active row\r\n                    $scope.currentRowIndex = _this.slice.index + rowIndex;\r\n                    // Update class on active background row\r\n                    _this.activeRow = _this.getBackgroundRow(rowIndex).addClass('tb-data-grid-active-row');\r\n                }\r\n            };\r\n            $scope.setActiveRowIfHoverRow = function (row) {\r\n                if (_this.hoverRow) {\r\n                    $scope.setActiveRow(row);\r\n                }\r\n            };\r\n            $scope.clearActiveRow = function () { return _this.clearActiveRow(); };\r\n            $scope.setHoverRowIndex = function (rowIndex, locals) {\r\n                $scope.setHoverRow(_this.getBackgroundRow(rowIndex), locals);\r\n            };\r\n            $scope.getElementsOfSelectedRows = function () {\r\n                var selectedIndices = [];\r\n                _.each(_this.slice.items, function (row, index) {\r\n                    if (_this.$scope.isRowSelected({ row: row })) {\r\n                        selectedIndices.push(index);\r\n                    }\r\n                });\r\n                return _this.getBackgroundRows(selectedIndices);\r\n            };\r\n            $scope.$watch('currentRowIndex', function () {\r\n                _this.ensureCurrentRowIndexInRange();\r\n                if ($scope.currentRowIndex >= 0 && $scope.scrollControls) {\r\n                    $scope.scrollControls.scrollIntoView($scope.currentRowIndex);\r\n                }\r\n                _this.updateCurrentRowObject();\r\n            });\r\n        }\r\n        DataGridBodyCtrl.prototype.clearActiveRow = function () {\r\n            if (this.activeRow) {\r\n                this.activeRow.removeClass('tb-data-grid-active-row');\r\n                this.activeRow = null;\r\n            }\r\n        };\r\n        DataGridBodyCtrl.prototype.ensureCurrentRowIndexInRange = function () {\r\n            var idx = this.$scope.currentRowIndex;\r\n            if (this.slice && _.isFinite(idx)) {\r\n                idx = Math.min(Math.max(-1, idx), this.slice.total - 1);\r\n                if (this.$scope.alwaysHaveCurrentRow) {\r\n                    idx = Math.max(0, idx);\r\n                }\r\n            }\r\n            else {\r\n                idx = -1;\r\n            }\r\n            this.$scope.currentRowIndex = idx;\r\n        };\r\n        /**\r\n         * Get width of the usable grid area (scrollbar not included)\r\n         */\r\n        DataGridBodyCtrl.prototype.getGridWidth = function () {\r\n            // An optional left margin can be added to the body columns, so we have to take that into account.\r\n            // See tb-data-grid-margin-left.\r\n            var backgroundWidth = this.$element.find('.tb-data-grid-body-background').width();\r\n            var marginWidth = parseInt(this.$element.find('.tb-data-grid-body-columns').css('margin-left'), 10) || 0;\r\n            return backgroundWidth - marginWidth;\r\n        };\r\n        DataGridBodyCtrl.prototype.getBackgroundRow = function (rowIndex) {\r\n            return this.$element.find('.tb-data-grid-row-background').eq(rowIndex);\r\n        };\r\n        DataGridBodyCtrl.prototype.getBackgroundRows = function (rowIndices) {\r\n            return this.$element.find('.tb-data-grid-row-background').filter(function (index) {\r\n                // Note: not using _.contains because it performs a linear search.\r\n                return _.indexOf(rowIndices, index, true) >= 0;\r\n            });\r\n        };\r\n        DataGridBodyCtrl.prototype.updateCurrentRowObject = function () {\r\n            if (!this.slice || this.$scope.currentRowIndex < 0) {\r\n                this.$scope.currentRowObject = null;\r\n            }\r\n            else {\r\n                this.$scope.currentRowObject = this.slice.items[this.$scope.currentRowIndex - this.slice.index];\r\n            }\r\n        };\r\n        DataGridBodyCtrl.$inject = ['$scope', '$element', '$timeout', 'BrowserSupportService'];\r\n        return DataGridBodyCtrl;\r\n    })();\r\n    VizPortal.DataGridBodyCtrl = DataGridBodyCtrl;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../controllers/DataGridBodyCtrl.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbDataGridBody', function () {\r\n        return {\r\n            restrict: 'E',\r\n            replace: true,\r\n            templateUrl: 'dataGridBody.html',\r\n            scope: {\r\n                cells: '=',\r\n                columnWidths: '=',\r\n                contentWidthsChanged: '&',\r\n                isRowSelected: '&',\r\n                isRowSeparator: '&',\r\n                rowClicked: '&',\r\n                rowHovered: '&',\r\n                rows: '=',\r\n                rowsClickable: '=',\r\n                rowHeight: '=?',\r\n                currentRowIndex: '=?',\r\n                sliceChanged: '&',\r\n                getElementsOfSelectedRows: '=?',\r\n                currentRowObject: '=?',\r\n                alwaysHaveCurrentRow: '=',\r\n                scrollControls: '=?',\r\n                scrollLeftChanged: '&',\r\n                emptyTemplate: '=?',\r\n                emptyTemplateModel: '=?',\r\n                keepColumnWidths: '='\r\n            },\r\n            controller: VizPortal.DataGridBodyCtrl\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    // TODO: rename to tbDataGridRow, and refactor the willRowBeDeleted (line-through) into another directive.\r\n    VizPortal.Module.instance().directive('tbDataGridEditableRow', function () {\r\n        return {\r\n            restrict: 'E',\r\n            replace: true,\r\n            templateUrl: 'dataGridEditableRow.html',\r\n            scope: {\r\n                cells: '=',\r\n                data: '=',\r\n                columnWidths: '=',\r\n                willRowBeDeleted: '=' // boolean representing if we should apply the line-through visual style\r\n            }\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/ColumnWidths.ts\" />\r\n/// <reference path=\"../models/ITemplate.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbDataGridHeaders', [\r\n        '$timeout',\r\n        function ($timeout) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'dataGridHeaders.html',\r\n                scope: {\r\n                    columnWidths: '=',\r\n                    headerClicked: '&',\r\n                    headers: '=',\r\n                    headerWidthsChanged: '&'\r\n                },\r\n                link: function (scope, element) {\r\n                    scope.resize = function (xPos) {\r\n                        scope.$apply(function () {\r\n                            scope.columnWidths.resizer.continueResize(xPos);\r\n                        });\r\n                    };\r\n                    scope.$watch('headers', function (headers) {\r\n                        if (headers && headers.length > 0) {\r\n                            $timeout(function () {\r\n                                var headerWidths = _.map(element.find('.tb-data-grid-header'), function (header) {\r\n                                    var rect = header.getBoundingClientRect();\r\n                                    return Math.ceil(rect.right - rect.left); // to correct for non-integer widths\r\n                                });\r\n                                scope.headerWidthsChanged({ headerWidths: headerWidths });\r\n                            });\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../../ts/libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DayCell = (function () {\r\n        function DayCell(day) {\r\n            this.otherMonth = false;\r\n            this.selected = false;\r\n            this.today = false;\r\n            this.day = day;\r\n        }\r\n        DayCell.prototype.dayNumber = function () {\r\n            return this.day.getDate();\r\n        };\r\n        return DayCell;\r\n    })();\r\n    VizPortal.DayCell = DayCell;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../../ts/libs.ts\" />\r\n/// <reference path=\"../../../ts/L10n/L10n.ts\" />\r\n/// <reference path=\"DayCell.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var Calendar = (function () {\r\n        function Calendar(month) {\r\n            // Function to return today's date\r\n            this.today = function () { return new Date(); };\r\n            this.showMonth(month);\r\n        }\r\n        // Useful for testing\r\n        // TODO: maybe use an injected clock instead, which can be easily mocked/stubbed for testing\r\n        Calendar.prototype.setToday = function (today) {\r\n            this.today = function () { return today; };\r\n            this.updateDayCells();\r\n        };\r\n        Calendar.prototype.showMonth = function (date) {\r\n            this.firstDayOfMonth = Calendar.monthOf(date || this.today());\r\n            // TODO: the call to updateDayCells() reconstructs the weeks array, which might be a\r\n            // performance issue.  If so, then optimize to only update the two (max) cells affected.\r\n            this.updateDayCells();\r\n        };\r\n        Calendar.prototype.updateDayCells = function () {\r\n            this.weeks = [];\r\n            var firstDayOfWeek = VizPortal.L10n.firstDayOfWeek();\r\n            var day = new Date(this.firstDayOfMonth.getFullYear(), this.firstDayOfMonth.getMonth(), (1 + firstDayOfWeek) - this.firstDayOfMonth.getDay());\r\n            // Always show exactly six weeks\r\n            for (var weekNumber = 0; weekNumber < 6; weekNumber++) {\r\n                var days = [];\r\n                for (var i = 0; i < 7; i++) {\r\n                    var dayCell = new VizPortal.DayCell(day);\r\n                    dayCell.otherMonth = day.getMonth() !== this.firstDayOfMonth.getMonth();\r\n                    dayCell.selected = this.isSelected(day);\r\n                    dayCell.today = this.isToday(day);\r\n                    days.push(dayCell);\r\n                    day = new Date(day.getFullYear(), day.getMonth(), day.getDate() + 1);\r\n                }\r\n                this.weeks.push(days);\r\n            }\r\n        };\r\n        Calendar.monthOf = function (day) {\r\n            return new Date(day.getFullYear(), day.getMonth(), 1);\r\n        };\r\n        Calendar.isSameDay = function (day1, day2) {\r\n            return day1.getDate() === day2.getDate()\r\n                && day1.getMonth() === day2.getMonth()\r\n                && day1.getFullYear() === day2.getFullYear();\r\n        };\r\n        Calendar.prototype.isToday = function (day) {\r\n            return Calendar.isSameDay(this.today(), day);\r\n        };\r\n        Calendar.prototype.isSelected = function (day) {\r\n            return this.selectedDate && Calendar.isSameDay(this.selectedDate, day);\r\n        };\r\n        Calendar.prototype.select = function (day) {\r\n            this.selectedDate = day;\r\n            this.showMonth(day);\r\n        };\r\n        Calendar.prototype.header = function () {\r\n            return VizPortal.L10n.yearAndMonth(this.firstDayOfMonth);\r\n        };\r\n        Calendar.prototype.dayNames = function () {\r\n            return VizPortal.L10n.narrowDayNames();\r\n        };\r\n        Calendar.prototype.getWeeks = function () {\r\n            return this.weeks;\r\n        };\r\n        Calendar.prototype.showNext = function () {\r\n            this.firstDayOfMonth = new Date(this.firstDayOfMonth.getFullYear(), this.firstDayOfMonth.getMonth() + 1, 1);\r\n            this.updateDayCells();\r\n        };\r\n        Calendar.prototype.showPrevious = function () {\r\n            this.firstDayOfMonth = new Date(this.firstDayOfMonth.getFullYear(), this.firstDayOfMonth.getMonth() - 1, 1);\r\n            this.updateDayCells();\r\n        };\r\n        return Calendar;\r\n    })();\r\n    VizPortal.Calendar = Calendar;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../../ts/libs.ts\" />\r\n/// <reference path=\"../../../ts/Module.ts\" />\r\n/// <reference path=\"Calendar.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbDatePicker', [\r\n        function () {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'datePicker.html',\r\n                scope: {\r\n                    selectedDate: '=',\r\n                    showToday: '@',\r\n                    onSelect: '&'\r\n                },\r\n                link: function (scope) {\r\n                    scope.calendar = new VizPortal.Calendar(scope.selectedDate);\r\n                    scope.prevMonth = function () {\r\n                        scope.calendar.showPrevious();\r\n                    };\r\n                    scope.nextMonth = function () {\r\n                        scope.calendar.showNext();\r\n                    };\r\n                    scope.select = function (date) {\r\n                        scope.selectedDate = date;\r\n                        if (scope.onSelect) {\r\n                            scope.onSelect();\r\n                        }\r\n                    };\r\n                    scope.$watch('selectedDate', function (date) {\r\n                        scope.calendar.select(date);\r\n                    });\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbDaysPicker', [\r\n        function () {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'daysPicker.html',\r\n                require: 'ngModel',\r\n                scope: {},\r\n                link: function (scope, elm, attrs, ctrl) {\r\n                    scope.dayNames = [\r\n                        VizPortal.ServerApi.ScheduleDaysOfTheWeek.Sun,\r\n                        VizPortal.ServerApi.ScheduleDaysOfTheWeek.Mon,\r\n                        VizPortal.ServerApi.ScheduleDaysOfTheWeek.Tue,\r\n                        VizPortal.ServerApi.ScheduleDaysOfTheWeek.Wed,\r\n                        VizPortal.ServerApi.ScheduleDaysOfTheWeek.Thu,\r\n                        VizPortal.ServerApi.ScheduleDaysOfTheWeek.Fri,\r\n                        VizPortal.ServerApi.ScheduleDaysOfTheWeek.Sat\r\n                    ];\r\n                    var selectedDays = [];\r\n                    scope.toggleDay = function (day) {\r\n                        var index = selectedDays.indexOf(day);\r\n                        if (index >= 0) {\r\n                            selectedDays.splice(index, 1);\r\n                        }\r\n                        else {\r\n                            selectedDays.push(day);\r\n                        }\r\n                        ctrl.$setViewValue(selectedDays);\r\n                        ctrl.$render();\r\n                    };\r\n                    scope.isSelected = function (day) { return selectedDays.indexOf(day) >= 0; };\r\n                    function anySelected() {\r\n                        return selectedDays.length > 0;\r\n                    }\r\n                    ctrl.$render = function () {\r\n                        selectedDays = ctrl.$viewValue || [];\r\n                        ctrl.$setValidity('daysPicker', anySelected());\r\n                    };\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    /**\r\n     * Adds 'tb-disabled' class to an element if the tb-disabled expression evaluates to true.\r\n     *\r\n     * If the element specifies a tabindex, remove the tabindex while the element is disabled\r\n     *\r\n     * Usage:\r\n     *\r\n     *   span.tb-outline-button(tb-disabled=\"isDisabled()\")\r\n     *\r\n     */\r\n    VizPortal.Module.instance().directive('tbDisabled', [\r\n        function () {\r\n            return {\r\n                restrict: 'A',\r\n                link: function (scope, element, attr) {\r\n                    var tabindex = element.attr('tabindex');\r\n                    var isTabindexSet = tabindex !== '-1';\r\n                    scope.$watch(attr['tbDisabled'], function (disabled) {\r\n                        // Must coerce to boolean for toggleClass to work correctly\r\n                        var disabled = !!disabled;\r\n                        element.toggleClass('tb-disabled', disabled);\r\n                        element.prop('disabled', disabled);\r\n                        if (isTabindexSet) {\r\n                            if (disabled) {\r\n                                element.removeAttr('tabindex');\r\n                            }\r\n                            else {\r\n                                element.attr('tabindex', tabindex);\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbDisableSelection', [\r\n        function () {\r\n            return {\r\n                restrict: 'C',\r\n                link: function (scope, element) {\r\n                    if (navigator.userAgent.match(/msie/i)) {\r\n                        element.on('selectstart dragstart', function (event) {\r\n                            var selectionParent = $(event.target).closest('.tb-enable-selection, .tb-disable-selection');\r\n                            if (!selectionParent.hasClass('tb-enable-selection')) {\r\n                                event.preventDefault();\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    // TODO: consider making this an Element directive since it has isolate scope.\r\n    VizPortal.Module.instance().directive('tbEditableCapabilityValue', function () {\r\n        return {\r\n            scope: {\r\n                tbEditableCapabilityValue: '='\r\n            },\r\n            link: function (scope, element) {\r\n                element.click(function () {\r\n                    scope.$apply(function () {\r\n                        scope.tbEditableCapabilityValue.permission = getNextCapabilityValue();\r\n                    });\r\n                });\r\n                function getNextCapabilityValue() {\r\n                    switch (scope.tbEditableCapabilityValue.permission) {\r\n                        case VizPortal.Permission.Unspecified:\r\n                            return VizPortal.Permission.Allowed;\r\n                        case VizPortal.Permission.Allowed:\r\n                            return VizPortal.Permission.Denied;\r\n                        case VizPortal.Permission.Denied:\r\n                            return VizPortal.Permission.Unspecified;\r\n                        case VizPortal.Permission.Mixed:\r\n                            return VizPortal.Permission.Allowed;\r\n                    }\r\n                }\r\n            }\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n// This directive displays tags input with edit buttons.  When clicking on the the edit button,\r\n// the tags input and confirmation buttons appear for editing\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbEditableTags', [\r\n        '$state', '$location',\r\n        function ($state, $location) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'editableTags.html',\r\n                scope: {\r\n                    onBeforeSave: '&'\r\n                },\r\n                require: 'ngModel',\r\n                link: function ($scope, element, attrs, ngModelCtrl) {\r\n                    ngModelCtrl.$render = function () {\r\n                        $scope.tagsWithCounts = _.map(ngModelCtrl.$modelValue, function (tag) {\r\n                            return { name: tag };\r\n                        });\r\n                    };\r\n                    attrs.$observe('readonly', function (attrReadonly) {\r\n                        $scope.readonly = !!attrReadonly;\r\n                        element.toggleClass('tb-readonly', $scope.readonly);\r\n                    });\r\n                    $scope.filterByTag = function (tag) {\r\n                        var newUrl = $state.href(attrs.tagFilterState).slice(1); // slice(1) removes the '#' from the href\r\n                        $location.url(newUrl).search('tag', VizPortal.TagsHelper.unquote(tag));\r\n                    };\r\n                    $scope.edit = function () {\r\n                        $scope.editMode = true;\r\n                        $scope.busy = false;\r\n                        $scope.newTag = '';\r\n                    };\r\n                    $scope.save = function () {\r\n                        $scope.busy = true;\r\n                        var newTags = _.map($scope.tagsWithCounts, function (tag) { return tag.name; });\r\n                        if ($scope.newTag)\r\n                            newTags = _.union(newTags, [VizPortal.TagsHelper.quote($scope.newTag)]);\r\n                        $scope.onBeforeSave({ newTags: newTags }).then(\r\n                        // Success\r\n                        // Success\r\n                        function () {\r\n                            ngModelCtrl.$setViewValue(newTags);\r\n                            ngModelCtrl.$render();\r\n                            $scope.editMode = false;\r\n                            $scope.busy = false;\r\n                            $scope.newTag = '';\r\n                        }, \r\n                        // Error\r\n                        // Error\r\n                        function () {\r\n                            // TODO: show error message\r\n                            $scope.busy = false;\r\n                        });\r\n                    };\r\n                    $scope.cancel = function () {\r\n                        $scope.editMode = false;\r\n                        $scope.busy = false;\r\n                        $scope.newTag = '';\r\n                        ngModelCtrl.$render(); // Resets tagsWithCounts to match the current model\r\n                    };\r\n                    if (attrs.buttonContainer) {\r\n                        element.find(\".tb-editable-tags-input-buttons\").appendTo($(attrs.buttonContainer));\r\n                    }\r\n                    $scope.displayTagHtml = VizPortal.TagsHelper.displayTagHtml;\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n// This directive was inspired by http://vitalets.github.io/angular-xeditable/#text-simple\r\n// It displays text and an edit button on hover.  When clicking on the text or the button,\r\n// a text input and confirmation buttons appear for editing\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbEditableText', [\r\n        '$timeout',\r\n        function ($timeout) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'editableText.html',\r\n                scope: {\r\n                    onBeforeSave: '&',\r\n                    editButtonText: '@',\r\n                    maxlength: '@'\r\n                },\r\n                require: 'ngModel',\r\n                link: function ($scope, element, attrs, ngModelCtrl) {\r\n                    var input = element.find(\".tb-edit-text-input\");\r\n                    ngModelCtrl.$render = function () {\r\n                        $scope.modelValue = ngModelCtrl.$modelValue;\r\n                        $scope.viewValue = ngModelCtrl.$modelValue;\r\n                    };\r\n                    attrs.$observe('readonly', function (attrReadonly) {\r\n                        $scope.readonly = !!attrReadonly;\r\n                        element.toggleClass('tb-readonly', $scope.readonly);\r\n                    });\r\n                    // When ever the viewValue changes, run the parsers against the newViewValue to validate the newViewValue\r\n                    $scope.$watch(function () { return $scope.viewValue; }, function (newViewValue) {\r\n                        _.forEach(ngModelCtrl.$parsers, function (fn) { return fn(newViewValue); });\r\n                        $scope.invalid = ngModelCtrl.$invalid;\r\n                    });\r\n                    $scope.editable = false;\r\n                    var reset = function () {\r\n                        $scope.editMode = false;\r\n                        $scope.busy = false;\r\n                    };\r\n                    reset();\r\n                    $scope.edit = function () {\r\n                        if ($scope.readonly)\r\n                            return;\r\n                        $scope.editMode = true;\r\n                        $scope.busy = false;\r\n                    };\r\n                    $scope.save = function () {\r\n                        var newText = $scope.viewValue;\r\n                        $scope.busy = true;\r\n                        $scope.onBeforeSave({ newText: newText }).then(\r\n                        // Success\r\n                        // Success\r\n                        function () {\r\n                            ngModelCtrl.$setViewValue(newText);\r\n                            ngModelCtrl.$render();\r\n                            reset();\r\n                        }, \r\n                        // Error\r\n                        // Error\r\n                        function () {\r\n                            $scope.busy = false;\r\n                            // Reapply focus so the user can edit\r\n                            $timeout(function () { return input.focus(); });\r\n                        });\r\n                    };\r\n                    $scope.cancel = function () {\r\n                        ngModelCtrl.$render(); // Restores the original value\r\n                        $scope.editMode = false;\r\n                    };\r\n                    input.on(\"keydown\", function ($event) {\r\n                        switch ($event.which) {\r\n                            // Save on Enter\r\n                            case VizPortal.Keys.Enter:\r\n                                $scope.$apply(function () { return $scope.save(); });\r\n                                break;\r\n                            // Cancel on escape\r\n                            case VizPortal.Keys.Escape:\r\n                                $scope.$apply(function () { return $scope.cancel(); });\r\n                                break;\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var MAX_CHARACTER_LENGTH_DEFAULT = 50000;\r\n    var ViewMode = 'view', EditMode = 'edit', PreviewMode = 'preview';\r\n    VizPortal.Module.instance().directive('tbEditableTextarea', [\r\n        '$timeout',\r\n        function ($timeout) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'editableTextarea.html',\r\n                scope: {\r\n                    onBeforeSave: '&',\r\n                    disableEditButton: '=?',\r\n                    maxCharacterLength: '=?',\r\n                    disablePreviewMode: '=?',\r\n                    mode: '=?'\r\n                },\r\n                require: 'ngModel',\r\n                link: function ($scope, element, attrs, ctrl) {\r\n                    attrs.$observe('readonly', function (attrReadonly) {\r\n                        $scope.readonly = !!attrReadonly;\r\n                        element.toggleClass('tb-readonly', $scope.readonly);\r\n                    });\r\n                    // If the \"button-container\" attribute is supplied, move the buttons to that container\r\n                    if (attrs.buttonContainer) {\r\n                        var buttons = element.find(\".tb-editable-textarea-buttons\");\r\n                        buttons.appendTo($(attrs.buttonContainer));\r\n                    }\r\n                    if (!$scope.maxCharacterLength)\r\n                        $scope.maxCharacterLength = MAX_CHARACTER_LENGTH_DEFAULT;\r\n                    $scope.mode = ViewMode;\r\n                    var textarea = element.find(\"textarea\");\r\n                    $scope.busy = false;\r\n                    ctrl.$render = function () {\r\n                        $scope.text = ctrl.$viewValue;\r\n                    };\r\n                    $scope.edit = function () {\r\n                        if ($scope.readonly)\r\n                            return;\r\n                        if ($scope.mode === ViewMode) {\r\n                            $scope.text = ctrl.$viewValue;\r\n                        }\r\n                        $scope.mode = EditMode;\r\n                        $timeout(function () { return textarea.focus(); });\r\n                    };\r\n                    $scope.preview = function () {\r\n                        $scope.mode = PreviewMode;\r\n                    };\r\n                    $scope.save = function () {\r\n                        $scope.busy = true;\r\n                        var newText = $scope.text;\r\n                        $scope.onBeforeSave({ newText: $scope.text }).then(\r\n                        // Success\r\n                        // Success\r\n                        function () {\r\n                            ctrl.$setViewValue(newText);\r\n                            $scope.mode = ViewMode;\r\n                            $scope.busy = false;\r\n                        }, \r\n                        // Error\r\n                        // Error\r\n                        function () {\r\n                            // TODO: show error message\r\n                            $scope.busy = false;\r\n                        });\r\n                    };\r\n                    $scope.cancel = function () {\r\n                        $scope.text = ctrl.$viewValue; // Restore the original value\r\n                        $scope.mode = ViewMode;\r\n                    };\r\n                    // Keyboard handling\r\n                    textarea.on(\"keydown\", function ($event) {\r\n                        switch ($event.which) {\r\n                            // Save on Ctrl-Enter\r\n                            case VizPortal.Keys.Enter:\r\n                                if ($event.ctrlKey) {\r\n                                    $scope.$apply(function () { return $scope.save(); });\r\n                                }\r\n                                break;\r\n                            // Cancel on escape\r\n                            case VizPortal.Keys.Escape:\r\n                                $scope.$apply(function () { return $scope.cancel(); });\r\n                                break;\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../resources/UserSettings.ts\" />\r\n/// <reference path=\"../services/UserSettingsNotification.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbEditDisplayName', [\r\n        'UpdateUserDisplayNameNotification',\r\n        'UserSettings',\r\n        function (updateUserDisplayNameNotification, userSettings) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'editDisplayName.html',\r\n                scope: {\r\n                    displayName: '@',\r\n                    controls: '=?'\r\n                },\r\n                link: function (scope) {\r\n                    scope.busy = false;\r\n                    // save original displayName\r\n                    scope.originalDisplayName = scope.displayName;\r\n                    scope.controls = {\r\n                        // make backend request to update the display name\r\n                        submit: function (userId, username) {\r\n                            scope.busy = true;\r\n                            var displayName = scope.displayName;\r\n                            return userSettings.updateUserDisplayName(userId, displayName)\r\n                                .then(function (result) {\r\n                                // toasts\r\n                                updateUserDisplayNameNotification.notify(result, username, displayName);\r\n                                scope.busy = false;\r\n                            });\r\n                        },\r\n                        isBusy: function () {\r\n                            return scope.busy;\r\n                        },\r\n                        // checks whether the field has been changed\r\n                        isDirty: function () {\r\n                            return scope.displayName !== scope.originalDisplayName;\r\n                        },\r\n                        // checks whether the input is valid\r\n                        isValid: function () {\r\n                            return !scope.displayNameForm.$invalid;\r\n                        }\r\n                    };\r\n                }\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../resources/UserSettings.ts\" />\r\n/// <reference path=\"../services/UserSettingsNotification.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbEditEmail', [\r\n        'UpdateUserEmailNotification',\r\n        'UserSettings',\r\n        function (updateUserEmailNotification, userSettings) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'editEmail.html',\r\n                scope: {\r\n                    email: '@',\r\n                    controls: '=?',\r\n                    delayUpdateEmailRequest: '@'\r\n                },\r\n                link: function (scope) {\r\n                    scope.busy = false;\r\n                    // save original displayName\r\n                    scope.originalEmail = scope.email;\r\n                    scope.controls = {\r\n                        // make backend request to update the display name\r\n                        submit: function (userId, username) {\r\n                            scope.busy = true;\r\n                            var email = scope.email;\r\n                            //In certain scenarios, updating a user's email requires updating their username as well\r\n                            //This requires waiting for an index update, so the request should be delayed\r\n                            if (scope.delayUpdateEmailRequest) {\r\n                                return userSettings.updateUserEmailAndDelay(userId, email)\r\n                                    .then(function (result) {\r\n                                    // toasts\r\n                                    updateUserEmailNotification.notify(result, username, email);\r\n                                    scope.busy = false;\r\n                                    return email;\r\n                                });\r\n                            }\r\n                            return userSettings.updateUserEmail(userId, email)\r\n                                .then(function (result) {\r\n                                // toasts\r\n                                updateUserEmailNotification.notify(result, username, email);\r\n                                scope.busy = false;\r\n                                return email;\r\n                            });\r\n                        },\r\n                        isBusy: function () {\r\n                            return scope.busy;\r\n                        },\r\n                        // checks whether the field has been changed\r\n                        isDirty: function () {\r\n                            return scope.email !== scope.originalEmail;\r\n                        },\r\n                        // checks whether the input is valid\r\n                        isValid: function () {\r\n                            return !scope.emailForm.$invalid;\r\n                        }\r\n                    };\r\n                }\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbEditLanguageAndLocale', [\r\n        '$q',\r\n        '$state',\r\n        'ChangeLanguageNotification',\r\n        'ChangeLocaleNotification',\r\n        'Languages',\r\n        'Locales',\r\n        'UserSettings',\r\n        'ServerService',\r\n        function ($q, $state, changeLanguageNotification, changeLocaleNotification, languages, locales, userSettings, serverService) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: 'true',\r\n                templateUrl: 'editLanguageAndLocale.html',\r\n                scope: {\r\n                    controls: '=?',\r\n                    serverUser: '=',\r\n                    language: '=?',\r\n                    locale: '=?'\r\n                },\r\n                link: function (scope) {\r\n                    // these are shown as 'Unspecified' in the UI, and tell the server to use the server language/locale for the user.\r\n                    var unspecifiedLanguage = languages.unspecifiedLanguage();\r\n                    var unspecifiedLocale = locales.unspecifiedLocale();\r\n                    // the server returns no language/locale for users that haven't explicitly set one.\r\n                    // we need to map that to the special client-only value 'Unspecified' in the UI.\r\n                    var applyUnspecifiedLanguageIfNecessary = function () {\r\n                        if (!scope.language) {\r\n                            scope.language = unspecifiedLanguage.language;\r\n                        }\r\n                    };\r\n                    var applyUnspecifiedLocaleIfNecessary = function () {\r\n                        if (!scope.locale) {\r\n                            scope.locale = unspecifiedLocale.locale;\r\n                        }\r\n                    };\r\n                    applyUnspecifiedLanguageIfNecessary();\r\n                    applyUnspecifiedLocaleIfNecessary();\r\n                    scope.$watch('language', function () {\r\n                        applyUnspecifiedLanguageIfNecessary();\r\n                    });\r\n                    scope.$watch('locale', function () {\r\n                        applyUnspecifiedLocaleIfNecessary();\r\n                    });\r\n                    scope.model = {\r\n                        language: scope.language,\r\n                        locale: scope.locale\r\n                    };\r\n                    languages.getAll().then(function (langs) {\r\n                        // add unspecified to the list to allow the user to unset their language.\r\n                        langs.unshift(unspecifiedLanguage);\r\n                        scope.languages = langs;\r\n                    });\r\n                    locales.getAll().then(function (locs) {\r\n                        // add unspecified to the list to allow the user to unset their locale\r\n                        locs.unshift(unspecifiedLocale);\r\n                        scope.locales = locs;\r\n                    });\r\n                    var isBusy = false;\r\n                    var isDirty = function () {\r\n                        return isLanguageDirty() || isLocaleDirty();\r\n                    };\r\n                    var isLanguageDirty = function () { return scope.model.language !== scope.language; };\r\n                    var isLocaleDirty = function () { return scope.model.locale !== scope.locale; };\r\n                    var userIsViewingTheirOwnSettings = function () {\r\n                        return serverService.sessionUsername() === scope.serverUser.username\r\n                            && serverService.sessionUserDomainName() === scope.serverUser.domainName;\r\n                    };\r\n                    var maybeShowChangeLanguageNotification = function (maybeUpdatedLanguagePromise) {\r\n                        maybeUpdatedLanguagePromise.then(function (result) {\r\n                            if (!!result) {\r\n                                changeLanguageNotification.notify(result, scope.serverUser.username);\r\n                            }\r\n                        });\r\n                    };\r\n                    var maybeShowChangeLocaleNotification = function (maybeUpdatedLocalePromise) {\r\n                        maybeUpdatedLocalePromise.then(function (result) {\r\n                            if (!!result) {\r\n                                changeLocaleNotification.notify(result, scope.serverUser.username);\r\n                            }\r\n                        });\r\n                    };\r\n                    scope.controls = {\r\n                        save: function () {\r\n                            isBusy = true;\r\n                            var maybeUpdateLanguage = isLanguageDirty() ?\r\n                                userSettings.updateUserLanguage(scope.serverUser.id, scope.model.language) :\r\n                                $q.when(false);\r\n                            var maybeUpdateLocale = isLocaleDirty() ?\r\n                                userSettings.updateUserLocale(scope.serverUser.id, scope.model.locale) :\r\n                                $q.when(false);\r\n                            $q.all([maybeUpdateLanguage, maybeUpdateLocale]).then(function () {\r\n                                // save completed successfully, so update the language and locale on the scope.\r\n                                scope.language = scope.model.language;\r\n                                scope.locale = scope.model.locale;\r\n                                isBusy = false;\r\n                                if (userIsViewingTheirOwnSettings()) {\r\n                                    serverService.refreshSessionInfo().then(function () {\r\n                                        $state.hardReload();\r\n                                        // wait to show toast so that they are rendered in the new language\r\n                                        maybeShowChangeLanguageNotification(maybeUpdateLanguage);\r\n                                        maybeShowChangeLocaleNotification(maybeUpdateLocale);\r\n                                    });\r\n                                }\r\n                                else {\r\n                                    // show toast right away since we are changing for another user\r\n                                    maybeShowChangeLanguageNotification(maybeUpdateLanguage);\r\n                                    maybeShowChangeLocaleNotification(maybeUpdateLocale);\r\n                                }\r\n                            });\r\n                        },\r\n                        canSave: function () { return isDirty() && !isBusy; },\r\n                        isBusy: function () { return isBusy; }\r\n                    };\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/EmailValidationHelper.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbEmailInputValidator', [\r\n        '$timeout',\r\n        function ($timeout) {\r\n            var keystrokeTimeout;\r\n            var DEBOUNCE_MS = 350;\r\n            return {\r\n                restrict: 'A',\r\n                require: 'ngModel',\r\n                link: function (scope, elm, attrs, ctrl) {\r\n                    ctrl.$parsers.push(function (inputEmail) {\r\n                        // empty string = valid\r\n                        var newValidity = !inputEmail || VizPortal.EmailValidationHelper.isValidEmail(inputEmail);\r\n                        if (!newValidity) {\r\n                            // Wait between keystrokes to mark as invalid\r\n                            keystrokeTimeout = $timeout(function () { return ctrl.$setValidity('email', false); }, DEBOUNCE_MS);\r\n                        }\r\n                        else {\r\n                            $timeout.cancel(keystrokeTimeout);\r\n                            ctrl.$setValidity('email', true);\r\n                        }\r\n                        return inputEmail;\r\n                    });\r\n                }\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbEmbeddedPassword', [\r\n        '$timeout',\r\n        function ($timeout) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'embeddedPassword.html',\r\n                scope: {},\r\n                require: 'ngModel',\r\n                link: function ($scope, element, attrs, ctrl) {\r\n                    $scope.passwordRequired = !_.isUndefined(attrs['tbEmbeddedPasswordRequired']);\r\n                    $scope.password = {\r\n                        isEmbedded: undefined,\r\n                        newPassword: ''\r\n                    };\r\n                    var inEditMode = undefined;\r\n                    ctrl.$render = function () {\r\n                        $scope.password.isEmbedded = ctrl.$modelValue.isEmbedded;\r\n                        // Determine initial password edit mode\r\n                        if (_.isUndefined(inEditMode)) {\r\n                            inEditMode = !$scope.password.isEmbedded;\r\n                        }\r\n                        if ($scope.passwordRequired) {\r\n                            $scope.password.isEmbedded = true;\r\n                        }\r\n                    };\r\n                    $scope.inPasswordEditMode = function () {\r\n                        return inEditMode;\r\n                    };\r\n                    $scope.editPassword = function () {\r\n                        inEditMode = true;\r\n                        updateModel();\r\n                    };\r\n                    $scope.focusPasswordBox = function () {\r\n                        $timeout(function () { return element.find(\".tb-text-box-input\").focus(); });\r\n                    };\r\n                    $scope.$watch('[password.isEmbedded, password.newPassword]', function () { return updateModel(); }, true);\r\n                    function updateModel() {\r\n                        ctrl.$setViewValue({\r\n                            isEmbedded: $scope.password.isEmbedded,\r\n                            newPassword: $scope.password.isEmbedded && inEditMode ? $scope.password.newPassword : VizPortal.PasswordUnchanged\r\n                        });\r\n                    }\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var StoreHelpers;\r\n    (function (StoreHelpers) {\r\n        function getAll(sliceable) {\r\n            var deferred = Q.defer();\r\n            var blockSize = 1000;\r\n            var allItems = [];\r\n            function fetchBlock(start) {\r\n                sliceable.getSlice(start, blockSize)\r\n                    .then(function (result) {\r\n                    allItems = allItems.concat(result.items);\r\n                    if (allItems.length < result.total) {\r\n                        fetchBlock(start + blockSize);\r\n                    }\r\n                    else {\r\n                        deferred.resolve(allItems);\r\n                    }\r\n                });\r\n            }\r\n            fetchBlock(0);\r\n            return deferred.promise;\r\n        }\r\n        StoreHelpers.getAll = getAll;\r\n    })(StoreHelpers = VizPortalReact.StoreHelpers || (VizPortalReact.StoreHelpers = {}));\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"StoreHelpers.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var FavoritesStore = (function () {\r\n        function FavoritesStore(favorites) {\r\n            this.favorites = favorites;\r\n        }\r\n        FavoritesStore.prototype.getAll = function () {\r\n            return VizPortalReact.StoreHelpers.getAll(this.favorites.all());\r\n        };\r\n        return FavoritesStore;\r\n    })();\r\n    VizPortalReact.FavoritesStore = FavoritesStore;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../../common/react/FavoritesStore.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbFavoritesMenu', [\r\n        '$translate', 'Favorites',\r\n        function ($translate, favorites) {\r\n            if (VizPortal.FeatureFlags.reactFavoritesMenu) {\r\n                return {\r\n                    restrict: 'E',\r\n                    replace: true,\r\n                    scope: {},\r\n                    link: function (scope) {\r\n                        scope.props = {\r\n                            translate: $translate.instant,\r\n                            favoritesStore: new VizPortalReact.FavoritesStore(favorites)\r\n                        };\r\n                    },\r\n                    template: '<span><tb:react-favorites-menu props=\"props\" /></span>'\r\n                };\r\n            }\r\n            else {\r\n                return {\r\n                    restrict: 'E',\r\n                    replace: true,\r\n                    scope: {},\r\n                    controller: VizPortal.FavoritesMenuCtrl,\r\n                    templateUrl: 'favoritesMenu.html'\r\n                };\r\n            }\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/**\r\n* Favorite toggle for adding and removing favorites\r\n*\r\n* Example:\r\n*   tb:favorite-toggle(ng-model=\"workbook.favorite\", on-add=\"addFavorite()\", on-remove=\"removeFavorite()\")\r\n*\r\n* Attributes:\r\n*   ng-model=\"workbook.favorite\":   Favorite bool to be toggled\r\n*   on-add=\"addFn()\":               Function responsible for calling Favorites service add\r\n*   on-remove=\"removeFn()\":         Function responsible for calling Favorites service remove\r\n*\r\n*/\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbFavoriteToggle', [\r\n        function () {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'favoriteToggle.html',\r\n                scope: {\r\n                    onAdd: '&',\r\n                    onRemove: '&'\r\n                },\r\n                require: 'ngModel',\r\n                link: function ($scope, element, attrs, ngModelCtrl) {\r\n                    $scope.selected = function () { return ngModelCtrl.$viewValue; };\r\n                    $scope.toggle = function ($event) {\r\n                        $event.stopPropagation(); // Prevent list item selection\r\n                        if (ngModelCtrl.$viewValue) {\r\n                            $scope.onRemove();\r\n                        }\r\n                        else {\r\n                            $scope.onAdd();\r\n                        }\r\n                        ngModelCtrl.$setViewValue(!ngModelCtrl.$viewValue);\r\n                    };\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../FeatureFlags.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    /*\r\n      usage:\r\n  \r\n        <ELEMENT tb-if-feature-flag=\"exampleFlag\"> I will survive if the exampleFlag flag is true </ELEMENT>\r\n  \r\n        <ELEMENT tb-if-feature-flag=\"!exampleFlag\"> I will survive if the exampleFlag flag is false .</ELEMENT>\r\n  \r\n    */\r\n    VizPortal.Module.instance().directive('tbIfFeatureFlag', [\r\n        function () {\r\n            return {\r\n                link: function (scope, element, attrs) {\r\n                    var negated = attrs.tbIfFeatureFlag.charAt(0) === '!';\r\n                    var flagEnabled = VizPortal.FeatureFlags[attrs.tbIfFeatureFlag.replace('!', '')] || false;\r\n                    var hideElement = flagEnabled === negated;\r\n                    if (hideElement) {\r\n                        element.replaceWith('<!-- Element hidden with flag check: ' + attrs.tbIfFeatureFlag + ' -->');\r\n                    }\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    /**\r\n    * Adds behavior for attaching and handling drag and drop events for user files.\r\n    * Attr value is callback function on file drop event.\r\n    *\r\n    * Example usage:\r\n    *  div(tb-file-drop=\"onFileDropped(file)\")\r\n    *  div(tb-file-drop=\"onFileDropped()\")\r\n    *\r\n    * Style hooks:\r\n    *   '.tb-file-drop-dragging': if user is dragging file over element\r\n    **/\r\n    VizPortal.Module.instance().directive('tbFileDrop', [\r\n        '$parse', '$timeout',\r\n        function ($parse, $timeout) {\r\n            var DRAGGING_CLASS = 'tb-file-drop-dragging';\r\n            return {\r\n                restrict: 'A',\r\n                link: function ($scope, element, attr) {\r\n                    var onDropFn = $parse(attr['tbFileDrop']);\r\n                    var dragLeaveTimeout;\r\n                    var eventNamespace = '.tbFileDrop' + $scope.$id;\r\n                    var doc = angular.element(document);\r\n                    var setDropEffect = function (event, effect) {\r\n                        // Adds OS cursor feedback on some browsers\r\n                        var originalEvent = event.originalEvent;\r\n                        if (originalEvent && originalEvent.dataTransfer) {\r\n                            originalEvent.dataTransfer.dropEffect = effect;\r\n                        }\r\n                    };\r\n                    doc.on('dragenter' + eventNamespace + ' dragover' + eventNamespace, function (event) {\r\n                        event.stopPropagation();\r\n                        event.preventDefault();\r\n                        if ($(event.target).closest(element).length) {\r\n                            $timeout.cancel(dragLeaveTimeout);\r\n                            element.addClass(DRAGGING_CLASS);\r\n                            setDropEffect(event, 'copy');\r\n                        }\r\n                        else {\r\n                            // Outside drop area\r\n                            setDropEffect(event, 'none');\r\n                        }\r\n                    });\r\n                    element.on('dragleave dragend', function (event) {\r\n                        event.stopPropagation();\r\n                        event.preventDefault();\r\n                        $timeout.cancel(dragLeaveTimeout);\r\n                        dragLeaveTimeout = $timeout(function () {\r\n                            element.removeClass(DRAGGING_CLASS);\r\n                        }, 20, false); // 20 ms to avoid flash when dragging from parent (dragleave) to child elm (dragenter)\r\n                    });\r\n                    doc.on('drop' + eventNamespace, function (event) {\r\n                        event.stopPropagation();\r\n                        event.preventDefault();\r\n                        // Dropped file inside drop area\r\n                        if ($(event.target).closest(element).length) {\r\n                            $timeout.cancel(dragLeaveTimeout);\r\n                            element.removeClass(DRAGGING_CLASS);\r\n                            $scope.$apply(function () {\r\n                                var originalEvent = event.originalEvent;\r\n                                if (originalEvent &&\r\n                                    originalEvent.dataTransfer &&\r\n                                    originalEvent.dataTransfer.files &&\r\n                                    originalEvent.dataTransfer.files[0]) {\r\n                                    onDropFn($scope, { file: originalEvent.dataTransfer.files[0] });\r\n                                }\r\n                            });\r\n                        }\r\n                    });\r\n                    element.on('$destroy', function () {\r\n                        doc.off(eventNamespace);\r\n                    });\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var id = 0;\r\n    VizPortal.Module.instance().directive('tbFileInput', [\r\n        function () {\r\n            return {\r\n                restrict: 'E',\r\n                scope: {\r\n                    name: '@',\r\n                    filenameLocalizationKey: '@'\r\n                },\r\n                replace: true,\r\n                templateUrl: 'fileInput.html',\r\n                link: function (scope, element, attr) {\r\n                    scope.required = !!attr.required; // coalesce to boolean because this is used by ng-required\r\n                    scope.fileUploadId = 'file-upload-' + id++;\r\n                    // <input type=\"file\"/> in Angular 1.2.13+ does not update the ngModel attribute.\r\n                    // Set up a listener to manually update the ngModel value.\r\n                    var fileInput = element.find('input[type=\"file\"]');\r\n                    fileInput.change(function () { return scope.$evalAsync(function () {\r\n                        // all browsers, even on mac, use c:\\fakepath here\r\n                        // IE will use fake path unless security settings are low enough, in which case it will use the full path\r\n                        // the full path is often too long to display, so we just drop it and keep the filename only.\r\n                        scope.filename = fileInput.val().split('\\\\').pop(); // remove path, keep only filename\r\n                    }); });\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../FeatureFlags.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/DropdownHelper.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var FilteringListBoxColumnWidths = (function () {\r\n        function FilteringListBoxColumnWidths(options) {\r\n            this.ActiveRowColumnWidth = VizPortal.FeatureFlags.useUpdatedFontStyles ? 20 : 18; // Width of column that contains the active row icon\r\n            this.IconColumnWidth = 26; // Width of icon column, used in favorites menu\r\n            this.widths = [];\r\n            if (options.showActiveRow) {\r\n                this.widths.push(this.ActiveRowColumnWidth);\r\n            }\r\n            if (options.showIcons) {\r\n                this.widths.push(this.IconColumnWidth);\r\n            }\r\n            this.withCounts = options.withCounts;\r\n        }\r\n        FilteringListBoxColumnWidths.prototype.getActual = function (index) {\r\n            return this.widths[index];\r\n        };\r\n        FilteringListBoxColumnWidths.prototype.setWidths = function (currentWidths, containerWidth) {\r\n            var optionalColumnWidths = _.reduce(this.widths, function (total, width) { return (total + width); }, 0);\r\n            var countWidth = this.withCounts ? _.last(currentWidths) : 0;\r\n            optionalColumnWidths += countWidth;\r\n            this.widths.push(containerWidth - optionalColumnWidths, countWidth);\r\n        };\r\n        return FilteringListBoxColumnWidths;\r\n    })();\r\n    /**\r\n     * A list box with a text input that filters the list\r\n     *\r\n     * Usage:\r\n     *\r\n     *    tb:filtering-list-box(source=\"getSiteNames\", item-text=\"name\", model=\"model\")\r\n     *\r\n     * Required Arguments:\r\n     *\r\n     *    source:     (textInput: string) => ISliceable<any>. Sliceable that populates the list.\r\n     *    model:      Bound to selection.\r\n     *\r\n     * Optional Arguments:\r\n     *\r\n     *    item-text:           (propertyName: string) The property to use for the displayed text of the list items.\r\n     *    item-icon:           (propertyName: string) The property to use for the class of the icon column.\r\n     *    match-prefixes-only: (default=true) If true, matches prefix for each token. Else, match substring\r\n     *    on-item-clicked:     Called when the user clicks on a item\r\n     *    is-row-separator:    (row: any) => boolean. Should return true if there should be a separator below this row\r\n     */\r\n    VizPortal.Module.instance().directive('tbFilteringListBox', [\r\n        '$parse', '$timeout', '$translate',\r\n        function ($parse, $timeout, $translate) {\r\n            return {\r\n                restrict: 'E',\r\n                templateUrl: 'filteringListBox.html',\r\n                replace: true,\r\n                scope: {\r\n                    model: '=',\r\n                    onItemClicked: '&'\r\n                },\r\n                link: {\r\n                    pre: function (scope, element, attrs) {\r\n                        scope.matchPrefixesOnly = attrs.matchPrefixesOnly === 'true';\r\n                        scope.showActiveRow = attrs.indicateActiveRow === 'true';\r\n                        scope.showIcons = !!attrs.itemIcon;\r\n                        scope.placeholderText = attrs.placeholderText || $translate.instant('search');\r\n                        scope.getSliceableSource = $parse(attrs.source)(scope.$parent);\r\n                        scope.isActiveRow = $parse(attrs.isActiveRow)(scope.$parent);\r\n                        scope.isRowSeparator = $parse(attrs.isRowSeparator)(scope.$parent);\r\n                        scope.getItemText = function (item) { return '' + (attrs.itemText ? item[attrs.itemText] : item); };\r\n                        scope.getItemIcon = function (item) { return item[attrs.itemIcon]; };\r\n                        if (attrs.tbTestId) {\r\n                            scope.textBoxTestId = attrs.tbTestId + '-textbox';\r\n                        }\r\n                        scope.withCounts = (attrs.withCounts === 'true');\r\n                        scope.rowHeight = VizPortal.FeatureFlags.useTallerRowHeight ? 28 : 23;\r\n                    },\r\n                    post: function (scope, element) {\r\n                        scope.currentRow = {\r\n                            index: 0\r\n                        };\r\n                        scope.rowClicked = function (row) {\r\n                            if (scope.onItemClicked) {\r\n                                scope.onItemClicked({ item: row });\r\n                            }\r\n                            // When the user clicks on a row, re-focus on the input control\r\n                            $timeout(function () { return element.find('input').focus(); });\r\n                        };\r\n                        scope.columnWidths = new FilteringListBoxColumnWidths(scope);\r\n                        // Keep the model in sync with the current row in the data-grid\r\n                        scope.$watch('currentRow.object', function (item) {\r\n                            if (item !== undefined) {\r\n                                scope.model = item;\r\n                            }\r\n                        });\r\n                        scope.$watch('textInput', function (value) {\r\n                            // reload the values in the listbox when the input changes\r\n                            scope.items = scope.getSliceableSource(value || '');\r\n                            // If no row is selected and some text has been entered, select the first row\r\n                            if (value && scope.currentRow.index === -1) {\r\n                                scope.currentRow.index = 0;\r\n                            }\r\n                        });\r\n                        scope.handleKeyEvent = function ($event) {\r\n                            switch ($event.which) {\r\n                                case VizPortal.Keys.ArrowDown:\r\n                                    $event.preventDefault();\r\n                                    scope.currentRow.index++;\r\n                                    break;\r\n                                case VizPortal.Keys.ArrowUp:\r\n                                    $event.preventDefault();\r\n                                    if (scope.currentRow.index > 0) {\r\n                                        scope.currentRow.index--;\r\n                                    }\r\n                                    break;\r\n                            }\r\n                        };\r\n                    }\r\n                }\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../../ts/libs.ts\" />\r\n/// <reference path=\"./FocusCtrl.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    /**\r\n     * Give an element focus when it is first rendered.\r\n     */\r\n    VizPortal.Module.instance().directive('tbFocus', ['$timeout', 'BrowserSupportService',\r\n        function ($timeout, BrowserSupportService) {\r\n            return {\r\n                restrict: 'A',\r\n                link: function (scope, element, attrs, ctrl) {\r\n                    // Suppress on touch devices, as a keyboard can be very obtrusive\r\n                    if (BrowserSupportService.isTouch())\r\n                        return;\r\n                    // this check is necessary to check for a directive call with no given attribute value\r\n                    if (attrs.tbFocus === \"tb-focus\")\r\n                        attrs.tbFocus = \"true\";\r\n                    if (!ctrl.hasFocusElement())\r\n                        ctrl.setFocusElement(element);\r\n                    scope.$watch(attrs.tbFocus, function (value) {\r\n                        if (value) {\r\n                            $timeout(function () { return ctrl.focus(); });\r\n                        }\r\n                    });\r\n                },\r\n                controller: VizPortal.FocusCtrl\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../controllers/AlertMenuCtrl.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbFormattingHints', function () {\r\n        return {\r\n            restrict: 'E',\r\n            replace: true,\r\n            scope: {},\r\n            templateUrl: 'formattingHints.html',\r\n            link: function (scope) { }\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbHelpMenu', [\r\n        function () {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                scope: {},\r\n                controller: VizPortal.HelpMenuCtrl,\r\n                templateUrl: 'helpMenu.html'\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    /**\r\n     * Adds 'tb-hidden' class to an element if the tb-hidden expression evaluates to true.\r\n     *\r\n     * Usage:\r\n     *\r\n     *   span.tb-outline-button(tb-hidden=\"isHidden()\")\r\n     *\r\n     */\r\n    VizPortal.Module.instance().directive('tbHidden', [\r\n        function () {\r\n            return {\r\n                restrict: 'A',\r\n                link: function (scope, element, attr) {\r\n                    scope.$watch(attr['tbHidden'], function (hidden) {\r\n                        // Must coerce to boolean for toggleClass to work correctly\r\n                        var hidden = !!hidden;\r\n                        element.toggleClass('tb-hidden', hidden);\r\n                    });\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbIntegerInputValidator', function () {\r\n        return {\r\n            restrict: 'A',\r\n            require: 'ngModel',\r\n            link: function (scope, elm, attrs, ctrl) {\r\n                var INTEGER_REGEXP = /^\\-?\\d+$/;\r\n                ctrl.$parsers.push(function (inputVal) {\r\n                    ctrl.$setValidity('integer', INTEGER_REGEXP.test(inputVal));\r\n                    return inputVal;\r\n                });\r\n            }\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/LockStatusHelper.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    // TODO: Add unit tests for this directive once we have the UX nailed down\r\n    VizPortal.Module.instance().directive('tbLockUnlockProjectPermissions', [\r\n        '$translate',\r\n        'ConfirmActionDialog',\r\n        'SetProjectControlledPermissionsAction',\r\n        function ($translate, confirmActionDialog, SetProjectControlledPermissionsAction) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'lockUnlockProjectPermissions.html',\r\n                scope: {\r\n                    authorizableType: '=',\r\n                    authorizables: '=',\r\n                    editable: '=',\r\n                    editabilityShortMessage: '=',\r\n                    editabilityLongMessage: '=',\r\n                    lockState: '='\r\n                },\r\n                link: function (scope) {\r\n                    var projects = getProjects();\r\n                    scope.canLockProjectPermissions =\r\n                        function () { return scope.editable && scope.authorizableType === VizPortal.ProjectContentType.name; };\r\n                    scope.isChangeSourceLocked = function () {\r\n                        return scope.lockState !== VizPortal.LockUnlockProjectPermissionsState.Locked &&\r\n                            VizPortal.LockStatusHelper.getCombinedStatusOfAllItems(scope.permissionChangeSource.sources) ===\r\n                                VizPortal.LockUnlockProjectPermissionsState.Locked;\r\n                    };\r\n                    scope.getLockIconClass = function () { return VizPortal.LockStatusHelper.getWhiteLockIconClass(scope.lockState); };\r\n                    scope.buttonText = function () { return $translate.instant(VizPortal.LockStatusHelper.getLockButtonText(scope.lockState)); };\r\n                    // set the default value to 0 so it's not undefined.\r\n                    scope.percentComplete = 0;\r\n                    scope.permissionState = VizPortal.LockUnlockProjectPermissionsState;\r\n                    scope.FeatureFlagProjectControlledPermissionsEnabled =\r\n                        VizPortal.FeatureFlags.projectControlledPermissionsEnabled;\r\n                    scope.permissionsDialogMessage = $translate.instant(\"lockProjectPermissions_dialogMessage\", {\r\n                        PROJECT_COUNT: projects.size(),\r\n                        PROJECT_NAME: VizPortal.L10n.elideIfLong(projects.first().name)\r\n                    }, VizPortal.L10n.Interpolations.Count);\r\n                    scope.warningMessage = $translate.instant(\"lockProjectPermissionsWarningMessage\", { PROJECT_COUNT: projects.size() }, VizPortal.L10n.Interpolations.Count);\r\n                    scope.showConfirmationDialog = function () {\r\n                        scope.permissionChangeSource = { sources: VizPortal.LockStatusHelper.getLockStatusOfAllProjects(projects) };\r\n                        confirmActionDialog.open({\r\n                            title: $translate.instant(\"lockProjectPermissions_dialogTitle\"),\r\n                            bodyTemplateUrl: 'lockUnlockProjectPermissionsDialog.html',\r\n                            scope: scope,\r\n                            position: { reserveHeight: 450 },\r\n                            actionName: $translate.instant(\"save\"),\r\n                            action: function () {\r\n                                // TODO: filter through the projects and only select the ones to update whose\r\n                                // controlledPermissionsEnabled field is the opposite of the chosen permssion source.\r\n                                // This reduces the number of projects we have to update and is particularly useful in the case\r\n                                // that there are mixed projects - i.e. some projects have permissions locked to the project and others\r\n                                // managed by the owner. Additionally, it helps if the user selects the current state of all the projects\r\n                                // since that means we don't have to update anything.\r\n                                SetProjectControlledPermissionsAction.execute(projects, scope.permissionChangeSource.sources, scope)\r\n                                    .then(function (result) {\r\n                                    if (!VizPortal.ResultHelper.hasErrors(result)) {\r\n                                        updateControlledPermissionsEnabled(scope.permissionChangeSource.sources);\r\n                                        scope.lockState = VizPortal.LockStatusHelper.getLockState(projects);\r\n                                    }\r\n                                });\r\n                            },\r\n                            confirmDisabled: function () {\r\n                                var enumState = VizPortal.LockStatusHelper.getCombinedStatusOfAllItems(scope.permissionChangeSource.sources);\r\n                                return enumState === VizPortal.LockUnlockProjectPermissionsState.Mixed || enumState === scope.lockState;\r\n                            },\r\n                            errorMessage: $translate.instant(\"lockProjectPermissionsError\")\r\n                        });\r\n                    };\r\n                    function updateControlledPermissionsEnabled(updatedPermissionSource) {\r\n                        // TODO: ideally you want to look at the server response to see which projects had their permissions\r\n                        // updated and which didn't, but for now this will suffice since the server response is empty for now\r\n                        // and not implemented.\r\n                        var updatedControlledPermissions = _.first(updatedPermissionSource) === VizPortal.LockUnlockProjectPermissionsState.Locked;\r\n                        scope.authorizables.each(function (proj) {\r\n                            if (proj.controlledPermissionsEnabled !== updatedControlledPermissions) {\r\n                                proj.controlledPermissionsEnabled = updatedControlledPermissions;\r\n                            }\r\n                        });\r\n                    }\r\n                    function getProjects() {\r\n                        // TODO: Request information from the server about THE selected project since when we're in the permissions\r\n                        // subplace, the counts related to the selected project don't show up, but when you're in the permissions\r\n                        // dialog they show up.\r\n                        return scope.authorizables;\r\n                    }\r\n                }\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbSigningIn', [\r\n        '$interval',\r\n        function ($interval) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                scope: {},\r\n                templateUrl: 'signingIn.html',\r\n                link: function (scope, element, attributes) {\r\n                    scope.showSigningIn = false;\r\n                    // Display the \"Signing in\" after a small delay\r\n                    $interval(function () { return scope.showSigningIn = true; }, 1000, 1);\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbMatchingInputsValidator', function () {\r\n        return {\r\n            restrict: 'A',\r\n            require: 'ngModel',\r\n            scope: {\r\n                match: '='\r\n            },\r\n            link: function (scope, elm, attrs, ctrl) {\r\n                scope.$watch(function () {\r\n                    // compare passed in data against the current model value\r\n                    return attrs['matchData'] === ctrl.$modelValue;\r\n                }, function (currentValue) {\r\n                    ctrl.$setValidity('match', currentValue);\r\n                });\r\n            }\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbModeSwitcher', [\r\n        '$location',\r\n        function ($location) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'modeSwitcher.html',\r\n                scope: {\r\n                    displayMode: '='\r\n                }\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbMouseCapture', [\r\n        '$parse',\r\n        function ($parse) {\r\n            return {\r\n                link: function (scope, element, attr) {\r\n                    // TODO: namespace can come from component using this directive.\r\n                    var eventNamespace = '.tbMouseCapture';\r\n                    // Note: $parse(attr[]) is the pattern used by angular directives. Not a binding.\r\n                    var moveFn = $parse(attr['tbMouseCapture']);\r\n                    var downFn = $parse(attr['tbMouseCaptureDown']);\r\n                    var upFn = $parse(attr['tbMouseCaptureUp']);\r\n                    var doc = angular.element(document);\r\n                    element.on('mousedown' + eventNamespace, function (downEvent) {\r\n                        // create an invisible overlay element to prevent other events (such as hover)\r\n                        // from triggering digests while mousedown.  We'll remove this on mouseup.\r\n                        var fillDiv = angular.element('<div>').addClass('tb-fill').appendTo(document.body);\r\n                        // apply the mousedown fn.\r\n                        scope.$apply(function () {\r\n                            downFn(scope, { $event: downEvent });\r\n                        });\r\n                        // register the mousemove fn.\r\n                        doc.on('mousemove' + eventNamespace, function (moveEvent) {\r\n                            moveFn(scope, { $event: moveEvent });\r\n                        });\r\n                        // register the mouseup fn.\r\n                        doc.on('mouseup' + eventNamespace, function (upEvent) {\r\n                            fillDiv.remove();\r\n                            doc.off(eventNamespace);\r\n                            scope.$apply(function () {\r\n                                upFn(scope, { $event: upEvent });\r\n                            });\r\n                        });\r\n                    });\r\n                }\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbMousedownOutside', [\r\n        '$parse',\r\n        function ($parse) {\r\n            return {\r\n                link: function (scope, element, attr) {\r\n                    var eventNamespace = '.tbMousedownOutside' + scope.$id;\r\n                    var downOutsideFn = $parse(attr['tbMousedownOutside']);\r\n                    var doc = angular.element(document);\r\n                    var mousedownEvents = 'mousedown' + eventNamespace + ' touchstart' + eventNamespace;\r\n                    doc.on(mousedownEvents, function (downEvent) {\r\n                        var target = $(downEvent.target);\r\n                        if (target.closest(element).length === 0) {\r\n                            scope.$apply(function () {\r\n                                downOutsideFn(scope, { $event: downEvent });\r\n                            });\r\n                        }\r\n                    });\r\n                    element.on('$destroy', function () {\r\n                        doc.off(eventNamespace);\r\n                    });\r\n                }\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbMouseTrack', [\r\n        '$parse',\r\n        function ($parse) {\r\n            return {\r\n                link: function (scope, element, attr) {\r\n                    // TODO: namespace can come from component using this directive.\r\n                    var eventNamespace = '.tbMouseTrack';\r\n                    // Note: $parse(attr[]) is the pattern used by angular directives. Not a binding.\r\n                    var moveFn = $parse(attr['tbMouseTrack']);\r\n                    var enterFn = $parse(attr['tbMouseTrackEnter']);\r\n                    var leaveFn = $parse(attr['tbMouseTrackLeave']);\r\n                    element.on('mouseenter' + eventNamespace, function (enterEvent) {\r\n                        enterFn(scope, { $event: enterEvent });\r\n                        element.on('mousemove' + eventNamespace, function (moveEvent) {\r\n                            moveFn(scope, { $event: moveEvent });\r\n                        });\r\n                    });\r\n                    element.on('mouseleave' + eventNamespace, function (leaveEvent) {\r\n                        element.off('mousemove' + eventNamespace);\r\n                        leaveFn(scope, { $event: leaveEvent });\r\n                    });\r\n                }\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/Keys.ts\" />\r\n/// <reference path=\"../helpers/Order.ts\" />\r\n/// <reference path=\"../models/OrderKeys.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../resources/Datasources.ts\" />\r\n/// <reference path=\"../resources/Projects.ts\" />\r\n/// <reference path=\"../resources/Users.ts\" />\r\n/// <reference path=\"../resources/Views.ts\" />\r\n/// <reference path=\"../resources/Workbooks.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var OmniboxCtrl = (function () {\r\n        function OmniboxCtrl($scope, $state, $location, $translate, $window, server, datasources, projects, users, views, workbooks) {\r\n            var _this = this;\r\n            this.$scope = $scope;\r\n            this.$state = $state;\r\n            this.$location = $location;\r\n            this.$translate = $translate;\r\n            this.$window = $window;\r\n            this.server = server;\r\n            this.datasources = datasources;\r\n            this.projects = projects;\r\n            this.users = users;\r\n            this.views = views;\r\n            this.workbooks = workbooks;\r\n            this.startIndexForType = {};\r\n            var debouncedUpdate = _.debounce(function () {\r\n                _this.$scope.$evalAsync(function () {\r\n                    _this.updateResults();\r\n                });\r\n            }, 200);\r\n            this.$scope.$watch('searchText', function () {\r\n                debouncedUpdate();\r\n            });\r\n            this.$scope.close = function ($event) {\r\n                if ($event && $($event.target).attr('name') === OmniboxCtrl.TextBoxName) {\r\n                    return;\r\n                }\r\n                _this.$scope.clearSearch();\r\n                _this.updateResults();\r\n            };\r\n            this.$scope.keydown = function ($event) {\r\n                switch ($event.which) {\r\n                    case VizPortal.Keys.ArrowUp:\r\n                        if (_this.selectedIndex > 0) {\r\n                            _this.selectedIndex--;\r\n                        }\r\n                        else {\r\n                            _this.selectedIndex = _this.maxSelectedIndex;\r\n                        }\r\n                        break;\r\n                    case VizPortal.Keys.ArrowDown:\r\n                        if (_this.selectedIndex < _this.maxSelectedIndex) {\r\n                            _this.selectedIndex++;\r\n                        }\r\n                        else {\r\n                            _this.selectedIndex = Math.min(0, _this.maxSelectedIndex);\r\n                        }\r\n                        break;\r\n                    // TODO: Close the results box when esc is pressed\r\n                    case VizPortal.Keys.Enter:\r\n                        if (_this.selectedIndex >= 0) {\r\n                            var href = $('.tb-omnibox-results').find('.tb-omnibox-menu-item.tb-selected').attr('href');\r\n                            if (href.charAt(0) === '#') {\r\n                                href = href.slice(1);\r\n                            }\r\n                            _this.$location.url(href);\r\n                            _this.$scope.close();\r\n                        }\r\n                        break;\r\n                    case VizPortal.Keys.Escape:\r\n                        _this.$scope.close();\r\n                        break;\r\n                }\r\n                ;\r\n            };\r\n            this.$scope.isItemSelected = function (type, index) {\r\n                return _this.startIndexForType[type] + index === _this.selectedIndex;\r\n            };\r\n            this.$scope.selectItem = function (type, index) {\r\n                if (!type || !_.isNumber(index))\r\n                    return;\r\n                _this.selectedIndex = _this.startIndexForType[type] + index;\r\n            };\r\n            this.$scope.itemHref = function (state, params) {\r\n                return _this.$state.href(state, params);\r\n            };\r\n            this.$scope.seeAllHref = function (state) {\r\n                return _this.$state.href(state) + '?search=' + encodeURIComponent(_this.$scope.searchText);\r\n            };\r\n            this.$scope.showSeeAll = function (list, type) {\r\n                return list.total > OmniboxCtrl.MaxResultsPerType\r\n                    && !(type === 'users' && !server.isSessionSiteOrServerAdmin());\r\n            };\r\n            this.$scope.tooltipForDataSource = function (datasource) {\r\n                return _this.$translate.instant('itemWithProject', { ITEM: datasource.name, PROJECT: datasource.project.name });\r\n            };\r\n            this.$scope.tooltipForView = function (view) {\r\n                return _this.$translate.instant('viewWithWorkbook', { VIEW: view.name, WORKBOOK: view.workbook.name });\r\n            };\r\n            this.$scope.tooltipForWorkbook = function (workbook) {\r\n                return _this.$translate.instant('itemWithProject', { ITEM: workbook.name, PROJECT: workbook.project.name });\r\n            };\r\n            this.$scope.maxResultsPerType = OmniboxCtrl.MaxResultsPerType;\r\n            var windowElement = $(this.$window);\r\n            this.$scope.popupMaxHeight = function () {\r\n                return windowElement.height() - OmniboxCtrl.SpaceLeftWhenMaxHeight;\r\n            };\r\n            this.$scope.clearSearch = function () { return _this.$scope.searchText = ''; };\r\n            this.$scope.textBoxName = OmniboxCtrl.TextBoxName;\r\n        }\r\n        OmniboxCtrl.prototype.updateResults = function () {\r\n            var _this = this;\r\n            if (!!this.$scope.searchText) {\r\n                var requestProgress = {\r\n                    pendingRequests: 5,\r\n                    totalResults: 0\r\n                };\r\n                this.currentRequestProgress = requestProgress;\r\n                var updateProgress = function (result) {\r\n                    if (_this.currentRequestProgress === requestProgress) {\r\n                        requestProgress.totalResults += result.total;\r\n                        requestProgress.pendingRequests--;\r\n                        if (requestProgress.pendingRequests === 0) {\r\n                            _this.currentRequestProgress = null;\r\n                            _this.$scope.showResults = (requestProgress.totalResults > 0);\r\n                            _this.$scope.showNoResults = !_this.$scope.showResults;\r\n                            _this.updateStartIndexes();\r\n                            _this.selectedIndex = -1;\r\n                            _this.maxSelectedIndex = requestProgress.totalResults > 0\r\n                                ? _this.startIndexForType['users'] + _this.itemsForType(_this.$scope.users) - 1\r\n                                : -1;\r\n                        }\r\n                    }\r\n                };\r\n                this.updateType(this.datasources.published(), VizPortal.OrderKeys.name, VizPortal.Order.asc, function (result) { _this.$scope.datasources = result; updateProgress(result); });\r\n                this.updateType(this.projects.all(), VizPortal.OrderKeys.name, VizPortal.Order.asc, function (result) { _this.$scope.projects = result; updateProgress(result); });\r\n                this.updateType(this.users.all(), VizPortal.OrderKeys.displayName, VizPortal.Order.asc, function (result) { _this.$scope.users = result; updateProgress(result); });\r\n                if (VizPortal.FeatureFlags.contentAnalyticsEnabled) {\r\n                    this.updateType(this.views.all(), VizPortal.OrderKeys.relevancy, VizPortal.Order.desc, function (result) { _this.$scope.views = result; updateProgress(result); });\r\n                    this.updateType(this.workbooks.all(), VizPortal.OrderKeys.relevancy, VizPortal.Order.desc, function (result) { _this.$scope.workbooks = result; updateProgress(result); });\r\n                }\r\n                else {\r\n                    this.updateType(this.views.all(), VizPortal.OrderKeys.name, VizPortal.Order.asc, function (result) { _this.$scope.views = result; updateProgress(result); });\r\n                    this.updateType(this.workbooks.all(), VizPortal.OrderKeys.name, VizPortal.Order.asc, function (result) { _this.$scope.workbooks = result; updateProgress(result); });\r\n                }\r\n            }\r\n            else {\r\n                this.$scope.datasources = VizPortal.ListResult.empty();\r\n                this.$scope.projects = VizPortal.ListResult.empty();\r\n                this.$scope.users = VizPortal.ListResult.empty();\r\n                this.$scope.views = VizPortal.ListResult.empty();\r\n                this.$scope.workbooks = VizPortal.ListResult.empty();\r\n                this.$scope.showResults = false;\r\n                this.$scope.showNoResults = false;\r\n                this.updateStartIndexes();\r\n                this.selectedIndex = -1;\r\n                this.maxSelectedIndex = -1;\r\n            }\r\n        };\r\n        OmniboxCtrl.prototype.updateType = function (query, sortField, order, updateFn) {\r\n            query\r\n                .addFilter(VizPortal.Filter.search(this.$scope.searchText))\r\n                .withOrder([order(sortField)])\r\n                .getSlice(0, OmniboxCtrl.MaxResultsPerType)\r\n                .then(function (result) {\r\n                updateFn(result);\r\n            });\r\n        };\r\n        OmniboxCtrl.prototype.updateStartIndexes = function () {\r\n            this.startIndexForType['views'] = 0;\r\n            this.startIndexForType['workbooks'] = this.startIndexForType['views'] + this.itemsForType(this.$scope.views);\r\n            this.startIndexForType['datasources'] = this.startIndexForType['workbooks'] + this.itemsForType(this.$scope.workbooks);\r\n            this.startIndexForType['projects'] = this.startIndexForType['datasources'] + this.itemsForType(this.$scope.datasources);\r\n            this.startIndexForType['users'] = this.startIndexForType['projects'] + this.itemsForType(this.$scope.projects);\r\n        };\r\n        OmniboxCtrl.prototype.itemsForType = function (list) {\r\n            if (VizPortal.FeatureFlags.contentAnalyticsEnabled) {\r\n                // TODO: Give keyboard support for the \"see all\" option\r\n                return list.total > OmniboxCtrl.MaxResultsPerType ? OmniboxCtrl.MaxResultsPerType : list.items.length;\r\n            }\r\n            else {\r\n                return list.total > OmniboxCtrl.MaxResultsPerType ? OmniboxCtrl.MaxResultsPerType + 1 : list.items.length;\r\n            }\r\n        };\r\n        OmniboxCtrl.MaxResultsPerType = 5;\r\n        OmniboxCtrl.SpaceLeftWhenMaxHeight = 100;\r\n        OmniboxCtrl.TextBoxName = 'omniboxTextBox';\r\n        OmniboxCtrl.$inject = [\r\n            '$scope',\r\n            '$state',\r\n            '$location',\r\n            '$translate',\r\n            '$window',\r\n            'ServerService',\r\n            'DataSources',\r\n            'Projects',\r\n            'Users',\r\n            'Views',\r\n            'Workbooks'\r\n        ];\r\n        return OmniboxCtrl;\r\n    })();\r\n    VizPortal.OmniboxCtrl = OmniboxCtrl;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../controllers/OmniboxCtrl.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbOmnibox', function () {\r\n        var templateUrl = VizPortal.FeatureFlags.contentAnalyticsEnabled\r\n            ? 'omniboxContentAnalytics.html' : 'omnibox.html';\r\n        return {\r\n            restrict: 'E',\r\n            replace: true,\r\n            templateUrl: templateUrl,\r\n            scope: {},\r\n            controller: VizPortal.OmniboxCtrl\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../controllers/PermissionsPanelCtrl.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbPermissionsPanel', function () {\r\n        if (VizPortal.FeatureFlags.projectControlledPermissionsEnabled) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'permissionsPanel.html',\r\n                scope: {\r\n                    authorizableType: '=',\r\n                    authorizables: '=',\r\n                    templateType: '=',\r\n                    showPrompt: '='\r\n                },\r\n                controller: VizPortal.PermissionsPanelCtrl\r\n            };\r\n        }\r\n        else {\r\n            // TODO: The feature flag deprecates the readOnly and permissionsInfoMessage scope bindings;\r\n            // remove them from permissionsDialog.jade when the flag is killed\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'permissionsPanelWithoutPCP.html',\r\n                scope: {\r\n                    authorizableType: '=',\r\n                    authorizables: '=',\r\n                    permissionsInfoMessage: '=',\r\n                    readOnly: '&',\r\n                    templateType: '='\r\n                },\r\n                controller: VizPortal.PermissionsPanelCtrl\r\n            };\r\n        }\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../FeatureFlags.ts\" />\r\n/// <reference path=\"../controllers/PermissionRuleEditorCtrl.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbPermissionRuleEditor', [\r\n        '$compile', '$q', 'PermissionRoles',\r\n        function ($compile, $q, permissionRoles) {\r\n            return {\r\n                restrict: 'E',\r\n                controller: VizPortal.PermissionRuleEditorCtrl,\r\n                require: 'tbPermissionRuleEditor',\r\n                scope: {\r\n                    action: '=',\r\n                    updateAuthorizables: '&',\r\n                    hideRowMenu: '&',\r\n                    // the column widths in the editable row are based on the column widths of the underlying permissions panel\r\n                    permissionsPanelColumnWidths: '=columnWidths',\r\n                    authorizables: '=',\r\n                    getPositionElement: '=',\r\n                    selectedRow: '=row',\r\n                    // used to control expand/collapse of section groups\r\n                    accordion: '='\r\n                },\r\n                link: function (scope, element, attributes, controller) {\r\n                    var authorizableType = scope.authorizables.type;\r\n                    var positionElement = scope.getPositionElement();\r\n                    scope.$watch('selectedRow', function () {\r\n                        controller.initializeFromSelectedRow();\r\n                        positionEditor();\r\n                    });\r\n                    function positionEditor() {\r\n                        var positionElement = scope.getPositionElement();\r\n                        var position = positionElement.position();\r\n                        var dimensions = {\r\n                            height: positionElement.height(),\r\n                            width: positionElement.width()\r\n                        };\r\n                        permissionRuleEditor.css({\r\n                            top: position.top,\r\n                            left: position.left,\r\n                            height: dimensions.height,\r\n                            width: dimensions.width\r\n                        });\r\n                    }\r\n                    var explicitPermissionsScrollContent = positionElement.parents('.tb-scroll-content-area');\r\n                    var effectivePermissionsScrollContent = element.parents('.tb-permissions-container')\r\n                        .find('.tb-effective-permissions-container .tb-scroll-content-area');\r\n                    // add backdrop to explicit permissions panel\r\n                    var explicitPermissionsBackdrop = $('<div>')\r\n                        .addClass('tb-backdrop-white').appendTo(explicitPermissionsScrollContent);\r\n                    // add backdrop to effective permissions panel\r\n                    var effectivePermissionsBackdrop = $('<div>')\r\n                        .addClass('tb-backdrop-white').appendTo(effectivePermissionsScrollContent);\r\n                    // Render the editor inside of the selected row's datagrid.\r\n                    // Note: ng-include can't be on the top level dom element because it replaces itself with the template\r\n                    var permissionRuleEditor = $('<div>')\r\n                        .addClass('tb-permission-rule-editor')\r\n                        .append($('<div>')\r\n                        .attr({ 'ng-include': '\"permissionRuleEditor.html\"' }))\r\n                        .appendTo(explicitPermissionsScrollContent);\r\n                    $compile(permissionRuleEditor)(scope);\r\n                    scope.$on('$destroy', function () {\r\n                        permissionRuleEditor.remove();\r\n                        explicitPermissionsBackdrop.remove();\r\n                        effectivePermissionsBackdrop.remove();\r\n                    });\r\n                    // populate the options in the role dropdown.\r\n                    // TODO: cache these\r\n                    scope.roleOptions = function (contentType) { return permissionRoles.getAvailableRolesForType(contentType); };\r\n                    // must be nested to avoid the dot problem\r\n                    scope.templates = {\r\n                        cells: null // initialized by permissionRuleEditor.jade\r\n                    };\r\n                    scope.isDeleteActionSelected = function () {\r\n                        return scope.action === VizPortal.L10n.Keys.delete_ ||\r\n                            _.every(_.values(scope.selectedRoleByContentType), function (role) { return role === VizPortal.L10n.Keys.none; });\r\n                    };\r\n                    scope.getSavePermissionRuleTranslationID = function () {\r\n                        if (scope.isDeleteActionSelected()) {\r\n                            return VizPortal.L10n.Keys.delete_;\r\n                        }\r\n                        else {\r\n                            return VizPortal.L10n.Keys.save;\r\n                        }\r\n                    };\r\n                    scope.savePermissionRule = function () {\r\n                        controller.savePermissionRule();\r\n                    };\r\n                    scope.getTooltipText = function ($event) { return controller.getTooltipText($event); };\r\n                    scope.saveDisabled = function () { return controller.saveDisabled(); };\r\n                    scope.cancel = function () {\r\n                        var maybeUpdateAuthorizables = $q.when();\r\n                        if (scope.action === VizPortal.PermissionRuleEditorCommands.add) {\r\n                            // the new row as already been inserted in the permissions panel, so\r\n                            // trigger a refresh to clean it up.\r\n                            maybeUpdateAuthorizables = scope.updateAuthorizables();\r\n                        }\r\n                        maybeUpdateAuthorizables.then(function () { return scope.hideRowMenu(); });\r\n                    };\r\n                    _.each(_.keys(scope.selectedRoleByContentType), function (contentType) {\r\n                        scope.$watch('selectedRoleByContentType' + '[\"' + contentType + '\"]', function (role) {\r\n                            if (!role || role === VizPortal.L10n.Keys.custom)\r\n                                return;\r\n                            if (VizPortal.FeatureFlags.projectPermissionsTemplatesEnabled) {\r\n                                scope.data.row.permissionsByContentType[contentType] = controller.getCapabilitiesForTypeAndRole(contentType, role);\r\n                            }\r\n                            else {\r\n                                scope.data.row.permissions = controller.getCapabilitiesForRole(role);\r\n                            }\r\n                        });\r\n                        // update permission role when individual permissions change\r\n                        if (VizPortal.FeatureFlags.projectPermissionsTemplatesEnabled) {\r\n                            scope.$watch('data.row.permissionsByContentType' + '[\"' + contentType + '\"]', function (newPermissions) {\r\n                                var permissions = VizPortal.PermissionsHelper.PermissionsFromIPermissions(newPermissions);\r\n                                scope.selectedRoleByContentType[contentType] = permissionRoles.getExplicitRoleForTypeAndPermissions(contentType, permissions);\r\n                            }, true);\r\n                        }\r\n                    });\r\n                    // update permission role when individual permissions change\r\n                    if (!VizPortal.FeatureFlags.projectPermissionsTemplatesEnabled) {\r\n                        scope.$watch('data.row.permissions', function () {\r\n                            // TODO: move to a helper or refactor so we don't have to do this conversion.\r\n                            var permissions = VizPortal.PermissionsHelper.PermissionsFromIPermissions(scope.data.row.permissions);\r\n                            scope.selectedRoleByContentType[authorizableType] = permissionRoles.getExplicitRoleForTypeAndPermissions(authorizableType, permissions);\r\n                        }, true);\r\n                    }\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbPlaceDescription', [\r\n        '$state',\r\n        function ($state) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'placeDescription.html',\r\n                scope: {\r\n                    type: '@',\r\n                    id: '=',\r\n                    description: '='\r\n                },\r\n                link: function (scope, element) {\r\n                    var holderElement = element.find('.tb-place-description-text-holder');\r\n                    scope.showReadMore = function () {\r\n                        return holderElement.get(0).scrollWidth > holderElement.width()\r\n                            && !$state.includes('**.details'); // Do not show link on details tab\r\n                    };\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    (function (Corner) {\r\n        Corner[Corner[\"TopLeft\"] = 0] = \"TopLeft\";\r\n        Corner[Corner[\"TopRight\"] = 1] = \"TopRight\";\r\n        Corner[Corner[\"BottomLeft\"] = 2] = \"BottomLeft\";\r\n        Corner[Corner[\"BottomRight\"] = 3] = \"BottomRight\";\r\n    })(VizPortal.Corner || (VizPortal.Corner = {}));\r\n    var Corner = VizPortal.Corner;\r\n    var StackedElement = (function () {\r\n        function StackedElement(positionCorner, positionElement, contentCorner, contentElement) {\r\n            var _this = this;\r\n            this.positionCorner = positionCorner;\r\n            this.positionElement = positionElement;\r\n            this.contentCorner = contentCorner;\r\n            this.contentElement = contentElement;\r\n            this.rendered = false;\r\n            // Binds updateContentElementPosition to this StackedElement instance and is a handle used to remove listeners\r\n            this.updatePositionListener = function () {\r\n                if (_this.scope) {\r\n                    _this.scope.$evalAsync(function () { return _this.updateContentElementPosition(); });\r\n                }\r\n                else {\r\n                    _this.updateContentElementPosition();\r\n                }\r\n            };\r\n            this.positionElement.parents().on('scroll', this.updatePositionListener);\r\n            $(window).on('resize', this.updatePositionListener);\r\n            this.updateContentElementPosition();\r\n        }\r\n        StackedElement.prototype.setScope = function (scope) {\r\n            this.scope = scope;\r\n        };\r\n        StackedElement.prototype.destroy = function () {\r\n            // Assumes the position element was never detached\r\n            this.positionElement.parents().off('scroll', this.updatePositionListener);\r\n            $(window).off('resize', this.updatePositionListener);\r\n        };\r\n        StackedElement.prototype.getPositionX = function (positionCorner, positionOffset, positionSize) {\r\n            switch (positionCorner) {\r\n                case Corner.TopLeft:\r\n                case Corner.BottomLeft:\r\n                    return positionOffset.left;\r\n                case Corner.TopRight:\r\n                case Corner.BottomRight:\r\n                    return positionOffset.left + positionSize.width;\r\n            }\r\n        };\r\n        StackedElement.prototype.getPositionY = function (positionCorner, positionOffset, positionSize) {\r\n            switch (positionCorner) {\r\n                case Corner.TopLeft:\r\n                case Corner.TopRight:\r\n                    return positionOffset.top;\r\n                case Corner.BottomLeft:\r\n                case Corner.BottomRight:\r\n                    return positionOffset.top + positionSize.height;\r\n            }\r\n        };\r\n        StackedElement.prototype.getContentLeft = function (contentCorner, positionX, contentSize) {\r\n            switch (contentCorner) {\r\n                case Corner.TopLeft:\r\n                case Corner.BottomLeft:\r\n                    return positionX;\r\n                case Corner.TopRight:\r\n                case Corner.BottomRight:\r\n                    return positionX - contentSize.width;\r\n            }\r\n        };\r\n        StackedElement.prototype.getContentTop = function (contentCorner, positionY, contentSize) {\r\n            switch (contentCorner) {\r\n                case Corner.TopLeft:\r\n                case Corner.TopRight:\r\n                    return positionY;\r\n                case Corner.BottomLeft:\r\n                case Corner.BottomRight:\r\n                    return positionY - contentSize.height;\r\n            }\r\n        };\r\n        StackedElement.prototype.flipVertical = function (corner) {\r\n            switch (corner) {\r\n                case Corner.TopLeft: return Corner.BottomLeft;\r\n                case Corner.TopRight: return Corner.BottomRight;\r\n                case Corner.BottomLeft: return Corner.TopLeft;\r\n                case Corner.BottomRight: return Corner.TopRight;\r\n            }\r\n        };\r\n        StackedElement.prototype.flipHorizontal = function (corner) {\r\n            switch (corner) {\r\n                case Corner.TopLeft: return Corner.TopRight;\r\n                case Corner.TopRight: return Corner.TopLeft;\r\n                case Corner.BottomLeft: return Corner.BottomRight;\r\n                case Corner.BottomRight: return Corner.BottomLeft;\r\n            }\r\n        };\r\n        StackedElement.prototype.contentWidth = function () {\r\n            var width = this.contentElement.outerWidth();\r\n            this.rendered = width > 0;\r\n            return width;\r\n        };\r\n        StackedElement.prototype.contentHeight = function () {\r\n            var height = this.contentElement.outerHeight();\r\n            this.rendered = height > 0;\r\n            return height;\r\n        };\r\n        StackedElement.prototype.calculateDisplayPosition = function (positionCorner, positionSize, positionOffset, contentCorner, contentSize) {\r\n            var positionX = this.getPositionX(positionCorner, positionOffset, positionSize);\r\n            var positionY = this.getPositionY(positionCorner, positionOffset, positionSize);\r\n            var contentLeft = this.getContentLeft(contentCorner, positionX, contentSize);\r\n            var contentTop = this.getContentTop(contentCorner, positionY, contentSize);\r\n            return { left: contentLeft, top: contentTop };\r\n        };\r\n        StackedElement.prototype.invalidHorizontalPosition = function (position, contentWidth, windowWidth) {\r\n            return position.left < 0 || position.left > (windowWidth - contentWidth)\r\n                || position.right < 0 || position.right > (windowWidth - contentWidth);\r\n        };\r\n        StackedElement.prototype.invalidVerticalPosition = function (position, contentHeight, windowHeight) {\r\n            return position.top < 0 || position.top > (windowHeight - contentHeight)\r\n                || position.bottom < 0 || position.bottom > (windowHeight - contentHeight);\r\n        };\r\n        StackedElement.prototype.getContentSize = function () {\r\n            var contentSize = {\r\n                height: this.contentElement.outerHeight(),\r\n                width: this.contentElement.outerWidth()\r\n            };\r\n            this.rendered = (contentSize.height > 0) && (contentSize.width > 0);\r\n            return contentSize;\r\n        };\r\n        StackedElement.prototype.getPositionSize = function () {\r\n            return {\r\n                height: this.positionElement.outerHeight(),\r\n                width: this.positionElement.outerWidth()\r\n            };\r\n        };\r\n        StackedElement.prototype.getWindowSize = function () {\r\n            return {\r\n                height: $(window).height(),\r\n                width: $(window).width()\r\n            };\r\n        };\r\n        StackedElement.prototype.updateContentElementPosition = function () {\r\n            var _this = this;\r\n            // Initialize size variables\r\n            var positionCorner = this.positionCorner;\r\n            var positionSize = this.getPositionSize();\r\n            var positionOffset = this.positionElement.offset();\r\n            var contentCorner = this.contentCorner;\r\n            var contentSize = this.getContentSize();\r\n            var windowSize = this.getWindowSize();\r\n            // Initialize helper functions\r\n            var calculatePosition = function () { return _this.calculateDisplayPosition(positionCorner, positionSize, positionOffset, contentCorner, contentSize); };\r\n            var flipHorizontal = function () {\r\n                positionCorner = _this.flipHorizontal(positionCorner);\r\n                contentCorner = _this.flipHorizontal(contentCorner);\r\n                cornerPosition = calculatePosition();\r\n            };\r\n            var flipVertical = function () {\r\n                positionCorner = _this.flipVertical(positionCorner);\r\n                contentCorner = _this.flipVertical(contentCorner);\r\n                cornerPosition = calculatePosition();\r\n            };\r\n            // Logic\r\n            var cornerPosition = calculatePosition();\r\n            if (this.invalidHorizontalPosition(cornerPosition, contentSize.width, windowSize.width)) {\r\n                flipHorizontal();\r\n                // If flipping to the opposite the corner didn't help, then flip back the preferred corner\r\n                if (this.invalidHorizontalPosition(cornerPosition, contentSize.width, windowSize.width)) {\r\n                    flipHorizontal();\r\n                }\r\n            }\r\n            if (this.invalidVerticalPosition(cornerPosition, contentSize.height, windowSize.height)) {\r\n                flipVertical();\r\n                // If flipping to the opposite the corner didn't help, then flip back the preferred corner\r\n                if (this.invalidVerticalPosition(cornerPosition, contentSize.height, windowSize.height)) {\r\n                    flipVertical();\r\n                }\r\n            }\r\n            this.cornerPosition = cornerPosition;\r\n            return cornerPosition;\r\n        };\r\n        StackedElement.prototype.getContentElementPosition = function () {\r\n            if (!this.rendered)\r\n                this.updateContentElementPosition();\r\n            return this.cornerPosition;\r\n        };\r\n        return StackedElement;\r\n    })();\r\n    VizPortal.StackedElement = StackedElement;\r\n    var StackedElementsService = (function () {\r\n        function StackedElementsService() {\r\n            this.stackedElements = [];\r\n        }\r\n        StackedElementsService.prototype.createStackedElement = function (positionCorner, positionElement, contentCorner, contentElement) {\r\n            return this.addStackedElement(new StackedElement(positionCorner, positionElement, contentCorner, contentElement));\r\n        };\r\n        StackedElementsService.prototype.addStackedElement = function (element) {\r\n            this.stackedElements.push(element);\r\n            return element;\r\n        };\r\n        StackedElementsService.prototype.removeStackedElement = function (element) {\r\n            var index = _.indexOf(this.stackedElements, element);\r\n            if (index !== -1) {\r\n                this.stackedElements.splice(index, 1);\r\n            }\r\n        };\r\n        StackedElementsService.$inject = [];\r\n        return StackedElementsService;\r\n    })();\r\n    VizPortal.StackedElementsService = StackedElementsService;\r\n    VizPortal.Module.instance().service('StackedElementsService', StackedElementsService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../services/StackedElementsService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var Popup = (function () {\r\n        function Popup(getPositionElement, getContentElement, stackedElementsService) {\r\n            this.getPositionElement = getPositionElement;\r\n            this.getContentElement = getContentElement;\r\n            this.stackedElementsService = stackedElementsService;\r\n        }\r\n        Popup.prototype.show = function (positionCorner, contentCorner) {\r\n            this.stackedElement = this.stackedElementsService.createStackedElement(positionCorner, this.getPositionElement(), contentCorner, this.getContentElement());\r\n        };\r\n        Popup.prototype.hide = function () {\r\n            this.stackedElementsService.removeStackedElement(this.stackedElement);\r\n        };\r\n        return Popup;\r\n    })();\r\n    VizPortal.Popup = Popup;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../models/Popup.ts\" />\r\n/// <reference path=\"../services/StackedElementsService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var PopupCtrl = (function () {\r\n        function PopupCtrl($scope, $element, $transclude, stackedElementService) {\r\n            this.scope = $scope;\r\n            var getPositionElement = function () {\r\n                return _.isFunction($scope.getPositionElement) ? $scope.getPositionElement() : $element;\r\n            };\r\n            this.popup = new VizPortal.Popup(getPositionElement, function () { return $transclude(function (clone) { return clone; }); }, stackedElementService);\r\n        }\r\n        PopupCtrl.prototype.hidePopup = function () {\r\n            this.scope.show = false;\r\n        };\r\n        PopupCtrl.$inject = [\r\n            '$scope',\r\n            '$element',\r\n            '$transclude',\r\n            'StackedElementsService'\r\n        ];\r\n        return PopupCtrl;\r\n    })();\r\n    VizPortal.PopupCtrl = PopupCtrl;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../controllers/PopupCtrl.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbPopup', [\r\n        function () {\r\n            return {\r\n                restrict: 'E',\r\n                transclude: true,\r\n                replace: true,\r\n                template: '<div class=\"tb-popup\"></div>',\r\n                scope: {\r\n                    show: '=',\r\n                    positionCorner: '@',\r\n                    contentCorner: '@',\r\n                    getPositionElement: '=?'\r\n                },\r\n                controller: VizPortal.PopupCtrl,\r\n                link: function (scope, element, attributes, controller) {\r\n                    var popup = controller.popup;\r\n                    function cornerFromString(cornerString) {\r\n                        switch (cornerString) {\r\n                            case 'tl': return VizPortal.Corner.TopLeft;\r\n                            case 'tr': return VizPortal.Corner.TopRight;\r\n                            case 'bl': return VizPortal.Corner.BottomLeft;\r\n                            case 'br': return VizPortal.Corner.BottomRight;\r\n                        }\r\n                    }\r\n                    scope.$watch('show', function (show) {\r\n                        if (popup) {\r\n                            if (show) {\r\n                                popup.show(cornerFromString(scope.positionCorner), cornerFromString(scope.contentCorner));\r\n                            }\r\n                            else {\r\n                                popup.hide();\r\n                            }\r\n                        }\r\n                    });\r\n                    element.on('$destroy', function () {\r\n                        if (popup) {\r\n                            popup.hide();\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../helpers/Keys.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var PopupMenuCtrl = (function () {\r\n        function PopupMenuCtrl($element, $scope) {\r\n            this.$element = $element;\r\n            this.contentMatchButtonWidth = false;\r\n            this._open = false;\r\n            this.scope = $scope;\r\n            this.scope.popupMenu = this;\r\n        }\r\n        PopupMenuCtrl.prototype.setButton = function (button) {\r\n            this.button = button;\r\n        };\r\n        PopupMenuCtrl.prototype.getButtonWidth = function () {\r\n            return this.button.outerWidth();\r\n        };\r\n        PopupMenuCtrl.prototype.setContent = function (content) {\r\n            this.content = content;\r\n        };\r\n        PopupMenuCtrl.prototype.getContent = function () {\r\n            return this.content;\r\n        };\r\n        PopupMenuCtrl.prototype.getContentScope = function () {\r\n            var _this = this;\r\n            return {\r\n                popupMenu: {\r\n                    button: this.button,\r\n                    close: function () { return _this.close(); }\r\n                }\r\n            };\r\n        };\r\n        PopupMenuCtrl.prototype.isUp = function () {\r\n            switch (this.scope.direction) {\r\n                case 'dr':\r\n                case 'dl':\r\n                default:\r\n                    return false;\r\n                case 'ur':\r\n                case 'ul':\r\n                    return true;\r\n            }\r\n        };\r\n        PopupMenuCtrl.prototype.positionCorner = function () {\r\n            switch (this.scope.direction) {\r\n                case 'dr':\r\n                default:\r\n                    return 'bl';\r\n                case 'dl':\r\n                    return 'br';\r\n                case 'ur':\r\n                    return 'tl';\r\n                case 'ul':\r\n                    return 'tr';\r\n            }\r\n        };\r\n        PopupMenuCtrl.prototype.contentCorner = function () {\r\n            switch (this.scope.direction) {\r\n                case 'dr':\r\n                default:\r\n                    return 'tl';\r\n                case 'dl':\r\n                    return 'tr';\r\n                case 'ur':\r\n                    return 'bl';\r\n                case 'ul':\r\n                    return 'br';\r\n            }\r\n        };\r\n        PopupMenuCtrl.prototype.isDisabled = function () {\r\n            // If disabled is undefined, then default to enabled.\r\n            return this.scope.disabled === true;\r\n        };\r\n        PopupMenuCtrl.prototype.isOpen = function () {\r\n            return this._open;\r\n        };\r\n        PopupMenuCtrl.prototype.keydown = function ($event) {\r\n            if (this.isDisabled()) {\r\n                return;\r\n            }\r\n            switch ($event.which) {\r\n                case VizPortal.Keys.Enter:\r\n                    this.toggle();\r\n                    $event.stopPropagation(); // Prevents Enter from closing containing dialog (if any)\r\n                    break;\r\n                case VizPortal.Keys.Space:\r\n                    if (!this._open) {\r\n                        this.open();\r\n                    }\r\n                    break;\r\n            }\r\n        };\r\n        PopupMenuCtrl.prototype.toggle = function () {\r\n            if (!this.isDisabled()) {\r\n                if (this._open) {\r\n                    this.close();\r\n                }\r\n                else {\r\n                    this.open();\r\n                }\r\n            }\r\n        };\r\n        PopupMenuCtrl.prototype.open = function () {\r\n            this._open = true;\r\n            this.contentWidth = this.contentMatchButtonWidth ? this.getButtonWidth() : null;\r\n            this.scope.opened({ closeFn: angular.bind(this, this.close) });\r\n        };\r\n        /*\r\n        focusElement - the JQuery element to focus on after this popup has closed.\r\n        Default is the button used to open the popup.\r\n        */\r\n        PopupMenuCtrl.prototype.close = function (focusElement) {\r\n            if (focusElement === void 0) { focusElement = this.$element; }\r\n            this._open = false;\r\n            this.scope.closed();\r\n            focusElement.focus();\r\n        };\r\n        PopupMenuCtrl.prototype.mousedownOutside = function (downEvent) {\r\n            var target = $(downEvent.target);\r\n            if (target.closest(this.button).length === 0) {\r\n                this.close(target); //focus should be placed wherever the user clicks.\r\n            }\r\n        };\r\n        PopupMenuCtrl.$inject = [\r\n            '$element',\r\n            '$scope'\r\n        ];\r\n        return PopupMenuCtrl;\r\n    })();\r\n    VizPortal.PopupMenuCtrl = PopupMenuCtrl;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../controllers/PopupMenuCtrl.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbPopupMenu', [\r\n        function () {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                require: '?tbDisabled',\r\n                transclude: true,\r\n                templateUrl: 'popupMenu.html',\r\n                scope: {\r\n                    direction: '@',\r\n                    disabled: '=tbDisabled',\r\n                    opened: '&',\r\n                    closed: '&'\r\n                },\r\n                controller: VizPortal.PopupMenuCtrl\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../controllers/PopupMenuCtrl.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var buttons = [\r\n        { name: 'tbPopupMenuButton', templateUrl: 'popupMenuButton.html' },\r\n        { name: 'tbPopupMenuCustomButton', templateUrl: 'popupMenuCustomButton.html' },\r\n        { name: 'tbPopupMenuSignatureButton', templateUrl: 'popupMenuSignatureButton.html' },\r\n        { name: 'tbPopupMenuTextButton', templateUrl: 'popupMenuTextButton.html' }\r\n    ];\r\n    _.each(buttons, function (button) {\r\n        VizPortal.Module.instance().directive(button.name, function () {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                transclude: true,\r\n                templateUrl: button.templateUrl,\r\n                scope: {},\r\n                require: '^tbPopupMenu',\r\n                link: function (scope, element, attributes, popupMenuCtrl) {\r\n                    popupMenuCtrl.setButton(element);\r\n                    scope.popupMenu = popupMenuCtrl;\r\n                }\r\n            };\r\n        });\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../controllers/PopupMenuCtrl.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbPopupMenuContent', function () {\r\n        return {\r\n            restrict: 'E',\r\n            transclude: true,\r\n            require: '^tbPopupMenu',\r\n            link: function (scope, element, attributes, popupMenuCtrl, transclude) {\r\n                popupMenuCtrl.setContent(transclude);\r\n                popupMenuCtrl.contentMatchButtonWidth = (attributes.matchButtonWidth === 'true');\r\n            }\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var MAX_PORT = 65535;\r\n    // Allows port values 0 through 65535\r\n    VizPortal.Module.instance().directive('tbPortInputValidator', function () {\r\n        return {\r\n            restrict: 'A',\r\n            require: 'ngModel',\r\n            link: function (scope, elm, attrs, ctrl) {\r\n                var isValidPort = function (val) { return (/^\\d*$/.exec(val) && parseInt(val, 10) <= MAX_PORT); };\r\n                ctrl.$parsers.push(function (inputVal) {\r\n                    ctrl.$setValidity('port', !inputVal || isValidPort(inputVal));\r\n                    return inputVal;\r\n                });\r\n            }\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbPreventInput', ['$parse', function ($parse) {\r\n            return {\r\n                require: '?ngModel',\r\n                link: function (scope, element, attrs, ngModelCtrl) {\r\n                    if (!ngModelCtrl) {\r\n                        return;\r\n                    }\r\n                    var preventFn = $parse(attrs.tbPreventInput);\r\n                    ngModelCtrl.$parsers.push(function (val) {\r\n                        var lastValidValue = ngModelCtrl.$modelValue;\r\n                        if (val && preventFn(scope, { value: val })) {\r\n                            ngModelCtrl.$setViewValue(lastValidValue);\r\n                            ngModelCtrl.$render();\r\n                        }\r\n                        else {\r\n                            lastValidValue = val;\r\n                        }\r\n                        return lastValidValue;\r\n                    });\r\n                    //Needed to prevent added spaces before and after the input\r\n                    element.bind('keypress', function (event) {\r\n                        if (event.keyCode === VizPortal.Keys.Space && preventFn(scope, { value: element.val() + ' ' })) {\r\n                            event.preventDefault();\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive(\"tbProgressBar\", [\r\n        '$translate',\r\n        function ($translate) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'progressBar.html',\r\n                scope: {\r\n                    percentComplete: '='\r\n                }\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    /* Custom radio button control. Two ways to use:\r\n    *\r\n    *  1. Two-way binding to a scope property, like in a form. Multiple radio buttons can be bound\r\n    *     to the same ng-model. The tb-value attribute is a JavaScript expression that evaluates\r\n    *     to the target value; when the radio button is clicked, the model is assigned the target\r\n    *     value.\r\n    *     Includes all the fancy Angular form features: http://docs.angularjs.org/guide/forms\r\n    *     To disable, use our own tb-disabled rather than ng-disabled.\r\n    *\r\n    *       tb:radio-button(ng-model=\"model.bool\")\r\n    *\r\n    *     For a radio button with a clickable label:\r\n    *\r\n    *       tb:radio-button-group\r\n    *         tb:radio-button(\r\n    *           ng-model=\"model\",\r\n    *           tb-value=\"target value expression\")\r\n    *         tb:radio-button-label Content\r\n    *\r\n    *     The ng-model can also be an array, in which case the radio buttons can be tri-state:\r\n    *       If all of the items match tb-value, then the button will appear selected;\r\n    *       If some, but not all, of the items match tb-value, then the button will appear mixed;\r\n    *       If none of the items match tb-value, then the button will appear empty.\r\n    *\r\n    *  2. Reflect value of expressions. You'll have to define an ng-click if you want behavior on click.\r\n    *     For this usage, omit the ng-model attribute. This version works only for dual-state radio buttons.\r\n    *\r\n    *       tb:radio-button(selected=\"amIAwesome()\")\r\n    *\r\n    */\r\n    VizPortal.Module.instance().directive('tbRadioButton', [\r\n        function () {\r\n            var SELECTED_CLASS = 'tb-selected';\r\n            var MIXED_CLASS = 'tb-mixed';\r\n            var EMPTY_CLASS = '';\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                require: ['?ngModel', '^?tbRadioButtonGroup'],\r\n                templateUrl: 'radioButton.html',\r\n                scope: {\r\n                    selected: '&',\r\n                    value: '&tbValue'\r\n                },\r\n                link: function (scope, elm, attrs, ctrls) {\r\n                    var ngModelCtrl = ctrls[0];\r\n                    var groupCtrl = ctrls[1];\r\n                    // If the radio button is instantiated to reflect the value of an expression (#2, above),\r\n                    // there is no ngModel and we use the selected() function that was passed in.\r\n                    if (!ngModelCtrl) {\r\n                        scope.classForState = function () {\r\n                            return scope.selected() ? SELECTED_CLASS : EMPTY_CLASS;\r\n                        };\r\n                        return;\r\n                    }\r\n                    var disabled = function () { return elm.hasClass('tb-disabled'); };\r\n                    scope.classForState = function () {\r\n                        if (!_.isArray(ngModelCtrl.$viewValue)) {\r\n                            return ngModelCtrl.$viewValue === scope.value() ? SELECTED_CLASS : EMPTY_CLASS;\r\n                        }\r\n                        // for array ngModels, the radio button could be mixed\r\n                        var array = ngModelCtrl.$viewValue;\r\n                        var count = 0;\r\n                        for (var i = 0; i < array.length; i++) {\r\n                            if (array[i] === scope.value())\r\n                                count++;\r\n                        }\r\n                        if (count === array.length) {\r\n                            return SELECTED_CLASS;\r\n                        }\r\n                        else if (count === 0) {\r\n                            return EMPTY_CLASS;\r\n                        }\r\n                        else {\r\n                            return MIXED_CLASS;\r\n                        }\r\n                    };\r\n                    scope.select = function () {\r\n                        if (disabled())\r\n                            return;\r\n                        if (_.isArray(ngModelCtrl.$viewValue)) {\r\n                            ngModelCtrl.$setViewValue(_.map(ngModelCtrl.$viewValue, function () {\r\n                                return scope.value();\r\n                            }));\r\n                        }\r\n                        else {\r\n                            ngModelCtrl.$setViewValue(scope.value());\r\n                        }\r\n                        ngModelCtrl.$render();\r\n                    };\r\n                    if (groupCtrl) {\r\n                        groupCtrl.select = scope.select;\r\n                        groupCtrl.disabled = disabled;\r\n                    }\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n    var RadioButtonGroupCtrl = (function () {\r\n        function RadioButtonGroupCtrl() {\r\n        }\r\n        return RadioButtonGroupCtrl;\r\n    })();\r\n    VizPortal.Module.instance().directive('tbRadioButtonGroup', [\r\n        function () {\r\n            return {\r\n                restrict: 'E',\r\n                transclude: true,\r\n                replace: true,\r\n                template: '<div class=\"tb-radio-button-group\" ng-transclude></div>',\r\n                controller: RadioButtonGroupCtrl\r\n            };\r\n        }\r\n    ]);\r\n    VizPortal.Module.instance().directive('tbRadioButtonLabel', [\r\n        function () {\r\n            return {\r\n                restrict: 'E',\r\n                transclude: true,\r\n                replace: true,\r\n                require: '^tbRadioButtonGroup',\r\n                templateUrl: 'radioButtonLabel.html',\r\n                link: function ($scope, elm, attrs, ctrl) {\r\n                    $scope.ctrl = ctrl;\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbResetStartPage', [\r\n        '$translate',\r\n        'ConfirmActionDialog',\r\n        'ServerService',\r\n        'ToasterService',\r\n        'UserSettingsActions',\r\n        function ($translate, confirmActionDialog, serverService, toaster, userSettingsActions) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'resetStartPage.html',\r\n                scope: {\r\n                    userSettings: '=',\r\n                    serverUser: '='\r\n                },\r\n                link: function (scope) {\r\n                    scope.resetStartPage = function () {\r\n                        confirmActionDialog.open({\r\n                            title: $translate.instant('resetStartPageConfirmTitle'),\r\n                            bodyText: $translate.instant('resetStartPageConfirmMessage'),\r\n                            actionName: $translate.instant('resetStartPageConfirmButton'),\r\n                            action: function (dialogInstance) {\r\n                                var user = scope.serverUser;\r\n                                return userSettingsActions.resetStartPage(user).\r\n                                    then(function (result) {\r\n                                    // TODO: move this logic into an action or store\r\n                                    if (!result || result.errors) {\r\n                                        dialogInstance.showErrorMessage($translate.instant('resetStartPageError'));\r\n                                    }\r\n                                });\r\n                            }\r\n                        });\r\n                    };\r\n                    scope.userPageOverridden = function () { return !!scope.userSettings.startPage; };\r\n                }\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../controllers/ScrollCtrl.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbScroll', function () {\r\n        return {\r\n            restrict: 'E',\r\n            replace: true,\r\n            transclude: true,\r\n            templateUrl: 'scrolling.html',\r\n            scope: {\r\n                items: '=',\r\n                layout: '=',\r\n                sliceChanged: '&',\r\n                scrollControls: '=?',\r\n                scrollLeftChanged: '&'\r\n            },\r\n            controller: VizPortal.ScrollCtrl\r\n        };\r\n    });\r\n    VizPortal.Module.instance().directive('tbScrollContentArea', function () {\r\n        return {\r\n            require: '^tbScroll',\r\n            link: function (scope, element, attributes, scrollCtrl) {\r\n                scrollCtrl.contentArea = element;\r\n            }\r\n        };\r\n    });\r\n    VizPortal.Module.instance().directive('tbScrollContent', function () {\r\n        return {\r\n            require: '^tbScroll',\r\n            link: function (scope, element, attributes, scrollCtrl) {\r\n                scrollCtrl.content = element;\r\n            }\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../controllers/PopupMenuCtrl.ts\" />\r\n/*\r\nThis is an internal implementation of an HTML Select component\r\n */\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SelectController = (function () {\r\n        function SelectController() {\r\n            this.options = [];\r\n        }\r\n        SelectController.prototype.currentOptionTranscludeFn = function () {\r\n            if (this.selectedOption) {\r\n                return this.selectedOption.transclude;\r\n            }\r\n            else {\r\n                // Displayed when there is no currently selected option, whether options exist or not.\r\n                // Useful for displaying calls to action.\r\n                return this.noneOptionTransclude;\r\n            }\r\n        };\r\n        SelectController.prototype.select = function (value) {\r\n            this.value = value;\r\n            this.selectedOption = _.findWhere(this.options, { value: value });\r\n        };\r\n        SelectController.prototype.selectOption = function (option) {\r\n            this.selectedOption = option;\r\n            this.value = this.selectedOption.value;\r\n        };\r\n        SelectController.prototype.selectPrevious = function () {\r\n            var currentIndex = _.indexOf(this.options, this.selectedOption);\r\n            var previousEnabledIndex = currentIndex - 1;\r\n            // Skip over disabled options\r\n            while (previousEnabledIndex >= 0 && this.options[previousEnabledIndex].disabled) {\r\n                previousEnabledIndex--;\r\n            }\r\n            if (previousEnabledIndex >= 0) {\r\n                this.selectOption(this.options[previousEnabledIndex]);\r\n            }\r\n        };\r\n        SelectController.prototype.selectNext = function () {\r\n            var currentIndex = _.indexOf(this.options, this.selectedOption);\r\n            var nextEnabledIndex = currentIndex + 1;\r\n            // Skip over disabled options\r\n            while (nextEnabledIndex < this.options.length && this.options[nextEnabledIndex].disabled) {\r\n                nextEnabledIndex++;\r\n            }\r\n            if (nextEnabledIndex < this.options.length) {\r\n                this.selectOption(this.options[nextEnabledIndex]);\r\n            }\r\n        };\r\n        SelectController.prototype.addOption = function (option) {\r\n            this.options.push(option);\r\n            if (this.isOptionForValue(option, this.value))\r\n                this.selectedOption = option;\r\n        };\r\n        SelectController.prototype.setNoneOptionTransclude = function (transclude) {\r\n            this.noneOptionTransclude = transclude;\r\n        };\r\n        SelectController.prototype.removeOption = function (option) {\r\n            this.options = _(this.options).without(option);\r\n            if (this.selectedOption === option)\r\n                this.selectedOption = null;\r\n        };\r\n        SelectController.prototype.verifySelection = function () {\r\n            this.select(this.value);\r\n        };\r\n        SelectController.prototype.isOptionForValue = function (option, value) {\r\n            return _.isEqual(option.value, value);\r\n        };\r\n        return SelectController;\r\n    })();\r\n    VizPortal.Module.instance().directive('tbSelect', [\r\n        function () {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                require: ['tbSelect', '?ngModel'],\r\n                controllerAs: 'selectCtrl',\r\n                transclude: true,\r\n                templateUrl: 'select.html',\r\n                scope: {\r\n                    contentClass: \"@tbSelectContentClass\",\r\n                    disabled: '=tbDisabled',\r\n                    matchButtonWidth: '@'\r\n                },\r\n                controller: SelectController,\r\n                link: function (scope, element, attrs, ctrls) {\r\n                    var selectCtrl = ctrls[0];\r\n                    var modelCtrl = ctrls[1];\r\n                    // Calculate the maximum number of 'count' digits we need\r\n                    scope.maxCountDigits = 0;\r\n                    scope.$watch(function () { return selectCtrl.options; }, function () {\r\n                        if (selectCtrl.options) {\r\n                            scope.maxCountDigits = _.max(_.map(selectCtrl.options, function (option) {\r\n                                if (_.isNumber(option.count)) {\r\n                                    return ('' + option.count).length;\r\n                                }\r\n                                return 0;\r\n                            }));\r\n                        }\r\n                    });\r\n                    // Model-View synchronization\r\n                    if (modelCtrl) {\r\n                        modelCtrl.$render = function () { return selectCtrl.select(modelCtrl.$viewValue); };\r\n                    }\r\n                    scope.$watch(function () { return selectCtrl.selectedOption; }, function (selectedOption) {\r\n                        if (selectedOption && modelCtrl)\r\n                            modelCtrl.$setViewValue(selectedOption.value);\r\n                        element.trigger('change');\r\n                    }, true);\r\n                    scope.$watch('selectCtrl.selectedOption.value', function (val) { return selectCtrl.verifySelection(); });\r\n                    // Mouse handling\r\n                    scope.optionClicked = function (option) {\r\n                        selectCtrl.selectOption(option);\r\n                        element.focus(); // Return focus to tb:select when an option is clicked\r\n                    };\r\n                    // Keyboard handling\r\n                    // ... CONSIDER: this is ugly. Perhaps remove dependency on popup menu i.e. merge popup-menu\r\n                    //     into tb:select and/or add or move keyboard handling logic to popup menu.\r\n                    var popupMenuCtrl = function () { return element.find(\".tb-popup\").scope().popupMenu; };\r\n                    scope.keydown = function ($event) {\r\n                        switch ($event.which) {\r\n                            case VizPortal.Keys.ArrowUp:\r\n                                selectCtrl.selectPrevious();\r\n                                break;\r\n                            case VizPortal.Keys.ArrowDown:\r\n                                selectCtrl.selectNext();\r\n                                break;\r\n                            case VizPortal.Keys.Tab:\r\n                            case VizPortal.Keys.Escape:\r\n                                if (!scope.disabled && popupMenuCtrl().isOpen()) {\r\n                                    popupMenuCtrl().close();\r\n                                    $event.preventDefault(); // Prevents Tab from moving to the next control\r\n                                    $event.stopPropagation(); // Prevents Escape from closing containing dialog (if any)\r\n                                }\r\n                                break;\r\n                            // Otherwise, delegate the keydown event to the popupMenuCtrl\r\n                            default:\r\n                                popupMenuCtrl().keydown($event);\r\n                                break;\r\n                        }\r\n                    };\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n    VizPortal.Module.instance().directive('tbSelectOption', [\r\n        function () {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                transclude: true,\r\n                require: '^tbSelect',\r\n                scope: {\r\n                    value: '=',\r\n                    count: '=',\r\n                    disabled: '=tbDisabled'\r\n                },\r\n                link: function (scope, element, attrs, selectCtrl, transcludeFn) {\r\n                    var option = {\r\n                        value: scope.value,\r\n                        disabled: scope.disabled,\r\n                        transclude: transcludeFn,\r\n                        count: scope.count\r\n                    };\r\n                    scope.$watch(function () { return scope.value; }, function () {\r\n                        option.value = scope.value;\r\n                    });\r\n                    element.on('$destroy', function () { return selectCtrl.removeOption(option); });\r\n                    selectCtrl.addOption(option);\r\n                }\r\n            };\r\n        }]);\r\n    VizPortal.Module.instance().directive('tbSelectNone', ['$parse',\r\n        function ($parse) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                transclude: true,\r\n                require: '^tbSelect',\r\n                scope: {},\r\n                link: function (scope, element, attrs, selectCtrl, transcludeFn) {\r\n                    selectCtrl.setNoneOptionTransclude(transcludeFn);\r\n                }\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbSelected', [\r\n        function () {\r\n            return {\r\n                restrict: 'A',\r\n                link: function (scope, element, attr) {\r\n                    scope.$watch(attr['tbSelected'], function (selected) {\r\n                        element.toggleClass('tb-selected', selected);\r\n                    });\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbServerSettingsForm', function () {\r\n        return {\r\n            restrict: 'E',\r\n            replace: true,\r\n            require: '^tbSettingsCoordinator',\r\n            templateUrl: 'serverSettingsForm.html',\r\n            link: function ($scope, elm, attrs, settingsCoordinatorCtrl) {\r\n                settingsCoordinatorCtrl.registerFormState($scope.serverSettingsFormState);\r\n            },\r\n            controller: VizPortal.ServerSettingsFormCtrl\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\n/// <reference path=\"../services/WindowLocationService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbSignedInUserMenu', [\r\n        '$state',\r\n        '$translate',\r\n        'ServerService',\r\n        'StartPageService',\r\n        'UserSettingsActions',\r\n        'ConfirmActionDialog',\r\n        'ToasterService',\r\n        function ($state, $translate, server, startPageService, userSettingsActions, confirmActionDialog, toaster) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'signedInUserMenu.html',\r\n                scope: {},\r\n                link: function (scope) {\r\n                    scope.server = server;\r\n                    scope.inServerArea = function () { return server.isSessionMultiSite() && $state.includes('main.server'); };\r\n                    scope.changeDefaultStartPage = function () { return userSettingsActions.confirmChangeDefaultStartPage(); };\r\n                    scope.changeUserStartPage = function () { return userSettingsActions.confirmChangeUserStartPage(); };\r\n                    scope.signOutKey = function () {\r\n                        var authType = server.authenticationType();\r\n                        if (authType === VizPortal.ServerApi.AuthenticationType.Sspi ||\r\n                            authType === VizPortal.ServerApi.AuthenticationType.Kerberos) {\r\n                            return 'switchUser';\r\n                        }\r\n                        else {\r\n                            return 'signOut';\r\n                        }\r\n                    };\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbSignInLogo', [\r\n        'LogoService',\r\n        function (LogoService) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'signInLogo.html',\r\n                link: function (scope, element, attributes) {\r\n                    scope.signInLogo = LogoService.getSignInLogo();\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbSiteRolePermissionsTable', [\r\n        function () {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'siteRolePermissionsTable.html',\r\n                scope: {\r\n                    siteRoles: '='\r\n                },\r\n                link: function (scope) {\r\n                    scope.rows = SiteRolePermissionsTable.permissionsForRoles(scope.siteRoles);\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n    var SiteRolePermissionsTable;\r\n    (function (SiteRolePermissionsTable) {\r\n        function permissionsForRoles(siteRoles) {\r\n            return [\r\n                {\r\n                    role: VizPortal.ServerApi.SiteRoles.ServerAdministrator,\r\n                    webAccess: true,\r\n                    interact: true,\r\n                    publish: true,\r\n                    manage: true\r\n                },\r\n                {\r\n                    role: VizPortal.ServerApi.SiteRoles.SiteAdministrator,\r\n                    webAccess: true,\r\n                    interact: true,\r\n                    publish: true,\r\n                    manage: true\r\n                },\r\n                {\r\n                    role: VizPortal.ServerApi.SiteRoles.Publisher,\r\n                    webAccess: true,\r\n                    interact: true,\r\n                    publish: true\r\n                },\r\n                {\r\n                    role: VizPortal.ServerApi.SiteRoles.Interactor,\r\n                    webAccess: true,\r\n                    interact: true\r\n                },\r\n                {\r\n                    role: VizPortal.ServerApi.SiteRoles.Viewer,\r\n                    webAccess: true\r\n                },\r\n                {\r\n                    role: VizPortal.ServerApi.SiteRoles.Unlicensed\r\n                },\r\n                {\r\n                    divider: true,\r\n                    role: VizPortal.ServerApi.SiteRoles.ViewerWithPublish,\r\n                    webAccess: true,\r\n                    publish: true\r\n                },\r\n                {\r\n                    role: VizPortal.ServerApi.SiteRoles.UnlicensedWithPublish,\r\n                    publish: true\r\n                },\r\n            ];\r\n        }\r\n        SiteRolePermissionsTable.permissionsForRoles = permissionsForRoles;\r\n    })(SiteRolePermissionsTable = VizPortal.SiteRolePermissionsTable || (VizPortal.SiteRolePermissionsTable = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbSiteRolesPicker', [\r\n        function () {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'siteRolesPicker.html',\r\n                controller: VizPortal.SiteRolesPickerCtrl,\r\n                scope: {\r\n                    usersWithSiteRoles: '=?',\r\n                    changes: '=',\r\n                    busy: '=?'\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbSiteSettingsForServerAdminForm', function () {\r\n        return {\r\n            restrict: 'E',\r\n            replace: true,\r\n            require: '^?tbSettingsCoordinator',\r\n            templateUrl: 'siteSettingsForServerAdminForm.html',\r\n            link: function ($scope, elm, attrs, settingsCoordinatorCtrl) {\r\n                if (settingsCoordinatorCtrl) {\r\n                    settingsCoordinatorCtrl.registerFormState($scope.siteSettingsForServerAdminFormState);\r\n                }\r\n            },\r\n            controller: VizPortal.SiteSettingsForServerAdminFormCtrl\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbSiteSettingsForSiteAdminForm', function () {\r\n        return {\r\n            restrict: 'E',\r\n            replace: true,\r\n            require: '^?tbSettingsCoordinator',\r\n            templateUrl: 'siteSettingsForSiteAdminForm.html',\r\n            link: function ($scope, elm, attrs, settingsCoordinatorCtrl) {\r\n                if (settingsCoordinatorCtrl) {\r\n                    settingsCoordinatorCtrl.registerFormState($scope.siteSettingsForSiteAdminFormState);\r\n                }\r\n            },\r\n            controller: VizPortal.SiteSettingsForSiteAdminFormCtrl\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../controllers/SiteSwitcherCtrl.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbSiteSwitcher', function () {\r\n        return {\r\n            restrict: 'E',\r\n            replace: true,\r\n            templateUrl: 'siteSwitcher.html',\r\n            scope: {\r\n                siteSelected: '&'\r\n            },\r\n            controller: VizPortal.SiteSwitcherCtrl\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SortToolCtrl = (function () {\r\n        function SortToolCtrl($scope, $element, $location) {\r\n            var _this = this;\r\n            this.items = [];\r\n            this.itemIndex = {};\r\n            var closeFn;\r\n            $scope.menuOpened = function (cf) {\r\n                closeFn = cf;\r\n            };\r\n            $scope.items = this.items;\r\n            $scope.currentSort = function () {\r\n                var key = $scope.sortKey + \":\" + ($scope.sortAscending ? SortToolCtrl.Ascending : SortToolCtrl.Descending);\r\n                return _this.itemIndex[key] || SortToolCtrl.INVALID_ITEM;\r\n            };\r\n            $scope.sortBy = function (key) {\r\n                var parts = key.split(':');\r\n                $location.search('order', VizPortal.Order.serialize([\r\n                    {\r\n                        field: parts[0],\r\n                        ascending: parts[1] === SortToolCtrl.Ascending\r\n                    }]));\r\n                if (closeFn) {\r\n                    closeFn();\r\n                    closeFn = null;\r\n                }\r\n            };\r\n        }\r\n        SortToolCtrl.prototype.add = function (item) {\r\n            this.items.push(item);\r\n            this.itemIndex[item.key] = item;\r\n        };\r\n        SortToolCtrl.Ascending = 'asc';\r\n        SortToolCtrl.Descending = 'desc';\r\n        SortToolCtrl.$inject = ['$scope', '$element', '$location'];\r\n        SortToolCtrl.INVALID_ITEM = { key: '', label: '' };\r\n        return SortToolCtrl;\r\n    })();\r\n    VizPortal.SortToolCtrl = SortToolCtrl;\r\n    VizPortal.Module.instance()\r\n        .directive('tbSortTool', function () {\r\n        return {\r\n            restrict: 'E',\r\n            templateUrl: 'sortTool.html',\r\n            replace: true,\r\n            transclude: true,\r\n            scope: {\r\n                sortKey: '=',\r\n                sortAscending: '='\r\n            },\r\n            controller: SortToolCtrl\r\n        };\r\n    })\r\n        .directive('tbSortToolItem', function () {\r\n        return {\r\n            require: '^tbSortTool',\r\n            restrict: 'E',\r\n            link: function (scope, element, attrs, sortToolController) {\r\n                sortToolController.add({ key: attrs['key'], label: element.text() });\r\n            }\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/StackedElementsService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbStackedElement', [\r\n        function () {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'inline_stackedElement.html',\r\n                scope: {\r\n                    stackedElement: '='\r\n                },\r\n                link: function (scope, element) {\r\n                    var stackedElement = scope.stackedElement;\r\n                    element.html('').append(stackedElement.contentElement);\r\n                    if (stackedElement.setScope)\r\n                        stackedElement.setScope(scope);\r\n                    scope.$watch(function () { return stackedElement.getContentElementPosition(); }, function (position) {\r\n                        scope.left = position.left;\r\n                        scope.top = position.top;\r\n                        scope.right = position.right;\r\n                        scope.bottom = position.bottom;\r\n                        scope.visible = true;\r\n                    }, true);\r\n                    element.on('$destroy', function () { return stackedElement.destroy && stackedElement.destroy(); });\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n    VizPortal.Module.instance().directive('tbStackedElements', [\r\n        'StackedElementsService',\r\n        function (StackedElementsService) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                template: '<tb:stacked-element ng-repeat=\"stackedElement in stackedElements\" stacked-element=\"stackedElement\"></tb:stacked-element>',\r\n                link: function (scope, element) {\r\n                    scope.stackedElements = StackedElementsService.stackedElements;\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    function urlWithParams(url, params) {\r\n        var pairs = _.map(params, function (value, key) {\r\n            return encodeURIComponent(key) + '=' + encodeURIComponent(value);\r\n        });\r\n        if (pairs.length > 0) {\r\n            var separator = (url.indexOf('?') >= 0) ? '&' : '?';\r\n            var paramsString = pairs.join('&');\r\n            return url + separator + paramsString;\r\n        }\r\n        else {\r\n            return url;\r\n        }\r\n    }\r\n    VizPortal.Module.instance().directive('tbStateHref', [\r\n        '$location',\r\n        '$state',\r\n        function ($location, $state) {\r\n            return {\r\n                restrict: 'A',\r\n                link: function (scope, element, attributes) {\r\n                    var config = scope.$eval(attributes.tbStateHrefConfig || '') || {};\r\n                    var params = scope.$eval(attributes.tbStateHrefParams || '') || null;\r\n                    var opts = scope.$eval(attributes.tbStateHrefOpts || '') || null;\r\n                    var keepSearch = config.keepSearch;\r\n                    var omitParams = config.omitParams || [];\r\n                    var state;\r\n                    var updateHref = function () {\r\n                        if (_.isString(state)) {\r\n                            var href = $state.href(state, params, opts);\r\n                            if (keepSearch) {\r\n                                href = urlWithParams(href, _.omit($location.search(), omitParams));\r\n                            }\r\n                            attributes.$set('href', href);\r\n                        }\r\n                    };\r\n                    attributes.$observe('tbStateHref', function (value) {\r\n                        state = value;\r\n                        updateHref();\r\n                    });\r\n                    if (keepSearch) {\r\n                        scope.$on('$locationChangeSuccess', updateHref);\r\n                    }\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../../common/attributes/tbFocus/tbFocus.ts\" />\r\n/// <reference path=\"../../common/attributes/tbFocus/FocusCtrl.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbTagsInput', [\r\n        'SearchSuggestionsService',\r\n        function (searchSuggestionsService) {\r\n            return {\r\n                restrict: 'E',\r\n                require: ['ngModel', '?tbFocus'],\r\n                templateUrl: 'tagsInput.html',\r\n                replace: true,\r\n                scope: {\r\n                    newTag: '=?textInputModel'\r\n                },\r\n                link: function (scope, element, attributes, controllersArr) {\r\n                    var ngModelCtrl = controllersArr[0];\r\n                    var ctrlFocus = controllersArr[1];\r\n                    // Initialize\r\n                    scope.selectedTagIndex = -1;\r\n                    scope.currentRow = {\r\n                        index: 0,\r\n                        object: null\r\n                    };\r\n                    // Helper methods\r\n                    var deselectTags = function () {\r\n                        scope.selectedTagIndex = -1;\r\n                    };\r\n                    // Scope methods\r\n                    scope.addTag = function (newTag) {\r\n                        if (!newTag)\r\n                            return;\r\n                        var quotedNewTag = VizPortal.TagsHelper.quote(newTag);\r\n                        scope.removeTag(quotedNewTag);\r\n                        ngModelCtrl.$setViewValue(ngModelCtrl.$modelValue.concat([{ name: quotedNewTag, added: true }]));\r\n                        deselectTags();\r\n                        scope.newTag = '';\r\n                    };\r\n                    scope.removeTag = function (tagName) {\r\n                        ngModelCtrl.$setViewValue(_.reject(ngModelCtrl.$modelValue, function (tag) {\r\n                            return (tag.name === tagName)\r\n                                || (tag.name === VizPortal.TagsHelper.unquote(tagName));\r\n                        }));\r\n                        scope.selectedTagIndex--;\r\n                    };\r\n                    scope.selectTag = function (tagName) {\r\n                        scope.selectedTagIndex = _.indexOf(scope.currentTags, _.findWhere(scope.currentTags, { name: tagName }));\r\n                    };\r\n                    scope.displayTag = VizPortal.TagsHelper.unquote;\r\n                    scope.displayTagHtml = VizPortal.TagsHelper.displayTagHtml;\r\n                    var getNewTagName = function () {\r\n                        // scope.currentRow.object may have a stale object when scope.newTag goes to an empty string\r\n                        if (!scope.newTag || !scope.currentRow.object)\r\n                            return '';\r\n                        return scope.currentRow.object.name;\r\n                    };\r\n                    scope.handleKeyEvent = function (event) {\r\n                        var selectedTag = scope.currentTags[scope.selectedTagIndex];\r\n                        switch (event.which) {\r\n                            case VizPortal.Keys.Tab:\r\n                                if (!selectedTag)\r\n                                    scope.addTag(getNewTagName());\r\n                                break;\r\n                            case VizPortal.Keys.Enter:\r\n                                if (selectedTag) {\r\n                                }\r\n                                else {\r\n                                    scope.addTag(getNewTagName());\r\n                                }\r\n                                event.preventDefault();\r\n                                break;\r\n                            case VizPortal.Keys.Backspace:\r\n                                if (selectedTag) {\r\n                                    scope.removeTag(selectedTag.name);\r\n                                    event.preventDefault();\r\n                                }\r\n                                else if (input.caret() === 0) {\r\n                                    scope.selectedTagIndex = scope.currentTags.length - 1;\r\n                                }\r\n                                break;\r\n                            case VizPortal.Keys.Delete:\r\n                                if (selectedTag.name) {\r\n                                    scope.removeTag(selectedTag.name);\r\n                                    scope.selectedTagIndex++; // Move to the next tag\r\n                                    event.preventDefault();\r\n                                }\r\n                                break;\r\n                            case VizPortal.Keys.ArrowRight:\r\n                                if (selectedTag) {\r\n                                    scope.selectedTagIndex++;\r\n                                    event.preventDefault();\r\n                                }\r\n                                else {\r\n                                    deselectTags();\r\n                                }\r\n                                break;\r\n                            case VizPortal.Keys.ArrowLeft:\r\n                                if (selectedTag) {\r\n                                    if (scope.selectedTagIndex > 0)\r\n                                        scope.selectedTagIndex--;\r\n                                    event.preventDefault();\r\n                                }\r\n                                else if (input.caret() === 0) {\r\n                                    scope.selectedTagIndex = scope.currentTags.length - 1;\r\n                                    event.preventDefault();\r\n                                }\r\n                                break;\r\n                            case VizPortal.Keys.ArrowDown:\r\n                                scope.currentRow.index++;\r\n                                event.preventDefault();\r\n                                break;\r\n                            case VizPortal.Keys.ArrowUp:\r\n                                // Don't let the index go below 0 on arrow up.  An item must always be selected\r\n                                scope.currentRow.index = Math.max(scope.currentRow.index - 1, 0);\r\n                                event.preventDefault();\r\n                                break;\r\n                            default:\r\n                                deselectTags();\r\n                        }\r\n                        // Pass keydown events to the outer element\r\n                        if (!event.isDefaultPrevented())\r\n                            element.trigger(event.type, event);\r\n                    };\r\n                    // Watchers\r\n                    // Get a list of possible tags every time newTag changes. Add newTag into the list if it's not already in the list\r\n                    scope.$watch(function () { return scope.newTag; }, function (newTag) {\r\n                        var newTagAddedToList = false;\r\n                        var firstSlice = true;\r\n                        scope.tagSource = {\r\n                            getSlice: function (start, size) {\r\n                                return searchSuggestionsService.tags(newTag).getSlice(start, size).then(function (result) {\r\n                                    if (firstSlice) {\r\n                                        scope.currentRow.index = 0; //Reset the tags to the beginning\r\n                                        firstSlice = false;\r\n                                    }\r\n                                    if (result.index === 0 && (result.items.length === 0 || result.items[0].name !== scope.newTag)) {\r\n                                        result.items.unshift({ name: scope.newTag });\r\n                                        newTagAddedToList = true;\r\n                                    }\r\n                                    if (newTagAddedToList) {\r\n                                        if (result.index !== 0)\r\n                                            result.index++;\r\n                                        result.total++;\r\n                                    }\r\n                                    return result;\r\n                                });\r\n                            }\r\n                        };\r\n                        // Simulate server tag splitting logic\r\n                        if (!newTag || newTag.split('\"').length === 2)\r\n                            return; // If there is only 1 double quote then ignore parsing\r\n                        var tagList = VizPortal.TagsHelper.parseTagString(newTag);\r\n                        if (tagList.length > 1) {\r\n                            _.forEach(tagList.slice(0, -1), scope.addTag);\r\n                        }\r\n                        scope.newTag = _.last(tagList) || '';\r\n                        // Ensure the typeahead dropdown matches the width of the tags input when typing new tags\r\n                        scope.dropdownWidth = element.width();\r\n                    });\r\n                    scope.$watch(function () { return ngModelCtrl.$modelValue; }, function (newVal) {\r\n                        scope.currentTags = _.isArray(newVal) ? newVal : [];\r\n                        if (scope.selectedTagIndex >= scope.currentTags.length)\r\n                            deselectTags();\r\n                    });\r\n                    // Element listeners\r\n                    var input = element.find('.tb-tag-input');\r\n                    if (ctrlFocus)\r\n                        ctrlFocus.setFocusElement(input);\r\n                    input.on('blur', function () { return scope.$apply(deselectTags); });\r\n                    element.click(function (event) {\r\n                        if (ctrlFocus)\r\n                            ctrlFocus.focus(); //Keep focus on the input element to handle key events\r\n                        else\r\n                            input.focus();\r\n                        // Deselect tags if they didn't click on a tag\r\n                        if ($(event.target).closest('.tb-tag-container').length === 0) {\r\n                            scope.$apply(deselectTags);\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../models/ITemplate.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var TemplateListCtrl = (function () {\r\n        function TemplateListCtrl() {\r\n            this.templates = [];\r\n        }\r\n        return TemplateListCtrl;\r\n    })();\r\n    VizPortal.Module.instance().directive('tbTemplateList', function () {\r\n        return {\r\n            require: 'tbTemplateList',\r\n            restrict: 'E',\r\n            controller: TemplateListCtrl,\r\n            scope: {\r\n                templates: '=?'\r\n            },\r\n            link: function (scope, element, attrs, templateListCtrl) {\r\n                scope.templates = templateListCtrl.templates;\r\n                element.remove();\r\n            }\r\n        };\r\n    });\r\n    VizPortal.Module.instance().directive('tbTemplate', function () {\r\n        return {\r\n            require: '^tbTemplateList',\r\n            restrict: 'E',\r\n            transclude: true,\r\n            link: function (scope, element, attrs, templateListCtrl, transclude) {\r\n                var ifExpression = attrs['templateIf'];\r\n                if (ifExpression === undefined || scope.$eval(ifExpression)) {\r\n                    templateListCtrl.templates.push({ attrs: attrs, linkFn: transclude });\r\n                }\r\n            }\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    // A sentinel value to mean mixed text field values\r\n    VizPortal.TextBoxMixedValues = \"\";\r\n    var directives = [\r\n        { name: 'tbTextBox', template: 'textBox.html' },\r\n        { name: 'tbPasswordBox', template: 'passwordBox.html' },\r\n        { name: 'tbNumberBox', template: 'numberBox.html' }\r\n    ];\r\n    /**\r\n     * A wrapper around input(type=\"text\") or input(type=\"password\"). Will put given tb-test-id\r\n     * onto the input element for easier testing.\r\n     *\r\n     * Usage:\r\n     *\r\n     *  tb:text-box(tb-text-box-model=\"model\", tb-test-id=\"testId\")\r\n     *\r\n     * Attributes:\r\n     *\r\n     * tb-text-box-model=\"model\":     Model to bind to\r\n     * tb-text-box-name=\"n\":          Used for form validation.\r\n     * tb-text-box-disabled=\"bool\":   See ng-disabled directive\r\n     * tb-text-box-required=\"bool\":   See ng-required directive\r\n     * tb-text-box-keydown=\"keydown($event)\": See ng-keydown directive\r\n     * tb-text-box-enter=\"enter()\":   See tb-enter directive\r\n     * tb-text-box-auto-select=\"bool\":see tb-auto-select directive\r\n     * tb-text-box-max-length=\"32\":   Adds maxlength attribute to input element\r\n     * tb-text-box-focus:             If present, puts focus on element when linked\r\n     * tb-text-box-clearable=\"bool\":  Has clear button when true\r\n     * tb-text-box-clear=\"clear()\":   Called when clear button is pressed\r\n     * tb-text-box-paste=\"p()\":       Called when content is pasted into the element\r\n     * tb-text-box-model-options=\"{'updateOn': 'enter clear'}\":\r\n     *   Modeled after Angular 1.3 ngModelOptions\r\n     */\r\n    _.each(directives, function (directive) {\r\n        VizPortal.Module.instance().directive(directive.name, ['$timeout', '$compile',\r\n            function ($timeout, $compile) {\r\n                return {\r\n                    restrict: 'E',\r\n                    replace: true,\r\n                    templateUrl: directive.template,\r\n                    scope: {\r\n                        disabled: '=tbTextBoxDisabled',\r\n                        required: '=tbTextBoxRequired',\r\n                        model: '=tbTextBoxModel',\r\n                        maxLength: '@tbTextBoxMaxLength',\r\n                        options: '@tbTextBoxModelOptions',\r\n                        onEnter: '&tbTextBoxEnter',\r\n                        focus: '=tbTextBoxFocus',\r\n                        clearable: '=tbTextBoxClearable',\r\n                        onClear: '&tbTextBoxClear',\r\n                        onPaste: '&tbTextBoxPaste',\r\n                        autoSelect: '=tbTextBoxAutoSelect',\r\n                        keydown: '&tbTextBoxKeydown',\r\n                        validation: '@tbTextBoxValidation',\r\n                        min: '=tbTextBoxValidationMin',\r\n                        max: '=tbTextBoxValidationMax',\r\n                        match: '=tbMatchData',\r\n                        placeholder: '=tbTextBoxPlaceholder',\r\n                        clearValue: '=?tbTextBoxClearValue',\r\n                        tabIndex: '@tbTextBoxTabindex'\r\n                    },\r\n                    link: function (scope, element, attrs) {\r\n                        if (_.isUndefined(scope.model))\r\n                            scope.model = ''; // Ensure the model is initialized to an empty string\r\n                        var inputElement = element.find('.tb-text-box-input');\r\n                        // This is a workaround for Angular form validation not respecting interpolated input names\r\n                        // Angularjs issue#1404\r\n                        if (attrs['tbTextBoxName']) {\r\n                            inputElement.prop('name', attrs['tbTextBoxName']);\r\n                        }\r\n                        if (scope.validation) {\r\n                            var inputElementClone = inputElement.clone();\r\n                            _.each(scope.validation.split(' '), function (validatorName) {\r\n                                inputElementClone.attr(validatorName, '');\r\n                            });\r\n                            inputElement.replaceWith(inputElementClone);\r\n                            $compile(inputElementClone)(scope);\r\n                            inputElement = inputElementClone;\r\n                        }\r\n                        scope.clearValue = function () { return scope.textValue = ''; };\r\n                        scope.$watch('model', function () {\r\n                            scope.textValue = scope.model;\r\n                            // Mixed-values handling\r\n                            if (scope.model === VizPortal.TextBoxMixedValues) {\r\n                                addMixedValueHandlers();\r\n                            }\r\n                            else {\r\n                                removeMixedValueHandlers();\r\n                            }\r\n                        });\r\n                        if (attrs['tbTestId']) {\r\n                            scope.inputTestId = attrs['tbTestId'] + '-input';\r\n                        }\r\n                        if (scope.maxLength !== undefined) {\r\n                            inputElement.attr(\"maxlength\", scope.maxLength);\r\n                        }\r\n                        // The timeout is necessary because the element may not be\r\n                        // rendered yet. $timeout gives it time to render\r\n                        var focus = function () { return $timeout(function () { return inputElement.focus(); }); };\r\n                        scope.clearAndFocus = function () {\r\n                            scope.textValue = '';\r\n                            if (scope.onClear) {\r\n                                scope.onClear();\r\n                            }\r\n                            inputElement.trigger('clear');\r\n                            focus();\r\n                        };\r\n                        scope.triggerEnter = function () {\r\n                            inputElement.trigger('enter');\r\n                        };\r\n                        var options = scope.$eval(attrs['tbTextBoxModelOptions']);\r\n                        var syncModelToText = function () { return scope.model = scope.textValue; };\r\n                        if (options && options.updateOn) {\r\n                            inputElement.on(options.updateOn, function () {\r\n                                // Use $evalAsync instead of $apply because some events may be triggered during a digest cycle\r\n                                scope.$evalAsync(syncModelToText);\r\n                            });\r\n                        }\r\n                        else {\r\n                            scope.$watch('textValue', syncModelToText);\r\n                        }\r\n                        inputElement.on('focus', function () {\r\n                            element.addClass('tb-focus');\r\n                        });\r\n                        inputElement.on('blur', function () {\r\n                            element.removeClass('tb-focus');\r\n                        });\r\n                        // Special handling for mixed values\r\n                        var addMixedValueHandlers = _.once(function () {\r\n                            inputElement.addClass('tb-text-box-mixed');\r\n                            // ... Select all text when focused\r\n                            inputElement.on('focus.mixed', function () {\r\n                                inputElement.select();\r\n                            });\r\n                            // ... Try to prevent deselection\r\n                            inputElement.on('keydown.mixed', function ($event) {\r\n                                switch ($event.which) {\r\n                                    case VizPortal.Keys.ArrowDown:\r\n                                    case VizPortal.Keys.ArrowUp:\r\n                                    case VizPortal.Keys.ArrowLeft:\r\n                                    case VizPortal.Keys.ArrowRight:\r\n                                    case VizPortal.Keys.Home:\r\n                                    case VizPortal.Keys.End:\r\n                                        $event.preventDefault();\r\n                                }\r\n                            });\r\n                            // ... This prevents deselection by not allowing the user to click to set the cursor position\r\n                            inputElement.on('mouseup.mixed', function ($event) {\r\n                                $event.preventDefault();\r\n                            });\r\n                        });\r\n                        var removeMixedValueHandlers = function () {\r\n                            inputElement.removeClass('tb-text-box-mixed');\r\n                            inputElement.off(\".mixed\");\r\n                        };\r\n                    }\r\n                };\r\n            }\r\n        ]);\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/DropdownHelper.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbTextDropdown', [\r\n        '$timeout', '$translate', 'SliceableFactory',\r\n        function ($timeout, $translate, sliceableFactory) {\r\n            return {\r\n                restrict: 'E',\r\n                templateUrl: 'textDropdown.html',\r\n                replace: true,\r\n                scope: {\r\n                    model: '=ngModel',\r\n                    optionList: '=',\r\n                    preventInput: '&tbPreventInput'\r\n                },\r\n                link: function (scope, element, attributes) {\r\n                    scope.items = sliceableFactory.fromArray(scope.optionList);\r\n                    var rowToModel = function (option) {\r\n                        return option ? option.value : scope.textValue;\r\n                    };\r\n                    VizPortal.DropdownHelper.setupDropdownScope(scope, $timeout, element.find(\"input\"), rowToModel);\r\n                    scope.itemText = function (model) {\r\n                        var option = _.findWhere(scope.optionList, { value: model });\r\n                        return option ? $translate.instant(option.translate) : model;\r\n                    };\r\n                    scope.$watch('editMode', function (editMode) {\r\n                        if (editMode) {\r\n                            scope.width = element.width();\r\n                        }\r\n                    });\r\n                    scope.$watch('textValue', function () { return scope.currentRow.index = -1; });\r\n                }\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    // This converter uses textile-js (https://github.com/borgar/textile-js) to perform the conversion.\r\n    var TextileJsConverter = (function () {\r\n        function TextileJsConverter() {\r\n        }\r\n        TextileJsConverter.prototype.makeHtml = function (text) {\r\n            return textile(text);\r\n        };\r\n        return TextileJsConverter;\r\n    })();\r\n    VizPortal.Module.instance().service('TextileConverter', TextileJsConverter);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../services/TextileConverter.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    // A directive for formatting textile content.\r\n    // Uses ideas from https://github.com/btford/angular-markdown-directive/blob/master/markdown.js\r\n    VizPortal.Module.instance().directive('tbTextile', [\r\n        '$sanitize', 'TextileConverter',\r\n        function ($sanitize, textileConverter) {\r\n            return {\r\n                restrict: 'A',\r\n                link: function (scope, element, attrs) {\r\n                    element.addClass(\"tb-textile tb-enable-selection\");\r\n                    scope.$watch(attrs['tbTextile'], function (newVal) {\r\n                        var html = newVal ? $sanitize(textileConverter.makeHtml(newVal)) : '';\r\n                        element.html(html);\r\n                        element.find('a').not('[target]').attr('target', '_blank');\r\n                    });\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n    // This directive extracts plain text from textile formatted content.\r\n    VizPortal.Module.instance().directive('tbTextilePlaintext', [\r\n        '$sanitize', 'TextileConverter',\r\n        function ($sanitize, textileConverter) {\r\n            return {\r\n                restrict: 'A',\r\n                link: function (scope, element, attrs) {\r\n                    scope.$watch(attrs['tbTextilePlaintext'], function (newVal) {\r\n                        var html = newVal ? $sanitize(textileConverter.makeHtml(newVal)) : '';\r\n                        var text = $(html).text();\r\n                        element.text(text);\r\n                    });\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbTimePicker', [\r\n        function () {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'timePicker.html',\r\n                require: '?ngModel',\r\n                scope: {},\r\n                link: function (scope, elm, attrs, ngModel) {\r\n                    if (!ngModel)\r\n                        return; // do nothing if no ng-model\r\n                    var use24HourTimeCycle = VizPortal.L10n.is24HourTimeCycle();\r\n                    scope.use24HourTimeCycle = use24HourTimeCycle;\r\n                    scope.precisionIncludesMinutes = attrs.precision !== 'hours';\r\n                    scope.hours = use24HourTimeCycle ? _.range(0, 24) : _.range(1, 13);\r\n                    scope.minutes = _.range(0, 60, 15);\r\n                    // View -> Model\r\n                    function modelValueFromView() {\r\n                        var minutesAfterMidnight = scope.time.minute;\r\n                        var hour = scope.time.hour;\r\n                        if (use24HourTimeCycle) {\r\n                            // 24-hr time\r\n                            minutesAfterMidnight += hour * 60;\r\n                        }\r\n                        else {\r\n                            // 12-hr time\r\n                            if (hour !== 12) {\r\n                                minutesAfterMidnight += hour * 60;\r\n                            }\r\n                            if (scope.time.meridiem === 'PM') {\r\n                                minutesAfterMidnight += 60 * 12;\r\n                            }\r\n                        }\r\n                        return minutesAfterMidnight;\r\n                    }\r\n                    scope.$watch(modelValueFromView, function (newValue) {\r\n                        ngModel.$setViewValue(newValue);\r\n                    });\r\n                    // Model -> View\r\n                    ngModel.$render = function () {\r\n                        var minutesAfterMidnight = ngModel.$viewValue;\r\n                        if (!(0 <= minutesAfterMidnight && minutesAfterMidnight <= 24 * 60)) {\r\n                            minutesAfterMidnight = 0;\r\n                            ngModel.$setViewValue(0);\r\n                        }\r\n                        if (use24HourTimeCycle) {\r\n                            scope.time = {\r\n                                hour: Math.floor(minutesAfterMidnight / 60),\r\n                                minute: minutesAfterMidnight % 60\r\n                            };\r\n                        }\r\n                        else {\r\n                            var hours = Math.floor(minutesAfterMidnight / 60) % 12;\r\n                            scope.time = {\r\n                                hour: hours > 0 ? hours : 12,\r\n                                minute: minutesAfterMidnight % 60,\r\n                                meridiem: minutesAfterMidnight >= 12 * 60 ? 'PM' : 'AM'\r\n                            };\r\n                        }\r\n                    };\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbTypeaheadFilter', [\r\n        '$translate', function ($translate) {\r\n            if (VizPortal.FeatureFlags.reactTypeaheadFilter) {\r\n                return {\r\n                    restrict: 'E',\r\n                    replace: true,\r\n                    link: function (scope) {\r\n                        scope.props = {\r\n                            filter: scope.filter,\r\n                            getFieldValueQuery: function () { return scope.getFieldValueQuery(scope.filter.definition.field); },\r\n                            translate: $translate.instant\r\n                        };\r\n                    },\r\n                    template: '<span><tb:react-typeahead-filter props=\"props\" /></span>'\r\n                };\r\n            }\r\n            else {\r\n                return {\r\n                    restrict: 'E',\r\n                    replace: true,\r\n                    templateUrl: 'typeaheadFilter.html'\r\n                };\r\n            }\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var FadeInTime = 100; /// 100 ms\r\n    var FadeOutTime = 3 * 1000; /// 3 seconds\r\n    var FadeInEasing = 'linear';\r\n    var FadeOutEasing = 'easeOutCubic';\r\n    VizPortal.Module.instance().directive('tbToast', [\r\n        'ToasterService', '$interval',\r\n        function (toasterService, $interval) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'inline_toast.html',\r\n                scope: {\r\n                    toast: '=tbToast'\r\n                },\r\n                link: function (scope, element, attr) {\r\n                    scope.close = function () { return toasterService.close(scope.toast.id); };\r\n                    scope.stopTimer = function () {\r\n                        if (scope.toast.timeout) {\r\n                            $interval.cancel(scope.toast.timeout);\r\n                            scope.toast.timeout = null;\r\n                        }\r\n                        if (scope.isFadingOut) {\r\n                            element.stop();\r\n                            element.css('opacity', 1);\r\n                        }\r\n                    };\r\n                    scope.restartTimer = function () {\r\n                        scope.stopTimer();\r\n                        if (scope.toast.timeoutDelay !== VizPortal.ToasterService.NoTimeout) {\r\n                            if (scope.isFadingOut) {\r\n                                fadeOut();\r\n                            }\r\n                            else {\r\n                                scope.toast.timeout = $interval(function () { return fadeOut(); }, scope.toast.timeoutDelay, 1);\r\n                            }\r\n                        }\r\n                    };\r\n                    function fadeIn() {\r\n                        element.css('opacity', 0);\r\n                        element.animate({\r\n                            opacity: 1\r\n                        }, FadeInTime, FadeInEasing, function () {\r\n                            if (scope.toast.timeoutDelay !== VizPortal.ToasterService.NoTimeout) {\r\n                                scope.toast.timeout = $interval(function () { return fadeOut(); }, scope.toast.timeoutDelay, 1);\r\n                            }\r\n                            ;\r\n                        });\r\n                    }\r\n                    ;\r\n                    function fadeOut() {\r\n                        scope.isFadingOut = true;\r\n                        element.animate({\r\n                            opacity: 0\r\n                        }, FadeOutTime, FadeOutEasing, function () {\r\n                            scope.close(scope.toast.id);\r\n                            scope.$apply();\r\n                        });\r\n                    }\r\n                    ;\r\n                    fadeIn();\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbToaster', [\r\n        'ToasterService',\r\n        function (ToasterService) {\r\n            return {\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'inline_toaster.html',\r\n                link: function (scope) {\r\n                    scope.toasts = ToasterService.toasts;\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbTooltipArea', [\r\n        '$parse',\r\n        function ($parse) {\r\n            return {\r\n                link: function (scope, element, attr) {\r\n                    var offset = 10;\r\n                    var textFn = $parse(attr['tbTooltipArea']);\r\n                    var eventNamespace = '.tbTooltipArea';\r\n                    var origin;\r\n                    var tooltip;\r\n                    var updateTooltip = function (mouseEvent) {\r\n                        var tooltipText = textFn(scope, { $event: mouseEvent });\r\n                        if (tooltipText) {\r\n                            tooltip.text(tooltipText);\r\n                            var left = mouseEvent.pageX - origin.left + offset;\r\n                            var top = mouseEvent.pageY - origin.top + offset;\r\n                            tooltip.css({\r\n                                display: 'block',\r\n                                left: left,\r\n                                top: top\r\n                            });\r\n                            var tooltipWidth = tooltip.outerWidth();\r\n                            var tooltipHeight = tooltip.outerHeight();\r\n                            var containerWidth = element.width();\r\n                            var containerHeight = element.height();\r\n                            var maxLeft = containerWidth - tooltipWidth;\r\n                            var maxTop = containerHeight - tooltipHeight;\r\n                            if (left > maxLeft) {\r\n                                left = maxLeft;\r\n                                tooltip.css('left', left);\r\n                            }\r\n                            ;\r\n                            if (top > maxTop) {\r\n                                top -= tooltipHeight + offset * 2;\r\n                                tooltip.css('top', top);\r\n                            }\r\n                        }\r\n                        else {\r\n                            tooltip.css('display', 'none');\r\n                        }\r\n                    };\r\n                    element.on('mouseenter' + eventNamespace, function (enterEvent) {\r\n                        origin = element.offset();\r\n                        if (tooltip) {\r\n                            tooltip.remove();\r\n                        }\r\n                        tooltip = $('<div>').addClass('tb-tooltip').appendTo(element);\r\n                        updateTooltip(enterEvent);\r\n                        element.on('mousemove' + eventNamespace, function (moveEvent) {\r\n                            updateTooltip(moveEvent);\r\n                        });\r\n                    });\r\n                    element.on('mouseleave' + eventNamespace, function (leaveEvent) {\r\n                        element.off('mousemove' + eventNamespace);\r\n                        tooltip.remove();\r\n                        tooltip = null;\r\n                    });\r\n                    scope.$on('$destroy', function () {\r\n                        if (tooltip) {\r\n                            tooltip.remove();\r\n                            tooltip = null;\r\n                        }\r\n                        element.off(eventNamespace);\r\n                    });\r\n                }\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../controllers/TopBarCtrl.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbTopBar', function () {\r\n        return {\r\n            restrict: 'E',\r\n            replace: true,\r\n            templateUrl: 'topBar.html',\r\n            controller: VizPortal.TopBarCtrl,\r\n            scope: {\r\n                settings: '='\r\n            }\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbTranscludeFn', function () {\r\n        return {\r\n            restrict: 'A',\r\n            link: function (scope, element, attrs) {\r\n                var currentClone = $();\r\n                scope.$watch(attrs.tbTranscludeFn, function (fn) {\r\n                    currentClone.remove();\r\n                    if (!fn)\r\n                        return;\r\n                    var extraProperties = scope.$eval(attrs.tbTranscludeScope);\r\n                    fn(function (clone, scope) {\r\n                        angular.extend(scope, extraProperties);\r\n                        currentClone = clone;\r\n                        element.append(currentClone);\r\n                    });\r\n                });\r\n            }\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbTypeaheadFormat', ['$interpolate',\r\n        function ($interpolate) {\r\n            function escapeRegexp(queryToEscape) {\r\n                return _.escape(queryToEscape).replace(/([.?*+^$[\\]\\\\(){}|-])/g, '\\\\$1');\r\n            }\r\n            function formatMatch(input, target, prefixesOnly) {\r\n                // Construct regex for highlighting matching fragments. The input string is tokenized\r\n                // and each token is a potential match.\r\n                // e.g. the input string 'Ab Cd' is turned into the regex '(Ab|Cd)'.\r\n                var regex = (prefixesOnly ? '\\\\b' : '') + '(' + _.compact(escapeRegexp(input).split(' ')).join('|') + ')';\r\n                return _.escape(target).replace(new RegExp(regex, 'gi'), '<strong>$&</strong>');\r\n            }\r\n            return {\r\n                restrict: 'A',\r\n                link: function (scope, element, attrs) {\r\n                    var matchText = scope.$eval(attrs.tbTypeaheadFormat);\r\n                    var matchPrefixesOnly = scope.$eval(attrs.tbMatchPrefixesOnly);\r\n                    var itemText = $interpolate(element.text())(scope);\r\n                    if (matchText) {\r\n                        element.empty().append(formatMatch(matchText, itemText, matchPrefixesOnly));\r\n                    }\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../filters/SizeFilter.ts\" />\r\n/// <reference path=\"../models/IVizPortalCookies.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/LogoService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbUpdateSiteLogoForm', [\r\n        function () {\r\n            return {\r\n                templateUrl: 'updateSiteLogoForm.html',\r\n                replace: true,\r\n                restrict: 'E',\r\n                scope: {},\r\n                require: '^?tbSettingsCoordinator',\r\n                controller: UpdateSiteLogoCtrl,\r\n                link: function ($scope, form, attr, settingsCoordinatorCtrl) {\r\n                    $scope.form = form;\r\n                    $scope.fileInput = form.find('input[type=\"file\"]');\r\n                    $scope.previewImgWrapper = form.find('.tb-update-site-logo-preview-img-wrapper');\r\n                    $scope.fileInput.on('change', function () { return $scope.$evalAsync($scope.onFileInputChange); });\r\n                    // Register form for syncing with form Save/Revert controls\r\n                    if (settingsCoordinatorCtrl) {\r\n                        var settingsFormState = {\r\n                            save: function () { return $scope.submitSiteLogoForm(); },\r\n                            cancel: function () { return $scope.init(); },\r\n                            isBusy: function () { return false; },\r\n                            isFormUnchanged: function () { return !$scope.formIsDirty; },\r\n                            isValid: function () { return $scope.formIsValid; }\r\n                        };\r\n                        settingsCoordinatorCtrl.registerFormState(settingsFormState);\r\n                    }\r\n                    $scope.init();\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n    var UpdateSiteLogoCtrl = (function () {\r\n        function UpdateSiteLogoCtrl($scope, $cookies, $q, $timeout, $translate, RestApiPrefix, ServerService, LogoService, BrowserSupportService) {\r\n            $scope.endpoint = RestApiPrefix + 'updateSiteLogo';\r\n            $scope.xsrfToken = $cookies[VizPortal.CookieKeys.XsrfToken];\r\n            $scope.usingCustomLogo = function () { return LogoService.isUsingCustomSiteLogo(); };\r\n            $scope.dragAndDropEnabled = BrowserSupportService.supportsDragAndDropEvents() &&\r\n                BrowserSupportService.supportsFormData() &&\r\n                !BrowserSupportService.isTouch();\r\n            $scope.previewEnabled = BrowserSupportService.supportsFileReader();\r\n            $scope.init = function () {\r\n                $scope.fileInput.val(null);\r\n                $scope.formIsDirty = false;\r\n                $scope.resetToDefault = false;\r\n                $scope.formIsValid = true;\r\n                $scope.errorMessage = undefined;\r\n                $scope.file = undefined;\r\n                $scope.filename = undefined;\r\n                $scope.previewUrl = undefined;\r\n                return $q.when({});\r\n            };\r\n            $scope.onFileAddedOrChanged = function (filename, file) {\r\n                $scope.formIsDirty = true;\r\n                $scope.resetToDefault = false;\r\n                if (file && !_.contains(UpdateSiteLogoCtrl.SupportedImageTypes, file.type)) {\r\n                    $scope.formIsValid = false;\r\n                    $scope.errorMessage = $translate.instant('uploadSiteLogoErrorFileTypeNotSupported');\r\n                }\r\n                else if (file && file.size && file.size > UpdateSiteLogoCtrl.MaxImageSize) {\r\n                    $scope.formIsValid = false;\r\n                    $scope.errorMessage = $translate.instant('uploadSiteLogoErrorFileLargerThan2Megabytes');\r\n                }\r\n                else {\r\n                    $scope.file = file;\r\n                    $scope.filename = filename;\r\n                    $scope.formIsValid = true;\r\n                    $scope.errorMessage = undefined;\r\n                    if ($scope.previewEnabled) {\r\n                        // Generate preview\r\n                        var reader = new FileReader();\r\n                        reader.onload = function () { return $scope.$apply(function () { return $scope.previewUrl = reader.result; }); };\r\n                        reader.onerror = function () { return $scope.errorMessage = $translate.instant('uploadSiteLogoErrorFileReadError'); };\r\n                        // CSS fade animation - Use JQuery instead of $apply() for speed (50ms to allow CSS reflow)\r\n                        reader.onloadstart = function () { return $scope.previewImgWrapper.addClass('tb-without-img'); };\r\n                        reader.onloadend = function () { return $timeout(function () { return $scope.previewImgWrapper.removeClass('tb-without-img'); }, 50); };\r\n                        // Start reading file\r\n                        reader.readAsDataURL($scope.file);\r\n                    }\r\n                }\r\n            };\r\n            $scope.onFileDrop = function (file) {\r\n                if ($scope.dragAndDropEnabled) {\r\n                    $scope.fileInput.val(null);\r\n                    $scope.onFileAddedOrChanged(file.name, file);\r\n                }\r\n            };\r\n            $scope.onFileInputChange = function () {\r\n                var fileInput = $scope.fileInput;\r\n                if (!!fileInput.val()) {\r\n                    // File object is not accessible in all browsers\r\n                    var name = fileInput.val().split('\\\\').pop();\r\n                    var fileInputElement = fileInput[0];\r\n                    var file = fileInputElement.files && fileInputElement.files[0];\r\n                    $scope.onFileAddedOrChanged(name, file);\r\n                }\r\n                else if (!$scope.resetToDefault) {\r\n                    // User clicked 'cancel' in OS file selection\r\n                    $scope.init();\r\n                }\r\n            };\r\n            $scope.handleResetToDefaultClick = function () {\r\n                $scope.fileInput.val(null);\r\n                $scope.formIsDirty = true;\r\n                $scope.resetToDefault = true;\r\n                $scope.formIsValid = true;\r\n                $scope.errorMessage = undefined;\r\n                $scope.file = undefined;\r\n                $scope.filename = undefined;\r\n                $scope.previewUrl = LogoService.getServerTopBarLogo().image;\r\n            };\r\n            $scope.getPreviewUrl = function () {\r\n                return $scope.previewUrl ? $scope.previewUrl : LogoService.getTopBarLogo().image;\r\n            };\r\n            $scope.submitSiteLogoForm = function () {\r\n                if ($scope.formIsDirty) {\r\n                    if (!$scope.dragAndDropEnabled) {\r\n                        $scope.form.submit(); // Fall back to old school form submission\r\n                        return $q.when({});\r\n                    }\r\n                    else {\r\n                        var updatePromise;\r\n                        if (!$scope.resetToDefault) {\r\n                            updatePromise = LogoService.uploadSiteLogo($scope.file);\r\n                        }\r\n                        else {\r\n                            updatePromise = LogoService.resetSiteLogoToDefault();\r\n                        }\r\n                        return updatePromise.then(function (result) { return $scope.handleFormSubmitResult(result); });\r\n                    }\r\n                }\r\n            };\r\n            $scope.handleFormSubmitResult = function (result) {\r\n                if (result.errors && result.errors.length) {\r\n                    var errorMessage;\r\n                    switch (result.errors[0].code) {\r\n                        case VizPortal.CommonErrorCode.FileSizeTooLarge:\r\n                            $scope.errorMessage = $translate.instant('uploadSiteLogoErrorFileLargerThan2Megabytes');\r\n                            break;\r\n                        case VizPortal.OnlineErrorCode.SiteCustomizationUnavailable:\r\n                            $scope.errorMessage = $translate.instant('actionNotAvailable');\r\n                            break;\r\n                        case VizPortal.OnlineErrorCode.InvalidImage:\r\n                        case VizPortal.OnlineErrorCode.ImageProcessingError:\r\n                        case VizPortal.OnlineErrorCode.StorageException:\r\n                        default:\r\n                            $scope.errorMessage = $translate.instant('uploadSiteLogoErrorSaveError');\r\n                            break;\r\n                    }\r\n                    return $q.reject();\r\n                }\r\n                return ServerService.refreshSessionInfo() // Fetch the updated logo\r\n                    .then(function () { return $scope.init(); });\r\n            };\r\n        }\r\n        UpdateSiteLogoCtrl.SupportedImageTypes = ['image/png', 'image/jpeg', 'image/gif'];\r\n        UpdateSiteLogoCtrl.MaxImageSize = VizPortal.ByteSizeConversionFactor.ONE_MB * 2;\r\n        UpdateSiteLogoCtrl.$inject = [\r\n            '$scope',\r\n            '$cookies',\r\n            '$q',\r\n            '$timeout',\r\n            '$translate',\r\n            'RestApiPrefix',\r\n            'ServerService',\r\n            'LogoService',\r\n            'BrowserSupportService'\r\n        ];\r\n        return UpdateSiteLogoCtrl;\r\n    })();\r\n    VizPortal.UpdateSiteLogoCtrl = UpdateSiteLogoCtrl;\r\n    VizPortal.Module.instance().controller('UpdateSiteLogoCtrl', UpdateSiteLogoCtrl);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var id = 0;\r\n    VizPortal.Module.instance().directive('tbUploadIframe', [function () {\r\n            return {\r\n                scope: {\r\n                    handleResult: '&',\r\n                    iframeId: '=?' // passed out\r\n                },\r\n                restrict: 'E',\r\n                replace: true,\r\n                link: function (scope, element, attrs) {\r\n                    scope.iframeId = 'upload-iframe-' + id++;\r\n                    // IMPORTANT!\r\n                    // The iframe needs to be created with the name property set in order for it to work as a form submit target.\r\n                    // The name prop cannot be copied down to the element later by angular or the form submit won't go to the iframe.\r\n                    var iframe = angular.element('<iframe name=\"' + scope.iframeId + '\" ' +\r\n                        'border=\"0\" width=\"0\" height=\"0\" ' +\r\n                        'style=\"width:0px;height:0px;border:none;display:none\">');\r\n                    element.after(iframe);\r\n                    iframe.on('load', function () {\r\n                        var result = iframe.prop('contentWindow').result;\r\n                        // IE will call load when the iframe is first added to the DOM,\r\n                        // so make sure we actually have a result.\r\n                        if (result) {\r\n                            scope.handleResult(result);\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbUsernameInputValidator', function () {\r\n        return {\r\n            restrict: 'A',\r\n            require: 'ngModel',\r\n            link: function (scope, elm, attrs, ctrl) {\r\n                // this regex string requires double escaping, once for the string and once for the regex\r\n                // it's matching the following chars: ; ,\r\n                var USERNAME_REGEXP = new RegExp('[;,]');\r\n                ctrl.$parsers.push(function (inputName) {\r\n                    ctrl.$setValidity('username', !USERNAME_REGEXP.test(inputName));\r\n                    return inputName;\r\n                });\r\n            }\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbUserOrGroupSelector', [\r\n        'SearchSuggestionsService',\r\n        function (searchSuggestions) {\r\n            return {\r\n                restrict: 'E',\r\n                templateUrl: 'userOrGroupSelector.html',\r\n                replace: true,\r\n                scope: {\r\n                    autoEdit: '=',\r\n                    userSelected: '&',\r\n                    groupSelected: '&'\r\n                },\r\n                link: function (scope) {\r\n                    scope.selected = {\r\n                        granteeType: 'group' // group is selected by default.\r\n                    };\r\n                    scope.userSearchSuggestions = function (match) { return searchSuggestions.users(match); };\r\n                    scope.groupSearchSuggestions = function (match) { return searchSuggestions.groups(match); };\r\n                    scope.$watch('selected.user', function (user) {\r\n                        if (user) {\r\n                            scope.selected.user = null;\r\n                            scope.userSelected({ user: user });\r\n                        }\r\n                    });\r\n                    scope.$watch('selected.group', function (group) {\r\n                        if (group) {\r\n                            scope.selected.group = null;\r\n                            scope.groupSelected({ group: group });\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbVisible', function () {\r\n        return {\r\n            restrict: 'A',\r\n            link: function (scope, element, attributes) {\r\n                scope.$watch(attributes['tbVisible'], function (visible) {\r\n                    element.css({ 'visibility': visible ? 'visible' : 'hidden' });\r\n                });\r\n            }\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbWindowResize', [\r\n        '$parse',\r\n        function ($parse) {\r\n            return {\r\n                link: function (scope, element, attr) {\r\n                    var resizeFn = $parse(attr['tbWindowResize']);\r\n                    var win = angular.element(window);\r\n                    var eventNamespace = '.tbWindowResize' + scope.$id;\r\n                    var lazyResizeFn = _.debounce(function () {\r\n                        scope.$apply(resizeFn(scope));\r\n                    }, 50);\r\n                    win.on('resize' + eventNamespace, function () {\r\n                        lazyResizeFn();\r\n                    });\r\n                    element.on('$destroy', function () {\r\n                        win.off(eventNamespace);\r\n                    });\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetWorkerProcessStatus.ts\" />\r\n/// <reference path=\"../ServerApi/types/IWorkerProcess.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbWorkerProcessStatus', ['$interval', '$translate', 'ServerService', 'HelpService',\r\n        function ($interval, $translate, server, help) {\r\n            var PollMS = 60000;\r\n            return {\r\n                scope: {\r\n                    process: '=',\r\n                    isPreferred: '&'\r\n                },\r\n                restrict: 'E',\r\n                replace: true,\r\n                templateUrl: 'workerProcessStatus.html',\r\n                link: function ($scope) {\r\n                    var refreshStatusInterval;\r\n                    var scopeDestroyed = false;\r\n                    var refreshStatus = function () {\r\n                        server.sendRequest(new VizPortal.ServerApi.GetWorkerProcessStatus({ process: $scope.process }))\r\n                            .then(function (result) {\r\n                            if (scopeDestroyed) {\r\n                                // If the scope has been destroyed while the request was pending (user left the page)\r\n                                return;\r\n                            }\r\n                            $scope.status = result.status;\r\n                            $scope.pending = result.pendingTransfers;\r\n                            $scope.syncTimestamp = result.syncTimestamp;\r\n                            refreshStatusInterval = $interval(refreshStatus, PollMS, 1, false);\r\n                        });\r\n                    };\r\n                    refreshStatus();\r\n                    $scope.showStatusText = function () {\r\n                        var status = $scope.status;\r\n                        switch ($scope.process.type) {\r\n                            case VizPortal.ServerApi.WorkerProcessType.clusterController:\r\n                                return status === VizPortal.ServerApi.WorkerStatusType.down;\r\n                            case VizPortal.ServerApi.WorkerProcessType.fileStore:\r\n                                return _.contains([\r\n                                    VizPortal.ServerApi.WorkerStatusType.activeSyncing,\r\n                                    VizPortal.ServerApi.WorkerStatusType.down,\r\n                                    VizPortal.ServerApi.WorkerStatusType.decommissioningReadOnly,\r\n                                    VizPortal.ServerApi.WorkerStatusType.decommissionFailedReadOnly,\r\n                                    VizPortal.ServerApi.WorkerStatusType.readyForRemoval\r\n                                ], status);\r\n                            case VizPortal.ServerApi.WorkerProcessType.repository:\r\n                                return status === VizPortal.ServerApi.WorkerStatusType.statusNotAvailableSyncing;\r\n                            default:\r\n                                return false;\r\n                        }\r\n                    };\r\n                    $scope.statusText = function () {\r\n                        return $translate.instant($scope.process.type + '_' + $scope.status + '_status');\r\n                    };\r\n                    $scope.statusTooltip = function () {\r\n                        if ($scope.pending > 0 || $scope.status === VizPortal.ServerApi.WorkerStatusType.activeSyncing) {\r\n                            return $translate.instant('filestore_activesyncing_tooltip', { PENDING_COUNT: $scope.pending }, VizPortal.L10n.Interpolations.Count);\r\n                        }\r\n                        else {\r\n                            return $translate.instant($scope.process.type + '_' + $scope.status + '_tooltip');\r\n                        }\r\n                    };\r\n                    $scope.statusIconType = function () {\r\n                        switch ($scope.status) {\r\n                            case VizPortal.ServerApi.WorkerStatusType.active:\r\n                            case VizPortal.ServerApi.WorkerStatusType.decommissionFailedReadOnly:\r\n                            case VizPortal.ServerApi.WorkerStatusType.readyForRemoval:\r\n                                return VizPortal.ServerApi.WorkerStatusType.active;\r\n                            case VizPortal.ServerApi.WorkerStatusType.passive:\r\n                            case VizPortal.ServerApi.WorkerStatusType.readOnly:\r\n                                return VizPortal.ServerApi.WorkerStatusType.passive;\r\n                            case VizPortal.ServerApi.WorkerStatusType.busy:\r\n                            case VizPortal.ServerApi.WorkerStatusType.activeSyncing:\r\n                            case VizPortal.ServerApi.WorkerStatusType.decommissioningReadOnly:\r\n                            case VizPortal.ServerApi.WorkerStatusType.statusNotAvailableSyncing:\r\n                                return VizPortal.ServerApi.WorkerStatusType.busy;\r\n                            case VizPortal.ServerApi.WorkerStatusType.unlicensed:\r\n                            case VizPortal.ServerApi.WorkerStatusType.down:\r\n                            case VizPortal.ServerApi.WorkerStatusType.statusNotAvailable:\r\n                                return $scope.status;\r\n                        }\r\n                    };\r\n                    $scope.serverStatusHelpUrl = help.getServerHelpUrlByCategory('status1');\r\n                    $scope.$on(VizPortal.ServerStatusCtrl.refreshProcessStatusEvent, function () {\r\n                        $interval.cancel(refreshStatusInterval);\r\n                        $scope.status = undefined; // Show spinner if refresh is manually triggered\r\n                        refreshStatus();\r\n                    });\r\n                    $scope.$on('$destroy', function () {\r\n                        $interval.cancel(refreshStatusInterval);\r\n                        scopeDestroyed = true;\r\n                    });\r\n                }\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/types/IOAuthCredential.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().filter('credentialType', [\r\n        '$translate',\r\n        function ($translate) {\r\n            return function (credentialType) {\r\n                switch (credentialType) {\r\n                    case VizPortal.ServerApi.OAuthCredentialTypes.Salesforce: return $translate.instant('salesforce');\r\n                    case VizPortal.ServerApi.OAuthCredentialTypes.BigQuery: return $translate.instant('googleBigQuery');\r\n                    case VizPortal.ServerApi.OAuthCredentialTypes.GoogleAnalytics: return $translate.instant('googleAnalytics');\r\n                }\r\n                return '';\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().filter('cronExpression', ['$translate', '$filter', function ($translate, $filter) {\r\n            return function (cronExpression) {\r\n                var dayOfWeek = $filter('cronExpression.dayOfWeekField')(VizPortal.CronExpressionHelper.getDayOfWeekField(cronExpression));\r\n                return $filter('cronExpression.minutesOfHourField')(VizPortal.CronExpressionHelper.getMinutesField(cronExpression)) +\r\n                    $filter('cronExpression.hoursOfDayField')(VizPortal.CronExpressionHelper.getHoursField(cronExpression)) +\r\n                    (dayOfWeek ? ' ' + dayOfWeek : '');\r\n            };\r\n        }]);\r\n    VizPortal.Module.instance().filter('cronExpression.minutesOfHourField', ['$translate', '$filter', function ($translate, $filter) {\r\n            return function (minutesOfHourField) {\r\n                var minutesParts = VizPortal.CronExpressionHelper.getTimeFieldSubsetParts(minutesOfHourField);\r\n                if (_.isNumber(minutesParts.increment)) {\r\n                    return $filter('sentenceAsFragment')($translate.instant('remoteRefreshScheduleExpressionStatementFragmentMinuteIncrement', { MINUTE_COUNT: minutesParts.increment }, VizPortal.L10n.Interpolations.Count));\r\n                }\r\n                else {\r\n                    return '';\r\n                }\r\n            };\r\n        }]);\r\n    VizPortal.Module.instance().filter('cronExpression.hoursOfDayField', ['$translate', '$filter', function ($translate, $filter) {\r\n            return function (hourOfDayField) {\r\n                var translation = '';\r\n                var fragment = '';\r\n                var hoursParts = VizPortal.CronExpressionHelper.getTimeFieldSubsetParts(hourOfDayField);\r\n                if (_.isNumber(hoursParts.increment)) {\r\n                    fragment = $translate.instant('remoteRefreshScheduleExpressionStatementFragmentHourIncrement', { HOUR_COUNT: hoursParts.increment }, VizPortal.L10n.Interpolations.Count);\r\n                    translation = $filter('sentenceAsFragment')(fragment);\r\n                }\r\n                if (_.isNumber(hoursParts.from) && _.isNumber(hoursParts.to)) {\r\n                    var hoursFromDate = new Date();\r\n                    hoursFromDate.setHours(hoursParts.from, 0, 0, 0);\r\n                    var hoursToDate = new Date();\r\n                    hoursToDate.setHours(hoursParts.to, 0, 0, 0);\r\n                    fragment = $translate.instant('remoteRefreshScheduleExpressionStatementFragmentRange', { FROM_DATETIME: VizPortal.L10n.localizedShortTime(hoursFromDate), TO_DATETIME: VizPortal.L10n.localizedShortTime(hoursToDate) });\r\n                    translation = translation + ' ' + $filter('sentenceAsFragment')(fragment);\r\n                }\r\n                if (_.isNumber(hoursParts.specific)) {\r\n                    var hoursSpecificDate = new Date();\r\n                    hoursSpecificDate.setHours(hoursParts.specific, 0, 0, 0);\r\n                    fragment = $translate.instant('remoteRefreshScheduleExpressionStatementFragmentSpecific', { DATETIME: VizPortal.L10n.localizedShortTime(hoursSpecificDate) });\r\n                    translation = $filter('sentenceAsFragment')(fragment);\r\n                }\r\n                return translation;\r\n            };\r\n        }]);\r\n    VizPortal.Module.instance().filter('cronExpression.dayOfWeekField', ['$translate', '$filter', function ($translate, $filter) {\r\n            return function (dayOfWeekField) {\r\n                var translation = '';\r\n                var fragment = '';\r\n                var addSentenceSeparator = function (sentence) {\r\n                    if (sentence !== '') {\r\n                        return sentence + ' ';\r\n                    }\r\n                    else {\r\n                        return sentence;\r\n                    }\r\n                };\r\n                _.each(dayOfWeekField.split(','), function (subset) {\r\n                    var type = VizPortal.CronExpressionHelper.getTypeFromFieldSubset(subset);\r\n                    if (type === VizPortal.CronExpressionFieldSubsetTypes.Range) {\r\n                        translation = addSentenceSeparator(translation);\r\n                        var dash = subset.indexOf('-');\r\n                        var start = parseInt(subset.substring(0, dash), 10);\r\n                        var end = parseInt(subset.substring(dash + 1), 10);\r\n                        fragment = $translate.instant('remoteRefreshScheduleExpressionStatementFragmentRange', {\r\n                            FROM_DATETIME: $filter('cronExpression.specificDayOfWeek')(start),\r\n                            TO_DATETIME: $filter('cronExpression.specificDayOfWeek')(end)\r\n                        });\r\n                        translation = translation + $filter('sentenceAsFragment')(fragment);\r\n                    }\r\n                    else if (type === VizPortal.CronExpressionFieldSubsetTypes.Specific) {\r\n                        translation = addSentenceSeparator(translation);\r\n                        fragment = $filter('cronExpression.specificDayOfWeek')(parseInt(subset[0], 10));\r\n                        translation = translation + $filter('sentenceAsFragment')(fragment);\r\n                    }\r\n                    else if (type === VizPortal.CronExpressionFieldSubsetTypes.All) {\r\n                    }\r\n                    else {\r\n                        throw 'Cron day of week expression could not be parsed: ' + dayOfWeekField;\r\n                    }\r\n                });\r\n                return translation;\r\n            };\r\n        }]);\r\n    VizPortal.Module.instance().filter('cronExpression.specificDayOfWeek', [function () {\r\n            return function (dayOfWeek) {\r\n                // This array has Sunday at index 0 or 6 depending on the locale.\r\n                var wideDayNames = VizPortal.L10n.wideDayNames();\r\n                // returns 0 for Sunday, 1 for Monday\r\n                var firstDayOfWeek = VizPortal.L10n.firstDayOfWeek();\r\n                return wideDayNames[(parseInt(dayOfWeek, 10) + 6 - firstDayOfWeek) % 7];\r\n            };\r\n        }]);\r\n    VizPortal.Module.instance().filter('sentenceAsFragment', ['$translate', function ($translate) {\r\n            return function (fragment) {\r\n                return $translate.instant('remoteRefreshScheduleExpressionStatementSentence', { FRAGMENT: fragment });\r\n            };\r\n        }]);\r\n    VizPortal.Module.instance().filter('minutesOrHours', ['$translate', function ($translate) {\r\n            return function (minutes) {\r\n                if (minutes < 60) {\r\n                    return $translate.instant('minutes', { MINUTES: minutes });\r\n                }\r\n                else {\r\n                    return $translate.instant('hours', { HOURS: Math.floor(minutes / 60) });\r\n                }\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().filter('localizedLastSignedInDateTime', ['$translate', function ($translate) {\r\n            return function (value) {\r\n                if (value) {\r\n                    return VizPortal.L10n.localizedDateTime(value);\r\n                }\r\n                else {\r\n                    return $translate.instant(\"never\");\r\n                }\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().filter('list', [\r\n        '$translate',\r\n        function ($translate) {\r\n            function formatListMiddleAndEnd(items) {\r\n                if (items.length === 2) {\r\n                    return $translate.instant('listEnd', {\r\n                        START_ITEMS: items[0],\r\n                        LAST_ITEM: items[1]\r\n                    });\r\n                }\r\n                return $translate.instant('listMiddle', {\r\n                    FIRST_ITEMS: items[0],\r\n                    LAST_ITEMS: formatListMiddleAndEnd(items.slice(1))\r\n                });\r\n            }\r\n            return function (items) {\r\n                switch (items.length) {\r\n                    case 0:\r\n                        return '';\r\n                    case 1:\r\n                        return items[0];\r\n                    case 2:\r\n                        return $translate.instant('listTwo', {\r\n                            ITEM1: items[0],\r\n                            ITEM2: items[1]\r\n                        });\r\n                    default:\r\n                        return $translate.instant('listStart', {\r\n                            FIRST_ITEM: items[0],\r\n                            REMAINING_ITEMS: formatListMiddleAndEnd(items.slice(1))\r\n                        });\r\n                }\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().filter('localizedCount', function () {\r\n        return VizPortal.L10n.localizedCount;\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().filter('localizedDate', function () {\r\n        return VizPortal.L10n.localizedDate;\r\n    });\r\n    VizPortal.Module.instance().filter('localizedDateTime', function () {\r\n        return VizPortal.L10n.localizedDateTime;\r\n    });\r\n    VizPortal.Module.instance().filter('localizedTime', function () {\r\n        return VizPortal.L10n.localizedTime;\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().filter('localizedPercent', function () {\r\n        return VizPortal.L10n.localizedPercent;\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    // See http://stackoverflow.com/a/21712550 for an explanation\r\n    VizPortal.Module.instance().filter('pad', function () {\r\n        return function (numberToPad, length) {\r\n            return (1e4 + numberToPad + \"\").slice(-length);\r\n        };\r\n    });\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().filter('remoteRefreshScheduleTypeName', [\r\n        '$translate',\r\n        function ($translate) {\r\n            return function (remoteRefreshType) { return $translate.instant('remoteRefreshScheduleTypeName' + remoteRefreshType); };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().filter('scheduleActionName', [\r\n        '$translate',\r\n        function ($translate) {\r\n            return function (scheduleAction) {\r\n                switch (scheduleAction) {\r\n                    case VizPortal.ServerApi.ScheduleActions.Extract:\r\n                        return $translate.instant('extractRefresh');\r\n                    case VizPortal.ServerApi.ScheduleActions.Subscription:\r\n                        return $translate.instant('subscription');\r\n                }\r\n                return '';\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().filter('scheduleFrequencyDescription', [\r\n        '$translate',\r\n        '$filter',\r\n        function ($translate, $filter) {\r\n            function formatTime(minutesAfterMidnight) {\r\n                var date = new Date();\r\n                date.setHours(minutesAfterMidnight / 60);\r\n                date.setMinutes(minutesAfterMidnight % 60);\r\n                return VizPortal.L10n.localizedTime(date);\r\n            }\r\n            function formatHourly(schedule) {\r\n                var hourly = schedule.scheduleDetails;\r\n                var frequency = hourly.recurrenceMinutes < 60\r\n                    ? $translate.instant('minutes', { MINUTES: hourly.recurrenceMinutes })\r\n                    : $translate.instant('hours', { HOURS: hourly.recurrenceMinutes / 60 });\r\n                return $translate.instant('scheduleHourlyDescription', {\r\n                    FREQUENCY: frequency,\r\n                    START: formatTime(hourly.startTime),\r\n                    END: formatTime(hourly.endTime)\r\n                });\r\n            }\r\n            function formatDaily(schedule) {\r\n                var daily = schedule.scheduleDetails;\r\n                return $translate.instant('scheduleDailyDescription', {\r\n                    START: formatTime(daily.startTime)\r\n                });\r\n            }\r\n            function formatWeekly(schedule) {\r\n                var weekly = schedule.scheduleDetails;\r\n                var days = _.map(weekly.recurrenceDaysOfWeek, dayName);\r\n                return $translate.instant('scheduleWeeklyDescription', {\r\n                    START: formatTime(weekly.startTime),\r\n                    DAYS: $filter('list')(days)\r\n                });\r\n            }\r\n            function dayName(dayCode) {\r\n                return $translate.instant('dayName' + dayCode);\r\n            }\r\n            function formatMonthly(schedule) {\r\n                var monthly = schedule.scheduleDetails;\r\n                var dayOfMonth = monthly.recurrenceDayOfMonth === VizPortal.ServerApi.ScheduleLastDayOfMonth\r\n                    ? $translate.instant('last')\r\n                    : $translate.instant('dayOfMonth', { DAY: parseInt(monthly.recurrenceDayOfMonth, 10) });\r\n                return $translate.instant('scheduleMonthlyDescription', {\r\n                    START: formatTime(monthly.startTime),\r\n                    DAYOFMONTH: dayOfMonth\r\n                });\r\n            }\r\n            return function (schedule) {\r\n                switch (schedule.scheduleType) {\r\n                    case VizPortal.ServerApi.ScheduleTypes.Hourly:\r\n                        return formatHourly(schedule);\r\n                    case VizPortal.ServerApi.ScheduleTypes.Daily:\r\n                        return formatDaily(schedule);\r\n                    case VizPortal.ServerApi.ScheduleTypes.Weekly:\r\n                        return formatWeekly(schedule);\r\n                    case VizPortal.ServerApi.ScheduleTypes.Monthly:\r\n                        return formatMonthly(schedule);\r\n                }\r\n                throw \"Unknown schedule type: \" + schedule.scheduleType;\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().filter('scheduleTypeName', [\r\n        '$translate',\r\n        function ($translate) {\r\n            return function (scheduleType) { return $translate.instant(scheduleType.toLowerCase()); };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().filter('siteRole', [\r\n        '$translate',\r\n        function ($translate) {\r\n            return function (siteRole) {\r\n                return !!siteRole ? $translate.instant('siteRole_' + siteRole) : '';\r\n            };\r\n        }]);\r\n})(VizPortal || (VizPortal = {}));\r\n// External references\r\n// TODO: remove the following external references:\r\n/// <reference path=\"../../ts/helpers/Keys.ts\" />\r\n/// <reference path=\"../../ts/models/ContentTypes.ts\" />\r\n/// <reference path=\"../../ts/models/Set.ts\" />\r\n/// <reference path=\"../../ts/models/resourceInfoParts.ts\" />\r\n// Giving up... The remaining dependencies have too long of a dependency tail to track\r\n/// <reference path=\"../../ts/vizportal.ts\" /> \r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../ts/libs.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var Location = (function () {\r\n        function Location() {\r\n        }\r\n        Location.prototype.setUrl = function (url) {\r\n            window.location.href = url;\r\n        };\r\n        Location.prototype.search = function () {\r\n            return window.location.search;\r\n        };\r\n        Location.instance = new Location();\r\n        return Location;\r\n    })();\r\n    VizPortalReact.Location = Location;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../../ts/libs.ts\" />\r\n/// <reference path=\"../CommonStyles.ts\" />\r\n/// <reference path=\"../IReactTranslateService.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var SearchBox = (function (_super) {\r\n        __extends(SearchBox, _super);\r\n        function SearchBox() {\r\n            _super.apply(this, arguments);\r\n        }\r\n        SearchBox.prototype.render = function () {\r\n            var inputProps = _.extend({}, {\r\n                placeholder: this.props.translate ? this.props.translate('search') : '',\r\n                className: 'tb-placeholder'\r\n            }, this.props);\r\n            inputProps.style = _.extend({}, {\r\n                fontSize: VizPortalReact.CommonStyles.Sizes.SmallFontSize,\r\n                fontFamily: VizPortalReact.CommonStyles.Fonts.BodyFont,\r\n                paddingTop: VizPortalReact.CommonStyles.Sizes.TextBoxPadding,\r\n                paddingBottom: VizPortalReact.CommonStyles.Sizes.TextBoxPadding,\r\n                paddingLeft: VizPortalReact.CommonStyles.Sizes.TextBoxPadding + VizPortalReact.CommonStyles.Sizes.SmallIconSize,\r\n                borderWidth: VizPortalReact.CommonStyles.Sizes.TextBoxBorderSize,\r\n                borderColor: VizPortalReact.CommonStyles.Colors.BorderColor,\r\n                borderStyle: 'solid',\r\n                boxSizing: 'border-box',\r\n                background: 'url(img/magnifying_glass_small_normal.png) 0 center no-repeat',\r\n                outline: 'none'\r\n            }, this.props.style);\r\n            return React.DOM.input(inputProps);\r\n        };\r\n        SearchBox.displayName = 'SearchBox';\r\n        SearchBox.element = React.createFactory(SearchBox);\r\n        return SearchBox;\r\n    })(React.Component);\r\n    VizPortalReact.SearchBox = SearchBox;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../../ts/libs.ts\" />\r\n/// <reference path=\"../Location.ts\" />\r\n/// <reference path=\"SearchBox.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var FilteringListBox = (function (_super) {\r\n        __extends(FilteringListBox, _super);\r\n        function FilteringListBox() {\r\n            _super.apply(this, arguments);\r\n            // React routines\r\n            this.state = {\r\n                data: [],\r\n                selectedIndex: -1,\r\n                searchTerm: '',\r\n                searchBoxHeight: 0,\r\n                measuredRowHeight: 0,\r\n                indexOfFirstVisibleSection: 0,\r\n                indexOfLastVisibleSection: 0,\r\n                anyIcons: false,\r\n                maxCountDigits: 0\r\n            };\r\n        }\r\n        FilteringListBox.prototype.render = function () {\r\n            var _this = this;\r\n            var sectionsWrapper = React.DOM.div({\r\n                style: {\r\n                    height: this.state.data.length * this.state.measuredRowHeight,\r\n                    overflow: 'hidden'\r\n                }\r\n            }, this.renderSections());\r\n            return React.DOM.div({\r\n                style: this.props.style\r\n            }, VizPortalReact.SearchBox.element({\r\n                ref: 'searchBox',\r\n                placeholder: this.props.searchBoxPlaceholder,\r\n                onChange: function (event) { return _this.searchTermChanged(event); },\r\n                onKeyDown: function (event) { return _this.handleKeyDown(event); },\r\n                style: { width: '100%' }\r\n            }), React.DOM.div({\r\n                ref: 'listbox',\r\n                style: {\r\n                    position: 'absolute',\r\n                    left: 0,\r\n                    right: 0,\r\n                    top: this.state.searchBoxHeight + VizPortalReact.CommonStyles.Sizes.SmallSpace,\r\n                    bottom: 0,\r\n                    overflowX: 'hidden',\r\n                    overflowY: 'auto'\r\n                },\r\n                onScroll: function (event) { return _this.onScroll(event); }\r\n            }, sectionsWrapper));\r\n        };\r\n        FilteringListBox.prototype.renderSections = function () {\r\n            var _this = this;\r\n            var matchPrefixesOnly = this.matchPrefixesOnly();\r\n            var sectionHeight = FilteringListBox.sectionSize * this.state.measuredRowHeight;\r\n            var sections = [];\r\n            for (var i = this.state.indexOfFirstVisibleSection; i <= this.state.indexOfLastVisibleSection; i++) {\r\n                var firstRowIndex = i * FilteringListBox.sectionSize;\r\n                var lastRowIndex = Math.min(firstRowIndex + FilteringListBox.sectionSize - 1, this.state.data.length - 1);\r\n                var sectionRows = [];\r\n                for (var rowIndex = firstRowIndex; rowIndex <= lastRowIndex; rowIndex++) {\r\n                    var item = this.state.data[rowIndex];\r\n                    sectionRows.push(FilteringListBox.Row.element({\r\n                        key: rowIndex,\r\n                        ref: FilteringListBox.ItemRefPrefix + rowIndex,\r\n                        item: item,\r\n                        searchTerm: this.state.searchTerm,\r\n                        matchPrefixesOnly: matchPrefixesOnly,\r\n                        selected: rowIndex === this.state.selectedIndex,\r\n                        showIcon: this.state.anyIcons,\r\n                        maxCountDigits: this.state.maxCountDigits,\r\n                        onClick: function () {\r\n                            if (_this.props.itemSelected) {\r\n                                _this.props.itemSelected(item);\r\n                            }\r\n                        }\r\n                    }));\r\n                }\r\n                var marginTop = i === this.state.indexOfFirstVisibleSection ? i * sectionHeight : 0;\r\n                sections.push(React.DOM.div({\r\n                    key: i,\r\n                    style: {\r\n                        marginTop: marginTop,\r\n                        height: sectionHeight,\r\n                        overflow: 'hidden'\r\n                    }\r\n                }, sectionRows));\r\n            }\r\n            return sections;\r\n        };\r\n        FilteringListBox.prototype.matchPrefixesOnly = function () {\r\n            return _.isBoolean(this.props.matchPrefixesOnly) ? this.props.matchPrefixesOnly : true;\r\n        };\r\n        FilteringListBox.prototype.searchTermChanged = function (event) {\r\n            var _this = this;\r\n            var searchTerm = event.target.value.toLowerCase();\r\n            // For a non-empty search term, automatically select the top-most matching item\r\n            var selectedIndex = searchTerm.length === 0 ? -1 : 0;\r\n            this.resetScrollPosition();\r\n            this.setState({\r\n                searchTerm: searchTerm,\r\n                selectedIndex: selectedIndex\r\n            }, function () { return _this.fetch(); });\r\n        };\r\n        FilteringListBox.prototype.resetScrollPosition = function () {\r\n            var viewPortNode = $(React.findDOMNode(this.refs['listbox']));\r\n            viewPortNode.scrollTop(0);\r\n        };\r\n        FilteringListBox.prototype.handleKeyDown = function (event) {\r\n            var _this = this;\r\n            switch (event.keyCode) {\r\n                case VizPortal.Keys.ArrowUp:\r\n                    this.setState({\r\n                        selectedIndex: Math.max(this.state.selectedIndex - 1, 0)\r\n                    }, function () { return _this.scrollItemIntoView(); });\r\n                    event.preventDefault();\r\n                    event.stopPropagation();\r\n                    break;\r\n                case VizPortal.Keys.ArrowDown:\r\n                    this.setState({\r\n                        selectedIndex: Math.min(this.state.selectedIndex + 1, this.state.data.length - 1)\r\n                    }, function () { return _this.scrollItemIntoView(); });\r\n                    event.preventDefault();\r\n                    event.stopPropagation();\r\n                    break;\r\n                case VizPortal.Keys.Enter:\r\n                    if (this.state.selectedIndex >= 0 && this.state.selectedIndex < this.state.data.length) {\r\n                        var selectedItem = this.state.data[this.state.selectedIndex];\r\n                        // Navigate to the selected item's url, if any.\r\n                        if (selectedItem.url) {\r\n                            // TODO: I'd prefer to use getDefaultProps to provide a default location service, but\r\n                            // it doesn't seem to work with TypeScript's class syntax.\r\n                            var locationService = this.props.locationService || VizPortalReact.Location.instance;\r\n                            locationService.setUrl(selectedItem.url);\r\n                        }\r\n                        if (this.props.itemSelected) {\r\n                            this.props.itemSelected(selectedItem);\r\n                        }\r\n                        event.preventDefault();\r\n                        event.stopPropagation();\r\n                    }\r\n                    break;\r\n            }\r\n        };\r\n        FilteringListBox.prototype.scrollItemIntoView = function () {\r\n            var viewPortNode = $(React.findDOMNode(this.refs['listbox']));\r\n            var scrollTop = viewPortNode.scrollTop();\r\n            var viewPortBottom = viewPortNode.height();\r\n            var itemTop = this.state.selectedIndex * this.state.measuredRowHeight;\r\n            var itemBottom = itemTop + this.state.measuredRowHeight;\r\n            if (itemTop < scrollTop) {\r\n                viewPortNode.scrollTop(itemTop);\r\n            }\r\n            else if (itemBottom > scrollTop + viewPortBottom) {\r\n                viewPortNode.scrollTop(itemBottom - viewPortBottom);\r\n            }\r\n            this.updateVisibleSectionIndexes();\r\n        };\r\n        FilteringListBox.prototype.componentDidMount = function () {\r\n            // Initially focus on the search box\r\n            var searchBox = $(React.findDOMNode(this.refs['searchBox']));\r\n            setTimeout(function () { return searchBox.focus(); }, 0);\r\n            // Record the height of the search box\r\n            this.setState({ searchBoxHeight: searchBox.outerHeight() });\r\n            // Load the initial batch of data\r\n            this.fetch();\r\n        };\r\n        FilteringListBox.prototype.updateMaxCountDigitsAndIcons = function () {\r\n            var anyIcons = this.state.anyIcons || _.any(this.state.data, function (item) { return _.isString(item.icon); });\r\n            // Determine the maximum number of digits in the item counts. This is used to calculate\r\n            // the width of the 'count' column.\r\n            var maxCount = _.max(_.map(this.state.data, function (item) { return (item.count || 0); }));\r\n            var maxCountDigits = ('' + maxCount).length;\r\n            this.setState({\r\n                anyIcons: anyIcons,\r\n                maxCountDigits: maxCountDigits\r\n            });\r\n        };\r\n        FilteringListBox.prototype.measureRowHeight = function () {\r\n            // Measure the height of the first row we find\r\n            var firstRowKey = _.find(_.keys(this.refs), function (key) { return key.substr(0, FilteringListBox.ItemRefPrefix.length) === FilteringListBox.ItemRefPrefix; });\r\n            var firstRowNode = $(React.findDOMNode(this.refs[firstRowKey]));\r\n            if (firstRowNode.length > 0) {\r\n                this.setState({ measuredRowHeight: firstRowNode.outerHeight() });\r\n            }\r\n        };\r\n        FilteringListBox.prototype.onScroll = function (event) {\r\n            this.updateVisibleSectionIndexes();\r\n        };\r\n        FilteringListBox.prototype.updateVisibleSectionIndexes = function () {\r\n            var _this = this;\r\n            var visibleSections = this.calculateVisibleSectionIndexes();\r\n            if (visibleSections.indexOfFirstVisibleSection !== this.state.indexOfFirstVisibleSection\r\n                || visibleSections.indexOfLastVisibleSection !== this.state.indexOfLastVisibleSection) {\r\n                this.setState(visibleSections, function () { return _this.fetch(); });\r\n            }\r\n        };\r\n        FilteringListBox.prototype.calculateVisibleSectionIndexes = function () {\r\n            var measuredRowHeight = this.state.measuredRowHeight || 100;\r\n            var sectionHeight = FilteringListBox.sectionSize * measuredRowHeight;\r\n            var viewPortNode = $(React.findDOMNode(this.refs['listbox']));\r\n            var viewportTop = viewPortNode.scrollTop();\r\n            var viewportBottom = viewportTop + viewPortNode.height();\r\n            var indexOfFirstVisibleSection = Math.floor(viewportTop / sectionHeight);\r\n            var indexOfLastVisibleSection = Math.ceil(viewportBottom / sectionHeight);\r\n            return {\r\n                indexOfFirstVisibleSection: indexOfFirstVisibleSection,\r\n                indexOfLastVisibleSection: indexOfLastVisibleSection\r\n            };\r\n        };\r\n        FilteringListBox.prototype.fetch = function () {\r\n            var _this = this;\r\n            var startIndex = this.state.indexOfFirstVisibleSection * FilteringListBox.sectionSize;\r\n            var endIndex = (this.state.indexOfLastVisibleSection + 1) * FilteringListBox.sectionSize - 1;\r\n            this.props.itemStore.getItems(this.state.searchTerm, startIndex, endIndex).then(function (data) {\r\n                _this.setState({ data: data }, function () {\r\n                    _this.updateMaxCountDigitsAndIcons();\r\n                    if (_this.state.measuredRowHeight === 0) {\r\n                        setTimeout(function () { return _this.measureRowHeight(); }, 0);\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        FilteringListBox.displayName = 'FilteringListBox';\r\n        FilteringListBox.sectionSize = 10;\r\n        FilteringListBox.ItemRefPrefix = 'item';\r\n        FilteringListBox.element = React.createFactory(FilteringListBox);\r\n        return FilteringListBox;\r\n    })(React.Component);\r\n    VizPortalReact.FilteringListBox = FilteringListBox;\r\n    var FilteringListBox;\r\n    (function (FilteringListBox) {\r\n        var Row = (function (_super) {\r\n            __extends(Row, _super);\r\n            function Row() {\r\n                _super.apply(this, arguments);\r\n                this.state = {\r\n                    hovered: false\r\n                };\r\n            }\r\n            // TODO: make mouse hovering a mixin\r\n            Row.prototype.handleMouseOver = function () {\r\n                this.setState({ hovered: true });\r\n            };\r\n            Row.prototype.handleMouseOut = function () {\r\n                this.setState({ hovered: false });\r\n            };\r\n            Row.prototype.render = function () {\r\n                var _this = this;\r\n                var item = this.props.item;\r\n                var topBottomItemPadding = VizPortalReact.CommonStyles.Sizes.DefaultSpace + VizPortalReact.CommonStyles.Sizes.LineWidth;\r\n                var backgroundColor = null;\r\n                if (this.state.hovered) {\r\n                    backgroundColor = VizPortalReact.CommonStyles.Colors.Grey245;\r\n                }\r\n                if (this.props.selected) {\r\n                    backgroundColor = VizPortalReact.CommonStyles.Colors.BlueHighlight;\r\n                }\r\n                var rowStyle = {\r\n                    display: 'block',\r\n                    paddingLeft: VizPortalReact.CommonStyles.Sizes.DefaultSpace + (this.props.showIcon ? VizPortalReact.CommonStyles.Sizes.SmallIconSize : 0),\r\n                    paddingRight: 0,\r\n                    paddingTop: topBottomItemPadding,\r\n                    paddingBottom: topBottomItemPadding,\r\n                    backgroundImage: item && item.icon ? 'url(' + item.icon + ')' : null,\r\n                    backgroundPosition: '1px center',\r\n                    backgroundRepeat: 'no-repeat',\r\n                    backgroundColor: backgroundColor,\r\n                    textDecoration: 'none',\r\n                    textOverflow: 'ellipsis',\r\n                    overflow: 'hidden',\r\n                    whiteSpace: 'nowrap',\r\n                    color: VizPortalReact.CommonStyles.Colors.NormalTextColor\r\n                };\r\n                if (item.isDivider) {\r\n                    rowStyle.paddingBottom--;\r\n                    rowStyle.borderBottom = '1px solid ' + VizPortalReact.CommonStyles.Colors.Grey224;\r\n                }\r\n                var itemCount = item && _.isNumber(item.count)\r\n                    ? React.DOM.span({\r\n                        style: {\r\n                            float: 'right',\r\n                            textAlign: 'right',\r\n                            // Max digit width is about 7px, so allocate '7 * number of digits' width.\r\n                            width: 7 * this.props.maxCountDigits,\r\n                            paddingLeft: VizPortalReact.CommonStyles.Sizes.DefaultSpace,\r\n                            paddingRight: VizPortalReact.CommonStyles.Sizes.SmallSpace\r\n                        }\r\n                    }, item.count)\r\n                    : null;\r\n                var itemLabel = this.itemLabel();\r\n                return React.DOM.a({\r\n                    href: item && item.url,\r\n                    style: rowStyle,\r\n                    onClick: function () { _this.props.onClick(); },\r\n                    onMouseOver: function () { return _this.handleMouseOver(); },\r\n                    onMouseOut: function () { return _this.handleMouseOut(); }\r\n                }, itemCount, itemLabel);\r\n            };\r\n            Row.prototype.itemLabel = function () {\r\n                var item = this.props.item;\r\n                if (!item) {\r\n                    return React.DOM.span({\r\n                        className: 'tb-icon-spinner'\r\n                    });\r\n                }\r\n                var labelHTML = this.props.searchTerm\r\n                    ? Filter.formatMatch(this.props.searchTerm, item.label, this.props.matchPrefixesOnly)\r\n                    : _.escape(item.label);\r\n                // For empty labels, use a non-breaking space to ensure the row is the right height\r\n                if (labelHTML === '') {\r\n                    labelHTML = '&nbsp;';\r\n                }\r\n                return React.DOM.span({\r\n                    dangerouslySetInnerHTML: { __html: labelHTML }\r\n                });\r\n            };\r\n            Row.displayName = 'FilteringListBoxRow';\r\n            Row.element = React.createFactory(Row);\r\n            return Row;\r\n        })(React.Component);\r\n        FilteringListBox.Row = Row;\r\n        var Filter;\r\n        (function (Filter) {\r\n            function filterDataBySearchTerm(data, searchTerm, matchPrefixesOnly) {\r\n                // If search term is blank, no filtering is necessary. Just return all the data.\r\n                if (searchTerm.length === 0) {\r\n                    return {\r\n                        fetchedRows: _.compact(data),\r\n                        estimatedTotalRowCount: data.length\r\n                    };\r\n                }\r\n                var fetchedData = _.compact(data);\r\n                var fetchedCount = fetchedData.length;\r\n                var regex = regexForSearchTerm(searchTerm, matchPrefixesOnly);\r\n                var filteredData = _.compact(_.map(fetchedData, function (item) {\r\n                    if (regex.test(item.label)) {\r\n                        // Item matches regex\r\n                        return _.extend({}, item, {\r\n                            labelHTML: formatMatch(searchTerm, item.label, matchPrefixesOnly)\r\n                        });\r\n                    }\r\n                    else {\r\n                        return null; // Item does not match regex\r\n                    }\r\n                }));\r\n                // If we've only fetched some of the data, we don't know the exact length of the\r\n                // filteredData, so take a guess:\r\n                var unfetchedCount = data.length - fetchedCount;\r\n                var estimatedTotalRowCount = filteredData.length;\r\n                if (unfetchedCount > 0) {\r\n                    if (fetchedCount > 0) {\r\n                        estimatedTotalRowCount = Math.max(filteredData.length + 1, Math.ceil(data.length * filteredData.length / fetchedCount));\r\n                    }\r\n                    else {\r\n                        // We have no way to estimate the total matching rows with no fetched data, so just\r\n                        // assume all data will match (anything reasonable would work here).\r\n                        estimatedTotalRowCount = data.length;\r\n                    }\r\n                }\r\n                return {\r\n                    fetchedRows: filteredData,\r\n                    estimatedTotalRowCount: estimatedTotalRowCount\r\n                };\r\n            }\r\n            Filter.filterDataBySearchTerm = filterDataBySearchTerm;\r\n            // Constructs a regex for finding items that match the search term.\r\n            // See http://stackoverflow.com/a/5421978 for the derivation of the regex.\r\n            function regexForSearchTerm(searchTerm, matchPrefixesOnly) {\r\n                var searchTermTokens = _.compact(escapeRegexp(searchTerm).split(' '));\r\n                var regexParts = ['^'];\r\n                _.each(searchTermTokens, function (token) {\r\n                    regexParts.push('(?=.*' + (matchPrefixesOnly ? '\\\\b' : '') + token + ')');\r\n                });\r\n                return new RegExp(regexParts.join(''), 'gi');\r\n            }\r\n            // TODO: these regex/formatting methods could be put on a separate class or module to ease testability/reuse.\r\n            function escapeRegexp(queryToEscape) {\r\n                return _.escape(queryToEscape).replace(/([.?*+^$[\\]\\\\(){}|-])/g, '\\\\$1');\r\n            }\r\n            function formatMatch(searchTerm, target, matchPrefixesOnly) {\r\n                // Construct regex for highlighting matching fragments. The input string is tokenized\r\n                // and each token is a potential match.\r\n                // e.g. the input string 'Ab Cd' is turned into the regex '(Ab|Cd)'.\r\n                var regex = (matchPrefixesOnly ? '\\\\b' : '') + '(' + _.compact(escapeRegexp(searchTerm).split(' ')).join('|') + ')';\r\n                return _.escape(target).replace(new RegExp(regex, 'gi'), '<strong style=\"text-decoration: underline\">$&</strong>');\r\n            }\r\n            Filter.formatMatch = formatMatch;\r\n        })(Filter = FilteringListBox.Filter || (FilteringListBox.Filter = {}));\r\n    })(FilteringListBox = VizPortalReact.FilteringListBox || (VizPortalReact.FilteringListBox = {}));\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../../ts/libs.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var Menu = (function (_super) {\r\n        __extends(Menu, _super);\r\n        function Menu() {\r\n            _super.apply(this, arguments);\r\n            this.state = {\r\n                open: false,\r\n                hovered: false\r\n            };\r\n        }\r\n        Menu.prototype.componentDidMount = function () {\r\n            this.id = '' + Menu.nextId++;\r\n            this.closeMenuOnMouseDownOutside();\r\n        };\r\n        // TODO: This should be a mixin, but I couldn't figure out how to make it work\r\n        Menu.prototype.closeMenuOnMouseDownOutside = function () {\r\n            var _this = this;\r\n            var element = $(React.findDOMNode(this));\r\n            var eventNamespace = this.getEventNamespace();\r\n            var mouseDownEvents = 'mousedown' + eventNamespace + ' touchstart' + eventNamespace;\r\n            // $todo: use react event system or at least something that plays nice with react\r\n            $(document).on(mouseDownEvents, function (downEvent) {\r\n                var target = $(downEvent.target);\r\n                if (target.closest(element).length === 0) {\r\n                    _this.setState({ open: false });\r\n                }\r\n            });\r\n        };\r\n        Menu.prototype.componentWillUnmount = function () {\r\n            $(document).off(this.getEventNamespace());\r\n        };\r\n        Menu.prototype.getEventNamespace = function () {\r\n            return '.mousedownOutside' + this.id;\r\n        };\r\n        Menu.prototype.render = function () {\r\n            var _this = this;\r\n            var menuButtonWrapper = Menu.ButtonWrapper.element({\r\n                onClick: function () { return _this.toggleMenu(); },\r\n                menuButtonFactory: this.props.menuButtonFactory,\r\n                menuOpen: this.state.open\r\n            });\r\n            var menuPanelWrapper = this.state.open\r\n                ? Menu.PanelWrapper.element({ style: this.props.menuPanelStyle }, this.props.menuPanelFactory({}))\r\n                : null;\r\n            var menuStyle = _.extend({}, {\r\n                position: 'relative',\r\n                display: 'inline-block'\r\n            }, this.props.style);\r\n            return React.DOM.span({\r\n                'data-tb-test-id': this.props.tbTestId,\r\n                style: menuStyle,\r\n                onKeyDown: function (e) { return _this.onKeyDown(e); }\r\n            }, menuButtonWrapper, menuPanelWrapper);\r\n        };\r\n        Menu.prototype.onKeyDown = function (event) {\r\n            if (event.keyCode === VizPortal.Keys.Escape) {\r\n                this.closeMenu();\r\n            }\r\n        };\r\n        Menu.prototype.toggleMenu = function () {\r\n            if (this.isMenuOpen()) {\r\n                this.closeMenu();\r\n            }\r\n            else {\r\n                this.openMenu();\r\n            }\r\n        };\r\n        Menu.prototype.isMenuOpen = function () {\r\n            return this.state.open;\r\n        };\r\n        Menu.prototype.openMenu = function () {\r\n            var _this = this;\r\n            if (this.props.onBeforeMenuOpen) {\r\n                this.props.onBeforeMenuOpen().then(function () { return _this.setState({ open: true }); });\r\n            }\r\n            else {\r\n                this.setState({ open: true });\r\n            }\r\n        };\r\n        Menu.prototype.closeMenu = function () {\r\n            this.setState({ open: false });\r\n        };\r\n        Menu.displayName = 'Menu';\r\n        Menu.nextId = 1;\r\n        Menu.element = React.createFactory(Menu);\r\n        return Menu;\r\n    })(React.Component);\r\n    VizPortalReact.Menu = Menu;\r\n    var Menu;\r\n    (function (Menu) {\r\n        var ButtonWrapper = (function (_super) {\r\n            __extends(ButtonWrapper, _super);\r\n            function ButtonWrapper() {\r\n                _super.apply(this, arguments);\r\n                this.state = {\r\n                    hovered: false\r\n                };\r\n            }\r\n            ButtonWrapper.prototype.render = function () {\r\n                var _this = this;\r\n                return React.DOM.span({\r\n                    onClick: function () { return _this.props.onClick(); },\r\n                    onMouseOver: function () { return _this.handleMouseOver(); },\r\n                    onMouseOut: function () { return _this.handleMouseOut(); },\r\n                    style: { cursor: 'pointer' }\r\n                }, this.props.menuButtonFactory({\r\n                    hovered: this.state.hovered,\r\n                    menuOpen: this.props.menuOpen\r\n                }));\r\n            };\r\n            ButtonWrapper.prototype.handleMouseOver = function () {\r\n                this.setState({ hovered: true });\r\n            };\r\n            ButtonWrapper.prototype.handleMouseOut = function () {\r\n                this.setState({ hovered: false });\r\n            };\r\n            ButtonWrapper.displayName = 'MenuButtonWrapper';\r\n            ButtonWrapper.element = React.createFactory(ButtonWrapper);\r\n            return ButtonWrapper;\r\n        })(React.Component);\r\n        Menu.ButtonWrapper = ButtonWrapper;\r\n        var PanelWrapper = (function (_super) {\r\n            __extends(PanelWrapper, _super);\r\n            function PanelWrapper() {\r\n                _super.apply(this, arguments);\r\n                this.state = {\r\n                    alignRight: false\r\n                };\r\n            }\r\n            PanelWrapper.prototype.componentDidMount = function () {\r\n                var node = $(React.findDOMNode(this));\r\n                var rightEdge = node.offset().left + node.outerWidth();\r\n                var windowWidth = $(window).width();\r\n                if (rightEdge >= windowWidth) {\r\n                    this.setState({ alignRight: true });\r\n                }\r\n            };\r\n            PanelWrapper.prototype.render = function () {\r\n                var style = _.extend({\r\n                    position: 'absolute',\r\n                    left: this.state.alignRight ? null : 0,\r\n                    right: this.state.alignRight ? 0 : null,\r\n                    zIndex: 1,\r\n                    textAlign: 'left'\r\n                }, this.props.style);\r\n                return React.DOM.div({ style: style }, this.props.children);\r\n            };\r\n            PanelWrapper.displayName = 'MenuPanelWrapper';\r\n            PanelWrapper.element = React.createFactory(PanelWrapper);\r\n            return PanelWrapper;\r\n        })(React.Component);\r\n        Menu.PanelWrapper = PanelWrapper;\r\n    })(Menu = VizPortalReact.Menu || (VizPortalReact.Menu = {}));\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/CommonStyles.ts\" />\r\n/// <reference path=\"../../common/react/IReactTranslateService.ts\" />\r\n/// <reference path=\"../../common/react/components/FilteringListBox.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var FavoritesMenuPanel = (function (_super) {\r\n        __extends(FavoritesMenuPanel, _super);\r\n        function FavoritesMenuPanel() {\r\n            _super.apply(this, arguments);\r\n            this.state = {\r\n                filteredData: this.props.data\r\n            };\r\n        }\r\n        FavoritesMenuPanel.prototype.render = function () {\r\n            var _this = this;\r\n            return React.DOM.div({ style: VizPortalReact.HeaderStyles.MenuPanelStyle }, VizPortalReact.FilteringListBox.element({\r\n                itemStore: {\r\n                    getItems: function (filter, start, end) {\r\n                        return Q.when(VizPortalReact.FilteringListBox.Filter.filterDataBySearchTerm(_this.props.data, filter, true).fetchedRows);\r\n                    }\r\n                },\r\n                searchBoxPlaceholder: this.props.translate('searchFavorites'),\r\n                itemSelected: function () { return _this.props.itemSelected(); },\r\n                style: VizPortalReact.CommonStyles.Helpers.Edges(VizPortalReact.CommonStyles.Sizes.SmallSpace)\r\n            }));\r\n        };\r\n        FavoritesMenuPanel.displayName = 'FavoritesMenuPanel';\r\n        FavoritesMenuPanel.element = React.createFactory(FavoritesMenuPanel);\r\n        return FavoritesMenuPanel;\r\n    })(React.Component);\r\n    VizPortalReact.FavoritesMenuPanel = FavoritesMenuPanel;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/CommonStyles.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var HeaderMenuButton = (function (_super) {\r\n        __extends(HeaderMenuButton, _super);\r\n        function HeaderMenuButton() {\r\n            _super.apply(this, arguments);\r\n        }\r\n        HeaderMenuButton.prototype.render = function () {\r\n            var highlight = this.props.hovered || this.props.menuOpen;\r\n            var menuButtonStyle = {\r\n                display: 'block',\r\n                height: VizPortalReact.CommonStyles.Sizes.NormalIconSize,\r\n                lineHeight: VizPortalReact.CommonStyles.Sizes.NormalIconSize + 'px',\r\n                fontFamily: VizPortalReact.CommonStyles.Fonts.HeaderFont,\r\n                fontSize: VizPortalReact.CommonStyles.Sizes.HeaderFontSize,\r\n                letterSpacing: VizPortalReact.HeaderStyles.LetterSpacing,\r\n                color: VizPortalReact.CommonStyles.Colors.White,\r\n                opacity: highlight ? VizPortalReact.HeaderStyles.HoverOpacity : VizPortalReact.HeaderStyles.RestOpacity\r\n            };\r\n            // Add icon\r\n            if (this.props.iconUrl) {\r\n                _.extend(menuButtonStyle, {\r\n                    paddingLeft: VizPortalReact.CommonStyles.Sizes.NormalIconSize + VizPortalReact.CommonStyles.Sizes.SmallSpace,\r\n                    backgroundImage: this.props.iconUrl,\r\n                    backgroundPosition: 'left center',\r\n                    backgroundRepeat: 'no-repeat'\r\n                });\r\n            }\r\n            // Apply style overrides\r\n            _.extend(menuButtonStyle, this.props.style);\r\n            return React.DOM.span({ style: menuButtonStyle }, this.props.label);\r\n        };\r\n        HeaderMenuButton.displayName = 'HeaderMenuButton';\r\n        HeaderMenuButton.element = React.createFactory(HeaderMenuButton);\r\n        return HeaderMenuButton;\r\n    })(React.Component);\r\n    VizPortalReact.HeaderMenuButton = HeaderMenuButton;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/FavoritesStore.ts\" />\r\n/// <reference path=\"../../common/react/IReactTranslateService.ts\" />\r\n/// <reference path=\"../../common/react/components/FilteringListBox.ts\" />\r\n/// <reference path=\"../../common/react/components/Menu.ts\" />\r\n/// <reference path=\"./FavoritesMenuPanel.ts\" />\r\n/// <reference path=\"./HeaderMenuButton.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var FavoritesMenu = (function (_super) {\r\n        __extends(FavoritesMenu, _super);\r\n        function FavoritesMenu() {\r\n            _super.apply(this, arguments);\r\n            this.state = {\r\n                data: []\r\n            };\r\n        }\r\n        FavoritesMenu.prototype.render = function () {\r\n            var _this = this;\r\n            return VizPortalReact.Menu.element({\r\n                ref: \"menu\",\r\n                tbTestId: 'favorites-menu',\r\n                style: this.props.style,\r\n                menuButtonFactory: function (props) {\r\n                    props.iconUrl = 'url(img/star_header_icon.png)';\r\n                    return VizPortalReact.HeaderMenuButton.element(props);\r\n                },\r\n                menuPanelFactory: function (props) {\r\n                    props.translate = _this.props.translate;\r\n                    props.data = _this.state.data;\r\n                    props.itemSelected = function () {\r\n                        _this.refs['menu'].closeMenu();\r\n                    };\r\n                    return VizPortalReact.FavoritesMenuPanel.element(props);\r\n                },\r\n                onBeforeMenuOpen: function () {\r\n                    return _this.loadFavorites();\r\n                }\r\n            });\r\n        };\r\n        FavoritesMenu.prototype.loadFavorites = function () {\r\n            var _this = this;\r\n            return this.props.favoritesStore.getAll()\r\n                .then(function (items) {\r\n                var data = _.map(items, function (item) {\r\n                    return {\r\n                        label: item.objectName,\r\n                        icon: item.objectType === VizPortal.FavoriteObjectType.VIEW ? VizPortalReact.CommonStyles.IconUrls.View : VizPortalReact.CommonStyles.IconUrls.Workbook,\r\n                        url: item.objectType === VizPortal.FavoriteObjectType.VIEW\r\n                            ? _this.props.siteUrls.favoriteView(item.objectId)\r\n                            : _this.props.siteUrls.favoriteWorkbook(item.objectId)\r\n                    };\r\n                });\r\n                _this.setState({ data: data });\r\n            });\r\n        };\r\n        FavoritesMenu.displayName = 'FavoritesMenu';\r\n        FavoritesMenu.element = React.createFactory(FavoritesMenu);\r\n        return FavoritesMenu;\r\n    })(React.Component);\r\n    VizPortalReact.FavoritesMenu = FavoritesMenu;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"StoreHelpers.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var SiteStore = (function () {\r\n        function SiteStore(siteNames) {\r\n            this.siteNames = siteNames;\r\n        }\r\n        SiteStore.prototype.getAll = function () {\r\n            return VizPortalReact.StoreHelpers.getAll(this.siteNames.all());\r\n        };\r\n        return SiteStore;\r\n    })();\r\n    VizPortalReact.SiteStore = SiteStore;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/CommonStyles.ts\" />\r\n/// <reference path=\"../../common/react/components/Menu.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var SiteSwitcherMenuButton = (function (_super) {\r\n        __extends(SiteSwitcherMenuButton, _super);\r\n        function SiteSwitcherMenuButton() {\r\n            _super.apply(this, arguments);\r\n        }\r\n        SiteSwitcherMenuButton.prototype.render = function () {\r\n            var highlight = this.props.hovered || this.props.menuOpen;\r\n            var paddingRight = VizPortalReact.CommonStyles.Sizes.NormalIconSize + VizPortalReact.CommonStyles.Sizes.SmallSpace;\r\n            return React.DOM.span({\r\n                style: {\r\n                    display: 'inline-block',\r\n                    // Constrain the maximum width of the site title\r\n                    width: 150 + paddingRight,\r\n                    overflow: 'hidden',\r\n                    textOverflow: 'ellipsis',\r\n                    textAlign: 'right',\r\n                    verticalAlign: 'middle',\r\n                    // Font\r\n                    fontFamily: VizPortalReact.CommonStyles.Fonts.HeaderFont,\r\n                    fontSize: VizPortalReact.CommonStyles.Sizes.HeaderFontSize,\r\n                    letterSpacing: '0.08em',\r\n                    // Color & Opacity\r\n                    color: highlight ? VizPortalReact.HeaderStyles.SiteSwitcherHoverColor : VizPortalReact.HeaderStyles.SiteSwitcherRestColor,\r\n                    opacity: highlight ? VizPortalReact.HeaderStyles.SiteSwitcherHoverOpacity : VizPortalReact.HeaderStyles.SiteSwitcherRestOpacity,\r\n                    // Dropdown icon\r\n                    paddingRight: paddingRight,\r\n                    backgroundImage: 'url(img/' + (highlight ? VizPortalReact.HeaderStyles.SiteSwitcherDropdownHoverImage : VizPortalReact.HeaderStyles.SiteSwitcherDropdownRestImage) + ')',\r\n                    backgroundPosition: 'right center',\r\n                    backgroundRepeat: 'no-repeat'\r\n                },\r\n                'data-tb-test-id': 'site-switcher-button'\r\n            }, this.props.buttonTitle);\r\n        };\r\n        SiteSwitcherMenuButton.displayName = 'SiteSwitcherMenuButton';\r\n        SiteSwitcherMenuButton.element = React.createFactory(SiteSwitcherMenuButton);\r\n        return SiteSwitcherMenuButton;\r\n    })(React.Component);\r\n    VizPortalReact.SiteSwitcherMenuButton = SiteSwitcherMenuButton;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/CommonStyles.ts\" />\r\n/// <reference path=\"../../common/react/IReactTranslateService.ts\" />\r\n/// <reference path=\"../../common/react/components/FilteringListBox.ts\" />\r\n/// <reference path=\"HeaderStyles.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var SiteSwitcherMenuPanel = (function (_super) {\r\n        __extends(SiteSwitcherMenuPanel, _super);\r\n        function SiteSwitcherMenuPanel() {\r\n            _super.apply(this, arguments);\r\n        }\r\n        SiteSwitcherMenuPanel.prototype.render = function () {\r\n            var _this = this;\r\n            // Slightly different dimensions to the other menu panels\r\n            var menuPanelStyle = _.extend({}, VizPortalReact.HeaderStyles.MenuPanelStyle, {\r\n                width: 210,\r\n                height: 300\r\n            });\r\n            return React.DOM.div({\r\n                style: menuPanelStyle,\r\n                'data-tb-test-id': 'site-switcher-dropdown'\r\n            }, VizPortalReact.FilteringListBox.element({\r\n                itemStore: {\r\n                    getItems: function (filter, start, end) {\r\n                        var filteredRows = VizPortalReact.FilteringListBox.Filter.filterDataBySearchTerm(_this.props.sites, filter, true).fetchedRows;\r\n                        // Add the \"All Sites\" link at the top (unless filtering)\r\n                        if (filter === '') {\r\n                            filteredRows.splice(0, 0, {\r\n                                label: _this.props.translate('siteSwitcher_manageAllSites'),\r\n                                url: _this.props.serverUrls.status(),\r\n                                icon: _this.props.onServerPage ? 'img/bullet.png' : null,\r\n                                isDivider: true\r\n                            });\r\n                        }\r\n                        return Q.when(filteredRows);\r\n                    }\r\n                },\r\n                searchBoxPlaceholder: this.props.translate('search'),\r\n                itemSelected: function () { return _this.props.itemSelected(); },\r\n                style: VizPortalReact.CommonStyles.Helpers.Edges(VizPortalReact.CommonStyles.Sizes.SmallSpace)\r\n            }));\r\n        };\r\n        SiteSwitcherMenuPanel.displayName = 'SiteSwitcherMenuPanel';\r\n        SiteSwitcherMenuPanel.element = React.createFactory(SiteSwitcherMenuPanel);\r\n        return SiteSwitcherMenuPanel;\r\n    })(React.Component);\r\n    VizPortalReact.SiteSwitcherMenuPanel = SiteSwitcherMenuPanel;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/SiteStore.ts\" />\r\n/// <reference path=\"../../common/react/Location.ts\" />\r\n/// <reference path=\"../../common/react/IReactTranslateService.ts\" />\r\n/// <reference path=\"../../common/react/components/FilteringListBox.ts\" />\r\n/// <reference path=\"../../common/react/components/Menu.ts\" />\r\n/// <reference path=\"./SiteSwitcherMenuButton.ts\" />\r\n/// <reference path=\"./SiteSwitcherMenuPanel.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var SiteSwitcher = (function (_super) {\r\n        __extends(SiteSwitcher, _super);\r\n        function SiteSwitcher() {\r\n            _super.apply(this, arguments);\r\n            this.state = {\r\n                sites: []\r\n            };\r\n        }\r\n        SiteSwitcher.prototype.render = function () {\r\n            var _this = this;\r\n            return VizPortalReact.Menu.element({\r\n                ref: 'menu',\r\n                tbTestId: 'site-switcher',\r\n                menuButtonFactory: function (props) {\r\n                    props.buttonTitle =\r\n                        _this.onServerPage()\r\n                            ? _this.props.translate('siteSwitcher_allSites')\r\n                            : (_this.props.currentSite && _this.props.currentSite.name) || '';\r\n                    return VizPortalReact.SiteSwitcherMenuButton.element(props);\r\n                },\r\n                menuPanelFactory: function (props) {\r\n                    props.translate = _this.props.translate;\r\n                    props.sites = _this.state.sites;\r\n                    props.itemSelected = function () {\r\n                        _this.refs['menu'].closeMenu();\r\n                    };\r\n                    props.serverUrls = _this.props.serverUrls;\r\n                    props.onServerPage = _this.onServerPage();\r\n                    return VizPortalReact.SiteSwitcherMenuPanel.element(props);\r\n                },\r\n                onBeforeMenuOpen: function () {\r\n                    return _this.loadSites();\r\n                }\r\n            });\r\n        };\r\n        SiteSwitcher.prototype.loadSites = function () {\r\n            var _this = this;\r\n            return this.props.siteStore.getAll()\r\n                .then(function (items) {\r\n                var sites = _.map(items, function (item) {\r\n                    var isCurrentSite = !_this.onServerPage() && _this.props.currentSite.urlName === item.urlName;\r\n                    return {\r\n                        label: item.name,\r\n                        icon: isCurrentSite ? 'img/bullet.png' : null,\r\n                        url: _this.siteUrl(item)\r\n                    };\r\n                });\r\n                _this.setState({ sites: sites });\r\n            });\r\n        };\r\n        SiteSwitcher.prototype.onServerPage = function () {\r\n            return VizPortalReact.Navigation.isServerLocation(this.props.navLocation);\r\n        };\r\n        SiteSwitcher.prototype.siteUrl = function (site) {\r\n            var hash = site.urlName ? '#/site/' + site.urlName + '/projects' : '#/projects';\r\n            var locationSearch = (this.props.location || VizPortalReact.Location.instance).search();\r\n            return '/' + locationSearch + hash;\r\n        };\r\n        SiteSwitcher.displayName = 'SiteSwitcher';\r\n        SiteSwitcher.element = React.createFactory(SiteSwitcher);\r\n        return SiteSwitcher;\r\n    })(React.Component);\r\n    VizPortalReact.SiteSwitcher = SiteSwitcher;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var AlertActions = (function () {\r\n        function AlertActions(alerts, extractTasks, datasources, workbooks) {\r\n            this.alerts = alerts;\r\n            this.extractTasks = extractTasks;\r\n            this.datasources = datasources;\r\n            this.workbooks = workbooks;\r\n        }\r\n        AlertActions.prototype.getAlertCount = function () {\r\n            GetAlertCountAction(this.alerts);\r\n        };\r\n        AlertActions.prototype.getAlerts = function () {\r\n            GetAlertsAction(this.alerts);\r\n        };\r\n        AlertActions.prototype.tryAgain = function (alert) {\r\n            var _this = this;\r\n            var taskId = alert.taskId;\r\n            var extractType = alert.alertType; // either 'IncrementExtract' or 'RefreshExtract'.\r\n            if (taskId) {\r\n                // run extract task by ID\r\n                this.extractTasks.run([taskId]).then(function () { return _this.getAlerts(); });\r\n            }\r\n            else if (extractType) {\r\n                // if we don't have a task ID,\r\n                // we may need to run a datasource or workbook refresh by the item ID & refresh type.\r\n                // if datasourceId is present, the alert item is a datasource.\r\n                // if datasourceId is not present, the alert item is a workbook with ID affectedWorkbookIds[0].\r\n                var datasourceId = alert.datasource && alert.datasource.id;\r\n                var workbookId = alert.workbooks && alert.workbooks[0] && alert.workbooks[0].id;\r\n                if (datasourceId) {\r\n                    // refresh datasource\r\n                    this.datasources.refreshExtracts([datasourceId], extractType).then(function () { return function () { return _this.getAlerts(); }; });\r\n                }\r\n                else if (workbookId) {\r\n                    // refresh workbook\r\n                    this.workbooks.refreshExtracts([workbookId], extractType).then(function () { return function () { return _this.getAlerts(); }; });\r\n                }\r\n            }\r\n            AlertTryAgainAction(alert.id);\r\n        };\r\n        return AlertActions;\r\n    })();\r\n    VizPortalReact.AlertActions = AlertActions;\r\n    function GetAlertCountAction(alerts) {\r\n        alerts.getCount().then(function (count) {\r\n            var payload = {\r\n                actionType: GetAlertCountAction.Type,\r\n                count: count\r\n            };\r\n            VizPortalReact.Dispatcher.instance.dispatch(payload);\r\n        });\r\n    }\r\n    VizPortalReact.GetAlertCountAction = GetAlertCountAction;\r\n    var GetAlertCountAction;\r\n    (function (GetAlertCountAction) {\r\n        GetAlertCountAction.Type = 'get-alert-count';\r\n    })(GetAlertCountAction = VizPortalReact.GetAlertCountAction || (VizPortalReact.GetAlertCountAction = {}));\r\n    function GetAlertsAction(alerts) {\r\n        alerts.getList().then(function (alertList) {\r\n            var payload = {\r\n                actionType: GetAlertsAction.Type,\r\n                alerts: alertList\r\n            };\r\n            VizPortalReact.Dispatcher.instance.dispatch(payload);\r\n        });\r\n    }\r\n    VizPortalReact.GetAlertsAction = GetAlertsAction;\r\n    var GetAlertsAction;\r\n    (function (GetAlertsAction) {\r\n        GetAlertsAction.Type = 'get-alerts';\r\n    })(GetAlertsAction = VizPortalReact.GetAlertsAction || (VizPortalReact.GetAlertsAction = {}));\r\n    function AlertTryAgainAction(alertId) {\r\n        VizPortalReact.Dispatcher.instance.dispatch({\r\n            actionType: AlertTryAgainAction.Type,\r\n            alertId: alertId\r\n        });\r\n    }\r\n    VizPortalReact.AlertTryAgainAction = AlertTryAgainAction;\r\n    var AlertTryAgainAction;\r\n    (function (AlertTryAgainAction) {\r\n        AlertTryAgainAction.Type = 'alert-try-again';\r\n    })(AlertTryAgainAction = VizPortalReact.AlertTryAgainAction || (VizPortalReact.AlertTryAgainAction = {}));\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../ts/models/IAlertInfo.ts\" />\r\n/// <reference path=\"AlertActions.ts\" />\r\n/// <reference path=\"Dispatcher.ts\" />\r\n/// <reference path=\"Store.ts\" />\r\n/// <reference path=\"StoreHelpers.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var AlertsStore = (function (_super) {\r\n        __extends(AlertsStore, _super);\r\n        function AlertsStore() {\r\n            var _this = this;\r\n            _super.call(this);\r\n            this.alertList = AlertsStore.AlertsPending;\r\n            VizPortalReact.Dispatcher.instance.register(function (payload) {\r\n                switch (payload.actionType) {\r\n                    case VizPortalReact.GetAlertCountAction.Type:\r\n                        _this.count = payload.count;\r\n                        _this.broadcast();\r\n                        break;\r\n                    case VizPortalReact.GetAlertsAction.Type:\r\n                        _this.alertList = payload.alerts;\r\n                        _this.count = _this.alertList.total;\r\n                        _this.broadcast();\r\n                        break;\r\n                    case VizPortalReact.AlertTryAgainAction.Type:\r\n                        var alertId = payload.alertId;\r\n                        var remainingAlerts = _.filter(_this.alertList.alerts, function (alert) { return alert.id !== alertId; });\r\n                        _this.alertList = {\r\n                            alerts: remainingAlerts,\r\n                            total: remainingAlerts.length\r\n                        };\r\n                        _this.count = remainingAlerts.length;\r\n                        _this.broadcast();\r\n                        break;\r\n                }\r\n            });\r\n        }\r\n        AlertsStore.prototype.getCount = function () {\r\n            return this.count;\r\n        };\r\n        AlertsStore.prototype.getAlerts = function () {\r\n            return this.alertList;\r\n        };\r\n        // A sentinel value to represent a pending alerts list.\r\n        AlertsStore.AlertsPending = { total: 0, alerts: [] };\r\n        return AlertsStore;\r\n    })(VizPortalReact.Store);\r\n    VizPortalReact.AlertsStore = AlertsStore;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/CommonStyles.ts\" />\r\n/// <reference path=\"../../common/react/IReactTranslateService.ts\" />\r\n/// <reference path=\"../../ts/L10n/L10n.ts\" />\r\n/// <reference path=\"HeaderStyles.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var AlertsMenuPanel = (function (_super) {\r\n        __extends(AlertsMenuPanel, _super);\r\n        function AlertsMenuPanel() {\r\n            _super.apply(this, arguments);\r\n        }\r\n        AlertsMenuPanel.prototype.componentDidMount = function () {\r\n            this.props.alertActions.getAlerts();\r\n        };\r\n        AlertsMenuPanel.prototype.render = function () {\r\n            return React.DOM.div({ style: AlertsMenuPanel.alertsMenuContainerStyle }, this.alertItems());\r\n        };\r\n        AlertsMenuPanel.prototype.alertItems = function () {\r\n            var _this = this;\r\n            var alertList = this.props.alertsStore.getAlerts();\r\n            // Alerts pending\r\n            if (alertList === VizPortalReact.AlertsStore.AlertsPending) {\r\n                return null; // TODO: maybe a loading indicator?\r\n            }\r\n            // No alerts\r\n            if (alertList.alerts.length === 0) {\r\n                return React.DOM.div({\r\n                    style: {\r\n                        padding: VizPortalReact.CommonStyles.Sizes.DefaultSpace,\r\n                        fontStyle: 'italic'\r\n                    }\r\n                }, this.props.translate('noAlerts'));\r\n            }\r\n            // Some alerts\r\n            return React.DOM.div({}, _.map(alertList.alerts, function (alert) {\r\n                return AlertsMenuItem.element({\r\n                    key: alert.id,\r\n                    translate: _this.props.translate,\r\n                    siteUrls: _this.props.siteUrls,\r\n                    alertActions: _this.props.alertActions,\r\n                    alert: alert,\r\n                    itemSelected: _this.props.itemSelected\r\n                });\r\n            }));\r\n        };\r\n        AlertsMenuPanel.displayName = 'AlertsMenuPanel';\r\n        AlertsMenuPanel.element = React.createFactory(AlertsMenuPanel);\r\n        AlertsMenuPanel.alertsMenuContainerStyle = _.extend({}, VizPortalReact.HeaderStyles.MenuPanelStyle, {\r\n            width: 350,\r\n            height: 'inherit',\r\n            maxHeight: 600,\r\n            overflow: 'auto',\r\n            padding: VizPortalReact.CommonStyles.Sizes.SmallSpace\r\n        });\r\n        return AlertsMenuPanel;\r\n    })(React.Component);\r\n    VizPortalReact.AlertsMenuPanel = AlertsMenuPanel;\r\n    var AlertsMenuItem = (function (_super) {\r\n        __extends(AlertsMenuItem, _super);\r\n        function AlertsMenuItem() {\r\n            _super.apply(this, arguments);\r\n        }\r\n        AlertsMenuItem.prototype.render = function () {\r\n            var _this = this;\r\n            var alert = this.props.alert;\r\n            return React.DOM.div({\r\n                className: 'tb-alert-item',\r\n                style: {\r\n                    whiteSpace: 'normal'\r\n                }\r\n            }, React.DOM.span({\r\n                style: {\r\n                    fontWeight: 'bold'\r\n                }\r\n            }, this.title()), React.DOM.table({ cellSpacing: '0', cellPadding: '0' }, \r\n            // Datasource row\r\n            React.DOM.tr({}, this.labelCell(this.props.translate('tableDatasource')), React.DOM.td({}, alert.datasource\r\n                ? React.DOM.a({\r\n                    href: this.props.siteUrls.datasourceDetailsUrl(alert.datasource.id),\r\n                    onClick: function () { return _this.props.itemSelected(); }\r\n                }, alert.datasource.name)\r\n                : this.props.translate('embedded'))), \r\n            // Failure type row\r\n            React.DOM.tr({}, this.labelCell(this.props.translate('tableFailureType')), React.DOM.td({}, this.failureType(alert.statusCode))), \r\n            // Most recent failure date row\r\n            React.DOM.tr({}, this.labelCell(this.props.translate('tableRefreshFailed')), React.DOM.td({}, this.dateTimeOrNever(alert.mostRecentFailureAt))), \r\n            // Most recent success date row\r\n            React.DOM.tr({}, this.labelCell(this.props.translate('tableLastRefresh')), React.DOM.td({}, this.dateTimeOrNever(alert.lastSuccessAt))), this.tryAgainLink(), this.connectionDetailsLink()));\r\n        };\r\n        AlertsMenuItem.prototype.labelCell = function (text) {\r\n            return React.DOM.td({ style: AlertsMenuItem.labelStyle }, text);\r\n        };\r\n        AlertsMenuItem.prototype.title = function () {\r\n            var workbooks = this.props.alert.workbooks;\r\n            if (!workbooks || workbooks.length === 0) {\r\n                return this.props.translate('outOfDateWorkbookNone');\r\n            }\r\n            if (workbooks.length === 1) {\r\n                return this.props.translate('outOfDateWithName', {\r\n                    NAME: VizPortal.L10n.elideIfLong(workbooks[0].name)\r\n                });\r\n            }\r\n            else {\r\n                // more than one\r\n                return this.props.translate('outOfDateWorkbooksWithCount', {\r\n                    LIST_COUNT: workbooks.length\r\n                }, VizPortal.L10n.Interpolations.Count);\r\n            }\r\n        };\r\n        AlertsMenuItem.prototype.failureType = function (statusCode) {\r\n            switch (statusCode) {\r\n                case VizPortal.AlertErrorCode.AlertSignInFailed:\r\n                case VizPortal.AlertErrorCode.AlertRemoteSignInFailed:\r\n                    return this.props.translate('signInFailedUnknownReason');\r\n                case VizPortal.AlertErrorCode.AlertExpiredPassword:\r\n                case VizPortal.AlertErrorCode.AlertRemoteExpiredPassword:\r\n                    return this.props.translate('expiredPassword');\r\n                case VizPortal.AlertErrorCode.AlertAccessTokenValidation:\r\n                    return this.props.translate('accessTokenValidation');\r\n                case VizPortal.AlertErrorCode.AlertAuthConfiguration:\r\n                    return this.props.translate('authConfiguration');\r\n                case VizPortal.AlertErrorCode.AlertConnectionFailure:\r\n                case VizPortal.AlertErrorCode.AlertRemoteConnectionFailure:\r\n                    return this.props.translate('connectionFailure');\r\n                case VizPortal.AlertErrorCode.AlertOverlappingSchedules:\r\n                    return this.props.translate('overlappingSchedules');\r\n                case VizPortal.AlertErrorCode.AlertFullRefreshRequired:\r\n                    return this.props.translate('fullRefreshRequired');\r\n                case VizPortal.AlertErrorCode.AlertConnectionlessFailure:\r\n                    return this.props.translate('connectionlessFailure');\r\n                default:\r\n                    // AlertErrorCode.AlertUnknownFailure or AlertErrorCode.AlertRemoteUnknownFailure\r\n                    return this.props.translate('unknownFailure');\r\n            }\r\n        };\r\n        AlertsMenuItem.prototype.dateTimeOrNever = function (date) {\r\n            return date ? VizPortal.L10n.localizedDateTime(date) : this.props.translate('never');\r\n        };\r\n        AlertsMenuItem.prototype.tryAgainLink = function () {\r\n            var _this = this;\r\n            if (this.isRemoteRefresh()) {\r\n                return null;\r\n            }\r\n            return React.DOM.tr({}, React.DOM.td({ colSpan: 2 }, React.DOM.a({\r\n                onClick: function () {\r\n                    _this.props.alertActions.tryAgain(_this.props.alert);\r\n                    _this.props.itemSelected();\r\n                }\r\n            }, this.props.translate('tryAgain'))));\r\n        };\r\n        AlertsMenuItem.prototype.connectionDetailsLink = function () {\r\n            var _this = this;\r\n            if (!this.isEditableFailure()) {\r\n                return null;\r\n            }\r\n            if (!this.props.alert.datasource && this.props.alert.workbooks.length === 0) {\r\n                return null;\r\n            }\r\n            return React.DOM.tr({}, React.DOM.td({ colSpan: 2 }, React.DOM.a({\r\n                href: this.props.alert.datasource\r\n                    ? this.props.siteUrls.datasourceDataConnectionUrl(this.props.alert.datasource.id)\r\n                    : this.props.siteUrls.workbookDatasourcesUrl(this.props.alert.workbooks[0].id),\r\n                style: {\r\n                    float: 'right',\r\n                    marginRight: VizPortalReact.CommonStyles.Sizes.DefaultSpace,\r\n                    color: VizPortalReact.CommonStyles.Colors.ActionOrange\r\n                },\r\n                onClick: function () { return _this.props.itemSelected(); }\r\n            }, this.props.translate('connectionDetails'))));\r\n        };\r\n        AlertsMenuItem.prototype.isEditableFailure = function () {\r\n            return this.props.alert.statusCode !== VizPortal.AlertErrorCode.AlertOverlappingSchedules;\r\n        };\r\n        AlertsMenuItem.prototype.isRemoteRefresh = function () {\r\n            return _.contains(AlertsMenuItem.remoteRefreshStatusCodes, this.props.alert.statusCode);\r\n        };\r\n        AlertsMenuItem.displayName = 'AlertsMenuItem';\r\n        AlertsMenuItem.element = React.createFactory(AlertsMenuItem);\r\n        AlertsMenuItem.remoteRefreshStatusCodes = [\r\n            VizPortal.AlertErrorCode.AlertRemoteUnknownFailure,\r\n            VizPortal.AlertErrorCode.AlertRemoteSignInFailed,\r\n            VizPortal.AlertErrorCode.AlertRemoteExpiredPassword,\r\n            VizPortal.AlertErrorCode.AlertRemoteConnectionFailure,\r\n        ];\r\n        AlertsMenuItem.labelStyle = {\r\n            whiteSpace: 'nowrap',\r\n            paddingTop: VizPortalReact.CommonStyles.Sizes.SmallSpace,\r\n            paddingBottom: VizPortalReact.CommonStyles.Sizes.SmallSpace,\r\n            paddingRight: VizPortalReact.CommonStyles.Sizes.DefaultSpace\r\n        };\r\n        return AlertsMenuItem;\r\n    })(React.Component);\r\n    VizPortalReact.AlertsMenuItem = AlertsMenuItem;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/AlertsStore.ts\" />\r\n/// <reference path=\"../../common/react/IReactTranslateService.ts\" />\r\n/// <reference path=\"../../common/react/components/Menu.ts\" />\r\n/// <reference path=\"./AlertsMenuPanel.ts\" />\r\n/// <reference path=\"./HeaderMenuButton.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var AlertsMenu = (function (_super) {\r\n        __extends(AlertsMenu, _super);\r\n        function AlertsMenu(props) {\r\n            _super.call(this, props);\r\n            this.state = {\r\n                alertCount: undefined\r\n            };\r\n            this.boundOnAlertsStoreChange = this.onAlertsStoreChange.bind(this);\r\n        }\r\n        AlertsMenu.prototype.componentDidMount = function () {\r\n            this.props.alertsStore.addChangeListener(this.boundOnAlertsStoreChange);\r\n            this.getAlertCount();\r\n        };\r\n        AlertsMenu.prototype.componentWillUnmount = function () {\r\n            this.props.alertsStore.removeChangeListener(this.boundOnAlertsStoreChange);\r\n        };\r\n        AlertsMenu.prototype.onAlertsStoreChange = function () {\r\n            this.setState({ alertCount: this.props.alertsStore.getCount() });\r\n        };\r\n        AlertsMenu.prototype.getAlertCount = function () {\r\n            this.props.alertActions.getAlertCount();\r\n        };\r\n        AlertsMenu.prototype.render = function () {\r\n            var _this = this;\r\n            return VizPortalReact.Menu.element({\r\n                ref: \"menu\",\r\n                tbTestId: 'alerts-menu',\r\n                style: this.props.style,\r\n                menuButtonFactory: function (props) {\r\n                    var alertCount = _this.state.alertCount;\r\n                    props.iconUrl = 'url(img/alert_header_icon.png)';\r\n                    props.label = _.isNumber(alertCount) && alertCount > 0 ? alertCount.toString() : '';\r\n                    props.style = {\r\n                        fontSize: VizPortalReact.HeaderStyles.AlertsCountFontSize\r\n                    };\r\n                    return VizPortalReact.HeaderMenuButton.element(props);\r\n                },\r\n                menuPanelFactory: function (props) {\r\n                    props.translate = _this.props.translate;\r\n                    props.itemSelected = function () {\r\n                        _this.refs['menu'].closeMenu();\r\n                    };\r\n                    props.alertActions = _this.props.alertActions;\r\n                    props.alertsStore = _this.props.alertsStore;\r\n                    props.siteUrls = _this.props.siteUrls;\r\n                    return VizPortalReact.AlertsMenuPanel.element(props);\r\n                }\r\n            });\r\n        };\r\n        AlertsMenu.displayName = 'AlertsMenu';\r\n        AlertsMenu.element = React.createFactory(AlertsMenu);\r\n        return AlertsMenu;\r\n    })(React.Component);\r\n    VizPortalReact.AlertsMenu = AlertsMenu;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/CommonStyles.ts\" />\r\n/// <reference path=\"../../common/react/IReactTranslateService.ts\" />\r\n/// <reference path=\"../../common/react/components/FilteringListBox.ts\" />\r\n/// <reference path=\"HeaderStyles.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var HelpMenuPanel = (function (_super) {\r\n        __extends(HelpMenuPanel, _super);\r\n        function HelpMenuPanel(props) {\r\n            var _this = this;\r\n            _super.call(this, props);\r\n            this.boundItemSelected = function () { return _this.props.itemSelected(); };\r\n            this.boundShowAbout = function () {\r\n                _this.props.helpActions.showAbout();\r\n                _this.props.itemSelected();\r\n            };\r\n            this.boundShowGettingStarted = function () {\r\n                _this.props.helpActions.showGettingStarted();\r\n                _this.props.itemSelected();\r\n            };\r\n        }\r\n        HelpMenuPanel.prototype.render = function () {\r\n            return React.DOM.div({ style: HelpMenuPanel.helpMenuContainerStyle }, this.renderSearchBox(), this.renderMenuItems());\r\n        };\r\n        HelpMenuPanel.prototype.renderSearchBox = function () {\r\n            var _this = this;\r\n            return React.DOM.input({\r\n                ref: 'searchBox',\r\n                style: {\r\n                    width: '100%',\r\n                    boxSizing: 'border-box',\r\n                    height: VizPortalReact.CommonStyles.Sizes.RowHeight,\r\n                    fontFamily: VizPortalReact.CommonStyles.Fonts.BodyFont,\r\n                    fontSize: VizPortalReact.CommonStyles.Sizes.SmallFontSize,\r\n                    border: '1px solid ' + VizPortalReact.CommonStyles.Colors.Grey178,\r\n                    color: VizPortalReact.CommonStyles.Colors.GreyTextColor,\r\n                    backgroundImage: 'url(img/magnifying_glass_small_normal.png)',\r\n                    backgroundPosition: 'left center',\r\n                    backgroundRepeat: 'no-repeat',\r\n                    paddingLeft: 23,\r\n                    outline: 'none'\r\n                },\r\n                placeholder: this.props.translate('searchHelp'),\r\n                onKeyDown: function (event) {\r\n                    if (event.keyCode === VizPortal.Keys.Enter) {\r\n                        var searchBox = $(React.findDOMNode(_this.refs['searchBox']));\r\n                        var searchTerm = searchBox.val();\r\n                        searchBox.val('');\r\n                        _this.props.itemSelected();\r\n                        _this.props.helpActions.searchHelp(searchTerm);\r\n                    }\r\n                }\r\n            });\r\n        };\r\n        HelpMenuPanel.prototype.renderMenuItems = function () {\r\n            var menuItems = [\r\n                VizPortalReact.HeaderMenuItem.element({\r\n                    key: 'help',\r\n                    label: this.props.serverHelpLabel,\r\n                    url: this.props.serverHelpUrl,\r\n                    target: '_blank',\r\n                    onClick: this.boundItemSelected\r\n                })\r\n            ];\r\n            if (!this.props.isOfflineHelpEnabled) {\r\n                menuItems.push(VizPortalReact.HeaderMenuItem.element({\r\n                    key: 'support',\r\n                    label: this.props.translate('support'),\r\n                    url: this.props.supportUrl,\r\n                    target: '_blank',\r\n                    onClick: this.boundItemSelected\r\n                }));\r\n            }\r\n            if (this.props.showGettingStartedLink) {\r\n                menuItems.push(VizPortalReact.HeaderMenuItem.element({\r\n                    key: 'welcomeScreen',\r\n                    label: this.props.translate('welcomeScreen'),\r\n                    onClick: this.boundShowGettingStarted\r\n                }));\r\n            }\r\n            menuItems.push(VizPortalReact.HeaderMenuItem.element({\r\n                key: 'aboutServer',\r\n                label: this.props.translate('aboutServer', { SERVER_NAME: this.props.serverName }),\r\n                onClick: this.boundShowAbout\r\n            }));\r\n            return menuItems;\r\n        };\r\n        HelpMenuPanel.displayName = 'HelpMenuPanel';\r\n        HelpMenuPanel.element = React.createFactory(HelpMenuPanel);\r\n        HelpMenuPanel.helpMenuContainerStyle = _.extend({}, VizPortalReact.HeaderStyles.MenuPanelStyle, {\r\n            height: 'auto',\r\n            padding: VizPortalReact.CommonStyles.Sizes.SmallSpace\r\n        });\r\n        return HelpMenuPanel;\r\n    })(React.Component);\r\n    VizPortalReact.HelpMenuPanel = HelpMenuPanel;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/IReactTranslateService.ts\" />\r\n/// <reference path=\"../../common/react/components/FilteringListBox.ts\" />\r\n/// <reference path=\"../../common/react/components/Menu.ts\" />\r\n/// <reference path=\"./HeaderMenuButton.ts\" />\r\n/// <reference path=\"./HelpMenuPanel.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var HelpMenu = (function (_super) {\r\n        __extends(HelpMenu, _super);\r\n        function HelpMenu() {\r\n            _super.apply(this, arguments);\r\n        }\r\n        HelpMenu.prototype.render = function () {\r\n            var _this = this;\r\n            return VizPortalReact.Menu.element({\r\n                ref: \"menu\",\r\n                tbTestId: 'help-menu',\r\n                style: this.props.style,\r\n                menuButtonFactory: function (props) {\r\n                    props.iconUrl = 'url(img/help_header_icon.png)';\r\n                    return VizPortalReact.HeaderMenuButton.element(props);\r\n                },\r\n                menuPanelFactory: function (helpMenuPanelProps) {\r\n                    helpMenuPanelProps.itemSelected = function () {\r\n                        _this.refs['menu'].closeMenu();\r\n                    };\r\n                    // Copy properties from HelpMenu to HelpMenuPanel\r\n                    _.extend(helpMenuPanelProps, _this.props);\r\n                    return VizPortalReact.HelpMenuPanel.element(helpMenuPanelProps);\r\n                }\r\n            });\r\n        };\r\n        HelpMenu.displayName = 'HelpMenu';\r\n        HelpMenu.element = React.createFactory(HelpMenu);\r\n        return HelpMenu;\r\n    })(React.Component);\r\n    VizPortalReact.HelpMenu = HelpMenu;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/CommonStyles.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var HeaderSearchBox = (function (_super) {\r\n        __extends(HeaderSearchBox, _super);\r\n        function HeaderSearchBox() {\r\n            var _this = this;\r\n            _super.apply(this, arguments);\r\n            this.state = {\r\n                hovered: false,\r\n                open: false\r\n            };\r\n            this.boundBlur = function () { return _this.handleBlur(); };\r\n            this.boundClick = function () { return _this.handleClick(); };\r\n            this.boundMouseEnter = function () { return _this.setState({ hovered: true }); };\r\n            this.boundMouseLeave = function () { return _this.setState({ hovered: false }); };\r\n        }\r\n        HeaderSearchBox.prototype.handleClick = function () {\r\n            this.setState({ open: true }, function () {\r\n                setTimeout(function () {\r\n                    $('input[name=\"omniboxTextBox\"]').focus();\r\n                }, 0);\r\n            });\r\n        };\r\n        HeaderSearchBox.prototype.handleBlur = function () {\r\n            this.setState({ hovered: false, open: false });\r\n        };\r\n        HeaderSearchBox.prototype.render = function () {\r\n            return React.DOM.div({\r\n                onMouseEnter: this.boundMouseEnter,\r\n                onMouseLeave: this.boundMouseLeave\r\n            }, this.contents());\r\n        };\r\n        HeaderSearchBox.prototype.contents = function () {\r\n            if (this.state.open) {\r\n                // show angular search box\r\n                var content = VizPortalReact.AngularDirective.element({\r\n                    angularContext: this.props.angularContext,\r\n                    template: \"<tb:omnibox ng-show='showSiteControls()'></tb:omnibox>\"\r\n                });\r\n                return React.DOM.div({\r\n                    ref: 'omniboxSearchOpen',\r\n                    style: {\r\n                        paddingRight: '12px',\r\n                        width: '350px' // matches $omniboxPopupWidth in omnibox.styl\r\n                    },\r\n                    onBlur: this.boundBlur\r\n                }, content);\r\n            }\r\n            else {\r\n                // searchbox closed, show magnifying glass.\r\n                return React.DOM.span({\r\n                    ref: 'omniboxSearchClosed',\r\n                    style: {\r\n                        backgroundImage: 'url(img/magnifying_glass_large_white_normal.png)',\r\n                        backgroundPosition: 'left center',\r\n                        backgroundRepeat: 'no-repeat',\r\n                        cursor: 'pointer',\r\n                        opacity: this.state.hovered ? VizPortalReact.HeaderStyles.HoverOpacity : VizPortalReact.HeaderStyles.RestOpacity,\r\n                        padding: '12px 24px 12px 12px'\r\n                    },\r\n                    onClick: this.boundClick\r\n                });\r\n            }\r\n        };\r\n        HeaderSearchBox.displayName = 'HeaderSearchBox';\r\n        HeaderSearchBox.element = React.createFactory(HeaderSearchBox);\r\n        return HeaderSearchBox;\r\n    })(React.Component);\r\n    VizPortalReact.HeaderSearchBox = HeaderSearchBox;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/CommonStyles.ts\" />\r\n/// <reference path=\"../SiteUrls.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var Logo = (function (_super) {\r\n        __extends(Logo, _super);\r\n        function Logo() {\r\n            _super.apply(this, arguments);\r\n        }\r\n        Logo.prototype.render = function () {\r\n            var logo = this.props.logo;\r\n            return React.DOM.a({\r\n                href: logo.href || this.props.siteUrls.projectsUrl(),\r\n                'data-tb-test-id': 'top-bar-logo-link',\r\n                tabIndex: -1,\r\n                style: {\r\n                    width: logo.width,\r\n                    height: logo.height,\r\n                    backgroundImage: 'url(' + logo.image + ')',\r\n                    display: 'inline-block',\r\n                    marginLeft: 18,\r\n                    marginRight: 35,\r\n                    marginTop: 9,\r\n                    marginBottom: 9,\r\n                    // This is used with the ' ' text content to prevent a strange issue with\r\n                    // links with no text content. Without text content, the logo was somehow expanding\r\n                    // the containing div height by 3px.\r\n                    whiteSpace: 'pre'\r\n                },\r\n                title: logo.title\r\n            }, ' ');\r\n        };\r\n        Logo.displayName = 'Logo';\r\n        Logo.element = React.createFactory(Logo);\r\n        return Logo;\r\n    })(React.Component);\r\n    VizPortalReact.Logo = Logo;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/CommonStyles.ts\" />\r\n/// <reference path=\"HeaderStyles.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var HeaderMenuItem = (function (_super) {\r\n        __extends(HeaderMenuItem, _super);\r\n        function HeaderMenuItem(props) {\r\n            var _this = this;\r\n            _super.call(this, props);\r\n            this.state = {\r\n                hovered: false\r\n            };\r\n            this.boundMouseEnter = function () { return _this.setState({ hovered: true }); };\r\n            this.boundMouseLeave = function () { return _this.setState({ hovered: false }); };\r\n        }\r\n        HeaderMenuItem.prototype.render = function () {\r\n            var style = _.extend({}, HeaderMenuItem.linkStyle, {\r\n                color: this.props.isDisabled ? VizPortalReact.CommonStyles.Colors.Grey224 : VizPortalReact.CommonStyles.Colors.Grey102,\r\n                backgroundColor: this.state.hovered && !this.props.isDisabled ? VizPortalReact.CommonStyles.Colors.Grey245 : 'inherit'\r\n            });\r\n            return React.DOM.a({\r\n                href: this.props.url,\r\n                title: this.props.title,\r\n                target: this.props.target,\r\n                style: style,\r\n                onClick: this.props.onClick,\r\n                onMouseEnter: this.boundMouseEnter,\r\n                onMouseLeave: this.boundMouseLeave\r\n            }, this.props.label);\r\n        };\r\n        HeaderMenuItem.displayName = 'HeaderMenuItem';\r\n        HeaderMenuItem.element = React.createFactory(HeaderMenuItem);\r\n        HeaderMenuItem.linkStyle = {\r\n            display: 'block',\r\n            padding: VizPortalReact.CommonStyles.Sizes.DefaultSpace,\r\n            textDecoration: 'none',\r\n            color: VizPortalReact.CommonStyles.Colors.Grey102\r\n        };\r\n        return HeaderMenuItem;\r\n    })(React.Component);\r\n    VizPortalReact.HeaderMenuItem = HeaderMenuItem;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/CommonStyles.ts\" />\r\n/// <reference path=\"../../common/react/IReactTranslateService.ts\" />\r\n/// <reference path=\"HeaderMenuItem.ts\" />\r\n/// <reference path=\"HeaderStyles.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var UserMenuPanel = (function (_super) {\r\n        __extends(UserMenuPanel, _super);\r\n        function UserMenuPanel(props) {\r\n            var _this = this;\r\n            _super.call(this, props);\r\n            this.boundItemSelected = function () { return _this.props.itemSelected(); };\r\n            this.boundSignout = function () {\r\n                _this.props.userActions.signout();\r\n                _this.props.itemSelected();\r\n            };\r\n            this.boundChangeUserStartPage = function () {\r\n                _this.props.userActions.changeUserStartPage();\r\n                _this.props.itemSelected();\r\n            };\r\n            this.boundChangeDefaultStartPage = function () {\r\n                _this.props.userActions.changeDefaultStartPage();\r\n                _this.props.itemSelected();\r\n            };\r\n        }\r\n        UserMenuPanel.prototype.render = function () {\r\n            var menuItems = [];\r\n            var inServerArea = this.props.isSessionMultiSite && VizPortalReact.Navigation.isServerLocation(this.props.location);\r\n            if (inServerArea) {\r\n                menuItems.push(VizPortalReact.HeaderMenuItem.element({\r\n                    key: 'myContentSiteOnly',\r\n                    label: this.props.translate('myContentSiteOnly'),\r\n                    isDisabled: true\r\n                }));\r\n                menuItems.push(VizPortalReact.HeaderMenuItem.element({\r\n                    key: 'myAccountSettingsServer',\r\n                    label: this.props.translate('myAccountSettingsServer'),\r\n                    url: this.props.serverUrls.userSettingsUrl(this.props.user),\r\n                    onClick: this.boundItemSelected\r\n                }));\r\n            }\r\n            else {\r\n                menuItems.push(VizPortalReact.HeaderMenuItem.element({\r\n                    key: 'myContent',\r\n                    label: this.props.translate('myContent'),\r\n                    url: this.props.siteUrls.userContentUrl(this.props.user),\r\n                    onClick: this.boundItemSelected\r\n                }));\r\n                menuItems.push(VizPortalReact.HeaderMenuItem.element({\r\n                    key: 'myAccountSettings',\r\n                    label: this.props.translate('myAccountSettings'),\r\n                    url: this.props.siteUrls.userSettingsUrl(this.props.user),\r\n                    onClick: this.boundItemSelected\r\n                }));\r\n            }\r\n            // Change start page\r\n            menuItems.push(VizPortalReact.HeaderMenuItem.element({\r\n                key: 'userStartPageChange',\r\n                label: this.props.translate('userStartPageChange'),\r\n                onClick: this.boundChangeUserStartPage\r\n            }));\r\n            // Change all users start page\r\n            if (this.props.isSessionServerAdmin) {\r\n                var isContentPage = this.props.location === VizPortalReact.Navigation.Location.SiteContent;\r\n                menuItems.push(VizPortalReact.HeaderMenuItem.element({\r\n                    key: 'defaultStartPageChange',\r\n                    isDisabled: !isContentPage,\r\n                    title: isContentPage ? '' : this.props.translate('defaultStartPageRestriction'),\r\n                    label: this.props.translate('defaultStartPageChange'),\r\n                    onClick: this.boundChangeDefaultStartPage\r\n                }));\r\n            }\r\n            // Logout\r\n            if (this.props.isLogoutEnabled) {\r\n                var switchUser = this.props.authenticationType === VizPortal.ServerApi.AuthenticationType.Sspi ||\r\n                    this.props.authenticationType === VizPortal.ServerApi.AuthenticationType.Kerberos;\r\n                menuItems.push(VizPortalReact.HeaderMenuItem.element({\r\n                    key: 'signOut',\r\n                    label: switchUser ? this.props.translate('switchUser') : this.props.translate('signOut'),\r\n                    onClick: this.boundSignout\r\n                }));\r\n            }\r\n            return React.DOM.div({ style: UserMenuPanel.userMenuContainerStyle }, menuItems);\r\n        };\r\n        UserMenuPanel.displayName = 'UserMenuPanel';\r\n        UserMenuPanel.element = React.createFactory(UserMenuPanel);\r\n        UserMenuPanel.userMenuContainerStyle = _.extend({}, VizPortalReact.HeaderStyles.MenuPanelStyle, {\r\n            height: 'auto',\r\n            padding: VizPortalReact.CommonStyles.Sizes.SmallSpace\r\n        });\r\n        return UserMenuPanel;\r\n    })(React.Component);\r\n    VizPortalReact.UserMenuPanel = UserMenuPanel;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/IReactTranslateService.ts\" />\r\n/// <reference path=\"../../common/react/components/Menu.ts\" />\r\n/// <reference path=\"./HeaderMenuButton.ts\" />\r\n/// <reference path=\"./UserMenuPanel.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var UserMenu = (function (_super) {\r\n        __extends(UserMenu, _super);\r\n        function UserMenu() {\r\n            _super.apply(this, arguments);\r\n        }\r\n        UserMenu.prototype.render = function () {\r\n            var _this = this;\r\n            return VizPortalReact.Menu.element({\r\n                ref: \"menu\",\r\n                tbTestId: 'user-menu',\r\n                style: this.props.style,\r\n                menuButtonFactory: function (props) {\r\n                    props.label = _this.props.user.displayName;\r\n                    props.iconUrl = 'url(img/dropdown_arrow_header_icon.png)';\r\n                    // Override the default styles to place the dropdown arrow to the right of the label\r\n                    props.style = {\r\n                        paddingLeft: 0,\r\n                        paddingRight: VizPortalReact.CommonStyles.Sizes.NormalIconSize,\r\n                        backgroundPosition: 'right center'\r\n                    };\r\n                    return VizPortalReact.HeaderMenuButton.element(props);\r\n                },\r\n                menuPanelFactory: function (props) {\r\n                    props.translate = _this.props.translate;\r\n                    props.itemSelected = function () {\r\n                        _this.refs['menu'].closeMenu();\r\n                    };\r\n                    props.siteUrls = _this.props.siteUrls;\r\n                    props.serverUrls = _this.props.serverUrls;\r\n                    props.user = _this.props.user;\r\n                    props.userActions = _this.props.userActions;\r\n                    props.location = _this.props.location;\r\n                    props.isLogoutEnabled = _this.props.isLogoutEnabled;\r\n                    props.isSessionMultiSite = _this.props.isSessionMultiSite;\r\n                    props.isSessionServerAdmin = _this.props.isSessionServerAdmin;\r\n                    props.authenticationType = _this.props.authenticationType;\r\n                    return VizPortalReact.UserMenuPanel.element(props);\r\n                }\r\n            });\r\n        };\r\n        UserMenu.displayName = 'UserMenu';\r\n        UserMenu.element = React.createFactory(UserMenu);\r\n        return UserMenu;\r\n    })(React.Component);\r\n    VizPortalReact.UserMenu = UserMenu;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var UserActions = (function () {\r\n        function UserActions(serverService, userSettingsActions) {\r\n            this.serverService = serverService;\r\n            this.userSettingsActions = userSettingsActions;\r\n        }\r\n        UserActions.prototype.signout = function () {\r\n            this.serverService.signOut();\r\n        };\r\n        UserActions.prototype.changeUserStartPage = function () {\r\n            this.userSettingsActions.confirmChangeUserStartPage();\r\n        };\r\n        UserActions.prototype.changeDefaultStartPage = function () {\r\n            this.userSettingsActions.confirmChangeDefaultStartPage();\r\n        };\r\n        return UserActions;\r\n    })();\r\n    VizPortalReact.UserActions = UserActions;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"AlertsMenu.ts\" />\r\n/// <reference path=\"HelpMenu.ts\" />\r\n/// <reference path=\"FavoritesMenu.ts\" />\r\n/// <reference path=\"HeaderSearchBox.ts\" />\r\n/// <reference path=\"Logo.ts\" />\r\n/// <reference path=\"Navigation.ts\" />\r\n/// <reference path=\"UserMenu.ts\" />\r\n/// <reference path=\"../../common/react/AlertActions.ts\" />\r\n/// <reference path=\"../../common/react/HelpActions.ts\" />\r\n/// <reference path=\"../../common/react/UserActions.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var TopBar = (function (_super) {\r\n        __extends(TopBar, _super);\r\n        function TopBar() {\r\n            _super.apply(this, arguments);\r\n            this.state = {};\r\n        }\r\n        TopBar.prototype.render = function () {\r\n            if (!VizPortal.FeatureFlags.reactTopBar) {\r\n                // Just render a blank div.\r\n                // This is necessary because tbIfFeatureFlag still links the child directives, causing\r\n                // TopBar to render, even if the feature flag is off.\r\n                return React.DOM.div({});\r\n            }\r\n            return React.DOM.div({\r\n                style: {\r\n                    backgroundColor: VizPortalReact.HeaderStyles.HeaderBackgroundColor\r\n                }\r\n            }, this.logo(), React.DOM.div({\r\n                style: {\r\n                    position: 'absolute',\r\n                    top: 0,\r\n                    left: this.props.logo.width + 48,\r\n                    right: 0\r\n                }\r\n            }, React.DOM.div({\r\n                style: {\r\n                    display: 'table',\r\n                    width: '100%',\r\n                    whiteSpace: 'nowrap',\r\n                    fontSize: VizPortalReact.CommonStyles.Sizes.HeaderFontSize\r\n                }\r\n            }, React.DOM.div({ style: { display: 'table-row' } }, this.siteSwitcher(), this.navigation(), this.onServerPage() ? null : this.searchBox(), this.menus()))));\r\n        };\r\n        TopBar.prototype.onServerPage = function () {\r\n            return VizPortalReact.Navigation.isServerLocation(this.props.navLocation);\r\n        };\r\n        TopBar.prototype.logo = function () {\r\n            return VizPortalReact.Logo.element({\r\n                siteUrls: this.props.siteUrls,\r\n                logo: this.props.logo\r\n            });\r\n        };\r\n        TopBar.prototype.tableCell = function (key, content, style) {\r\n            style = _.extend({\r\n                display: 'table-cell',\r\n                verticalAlign: 'middle'\r\n            }, style);\r\n            return React.DOM.div({ key: key, style: style }, content);\r\n        };\r\n        TopBar.prototype.siteSwitcher = function () {\r\n            return this.tableCell('siteSwitcher', VizPortalReact.SiteSwitcher.element({\r\n                siteStore: this.props.siteStore,\r\n                translate: this.props.translate,\r\n                location: this.props.location,\r\n                navLocation: this.props.navLocation,\r\n                currentSite: this.props.currentSite,\r\n                serverUrls: this.props.serverUrls\r\n            }));\r\n        };\r\n        TopBar.prototype.searchBox = function () {\r\n            return this.tableCell('searchBox', VizPortalReact.HeaderSearchBox.element({\r\n                angularContext: this.props.angularContext\r\n            }));\r\n        };\r\n        TopBar.prototype.menus = function () {\r\n            var menus = [];\r\n            if (!this.onServerPage()) {\r\n                menus.push(this.alertsMenu());\r\n                menus.push(this.favoritesMenu());\r\n            }\r\n            menus.push(this.helpMenu());\r\n            menus.push(this.userMenu());\r\n            return this.tableCell('menus', React.DOM.div({}, menus), {\r\n                width: '100%',\r\n                textAlign: 'right'\r\n            });\r\n        };\r\n        TopBar.prototype.alertsMenu = function () {\r\n            return VizPortalReact.AlertsMenu.element({\r\n                key: 'alerts',\r\n                style: TopBar.menuButtonStyle,\r\n                angularContext: this.props.angularContext,\r\n                translate: this.props.translate,\r\n                alertsStore: this.props.alertsStore,\r\n                alertActions: this.props.alertActions,\r\n                siteUrls: this.props.siteUrls\r\n            });\r\n        };\r\n        TopBar.prototype.favoritesMenu = function () {\r\n            return VizPortalReact.FavoritesMenu.element({\r\n                key: 'favorites',\r\n                style: TopBar.menuButtonStyle,\r\n                angularContext: this.props.angularContext,\r\n                favoritesStore: this.props.favoritesStore,\r\n                translate: this.props.translate,\r\n                siteUrls: this.props.siteUrls\r\n            });\r\n        };\r\n        TopBar.prototype.helpMenu = function () {\r\n            return VizPortalReact.HelpMenu.element({\r\n                key: 'help',\r\n                style: TopBar.menuButtonStyle,\r\n                angularContext: this.props.angularContext,\r\n                translate: this.props.translate,\r\n                helpActions: this.props.helpActions,\r\n                isOfflineHelpEnabled: this.props.isOfflineHelpEnabled,\r\n                showGettingStartedLink: this.props.showGettingStartedLink,\r\n                serverHelpLabel: this.props.serverHelpLabel,\r\n                serverHelpUrl: this.props.serverHelpUrl,\r\n                supportUrl: this.props.supportUrl,\r\n                serverName: this.props.serverName\r\n            });\r\n        };\r\n        TopBar.prototype.userMenu = function () {\r\n            return VizPortalReact.UserMenu.element({\r\n                key: 'user',\r\n                style: TopBar.menuButtonStyle,\r\n                angularContext: this.props.angularContext,\r\n                translate: this.props.translate,\r\n                user: this.props.user,\r\n                siteUrls: this.props.siteUrls,\r\n                serverUrls: this.props.serverUrls,\r\n                userActions: this.props.userActions,\r\n                location: this.props.navLocation,\r\n                isLogoutEnabled: this.props.isLogoutEnabled,\r\n                isSessionMultiSite: this.props.isSessionMultiSite,\r\n                isSessionServerAdmin: this.props.isSessionServerAdmin,\r\n                authenticationType: this.props.authenticationType\r\n            });\r\n        };\r\n        TopBar.prototype.navigation = function () {\r\n            return this.tableCell('navigation', VizPortalReact.Navigation.element({\r\n                translate: this.props.translate,\r\n                siteUrls: this.props.siteUrls,\r\n                serverUrls: this.props.serverUrls,\r\n                currentLocation: this.props.navLocation,\r\n                hideRightDivider: this.onServerPage() // The server page doesn't have a search box, so no divider is necessary\r\n            }));\r\n        };\r\n        TopBar.displayName = 'TopBar';\r\n        TopBar.element = React.createFactory(TopBar);\r\n        TopBar.menuButtonStyle = {\r\n            marginRight: 16,\r\n            verticalAlign: 'top'\r\n        };\r\n        return TopBar;\r\n    })(React.Component);\r\n    VizPortalReact.TopBar = TopBar;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/CommonStyles.ts\" />\r\n/// <reference path=\"../../common/react/components/Menu.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var TypeaheadFilterButton = (function (_super) {\r\n        __extends(TypeaheadFilterButton, _super);\r\n        function TypeaheadFilterButton() {\r\n            _super.apply(this, arguments);\r\n        }\r\n        TypeaheadFilterButton.prototype.render = function () {\r\n            var highlight = this.props.hovered || this.props.menuOpen;\r\n            var valueSpan = React.DOM.span({\r\n                style: {\r\n                    overflow: 'hidden',\r\n                    textOverflow: 'ellipsis',\r\n                    whiteSpace: 'nowrap',\r\n                    display: 'block',\r\n                    height: VizPortalReact.CommonStyles.Sizes.LineHeight,\r\n                    paddingTop: VizPortalReact.CommonStyles.Sizes.TextBoxPadding,\r\n                    paddingLeft: VizPortalReact.CommonStyles.Sizes.TextBoxPadding\r\n                }\r\n            }, this.props.buttonTitle);\r\n            return React.DOM.span({\r\n                style: {\r\n                    display: 'inline-block',\r\n                    width: '100%',\r\n                    height: VizPortalReact.CommonStyles.Sizes.RowHeight,\r\n                    backgroundColor: VizPortalReact.CommonStyles.Colors.White,\r\n                    boxSizing: 'border-box',\r\n                    borderWidth: VizPortalReact.CommonStyles.Sizes.TextBoxBorderSize,\r\n                    borderColor: VizPortalReact.CommonStyles.Colors.BorderColor,\r\n                    borderStyle: 'solid'\r\n                }\r\n            }, React.DOM.span({\r\n                style: {\r\n                    float: 'right',\r\n                    display: 'block',\r\n                    width: VizPortalReact.CommonStyles.Sizes.NormalIconSize - VizPortalReact.CommonStyles.Sizes.TextBoxBorderSize,\r\n                    height: '100%',\r\n                    background: 'url(img/dropdown_arrow_normal.png) center center no-repeat',\r\n                    borderLeftWidth: VizPortalReact.CommonStyles.Sizes.TextBoxBorderSize,\r\n                    borderLeftColor: VizPortalReact.CommonStyles.Colors.BorderColor,\r\n                    borderLeftStyle: 'solid'\r\n                }\r\n            }), valueSpan);\r\n        };\r\n        TypeaheadFilterButton.displayName = 'TypeaheadFilterButton';\r\n        TypeaheadFilterButton.element = React.createFactory(TypeaheadFilterButton);\r\n        return TypeaheadFilterButton;\r\n    })(React.Component);\r\n    VizPortalReact.TypeaheadFilterButton = TypeaheadFilterButton;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/CommonStyles.ts\" />\r\n/// <reference path=\"../../common/react/IReactTranslateService.ts\" />\r\n/// <reference path=\"../../common/react/components/FilteringListBox.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var TypeaheadFilterPanel = (function (_super) {\r\n        __extends(TypeaheadFilterPanel, _super);\r\n        function TypeaheadFilterPanel() {\r\n            _super.apply(this, arguments);\r\n        }\r\n        TypeaheadFilterPanel.prototype.render = function () {\r\n            var _this = this;\r\n            var menuPanelStyle = {\r\n                boxSizing: 'border-box',\r\n                height: 308,\r\n                backgroundColor: VizPortalReact.CommonStyles.Colors.White,\r\n                borderWidth: VizPortalReact.CommonStyles.Sizes.LineWidth,\r\n                borderColor: VizPortalReact.CommonStyles.Colors.BorderColor,\r\n                borderStyle: 'solid'\r\n            };\r\n            return React.DOM.div({ style: menuPanelStyle }, VizPortalReact.FilteringListBox.element({\r\n                itemStore: this.props.itemStore,\r\n                searchBoxPlaceholder: this.props.translate('search'),\r\n                matchPrefixesOnly: this.props.matchPrefixesOnly,\r\n                itemSelected: function () { return _this.props.itemSelected(); },\r\n                style: VizPortalReact.CommonStyles.Helpers.Edges(VizPortalReact.CommonStyles.Sizes.SmallSpace)\r\n            }));\r\n        };\r\n        TypeaheadFilterPanel.displayName = 'TypeaheadFilterPanel';\r\n        TypeaheadFilterPanel.element = React.createFactory(TypeaheadFilterPanel);\r\n        return TypeaheadFilterPanel;\r\n    })(React.Component);\r\n    VizPortalReact.TypeaheadFilterPanel = TypeaheadFilterPanel;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"../../common/react/SparseCachedList.ts\" />\r\n/// <reference path=\"../../common/react/IReactTranslateService.ts\" />\r\n/// <reference path=\"../../common/react/components/FilteringListBox.ts\" />\r\n/// <reference path=\"../../common/react/components/Menu.ts\" />\r\n/// <reference path=\"./TypeaheadFilterButton.ts\" />\r\n/// <reference path=\"./TypeaheadFilterPanel.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var TypeaheadFilter = (function (_super) {\r\n        __extends(TypeaheadFilter, _super);\r\n        function TypeaheadFilter() {\r\n            _super.apply(this, arguments);\r\n            this.lastFilter = null;\r\n            this.state = {\r\n                fieldValues: []\r\n            };\r\n        }\r\n        TypeaheadFilter.prototype.render = function () {\r\n            var _this = this;\r\n            return VizPortalReact.Menu.element({\r\n                ref: 'menu',\r\n                tbTestId: ['typeahead-filter', this.props.filter.definition.name].join('-'),\r\n                style: {\r\n                    // The width of the menu button should be equal to the width of the containing filter control\r\n                    width: '100%'\r\n                },\r\n                menuPanelStyle: {\r\n                    // The width of the panel should be equal to the width of the containing filter control\r\n                    width: '100%',\r\n                    // Overlap the top border of the menu panel with the bottom border of the menu button\r\n                    marginTop: -VizPortalReact.CommonStyles.Sizes.TextBoxBorderSize\r\n                },\r\n                menuButtonFactory: function (props) {\r\n                    props.buttonTitle = _this.props.filter.value ? _this.props.filter.value.label : '';\r\n                    return VizPortalReact.TypeaheadFilterButton.element(props);\r\n                },\r\n                menuPanelFactory: function (props) {\r\n                    props.itemStore = {\r\n                        getItems: function (filter, start, end) {\r\n                            if (filter !== _this.lastFilter) {\r\n                                _this.initializeCachedFieldValues(filter);\r\n                            }\r\n                            return _this.cachedFieldValues.getItems(start, end);\r\n                        }\r\n                    };\r\n                    props.translate = _this.props.translate;\r\n                    props.matchPrefixesOnly = _this.props.filter.definition.matchPrefixesOnly;\r\n                    props.itemSelected = function () {\r\n                        _this.refs['menu'].closeMenu();\r\n                    };\r\n                    return VizPortalReact.TypeaheadFilterPanel.element(props);\r\n                },\r\n                onBeforeMenuOpen: function () {\r\n                    _this.resetCachedFieldValues();\r\n                    return Q.when();\r\n                }\r\n            });\r\n        };\r\n        TypeaheadFilter.prototype.resetCachedFieldValues = function () {\r\n            this.initializeCachedFieldValues('');\r\n        };\r\n        TypeaheadFilter.prototype.initializeCachedFieldValues = function (searchTerm) {\r\n            var _this = this;\r\n            var location = window.location.href;\r\n            this.cachedFieldValues = new VizPortalReact.SparseCachedList(this.props.getFieldValueQuery().withMatchText(searchTerm), function (item) {\r\n                return {\r\n                    label: item.label,\r\n                    count: item.count,\r\n                    url: _this.addParameter(location, _this.props.filter.definition.name, item.value)\r\n                };\r\n            });\r\n            this.lastFilter = searchTerm;\r\n        };\r\n        // TODO: this may be useful elsewhere - consider moving to a helper class\r\n        // Adapted from the answer at http://stackoverflow.com/a/7648182\r\n        TypeaheadFilter.prototype.addParameter = function (originalUrl, param, value) {\r\n            // Using a positive lookahead (?=\\=) to find the\r\n            // given parameter, preceded by a ? or &, and followed\r\n            // by a = with a value after than (using a non-greedy selector)\r\n            // and then followed by a & or the end of the string\r\n            var val = new RegExp('(\\\\?|\\\\&)' + param + '=.*?(?=(&|$))'), parts = originalUrl.toString().split('#'), url = parts[0], hash = parts[1], qstring = /\\?.+$/;\r\n            // Check if the parameter exists\r\n            if (val.test(hash)) {\r\n                // if it does, replace it, using the captured group\r\n                // to determine & or ? at the beginning\r\n                return url + '#' + hash.replace(val, '$1' + param + '=' + value);\r\n            }\r\n            else if (qstring.test(hash)) {\r\n                // otherwise, if there is a query string at all\r\n                // add the param to the end of it\r\n                return originalUrl + '&' + param + '=' + value;\r\n            }\r\n            else {\r\n                // if there's no query string, add one\r\n                return originalUrl + '?' + param + '=' + value;\r\n            }\r\n        };\r\n        TypeaheadFilter.displayName = 'TypeaheadFilter';\r\n        TypeaheadFilter.element = React.createFactory(TypeaheadFilter);\r\n        return TypeaheadFilter;\r\n    })(React.Component);\r\n    VizPortalReact.TypeaheadFilter = TypeaheadFilter;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../../ts/libs.ts\" />\r\n/// <reference path=\"../../../ts/helpers/LockStatusHelper.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var PermissionLockStatus = (function (_super) {\r\n        __extends(PermissionLockStatus, _super);\r\n        function PermissionLockStatus() {\r\n            _super.apply(this, arguments);\r\n        }\r\n        PermissionLockStatus.prototype.render = function () {\r\n            var iconClass = 'tb-lock-icon ' + VizPortal.LockStatusHelper.getGrayLockIconClass(this.props.lockState);\r\n            return React.DOM.div({ className: 'tb-section-header-lock-status' }, React.DOM.span({ className: iconClass }), React.DOM.span({ className: 'tb-section-header-lock-text' }, this.props.translate(VizPortal.LockStatusHelper.getSectionHeaderText(this.props.lockState))));\r\n        };\r\n        PermissionLockStatus.displayName = 'PermissionLockStatus';\r\n        PermissionLockStatus.element = React.createFactory(PermissionLockStatus);\r\n        return PermissionLockStatus;\r\n    })(React.Component);\r\n    VizPortalReact.PermissionLockStatus = PermissionLockStatus;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var Normalizer = (function () {\r\n        function Normalizer(values, width, height) {\r\n            this.width = width;\r\n            this.height = height;\r\n            this.n = values.length - 1;\r\n            this.max = _.max(values);\r\n        }\r\n        Normalizer.prototype.y = function (value) {\r\n            // Because SVG's y axis starts with 0 at the top and increases downward, the normalization\r\n            // also inverts the numbers on the axis so lower numbers appear lower on the screen.\r\n            return (this.max === 0) ? this.height : (this.max - value) * this.height / this.max;\r\n        };\r\n        Normalizer.prototype.x = function (i) {\r\n            return (this.n === 0) ? this.width : i * this.width / this.n;\r\n        };\r\n        return Normalizer;\r\n    })();\r\n    var PathBuilder = (function () {\r\n        function PathBuilder(normalize) {\r\n            this.normalize = normalize;\r\n        }\r\n        PathBuilder.prototype.buildMovement = function (name, x, y) {\r\n            return name + x + ',' + y;\r\n        };\r\n        PathBuilder.prototype.buildPath = function (dataPoints) {\r\n            var _this = this;\r\n            return dataPoints.reduce(function (movements, value, i) {\r\n                var moveType = (i === 0) ? 'M' : 'L';\r\n                var x = _this.normalize.x(i);\r\n                var y = _this.normalize.y(value);\r\n                return movements + _this.buildMovement(moveType, x, y);\r\n            }, '');\r\n        };\r\n        return PathBuilder;\r\n    })();\r\n    // Exported for the unit tests\r\n    var OffsetCorrector = (function () {\r\n        function OffsetCorrector(element) {\r\n            this.boundRect = element.getBoundingClientRect();\r\n        }\r\n        OffsetCorrector.prototype.correctHorizontalOffset = function (element) {\r\n            var elementRect = element.getBoundingClientRect();\r\n            var rightOverreach = elementRect.right - (this.boundRect.right - Sparkline.TextBuffer);\r\n            var leftOverreach = (this.boundRect.left + Sparkline.TextBuffer) - elementRect.left;\r\n            var n = 0;\r\n            var totalCorrection = 0;\r\n            if (rightOverreach > 0) {\r\n                totalCorrection -= rightOverreach;\r\n                n++;\r\n            }\r\n            if (leftOverreach > 0) {\r\n                totalCorrection += leftOverreach;\r\n                n++;\r\n            }\r\n            // Average the two corrections\r\n            return n === 0 ? 0 : (totalCorrection / n);\r\n        };\r\n        return OffsetCorrector;\r\n    })();\r\n    VizPortalReact.OffsetCorrector = OffsetCorrector;\r\n    var Sparkline = (function (_super) {\r\n        __extends(Sparkline, _super);\r\n        function Sparkline(props) {\r\n            _super.call(this, props);\r\n            this.state = this.defaultState(props);\r\n        }\r\n        /*\r\n         * Measures each text label and makes sure it will render within the confines of the SVG element.\r\n         * Then, calls setState() to signify to the component that it's ready for a full render\r\n         */\r\n        Sparkline.prototype.measureTextAndSetOffsets = function () {\r\n            var _this = this;\r\n            var offsetCorrector = new OffsetCorrector(React.findDOMNode(this.refs['svg']));\r\n            var labels = this.state.dataPointsToLabel.map(function (label) {\r\n                var textElement = React.findDOMNode(_this.refs[label.key + 'Label']);\r\n                var newLabel = _.clone(label);\r\n                newLabel.xOffset = offsetCorrector.correctHorizontalOffset(textElement);\r\n                return newLabel;\r\n            });\r\n            this.setState({\r\n                dataPointsToLabel: labels,\r\n                readyForFullRender: true\r\n            });\r\n        };\r\n        Sparkline.prototype.defaultState = function (props) {\r\n            return {\r\n                readyForFullRender: false,\r\n                dataPointsToLabel: this.getPointsToLabel(this.props.dataPoints)\r\n            };\r\n        };\r\n        /*\r\n         * When new props are received, the component must clear its state so that the two-pass render\r\n         * can happen in full again.\r\n         */\r\n        Sparkline.prototype.componentWillReceiveProps = function (nextProps) {\r\n            this.setState(this.defaultState(nextProps));\r\n        };\r\n        /*\r\n         * As soon as the component has finished the first pass of the two-pass render,\r\n         * perform the measurements and state change that will trigger the second pass.\r\n         */\r\n        Sparkline.prototype.componentDidMount = function () {\r\n            this.measureTextAndSetOffsets();\r\n        };\r\n        Sparkline.prototype.componentDidUpdate = function () {\r\n            if (!this.state.readyForFullRender) {\r\n                this.measureTextAndSetOffsets();\r\n            }\r\n        };\r\n        /*\r\n         * This component renders itself in two passes. The first time, only the text labels are\r\n         * rendered and the element is hidden. Then, on componentDidMount/compenentDidUpdate, the text\r\n         * elements are measured, and the component computes the appropriate layout parameters to make\r\n         * everything fits. Once this new state is set, the render happens again, this time visibly\r\n         * rendering the entire component with the correct spacing.\r\n         */\r\n        Sparkline.prototype.render = function () {\r\n            var _this = this;\r\n            var fullRender = this.state.readyForFullRender;\r\n            var innerWidth = this.props.width - Sparkline.DefaultPadding.paddingLeft - Sparkline.DefaultPadding.paddingRight;\r\n            var innerHeight = this.props.height - Sparkline.DefaultPadding.paddingTop - Sparkline.DefaultPadding.paddingBottom;\r\n            var svgStyle = _.extend({\r\n                display: 'block',\r\n                backgroundColor: Sparkline.BackgroundColor\r\n            }, Sparkline.DefaultPadding);\r\n            var svgAttrs = {\r\n                ref: 'svg',\r\n                height: innerHeight,\r\n                width: innerWidth,\r\n                style: fullRender ? svgStyle : _.extend(svgStyle, { visibility: 'hidden' }),\r\n                'data-tb-test-id': 'sparkline'\r\n            };\r\n            this.normalize = new Normalizer(this.props.dataPoints, innerWidth, innerHeight);\r\n            var subcomponents = [];\r\n            if (fullRender) {\r\n                subcomponents.push(this.path());\r\n            }\r\n            this.state.dataPointsToLabel.forEach(function (spec) {\r\n                subcomponents.push(_this.labelAtDataPoint(spec));\r\n                if (fullRender) {\r\n                    subcomponents.push(_this.circleAtDataPoint(spec));\r\n                }\r\n            });\r\n            return (_a = React.DOM).svg.apply(_a, [svgAttrs].concat(subcomponents));\r\n            var _a;\r\n        };\r\n        Sparkline.prototype.path = function () {\r\n            var pathBuilder = new PathBuilder(this.normalize);\r\n            return React.DOM.path({\r\n                key: 'path',\r\n                stroke: Sparkline.LineColor,\r\n                strokeWidth: Sparkline.LineWidth,\r\n                fill: 'none',\r\n                d: pathBuilder.buildPath(this.props.dataPoints)\r\n            });\r\n        };\r\n        Sparkline.prototype.circleAtDataPoint = function (spec) {\r\n            var fullName = spec.key + 'Circle';\r\n            return React.DOM.circle(_.extend({\r\n                key: fullName,\r\n                'data-tb-test-id': fullName,\r\n                cx: this.normalize.x(spec.index),\r\n                cy: this.normalize.y(this.props.dataPoints[spec.index])\r\n            }, spec.circleStyle));\r\n        };\r\n        /*\r\n         * Puts a label at data point i, with the data point's value as the circle text.\r\n         * If circleStyle is passed in, it is assumed that a circle exists on that data point with the given style.\r\n         * above denotes the vertical position of the label with respect to the data point:\r\n         *   true puts it above; false puts it below.\r\n         */\r\n        Sparkline.prototype.labelAtDataPoint = function (spec) {\r\n            var labelValue = this.props.dataPoints[spec.index];\r\n            var fullName = spec.key + 'Label';\r\n            var textBuffer = spec.circleStyle.r + spec.circleStyle.strokeWidth + Sparkline.TextBuffer;\r\n            var yOffset = spec.above ? -textBuffer : textBuffer + Sparkline.LabelStyle.fontSize - 1.5;\r\n            return React.DOM.text({\r\n                ref: fullName,\r\n                key: fullName,\r\n                'data-tb-test-id': fullName,\r\n                style: Sparkline.LabelStyle,\r\n                x: this.normalize.x(spec.index),\r\n                y: this.normalize.y(labelValue),\r\n                dy: yOffset,\r\n                dx: spec.xOffset,\r\n                textAnchor: 'middle'\r\n            }, labelValue);\r\n        };\r\n        Sparkline.prototype.getPointsToLabel = function (dataPoints) {\r\n            var minIndex = _.indexOf(dataPoints, _.min(dataPoints));\r\n            var maxIndex = _.indexOf(dataPoints, _.max(dataPoints));\r\n            var endIndex = dataPoints.length - 1;\r\n            var endPointHigher = dataPoints[endIndex] >= dataPoints[endIndex - 1];\r\n            var labelPoints = [];\r\n            labelPoints.push({\r\n                key: 'end',\r\n                index: endIndex,\r\n                circleStyle: Sparkline.CircleStyleEnd,\r\n                above: endPointHigher });\r\n            if (endIndex !== maxIndex) {\r\n                labelPoints.push({\r\n                    key: 'max',\r\n                    index: maxIndex,\r\n                    circleStyle: Sparkline.CircleStyleMax,\r\n                    above: true\r\n                });\r\n            }\r\n            if (endIndex !== minIndex && maxIndex !== minIndex) {\r\n                labelPoints.push({\r\n                    key: 'min',\r\n                    index: minIndex,\r\n                    circleStyle: Sparkline.CircleStyleMin,\r\n                    above: false\r\n                });\r\n            }\r\n            return labelPoints;\r\n        };\r\n        Sparkline.displayName = 'Sparkline';\r\n        Sparkline.element = React.createFactory(Sparkline);\r\n        // Style properties of the sparkline.\r\n        Sparkline.LineWidth = 2;\r\n        Sparkline.LineColor = VizPortalReact.CommonStyles.Colors.Grey153;\r\n        Sparkline.BackgroundColor = VizPortalReact.CommonStyles.Colors.Grey245;\r\n        // The number of pixels by which a text should be separated from other elements\r\n        Sparkline.TextBuffer = 3;\r\n        // The amount of padding from the edge of the SVG to the edges of the path. Circles and text\r\n        // might occupy this space, so the values must be greater than any of the circles' (r + strokeWidth).\r\n        Sparkline.DefaultPadding = {\r\n            paddingTop: 18,\r\n            paddingRight: 12,\r\n            paddingBottom: 18,\r\n            paddingLeft: 12\r\n        };\r\n        Sparkline.CircleStyleEnd = {\r\n            r: 3.5,\r\n            strokeWidth: 0,\r\n            fill: VizPortalReact.CommonStyles.Colors.Grey102\r\n        };\r\n        Sparkline.CircleStyleMax = {\r\n            r: 2.5,\r\n            strokeWidth: 1,\r\n            fill: VizPortalReact.CommonStyles.Colors.White,\r\n            stroke: VizPortalReact.CommonStyles.Colors.Grey102\r\n        };\r\n        Sparkline.CircleStyleMin = {\r\n            r: 2.5,\r\n            strokeWidth: 0,\r\n            fill: VizPortalReact.CommonStyles.Colors.Grey136\r\n        };\r\n        Sparkline.LabelStyle = {\r\n            fontFamily: VizPortalReact.CommonStyles.Fonts.BodyFont,\r\n            fontSize: VizPortalReact.CommonStyles.Sizes.SmallFontSize,\r\n            fill: VizPortalReact.CommonStyles.Colors.GreyTextColor // SVG text color uses the 'fill' attribute\r\n        };\r\n        return Sparkline;\r\n    })(React.Component);\r\n    VizPortalReact.Sparkline = Sparkline;\r\n    var SparklineWithTitle = (function (_super) {\r\n        __extends(SparklineWithTitle, _super);\r\n        function SparklineWithTitle() {\r\n            _super.apply(this, arguments);\r\n        }\r\n        SparklineWithTitle.prototype.render = function () {\r\n            var elements = [Sparkline.element(this.props.sparklineProps)];\r\n            if (this.props.title) {\r\n                var title = React.DOM.div({\r\n                    style: SparklineWithTitle.TitleStyle\r\n                }, this.props.title);\r\n                elements.unshift(title);\r\n            }\r\n            if (this.props.caption) {\r\n                var caption = React.DOM.div({\r\n                    style: SparklineWithTitle.CaptionStyle\r\n                }, this.props.caption);\r\n                elements.push(caption);\r\n            }\r\n            return (_a = React.DOM).div.apply(_a, [{}].concat(elements));\r\n            var _a;\r\n        };\r\n        SparklineWithTitle.displayName = 'SparklineWithTitle';\r\n        SparklineWithTitle.element = React.createFactory(SparklineWithTitle);\r\n        SparklineWithTitle.TitleStyle = {\r\n            fontFamily: VizPortalReact.CommonStyles.Fonts.BodyFont,\r\n            fontSize: VizPortalReact.CommonStyles.Sizes.NormalFontSize,\r\n            color: VizPortalReact.CommonStyles.Colors.NormalTextColor,\r\n            marginBottom: 5,\r\n            textAlign: 'left'\r\n        };\r\n        SparklineWithTitle.CaptionStyle = {\r\n            fontFamily: VizPortalReact.CommonStyles.Fonts.BodyFont,\r\n            fontSize: VizPortalReact.CommonStyles.Sizes.SmallFontSize,\r\n            color: VizPortalReact.CommonStyles.Colors.GreyTextColor,\r\n            marginTop: 6,\r\n            textAlign: 'center'\r\n        };\r\n        return SparklineWithTitle;\r\n    })(React.Component);\r\n    VizPortalReact.SparklineWithTitle = SparklineWithTitle;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../../../ts/libs.ts\" />\r\n/// <reference path=\"../../Dispatcher.ts\" />\r\n/// <reference path=\"../../Store.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var StackedComponentStore = (function (_super) {\r\n        __extends(StackedComponentStore, _super);\r\n        function StackedComponentStore() {\r\n            _super.call(this);\r\n            this.stackedComponents = [];\r\n        }\r\n        StackedComponentStore.instance = function () {\r\n            if (!StackedComponentStore._instance) {\r\n                StackedComponentStore._instance = new StackedComponentStore();\r\n                VizPortalReact.Dispatcher.instance.register(StackedComponentStore._instance.handleAction.bind(StackedComponentStore._instance));\r\n            }\r\n            return StackedComponentStore._instance;\r\n        };\r\n        StackedComponentStore.prototype.handleAction = function (action) {\r\n            switch (action.actionType) {\r\n                case VizPortalReact.AddStackedComponentAction.Type:\r\n                    this.addStackedComponent(action.stackedComponent);\r\n                    break;\r\n                case VizPortalReact.RemoveStackedComponentAction.Type:\r\n                    this.removeStackedComponent(action.stackedComponent);\r\n                    break;\r\n            }\r\n        };\r\n        StackedComponentStore.prototype.getAll = function () {\r\n            return this.stackedComponents;\r\n        };\r\n        StackedComponentStore.prototype.addStackedComponent = function (component) {\r\n            this.stackedComponents = React.addons.update(this.stackedComponents, { $push: [component] });\r\n            this.broadcast(StackedComponentStore.ChangeEvent);\r\n        };\r\n        StackedComponentStore.prototype.removeStackedComponent = function (component) {\r\n            this.stackedComponents = _.without(this.stackedComponents, component);\r\n            this.broadcast(StackedComponentStore.ChangeEvent);\r\n        };\r\n        StackedComponentStore.ChangeEvent = 'stacked-components-changed';\r\n        return StackedComponentStore;\r\n    })(VizPortalReact.Store);\r\n    VizPortalReact.StackedComponentStore = StackedComponentStore;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../../../ts/libs.ts\" />\r\n/// <reference path=\"StackedComponentStore.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var ComponentStacker = (function (_super) {\r\n        __extends(ComponentStacker, _super);\r\n        function ComponentStacker() {\r\n            _super.call(this, {}, {});\r\n            this.state = ComponentStacker.getStackedComponentsState();\r\n        }\r\n        ComponentStacker.getStackedComponentsState = function () {\r\n            return {\r\n                allStackedComponents: VizPortalReact.StackedComponentStore.instance().getAll()\r\n            };\r\n        };\r\n        ComponentStacker.prototype.render = function () {\r\n            return React.DOM.div({}, this.state.allStackedComponents);\r\n        };\r\n        ComponentStacker.prototype.componentDidMount = function () {\r\n            var _this = this;\r\n            VizPortalReact.StackedComponentStore.instance().addChangeListener(function () { return _this.refresh(); });\r\n        };\r\n        ComponentStacker.prototype.componentWillUnmount = function () {\r\n            var _this = this;\r\n            VizPortalReact.StackedComponentStore.instance().removeChangeListener(function () { return _this.refresh(); });\r\n        };\r\n        ComponentStacker.prototype.refresh = function () {\r\n            this.setState(ComponentStacker.getStackedComponentsState());\r\n        };\r\n        ComponentStacker.displayName = 'ComponentStacker';\r\n        ComponentStacker.element = React.createFactory(ComponentStacker);\r\n        return ComponentStacker;\r\n    })(React.Component);\r\n    VizPortalReact.ComponentStacker = ComponentStacker;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../../ts/libs.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var ThumbnailImage = (function (_super) {\r\n        __extends(ThumbnailImage, _super);\r\n        function ThumbnailImage() {\r\n            _super.apply(this, arguments);\r\n        }\r\n        ThumbnailImage.prototype.render = function () {\r\n            return React.DOM.div({\r\n                className: this.props.className,\r\n                style: _.extend({\r\n                    backgroundImage: 'url(' + encodeURI(this.props.url) + ')',\r\n                    backgroundSize: 'cover',\r\n                    backgroundPosition: 'top',\r\n                    backgroundRepeat: 'no-repeat'\r\n                }, this.props.style),\r\n                'data-tb-test-id': this.props.tbTestId\r\n            });\r\n        };\r\n        ThumbnailImage.displayName = 'ThumbnailImage';\r\n        ThumbnailImage.element = React.createFactory(ThumbnailImage);\r\n        return ThumbnailImage;\r\n    })(React.Component);\r\n    VizPortalReact.ThumbnailImage = ThumbnailImage;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../../../ts/libs.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var ActionMenuButton = (function (_super) {\r\n        __extends(ActionMenuButton, _super);\r\n        function ActionMenuButton() {\r\n            _super.call(this, {}, {});\r\n        }\r\n        ActionMenuButton.prototype.render = function () {\r\n            return React.DOM.span({ className: 'tb-action-icon' });\r\n        };\r\n        ActionMenuButton.displayName = 'ActionMenuButton';\r\n        ActionMenuButton.element = React.createFactory(ActionMenuButton);\r\n        return ActionMenuButton;\r\n    })(React.Component);\r\n    VizPortalReact.ActionMenuButton = ActionMenuButton;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../../../ts/libs.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var ActionMenuItem = (function (_super) {\r\n        __extends(ActionMenuItem, _super);\r\n        function ActionMenuItem(props) {\r\n            _super.call(this, props, {});\r\n        }\r\n        ActionMenuItem.prototype.render = function () {\r\n            var _this = this;\r\n            // $todo: tbDisabled also modifies the tabindex property\r\n            var isDisabled = this.props.actionButton.isDisabled &&\r\n                this.props.actionButton.isDisabled(this.props.selectedItems, this.props.detailedItem, this.props.allowedActions);\r\n            var classes = React.addons.classSet({\r\n                'tb-popup-menu-item': true,\r\n                'tb-disabled': isDisabled\r\n            });\r\n            var elm = React.DOM.div({\r\n                className: classes,\r\n                disabled: isDisabled,\r\n                onClick: function () {\r\n                    if (!isDisabled) {\r\n                        _this.props.actionButton.execute(_this.props.selectedItems, { scope: _this.props.contentSubplaceScope }, _this.props.detailedItem);\r\n                    }\r\n                }\r\n            }, \r\n            // $todo: tb-test-id\r\n            // $todo: translate\r\n            this.props.actionButton.translate || this.props.actionButton.name);\r\n            return elm;\r\n        };\r\n        ActionMenuItem.displayName = 'ActionMenuItem';\r\n        ActionMenuItem.element = React.createFactory(ActionMenuItem);\r\n        return ActionMenuItem;\r\n    })(React.Component);\r\n    VizPortalReact.ActionMenuItem = ActionMenuItem;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../../../ts/libs.ts\" />\r\n/// <reference path=\"../../Dispatcher.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    function AddStackedComponentAction(component) {\r\n        var payload = {\r\n            actionType: AddStackedComponentAction.Type,\r\n            stackedComponent: component\r\n        };\r\n        VizPortalReact.Dispatcher.instance.dispatch(payload);\r\n    }\r\n    VizPortalReact.AddStackedComponentAction = AddStackedComponentAction;\r\n    var AddStackedComponentAction;\r\n    (function (AddStackedComponentAction) {\r\n        AddStackedComponentAction.Type = 'add-stacked-component';\r\n    })(AddStackedComponentAction = VizPortalReact.AddStackedComponentAction || (VizPortalReact.AddStackedComponentAction = {}));\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../../../ts/libs.ts\" />\r\n/// <reference path=\"../../Dispatcher.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    function RemoveStackedComponentAction(component) {\r\n        var payload = {\r\n            actionType: RemoveStackedComponentAction.Type,\r\n            stackedComponent: component\r\n        };\r\n        VizPortalReact.Dispatcher.instance.dispatch(payload);\r\n    }\r\n    VizPortalReact.RemoveStackedComponentAction = RemoveStackedComponentAction;\r\n    var RemoveStackedComponentAction;\r\n    (function (RemoveStackedComponentAction) {\r\n        RemoveStackedComponentAction.Type = 'remove-stacked-component';\r\n    })(RemoveStackedComponentAction = VizPortalReact.RemoveStackedComponentAction || (VizPortalReact.RemoveStackedComponentAction = {}));\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var MousedownOutsideDetector;\r\n    (function (MousedownOutsideDetector) {\r\n        function attach(element, getIdFn, downOutsideFn) {\r\n            var doc = $(document);\r\n            var eventNamespace = '.MousedownOutsideDetector' + getIdFn(element);\r\n            var events = 'mousedown' + eventNamespace + ' touchstart' + eventNamespace;\r\n            doc.on(events, function (downEvent) {\r\n                var target = $(downEvent.target);\r\n                if (target.closest(element).length === 0) {\r\n                    downOutsideFn(downEvent);\r\n                }\r\n            });\r\n            return function () { return doc.off(eventNamespace); };\r\n        }\r\n        MousedownOutsideDetector.attach = attach;\r\n    })(MousedownOutsideDetector = VizPortal.MousedownOutsideDetector || (VizPortal.MousedownOutsideDetector = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../../ts/libs.ts\" />\r\n/// <reference path=\"../../../ts/helpers/MousedownOutsideDetector.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var Popup = (function (_super) {\r\n        __extends(Popup, _super);\r\n        function Popup(props) {\r\n            _super.call(this, props);\r\n        }\r\n        Popup.prototype.render = function () {\r\n            var classes = [\r\n                'tb-popup-menu-content',\r\n                'tb-padded-small'\r\n            ];\r\n            return React.DOM.div({\r\n                style: (this.props.width ? { width: this.props.width + 'px' } : {})\r\n            }, React.DOM.div({ className: classes.join(' '), onClick: this.props.closePopupMenu }, this.props.popupContentDescriptor));\r\n        };\r\n        Popup.prototype.componentDidMount = function () {\r\n            var id = '' + Popup.nextId++;\r\n            this.detachMousedownOutsideDetector = VizPortal.MousedownOutsideDetector.attach($(React.findDOMNode(this)), function (element) { return id; }, this.props.mouseDownOutsideFunc);\r\n        };\r\n        Popup.prototype.componentWillUnmount = function () {\r\n            this.detachMousedownOutsideDetector();\r\n        };\r\n        Popup.displayName = 'Popup';\r\n        Popup.element = React.createFactory(Popup);\r\n        Popup.nextId = 1;\r\n        return Popup;\r\n    })(React.Component);\r\n    VizPortalReact.Popup = Popup;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../../ts/libs.ts\" />\r\n/// <reference path=\"stackedComponents/AddStackedComponentAction.ts\" />\r\n/// <reference path=\"stackedComponents/RemoveStackedComponentAction.ts\" />\r\n/// <reference path=\"Popup.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    // ============================================================\r\n    // PopupMenu\r\n    //\r\n    // Allows consumer to specify a child component as the\r\n    // popupmenu's button. Popup content is specified through the\r\n    // props.\r\n    //\r\n    // $todo: example of usage\r\n    // $todo: standardize our comment blocks?\r\n    // ============================================================\r\n    var PopupMenu = (function (_super) {\r\n        __extends(PopupMenu, _super);\r\n        function PopupMenu(props, context) {\r\n            if (context === void 0) { context = {}; }\r\n            _super.call(this, props, context);\r\n            // React routines\r\n            this.state = {\r\n                open: false\r\n            };\r\n            // Other internal members\r\n            this.popupComponent = null;\r\n        }\r\n        PopupMenu.prototype.render = function () {\r\n            var _this = this;\r\n            var classes = ['tb-popup-menu'];\r\n            if (this.state.open) {\r\n                classes.push('tb-selected');\r\n            }\r\n            var elm = React.DOM.div({\r\n                className: classes.join(' '),\r\n                tabIndex: 0,\r\n                onClick: function () { return _this.props.buttonClickHandler(); },\r\n                onKeyDown: function (e) { return _this.onKeyDown(e); },\r\n                ref: \"popupMenu\"\r\n            }, React.DOM.div({ ref: \"menuButton\", onClick: function () { return _this.toggle(); } }, this.props.children // oop up menu contents\r\n            ));\r\n            return elm;\r\n        };\r\n        // Other functions\r\n        PopupMenu.prototype.onKeyDown = function (e) {\r\n            if (this.isDisabled()) {\r\n                return;\r\n            }\r\n            switch (e.which) {\r\n                case VizPortal.Keys.Enter:\r\n                    this.toggle();\r\n                    e.stopPropagation(); // Prevents Enter from closing containing dialog (if any)\r\n                    break;\r\n                case VizPortal.Keys.Space:\r\n                    if (!this.state.open) {\r\n                        this.open();\r\n                    }\r\n                    break;\r\n            }\r\n        };\r\n        PopupMenu.prototype.toggle = function () {\r\n            if (!this.isDisabled()) {\r\n                if (this.state.open) {\r\n                    this.close();\r\n                }\r\n                else {\r\n                    this.open();\r\n                }\r\n            }\r\n        };\r\n        PopupMenu.prototype.open = function () {\r\n            var _this = this;\r\n            var button = $(React.findDOMNode(this.refs['menuButton']));\r\n            var buttonWidth = button.outerWidth();\r\n            var popupProps = {\r\n                popupContentDescriptor: this.props.popupContentDescriptor,\r\n                positionCorner: this.positionCorner(),\r\n                contentCorner: this.contentCorner(),\r\n                width: (this.props.contentMatchButtonWidth ? buttonWidth : null),\r\n                mouseDownOutsideFunc: function (mouseDownEvent) {\r\n                    var target = $(mouseDownEvent.target);\r\n                    if (target.closest(button).length === 0) {\r\n                        _this.close();\r\n                    }\r\n                },\r\n                closePopupMenu: function () {\r\n                    _this.close();\r\n                }\r\n            };\r\n            // render as a stacked component\r\n            this.popupComponent = VizPortalReact.Popup.element(popupProps);\r\n            VizPortalReact.AddStackedComponentAction(this.popupComponent);\r\n            if (this.props.onPopupOpened) {\r\n                this.props.onPopupOpened({\r\n                    closeFn: function () { _this.close(); }\r\n                });\r\n            }\r\n            this.setState({ open: true });\r\n        };\r\n        PopupMenu.prototype.close = function () {\r\n            // remove from stack components\r\n            VizPortalReact.RemoveStackedComponentAction(this.popupComponent);\r\n            if (this.props.onPopupClosed) {\r\n                this.props.onPopupClosed();\r\n            }\r\n            $(React.findDOMNode(this.refs['popupMenu'])).focus();\r\n            this.setState({ open: false });\r\n        };\r\n        PopupMenu.prototype.isDisabled = function () {\r\n            return this.props.isDisabled;\r\n        };\r\n        PopupMenu.prototype.positionCorner = function () {\r\n            switch (this.props.direction) {\r\n                case 'dr':\r\n                default:\r\n                    return 'bl';\r\n                case 'dl':\r\n                    return 'br';\r\n                case 'ur':\r\n                    return 'tl';\r\n                case 'ul':\r\n                    return 'tr';\r\n            }\r\n        };\r\n        PopupMenu.prototype.contentCorner = function () {\r\n            switch (this.props.direction) {\r\n                case 'dr':\r\n                default:\r\n                    return 'tl';\r\n                case 'dl':\r\n                    return 'tr';\r\n                case 'ur':\r\n                    return 'bl';\r\n                case 'ul':\r\n                    return 'br';\r\n            }\r\n        };\r\n        PopupMenu.displayName = 'PopupMenu';\r\n        PopupMenu.element = React.createFactory(PopupMenu);\r\n        return PopupMenu;\r\n    })(React.Component);\r\n    VizPortalReact.PopupMenu = PopupMenu;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../../../ts/libs.ts\" />\r\n/// <reference path=\"ActionMenuButton.ts\" />\r\n/// <reference path=\"ActionMenuItem.ts\" />\r\n/// <reference path=\"../PopupMenu.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var ActionsMenu = (function (_super) {\r\n        __extends(ActionsMenu, _super);\r\n        function ActionsMenu(props) {\r\n            _super.call(this, props, {});\r\n        }\r\n        ActionsMenu.prototype.render = function () {\r\n            var _this = this;\r\n            return React.DOM.div({}, this.props.menuActions.map(function (button) {\r\n                return VizPortalReact.ActionMenuItem.element({\r\n                    actionButton: button,\r\n                    selectedItems: _this.props.selectedItems,\r\n                    actionMenuContext: _this.props.actionMenuContext,\r\n                    detailedItem: _this.props.detailedItem,\r\n                    allowedActions: _this.props.allowedActions,\r\n                    contentSubplaceScope: _this.props.contentSubplaceScope\r\n                });\r\n            }));\r\n        };\r\n        ActionsMenu.displayName = 'ActionsMenu';\r\n        ActionsMenu.element = React.createFactory(ActionsMenu);\r\n        return ActionsMenu;\r\n    })(React.Component);\r\n    VizPortalReact.ActionsMenu = ActionsMenu;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../../ts/libs.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var FavoriteToggle = (function (_super) {\r\n        __extends(FavoriteToggle, _super);\r\n        function FavoriteToggle() {\r\n            _super.apply(this, arguments);\r\n            this.state = {\r\n                favorite: this.props.item.favorite\r\n            };\r\n        }\r\n        FavoriteToggle.prototype.toggle = function () {\r\n            var props = this.props;\r\n            var item = props.item;\r\n            // TODO: stop propagation\r\n            if (this.state.favorite) {\r\n                props.removeFavorite(this.props.item);\r\n            }\r\n            else {\r\n                props.addFavorite(this.props.item);\r\n            }\r\n            this.setState({ favorite: !this.state.favorite });\r\n        };\r\n        FavoriteToggle.prototype.selected = function () {\r\n            return !!this.state.favorite;\r\n        };\r\n        FavoriteToggle.prototype.show = function () {\r\n            return !!this.state.favorite || !!this.props.hover || !!this.props.isTouch;\r\n        };\r\n        FavoriteToggle.prototype.render = function () {\r\n            var classes = ['tb-favorite-button', 'tb-thumbnail-favorite'];\r\n            if (this.state.favorite) {\r\n                classes.push('tb-selected');\r\n            }\r\n            if (!this.show()) {\r\n                classes.push('ng-hide'); // TODO: don't depend on angular classes\r\n            }\r\n            return React.DOM.span({\r\n                className: classes.join(' '),\r\n                onClick: this.toggle,\r\n                tabIndex: 0\r\n            });\r\n        };\r\n        FavoriteToggle.prototype.shouldComponentUpdate = function (nextProps, nextState) {\r\n            return React.addons.PureRenderMixin.shouldComponentUpdate.call(this, nextProps, nextState);\r\n        };\r\n        FavoriteToggle.displayName = 'FavoriteToggle';\r\n        FavoriteToggle.element = React.createFactory(FavoriteToggle);\r\n        return FavoriteToggle;\r\n    })(React.Component);\r\n    VizPortalReact.FavoriteToggle = FavoriteToggle;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../../ts/libs.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    /**\r\n    * This is a react component that is used to instantiate angular directives. The purpose of this component is to\r\n    * allow angular directives to be ported to React one at a time.\r\n    */\r\n    var AngularDirective = (function (_super) {\r\n        __extends(AngularDirective, _super);\r\n        function AngularDirective(props, context) {\r\n            _super.call(this, props, context);\r\n        }\r\n        AngularDirective.prototype.componentDidMount = function () {\r\n            this.updateFromProps();\r\n        };\r\n        AngularDirective.prototype.componentDidUpdate = function (prevProps) {\r\n            this.updateFromProps(prevProps);\r\n        };\r\n        AngularDirective.prototype.render = function () {\r\n            return this.props.children || React.DOM.span({});\r\n        };\r\n        AngularDirective.prototype.componentWillUnmount = function () {\r\n            // If we don't remove the element we created using JQuery remove,\r\n            // then we'll leak some memory when React removes it.\r\n            var element = $(React.findDOMNode(this));\r\n            element.remove();\r\n        };\r\n        /**\r\n        * updates the DOM element based on the value of current props. Uses prevProps to determine if the things that have changed\r\n        * require angular compilation of the element or just a digest cycle.\r\n        */\r\n        AngularDirective.prototype.updateFromProps = function (prevProps) {\r\n            if (prevProps === void 0) { prevProps = {}; }\r\n            var shouldCompile = false;\r\n            var currentProps = this.props;\r\n            var element = $(React.findDOMNode(this));\r\n            var attrs = currentProps.attributes || {};\r\n            _.each(attrs, function (value, key) {\r\n                if (!prevProps.attributes || !prevProps.attributes[key]) {\r\n                    // if we haven't seen this attribute directive before, it will need to be compiled\r\n                    shouldCompile = true;\r\n                }\r\n                element.attr(key, value);\r\n            });\r\n            // any attributes that have been removed should be removed from the element\r\n            var attributesToRemove = _.difference(_.keys(prevProps.attributes), _.keys(currentProps.attributes));\r\n            attributesToRemove.map(function (key) {\r\n                element.removeAttr(key);\r\n            });\r\n            if (currentProps.template && currentProps.template !== prevProps.template) {\r\n                // template was updated or is new\r\n                shouldCompile = true;\r\n                element.empty();\r\n                element.append(currentProps.template);\r\n            }\r\n            else if (prevProps.template && !currentProps.template) {\r\n                // template was removed\r\n                element.empty();\r\n            }\r\n            if (shouldCompile) {\r\n                this.compileElement();\r\n            }\r\n            else {\r\n                this.digest();\r\n            }\r\n        };\r\n        AngularDirective.prototype.compileElement = function () {\r\n            var angularContext = this.props.angularContext;\r\n            var element = $(React.findDOMNode(this));\r\n            angularContext.compileElement(element, this.props.setupScope);\r\n        };\r\n        AngularDirective.prototype.digest = function () {\r\n            var angularContext = this.props.angularContext;\r\n            angularContext.enqueueDigest();\r\n        };\r\n        AngularDirective.element = React.createFactory(AngularDirective);\r\n        return AngularDirective;\r\n    })(React.Component);\r\n    VizPortalReact.AngularDirective = AngularDirective;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../../ts/libs.ts\" />\r\n/// <reference path=\"AngularDirective.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    /**\r\n     * Opens an angular tb-popover.\r\n     * $todo: Replace with native react popover implementation\r\n     */\r\n    var PopoverTrigger = (function (_super) {\r\n        __extends(PopoverTrigger, _super);\r\n        function PopoverTrigger() {\r\n            _super.apply(this, arguments);\r\n        }\r\n        PopoverTrigger.prototype.render = function () {\r\n            var _this = this;\r\n            return VizPortalReact.AngularDirective.element({\r\n                attributes: {\r\n                    'tb-popover': \"'\" + this.props.popoverTemplateUrl + \"'\",\r\n                    'tb-popover-class': 'tb-content-item-popover'\r\n                },\r\n                setupScope: function (scope) {\r\n                    _this.scope = scope.$new();\r\n                    _this.scope.item = _this.props.item; // tb-popover's template assumes the item is on the scope. This was done by ngrepeat before.\r\n                    _this.scope.getItemDetails = _this.props.getItemDetails;\r\n                    return _this.scope;\r\n                },\r\n                angularContext: this.props.angularContext\r\n            }, this.props.children);\r\n        };\r\n        PopoverTrigger.prototype.componentWillUnmount = function () {\r\n            if (this.scope) {\r\n                this.scope.$destroy();\r\n            }\r\n        };\r\n        PopoverTrigger.element = React.createFactory(PopoverTrigger);\r\n        return PopoverTrigger;\r\n    })(React.Component);\r\n    VizPortalReact.PopoverTrigger = PopoverTrigger;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../../ts/libs.ts\" />\r\n/// <reference path=\"actionMenu/ActionsMenu.ts\" />\r\n/// <reference path=\"FavoriteToggle.ts\" />\r\n/// <reference path=\"PopoverTrigger.ts\" />\r\n/// <reference path=\"PopupMenu.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    /**\r\n     * An thumbnail representing a single workbook or view.\r\n     */\r\n    var Thumbnail = (function (_super) {\r\n        __extends(Thumbnail, _super);\r\n        function Thumbnail(props) {\r\n            _super.call(this, props, {});\r\n            this.state = {\r\n                hover: false\r\n            };\r\n            this.angularContext = this.props.angularContext;\r\n        }\r\n        Thumbnail.prototype.mouseEnter = function () {\r\n            this.setState({ hover: true });\r\n        };\r\n        Thumbnail.prototype.mouseLeave = function () {\r\n            this.setState({ hover: false });\r\n        };\r\n        Thumbnail.prototype.isSelected = function () {\r\n            return this.props.selectedItems.contains(this.props.item);\r\n        };\r\n        Thumbnail.prototype.toggleSelected = function () {\r\n            var _this = this;\r\n            // Call apply here so that angular directives that use selectedItems see this update.\r\n            // TODO: get rid of this force update.\r\n            this.angularContext.evalAsync(function () {\r\n                _this.props.selectedItems.toggle(_this.props.item);\r\n                _this.forceUpdate();\r\n            });\r\n        };\r\n        Thumbnail.prototype.render = function () {\r\n            var _this = this;\r\n            var item = this.props.item;\r\n            var detailsUrl = this.props.detailsUrl;\r\n            var classes = React.addons.classSet({\r\n                'tb-thumbnail': true,\r\n                'tb-hover': this.state.hover,\r\n                'tb-selected': this.isSelected()\r\n            });\r\n            // $todo: tb-thumbnail-touch\r\n            var elm = VizPortalReact.PopoverTrigger.element(_.extend({ item: item, angularContext: this.props.angularContext, popoverTemplateUrl: this.props.popoverTemplateUrl }, this.props.popoverTriggerProps), React.DOM.span({ className: classes, onMouseEnter: function () { return _this.mouseEnter(); }, onMouseLeave: function () { return _this.mouseLeave(); } }, React.DOM.a({ className: 'tb-thumbnail-slide', href: detailsUrl }, \r\n            // TODO: Replace this with an instance of the ThumbnailImage component\r\n            React.DOM.img({ className: 'tb-thumbnail-slide-image', src: item.thumbnailUrl })), React.DOM.a({ className: 'tb-thumbnail-checkbox-background' }), React.DOM.div({ className: 'tb-thumbnail-checkbox-target', onClick: function () { return _this.toggleSelected(); } }), \r\n            // corner image\r\n            React.DOM.a({\r\n                className: 'tb-thumbnail-action-menu-background tb-thumbnail-slide-action-menu-background',\r\n                href: detailsUrl\r\n            }), \r\n            // popup menu\r\n            React.DOM.div({ className: 'tb-thumbnail-action-menu' }, VizPortalReact.PopupMenu.element({\r\n                buttonClickHandler: function () {\r\n                    _this.angularContext.evalAsync(function () {\r\n                        _this.props.selectedItems.clear();\r\n                        _this.props.selectedItems.add(item);\r\n                        _this.forceUpdate();\r\n                    });\r\n                },\r\n                popupContentDescriptor: VizPortalReact.ActionsMenu.element(this.props.actionsMenuProps)\r\n            }, VizPortalReact.ActionMenuButton.element({}))), React.DOM.div({ className: 'tb-thumbnail-caption' }, React.DOM.a({ className: 'tb-thumbnail-caption-link', href: detailsUrl }, item.name), VizPortalReact.FavoriteToggle.element(_.extend({}, this.props.favoriteProps, { item: item, hover: this.state.hover })))));\r\n            return elm;\r\n        };\r\n        Thumbnail.displayName = 'Thumbnail';\r\n        Thumbnail.element = React.createFactory(Thumbnail);\r\n        return Thumbnail;\r\n    })(React.Component);\r\n    VizPortalReact.Thumbnail = Thumbnail;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../../ts/libs.ts\" />\r\n/// <reference path=\"actionMenu/ActionsMenu.ts\" />\r\n/// <reference path=\"Thumbnail.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    /**\r\n     * The thumbnails view in the Views and Workbooks subplaces.\r\n     */\r\n    var Thumbnails = (function (_super) {\r\n        __extends(Thumbnails, _super);\r\n        function Thumbnails(props) {\r\n            _super.call(this, props, {});\r\n        }\r\n        Thumbnails.prototype.render = function () {\r\n            var _this = this;\r\n            var items = this.props.items || [];\r\n            var selectedItems = this.props.selectedItems;\r\n            var favoriteProps = this.props.favoriteProps;\r\n            var getDetailsUrl = this.props.getDetailsUrl;\r\n            var actionsMenuProps = this.props.actionsMenuProps;\r\n            var contentType = this.props.contentType;\r\n            var popoverTemplateUrl = contentType === VizPortal.ViewContentType.name ? 'viewPopover.html' : 'workbookPopover.html';\r\n            return React.DOM.span({}, items.map(function (item, key) {\r\n                return VizPortalReact.Thumbnail.element({\r\n                    key: key,\r\n                    item: item,\r\n                    detailsUrl: getDetailsUrl(item),\r\n                    getItemDetails: _this.props.getItemDetails,\r\n                    selected: selectedItems.contains(item),\r\n                    selectedItems: selectedItems,\r\n                    favoriteProps: favoriteProps,\r\n                    actionsMenuProps: actionsMenuProps,\r\n                    popoverTriggerProps: _this.props.popoverTriggerProps,\r\n                    popoverTemplateUrl: popoverTemplateUrl,\r\n                    angularContext: _this.props.angularContext\r\n                });\r\n            }));\r\n        };\r\n        Thumbnails.displayName = 'Thumbnails';\r\n        Thumbnails.element = React.createFactory(Thumbnails);\r\n        return Thumbnails;\r\n    })(React.Component);\r\n    VizPortalReact.Thumbnails = Thumbnails;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../../ts/libs.ts\" />\r\n/// <reference path=\"../CommonStyles.ts\" />\r\n/// <reference path=\"../IReactTranslateService.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    var Toast = (function (_super) {\r\n        __extends(Toast, _super);\r\n        function Toast(props) {\r\n            _super.call(this, props);\r\n            this.isFading = false;\r\n            this.state = {\r\n                fadeOpacity: 0\r\n            };\r\n            this.boundHover = this.hover.bind(this);\r\n            this.boundFadeOut = this.fadeOut.bind(this);\r\n            this.boundClose = this.close.bind(this);\r\n            this.boundMouseOut = this.mouseOut.bind(this);\r\n        }\r\n        Toast.prototype.close = function () {\r\n            clearTimeout(this.fadeOutTimeoutId);\r\n            clearTimeout(this.closeTimeoutId);\r\n            this.props.close();\r\n        };\r\n        Toast.prototype.componentDidMount = function () {\r\n            var _this = this;\r\n            // timeout is necessary to make sure that DOM has been udpated with opacity 0 from initial state.\r\n            setTimeout(function () {\r\n                _this.setState({ fadeOpacity: 1, fadeTransitionTime: Toast.FadeInTime });\r\n            }, 0);\r\n            // fade out after timeoutDelay milliseconds\r\n            if (this.props.timeoutDelay !== VizPortal.ToasterService.NoTimeout) {\r\n                this.fadeOutTimeoutId = setTimeout(this.boundFadeOut, this.props.timeoutDelay);\r\n            }\r\n        };\r\n        Toast.prototype.mouseOut = function () {\r\n            if (this.props.timeoutDelay !== VizPortal.ToasterService.NoTimeout) {\r\n                if (this.isFading) {\r\n                    this.boundFadeOut();\r\n                }\r\n                else {\r\n                    this.fadeOutTimeoutId = setTimeout(this.boundFadeOut, this.props.timeoutDelay);\r\n                }\r\n            }\r\n        };\r\n        Toast.prototype.hover = function () {\r\n            if (this.props.timeoutDelay !== VizPortal.ToasterService.NoTimeout) {\r\n                this.setState({ fadeOpacity: 1, fadeTransitionTime: Toast.HoverRestoreTime });\r\n                clearTimeout(this.fadeOutTimeoutId);\r\n                clearTimeout(this.closeTimeoutId);\r\n            }\r\n        };\r\n        Toast.prototype.fadeOut = function () {\r\n            this.setState({ fadeOpacity: 0, fadeTransitionTime: Toast.FadeOutTime });\r\n            this.closeTimeoutId = setTimeout(this.boundClose, Toast.FadeOutTime);\r\n            this.isFading = true;\r\n        };\r\n        Toast.prototype.render = function () {\r\n            var classes = 'tb-toast tb-toast-' + this.props.toastType;\r\n            var fadeStyle = {\r\n                transitionDuration: this.state.fadeTransitionTime + 'ms',\r\n                opacity: this.state.fadeOpacity,\r\n                transitionTimingFunction: this.state.fadeOpacity === 0 ? Toast.FadeOutEasing : Toast.FadeInEasing\r\n            };\r\n            // if lines are available, put each one in a div, otherwise use the toastContent prop\r\n            var content = this.props.lines ? _.map(this.props.lines, function (content, i) {\r\n                return React.DOM.div({ key: i }, content);\r\n            }) : this.props.toastContent;\r\n            var lineWrapper = React.DOM.div({ key: 'toastContent', className: 'tb-toast-text' }, content);\r\n            var clearButton = React.DOM.span({ key: 'closeButton', className: 'tb-clear-button tb-disable-selection', onClick: this.boundClose }, '');\r\n            var mainDiv = React.DOM.div({ style: fadeStyle, onMouseOver: this.boundHover, onMouseOut: this.boundMouseOut, key: 'toast', className: classes }, lineWrapper, clearButton);\r\n            return mainDiv;\r\n        };\r\n        Toast.displayName = 'Toast';\r\n        Toast.element = React.createFactory(Toast);\r\n        Toast.FadeOutTime = 3000; // 3 seconds\r\n        Toast.FadeInTime = 100; // 100ms\r\n        Toast.HoverRestoreTime = 30; // 30ms\r\n        Toast.FadeOutEasing = 'ease-out';\r\n        Toast.FadeInEasing = 'linear';\r\n        return Toast;\r\n    })(React.Component);\r\n    VizPortalReact.Toast = Toast;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../../ts/libs.ts\" />\r\n/// <reference path=\"../CommonStyles.ts\" />\r\n/// <reference path=\"../IReactTranslateService.ts\" />\r\n/// <reference path=\"./Toast.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    VizPortalReact.ToastType = {\r\n        Info: 'info',\r\n        Error: 'error',\r\n        External: 'external'\r\n    };\r\n    var Toaster = (function (_super) {\r\n        __extends(Toaster, _super);\r\n        function Toaster(props) {\r\n            _super.call(this, props, {});\r\n            this.state = { toasts: [] };\r\n            this.boundListenerFn = this.toastsUpdated.bind(this);\r\n            this.angularContext = this.props.angularContext;\r\n            this.toasterService = this.angularContext.getService('ToasterService');\r\n        }\r\n        ;\r\n        Toaster.prototype.componentDidMount = function () {\r\n            this.listenerId = this.toasterService.addListener({ toastsUpdated: this.boundListenerFn });\r\n        };\r\n        Toaster.prototype.componentWillUnmount = function () {\r\n            this.toasterService.removeListener(this.listenerId);\r\n        };\r\n        Toaster.prototype.close = function (id) {\r\n            this.toasterService.close(id);\r\n        };\r\n        Toaster.prototype.toastsUpdated = function (toastOptionsArray) {\r\n            var _this = this;\r\n            var newToasts = [];\r\n            _.each(toastOptionsArray, function (toastOptions) {\r\n                var t = VizPortalReact.Toast.element({\r\n                    key: toastOptions.id,\r\n                    close: function () { _this.close(toastOptions.id); },\r\n                    toastType: toastOptions.type,\r\n                    timeoutDelay: toastOptions.timeoutDelay,\r\n                    toastContent: toastOptions.content,\r\n                    lines: toastOptions.lines\r\n                });\r\n                newToasts.push(t);\r\n            });\r\n            this.setState({ toasts: newToasts });\r\n        };\r\n        Toaster.prototype.render = function () {\r\n            return React.DOM.div({ className: 'tb-toaster tb-enable-selection' }, this.state.toasts);\r\n        };\r\n        Toaster.displayName = 'Toaster';\r\n        Toaster.element = React.createFactory(Toaster);\r\n        return Toaster;\r\n    })(React.Component);\r\n    VizPortalReact.Toaster = Toaster;\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../ts/libs.ts\" />\r\n/// <reference path=\"externalReferences.ts\" />\r\n// TODO: Figure out how to replace this dependency in this file\r\n/// <reference path=\"../../ts/directives/reactDirectiveFactory.ts\" />\r\n/// <reference path=\"../../app/header/FavoritesMenu.ts\" />\r\n/// <reference path=\"../../app/header/SiteSwitcher.ts\" />\r\n/// <reference path=\"../../app/header/TopBar.ts\" />\r\n/// <reference path=\"../../app/content/TypeaheadFilter.ts\" />\r\n/// <reference path=\"../../app/content/Permissions/PermissionLockStatus.ts\" />\r\n/// <reference path=\"../../app/content/Sparkline.ts\" />\r\n/// <reference path=\"components/stackedComponents/ComponentStacker.ts\" />\r\n/// <reference path=\"components/ThumbnailImage.ts\" />\r\n/// <reference path=\"components/Thumbnails.ts\" />\r\n/// <reference path=\"components/Toaster.ts\" />\r\n/// <reference path=\"components/dataGrid/DataGrid.ts\" />\r\nvar VizPortalReact;\r\n(function (VizPortalReact) {\r\n    VizPortal.ReactDirectiveFactory.create({ name: 'tbComponentStacker', componentFactory: VizPortalReact.ComponentStacker.element });\r\n    VizPortal.ReactDirectiveFactory.create({ name: 'tbThumbnails', componentFactory: VizPortalReact.Thumbnails.element });\r\n    VizPortal.ReactDirectiveFactory.create({ name: 'tbReactFavoritesMenu', componentFactory: VizPortalReact.FavoritesMenu.element });\r\n    VizPortal.ReactDirectiveFactory.create({ name: 'tbReactDataGrid', componentFactory: VizPortalReact.DataGrid.element, watch: 'props.update' });\r\n    VizPortal.ReactDirectiveFactory.create({ name: 'tbReactTypeaheadFilter', componentFactory: VizPortalReact.TypeaheadFilter.element, watch: 'props.filter.value' });\r\n    VizPortal.ReactDirectiveFactory.create({ name: 'tbReactToaster', componentFactory: VizPortalReact.Toaster.element });\r\n    VizPortal.ReactDirectiveFactory.create({ name: 'tbReactTopBar', componentFactory: VizPortalReact.TopBar.element });\r\n    VizPortal.ReactDirectiveFactory.create({ name: 'tbPermissionLockStatus', componentFactory: VizPortalReact.PermissionLockStatus.element, watch: 'props.lockState' });\r\n    VizPortal.ReactDirectiveFactory.create({ name: 'tbSparklineWithTitle', componentFactory: VizPortalReact.SparklineWithTitle.element });\r\n    VizPortal.ReactDirectiveFactory.create({ name: 'tbThumbnailImage', componentFactory: VizPortalReact.ThumbnailImage.element });\r\n})(VizPortalReact || (VizPortalReact = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var UpdateConnectionsOAuthRequest = (function (_super) {\r\n            __extends(UpdateConnectionsOAuthRequest, _super);\r\n            function UpdateConnectionsOAuthRequest(params) {\r\n                _super.call(this, 'updateConnectionsOAuth', params);\r\n            }\r\n            return UpdateConnectionsOAuthRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.UpdateConnectionsOAuthRequest = UpdateConnectionsOAuthRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\n/// <reference path=\"../ServerApi/requests/CheckConnectionRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/UpdateConnectionsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/requests/UpdateConnectionsOAuthRequest.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DataConnections = (function () {\r\n        function DataConnections($q, ErrorNotifyingServer, LongRunningActionService) {\r\n            this.$q = $q;\r\n            this.ErrorNotifyingServer = ErrorNotifyingServer;\r\n            this.LongRunningActionService = LongRunningActionService;\r\n            this.server = ErrorNotifyingServer.getServerService();\r\n        }\r\n        DataConnections.prototype.checkExistingConnection = function (dataSourceId) {\r\n            var request = new VizPortal.ServerApi.CheckConnectionRequest({ id: dataSourceId });\r\n            return this.ErrorNotifyingServer.sendRequest(request);\r\n        };\r\n        DataConnections.prototype.checkConnection = function (dataSourceId, connectionUpdate) {\r\n            var _this = this;\r\n            var requestParams = {\r\n                id: dataSourceId,\r\n                server: connectionUpdate.server,\r\n                port: connectionUpdate.port,\r\n                username: connectionUpdate.username\r\n            };\r\n            return this.setPasswordParams(requestParams, connectionUpdate.passwordUpdate).then(function () {\r\n                return _this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.CheckConnectionRequest(requestParams));\r\n            });\r\n        };\r\n        DataConnections.prototype.updateConnections = function (dataSourceIds, connectionUpdate) {\r\n            var _this = this;\r\n            var requestParams = {\r\n                ids: dataSourceIds,\r\n                server: connectionUpdate.server,\r\n                port: connectionUpdate.port,\r\n                username: connectionUpdate.username\r\n            };\r\n            return this.setPasswordParams(requestParams, connectionUpdate.passwordUpdate)\r\n                .then(function () { return _this.ErrorNotifyingServer.sendRequest(new VizPortal.ServerApi.UpdateConnectionsRequest(requestParams)); })\r\n                .then(this.LongRunningActionService.startProgressTrackingForResponse())\r\n                .then(this.LongRunningActionService.delayResultForSolr());\r\n        };\r\n        DataConnections.prototype.updateConnectionsOAuth = function (dataSourceIds, keychainEntryId) {\r\n            return this.ErrorNotifyingServer\r\n                .sendRequest(new VizPortal.ServerApi.UpdateConnectionsOAuthRequest({\r\n                ids: dataSourceIds,\r\n                keychainEntryId: keychainEntryId\r\n            }))\r\n                .then(this.LongRunningActionService.startProgressTrackingForResponse())\r\n                .then(this.LongRunningActionService.delayResultForSolr());\r\n        };\r\n        DataConnections.prototype.setPasswordParams = function (requestParams, passwordUpdate) {\r\n            if (passwordUpdate) {\r\n                requestParams.embedPassword = passwordUpdate.isEmbedded;\r\n                if (_.isString(passwordUpdate.newPassword)) {\r\n                    return this.server.sendRequest(new VizPortal.ServerApi.GeneratePublicKeyRequest()).\r\n                        then(function (generatePublicKeyResult) {\r\n                        requestParams.encryptedPassword = rsa.encrypt(passwordUpdate.newPassword, generatePublicKeyResult.key);\r\n                        requestParams.encryptedPasswordKeyId = generatePublicKeyResult.keyId;\r\n                    });\r\n                }\r\n            }\r\n            return this.$q.when({});\r\n        };\r\n        DataConnections.$inject = ['$q', 'ErrorNotifyingServer', 'LongRunningActionService'];\r\n        return DataConnections;\r\n    })();\r\n    VizPortal.DataConnections = DataConnections;\r\n    VizPortal.Module.instance().service('DataConnections', DataConnections);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/IGetItemsParams.ts\" />\r\n/// <reference path=\"../types/IGetItemsResult.ts\" />\r\n/// <reference path=\"../types/IDataConnectionType.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetDataConnectionTypesRequest = (function (_super) {\r\n            __extends(GetDataConnectionTypesRequest, _super);\r\n            function GetDataConnectionTypesRequest(params) {\r\n                _super.call(this, 'getDataConnectionTypes', params);\r\n            }\r\n            return GetDataConnectionTypesRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetDataConnectionTypesRequest = GetDataConnectionTypesRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetDataConnectionTypesRequest.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\n/// <reference path=\"Resource.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DataConnectionTypes = (function (_super) {\r\n        __extends(DataConnectionTypes, _super);\r\n        function DataConnectionTypes(server, FetcherFactory) {\r\n            _super.call(this, FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetDataConnectionTypesRequest, function (result) { return result.dataConnectionTypes; }));\r\n            this.fieldValuesFetcher = FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetFieldValuesRequest, VizPortal.ServerApiMapper.fieldValues);\r\n        }\r\n        DataConnectionTypes.prototype.getByDataConnectionType = function (dataConnectionType) {\r\n            return this.all()\r\n                .withFilters([VizPortal.Filter.stringFieldEq(VizPortal.ServerApi.FilterFieldNames.connectionType, dataConnectionType)])\r\n                .getFirst();\r\n        };\r\n        DataConnectionTypes.prototype.valuesForField = function (field) {\r\n            return new VizPortal.FieldValuesQuery(this.fieldValuesFetcher, field, VizPortal.ServerApi.FieldValueResourceType.dataConnection);\r\n        };\r\n        DataConnectionTypes.$inject = ['ServerService', 'FetcherFactory'];\r\n        return DataConnectionTypes;\r\n    })(VizPortal.Resource);\r\n    VizPortal.DataConnectionTypes = DataConnectionTypes;\r\n    VizPortal.Module.instance().service('DataConnectionTypes', DataConnectionTypes);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/IGetItemsParams.ts\" />\r\n/// <reference path=\"../types/IGetItemsResult.ts\" />\r\n/// <reference path=\"../types/IProject.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetProjectNamesRequest = (function (_super) {\r\n            __extends(GetProjectNamesRequest, _super);\r\n            function GetProjectNamesRequest(params) {\r\n                _super.call(this, 'getProjectNames', params);\r\n            }\r\n            return GetProjectNamesRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetProjectNamesRequest = GetProjectNamesRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetProjectNamesRequest.ts\" />\r\n/// <reference path=\"Resource.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ProjectNames = (function (_super) {\r\n        __extends(ProjectNames, _super);\r\n        function ProjectNames(FetcherFactory) {\r\n            _super.call(this, FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetProjectNamesRequest, function (result) { return result.projects; }));\r\n        }\r\n        ProjectNames.$inject = ['FetcherFactory'];\r\n        return ProjectNames;\r\n    })(VizPortal.Resource);\r\n    VizPortal.ProjectNames = ProjectNames;\r\n    VizPortal.Module.instance().service('ProjectNames', ProjectNames);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/IGetItemsParams.ts\" />\r\n/// <reference path=\"../types/IGetItemsResult.ts\" />\r\n/// <reference path=\"../types/ITag.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetTagsRequest = (function (_super) {\r\n            __extends(GetTagsRequest, _super);\r\n            function GetTagsRequest(params) {\r\n                _super.call(this, 'getTags', params);\r\n            }\r\n            return GetTagsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetTagsRequest = GetTagsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetTagsRequest.ts\" />\r\n/// <reference path=\"../ServerApi/types/ITag.ts\" />\r\n/// <reference path=\"Resource.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var Tags = (function (_super) {\r\n        __extends(Tags, _super);\r\n        function Tags(FetcherFactory) {\r\n            _super.call(this, FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetTagsRequest, function (result) { return result.tags; }));\r\n        }\r\n        Tags.$inject = ['FetcherFactory'];\r\n        return Tags;\r\n    })(VizPortal.Resource);\r\n    VizPortal.Tags = Tags;\r\n    VizPortal.Module.instance().service('Tags', Tags);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/IGetItemsParams.ts\" />\r\n/// <reference path=\"../types/IGetItemsResult.ts\" />\r\n/// <reference path=\"../types/IUser.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetUserNamesRequest = (function (_super) {\r\n            __extends(GetUserNamesRequest, _super);\r\n            function GetUserNamesRequest(params) {\r\n                _super.call(this, 'getUserNames', params);\r\n            }\r\n            return GetUserNamesRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetUserNamesRequest = GetUserNamesRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetUserNamesRequest.ts\" />\r\n/// <reference path=\"../ServerApi/types/IUser.ts\" />\r\n/// <reference path=\"Resource.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var UserNames = (function (_super) {\r\n        __extends(UserNames, _super);\r\n        function UserNames(FetcherFactory) {\r\n            _super.call(this, FetcherFactory.getServerResourceFetcher(VizPortal.ServerApi.GetUserNamesRequest, function (result) { return result.users; }));\r\n        }\r\n        UserNames.$inject = ['FetcherFactory'];\r\n        return UserNames;\r\n    })(VizPortal.Resource);\r\n    VizPortal.UserNames = UserNames;\r\n    VizPortal.Module.instance().service('UserNames', UserNames);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var AddUsersToGroupAction = (function () {\r\n        function AddUsersToGroupAction(modal) {\r\n            this.modal = modal;\r\n        }\r\n        AddUsersToGroupAction.prototype.showAddUsersToGroupDialog = function (group) {\r\n            var dialogInstance = this.modal.open({\r\n                templateUrl: 'addUsersToGroupDialog.html',\r\n                size: VizPortal.ModalSize.medium,\r\n                controller: VizPortal.AddUsersToGroupDialogCtrl,\r\n                resolve: {\r\n                    group: function () { return group; }\r\n                }\r\n            });\r\n            return dialogInstance.result;\r\n        };\r\n        AddUsersToGroupAction.$inject = ['ModalService'];\r\n        return AddUsersToGroupAction;\r\n    })();\r\n    VizPortal.AddUsersToGroupAction = AddUsersToGroupAction;\r\n    VizPortal.Module.instance().service('AddUsersToGroupAction', AddUsersToGroupAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var AssignPermissionsToContentsRequest = (function (_super) {\r\n            __extends(AssignPermissionsToContentsRequest, _super);\r\n            function AssignPermissionsToContentsRequest(params) {\r\n                _super.call(this, 'assignPermissionsToContents', params);\r\n            }\r\n            return AssignPermissionsToContentsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.AssignPermissionsToContentsRequest = AssignPermissionsToContentsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../ServerApi/requests/assignPermissionsToContentsRequest.ts\" />\r\n/// <reference path=\"../services/ServerService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var AssignPermissionsToContentsService = (function () {\r\n        function AssignPermissionsToContentsService($translate, server, lrActionService, toasterService) {\r\n            this.$translate = $translate;\r\n            this.server = server;\r\n            this.lrActionService = lrActionService;\r\n            this.toasterService = toasterService;\r\n            this.assignPermissionsToContentsPercent = 0;\r\n            this.assignPermissionsToContentsPending = false;\r\n        }\r\n        AssignPermissionsToContentsService.prototype.handleCurrentJob = function () {\r\n            var _this = this;\r\n            return this.lrActionService.getLastByType(VizPortal.LongRunningActionType.AssignPermissionsToContents)\r\n                .then(function (action) { return _this.handleAssignPermissionsToContentsStatus(action); });\r\n        };\r\n        AssignPermissionsToContentsService.prototype.getAssignPermissionsToContentsPercent = function () {\r\n            return this.assignPermissionsToContentsPercent;\r\n        };\r\n        AssignPermissionsToContentsService.prototype.getAssignPermissionsToContentsPending = function () {\r\n            return this.assignPermissionsToContentsPending;\r\n        };\r\n        AssignPermissionsToContentsService.prototype.assignPermissionsToContents = function (params) {\r\n            var _this = this;\r\n            this.assignPermissionsToContentsPercent = 0;\r\n            return this.server.sendRequest(new VizPortal.ServerApi.AssignPermissionsToContentsRequest(params))\r\n                .then(function (result) {\r\n                var existingAssignment = !result.actionId;\r\n                if (!existingAssignment) {\r\n                    _this.trackAssignPermissionsToContentsProgress(result.actionId);\r\n                }\r\n                else {\r\n                    _this.getAssignPermissionsToContentsStatus();\r\n                }\r\n            });\r\n        };\r\n        AssignPermissionsToContentsService.prototype.cancelPoll = function () {\r\n            if (this.assignPermissionsToContentsPoller) {\r\n                this.assignPermissionsToContentsPoller.cancel();\r\n            }\r\n            this.assignPermissionsToContentsPercent = 0;\r\n            this.assignPermissionsToContentsPending = false;\r\n        };\r\n        AssignPermissionsToContentsService.prototype.trackAssignPermissionsToContentsProgress = function (actionId) {\r\n            var _this = this;\r\n            var completeFn = function (action) {\r\n                if (action && action.succeeded === false) {\r\n                    failFn(action && action.response && action.response.errors);\r\n                }\r\n                else {\r\n                    _this.assignPermissionsToContentsPercent = 100;\r\n                    _this.toasterService.pop({ type: VizPortal.ToastType.Info, text: _this.$translate.instant('assignPermissionsToContentsSuccess') });\r\n                }\r\n            };\r\n            var notifyFn = function (action) {\r\n                _this.assignPermissionsToContentsPercent = action.percentComplete;\r\n            };\r\n            var failFn = function (reason) {\r\n                if (reason !== VizPortal.ErrorReason.Canceled) {\r\n                    _this.toasterService.pop({ type: VizPortal.ToastType.Info, text: _this.$translate.instant('assignPermissionsToContentsError') });\r\n                }\r\n            };\r\n            if (actionId) {\r\n                this.assignPermissionsToContentsPending = true;\r\n                this.assignPermissionsToContentsPoller = this.lrActionService.trackProgress(actionId);\r\n                this.assignPermissionsToContentsPoller.promise\r\n                    .then(completeFn, failFn, notifyFn)\r\n                    .fin(function () { return _this.assignPermissionsToContentsPending = false; });\r\n            }\r\n            else {\r\n                failFn(VizPortal.ErrorReason.Unknown);\r\n            }\r\n        };\r\n        AssignPermissionsToContentsService.prototype.getAssignPermissionsToContentsStatus = function () {\r\n            var _this = this;\r\n            this.lrActionService.getLastByType(VizPortal.LongRunningActionType.AssignPermissionsToContents)\r\n                .then(function (action) { return _this.handleAssignPermissionsToContentsStatus(action); });\r\n        };\r\n        AssignPermissionsToContentsService.prototype.handleAssignPermissionsToContentsStatus = function (action) {\r\n            if (action && action.state !== VizPortal.LongRunningActionState.Complete) {\r\n                this.assignPermissionsToContentsPercent = action.percentComplete;\r\n                this.trackAssignPermissionsToContentsProgress(action.id);\r\n            }\r\n        };\r\n        AssignPermissionsToContentsService.$inject = [\r\n            '$translate',\r\n            'ServerService',\r\n            'LongRunningActionService',\r\n            'ToasterService'\r\n        ];\r\n        return AssignPermissionsToContentsService;\r\n    })();\r\n    VizPortal.AssignPermissionsToContentsService = AssignPermissionsToContentsService;\r\n    VizPortal.Module.instance().service('AssignPermissionsToContentsService', AssignPermissionsToContentsService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var BackdropService = (function () {\r\n        function BackdropService(StackedElementsService) {\r\n            this.StackedElementsService = StackedElementsService;\r\n        }\r\n        BackdropService.prototype.add = function () {\r\n            var _this = this;\r\n            var fillWindow = function () { return { left: 0, top: 0, right: 0, bottom: 0 }; };\r\n            var backdropElement = angular.element('<div>').addClass('tb-backdrop');\r\n            var backdropStackedElement = this.StackedElementsService.addStackedElement({\r\n                contentElement: backdropElement,\r\n                getContentElementPosition: fillWindow\r\n            });\r\n            var backdropInstance = {\r\n                remove: function () { _this.StackedElementsService.removeStackedElement(backdropStackedElement); }\r\n            };\r\n            return backdropInstance;\r\n        };\r\n        BackdropService.$inject = ['StackedElementsService'];\r\n        return BackdropService;\r\n    })();\r\n    VizPortal.BackdropService = BackdropService;\r\n    VizPortal.Module.instance().service('BackdropService', BackdropService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var BulkImportUsersAction = (function () {\r\n        function BulkImportUsersAction(modal) {\r\n            this.modal = modal;\r\n        }\r\n        BulkImportUsersAction.prototype.showBulkImportSiteUsersDialog = function (dialogScope) {\r\n            return this.showBulkImportUsersDialog(dialogScope, VizPortal.BulkImportUsersDialogCtrl.Method.ImportUsersFromCsv);\r\n        };\r\n        BulkImportUsersAction.prototype.showBulkImportServerUsersDialog = function (dialogScope) {\r\n            return this.showBulkImportUsersDialog(dialogScope, VizPortal.BulkImportUsersDialogCtrl.Method.ImportServerUsersFromCsv);\r\n        };\r\n        BulkImportUsersAction.prototype.showBulkImportUsersDialog = function (dialogScope, method) {\r\n            var dialogInstance = this.modal.open({\r\n                scope: dialogScope,\r\n                templateUrl: 'bulkImportUsersDialog.html',\r\n                size: VizPortal.ModalSize.fitToContent,\r\n                controller: VizPortal.BulkImportUsersDialogCtrl,\r\n                resolve: {\r\n                    method: function () { return method; } // BulkImportUsersDialogCtrl.Method\r\n                }\r\n            });\r\n            return dialogInstance.result;\r\n        };\r\n        BulkImportUsersAction.$inject = ['ModalService'];\r\n        return BulkImportUsersAction;\r\n    })();\r\n    VizPortal.BulkImportUsersAction = BulkImportUsersAction;\r\n    VizPortal.Module.instance().service('BulkImportUsersAction', BulkImportUsersAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ChangeDatasourceRefreshModeAction = (function () {\r\n        function ChangeDatasourceRefreshModeAction($translate, $q, toaster, DataSources) {\r\n            this.$translate = $translate;\r\n            this.$q = $q;\r\n            this.toaster = toaster;\r\n            this.DataSources = DataSources;\r\n        }\r\n        ChangeDatasourceRefreshModeAction.prototype.execute = function (datasource, currentRefreshMode, newRefreshMode, currentRemoteAgentName, suppressSuccessToast, suppressErrorToast) {\r\n            var _this = this;\r\n            if (currentRefreshMode === newRefreshMode) {\r\n                // no-op because the mode hasn't changed\r\n                return this.$q.when({});\r\n            }\r\n            return this.DataSources.setRefreshMode(datasource.id, newRefreshMode).then(function (result) {\r\n                if (!suppressErrorToast && result.errors && result.errors.length) {\r\n                    _this.toaster.pop({ type: VizPortal.ToastType.Error, text: _this.errorMessageFor(result.errors[0], datasource) });\r\n                }\r\n                if (!suppressSuccessToast && (!result.errors || !result.errors.length)) {\r\n                    if (newRefreshMode === VizPortal.ServerApi.RefreshModeTypes.Remote) {\r\n                        _this.toaster.pop({\r\n                            type: VizPortal.ToastType.Info,\r\n                            text: _this.$translate.instant('editRemoteRefreshPropertiesAgentSuccess', { AGENT_NAME: VizPortal.L10n.elideIfLong(currentRemoteAgentName) })\r\n                        });\r\n                    }\r\n                    else {\r\n                        _this.toaster.pop({ type: VizPortal.ToastType.Info, text: _this.$translate.instant('editRemoteRefreshPropertiesServerSuccess') });\r\n                    }\r\n                }\r\n                return result;\r\n            });\r\n        };\r\n        ChangeDatasourceRefreshModeAction.prototype.errorMessageFor = function (error, datasource) {\r\n            switch (error.code) {\r\n                case VizPortal.CommonErrorCode.DatasourceNotFound:\r\n                    return this.$translate.instant('errorDatasourceNotFound', { DATASOURCE_NAME: VizPortal.L10n.elideIfLong(datasource.name) });\r\n                default:\r\n                    return this.$translate.instant('errorUnknown');\r\n            }\r\n        };\r\n        ChangeDatasourceRefreshModeAction.$inject = ['$translate', '$q', 'ToasterService', 'DataSources'];\r\n        return ChangeDatasourceRefreshModeAction;\r\n    })();\r\n    VizPortal.ChangeDatasourceRefreshModeAction = ChangeDatasourceRefreshModeAction;\r\n    VizPortal.Module.instance().service('ChangeDatasourceRefreshModeAction', ChangeDatasourceRefreshModeAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ChangeDatasourceRemoteAgentAction = (function () {\r\n        function ChangeDatasourceRemoteAgentAction($translate, $q, ToasterService, DataSources) {\r\n            this.$translate = $translate;\r\n            this.$q = $q;\r\n            this.ToasterService = ToasterService;\r\n            this.DataSources = DataSources;\r\n        }\r\n        ChangeDatasourceRemoteAgentAction.prototype.execute = function (datasource, currentRemoteAgentName, newRemoteAgentName, currentRefreshMode, suppressSuccessToast, suppressErrorToast) {\r\n            var _this = this;\r\n            if (currentRemoteAgentName === newRemoteAgentName || currentRefreshMode !== VizPortal.ServerApi.RefreshModeTypes.Remote) {\r\n                // no-op because the remote agent hasn't changed or the refresh mode isn't remote\r\n                return this.$q.when({});\r\n            }\r\n            return this.DataSources.setRemoteAgent(datasource.id, newRemoteAgentName).then(function (result) {\r\n                if (!suppressErrorToast && result.errors && result.errors.length) {\r\n                    _this.ToasterService.pop({ type: VizPortal.ToastType.Error, text: _this.errorMessageFor(result.errors[0], datasource) });\r\n                }\r\n                if (!suppressSuccessToast && (!result.errors || !result.errors.length)) {\r\n                    if (currentRefreshMode === VizPortal.ServerApi.RefreshModeTypes.Remote) {\r\n                        _this.ToasterService.pop({\r\n                            type: VizPortal.ToastType.Info,\r\n                            text: _this.$translate.instant('editRemoteRefreshPropertiesAgentSuccess', { AGENT_NAME: VizPortal.L10n.elideIfLong(newRemoteAgentName) })\r\n                        });\r\n                    }\r\n                    else {\r\n                        _this.ToasterService.pop({ type: VizPortal.ToastType.Info, text: _this.$translate.instant('editRemoteRefreshPropertiesServerSuccess') });\r\n                    }\r\n                }\r\n                return result;\r\n            });\r\n        };\r\n        ChangeDatasourceRemoteAgentAction.prototype.errorMessageFor = function (error, datasource) {\r\n            switch (error.code) {\r\n                default:\r\n                    return this.$translate.instant('errorUnknown');\r\n            }\r\n        };\r\n        ChangeDatasourceRemoteAgentAction.$inject = ['$translate', '$q', 'ToasterService', 'DataSources'];\r\n        return ChangeDatasourceRemoteAgentAction;\r\n    })();\r\n    VizPortal.ChangeDatasourceRemoteAgentAction = ChangeDatasourceRemoteAgentAction;\r\n    VizPortal.Module.instance().service('ChangeDatasourceRemoteAgentAction', ChangeDatasourceRemoteAgentAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"ContentActionNotification.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    // Notification For:\r\n    // => deleting groups\r\n    var DeleteGroupsActionNotification = (function () {\r\n        function DeleteGroupsActionNotification($state, $translate, contentActionNotification) {\r\n            this.$state = $state;\r\n            this.$translate = $translate;\r\n            this.contentActionNotification = contentActionNotification;\r\n        }\r\n        DeleteGroupsActionNotification.prototype.notify = function (result, groups) {\r\n            var _this = this;\r\n            // create a notification object for result reporting\r\n            var notification = VizPortal.MultipleResultNotificationOptions.create(new VizPortal.MultipleItemResult(groups, result), {\r\n                describeSuccessSummary: function (successCount) {\r\n                    return _this.$translate.instant('deleteGroupsSuccess', { ITEM_COUNT: successCount, ITEM_NAME: VizPortal.L10n.elideIfLong(groups.first().name) }, VizPortal.L10n.Interpolations.Count);\r\n                },\r\n                describeErrorSummary: function (errorCount) {\r\n                    return _this.$translate.instant('deleteGroupsError', { ERROR_COUNT: errorCount, ITEM_NAME: VizPortal.L10n.elideIfLong(groups.first().name) }, VizPortal.L10n.Interpolations.Count);\r\n                },\r\n                describeErrorDetail: function (errorItem) {\r\n                    return {\r\n                        itemName: errorItem.item.name,\r\n                        itemUrl: _this.$state.href(\"main.site.group\", { id: errorItem.item.id }),\r\n                        errorMessage: _this.errorMessageFor(errorItem.error, errorItem.item.name)\r\n                    };\r\n                }\r\n            });\r\n            // pass the notification object to the service for displaying\r\n            this.contentActionNotification.notify(notification);\r\n        };\r\n        DeleteGroupsActionNotification.prototype.errorMessageFor = function (error, groupName) {\r\n            switch (error.code) {\r\n                case VizPortal.CommonErrorCode.GroupNotFound:\r\n                    return this.$translate.instant('errorGroupNotFound', { ITEM_NAME: VizPortal.L10n.elideIfLong(groupName) });\r\n                case VizPortal.GroupErrorCode.GroupCannotBeDeleted:\r\n                    return this.$translate.instant('errorUnableToDeleteAllUsersGroup', { GROUP_NAME: VizPortal.L10n.elideIfLong(groupName) });\r\n                default:\r\n                    return this.$translate.instant('errorUnknown');\r\n            }\r\n        };\r\n        DeleteGroupsActionNotification.$inject = [\r\n            '$state',\r\n            '$translate',\r\n            'ContentActionNotification'];\r\n        return DeleteGroupsActionNotification;\r\n    })();\r\n    VizPortal.DeleteGroupsActionNotification = DeleteGroupsActionNotification;\r\n    VizPortal.Module.instance().service('DeleteGroupsActionNotification', DeleteGroupsActionNotification);\r\n    // Notification For:\r\n    // => renaming a group\r\n    var RenameGroupActionNotification = (function () {\r\n        function RenameGroupActionNotification($translate, toaster) {\r\n            this.$translate = $translate;\r\n            this.toaster = toaster;\r\n        }\r\n        RenameGroupActionNotification.prototype.notify = function (showErrorMsgFunc, result, newGroupName, oldGroupName) {\r\n            if (!!result.errors && result.errors.length > 0) {\r\n                var errorMsg = this.errorMessageFor(result.errors[0], newGroupName, oldGroupName);\r\n                showErrorMsgFunc(errorMsg);\r\n            }\r\n            else {\r\n                var successMsg = this.$translate.instant('updateGroupNameSuccessMsg', {\r\n                    NEW_ITEM_NAME: VizPortal.L10n.elideIfLong(newGroupName),\r\n                    ITEM_NAME: VizPortal.L10n.elideIfLong(oldGroupName)\r\n                });\r\n                this.toaster.pop({ type: VizPortal.ToastType.Info, text: successMsg });\r\n            }\r\n        };\r\n        RenameGroupActionNotification.prototype.errorMessageFor = function (error, newGroupName, oldGroupName) {\r\n            switch (error.code) {\r\n                case VizPortal.UserErrorCode.UserGroupInvalidName:\r\n                    return this.$translate.instant('errorUserGroupInvalidName', { NEW_ITEM_NAME: VizPortal.L10n.elideIfLong(newGroupName) });\r\n                case VizPortal.UserErrorCode.UserGroupWithNameAlreadyExists:\r\n                    return this.$translate.instant('errorUserGroupWithNameAlreadyExists', { NEW_ITEM_NAME: VizPortal.L10n.elideIfLong(newGroupName) });\r\n                case VizPortal.UserErrorCode.UserAllUsersGroupAlreadyExists:\r\n                    return this.$translate.instant('errorUserAllUsersGroupAlreadyExists', { NEW_ITEM_NAME: VizPortal.L10n.elideIfLong(newGroupName) });\r\n                case VizPortal.CommonErrorCode.GroupNotFound:\r\n                    return this.$translate.instant('errorGroupNotFound', { ITEM_NAME: VizPortal.L10n.elideIfLong(oldGroupName) });\r\n                default:\r\n                    return this.$translate.instant('errorUnknown');\r\n            }\r\n        };\r\n        RenameGroupActionNotification.$inject = [\r\n            '$translate',\r\n            'ToasterService'];\r\n        return RenameGroupActionNotification;\r\n    })();\r\n    VizPortal.RenameGroupActionNotification = RenameGroupActionNotification;\r\n    VizPortal.Module.instance().service('RenameGroupActionNotification', RenameGroupActionNotification);\r\n    // Notification For:\r\n    // => creating a group\r\n    var CreateGroupActionNotification = (function () {\r\n        function CreateGroupActionNotification($translate, toaster) {\r\n            this.$translate = $translate;\r\n            this.toaster = toaster;\r\n        }\r\n        CreateGroupActionNotification.prototype.notify = function (showErrorMsgFunc, result, groupName) {\r\n            if (!!result.errors && result.errors.length > 0) {\r\n                var errorMsg = this.errorMessageFor(result.errors[0], groupName);\r\n                showErrorMsgFunc(errorMsg);\r\n            }\r\n            else {\r\n                var successMsg = this.$translate.instant('createGroupSuccessMsg', { NEW_ITEM_NAME: VizPortal.L10n.elideIfLong(groupName) });\r\n                this.toaster.pop({ type: VizPortal.ToastType.Info, text: successMsg });\r\n            }\r\n        };\r\n        CreateGroupActionNotification.prototype.errorMessageFor = function (error, groupName) {\r\n            switch (error.code) {\r\n                case VizPortal.UserErrorCode.UserGroupInvalidName:\r\n                    return this.$translate.instant('errorUserGroupInvalidName', { NEW_ITEM_NAME: VizPortal.L10n.elideIfLong(groupName) });\r\n                case VizPortal.UserErrorCode.UserGroupWithNameAlreadyExists:\r\n                    return this.$translate.instant('errorUserGroupWithNameAlreadyExists', { NEW_ITEM_NAME: VizPortal.L10n.elideIfLong(groupName) });\r\n                case VizPortal.UserErrorCode.UserAllUsersGroupAlreadyExists:\r\n                    return this.$translate.instant('errorUserAllUsersGroupAlreadyExists', { NEW_ITEM_NAME: VizPortal.L10n.elideIfLong(groupName) });\r\n                default:\r\n                    return this.$translate.instant('errorUnknown');\r\n            }\r\n        };\r\n        CreateGroupActionNotification.$inject = [\r\n            '$translate',\r\n            'ToasterService'];\r\n        return CreateGroupActionNotification;\r\n    })();\r\n    VizPortal.CreateGroupActionNotification = CreateGroupActionNotification;\r\n    VizPortal.Module.instance().service('CreateGroupActionNotification', CreateGroupActionNotification);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/GroupsActionNotification.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var CreateGroupDialogAction = (function () {\r\n        function CreateGroupDialogAction($translate, ConfirmActionDialog, createGroupActionNotification, Groups, ServerService) {\r\n            this.$translate = $translate;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.createGroupActionNotification = createGroupActionNotification;\r\n            this.Groups = Groups;\r\n            this.ServerService = ServerService;\r\n        }\r\n        CreateGroupDialogAction.prototype.showCreateGroupDialog = function (parentScope) {\r\n            var _this = this;\r\n            var dialogScope = parentScope.$new();\r\n            dialogScope.description = this.$translate.instant('createGroupDesc');\r\n            dialogScope.input = {\r\n                text: '',\r\n                maxLength: 255\r\n            };\r\n            var activeDirectoryEnabled = this.ServerService.isServerDomainFamilyActiveDirectory();\r\n            var dialogInstance = this.ConfirmActionDialog.open({\r\n                title: this.$translate.instant(activeDirectoryEnabled ? 'createLocalGroupTitle' : 'createGroupTitle'),\r\n                bodyTemplateUrl: 'confirmActionDialogInput.html',\r\n                scope: dialogScope,\r\n                position: { reserveHeight: 250 },\r\n                confirmDisabled: function () { return _.isEmpty(dialogScope.input.text); },\r\n                actionName: this.$translate.instant('createGroupDialogSubmit'),\r\n                action: function (dialogInstance) {\r\n                    return _this.Groups.createGroup(dialogScope.input.text).then(function (result) {\r\n                        _this.createGroupActionNotification.notify(function (errorMsg) {\r\n                            dialogInstance.showErrorMessage(errorMsg);\r\n                        }, result, dialogScope.input.text);\r\n                    });\r\n                }\r\n            });\r\n            dialogInstance.result.fin(function () { return dialogScope.$destroy(); });\r\n            return dialogInstance.result;\r\n        };\r\n        CreateGroupDialogAction.$inject = ['$translate',\r\n            'ConfirmActionDialog',\r\n            'CreateGroupActionNotification',\r\n            'Groups',\r\n            'ServerService'];\r\n        return CreateGroupDialogAction;\r\n    })();\r\n    VizPortal.CreateGroupDialogAction = CreateGroupDialogAction;\r\n    VizPortal.Module.instance().service('CreateGroupDialogAction', CreateGroupDialogAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DataSourceErrors = (function () {\r\n        function DataSourceErrors(ContentUrl, $translate) {\r\n            this.ContentUrl = ContentUrl;\r\n            this.$translate = $translate;\r\n        }\r\n        DataSourceErrors.prototype.errorDetailsFor = function (datasourceErrorItem) {\r\n            return {\r\n                itemName: datasourceErrorItem.item.name,\r\n                itemUrl: datasourceErrorItem.error.code === VizPortal.CommonErrorCode.DatasourceNotFound\r\n                    || datasourceErrorItem.error.code === VizPortal.CommonErrorCode.DataConnectionNotFound\r\n                    ? null\r\n                    : this.ContentUrl.forItem(datasourceErrorItem.item, VizPortal.DatasourceContentType),\r\n                errorMessage: this.errorMessageForItem(datasourceErrorItem)\r\n            };\r\n        };\r\n        DataSourceErrors.prototype.errorMessageForItem = function (errorItem) {\r\n            return this.errorMessageFor(errorItem.error, errorItem.item.name);\r\n        };\r\n        DataSourceErrors.prototype.errorMessageFor = function (error, datasourceName) {\r\n            if (datasourceName === void 0) { datasourceName = ''; }\r\n            switch (error.code) {\r\n                case VizPortal.CommonErrorCode.DatasourceNotFound:\r\n                case VizPortal.CommonErrorCode.DataConnectionNotFound:\r\n                    return this.$translate.instant('errorDatasourceNotFound', { DATASOURCE_NAME: VizPortal.L10n.elideIfLong(datasourceName) });\r\n                case VizPortal.DatasourceErrorCode.DatasourceChangeOwnerDisabled:\r\n                    return this.$translate.instant('errorDatasourceChangeOwnerDisabled');\r\n                // Permissions errors\r\n                // TODO: Do we want specific error messages for each of these cases?\r\n                case VizPortal.DatasourceErrorCode.DatasourceMoveInsufficientPermissionsOnDatasource:\r\n                case VizPortal.DatasourceErrorCode.DatasourceMoveInsufficientPermissionsOnDestinationProject:\r\n                case VizPortal.DatasourceErrorCode.DatasourceMoveInsufficientPermissionsOnSourceProject:\r\n                    return this.$translate.instant('errorDatasourceMoveInsufficientPermissions');\r\n                case VizPortal.DatasourceErrorCode.DatasourceWithSameNameInDestinationProject:\r\n                    return this.$translate.instant('errorDatasourceWithSameNameInDestinationProject');\r\n                case VizPortal.CommonErrorCode.CallingUserInsufficientPermissions:\r\n                    return this.$translate.instant('errorDatasourceInsufficientPermissions');\r\n                default:\r\n                    return this.$translate.instant('errorUnknown');\r\n            }\r\n        };\r\n        DataSourceErrors.$inject = ['ContentUrl', '$translate'];\r\n        return DataSourceErrors;\r\n    })();\r\n    VizPortal.DataSourceErrors = DataSourceErrors;\r\n    VizPortal.Module.instance().service('DataSourceErrors', DataSourceErrors);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DeleteGroupAction = (function () {\r\n        function DeleteGroupAction($translate, ConfirmActionDialog, deleteGroupsActionNotification, Groups, toaster) {\r\n            this.$translate = $translate;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.deleteGroupsActionNotification = deleteGroupsActionNotification;\r\n            this.Groups = Groups;\r\n            this.toaster = toaster;\r\n        }\r\n        DeleteGroupAction.prototype.showDeleteGroupDialog = function (groups, dialogScope) {\r\n            var _this = this;\r\n            var dialogBody;\r\n            var successMessage;\r\n            if (groups.size() === 1) {\r\n                var group = groups.first();\r\n                dialogBody = this.$translate.instant('confirmDeleteGroup', { GROUP_NAME: VizPortal.L10n.elideIfLong(group.name) });\r\n                successMessage = this.$translate.instant('groupDeleted', { GROUP_NAME: VizPortal.L10n.elideIfLong(group.name) });\r\n            }\r\n            else {\r\n                dialogBody = this.$translate.instant('confirmDeleteGroups', { GROUP_COUNT: groups.size() }, VizPortal.L10n.Interpolations.Count);\r\n                successMessage = this.$translate.instant('groupsDeleted', { GROUP_COUNT: groups.size() }, VizPortal.L10n.Interpolations.Count);\r\n            }\r\n            var dialogInstance = this.ConfirmActionDialog.open({\r\n                scope: dialogScope,\r\n                title: this.$translate.instant('delete'),\r\n                bodyText: dialogBody,\r\n                actionName: this.$translate.instant('confirmDeleteButton', { ITEM_COUNT: groups.size() }, VizPortal.L10n.Interpolations.Count),\r\n                isDeleteAction: true,\r\n                action: function () { return _this.Groups.deleteGroups(groups.keys()); }\r\n            });\r\n            dialogInstance.result.then(function (result) {\r\n                _this.deleteGroupsActionNotification.notify(result, groups);\r\n            });\r\n            return dialogInstance.result;\r\n        };\r\n        DeleteGroupAction.$inject = ['$translate',\r\n            'ConfirmActionDialog',\r\n            'DeleteGroupsActionNotification',\r\n            'Groups',\r\n            'ToasterService'];\r\n        return DeleteGroupAction;\r\n    })();\r\n    VizPortal.DeleteGroupAction = DeleteGroupAction;\r\n    VizPortal.Module.instance().service('DeleteGroupAction', DeleteGroupAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var DeleteServerUsersRequest = (function (_super) {\r\n            __extends(DeleteServerUsersRequest, _super);\r\n            function DeleteServerUsersRequest(params) {\r\n                _super.call(this, 'deleteServerUsers', params);\r\n            }\r\n            return DeleteServerUsersRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.DeleteServerUsersRequest = DeleteServerUsersRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../models/IServerUserInfo.ts\" />\r\n/// <reference path=\"../ServerApi/types/IServerUser.ts\" />\r\n/// <reference path=\"../ServerApi/requests/DeleteServerUsersRequest.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var DeleteUsersFromServerAction = (function () {\r\n        function DeleteUsersFromServerAction($state, $translate, ConfirmActionDialog, userActionNotification, ServerUsers, toaster) {\r\n            this.$state = $state;\r\n            this.$translate = $translate;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.userActionNotification = userActionNotification;\r\n            this.ServerUsers = ServerUsers;\r\n            this.toaster = toaster;\r\n        }\r\n        DeleteUsersFromServerAction.prototype.showDeleteUsersFromServerDialog = function (serverUsers, context) {\r\n            var _this = this;\r\n            var dialogBody = this.$translate.instant('confirmDeleteUsers', {\r\n                USER_NAME: VizPortal.L10n.elideIfLong(serverUsers.first().displayName),\r\n                USER_COUNT: serverUsers.size()\r\n            }, VizPortal.L10n.Interpolations.Count);\r\n            var dialogInstance = this.ConfirmActionDialog.open({\r\n                scope: context.scope,\r\n                title: this.$translate.instant('delete'),\r\n                bodyText: dialogBody,\r\n                actionName: this.$translate.instant('confirmDeleteButton', {\r\n                    ITEM_COUNT: serverUsers.size()\r\n                }, VizPortal.L10n.Interpolations.Count),\r\n                isDeleteAction: true,\r\n                action: function () { return _this.ServerUsers.deleteUsers(serverUsers.keys()); }\r\n            });\r\n            dialogInstance.result.then(function (result) {\r\n                var params = {\r\n                    users: serverUsers,\r\n                    results: result.results,\r\n                    errors: result.errors,\r\n                    successCode: '11'\r\n                };\r\n                _this.userActionNotification.notify(params);\r\n            });\r\n            return dialogInstance.result;\r\n        };\r\n        DeleteUsersFromServerAction.$inject = ['$state',\r\n            '$translate',\r\n            'ConfirmActionDialog',\r\n            'UserActionNotification',\r\n            'ServerUsers',\r\n            'ToasterService'];\r\n        return DeleteUsersFromServerAction;\r\n    })();\r\n    VizPortal.DeleteUsersFromServerAction = DeleteUsersFromServerAction;\r\n    VizPortal.Module.instance().service('DeleteUsersFromServerAction', DeleteUsersFromServerAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"./WindowLocationService.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    // Launches Desktop application using \"tableau:\" URI scheme\r\n    var DesktopLaunchService = (function () {\r\n        function DesktopLaunchService($q, $timeout, $window, windowLocationService) {\r\n            this.$q = $q;\r\n            this.$timeout = $timeout;\r\n            this.windowLocationService = windowLocationService;\r\n            this.initHiddenIFrame($window);\r\n        }\r\n        DesktopLaunchService.prototype.initHiddenIFrame = function ($window) {\r\n            this.hiddenIFrame = $window.document.createElement(\"iframe\");\r\n            this.hiddenIFrame.className = 'ng-hide';\r\n            $window.document.body.appendChild(this.hiddenIFrame);\r\n        };\r\n        // Launch Desktop.\r\n        // Focus on focusElm to detect window blur (heuristic for knowing whether something opened)\r\n        DesktopLaunchService.prototype.launchDesktop = function (focusElm) {\r\n            focusElm.focus();\r\n            var blurDeferred = this.$q.defer();\r\n            focusElm.one('blur', function () {\r\n                // Focus was blurred! Assume success since something opened to take focus away.\r\n                blurDeferred.resolve(); // report success\r\n            });\r\n            // Fail after not getting blur event for a while\r\n            this.$timeout(function () { return blurDeferred.reject(); }, DesktopLaunchService.DesktopLaunchTimeoutMillis);\r\n            try {\r\n                this.windowLocationService.navigateIFrameTo(this.hiddenIFrame, DesktopLaunchService.URIScheme);\r\n            }\r\n            catch (e) {\r\n                // Fail fast.\r\n                // We were lucky enough to get an exception for the failure!\r\n                // (Currently only Firefox will throw an exception here when the protocol is not recognized)\r\n                return this.$q.reject();\r\n            }\r\n            // Wait for focus to blur or not...\r\n            return blurDeferred.promise;\r\n        };\r\n        DesktopLaunchService.DesktopLaunchTimeoutMillis = 4000;\r\n        DesktopLaunchService.URIScheme = 'tableau:';\r\n        DesktopLaunchService.$inject = [\r\n            '$q',\r\n            '$timeout',\r\n            '$window',\r\n            'WindowLocationService'\r\n        ];\r\n        return DesktopLaunchService;\r\n    })();\r\n    VizPortal.DesktopLaunchService = DesktopLaunchService;\r\n    VizPortal.Module.instance().service('DesktopLaunchService', DesktopLaunchService);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../types/IGetDetailParams.ts\" />\r\n/// <reference path=\"Request.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetDetailRequest = (function (_super) {\r\n            __extends(GetDetailRequest, _super);\r\n            function GetDetailRequest(method, id) {\r\n                _super.call(this, method, { id: id });\r\n            }\r\n            return GetDetailRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetDetailRequest = GetDetailRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../fetchers/IDetailFetcher.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetDetailRequest.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerDetailFetcher = (function () {\r\n        function ServerDetailFetcher(server, $q, requestMethod, resultMapper) {\r\n            this.server = server;\r\n            this.$q = $q;\r\n            this.requestMethod = requestMethod;\r\n            this.resultMapper = resultMapper;\r\n        }\r\n        ServerDetailFetcher.prototype.fetchById = function (id) {\r\n            var _this = this;\r\n            return this.server\r\n                .sendRequest(new VizPortal.ServerApi.GetDetailRequest(this.requestMethod, id))\r\n                .then(VizPortal.ResultHelper.rejectResultOnError(this.$q))\r\n                .then(function (result) { return _this.$q.when(_this.resultMapper(result)); }, function (result) { return _this.$q.reject(result.errors && result.errors[0] && result.errors[0].code); });\r\n        };\r\n        return ServerDetailFetcher;\r\n    })();\r\n    VizPortal.ServerDetailFetcher = ServerDetailFetcher;\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"ServerService.ts\" />\r\n/// <reference path=\"../fetchers/IDetailFetcher.ts\" />\r\n/// <reference path=\"../fetchers/ServerResourceFetcher.ts\" />\r\n/// <reference path=\"../fetchers/ServerDetailFetcher.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var FetcherFactory = (function () {\r\n        function FetcherFactory($q, server) {\r\n            this.$q = $q;\r\n            this.server = server;\r\n        }\r\n        FetcherFactory.prototype.getServerDetailFetcher = function (requestMethod, resultMapper) {\r\n            return new VizPortal.ServerDetailFetcher(this.server, this.$q, requestMethod, resultMapper);\r\n        };\r\n        FetcherFactory.prototype.getServerResourceFetcher = function (requestType, resultMapper) {\r\n            return new VizPortal.ServerResourceFetcher(this.server, requestType, resultMapper);\r\n        };\r\n        FetcherFactory.$inject = [\r\n            '$q',\r\n            'ServerService'\r\n        ];\r\n        return FetcherFactory;\r\n    })();\r\n    VizPortal.FetcherFactory = FetcherFactory;\r\n    VizPortal.Module.instance().service('FetcherFactory', FetcherFactory);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ServerApi;\r\n    (function (ServerApi) {\r\n        var GetActionableObjectsRequest = (function (_super) {\r\n            __extends(GetActionableObjectsRequest, _super);\r\n            function GetActionableObjectsRequest(params) {\r\n                _super.call(this, 'getActionableObjects', params);\r\n            }\r\n            return GetActionableObjectsRequest;\r\n        })(ServerApi.Request);\r\n        ServerApi.GetActionableObjectsRequest = GetActionableObjectsRequest;\r\n    })(ServerApi = VizPortal.ServerApi || (VizPortal.ServerApi = {}));\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../helpers/RequestHelper.ts\" />\r\n/// <reference path=\"../ServerApi/requests/GetActionableObjectsRequest.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    // TODO: in the future, this class and the underlying API will support more action types than editPermissions\r\n    //       see http://mytableau/display/devft/getActionableObjects for details\r\n    var GetActionableObjectsForAction = (function () {\r\n        function GetActionableObjectsForAction(server) {\r\n            this.server = server;\r\n        }\r\n        GetActionableObjectsForAction.prototype.editPermissions = function (ids) {\r\n            return this.server.sendRequests(VizPortal.RequestHelper.buildRequests(ids.ids, function (idsBlock) { return new VizPortal.ServerApi.GetActionableObjectsRequest({\r\n                authorizables: {\r\n                    type: ids.type,\r\n                    ids: idsBlock\r\n                }\r\n            }); }), GetActionableObjectsForAction.combineResults);\r\n        };\r\n        GetActionableObjectsForAction.combineResults = function (results) {\r\n            return {\r\n                ids: VizPortal.ResultHelper.combineIds(results),\r\n                errors: VizPortal.ResultHelper.combineErrors(results)\r\n            };\r\n        };\r\n        GetActionableObjectsForAction.$inject = ['ServerService'];\r\n        return GetActionableObjectsForAction;\r\n    })();\r\n    VizPortal.GetActionableObjectsForAction = GetActionableObjectsForAction;\r\n    VizPortal.Module.instance().service('GetActionableObjectsForAction', GetActionableObjectsForAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ProjectErrors = (function () {\r\n        function ProjectErrors($state, $translate) {\r\n            this.$state = $state;\r\n            this.$translate = $translate;\r\n        }\r\n        ProjectErrors.prototype.errorDetailsFor = function (projectErrorItem) {\r\n            return {\r\n                itemName: projectErrorItem.item.name,\r\n                itemUrl: projectErrorItem.error.code === VizPortal.CommonErrorCode.ProjectNotFound\r\n                    ? null\r\n                    : this.projectUrl(projectErrorItem.item),\r\n                errorMessage: this.errorMessageFor(projectErrorItem)\r\n            };\r\n        };\r\n        ProjectErrors.prototype.projectUrl = function (project) {\r\n            return this.$state.href('main.site.content.project.details', { id: project.id });\r\n        };\r\n        ProjectErrors.prototype.errorMessageFor = function (errorItem) {\r\n            var project = errorItem.item;\r\n            switch (errorItem.error.code) {\r\n                case VizPortal.ProjectErrorCode.ProjectChangeOwnerDisabled:\r\n                    return this.$translate.instant('errorProjectChangeOwnerDisabled');\r\n                case VizPortal.ProjectErrorCode.ProjectDescriptionGreaterThanMaxLength:\r\n                    return this.$translate.instant('errorProjectDescriptionTooLong');\r\n                case VizPortal.ProjectErrorCode.ProjectNameAlreadyExists:\r\n                    return this.$translate.instant('errorProjectNameAlreadyExists');\r\n                case VizPortal.CommonErrorCode.ProjectNotFound:\r\n                    return this.$translate.instant('errorProjectNotFound', { PROJECT_NAME: VizPortal.L10n.elideIfLong(project.name) });\r\n                case VizPortal.CommonErrorCode.CallingUserInsufficientPermissions:\r\n                    return this.$translate.instant('errorProjectInsufficientPermissions');\r\n                default:\r\n                    return this.$translate.instant('errorUnknown');\r\n            }\r\n        };\r\n        ProjectErrors.$inject = ['$state', '$translate'];\r\n        return ProjectErrors;\r\n    })();\r\n    VizPortal.ProjectErrors = ProjectErrors;\r\n    VizPortal.Module.instance().service('ProjectErrors', ProjectErrors);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var RemoveUsersFromGroupAction = (function () {\r\n        function RemoveUsersFromGroupAction($translate, ConfirmActionDialog, SiteUsers, groupMembershipUpdateActionNotification) {\r\n            this.$translate = $translate;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.SiteUsers = SiteUsers;\r\n            this.groupMembershipUpdateActionNotification = groupMembershipUpdateActionNotification;\r\n        }\r\n        RemoveUsersFromGroupAction.prototype.showRemoveUsersFromGroupDialog = function (groupUsers, group) {\r\n            var _this = this;\r\n            var dialogBody = this.$translate.instant('confirmRemoveUsersFromGroup', {\r\n                USER_NAME: VizPortal.L10n.elideIfLong(groupUsers.first().displayName),\r\n                USER_COUNT: groupUsers.size(),\r\n                GROUP_NAME: VizPortal.L10n.elideIfLong(group.name)\r\n            }, VizPortal.L10n.Interpolations.Count);\r\n            var dialogInstance = this.ConfirmActionDialog.open({\r\n                title: this.$translate.instant('remove'),\r\n                bodyText: dialogBody,\r\n                actionName: this.$translate.instant('confirmRemoveButton', {\r\n                    ITEM_COUNT: groupUsers.size()\r\n                }, VizPortal.L10n.Interpolations.Count),\r\n                isDeleteAction: true,\r\n                action: function () { return _this.SiteUsers.removeFromGroups(groupUsers.keys(), [group.id]); }\r\n            });\r\n            dialogInstance.result.then(function (result) {\r\n                _this.groupMembershipUpdateActionNotification.notify(result, groupUsers, 0, null, 1, group.name);\r\n            });\r\n            return dialogInstance.result;\r\n        };\r\n        RemoveUsersFromGroupAction.$inject = ['$translate',\r\n            'ConfirmActionDialog',\r\n            'SiteUsers',\r\n            'GroupMembershipUpdateActionNotification'];\r\n        return RemoveUsersFromGroupAction;\r\n    })();\r\n    VizPortal.RemoveUsersFromGroupAction = RemoveUsersFromGroupAction;\r\n    VizPortal.Module.instance().service('RemoveUsersFromGroupAction', RemoveUsersFromGroupAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../models/ILongRunningAction.ts\" />\r\n/// <reference path=\"../helpers/ErrorCodes.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var SetProjectControlledPermissionsAction = (function () {\r\n        function SetProjectControlledPermissionsAction($translate, toaster, Projects, longRunningActionService, scope) {\r\n            this.$translate = $translate;\r\n            this.toaster = toaster;\r\n            this.Projects = Projects;\r\n            this.longRunningActionService = longRunningActionService;\r\n            this.scope = scope;\r\n        }\r\n        SetProjectControlledPermissionsAction.prototype.execute = function (projects, updatedPermissionSource, scope) {\r\n            this.scope = scope;\r\n            if (_.first(updatedPermissionSource) === VizPortal.LockUnlockProjectPermissionsState.Locked) {\r\n                return this.lockProjectPermissions(projects);\r\n            }\r\n            else {\r\n                return this.unlockProjectPermissions(projects);\r\n            }\r\n        };\r\n        SetProjectControlledPermissionsAction.prototype.lockProjectPermissions = function (projects) {\r\n            var _this = this;\r\n            var projIds = projects.pluck(\"id\");\r\n            return this.Projects.setProjectControlledPermissions(projIds)\r\n                .then(function (result) {\r\n                var toast;\r\n                if (result.errors && result.errors.length) {\r\n                    toast = {\r\n                        type: VizPortal.ToastType.Error,\r\n                        text: _this.errorMessageFor(result.errors[0], projects.first())\r\n                    };\r\n                }\r\n                else {\r\n                    var permission_source = _this.$translate.instant('lockProjectPermissionsChangeSuccess_locked', { PROJECT_COUNT: projects.size() });\r\n                    toast = {\r\n                        type: VizPortal.ToastType.Info,\r\n                        text: _this.$translate.instant('lockProjectPermissionsChangeSuccess', { PROJECT_COUNT: projects.size(),\r\n                            PROJECT_NAME: VizPortal.L10n.elideIfLong(projects.first().name),\r\n                            PERMISSION_SOURCE: permission_source\r\n                        }, VizPortal.L10n.Interpolations.Count)\r\n                    };\r\n                }\r\n                _this.toaster.pop(toast);\r\n                return result;\r\n            });\r\n        };\r\n        SetProjectControlledPermissionsAction.prototype.unlockProjectPermissions = function (projects) {\r\n            var _this = this;\r\n            var projIds = projects.pluck(\"id\");\r\n            var permissionChangeSuccess = function (result) {\r\n                if (result && result.succeeded === false) {\r\n                    permissionsChangeFail(VizPortal.ErrorReason.Unknown);\r\n                }\r\n                else {\r\n                    _this.scope.percentComplete = result.percentComplete;\r\n                    var permission_source = _this.$translate.instant('lockProjectPermissionsChangeSuccess_unlocked', { PROJECT_COUNT: projects.size() });\r\n                    var toast = {\r\n                        type: VizPortal.ToastType.Info,\r\n                        text: _this.$translate.instant('lockProjectPermissionsChangeSuccess', { PROJECT_COUNT: projects.size(),\r\n                            PROJECT_NAME: VizPortal.L10n.elideIfLong(projects.first().name),\r\n                            PERMISSION_SOURCE: permission_source\r\n                        }, VizPortal.L10n.Interpolations.Count)\r\n                    };\r\n                    _this.toaster.pop(toast);\r\n                    _this.scope.busyUnlocking = false;\r\n                }\r\n                return result.response;\r\n            };\r\n            var permissionsChangeFail = function (reason) {\r\n                _this.scope.busyUnlocking = false;\r\n                var toast = {\r\n                    type: VizPortal.ToastType.Error,\r\n                    text: _this.$translate.instant('errorUnknown')\r\n                };\r\n                _this.toaster.pop(toast);\r\n            };\r\n            var notifyProgress = function (action) {\r\n                _this.scope.busyUnlocking = true;\r\n                _this.scope.percentComplete = action.percentComplete;\r\n            };\r\n            return this.Projects.setContentControlledPermissions(projIds)\r\n                .then(function (result) {\r\n                var progress = _this.longRunningActionService.trackProgress(result.actionId);\r\n                return progress.promise.then(permissionChangeSuccess, permissionsChangeFail, notifyProgress);\r\n            });\r\n        };\r\n        SetProjectControlledPermissionsAction.prototype.errorMessageFor = function (error, project) {\r\n            switch (error.code) {\r\n                case VizPortal.CommonErrorCode.ProjectNotFound:\r\n                    return this.$translate.instant('errorProjectNotFound', { PROJECT_NAME: VizPortal.L10n.elideIfLong(project.name) });\r\n                default:\r\n                    return this.$translate.instant('errorUnknown');\r\n            }\r\n        };\r\n        SetProjectControlledPermissionsAction.$inject = ['$translate', 'ToasterService', 'Projects', 'LongRunningActionService'];\r\n        return SetProjectControlledPermissionsAction;\r\n    })();\r\n    VizPortal.SetProjectControlledPermissionsAction = SetProjectControlledPermissionsAction;\r\n    VizPortal.Module.instance().service('SetProjectControlledPermissionsAction', SetProjectControlledPermissionsAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\n/// <reference path=\"../services/GroupsActionNotification.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var UpdateGroupNameAction = (function () {\r\n        function UpdateGroupNameAction($translate, $q, ConfirmActionDialog, Groups, renameGroupActionNotification, toaster) {\r\n            this.$translate = $translate;\r\n            this.$q = $q;\r\n            this.ConfirmActionDialog = ConfirmActionDialog;\r\n            this.Groups = Groups;\r\n            this.renameGroupActionNotification = renameGroupActionNotification;\r\n            this.toaster = toaster;\r\n        }\r\n        // update group name on the groups list page (confirmation dialog with text input for name entry).\r\n        UpdateGroupNameAction.prototype.showUpdateGroupNameDialog = function (group, parentScope) {\r\n            var _this = this;\r\n            var dialogScope = parentScope.$new();\r\n            dialogScope.description = this.$translate.instant('updateGroupNameDesc', {\r\n                GROUP_NAME: VizPortal.L10n.elideIfLong(group.name)\r\n            });\r\n            dialogScope.input = {\r\n                text: group.name,\r\n                maxLength: 255\r\n            };\r\n            var dialogInstance = this.ConfirmActionDialog.open({\r\n                title: this.$translate.instant('updateGroupNameTitle'),\r\n                bodyTemplateUrl: 'confirmActionDialogInput.html',\r\n                scope: dialogScope,\r\n                position: { reserveHeight: 250 },\r\n                confirmDisabled: function () { return _.isEmpty(dialogScope.input.text); },\r\n                actionName: this.$translate.instant('updateGroupNameTitle'),\r\n                action: function (dialogInstance) {\r\n                    return _this.Groups.updateGroupName(group.id, dialogScope.input.text).then(function (result) {\r\n                        _this.renameGroupActionNotification.notify(function (errorMsg) {\r\n                            dialogInstance.showErrorMessage(errorMsg);\r\n                        }, result, dialogScope.input.text, group.name);\r\n                        return result;\r\n                    });\r\n                }\r\n            });\r\n            dialogInstance.result.fin(function () { return dialogScope.$destroy(); });\r\n            return dialogInstance.result;\r\n        };\r\n        // update group name on the group details page (in-place editing; no dialog)\r\n        UpdateGroupNameAction.prototype.updateGroupNameInPlace = function (group, newName) {\r\n            var _this = this;\r\n            return this.rejectOnError(this.Groups.updateGroupName(group.id, newName).then(function (result) {\r\n                // show the toast\r\n                var msg = '';\r\n                if (result.errors && result.errors.length) {\r\n                    msg = _this.$translate.instant('updateGroupNameErrorMsg', { ITEM_NAME: VizPortal.L10n.elideIfLong(group.name), NEW_ITEM_NAME: VizPortal.L10n.elideIfLong(newName) });\r\n                    _this.toaster.pop({ type: VizPortal.ToastType.Error, text: msg });\r\n                }\r\n                else {\r\n                    msg = _this.$translate.instant('updateGroupNameSuccessMsg', { ITEM_NAME: VizPortal.L10n.elideIfLong(group.name), NEW_ITEM_NAME: VizPortal.L10n.elideIfLong(newName) });\r\n                    _this.toaster.pop({ type: VizPortal.ToastType.Info, text: msg });\r\n                    // update the UI's model of the name to the new name, if the request didn't error\r\n                    group.name = newName;\r\n                }\r\n                return result;\r\n            }));\r\n        };\r\n        // Helper method to reject a promise if the result returned from the server contains any errors.\r\n        UpdateGroupNameAction.prototype.rejectOnError = function (serverResult) {\r\n            var _this = this;\r\n            return serverResult.then(function (result) {\r\n                if (result.errors && result.errors.length) {\r\n                    return _this.$q.reject(result);\r\n                }\r\n            });\r\n        };\r\n        UpdateGroupNameAction.$inject = ['$translate',\r\n            '$q',\r\n            'ConfirmActionDialog',\r\n            'Groups',\r\n            'RenameGroupActionNotification',\r\n            'ToasterService'];\r\n        return UpdateGroupNameAction;\r\n    })();\r\n    VizPortal.UpdateGroupNameAction = UpdateGroupNameAction;\r\n    VizPortal.Module.instance().service('UpdateGroupNameAction', UpdateGroupNameAction);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var UserActionResultCode = (function () {\r\n        function UserActionResultCode($translate) {\r\n            this.$translate = $translate;\r\n            UserActionResultCode.validUserActionCodes = {};\r\n            var codes = [1]\r\n                .concat(_.range(10, 16))\r\n                .concat(_.range(20, 22))\r\n                .concat(_.range(30, 33))\r\n                .concat(_.range(40, 43))\r\n                .concat(_.range(50, 58));\r\n            _.each(codes, function (code) { return UserActionResultCode.validUserActionCodes[code] = true; });\r\n        }\r\n        UserActionResultCode.prototype.toLocalizedResultMessage = function (userActionCode, count) {\r\n            if (count === void 0) { count = 1; }\r\n            userActionCode = this.normalizeUserActionCode(userActionCode);\r\n            if (this.isValidUserActionCode(userActionCode)) {\r\n                return this.$translate.instant(['userActionBulkOperationResult_', userActionCode].join(''), { COUNT: count }, VizPortal.L10n.Interpolations.Count);\r\n            }\r\n            else {\r\n                console.log('unknown code ' + userActionCode);\r\n                return '';\r\n            }\r\n        };\r\n        UserActionResultCode.prototype.toLocalizedErrorMessage = function (userActionCode, count) {\r\n            if (count === void 0) { count = 1; }\r\n            userActionCode = this.normalizeUserActionCode(userActionCode);\r\n            if (this.isValidUserActionErrorCode(userActionCode)) {\r\n                return this.$translate.instant(['userActionBulkOperationErrorResult_', userActionCode].join(''), { COUNT: count }, VizPortal.L10n.Interpolations.Count);\r\n            }\r\n            else {\r\n                console.log('unknown code ' + userActionCode);\r\n                return '';\r\n            }\r\n        };\r\n        UserActionResultCode.prototype.normalizeUserActionCode = function (userActionCode) {\r\n            if (typeof userActionCode === 'string') {\r\n                // server bug: some codes are returned as strings others as numbers.\r\n                userActionCode = parseInt(userActionCode.toString(), 10) || 0;\r\n            }\r\n            return userActionCode;\r\n        };\r\n        UserActionResultCode.prototype.isValidUserActionCode = function (code) {\r\n            return !!UserActionResultCode.validUserActionCodes[code];\r\n        };\r\n        UserActionResultCode.prototype.isValidUserActionErrorCode = function (code) {\r\n            return !!VizPortal.UserErrorCode[code] || !!VizPortal.CommonErrorCode[code];\r\n        };\r\n        UserActionResultCode.$inject = ['$translate'];\r\n        return UserActionResultCode;\r\n    })();\r\n    VizPortal.UserActionResultCode = UserActionResultCode;\r\n    VizPortal.Module.instance().service('UserActionResultCode', UserActionResultCode);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../libs.ts\" />\r\n/// <reference path=\"../L10n/L10n.ts\" />\r\n/// <reference path=\"../Module.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    var ViewErrors = (function () {\r\n        function ViewErrors($translate) {\r\n            this.$translate = $translate;\r\n        }\r\n        ViewErrors.prototype.errorDetailsFor = function (viewErrorItem) {\r\n            return {\r\n                itemName: viewErrorItem.item.name,\r\n                itemUrl: null,\r\n                errorMessage: this.errorMessageFor(viewErrorItem)\r\n            };\r\n        };\r\n        ViewErrors.prototype.errorMessageFor = function (errorItem) {\r\n            var view = errorItem.item;\r\n            switch (errorItem.error.code) {\r\n                case VizPortal.CommonErrorCode.ViewNotFound:\r\n                    return this.$translate.instant('errorViewNotFound', { VIEW_NAME: VizPortal.L10n.elideIfLong(view.name) });\r\n                case VizPortal.CommonErrorCode.CallingUserInsufficientPermissions:\r\n                    return this.$translate.instant('errorViewInsufficientPermissions');\r\n                default:\r\n                    return this.$translate.instant('errorUnknown');\r\n            }\r\n        };\r\n        ViewErrors.$inject = ['$translate'];\r\n        return ViewErrors;\r\n    })();\r\n    VizPortal.ViewErrors = ViewErrors;\r\n    VizPortal.Module.instance().service('ViewErrors', ViewErrors);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"../../libs.ts\" />\r\n/// <reference path=\"../../ts/libs.ts\" />\r\nvar VizPortal;\r\n(function (VizPortal) {\r\n    VizPortal.Module.instance().directive('tbWindowMaxWidth', [\r\n        '$window',\r\n        function ($window) {\r\n            return {\r\n                restrict: 'A',\r\n                link: function (scope, elm, attrs) {\r\n                    var syncToWindowWidth = function () { return elm.css('maxWidth', $($window).width()); };\r\n                    syncToWindowWidth();\r\n                    $($window).on('resize', syncToWindowWidth);\r\n                    elm.on('$destroy', function () {\r\n                        $($window).off('resize', syncToWindowWidth);\r\n                    });\r\n                }\r\n            };\r\n        }\r\n    ]);\r\n})(VizPortal || (VizPortal = {}));\r\n/// <reference path=\"FeatureFlags.ts\" />\r\n/// <reference path=\"config.ts\" />\r\n/// <reference path=\"contentConfig.ts\" />\r\n/// <reference path=\"decorators/qDecorator.ts\" />\r\n/// <reference path=\"decorators/stateServiceDecorator.ts\" />\r\n/// <reference path=\"run.ts\" />\r\n/// <reference path=\"actions/UserSettingsActions.ts\" />\r\n/// <reference path=\"controllers/AddActiveDirectoryGroupDialogCtrl.ts\" />\r\n/// <reference path=\"controllers/AddActiveDirectoryServerUsersDialogCtrl.ts\" />\r\n/// <reference path=\"controllers/AddActiveDirectorySiteUsersDialogCtrl.ts\" />\r\n/// <reference path=\"controllers/AddSiteCtrl.ts\" />\r\n/// <reference path=\"controllers/AddUsersToGroupDialogCtrl.ts\" />\r\n/// <reference path=\"controllers/AdminVizViewerCtrl.ts\" />\r\n/// <reference path=\"controllers/AlertMenuCtrl.ts\" />\r\n/// <reference path=\"controllers/AngularCtrl.ts\" />\r\n/// <reference path=\"controllers/BulkImportUsersDialogCtrl.ts\" />\r\n/// <reference path=\"controllers/ContentGridCtrl.ts\" />\r\n/// <reference path=\"controllers/ContentItemPopoverCtrl.ts\" />\r\n/// <reference path=\"controllers/ContentPlaceCtrl.ts\" />\r\n/// <reference path=\"controllers/ContentSubplaceCtrl.ts\" />\r\n/// <reference path=\"controllers/CreateOrEditScheduleCtrl.ts\" />\r\n/// <reference path=\"controllers/DataGridCtrl.ts\" />\r\n/// <reference path=\"controllers/DatasourceDataConnectionCtrl.ts\" />\r\n/// <reference path=\"controllers/DateFilterCtrl.ts\" />\r\n/// <reference path=\"controllers/ErrorCtrl.ts\" />\r\n/// <reference path=\"controllers/ErrorDetailsToastCtrl.ts\" />\r\n/// <reference path=\"controllers/FavoritesMenuCtrl.ts\" />\r\n/// <reference path=\"controllers/FilterPanelCtrl.ts\" />\r\n/// <reference path=\"../common/attributes/tbFocus/FocusCtrl.ts\" />\r\n/// <reference path=\"controllers/GroupDetailsCtrl.ts\" />\r\n/// <reference path=\"controllers/GroupsPlaceCtrl.ts\" />\r\n/// <reference path=\"controllers/GroupUsersSubplaceCtrl.ts\" />\r\n/// <reference path=\"controllers/HelpMenuCtrl.ts\" />\r\n/// <reference path=\"controllers/LicensesCtrl.ts\" />\r\n/// <reference path=\"controllers/LoginCtrl.ts\" />\r\n/// <reference path=\"controllers/LoginSitePickerCtrl.ts\" />\r\n/// <reference path=\"controllers/InitializationCtrl.ts\" />\r\n/// <reference path=\"controllers/PermissionRuleEditorCtrl.ts\" />\r\n/// <reference path=\"controllers/RemoteRefreshSchedulesCtrl.ts\" />\r\n/// <reference path=\"controllers/SigninErrorCtrl.ts\" />\r\n/// <reference path=\"controllers/SchedulesCtrl.ts\" />\r\n/// <reference path=\"controllers/ScrollCtrl.ts\" />\r\n/// <reference path=\"controllers/ServerSettingsFormCtrl.ts\" />\r\n/// <reference path=\"controllers/ServerStatusCtrl.ts\" />\r\n/// <reference path=\"controllers/ServerUserPlaceCtrl.ts\" />\r\n/// <reference path=\"controllers/SignedOutCtrl.ts\" />\r\n/// <reference path=\"controllers/SiteAuthenticationCtrl.ts\" />\r\n/// <reference path=\"controllers/SiteRolesPickerCtrl.ts\" />\r\n/// <reference path=\"controllers/SiteSettingsForServerAdminFormCtrl.ts\" />\r\n/// <reference path=\"controllers/SiteSettingsForSiteAdminFormCtrl.ts\" />\r\n/// <reference path=\"controllers/SitesPlaceCtrl.ts\" />\r\n/// <reference path=\"controllers/SiteSwitcherCtrl.ts\" />\r\n/// <reference path=\"controllers/SiteUserDatasourcesSubplaceCtrl.ts\" />\r\n/// <reference path=\"controllers/SiteUserPlaceCtrl.ts\" />\r\n/// <reference path=\"controllers/SiteUserSettingsSubplaceCtrl.ts\" />\r\n/// <reference path=\"controllers/SiteUserSubscriptionsSubplaceCtrl.ts\" />\r\n/// <reference path=\"controllers/SiteUserViewsSubplaceCtrl.ts\" />\r\n/// <reference path=\"controllers/SiteUserWorkbooksSubplaceCtrl.ts\" />\r\n/// <reference path=\"controllers/SiteUsersPlaceCtrl.ts\" />\r\n/// <reference path=\"controllers/VizViewerCtrl.ts\" />\r\n/// <reference path=\"controllers/ZiplogCtrl.ts\" />\r\n/// <reference path=\"directives/childEventDirectives.ts\" />\r\n/// <reference path=\"directives/keyEventDirectives.ts\" />\r\n/// <reference path=\"directives/pixelStyleDirectives.ts\" />\r\n/// <reference path=\"directives/reactDirectiveFactory.ts\" />\r\n/// <reference path=\"directives/tbAlertInfo.ts\" />\r\n/// <reference path=\"directives/tbAlertMenu.ts\" />\r\n/// <reference path=\"directives/tbAssignPermissionsToContents.ts\" />\r\n/// <reference path=\"../common/attributes/tbAutoSelect.ts\" />\r\n/// <reference path=\"directives/tbBackgroundImage.ts\" />\r\n/// <reference path=\"../common/attributes/tbButtonClick.ts\" />\r\n/// <reference path=\"../common/attributes/tbButtonDown.ts\" />\r\n/// <reference path=\"directives/tbBytesInputConverter.ts\" />\r\n/// <reference path=\"directives/tbBulkImportUsersForm.ts\" />\r\n/// <reference path=\"directives/tbBulkImportResultsSummary.ts\" />\r\n/// <reference path=\"directives/tbChangePassword.ts\" />\r\n/// <reference path=\"../common/components/checkboxes/tbCheckbox.ts\" />\r\n/// <reference path=\"../common/components/checkboxes/tbCheckboxGroup.ts\" />\r\n/// <reference path=\"../common/components/checkboxes/tbCheckboxLabel.ts\" />\r\n/// <reference path=\"../common/components/checkboxes/tbCheckboxTristate.ts\" />\r\n/// <reference path=\"directives/tbCreateTextarea.ts\" />\r\n/// <reference path=\"directives/tbDataGrid.ts\" />\r\n/// <reference path=\"directives/tbDataGridBody.ts\" />\r\n/// <reference path=\"directives/tbDataGridEditableRow.ts\" />\r\n/// <reference path=\"directives/tbDataGridHeaders.ts\" />\r\n/// <reference path=\"../common/components/tbDatePicker/tbDatePicker.ts\" />\r\n/// <reference path=\"directives/tbDaysPicker.ts\" />\r\n/// <reference path=\"directives/tbDisabled.ts\" />\r\n/// <reference path=\"directives/tbDisableSelection.ts\" />\r\n/// <reference path=\"directives/tbEditableCapabilityValue.ts\" />\r\n/// <reference path=\"directives/tbEditableTags.ts\" />\r\n/// <reference path=\"directives/tbEditableText.ts\" />\r\n/// <reference path=\"directives/tbEditableTextarea.ts\" />\r\n/// <reference path=\"directives/tbEditDisplayName.ts\" />\r\n/// <reference path=\"directives/tbEditEmail.ts\" />\r\n/// <reference path=\"directives/tbEditLanguageAndLocale.ts\" />\r\n/// <reference path=\"directives/tbEmailInputValidator.ts\" />\r\n/// <reference path=\"directives/tbEmbeddedPassword.ts\" />\r\n/// <reference path=\"directives/tbFavoritesMenu.ts\" />\r\n/// <reference path=\"directives/tbFavoriteToggle.ts\" />\r\n/// <reference path=\"directives/tbIfFeatureFlag.ts\" />\r\n/// <reference path=\"directives/tbFileDrop.ts\" />\r\n/// <reference path=\"directives/tbFileInput.ts\" />\r\n/// <reference path=\"directives/tbFilteringListBox.ts\" />\r\n/// <reference path=\"../common/attributes/tbFocus/tbFocus.ts\" />\r\n/// <reference path=\"directives/tbFormattingHints.ts\" />\r\n/// <reference path=\"directives/tbHelpMenu.ts\" />\r\n/// <reference path=\"directives/tbHidden.ts\" />\r\n/// <reference path=\"directives/tbIntegerInputValidator.ts\" />\r\n/// <reference path=\"directives/tbLockUnlockProjectPermissions.ts\" />\r\n/// <reference path=\"directives/tbSigningIn.ts\" />\r\n/// <reference path=\"directives/tbMatchingInputsValidator.ts\" />\r\n/// <reference path=\"directives/tbModeSwitcher.ts\" />\r\n/// <reference path=\"directives/tbMouseCapture.ts\" />\r\n/// <reference path=\"directives/tbMousedownOutside.ts\" />\r\n/// <reference path=\"directives/tbMouseTrack.ts\" />\r\n/// <reference path=\"directives/tbOmnibox.ts\" />\r\n/// <reference path=\"directives/tbPermissionsPanel.ts\" />\r\n/// <reference path=\"directives/tbPermissionRuleEditor.ts\" />\r\n/// <reference path=\"directives/tbPlaceDescription.ts\" />\r\n/// <reference path=\"directives/tbPopover.ts\" />\r\n/// <reference path=\"directives/tbPopup.ts\" />\r\n/// <reference path=\"directives/tbPopupMenu.ts\" />\r\n/// <reference path=\"directives/tbPopupMenuButton.ts\" />\r\n/// <reference path=\"directives/tbPopupMenuContent.ts\" />\r\n/// <reference path=\"directives/tbPortInputValidator.ts\" />\r\n/// <reference path=\"directives/tbPreventInput.ts\" />\r\n/// <reference path=\"directives/tbProgressBar.ts\" />\r\n/// <reference path=\"directives/tbRadioButton.ts\" />\r\n/// <reference path=\"directives/tbRangeInputValidator.ts\" />\r\n/// <reference path=\"directives/tbResetStartPage.ts\" />\r\n/// <reference path=\"directives/tbScroll.ts\" />\r\n/// <reference path=\"directives/tbSelect.ts\" />\r\n/// <reference path=\"directives/tbSelected.ts\" />\r\n/// <reference path=\"directives/tbSelectionMenu.ts\" />\r\n/// <reference path=\"directives/tbServerSettingsForm.ts\" />\r\n/// <reference path=\"directives/tbSignedInUserMenu.ts\" />\r\n/// <reference path=\"directives/tbSignInLogo.ts\" />\r\n/// <reference path=\"directives/tbSiteIdInputValidator.ts\" />\r\n/// <reference path=\"directives/tbSiteRolePermissionsTable.ts\" />\r\n/// <reference path=\"directives/tbSiteRolesPicker.ts\" />\r\n/// <reference path=\"directives/tbSettingsCoordinator.ts\" />\r\n/// <reference path=\"directives/tbSiteSettingsForServerAdminForm.ts\" />\r\n/// <reference path=\"directives/tbSiteSettingsForSiteAdminForm.ts\" />\r\n/// <reference path=\"directives/tbSiteSwitcher.ts\" />\r\n/// <reference path=\"directives/tbSortTool.ts\" />\r\n/// <reference path=\"directives/tbStackedElement.ts\" />\r\n/// <reference path=\"directives/tbStateHref.ts\" />\r\n/// <reference path=\"directives/tbTagsInput.ts\" />\r\n/// <reference path=\"directives/tbTemplateList.ts\" />\r\n/// <reference path=\"directives/tbTextBox.ts\" />\r\n/// <reference path=\"directives/tbTextDropdown.ts\" />\r\n/// <reference path=\"directives/tbTextile.ts\" />\r\n/// <reference path=\"directives/tbTimePicker.ts\" />\r\n/// <reference path=\"directives/tbTypeaheadFilter.ts\" />\r\n/// <reference path=\"directives/tbToast.ts\" />\r\n/// <reference path=\"directives/tbToaster.ts\" />\r\n/// <reference path=\"directives/tbTooltipArea.ts\" />\r\n/// <reference path=\"directives/tbTopBar.ts\" />\r\n/// <reference path=\"directives/tbTranscludeFn.ts\" />\r\n/// <reference path=\"directives/tbTypeahead.ts\" />\r\n/// <reference path=\"directives/tbTypeaheadFormat.ts\" />\r\n/// <reference path=\"directives/tbUpdateSiteLogoForm.ts\" />\r\n/// <reference path=\"directives/tbUploadIframe.ts\" />\r\n/// <reference path=\"directives/tbUserNameInputValidator.ts\" />\r\n/// <reference path=\"directives/tbUserOrGroupSelector.ts\" />\r\n/// <reference path=\"directives/tbVisible.ts\" />\r\n/// <reference path=\"directives/tbViz.ts\" />\r\n/// <reference path=\"directives/tbWindowResize.ts\" />\r\n/// <reference path=\"directives/tbWorkerProcessStatus.ts\" />\r\n/// <reference path=\"filters/CredentialTypeFilter.ts\" />\r\n/// <reference path=\"filters/CronExpressionFilter.ts\" />\r\n/// <reference path=\"filters/LastSignInDateFilter.ts\" />\r\n/// <reference path=\"filters/ListFilter.ts\" />\r\n/// <reference path=\"filters/LocalizedCountFilter.ts\" />\r\n/// <reference path=\"filters/LocalizedDateFilter.ts\" />\r\n/// <reference path=\"filters/LocalizedPercentFilter.ts\" />\r\n/// <reference path=\"filters/LocLinkifierFilter.ts\" />\r\n/// <reference path=\"filters/PadFilter.ts\" />\r\n/// <reference path=\"filters/RemoteRefreshScheduleTypeNameFilter.ts\" />\r\n/// <reference path=\"filters/ScheduleActionNameFilter.ts\" />\r\n/// <reference path=\"filters/ScheduleFrequencyDescriptionFilter.ts\" />\r\n/// <reference path=\"filters/ScheduleTypeNameFilter.ts\" />\r\n/// <reference path=\"filters/ScheduleFrequencyDescriptionFilter.ts\" />\r\n/// <reference path=\"filters/SiteRoleFilter.ts\" />\r\n/// <reference path=\"filters/SizeFilter.ts\" />\r\n/// <reference path=\"../common/react/angularDirectives.ts\" />\r\n/// <reference path=\"resources/ActiveDirectoryGroups.ts\" />\r\n/// <reference path=\"resources/Alerts.ts\" />\r\n/// <reference path=\"resources/Comments.ts\" />\r\n/// <reference path=\"resources/DataConnections.ts\" />\r\n/// <reference path=\"resources/DataConnectionTypes.ts\" />\r\n/// <reference path=\"resources/Datasources.ts\" />\r\n/// <reference path=\"resources/ExplicitPermissions.ts\" />\r\n/// <reference path=\"resources/ExtractTasks.ts\" />\r\n/// <reference path=\"resources/Favorites.ts\" />\r\n/// <reference path=\"resources/Languages.ts\" />\r\n/// <reference path=\"resources/Locales.ts\" />\r\n/// <reference path=\"resources/Projects.ts\" />\r\n/// <reference path=\"resources/ProjectNames.ts\" />\r\n/// <reference path=\"resources/Query.ts\" />\r\n/// <reference path=\"resources/Resource.ts\" />\r\n/// <reference path=\"resources/Schedules.ts\" />\r\n/// <reference path=\"resources/ServerSettings.ts\" />\r\n/// <reference path=\"resources/SiteNameSansIds.ts\" />\r\n/// <reference path=\"resources/SiteNameWithIds.ts\" />\r\n/// <reference path=\"resources/SiteRoles.ts\" />\r\n/// <reference path=\"resources/Sites.ts\" />\r\n/// <reference path=\"resources/Tags.ts\" />\r\n/// <reference path=\"resources/UserNames.ts\" />\r\n/// <reference path=\"resources/Views.ts\" />\r\n/// <reference path=\"resources/Workbooks.ts\" />\r\n/// <reference path=\"services/AddActiveDirectoryUsersAction.ts\" />\r\n/// <reference path=\"services/AddUsersToGroupAction.ts\" />\r\n/// <reference path=\"services/assignPermissionsToContentsService.ts\" />\r\n/// <reference path=\"services/BackdropService.ts\" />\r\n/// <reference path=\"services/BreadcrumbsService.ts\" />\r\n/// <reference path=\"services/BulkImportUsersAction.ts\" />\r\n/// <reference path=\"services/ChangeDatasourceRefreshModeAction.ts\" />\r\n/// <reference path=\"services/ChangeDatasourceRemoteAgentAction.ts\" />\r\n/// <reference path=\"services/ChangeDatasourceRemoteRefreshPropertiesAction.ts\" />\r\n/// <reference path=\"services/ConfirmActionDialog.ts\" />\r\n/// <reference path=\"services/ContentActions.ts\" />\r\n/// <reference path=\"services/ContentFilterService.ts\" />\r\n/// <reference path=\"services/ContentUrl.ts\" />\r\n/// <reference path=\"services/CreateGroupDialogAction.ts\" />\r\n/// <reference path=\"services/CreateSiteAction.ts\" />\r\n/// <reference path=\"services/DataSourceErrors.ts\" />\r\n/// <reference path=\"services/DeleteCommentActions.ts\" />\r\n/// <reference path=\"services/DeleteConnectedDeviceAction.ts\" />\r\n/// <reference path=\"services/DeleteGroupAction.ts\" />\r\n/// <reference path=\"services/DeleteUsersFromServerAction.ts\" />\r\n/// <reference path=\"services/DesktopLaunchService.ts\" />\r\n/// <reference path=\"services/DisplaySettingsService.ts\" />\r\n/// <reference path=\"services/EditConnectionAction.ts\" />\r\n/// <reference path=\"services/EditSiteAction.ts\" />\r\n/// <reference path=\"services/ErrorMessageHandler.ts\" />\r\n/// <reference path=\"services/EffectivePermissionsService.ts\" />\r\n/// <reference path=\"services/FetcherFactory.ts\" />\r\n/// <reference path=\"services/FilterPanelService.ts\" />\r\n/// <reference path=\"services/GetActionableObjectsForAction.ts\" />\r\n/// <reference path=\"services/GettingStartedNotifications.ts\" />\r\n/// <reference path=\"services/HelpService.ts\" />\r\n/// <reference path=\"services/ImagePreloadService.ts\" />\r\n/// <reference path=\"services/LicensesService.ts\" />\r\n/// <reference path=\"services/LogoService.ts\" />\r\n/// <reference path=\"services/LongRunningActionService.ts\" />\r\n/// <reference path=\"services/MastheadNotifications.ts\" />\r\n/// <reference path=\"services/ModalService.ts\" />\r\n/// <reference path=\"services/PermissionsPanelActions.ts\" />\r\n/// <reference path=\"services/PollService.ts\" />\r\n/// <reference path=\"services/PostLoginNotifications.ts\" />\r\n/// <reference path=\"services/ProjectErrors.ts\" />\r\n/// <reference path=\"services/QueryService.ts\" />\r\n/// <reference path=\"services/RebuildSearchIndexService.ts\" />\r\n/// <reference path=\"services/RemoveUsersFromGroupAction.ts\" />\r\n/// <reference path=\"services/SchedulePermissions.ts\" />\r\n/// <reference path=\"services/SchedulesConfig.ts\" />\r\n/// <reference path=\"services/SearchSuggestionsService.ts\" />\r\n/// <reference path=\"services/SelectionService.ts\" />\r\n/// <reference path=\"services/ServerInfoService.ts\" />\r\n/// <reference path=\"services/ServerService.ts\" />\r\n/// <reference path=\"services/ServerUsersActions.ts\" />\r\n/// <reference path=\"services/SetProjectControlledPermissionsAction.ts\" />\r\n/// <reference path=\"services/SetSiteUsersSiteRoleAction.ts\" />\r\n/// <reference path=\"services/SiteSwitchService.ts\" />\r\n/// <reference path=\"services/SiteUrlMatcherFactory.ts\" />\r\n/// <reference path=\"services/SiteUsersActions.ts\" />\r\n/// <reference path=\"services/SliceableFactory.ts\" />\r\n/// <reference path=\"services/SorterFactory.ts\" />\r\n/// <reference path=\"services/StackedElementsService.ts\" />\r\n/// <reference path=\"services/StartPageService.ts\" />\r\n/// <reference path=\"services/StateWrapperService.ts\" />\r\n/// <reference path=\"services/ToasterService.ts\" />\r\n/// <reference path=\"services/UpdateGroupNameAction.ts\" />\r\n/// <reference path=\"services/UserActionResultCode.ts\" />\r\n/// <reference path=\"services/ViewErrors.ts\" />\r\n/// <reference path=\"services/VizService.ts\" />\r\n/// <reference path=\"services/WindowLocationService.ts\" />\r\n/// <reference path=\"services/WindowPopupService.ts\" />\r\n/// <reference path=\"services/WorkbookErrors.ts\" />\r\n/// <reference path=\"services/ZiplogService.ts\" />\r\n/// <reference path=\"ServerApi/types/BulkImportUsersFromCsvResponse.ts\" />\r\n/// <reference path=\"stores/UserSettingsStore.ts\" />\r\n/// <reference path=\"../common/attributes/tbWindowMaxWidth.ts\" />\r\n"],"sourceRoot":"/source/"}